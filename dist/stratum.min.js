var stratum=(()=>{var Qd=Object.create,Ni=Object.defineProperty,ep=Object.getPrototypeOf,tp=Object.prototype.hasOwnProperty,rp=Object.getOwnPropertyNames,ip=Object.getOwnPropertyDescriptor,le=Object.assign,ws=e=>Ni(e,"__esModule",{value:!0}),ue=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),np=(e,t)=>{ws(e);for(var r in t)Ni(e,r,{get:t[r],enumerable:!0})},ap=(e,t,r)=>{if(ws(e),typeof t=="object"||typeof t=="function")for(let i of rp(t))!tp.call(e,i)&&i!=="default"&&Ni(e,i,{get:()=>t[i],enumerable:!(r=ip(t,i))||r.enumerable});return e},lt=e=>e&&e.__esModule?e:ap(Ni(Qd(ep(e)),"default",{value:e,enumerable:!0}),e),ct=(e,t,r)=>new Promise((i,a)=>{var n=c=>{try{o(r.next(c))}catch(l){a(l)}},s=c=>{try{o(r.throw(c))}catch(l){a(l)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(n,s);o((r=r.apply(e,t)).next())}),Ts=ue((Mv,xs)=>{xs.exports=Ge;function Ge(e){if(e)return op(e)}function op(e){for(var t in Ge.prototype)e[t]=Ge.prototype[t];return e}Ge.prototype.on=Ge.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this};Ge.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function i(){r.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this};Ge.prototype.off=Ge.prototype.removeListener=Ge.prototype.removeAllListeners=Ge.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(arguments.length==1)return delete this._callbacks[e],this;for(var i,a=0;a<r.length;a++)if(i=r[a],i===t||i.fn===t){r.splice(a,1);break}return this};Ge.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var i=0,a=r.length;i<a;++i)r[i].apply(this,t)}return this};Ge.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]};Ge.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),js=ue((zv,Os)=>{var Cs=Ts();function Yr(){Cs.call(this)}Yr.prototype=new Cs;Os.exports=Yr;Yr.Stream=Yr;Yr.prototype.pipe=function(e,t){var r=this;function i(h){e.writable&&(e.write(h)===!1&&r.pause&&r.pause())}r.on("data",i);function a(){r.readable&&r.resume&&r.resume()}e.on("drain",a),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",s),r.on("close",o));var n=!1;function s(){if(n)return;n=!0,e.end()}function o(){if(n)return;n=!0,typeof e.destroy=="function"&&e.destroy()}function c(h){if(l(),!this.hasListeners("error"))throw h}r.on("error",c),e.on("error",c);function l(){r.off("data",i),e.off("drain",a),r.off("end",s),r.off("close",o),r.off("error",c),e.off("error",c),r.off("end",l),r.off("close",l),e.off("end",l),e.off("close",l)}return r.on("end",l),r.on("close",l),e.on("end",l),e.on("close",l),e.emit("pipe",r),e}}),Fn=ue((Uv,ks)=>{ks.exports=js()}),gt=ue(He=>{"use strict";He.base64=!0;He.array=!0;He.string=!0;He.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined";He.nodebuffer=typeof Buffer!="undefined";He.uint8array=typeof Uint8Array!="undefined";if(typeof ArrayBuffer=="undefined")He.blob=!1;else{var Es=new ArrayBuffer(0);try{He.blob=new Blob([Es],{type:"application/zip"}).size===0}catch(e){try{var sp=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,As=new sp;As.append(Es),He.blob=As.getBlob("application/zip").size===0}catch(t){He.blob=!1}}}try{He.nodestream=!!Fn().Readable}catch(e){He.nodestream=!1}}),Mn=ue(Pn=>{"use strict";var lp=Ce(),cp=gt(),ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Pn.encode=function(e){for(var t=[],r,i,a,n,s,o,c,l=0,h=e.length,u=h,f=lp.getTypeOf(e)!=="string";l<e.length;)u=h-l,f?(r=e[l++],i=l<h?e[l++]:0,a=l<h?e[l++]:0):(r=e.charCodeAt(l++),i=l<h?e.charCodeAt(l++):0,a=l<h?e.charCodeAt(l++):0),n=r>>2,s=(r&3)<<4|i>>4,o=u>1?(i&15)<<2|a>>6:64,c=u>2?a&63:64,t.push(ht.charAt(n)+ht.charAt(s)+ht.charAt(o)+ht.charAt(c));return t.join("")};Pn.decode=function(e){var t,r,i,a,n,s,o,c=0,l=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var u=e.length*3/4;if(e.charAt(e.length-1)===ht.charAt(64)&&u--,e.charAt(e.length-2)===ht.charAt(64)&&u--,u%1!==0)throw new Error("Invalid base64 input, bad content length.");var f;for(cp.uint8array?f=new Uint8Array(u|0):f=new Array(u|0);c<e.length;)a=ht.indexOf(e.charAt(c++)),n=ht.indexOf(e.charAt(c++)),s=ht.indexOf(e.charAt(c++)),o=ht.indexOf(e.charAt(c++)),t=a<<2|n>>4,r=(n&15)<<4|s>>2,i=(s&3)<<6|o,f[l++]=t,s!==64&&(f[l++]=r),o!==64&&(f[l++]=i);return f}}),$r=ue((Hv,Is)=>{"use strict";Is.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}}),Rs=ue((Vv,Ds)=>{"use strict";Ds.exports=typeof setImmediate=="function"?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}),Ms=ue((Xv,Bs)=>{"use strict";var Ns=global.MutationObserver||global.WebKitMutationObserver,qr;if(Ns){var Ls=0,hp=new Ns(Li),Fs=global.document.createTextNode("");hp.observe(Fs,{characterData:!0}),qr=function(){Fs.data=Ls=++Ls%2}}else if(!global.setImmediate&&typeof global.MessageChannel!="undefined"){var Ps=new global.MessageChannel;Ps.port1.onmessage=Li,qr=function(){Ps.port2.postMessage(0)}}else"document"in global&&"onreadystatechange"in global.document.createElement("script")?qr=function(){var e=global.document.createElement("script");e.onreadystatechange=function(){Li(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:qr=function(){setTimeout(Li,0)};var zn,Zr=[];function Li(){zn=!0;for(var e,t,r=Zr.length;r;){for(t=Zr,Zr=[],e=-1;++e<r;)t[e]();r=Zr.length}zn=!1}Bs.exports=up;function up(e){Zr.push(e)===1&&!zn&&qr()}}),Vs=ue((Yv,zs)=>{"use strict";var fp=Ms();function hr(){}var Le={},Us=["REJECTED"],Un=["FULFILLED"],Ws=["PENDING"];zs.exports=Tt;function Tt(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=Ws,this.queue=[],this.outcome=void 0,e!==hr&&Gs(this,e)}Tt.prototype.finally=function(e){if(typeof e!="function")return this;var t=this.constructor;return this.then(r,i);function r(a){function n(){return a}return t.resolve(e()).then(n)}function i(a){function n(){throw a}return t.resolve(e()).then(n)}};Tt.prototype.catch=function(e){return this.then(null,e)};Tt.prototype.then=function(e,t){if(typeof e!="function"&&this.state===Un||typeof t!="function"&&this.state===Us)return this;var r=new this.constructor(hr);if(this.state!==Ws){var i=this.state===Un?e:t;Wn(r,i,this.outcome)}else this.queue.push(new Kr(r,e,t));return r};function Kr(e,t,r){this.promise=e,typeof t=="function"&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),typeof r=="function"&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}Kr.prototype.callFulfilled=function(e){Le.resolve(this.promise,e)};Kr.prototype.otherCallFulfilled=function(e){Wn(this.promise,this.onFulfilled,e)};Kr.prototype.callRejected=function(e){Le.reject(this.promise,e)};Kr.prototype.otherCallRejected=function(e){Wn(this.promise,this.onRejected,e)};function Wn(e,t,r){fp(function(){var i;try{i=t(r)}catch(a){return Le.reject(e,a)}i===e?Le.reject(e,new TypeError("Cannot resolve promise with itself")):Le.resolve(e,i)})}Le.resolve=function(e,t){var r=Hs(dp,t);if(r.status==="error")return Le.reject(e,r.value);var i=r.value;if(i)Gs(e,i);else{e.state=Un,e.outcome=t;for(var a=-1,n=e.queue.length;++a<n;)e.queue[a].callFulfilled(t)}return e};Le.reject=function(e,t){e.state=Us,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callRejected(t);return e};function dp(e){var t=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof t=="function")return function(){t.apply(e,arguments)}}function Gs(e,t){var r=!1;function i(o){if(r)return;r=!0,Le.reject(e,o)}function a(o){if(r)return;r=!0,Le.resolve(e,o)}function n(){t(a,i)}var s=Hs(n);s.status==="error"&&i(s.value)}function Hs(e,t){var r={};try{r.value=e(t),r.status="success"}catch(i){r.status="error",r.value=i}return r}Tt.resolve=pp;function pp(e){return e instanceof this?e:Le.resolve(new this(hr),e)}Tt.reject=mp;function mp(e){var t=new this(hr);return Le.reject(t,e)}Tt.all=bp;function bp(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=new Array(r),n=0,s=-1,o=new this(hr);++s<r;)c(e[s],s);return o;function c(l,h){t.resolve(l).then(u,function(f){i||(i=!0,Le.reject(o,f))});function u(f){a[h]=f,++n===r&&!i&&(i=!0,Le.resolve(o,a))}}}Tt.race=gp;function gp(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=-1,n=new this(hr);++a<r;)s(e[a]);return n;function s(o){t.resolve(o).then(function(c){i||(i=!0,Le.resolve(n,c))},function(c){i||(i=!0,Le.reject(n,c))})}}}),ur=ue(($v,Xs)=>{"use strict";var Gn=null;typeof Promise!="undefined"?Gn=Promise:Gn=Vs();Xs.exports={Promise:Gn}}),Ce=ue(De=>{"use strict";var Ot=gt(),vp=Mn(),fr=$r(),yp=Rs(),Hn=ur();function wp(e){var t=null;return Ot.uint8array?t=new Uint8Array(e.length):t=new Array(e.length),Fi(e,t)}De.newBlob=function(e,t){De.checkSupport("blob");try{return new Blob([e],{type:t})}catch(a){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,i=new r;return i.append(e),i.getBlob(t)}catch(n){throw new Error("Bug : can't construct the Blob.")}}};function Jr(e){return e}function Fi(e,t){for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)&255;return t}var Pi={stringifyByChunk:function(e,t,r){var i=[],a=0,n=e.length;if(n<=r)return String.fromCharCode.apply(null,e);for(;a<n;)t==="array"||t==="nodebuffer"?i.push(String.fromCharCode.apply(null,e.slice(a,Math.min(a+r,n)))):i.push(String.fromCharCode.apply(null,e.subarray(a,Math.min(a+r,n)))),a+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return Ot.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return!1}}(),nodebuffer:function(){try{return Ot.nodebuffer&&String.fromCharCode.apply(null,fr.allocBuffer(1)).length===1}catch(e){return!1}}()}};function Qr(e){var t=65536,r=De.getTypeOf(e),i=!0;if(r==="uint8array"?i=Pi.applyCanBeUsed.uint8array:r==="nodebuffer"&&(i=Pi.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return Pi.stringifyByChunk(e,r,t)}catch(a){t=Math.floor(t/2)}return Pi.stringifyByChar(e)}De.applyFromCharCode=Qr;function Mi(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var Ct={};Ct.string={string:Jr,array:function(e){return Fi(e,new Array(e.length))},arraybuffer:function(e){return Ct.string.uint8array(e).buffer},uint8array:function(e){return Fi(e,new Uint8Array(e.length))},nodebuffer:function(e){return Fi(e,fr.allocBuffer(e.length))}};Ct.array={string:Qr,array:Jr,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return fr.newBufferFrom(e)}};Ct.arraybuffer={string:function(e){return Qr(new Uint8Array(e))},array:function(e){return Mi(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:Jr,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return fr.newBufferFrom(new Uint8Array(e))}};Ct.uint8array={string:Qr,array:function(e){return Mi(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:Jr,nodebuffer:function(e){return fr.newBufferFrom(e)}};Ct.nodebuffer={string:Qr,array:function(e){return Mi(e,new Array(e.length))},arraybuffer:function(e){return Ct.nodebuffer.uint8array(e).buffer},uint8array:function(e){return Mi(e,new Uint8Array(e.length))},nodebuffer:Jr};De.transformTo=function(e,t){if(t||(t=""),!e)return t;De.checkSupport(e);var r=De.getTypeOf(t),i=Ct[r][e](t);return i};De.getTypeOf=function(e){if(typeof e=="string")return"string";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(Ot.nodebuffer&&fr.isBuffer(e))return"nodebuffer";if(Ot.uint8array&&e instanceof Uint8Array)return"uint8array";if(Ot.arraybuffer&&e instanceof ArrayBuffer)return"arraybuffer"};De.checkSupport=function(e){var t=Ot[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")};De.MAX_VALUE_16BITS=65535;De.MAX_VALUE_32BITS=-1;De.pretty=function(e){var t="",r,i;for(i=0;i<(e||"").length;i++)r=e.charCodeAt(i),t+="\\x"+(r<16?"0":"")+r.toString(16).toUpperCase();return t};De.delay=function(e,t,r){yp(function(){e.apply(r||null,t||[])})};De.inherits=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r};De.extend=function(){var e={},t,r;for(t=0;t<arguments.length;t++)for(r in arguments[t])arguments[t].hasOwnProperty(r)&&typeof e[r]=="undefined"&&(e[r]=arguments[t][r]);return e};De.prepareContent=function(e,t,r,i,a){var n=Hn.Promise.resolve(t).then(function(s){var o=Ot.blob&&(s instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(s))!==-1);return o&&typeof FileReader!="undefined"?new Hn.Promise(function(c,l){var h=new FileReader;h.onload=function(u){c(u.target.result)},h.onerror=function(u){l(u.target.error)},h.readAsArrayBuffer(s)}):s});return n.then(function(s){var o=De.getTypeOf(s);return o?(o==="arraybuffer"?s=De.transformTo("uint8array",s):o==="string"&&(a?s=vp.decode(s):r&&(i!==!0&&(s=wp(s)))),s):Hn.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}}),Ve=ue((Zv,Ys)=>{"use strict";function $s(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}$s.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.end()}),e.on("error",function(r){t.error(r)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(e))continue;this.streamInfo[e]=this.extraStreamInfo[e]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}};Ys.exports=$s}),$t=ue(jt=>{"use strict";var dr=Ce(),Yt=gt(),_p=$r(),zi=Ve(),ei=new Array(256);for(var kt=0;kt<256;kt++)ei[kt]=kt>=252?6:kt>=248?5:kt>=240?4:kt>=224?3:kt>=192?2:1;ei[254]=ei[254]=1;var Sp=function(e){var t,r,i,a,n,s=e.length,o=0;for(a=0;a<s;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(Yt.uint8array?t=new Uint8Array(o):t=new Array(o),n=0,a=0;n<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|r&63):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|r&63):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|r&63);return t},xp=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+ei[e[r]]>t?r:t},Tp=function(e){var t,r,i,a,n,s=e.length,o=new Array(s*2);for(i=0,r=0;r<s;){if(a=e[r++],a<128){o[i++]=a;continue}if(n=ei[a],n>4){o[i++]=65533,r+=n-1;continue}for(a&=n===2?31:n===3?15:7;n>1&&r<s;)a=a<<6|e[r++]&63,n--;if(n>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return o.length!==i&&(o.subarray?o=o.subarray(0,i):o.length=i),dr.applyFromCharCode(o)};jt.utf8encode=function(t){return Yt.nodebuffer?_p.newBufferFrom(t,"utf-8"):Sp(t)};jt.utf8decode=function(t){return Yt.nodebuffer?dr.transformTo("nodebuffer",t).toString("utf-8"):(t=dr.transformTo(Yt.uint8array?"uint8array":"array",t),Tp(t))};function Ui(){zi.call(this,"utf-8 decode"),this.leftOver=null}dr.inherits(Ui,zi);Ui.prototype.processChunk=function(e){var t=dr.transformTo(Yt.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(Yt.uint8array){var r=t;t=new Uint8Array(r.length+this.leftOver.length),t.set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=xp(t),a=t;i!==t.length&&(Yt.uint8array?(a=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(a=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:jt.utf8decode(a),meta:e.meta})};Ui.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:jt.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};jt.Utf8DecodeWorker=Ui;function Vn(){zi.call(this,"utf-8 encode")}dr.inherits(Vn,zi);Vn.prototype.processChunk=function(e){this.push({data:jt.utf8encode(e.data),meta:e.meta})};jt.Utf8EncodeWorker=Vn}),Js=ue((Jv,qs)=>{"use strict";var Zs=Ve(),Ks=Ce();function Xn(e){Zs.call(this,"ConvertWorker to "+e),this.destType=e}Ks.inherits(Xn,Zs);Xn.prototype.processChunk=function(e){this.push({data:Ks.transformTo(this.destType,e.data),meta:e.meta})};qs.exports=Xn}),tl=ue((Qv,Qs)=>{"use strict";var el=Fn().Readable,Op=Ce();Op.inherits(Yn,el);function Yn(e,t,r){el.call(this,t),this._helper=e;var i=this;e.on("data",function(a,n){i.push(a)||i._helper.pause(),r&&r(n)}).on("error",function(a){i.emit("error",a)}).on("end",function(){i.push(null)})}Yn.prototype._read=function(){this._helper.resume()};Qs.exports=Yn}),$n=ue((ey,rl)=>{"use strict";var qt=Ce(),Cp=Js(),jp=Ve(),kp=Mn(),Ep=gt(),Ap=ur(),il=null;if(Ep.nodestream)try{il=tl()}catch(e){}function Ip(e,t,r){switch(e){case"blob":return qt.newBlob(qt.transformTo("arraybuffer",t),r);case"base64":return kp.encode(t);default:return qt.transformTo(e,t)}}function Dp(e,t){var r,i=0,a=null,n=0;for(r=0;r<t.length;r++)n+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(a=new Uint8Array(n),r=0;r<t.length;r++)a.set(t[r],i),i+=t[r].length;return a;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function Rp(e,t){return new Ap.Promise(function(r,i){var a=[],n=e._internalType,s=e._outputType,o=e._mimeType;e.on("data",function(c,l){a.push(c),t&&t(l)}).on("error",function(c){a=[],i(c)}).on("end",function(){try{var c=Ip(s,Dp(n,a),o);r(c)}catch(l){i(l)}a=[]}).resume()})}function nl(e,t,r){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string";break}try{this._internalType=i,this._outputType=t,this._mimeType=r,qt.checkSupport(i),this._worker=e.pipe(new Cp(i)),e.lock()}catch(a){this._worker=new jp("error"),this._worker.error(a)}}nl.prototype={accumulate:function(e){return Rp(this,e)},on:function(e,t){var r=this;return e==="data"?this._worker.on(e,function(i){t.call(r,i.data,i.meta)}):this._worker.on(e,function(){qt.delay(t,arguments,r)}),this},resume:function(){return qt.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(qt.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new il(this,{objectMode:this._outputType!=="nodebuffer"},e)}};rl.exports=nl}),qn=ue(Qe=>{"use strict";Qe.base64=!1;Qe.binary=!1;Qe.dir=!1;Qe.createFolders=!0;Qe.date=null;Qe.compression=null;Qe.compressionOptions=null;Qe.comment=null;Qe.unixPermissions=null;Qe.dosPermissions=null}),Zn=ue((ry,al)=>{"use strict";var Wi=Ce(),Gi=Ve(),Bp=16*1024;function pr(e){Gi.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(r){t.dataIsReady=!0,t.data=r,t.max=r&&r.length||0,t.type=Wi.getTypeOf(r),t.isPaused||t._tickAndRepeat()},function(r){t.error(r)})}Wi.inherits(pr,Gi);pr.prototype.cleanUp=function(){Gi.prototype.cleanUp.call(this),this.data=null};pr.prototype.resume=function(){return Gi.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,Wi.delay(this._tickAndRepeat,[],this)),!0):!1};pr.prototype._tickAndRepeat=function(){if(this._tickScheduled=!1,this.isPaused||this.isFinished)return;this._tick(),this.isFinished||(Wi.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)};pr.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=Bp,t=null,r=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,r);break;case"uint8array":t=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":t=this.data.slice(this.index,r);break}return this.index=r,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};al.exports=pr}),Qn=ue((iy,ol)=>{"use strict";var Np=Ce(),Kn=Ve();function Jn(e){Kn.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}Np.inherits(Jn,Kn);Jn.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}Kn.prototype.processChunk.call(this,e)};ol.exports=Jn}),Hi=ue((ny,sl)=>{"use strict";var Lp=Ce();function Fp(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var ll=Fp();function Pp(e,t,r,i){var a=ll,n=i+r;e=e^-1;for(var s=i;s<n;s++)e=e>>>8^a[(e^t[s])&255];return e^-1}function Mp(e,t,r,i){var a=ll,n=i+r;e=e^-1;for(var s=i;s<n;s++)e=e>>>8^a[(e^t.charCodeAt(s))&255];return e^-1}sl.exports=function(t,r){if(typeof t=="undefined"||!t.length)return 0;var i=Lp.getTypeOf(t)!=="string";return i?Pp(r|0,t,t.length,0):Mp(r|0,t,t.length,0)}}),ta=ue((ay,cl)=>{"use strict";var hl=Ve(),zp=Hi(),Up=Ce();function ea(){hl.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Up.inherits(ea,hl);ea.prototype.processChunk=function(e){this.streamInfo.crc32=zp(e.data,this.streamInfo.crc32||0),this.push(e)};cl.exports=ea}),Xi=ue((oy,ul)=>{"use strict";var fl=ur(),dl=Zn(),Vi=Qn(),Wp=ta(),Vi=Qn();function ra(e,t,r,i,a){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=a}ra.prototype={getContentWorker:function(){var e=new dl(fl.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Vi("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new dl(fl.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};ra.createWorkerFrom=function(e,t,r){return e.pipe(new Wp).pipe(new Vi("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new Vi("compressedSize")).withStreamInfo("compression",t)};ul.exports=ra}),gl=ue((sy,pl)=>{"use strict";var Gp=$n(),Hp=Zn(),ia=$t(),na=Xi(),ml=Ve(),aa=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};aa.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");r=e.toLowerCase();var i=r==="string"||r==="text";(r==="binarystring"||r==="text")&&(r="string"),t=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(t=t.pipe(new ia.Utf8EncodeWorker)),!a&&i&&(t=t.pipe(new ia.Utf8DecodeWorker))}catch(n){t=new ml("error"),t.error(n)}return new Gp(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof na&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new ia.Utf8EncodeWorker)),na.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof na?this._data.getContentWorker():this._data instanceof ml?this._data:new Hp(this._data)}};var bl=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Vp=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var oa=0;oa<bl.length;oa++)aa.prototype[bl[oa]]=Vp;pl.exports=aa}),vt=ue(Fe=>{"use strict";var Xp=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function Yp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}Fe.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(!r)continue;if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var i in r)Yp(r,i)&&(e[i]=r[i])}return e};Fe.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var $p={arraySet:function(e,t,r,i,a){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),a);return}for(var n=0;n<i;n++)e[a+n]=t[r+n]},flattenChunks:function(e){var t,r,i,a,n,s;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(s=new Uint8Array(i),a=0,t=0,r=e.length;t<r;t++)n=e[t],s.set(n,a),a+=n.length;return s}},qp={arraySet:function(e,t,r,i,a){for(var n=0;n<i;n++)e[a+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};Fe.setTyped=function(e){e?(Fe.Buf8=Uint8Array,Fe.Buf16=Uint16Array,Fe.Buf32=Int32Array,Fe.assign(Fe,$p)):(Fe.Buf8=Array,Fe.Buf16=Array,Fe.Buf32=Array,Fe.assign(Fe,qp))};Fe.setTyped(Xp)}),zl=ue(mr=>{"use strict";var Zp=vt(),Kp=4,vl=0,yl=1,Jp=2;function br(e){for(var t=e.length;--t>=0;)e[t]=0}var Qp=0,wl=1,em=2,tm=3,rm=258,sa=29,ti=256,ri=ti+1+sa,gr=30,la=19,_l=2*ri+1,Zt=15,ca=16,im=7,ha=256,Sl=16,xl=17,Tl=18,ua=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Yi=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],nm=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ol=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],am=512,yt=new Array((ri+2)*2);br(yt);var ii=new Array(gr*2);br(ii);var ni=new Array(am);br(ni);var ai=new Array(rm-tm+1);br(ai);var fa=new Array(sa);br(fa);var $i=new Array(gr);br($i);function da(e,t,r,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}var Cl,jl,kl;function pa(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function El(e){return e<256?ni[e]:ni[256+(e>>>7)]}function oi(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function ze(e,t,r){e.bi_valid>ca-r?(e.bi_buf|=t<<e.bi_valid&65535,oi(e,e.bi_buf),e.bi_buf=t>>ca-e.bi_valid,e.bi_valid+=r-ca):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function ut(e,t,r){ze(e,r[t*2],r[t*2+1])}function Al(e,t){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1}function om(e){e.bi_valid===16?(oi(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function sm(e,t){var r=t.dyn_tree,i=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,h,u,f,d,b,g=0;for(f=0;f<=Zt;f++)e.bl_count[f]=0;for(r[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<_l;l++){if(h=e.heap[l],f=r[r[h*2+1]*2+1]+1,f>c&&(f=c,g++),r[h*2+1]=f,h>i)continue;e.bl_count[f]++,d=0,h>=o&&(d=s[h-o]),b=r[h*2],e.opt_len+=b*(f+d),n&&(e.static_len+=b*(a[h*2+1]+d))}if(g===0)return;do{for(f=c-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(f=c;f!==0;f--)for(h=e.bl_count[f];h!==0;){if(u=e.heap[--l],u>i)continue;r[u*2+1]!==f&&(e.opt_len+=(f-r[u*2+1])*r[u*2],r[u*2+1]=f),h--}}function Il(e,t,r){var i=new Array(Zt+1),a=0,n,s;for(n=1;n<=Zt;n++)i[n]=a=a+r[n-1]<<1;for(s=0;s<=t;s++){var o=e[s*2+1];if(o===0)continue;e[s*2]=Al(i[o]++,o)}}function lm(){var e,t,r,i,a,n=new Array(Zt+1);for(r=0,i=0;i<sa-1;i++)for(fa[i]=r,e=0;e<1<<ua[i];e++)ai[r++]=i;for(ai[r-1]=i,a=0,i=0;i<16;i++)for($i[i]=a,e=0;e<1<<Yi[i];e++)ni[a++]=i;for(a>>=7;i<gr;i++)for($i[i]=a<<7,e=0;e<1<<Yi[i]-7;e++)ni[256+a++]=i;for(t=0;t<=Zt;t++)n[t]=0;for(e=0;e<=143;)yt[e*2+1]=8,e++,n[8]++;for(;e<=255;)yt[e*2+1]=9,e++,n[9]++;for(;e<=279;)yt[e*2+1]=7,e++,n[7]++;for(;e<=287;)yt[e*2+1]=8,e++,n[8]++;for(Il(yt,ri+1,n),e=0;e<gr;e++)ii[e*2+1]=5,ii[e*2]=Al(e,5);Cl=new da(yt,ua,ti+1,ri,Zt),jl=new da(ii,Yi,0,gr,Zt),kl=new da(new Array(0),nm,0,la,im)}function Dl(e){var t;for(t=0;t<ri;t++)e.dyn_ltree[t*2]=0;for(t=0;t<gr;t++)e.dyn_dtree[t*2]=0;for(t=0;t<la;t++)e.bl_tree[t*2]=0;e.dyn_ltree[ha*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Rl(e){e.bi_valid>8?oi(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function cm(e,t,r,i){Rl(e),i&&(oi(e,r),oi(e,~r)),Zp.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function Bl(e,t,r,i){var a=t*2,n=r*2;return e[a]<e[n]||e[a]===e[n]&&i[t]<=i[r]}function ma(e,t,r){for(var i=e.heap[r],a=r<<1;a<=e.heap_len&&!(a<e.heap_len&&Bl(t,e.heap[a+1],e.heap[a],e.depth)&&a++,Bl(t,i,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=i}function Nl(e,t,r){var i,a,n=0,s,o;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+n*2]<<8|e.pending_buf[e.d_buf+n*2+1],a=e.pending_buf[e.l_buf+n],n++,i===0?ut(e,a,t):(s=ai[a],ut(e,s+ti+1,t),o=ua[s],o!==0&&(a-=fa[s],ze(e,a,o)),i--,s=El(i),ut(e,s,r),o=Yi[s],o!==0&&(i-=$i[s],ze(e,i,o)));while(n<e.last_lit);ut(e,ha,t)}function ba(e,t){var r=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems,s,o,c=-1,l;for(e.heap_len=0,e.heap_max=_l,s=0;s<n;s++)r[s*2]!==0?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):r[s*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[l*2]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=i[l*2+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)ma(e,r,s);l=n;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ma(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[l*2]=r[s*2]+r[o*2],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[s*2+1]=r[o*2+1]=l,e.heap[1]=l++,ma(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],sm(e,t),Il(r,c,e.bl_count)}function Ll(e,t,r){var i,a=-1,n,s=t[0*2+1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),t[(r+1)*2+1]=65535,i=0;i<=r;i++){if(n=s,s=t[(i+1)*2+1],++o<c&&n===s)continue;o<l?e.bl_tree[n*2]+=o:n!==0?(n!==a&&e.bl_tree[n*2]++,e.bl_tree[Sl*2]++):o<=10?e.bl_tree[xl*2]++:e.bl_tree[Tl*2]++,o=0,a=n,s===0?(c=138,l=3):n===s?(c=6,l=3):(c=7,l=4)}}function Fl(e,t,r){var i,a=-1,n,s=t[0*2+1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),i=0;i<=r;i++){if(n=s,s=t[(i+1)*2+1],++o<c&&n===s)continue;if(o<l)do ut(e,n,e.bl_tree);while(--o!==0);else n!==0?(n!==a&&(ut(e,n,e.bl_tree),o--),ut(e,Sl,e.bl_tree),ze(e,o-3,2)):o<=10?(ut(e,xl,e.bl_tree),ze(e,o-3,3)):(ut(e,Tl,e.bl_tree),ze(e,o-11,7));o=0,a=n,s===0?(c=138,l=3):n===s?(c=6,l=3):(c=7,l=4)}}function hm(e){var t;for(Ll(e,e.dyn_ltree,e.l_desc.max_code),Ll(e,e.dyn_dtree,e.d_desc.max_code),ba(e,e.bl_desc),t=la-1;t>=3&&!(e.bl_tree[Ol[t]*2+1]!==0);t--);return e.opt_len+=3*(t+1)+5+5+4,t}function um(e,t,r,i){var a;for(ze(e,t-257,5),ze(e,r-1,5),ze(e,i-4,4),a=0;a<i;a++)ze(e,e.bl_tree[Ol[a]*2+1],3);Fl(e,e.dyn_ltree,t-1),Fl(e,e.dyn_dtree,r-1)}function fm(e){var t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return vl;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return yl;for(r=32;r<ti;r++)if(e.dyn_ltree[r*2]!==0)return yl;return vl}var Pl=!1;function dm(e){Pl||(lm(),Pl=!0),e.l_desc=new pa(e.dyn_ltree,Cl),e.d_desc=new pa(e.dyn_dtree,jl),e.bl_desc=new pa(e.bl_tree,kl),e.bi_buf=0,e.bi_valid=0,Dl(e)}function Ml(e,t,r,i){ze(e,(Qp<<1)+(i?1:0),3),cm(e,t,r,!0)}function pm(e){ze(e,wl<<1,3),ut(e,ha,yt),om(e)}function mm(e,t,r,i){var a,n,s=0;e.level>0?(e.strm.data_type===Jp&&(e.strm.data_type=fm(e)),ba(e,e.l_desc),ba(e,e.d_desc),s=hm(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=r+5,r+4<=a&&t!==-1?Ml(e,t,r,i):e.strategy===Kp||n===a?(ze(e,(wl<<1)+(i?1:0),3),Nl(e,yt,ii)):(ze(e,(em<<1)+(i?1:0),3),um(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Nl(e,e.dyn_ltree,e.dyn_dtree)),Dl(e),i&&Rl(e)}function bm(e,t,r){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(ai[r]+ti+1)*2]++,e.dyn_dtree[El(t)*2]++),e.last_lit===e.lit_bufsize-1}mr._tr_init=dm;mr._tr_stored_block=Ml;mr._tr_flush_block=mm;mr._tr_tally=bm;mr._tr_align=pm}),ga=ue((hy,Ul)=>{"use strict";function gm(e,t,r,i){for(var a=e&65535|0,n=e>>>16&65535|0,s=0;r!==0;){s=r>2e3?2e3:r,r-=s;do a=a+t[i++]|0,n=n+a|0;while(--s);a%=65521,n%=65521}return a|n<<16|0}Ul.exports=gm}),va=ue((uy,Wl)=>{"use strict";function vm(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var ym=vm();function wm(e,t,r,i){var a=ym,n=i+r;e^=-1;for(var s=i;s<n;s++)e=e>>>8^a[(e^t[s])&255];return e^-1}Wl.exports=wm}),qi=ue((fy,Gl)=>{"use strict";Gl.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),Jl=ue(ft=>{"use strict";var Pe=vt(),Ye=zl(),Hl=ga(),Et=va(),_m=qi(),Kt=0,Sm=1,xm=3,At=4,Vl=5,dt=0,Xl=1,$e=-2,Tm=-3,ya=-5,Om=-1,Cm=1,Zi=2,jm=3,km=4,Em=0,Am=2,Ki=8,Im=9,Dm=15,Rm=8,Bm=29,Nm=256,wa=Nm+1+Bm,Lm=30,Fm=19,Pm=2*wa+1,Mm=15,_e=3,It=258,et=It+_e+1,zm=32,Ji=42,_a=69,Qi=73,en=91,tn=103,Jt=113,si=666,Re=1,li=2,Qt=3,vr=4,Um=3;function Dt(e,t){return e.msg=_m[t],t}function Yl(e){return(e<<1)-(e>4?9:0)}function Rt(e){for(var t=e.length;--t>=0;)e[t]=0}function Bt(e){var t=e.state,r=t.pending;if(r>e.avail_out&&(r=e.avail_out),r===0)return;Pe.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0)}function Ne(e,t){Ye._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Bt(e.strm)}function Se(e,t){e.pending_buf[e.pending++]=t}function ci(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function Wm(e,t,r,i){var a=e.avail_in;return a>i&&(a=i),a===0?0:(e.avail_in-=a,Pe.arraySet(t,e.input,e.next_in,a,r),e.state.wrap===1?e.adler=Hl(e.adler,t,a,r):e.state.wrap===2&&(e.adler=Et(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)}function $l(e,t){var r=e.max_chain_length,i=e.strstart,a,n,s=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-et?e.strstart-(e.w_size-et):0,l=e.window,h=e.w_mask,u=e.prev,f=e.strstart+It,d=l[i+s-1],b=l[i+s];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,l[a+s]!==b||l[a+s-1]!==d||l[a]!==l[i]||l[++a]!==l[i+1])continue;i+=2,a++;do;while(l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&i<f);if(n=It-(f-i),i=f-It,n>s){if(e.match_start=t,s=n,n>=o)break;d=l[i+s-1],b=l[i+s]}}while((t=u[t&h])>c&&--r!==0);return s<=e.lookahead?s:e.lookahead}function er(e){var t=e.w_size,r,i,a,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-et)){Pe.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,r=i;do a=e.head[--r],e.head[r]=a>=t?a-t:0;while(--i);i=t,r=i;do a=e.prev[--r],e.prev[r]=a>=t?a-t:0;while(--i);n+=t}if(e.strm.avail_in===0)break;if(i=Wm(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=_e)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&!(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+_e-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,e.lookahead+e.insert<_e););}while(e.lookahead<et&&e.strm.avail_in!==0)}function Gm(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(er(e),e.lookahead===0&&t===Kt)return Re;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Ne(e,!1),e.strm.avail_out===0))return Re;if(e.strstart-e.block_start>=e.w_size-et&&(Ne(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,t===At?(Ne(e,!0),e.strm.avail_out===0?Qt:vr):(e.strstart>e.block_start&&(Ne(e,!1),e.strm.avail_out===0),Re)}function Sa(e,t){for(var r,i;;){if(e.lookahead<et){if(er(e),e.lookahead<et&&t===Kt)return Re;if(e.lookahead===0)break}if(r=0,e.lookahead>=_e&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-et&&(e.match_length=$l(e,r)),e.match_length>=_e)if(i=Ye._tr_tally(e,e.strstart-e.match_start,e.match_length-_e),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_e){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=Ye._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ne(e,!1),e.strm.avail_out===0))return Re}return e.insert=e.strstart<_e-1?e.strstart:_e-1,t===At?(Ne(e,!0),e.strm.avail_out===0?Qt:vr):e.last_lit&&(Ne(e,!1),e.strm.avail_out===0)?Re:li}function yr(e,t){for(var r,i,a;;){if(e.lookahead<et){if(er(e),e.lookahead<et&&t===Kt)return Re;if(e.lookahead===0)break}if(r=0,e.lookahead>=_e&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_e-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-et&&(e.match_length=$l(e,r),e.match_length<=5&&(e.strategy===Cm||e.match_length===_e&&e.strstart-e.match_start>4096)&&(e.match_length=_e-1)),e.prev_length>=_e&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-_e,i=Ye._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-_e),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=_e-1,e.strstart++,i&&(Ne(e,!1),e.strm.avail_out===0))return Re}else if(e.match_available){if(i=Ye._tr_tally(e,0,e.window[e.strstart-1]),i&&Ne(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Re}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Ye._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<_e-1?e.strstart:_e-1,t===At?(Ne(e,!0),e.strm.avail_out===0?Qt:vr):e.last_lit&&(Ne(e,!1),e.strm.avail_out===0)?Re:li}function Hm(e,t){for(var r,i,a,n,s=e.window;;){if(e.lookahead<=It){if(er(e),e.lookahead<=It&&t===Kt)return Re;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=_e&&e.strstart>0&&(a=e.strstart-1,i=s[a],i===s[++a]&&i===s[++a]&&i===s[++a])){n=e.strstart+It;do;while(i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&a<n);e.match_length=It-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_e?(r=Ye._tr_tally(e,1,e.match_length-_e),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Ye._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Ne(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,t===At?(Ne(e,!0),e.strm.avail_out===0?Qt:vr):e.last_lit&&(Ne(e,!1),e.strm.avail_out===0)?Re:li}function Vm(e,t){for(var r;;){if(e.lookahead===0&&(er(e),e.lookahead===0)){if(t===Kt)return Re;break}if(e.match_length=0,r=Ye._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Ne(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,t===At?(Ne(e,!0),e.strm.avail_out===0?Qt:vr):e.last_lit&&(Ne(e,!1),e.strm.avail_out===0)?Re:li}function pt(e,t,r,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=a}var wr;wr=[new pt(0,0,0,0,Gm),new pt(4,4,8,4,Sa),new pt(4,5,16,8,Sa),new pt(4,6,32,32,Sa),new pt(4,4,16,16,yr),new pt(8,16,32,32,yr),new pt(8,16,128,128,yr),new pt(8,32,128,256,yr),new pt(32,128,258,1024,yr),new pt(32,258,258,4096,yr)];function Xm(e){e.window_size=2*e.w_size,Rt(e.head),e.max_lazy_match=wr[e.level].max_lazy,e.good_match=wr[e.level].good_length,e.nice_match=wr[e.level].nice_length,e.max_chain_length=wr[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=_e-1,e.match_available=0,e.ins_h=0}function Ym(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ki,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Pe.Buf16(Pm*2),this.dyn_dtree=new Pe.Buf16((2*Lm+1)*2),this.bl_tree=new Pe.Buf16((2*Fm+1)*2),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Pe.Buf16(Mm+1),this.heap=new Pe.Buf16(2*wa+1),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Pe.Buf16(2*wa+1),Rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ql(e){var t;return!e||!e.state?Dt(e,$e):(e.total_in=e.total_out=0,e.data_type=Am,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Ji:Jt,e.adler=t.wrap===2?0:1,t.last_flush=Kt,Ye._tr_init(t),dt)}function Zl(e){var t=ql(e);return t===dt&&Xm(e.state),t}function $m(e,t){return!e||!e.state||e.state.wrap!==2?$e:(e.state.gzhead=t,dt)}function Kl(e,t,r,i,a,n){if(!e)return $e;var s=1;if(t===Om&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>Im||r!==Ki||i<8||i>15||t<0||t>9||n<0||n>km)return Dt(e,$e);i===8&&(i=9);var o=new Ym;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+_e-1)/_e),o.window=new Pe.Buf8(o.w_size*2),o.head=new Pe.Buf16(o.hash_size),o.prev=new Pe.Buf16(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Pe.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=(1+2)*o.lit_bufsize,o.level=t,o.strategy=n,o.method=r,Zl(e)}function qm(e,t){return Kl(e,t,Ki,Dm,Rm,Em)}function Zm(e,t){var r,i,a,n;if(!e||!e.state||t>Vl||t<0)return e?Dt(e,$e):$e;if(i=e.state,!e.output||!e.input&&e.avail_in!==0||i.status===si&&t!==At)return Dt(e,e.avail_out===0?ya:$e);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===Ji)if(i.wrap===2)e.adler=0,Se(i,31),Se(i,139),Se(i,8),i.gzhead?(Se(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Se(i,i.gzhead.time&255),Se(i,i.gzhead.time>>8&255),Se(i,i.gzhead.time>>16&255),Se(i,i.gzhead.time>>24&255),Se(i,i.level===9?2:i.strategy>=Zi||i.level<2?4:0),Se(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Se(i,i.gzhead.extra.length&255),Se(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Et(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=_a):(Se(i,0),Se(i,0),Se(i,0),Se(i,0),Se(i,0),Se(i,i.level===9?2:i.strategy>=Zi||i.level<2?4:0),Se(i,Um),i.status=Jt);else{var s=Ki+(i.w_bits-8<<4)<<8,o=-1;i.strategy>=Zi||i.level<2?o=0:i.level<6?o=1:i.level===6?o=2:o=3,s|=o<<6,i.strstart!==0&&(s|=zm),s+=31-s%31,i.status=Jt,ci(i,s),i.strstart!==0&&(ci(i,e.adler>>>16),ci(i,e.adler&65535)),e.adler=1}if(i.status===_a)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),Bt(e),a=i.pending,i.pending===i.pending_buf_size));)Se(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Qi)}else i.status=Qi;if(i.status===Qi)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),Bt(e),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Se(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),n===0&&(i.gzindex=0,i.status=en)}else i.status=en;if(i.status===en)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),Bt(e),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Se(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>a&&(e.adler=Et(e.adler,i.pending_buf,i.pending-a,a)),n===0&&(i.status=tn)}else i.status=tn;if(i.status===tn&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Bt(e),i.pending+2<=i.pending_buf_size&&(Se(i,e.adler&255),Se(i,e.adler>>8&255),e.adler=0,i.status=Jt)):i.status=Jt),i.pending!==0){if(Bt(e),e.avail_out===0)return i.last_flush=-1,dt}else if(e.avail_in===0&&Yl(t)<=Yl(r)&&t!==At)return Dt(e,ya);if(i.status===si&&e.avail_in!==0)return Dt(e,ya);if(e.avail_in!==0||i.lookahead!==0||t!==Kt&&i.status!==si){var c=i.strategy===Zi?Vm(i,t):i.strategy===jm?Hm(i,t):wr[i.level].func(i,t);if((c===Qt||c===vr)&&(i.status=si),c===Re||c===Qt)return e.avail_out===0&&(i.last_flush=-1),dt;if(c===li&&(t===Sm?Ye._tr_align(i):t!==Vl&&(Ye._tr_stored_block(i,0,0,!1),t===xm&&(Rt(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Bt(e),e.avail_out===0))return i.last_flush=-1,dt}return t!==At?dt:i.wrap<=0?Xl:(i.wrap===2?(Se(i,e.adler&255),Se(i,e.adler>>8&255),Se(i,e.adler>>16&255),Se(i,e.adler>>24&255),Se(i,e.total_in&255),Se(i,e.total_in>>8&255),Se(i,e.total_in>>16&255),Se(i,e.total_in>>24&255)):(ci(i,e.adler>>>16),ci(i,e.adler&65535)),Bt(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?dt:Xl)}function Km(e){var t;return!e||!e.state?$e:(t=e.state.status,t!==Ji&&t!==_a&&t!==Qi&&t!==en&&t!==tn&&t!==Jt&&t!==si?Dt(e,$e):(e.state=null,t===Jt?Dt(e,Tm):dt))}function Jm(e,t){var r=t.length,i,a,n,s,o,c,l,h;if(!e||!e.state)return $e;if(i=e.state,s=i.wrap,s===2||s===1&&i.status!==Ji||i.lookahead)return $e;for(s===1&&(e.adler=Hl(e.adler,t,r,0)),i.wrap=0,r>=i.w_size&&(s===0&&(Rt(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new Pe.Buf8(i.w_size),Pe.arraySet(h,t,r-i.w_size,i.w_size,0),t=h,r=i.w_size),o=e.avail_in,c=e.next_in,l=e.input,e.avail_in=r,e.next_in=0,e.input=t,er(i);i.lookahead>=_e;){a=i.strstart,n=i.lookahead-(_e-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[a+_e-1])&i.hash_mask,i.prev[a&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=a,a++;while(--n);i.strstart=a,i.lookahead=_e-1,er(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=_e-1,i.match_available=0,e.next_in=c,e.input=l,e.avail_in=o,i.wrap=s,dt}ft.deflateInit=qm;ft.deflateInit2=Kl;ft.deflateReset=Zl;ft.deflateResetKeep=ql;ft.deflateSetHeader=$m;ft.deflate=Zm;ft.deflateEnd=Km;ft.deflateSetDictionary=Jm;ft.deflateInfo="pako deflate (from Nodeca project)"}),xa=ue(_r=>{"use strict";var rn=vt(),Ql=!0,ec=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Ql=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){ec=!1}var hi=new rn.Buf8(256);for(var Nt=0;Nt<256;Nt++)hi[Nt]=Nt>=252?6:Nt>=248?5:Nt>=240?4:Nt>=224?3:Nt>=192?2:1;hi[254]=hi[254]=1;_r.string2buf=function(e){var t,r,i,a,n,s=e.length,o=0;for(a=0;a<s;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new rn.Buf8(o),n=0,a=0;n<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|r&63):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|r&63):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|r&63);return t};function tc(e,t){if(t<65534&&(e.subarray&&ec||!e.subarray&&Ql))return String.fromCharCode.apply(null,rn.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}_r.buf2binstring=function(e){return tc(e,e.length)};_r.binstring2buf=function(e){for(var t=new rn.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t};_r.buf2string=function(e,t){var r,i,a,n,s=t||e.length,o=new Array(s*2);for(i=0,r=0;r<s;){if(a=e[r++],a<128){o[i++]=a;continue}if(n=hi[a],n>4){o[i++]=65533,r+=n-1;continue}for(a&=n===2?31:n===3?15:7;n>1&&r<s;)a=a<<6|e[r++]&63,n--;if(n>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return tc(o,i)};_r.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+hi[e[r]]>t?r:t}}),Ta=ue((my,rc)=>{"use strict";function Qm(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}rc.exports=Qm}),oc=ue(ui=>{"use strict";var fi=Jl(),di=vt(),Oa=xa(),Ca=qi(),eb=Ta(),ic=Object.prototype.toString,tb=0,ja=4,Sr=0,nc=1,ac=2,rb=-1,ib=0,nb=8;function tr(e){if(!(this instanceof tr))return new tr(e);this.options=di.assign({level:rb,method:nb,chunkSize:16384,windowBits:15,memLevel:8,strategy:ib,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new eb,this.strm.avail_out=0;var r=fi.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Sr)throw new Error(Ca[r]);if(t.header&&fi.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(typeof t.dictionary=="string"?i=Oa.string2buf(t.dictionary):ic.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,r=fi.deflateSetDictionary(this.strm,i),r!==Sr)throw new Error(Ca[r]);this._dict_set=!0}}tr.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,a,n;if(this.ended)return!1;n=t===~~t?t:t===!0?ja:tb,typeof e=="string"?r.input=Oa.string2buf(e):ic.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new di.Buf8(i),r.next_out=0,r.avail_out=i),a=fi.deflate(r,n),a!==nc&&a!==Sr)return this.onEnd(a),this.ended=!0,!1;(r.avail_out===0||r.avail_in===0&&(n===ja||n===ac))&&(this.options.to==="string"?this.onData(Oa.buf2binstring(di.shrinkBuf(r.output,r.next_out))):this.onData(di.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||r.avail_out===0)&&a!==nc);return n===ja?(a=fi.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Sr):(n===ac&&(this.onEnd(Sr),r.avail_out=0),!0)};tr.prototype.onData=function(e){this.chunks.push(e)};tr.prototype.onEnd=function(e){e===Sr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=di.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function ka(e,t){var r=new tr(t);if(r.push(e,!0),r.err)throw r.msg||Ca[r.err];return r.result}function ab(e,t){return t=t||{},t.raw=!0,ka(e,t)}function ob(e,t){return t=t||{},t.gzip=!0,ka(e,t)}ui.Deflate=tr;ui.deflate=ka;ui.deflateRaw=ab;ui.gzip=ob}),lc=ue((gy,sc)=>{"use strict";var nn=30,sb=12;sc.exports=function(t,r){var i,a,n,s,o,c,l,h,u,f,d,b,g,y,S,B,W,X,P,J,V,Y,R,N,k;i=t.state,a=t.next_in,N=t.input,n=a+(t.avail_in-5),s=t.next_out,k=t.output,o=s-(r-t.avail_out),c=s+(t.avail_out-257),l=i.dmax,h=i.wsize,u=i.whave,f=i.wnext,d=i.window,b=i.hold,g=i.bits,y=i.lencode,S=i.distcode,B=(1<<i.lenbits)-1,W=(1<<i.distbits)-1;e:do{g<15&&(b+=N[a++]<<g,g+=8,b+=N[a++]<<g,g+=8),X=y[b&B];t:for(;;){if(P=X>>>24,b>>>=P,g-=P,P=X>>>16&255,P===0)k[s++]=X&65535;else if(P&16){J=X&65535,P&=15,P&&(g<P&&(b+=N[a++]<<g,g+=8),J+=b&(1<<P)-1,b>>>=P,g-=P),g<15&&(b+=N[a++]<<g,g+=8,b+=N[a++]<<g,g+=8),X=S[b&W];r:for(;;){if(P=X>>>24,b>>>=P,g-=P,P=X>>>16&255,P&16){if(V=X&65535,P&=15,g<P&&(b+=N[a++]<<g,g+=8,g<P&&(b+=N[a++]<<g,g+=8)),V+=b&(1<<P)-1,V>l){t.msg="invalid distance too far back",i.mode=nn;break e}if(b>>>=P,g-=P,P=s-o,V>P){if(P=V-P,P>u&&i.sane){t.msg="invalid distance too far back",i.mode=nn;break e}if(Y=0,R=d,f===0){if(Y+=h-P,P<J){J-=P;do k[s++]=d[Y++];while(--P);Y=s-V,R=k}}else if(f<P){if(Y+=h+f-P,P-=f,P<J){J-=P;do k[s++]=d[Y++];while(--P);if(Y=0,f<J){P=f,J-=P;do k[s++]=d[Y++];while(--P);Y=s-V,R=k}}}else if(Y+=f-P,P<J){J-=P;do k[s++]=d[Y++];while(--P);Y=s-V,R=k}for(;J>2;)k[s++]=R[Y++],k[s++]=R[Y++],k[s++]=R[Y++],J-=3;J&&(k[s++]=R[Y++],J>1&&(k[s++]=R[Y++]))}else{Y=s-V;do k[s++]=k[Y++],k[s++]=k[Y++],k[s++]=k[Y++],J-=3;while(J>2);J&&(k[s++]=k[Y++],J>1&&(k[s++]=k[Y++]))}}else if((P&64)===0){X=S[(X&65535)+(b&(1<<P)-1)];continue r}else{t.msg="invalid distance code",i.mode=nn;break e}break}}else if((P&64)===0){X=y[(X&65535)+(b&(1<<P)-1)];continue t}else if(P&32){i.mode=sb;break e}else{t.msg="invalid literal/length code",i.mode=nn;break e}break}}while(a<n&&s<c);J=g>>3,a-=J,g-=J<<3,b&=(1<<g)-1,t.next_in=a,t.next_out=s,t.avail_in=a<n?5+(n-a):5-(a-n),t.avail_out=s<c?257+(c-s):257-(s-c),i.hold=b,i.bits=g;return}}),mc=ue((vy,cc)=>{"use strict";var hc=vt(),xr=15,uc=852,fc=592,dc=0,Ea=1,pc=2,lb=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cb=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],hb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ub=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];cc.exports=function(t,r,i,a,n,s,o,c){var l=c.bits,h=0,u=0,f=0,d=0,b=0,g=0,y=0,S=0,B=0,W=0,X,P,J,V,Y,R=null,N=0,k,w=new hc.Buf16(xr+1),E=new hc.Buf16(xr+1),I=null,O=0,ie,x,C;for(h=0;h<=xr;h++)w[h]=0;for(u=0;u<a;u++)w[r[i+u]]++;for(b=l,d=xr;d>=1&&!(w[d]!==0);d--);if(b>d&&(b=d),d===0)return n[s++]=1<<24|64<<16|0,n[s++]=1<<24|64<<16|0,c.bits=1,0;for(f=1;f<d&&!(w[f]!==0);f++);for(b<f&&(b=f),S=1,h=1;h<=xr;h++)if(S<<=1,S-=w[h],S<0)return-1;if(S>0&&(t===dc||d!==1))return-1;for(E[1]=0,h=1;h<xr;h++)E[h+1]=E[h]+w[h];for(u=0;u<a;u++)r[i+u]!==0&&(o[E[r[i+u]]++]=u);if(t===dc?(R=I=o,k=19):t===Ea?(R=lb,N-=257,I=cb,O-=257,k=256):(R=hb,I=ub,k=-1),W=0,u=0,h=f,Y=s,g=b,y=0,J=-1,B=1<<b,V=B-1,t===Ea&&B>uc||t===pc&&B>fc)return 1;for(;;){ie=h-y,o[u]<k?(x=0,C=o[u]):o[u]>k?(x=I[O+o[u]],C=R[N+o[u]]):(x=32+64,C=0),X=1<<h-y,P=1<<g,f=P;do P-=X,n[Y+(W>>y)+P]=ie<<24|x<<16|C|0;while(P!==0);for(X=1<<h-1;W&X;)X>>=1;if(X!==0?(W&=X-1,W+=X):W=0,u++,--w[h]===0){if(h===d)break;h=r[i+o[u]]}if(h>b&&(W&V)!==J){for(y===0&&(y=b),Y+=f,g=h-y,S=1<<g;g+y<d&&!(S-=w[g+y],S<=0);)g++,S<<=1;if(B+=1<<g,t===Ea&&B>uc||t===pc&&B>fc)return 1;J=W&V,n[J]=b<<24|g<<16|Y-s|0}}return W!==0&&(n[Y+W]=h-y<<24|64<<16|0),c.bits=b,0}}),Zc=ue(tt=>{"use strict";var Xe=vt(),Aa=ga(),mt=va(),fb=lc(),pi=mc(),db=0,bc=1,gc=2,vc=4,pb=5,an=6,rr=0,mb=1,bb=2,qe=-2,yc=-3,Ia=-4,gb=-5,wc=8,_c=1,Sc=2,xc=3,Tc=4,Oc=5,Cc=6,jc=7,kc=8,Ec=9,Ac=10,on=11,wt=12,Da=13,Ic=14,Ra=15,Dc=16,Rc=17,Bc=18,Nc=19,sn=20,ln=21,Lc=22,Fc=23,Pc=24,Mc=25,zc=26,Ba=27,Uc=28,Wc=29,je=30,Na=31,vb=32,yb=852,wb=592,_b=15,Sb=_b;function Gc(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function xb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Xe.Buf16(320),this.work=new Xe.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Hc(e){var t;return!e||!e.state?qe:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=_c,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Xe.Buf32(yb),t.distcode=t.distdyn=new Xe.Buf32(wb),t.sane=1,t.back=-1,rr)}function Vc(e){var t;return!e||!e.state?qe:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,Hc(e))}function Xc(e,t){var r,i;return!e||!e.state?qe:(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?qe:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,Vc(e)))}function Yc(e,t){var r,i;return e?(i=new xb,e.state=i,i.window=null,r=Xc(e,t),r!==rr&&(e.state=null),r):qe}function Tb(e){return Yc(e,Sb)}var $c=!0,La,Fa;function Ob(e){if($c){var t;for(La=new Xe.Buf32(512),Fa=new Xe.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pi(bc,e.lens,0,288,La,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pi(gc,e.lens,0,32,Fa,0,e.work,{bits:5}),$c=!1}e.lencode=La,e.lenbits=9,e.distcode=Fa,e.distbits=5}function qc(e,t,r,i){var a,n=e.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Xe.Buf8(n.wsize)),i>=n.wsize?(Xe.arraySet(n.window,t,r-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>i&&(a=i),Xe.arraySet(n.window,t,r-i,a,n.wnext),i-=a,i?(Xe.arraySet(n.window,t,r-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}function Cb(e,t){var r,i,a,n,s,o,c,l,h,u,f,d,b,g,y=0,S,B,W,X,P,J,V,Y,R=new Xe.Buf8(4),N,k,w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return qe;r=e.state,r.mode===wt&&(r.mode=Da),s=e.next_out,a=e.output,c=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,u=o,f=c,Y=rr;e:for(;;)switch(r.mode){case _c:if(r.wrap===0){r.mode=Da;break}for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.wrap&2&&l===35615){r.check=0,R[0]=l&255,R[1]=l>>>8&255,r.check=mt(r.check,R,2,0),l=0,h=0,r.mode=Sc;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=je;break}if((l&15)!==wc){e.msg="unknown compression method",r.mode=je;break}if(l>>>=4,h-=4,V=(l&15)+8,r.wbits===0)r.wbits=V;else if(V>r.wbits){e.msg="invalid window size",r.mode=je;break}r.dmax=1<<V,e.adler=r.check=1,r.mode=l&512?Ac:wt,l=0,h=0;break;case Sc:for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.flags=l,(r.flags&255)!==wc){e.msg="unknown compression method",r.mode=je;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=je;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&(R[0]=l&255,R[1]=l>>>8&255,r.check=mt(r.check,R,2,0)),l=0,h=0,r.mode=xc;case xc:for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.head&&(r.head.time=l),r.flags&512&&(R[0]=l&255,R[1]=l>>>8&255,R[2]=l>>>16&255,R[3]=l>>>24&255,r.check=mt(r.check,R,4,0)),l=0,h=0,r.mode=Tc;case Tc:for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&(R[0]=l&255,R[1]=l>>>8&255,r.check=mt(r.check,R,2,0)),l=0,h=0,r.mode=Oc;case Oc:if(r.flags&1024){for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&(R[0]=l&255,R[1]=l>>>8&255,r.check=mt(r.check,R,2,0)),l=0,h=0}else r.head&&(r.head.extra=null);r.mode=Cc;case Cc:if(r.flags&1024&&(d=r.length,d>o&&(d=o),d&&(r.head&&(V=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),Xe.arraySet(r.head.extra,i,n,d,V)),r.flags&512&&(r.check=mt(r.check,i,d,n)),o-=d,n+=d,r.length-=d),r.length))break e;r.length=0,r.mode=jc;case jc:if(r.flags&2048){if(o===0)break e;d=0;do V=i[n+d++],r.head&&V&&r.length<65536&&(r.head.name+=String.fromCharCode(V));while(V&&d<o);if(r.flags&512&&(r.check=mt(r.check,i,d,n)),o-=d,n+=d,V)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=kc;case kc:if(r.flags&4096){if(o===0)break e;d=0;do V=i[n+d++],r.head&&V&&r.length<65536&&(r.head.comment+=String.fromCharCode(V));while(V&&d<o);if(r.flags&512&&(r.check=mt(r.check,i,d,n)),o-=d,n+=d,V)break e}else r.head&&(r.head.comment=null);r.mode=Ec;case Ec:if(r.flags&512){for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l!==(r.check&65535)){e.msg="header crc mismatch",r.mode=je;break}l=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=wt;break;case Ac:for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}e.adler=r.check=Gc(l),l=0,h=0,r.mode=on;case on:if(r.havedict===0)return e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,bb;e.adler=r.check=1,r.mode=wt;case wt:if(t===pb||t===an)break e;case Da:if(r.last){l>>>=h&7,h-=h&7,r.mode=Ba;break}for(;h<3;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.last=l&1,l>>>=1,h-=1;switch(l&3){case 0:r.mode=Ic;break;case 1:if(Ob(r),r.mode=sn,t===an){l>>>=2,h-=2;break e}break;case 2:r.mode=Rc;break;case 3:e.msg="invalid block type",r.mode=je}l>>>=2,h-=2;break;case Ic:for(l>>>=h&7,h-=h&7;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=je;break}if(r.length=l&65535,l=0,h=0,r.mode=Ra,t===an)break e;case Ra:r.mode=Dc;case Dc:if(d=r.length,d){if(d>o&&(d=o),d>c&&(d=c),d===0)break e;Xe.arraySet(a,i,n,d,s),o-=d,n+=d,c-=d,s+=d,r.length-=d;break}r.mode=wt;break;case Rc:for(;h<14;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.nlen=(l&31)+257,l>>>=5,h-=5,r.ndist=(l&31)+1,l>>>=5,h-=5,r.ncode=(l&15)+4,l>>>=4,h-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=je;break}r.have=0,r.mode=Bc;case Bc:for(;r.have<r.ncode;){for(;h<3;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.lens[w[r.have++]]=l&7,l>>>=3,h-=3}for(;r.have<19;)r.lens[w[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,N={bits:r.lenbits},Y=pi(db,r.lens,0,19,r.lencode,0,r.work,N),r.lenbits=N.bits,Y){e.msg="invalid code lengths set",r.mode=je;break}r.have=0,r.mode=Nc;case Nc:for(;r.have<r.nlen+r.ndist;){for(;!(y=r.lencode[l&(1<<r.lenbits)-1],S=y>>>24,B=y>>>16&255,W=y&65535,S<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(W<16)l>>>=S,h-=S,r.lens[r.have++]=W;else{if(W===16){for(k=S+2;h<k;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l>>>=S,h-=S,r.have===0){e.msg="invalid bit length repeat",r.mode=je;break}V=r.lens[r.have-1],d=3+(l&3),l>>>=2,h-=2}else if(W===17){for(k=S+3;h<k;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=S,h-=S,V=0,d=3+(l&7),l>>>=3,h-=3}else{for(k=S+7;h<k;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=S,h-=S,V=0,d=11+(l&127),l>>>=7,h-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=je;break}for(;d--;)r.lens[r.have++]=V}}if(r.mode===je)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=je;break}if(r.lenbits=9,N={bits:r.lenbits},Y=pi(bc,r.lens,0,r.nlen,r.lencode,0,r.work,N),r.lenbits=N.bits,Y){e.msg="invalid literal/lengths set",r.mode=je;break}if(r.distbits=6,r.distcode=r.distdyn,N={bits:r.distbits},Y=pi(gc,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,N),r.distbits=N.bits,Y){e.msg="invalid distances set",r.mode=je;break}if(r.mode=sn,t===an)break e;case sn:r.mode=ln;case ln:if(o>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,fb(e,f),s=e.next_out,a=e.output,c=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,r.mode===wt&&(r.back=-1);break}for(r.back=0;!(y=r.lencode[l&(1<<r.lenbits)-1],S=y>>>24,B=y>>>16&255,W=y&65535,S<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(B&&(B&240)===0){for(X=S,P=B,J=W;!(y=r.lencode[J+((l&(1<<X+P)-1)>>X)],S=y>>>24,B=y>>>16&255,W=y&65535,X+S<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=X,h-=X,r.back+=X}if(l>>>=S,h-=S,r.back+=S,r.length=W,B===0){r.mode=zc;break}if(B&32){r.back=-1,r.mode=wt;break}if(B&64){e.msg="invalid literal/length code",r.mode=je;break}r.extra=B&15,r.mode=Lc;case Lc:if(r.extra){for(k=r.extra;h<k;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Fc;case Fc:for(;!(y=r.distcode[l&(1<<r.distbits)-1],S=y>>>24,B=y>>>16&255,W=y&65535,S<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if((B&240)===0){for(X=S,P=B,J=W;!(y=r.distcode[J+((l&(1<<X+P)-1)>>X)],S=y>>>24,B=y>>>16&255,W=y&65535,X+S<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=X,h-=X,r.back+=X}if(l>>>=S,h-=S,r.back+=S,B&64){e.msg="invalid distance code",r.mode=je;break}r.offset=W,r.extra=B&15,r.mode=Pc;case Pc:if(r.extra){for(k=r.extra;h<k;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=je;break}r.mode=Mc;case Mc:if(c===0)break e;if(d=f-c,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=je;break}d>r.wnext?(d-=r.wnext,b=r.wsize-d):b=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=a,b=s-r.offset,d=r.length;d>c&&(d=c),c-=d,r.length-=d;do a[s++]=g[b++];while(--d);r.length===0&&(r.mode=ln);break;case zc:if(c===0)break e;a[s++]=r.length,c--,r.mode=ln;break;case Ba:if(r.wrap){for(;h<32;){if(o===0)break e;o--,l|=i[n++]<<h,h+=8}if(f-=c,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?mt(r.check,a,f,s-f):Aa(r.check,a,f,s-f)),f=c,(r.flags?l:Gc(l))!==r.check){e.msg="incorrect data check",r.mode=je;break}l=0,h=0}r.mode=Uc;case Uc:if(r.wrap&&r.flags){for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=je;break}l=0,h=0}r.mode=Wc;case Wc:Y=mb;break e;case je:Y=yc;break e;case Na:return Ia;case vb:default:return qe}return e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,(r.wsize||f!==e.avail_out&&r.mode<je&&(r.mode<Ba||t!==vc))&&qc(e,e.output,e.next_out,f-e.avail_out)?(r.mode=Na,Ia):(u-=e.avail_in,f-=e.avail_out,e.total_in+=u,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?mt(r.check,a,f,e.next_out-f):Aa(r.check,a,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===wt?128:0)+(r.mode===sn||r.mode===Ra?256:0),(u===0&&f===0||t===vc)&&Y===rr&&(Y=gb),Y)}function jb(e){if(!e||!e.state)return qe;var t=e.state;return t.window&&(t.window=null),e.state=null,rr}function kb(e,t){var r;return!e||!e.state?qe:(r=e.state,(r.wrap&2)===0?qe:(r.head=t,t.done=!1,rr))}function Eb(e,t){var r=t.length,i,a,n;return!e||!e.state?qe:(i=e.state,i.wrap!==0&&i.mode!==on?qe:i.mode===on&&(a=1,a=Aa(a,t,r,0),a!==i.check)?yc:(n=qc(e,t,r,r),n?(i.mode=Na,Ia):(i.havedict=1,rr)))}tt.inflateReset=Vc;tt.inflateReset2=Xc;tt.inflateResetKeep=Hc;tt.inflateInit=Tb;tt.inflateInit2=Yc;tt.inflate=Cb;tt.inflateEnd=jb;tt.inflateGetHeader=kb;tt.inflateSetDictionary=Eb;tt.inflateInfo="pako inflate (from Nodeca project)"}),Pa=ue((wy,Kc)=>{"use strict";Kc.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),Qc=ue((_y,Jc)=>{"use strict";function Ab(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}Jc.exports=Ab}),th=ue(mi=>{"use strict";var Tr=Zc(),bi=vt(),cn=xa(),Ee=Pa(),Ma=qi(),Ib=Ta(),Db=Qc(),eh=Object.prototype.toString;function ir(e){if(!(this instanceof ir))return new ir(e);this.options=bi.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&((t.windowBits&15)===0&&(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ib,this.strm.avail_out=0;var r=Tr.inflateInit2(this.strm,t.windowBits);if(r!==Ee.Z_OK)throw new Error(Ma[r]);if(this.header=new Db,Tr.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=cn.string2buf(t.dictionary):eh.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Tr.inflateSetDictionary(this.strm,t.dictionary),r!==Ee.Z_OK)))throw new Error(Ma[r])}ir.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,a=this.options.dictionary,n,s,o,c,l,h=!1;if(this.ended)return!1;s=t===~~t?t:t===!0?Ee.Z_FINISH:Ee.Z_NO_FLUSH,typeof e=="string"?r.input=cn.binstring2buf(e):eh.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new bi.Buf8(i),r.next_out=0,r.avail_out=i),n=Tr.inflate(r,Ee.Z_NO_FLUSH),n===Ee.Z_NEED_DICT&&a&&(n=Tr.inflateSetDictionary(this.strm,a)),n===Ee.Z_BUF_ERROR&&h===!0&&(n=Ee.Z_OK,h=!1),n!==Ee.Z_STREAM_END&&n!==Ee.Z_OK)return this.onEnd(n),this.ended=!0,!1;r.next_out&&((r.avail_out===0||n===Ee.Z_STREAM_END||r.avail_in===0&&(s===Ee.Z_FINISH||s===Ee.Z_SYNC_FLUSH))&&(this.options.to==="string"?(o=cn.utf8border(r.output,r.next_out),c=r.next_out-o,l=cn.buf2string(r.output,o),r.next_out=c,r.avail_out=i-c,c&&bi.arraySet(r.output,r.output,o,c,0),this.onData(l)):this.onData(bi.shrinkBuf(r.output,r.next_out)))),r.avail_in===0&&r.avail_out===0&&(h=!0)}while((r.avail_in>0||r.avail_out===0)&&n!==Ee.Z_STREAM_END);return n===Ee.Z_STREAM_END&&(s=Ee.Z_FINISH),s===Ee.Z_FINISH?(n=Tr.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Ee.Z_OK):(s===Ee.Z_SYNC_FLUSH&&(this.onEnd(Ee.Z_OK),r.avail_out=0),!0)};ir.prototype.onData=function(e){this.chunks.push(e)};ir.prototype.onEnd=function(e){e===Ee.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=bi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function za(e,t){var r=new ir(t);if(r.push(e,!0),r.err)throw r.msg||Ma[r.err];return r.result}function Rb(e,t){return t=t||{},t.raw=!0,za(e,t)}mi.Inflate=ir;mi.inflate=za;mi.inflateRaw=Rb;mi.ungzip=za}),nh=ue((xy,rh)=>{"use strict";var Bb=vt().assign,Nb=oc(),Lb=th(),Fb=Pa(),ih={};Bb(ih,Nb,Lb,Fb);rh.exports=ih}),oh=ue(hn=>{"use strict";var Pb=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",Mb=nh(),ah=Ce(),un=Ve(),zb=Pb?"uint8array":"array";hn.magic="\b\0";function nr(e,t){un.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}ah.inherits(nr,un);nr.prototype.processChunk=function(e){this.meta=e.meta,this._pako===null&&this._createPako(),this._pako.push(ah.transformTo(zb,e.data),!1)};nr.prototype.flush=function(){un.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)};nr.prototype.cleanUp=function(){un.prototype.cleanUp.call(this),this._pako=null};nr.prototype._createPako=function(){this._pako=new Mb[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}};hn.compressWorker=function(e){return new nr("Deflate",e)};hn.uncompressWorker=function(){return new nr("Inflate",{})}}),Wa=ue(Ua=>{"use strict";var sh=Ve();Ua.STORE={magic:"\0\0",compressWorker:function(e){return new sh("STORE compression")},uncompressWorker:function(){return new sh("STORE decompression")}};Ua.DEFLATE=oh()}),Ga=ue(ar=>{"use strict";ar.LOCAL_FILE_HEADER="PK";ar.CENTRAL_FILE_HEADER="PK";ar.CENTRAL_DIRECTORY_END="PK";ar.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07";ar.ZIP64_CENTRAL_DIRECTORY_END="PK";ar.DATA_DESCRIPTOR="PK\x07\b"}),uh=ue((jy,lh)=>{"use strict";var Or=Ce(),Cr=Ve(),Ha=$t(),ch=Hi(),fn=Ga(),Oe=function(e,t){var r="",i;for(i=0;i<t;i++)r+=String.fromCharCode(e&255),e=e>>>8;return r},Ub=function(e,t){var r=e;return e||(r=t?16893:33204),(r&65535)<<16},Wb=function(e,t){return(e||0)&63},hh=function(e,t,r,i,a,n){var s=e.file,o=e.compression,c=n!==Ha.utf8encode,l=Or.transformTo("string",n(s.name)),h=Or.transformTo("string",Ha.utf8encode(s.name)),u=s.comment,f=Or.transformTo("string",n(u)),d=Or.transformTo("string",Ha.utf8encode(u)),b=h.length!==s.name.length,g=d.length!==u.length,y,S,B="",W="",X="",P=s.dir,J=s.date,V={crc32:0,compressedSize:0,uncompressedSize:0};(!t||r)&&(V.crc32=e.crc32,V.compressedSize=e.compressedSize,V.uncompressedSize=e.uncompressedSize);var Y=0;t&&(Y|=8),!c&&(b||g)&&(Y|=2048);var R=0,N=0;P&&(R|=16),a==="UNIX"?(N=798,R|=Ub(s.unixPermissions,P)):(N=20,R|=Wb(s.dosPermissions,P)),y=J.getUTCHours(),y=y<<6,y=y|J.getUTCMinutes(),y=y<<5,y=y|J.getUTCSeconds()/2,S=J.getUTCFullYear()-1980,S=S<<4,S=S|J.getUTCMonth()+1,S=S<<5,S=S|J.getUTCDate(),b&&(W=Oe(1,1)+Oe(ch(l),4)+h,B+="up"+Oe(W.length,2)+W),g&&(X=Oe(1,1)+Oe(ch(f),4)+d,B+="uc"+Oe(X.length,2)+X);var k="";k+=`
\0`,k+=Oe(Y,2),k+=o.magic,k+=Oe(y,2),k+=Oe(S,2),k+=Oe(V.crc32,4),k+=Oe(V.compressedSize,4),k+=Oe(V.uncompressedSize,4),k+=Oe(l.length,2),k+=Oe(B.length,2);var w=fn.LOCAL_FILE_HEADER+k+l+B,E=fn.CENTRAL_FILE_HEADER+Oe(N,2)+k+Oe(f.length,2)+"\0\0\0\0"+Oe(R,4)+Oe(i,4)+l+B+f;return{fileRecord:w,dirRecord:E}},Gb=function(e,t,r,i,a){var n="",s=Or.transformTo("string",a(i));return n=fn.CENTRAL_DIRECTORY_END+"\0\0\0\0"+Oe(e,2)+Oe(e,2)+Oe(t,4)+Oe(r,4)+Oe(s.length,2)+s,n},Hb=function(e){var t="";return t=fn.DATA_DESCRIPTOR+Oe(e.crc32,4)+Oe(e.compressedSize,4)+Oe(e.uncompressedSize,4),t};function rt(e,t,r,i){Cr.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}Or.inherits(rt,Cr);rt.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,Cr.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))};rt.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=hh(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0};rt.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=hh(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:Hb(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null};rt.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=Gb(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})};rt.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()};rt.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(r){t.error(r)}),this};rt.prototype.resume=function(){if(!Cr.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0};rt.prototype.error=function(e){var t=this._sources;if(!Cr.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(i){}return!0};rt.prototype.lock=function(){Cr.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()};lh.exports=rt}),dh=ue(fh=>{"use strict";var Vb=Wa(),Xb=uh(),Yb=function(e,t){var r=e||t,i=Vb[r];if(!i)throw new Error(r+" is not a valid compression method !");return i};fh.generateWorker=function(e,t,r){var i=new Xb(t.streamFiles,r,t.platform,t.encodeFileName),a=0;try{e.forEach(function(n,s){a++;var o=Yb(s.options.compression,t.compression),c=s.options.compressionOptions||t.compressionOptions||{},l=s.dir,h=s.date;s._compressWorker(o,c).withStreamInfo("file",{name:n,dir:l,date:h,comment:s.comment||"",unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions}).pipe(i)}),i.entriesCount=a}catch(n){i.error(n)}return i}}),mh=ue((Ey,ph)=>{"use strict";var $b=Ce(),dn=Ve();function gi(e,t){dn.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}$b.inherits(gi,dn);gi.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(r){t.push({data:r,meta:{percent:0}})}).on("error",function(r){t.isPaused?this.generatedError=r:t.error(r)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})};gi.prototype.pause=function(){return dn.prototype.pause.call(this)?(this._stream.pause(),!0):!1};gi.prototype.resume=function(){return dn.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1};ph.exports=gi}),Oh=ue((Ay,bh)=>{"use strict";var qb=$t(),vi=Ce(),gh=Ve(),Zb=$n(),vh=qn(),yh=Xi(),Kb=gl(),Jb=dh(),wh=$r(),Qb=mh(),xh=function(e,t,r){var i=vi.getTypeOf(t),a,n=vi.extend(r||{},vh);n.date=n.date||new Date,n.compression!==null&&(n.compression=n.compression.toUpperCase()),typeof n.unixPermissions=="string"&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&n.unixPermissions&16384&&(n.dir=!0),n.dosPermissions&&n.dosPermissions&16&&(n.dir=!0),n.dir&&(e=_h(e)),n.createFolders&&(a=eg(e))&&Sh.call(this,a,!0);var s=i==="string"&&n.binary===!1&&n.base64===!1;(!r||typeof r.binary=="undefined")&&(n.binary=!s);var o=t instanceof yh&&t.uncompressedSize===0;(o||n.dir||!t||t.length===0)&&(n.base64=!1,n.binary=!0,t="",n.compression="STORE",i="string");var c=null;t instanceof yh||t instanceof gh?c=t:wh.isNode&&wh.isStream(t)?c=new Qb(e,t):c=vi.prepareContent(e,t,n.binary,n.optimizedBinaryString,n.base64);var l=new Kb(e,c,n);this.files[e]=l},eg=function(e){e.slice(-1)==="/"&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},_h=function(e){return e.slice(-1)!=="/"&&(e+="/"),e},Sh=function(e,t){return t=typeof t!="undefined"?t:vh.createFolders,e=_h(e),this.files[e]||xh.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function Th(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var tg={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files){if(!this.files.hasOwnProperty(t))continue;i=this.files[t],r=t.slice(this.root.length,t.length),r&&t.slice(0,this.root.length)===this.root&&e(r,i)}},filter:function(e){var t=[];return this.forEach(function(r,i){e(r,i)&&t.push(i)}),t},file:function(e,t,r){if(arguments.length===1)if(Th(e)){var i=e;return this.filter(function(n,s){return!s.dir&&i.test(n)})}else{var a=this.files[this.root+e];return a&&!a.dir?a:null}else e=this.root+e,xh.call(this,e,t,r);return this},folder:function(e){if(!e)return this;if(Th(e))return this.filter(function(a,n){return n.dir&&e.test(a)});var t=this.root+e,r=Sh.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||(e.slice(-1)!=="/"&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(a,n){return n.name.slice(0,e.length)===e}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if(r=vi.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:qb.utf8encode}),r.type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),r.type==="binarystring"&&(r.type="string"),!r.type)throw new Error("No output type specified.");vi.checkSupport(r.type),(r.platform==="darwin"||r.platform==="freebsd"||r.platform==="linux"||r.platform==="sunos")&&(r.platform="UNIX"),r.platform==="win32"&&(r.platform="DOS");var i=r.comment||this.comment||"";t=Jb.generateWorker(this,r,i)}catch(a){t=new gh("error"),t.error(a)}return new Zb(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};bh.exports=tg}),Va=ue((Iy,Ch)=>{"use strict";var rg=Ce();function jh(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}jh.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,r;for(this.checkOffset(e),r=this.index+e-1;r>=this.index;r--)t=(t<<8)+this.byteAt(r);return this.index+=e,t},readString:function(e){return rg.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))}};Ch.exports=jh}),Xa=ue((Dy,kh)=>{"use strict";var Eh=Va(),ig=Ce();function jr(e){Eh.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=e[t]&255}ig.inherits(jr,Eh);jr.prototype.byteAt=function(e){return this.data[this.zero+e]};jr.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),a=e.charCodeAt(3),n=this.length-4;n>=0;--n)if(this.data[n]===t&&this.data[n+1]===r&&this.data[n+2]===i&&this.data[n+3]===a)return n-this.zero;return-1};jr.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),a=e.charCodeAt(3),n=this.readData(4);return t===n[0]&&r===n[1]&&i===n[2]&&a===n[3]};jr.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};kh.exports=jr}),Dh=ue((Ry,Ah)=>{"use strict";var Ih=Va(),ng=Ce();function kr(e){Ih.call(this,e)}ng.inherits(kr,Ih);kr.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)};kr.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero};kr.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t};kr.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Ah.exports=kr}),$a=ue((By,Rh)=>{"use strict";var Bh=Xa(),ag=Ce();function Ya(e){Bh.call(this,e)}ag.inherits(Ya,Bh);Ya.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Rh.exports=Ya}),Fh=ue((Ny,Nh)=>{"use strict";var Lh=$a(),og=Ce();function qa(e){Lh.call(this,e)}og.inherits(qa,Lh);qa.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Nh.exports=qa}),Za=ue((Ly,Ph)=>{"use strict";var pn=Ce(),Mh=gt(),sg=Xa(),lg=Dh(),cg=Fh(),hg=$a();Ph.exports=function(e){var t=pn.getTypeOf(e);return pn.checkSupport(t),t==="string"&&!Mh.uint8array?new lg(e):t==="nodebuffer"?new cg(e):Mh.uint8array?new hg(pn.transformTo("uint8array",e)):new sg(pn.transformTo("array",e))}}),Gh=ue((Fy,zh)=>{"use strict";var Ka=Za(),Lt=Ce(),ug=Xi(),Uh=Hi(),mn=$t(),bn=Wa(),fg=gt(),dg=0,pg=3,mg=function(e){for(var t in bn){if(!bn.hasOwnProperty(t))continue;if(bn[t].magic===e)return bn[t]}return null};function Wh(e,t){this.options=e,this.loadOptions=t}Wh.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=mg(this.compressionMethod),t===null)throw new Error("Corrupted zip : compression "+Lt.pretty(this.compressionMethod)+" unknown (inner file : "+Lt.transformTo("string",this.fileName)+")");this.decompressed=new ug(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),e===dg&&(this.dosPermissions=this.externalFileAttributes&63),e===pg&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(e){if(!this.extraFields[1])return;var t=Ka(this.extraFields[1].value);this.uncompressedSize===Lt.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===Lt.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===Lt.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===Lt.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,r,i,a;for(this.extraFields||(this.extraFields={});e.index+4<t;)r=e.readInt(2),i=e.readInt(2),a=e.readData(i),this.extraFields[r]={id:r,length:i,value:a};e.setIndex(t)},handleUTF8:function(){var e=fg.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=mn.utf8decode(this.fileName),this.fileCommentStr=mn.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(t!==null)this.fileNameStr=t;else{var r=Lt.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(i!==null)this.fileCommentStr=i;else{var a=Lt.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=Ka(e.value);return t.readInt(1)!==1||Uh(this.fileName)!==t.readInt(4)?null:mn.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=Ka(e.value);return t.readInt(1)!==1||Uh(this.fileComment)!==t.readInt(4)?null:mn.utf8decode(t.readData(e.length-5))}return null}};zh.exports=Wh}),Xh=ue((My,Hh)=>{"use strict";var bg=Za(),_t=Ce(),it=Ga(),gg=Gh(),Py=$t(),vg=gt();function Vh(e){this.files=[],this.loadOptions=e}Vh.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+_t.pretty(t)+", expected "+_t.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),a=i===t;return this.reader.setIndex(r),a},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=vg.uint8array?"uint8array":"array",r=_t.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,r,i,a;t<e;)r=this.reader.readInt(2),i=this.reader.readInt(4),a=this.reader.readData(i),this.zip64ExtensibleData[r]={id:r,length:i,value:a}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(it.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(it.CENTRAL_FILE_HEADER);)e=new gg({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(it.CENTRAL_DIRECTORY_END);if(e<0){var t=!this.isSignature(0,it.LOCAL_FILE_HEADER);throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var r=e;if(this.checkSignature(it.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===_t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===_t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===_t.MAX_VALUE_16BITS||this.centralDirRecords===_t.MAX_VALUE_16BITS||this.centralDirSize===_t.MAX_VALUE_32BITS||this.centralDirOffset===_t.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(it.ZIP64_CENTRAL_DIRECTORY_LOCATOR),e<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(it.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,it.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(it.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(it.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var a=r-i;if(a>0)this.isSignature(r,it.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(a<0)throw new Error("Corrupted zip: missing "+Math.abs(a)+" bytes.")},prepareReader:function(e){this.reader=bg(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};Hh.exports=Vh}),qh=ue((zy,Yh)=>{"use strict";var Ja=Ce(),gn=ur(),yg=$t(),Ja=Ce(),wg=Xh(),_g=ta(),$h=$r();function Sg(e){return new gn.Promise(function(t,r){var i=e.decompressed.getContentWorker().pipe(new _g);i.on("error",function(a){r(a)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}Yh.exports=function(e,t){var r=this;return t=Ja.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:yg.utf8decode}),$h.isNode&&$h.isStream(e)?gn.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):Ja.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(i){var a=new wg(t);return a.load(i),a}).then(function(a){var n=[gn.Promise.resolve(a)],s=a.files;if(t.checkCRC32)for(var o=0;o<s.length;o++)n.push(Sg(s[o]));return gn.Promise.all(n)}).then(function(a){for(var n=a.shift(),s=n.files,o=0;o<s.length;o++){var c=s[o];r.file(c.fileNameStr,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r})}}),Kh=ue((Uy,Zh)=>{"use strict";function Ze(){if(!(this instanceof Ze))return new Ze;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new Ze;for(var t in this)typeof this[t]!="function"&&(e[t]=this[t]);return e}}Ze.prototype=Oh();Ze.prototype.loadAsync=qh();Ze.support=gt();Ze.defaults=qn();Ze.version="3.5.0";Ze.loadAsync=function(e,t){return new Ze().loadAsync(e,t)};Ze.external=ur();Zh.exports=Ze}),lu=ue((rw,su)=>{su.exports=function(){"use strict";function e(i,a){function n(){this.constructor=i}n.prototype=a.prototype,i.prototype=new n}function t(i,a,n,s){this.message=i,this.expected=a,this.found=n,this.location=s,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,t)}e(t,Error),t.buildMessage=function(i,a){var n={literal:function(f){return'"'+o(f.text)+'"'},class:function(f){var d="",b;for(b=0;b<f.parts.length;b++)d+=f.parts[b]instanceof Array?c(f.parts[b][0])+"-"+c(f.parts[b][1]):c(f.parts[b]);return"["+(f.inverted?"^":"")+d+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function s(f){return f.charCodeAt(0).toString(16).toUpperCase()}function o(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function l(f){return n[f.type](f)}function h(f){var d=new Array(f.length),b,g;for(b=0;b<f.length;b++)d[b]=l(f[b]);if(d.sort(),d.length>0){for(b=1,g=1;b<d.length;b++)d[b-1]!==d[b]&&(d[g]=d[b],g++);d.length=g}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function u(f){return f?'"'+o(f)+'"':"end of input"}return"Expected "+h(i)+" but "+u(a)+" found."};function r(i,a){a=a!==void 0?a:{};var n={},s={Code:ms},o=ms,c=function(m){return m},l=function(m){return m.filter(_=>_)},h=ke("if(<condition>)"),u="if",f=be("if",!0),d=function(m){return{type:"if",expr:m}},b="else",g=be("else",!0),y=function(m){return m},S=function(m){return{type:"else",then:m}},B="endif",W=be("endif",!0),X=function(m){return{type:"endif",then:m}},P="break",J=be("break",!0),V=function(){return{type:"break"}},Y=ke("while(<condition>)"),R="while",N=be("while",!0),k=function(m){return{type:"while",expr:m}},w="endwhile",E=be("endwhile",!0),I=function(){return{type:"endwhile"}},O="do",ie=be("do",!0),x=function(){return{type:"do"}},C=ke("until(<condition>)"),D="until",L=be("until",!0),K=function(m){return{type:"until",expr:m}},q="endswitch",Q=be("endswitch",!0),ee=function(){return{type:"endswitch"}},M="switch",A=be("switch",!0),G=function(){return{type:"switch"}},Z=ke("case(<condition>)"),$="case",te=be("case",!0),ne=function(m,_){return _},fe=function(m,_){return{type:"case",expr:m,then:_}},me="default",oe=be("default",!0),se=function(m){return{type:"default",then:m}},ce="function",ve=be("function",!0),xe=function(){return{type:"function"}},Ie=ke("return <var name>"),Be="return",Ue=be("return",!0),Ae=function(m){return{type:"return",to:m}},sr=function(m,_){return _},lr=function(m,_,j){return{type:"varsDec",datatype:m,modifiers:_,names:j}},En=ke("assigment operator"),Gr=":=",Hr=be(":=",!1),Ii="::=",An=be("::=",!1),Zu=function(m,_,j){return{type:_,to:m,operand:j}},Ku=ke("equality operator"),Ju="=",Qu=be("=",!1),ef=function(m,_,j){return{type:_,first:m,second:j}},tf=ke("function call"),Do="(",Ro=be("(",!1),In=")",Dn=be(")",!1),rf=function(m,_){return{type:"call",name:m,args:_}},nf=ke("function call chain"),Bo=function(m,_){return _},af=function(m,_){return{type:"callChain",functions:[m].concat(_)}},of=ke("unary operator"),sf=function(m,_){return{type:m,operand:_}},No=ke("expression"),Lo=function(m){return{type:"expression",body:m}},lf=ke("constant"),Fo='"',Po=be('"',!1),Mo=/^[^"]/,zo=ot(['"'],!0,!1),Uo="'",Wo=be("'",!1),Go=/^[^']/,Ho=ot(["'"],!0,!1),cf=/^[\-+]/,hf=ot(["-","+"],!1,!1),uf=/^[0-9.]/,ff=ot([["0","9"],"."],!1,!1),Vo=/^[0-9.e]/,Xo=ot([["0","9"],".","e"],!1,!1),df="#",pf=be("#",!1),Yo=/^[0-9]/,$o=ot([["0","9"]],!1,!1),mf=function(m){return{type:"const",value:m}},bf=function(m){return{type:"var",name:m}},gf=ke("valid function name"),qo="-",Zo=be("-",!1),Ko="+",Jo=be("+",!1),vf="!",yf=be("!",!1),wf="^",_f=be("^",!1),Sf=function(){return"**"},xf="*",Tf=be("*",!1),Of="/",Cf=be("/",!1),jf="%",kf=be("%",!1),Qo=">>",Ef=be(">>",!1),es=">=",Af=be(">=",!1),If=">",Df=be(">",!1),ts="<<",Rf=be("<<",!1),rs="<=",Bf=be("<=",!1),Nf="<",Lf=be("<",!1),is="==",Ff=be("==",!1),ns="!=",Pf=be("!=",!1),as="&&",Mf=be("&&",!1),zf="&",Uf=be("&",!1),os="||",Wf=be("||",!1),Gf="|",Hf=be("|",!1),Vf=ke("operand"),ss=function(m,_,j){return{action:_,op:j}},Xf=function(m,_){return{first:m,rest:_}},Yf=ke("operator"),$f="~",qf=be("~",!1),Zf=function(m,_){return le(le({},_),{isNew:!!m})},Kf="handle",Jf=be("HANDLE",!0),Qf="string",ed=be("STRING",!0),td="float",rd=be("FLOAT",!0),id="colorref",nd=be("COLORREF",!0),ad="integer",od=be("INTEGER",!0),sd="local",ld=be("LOCAL",!0),cd="nosave",hd=be("NOSAVE",!0),ud="parameter",fd=be("PARAMETER",!0),Rn=",",Bn=be(",",!1),ls=function(m,_){return _},dd=function(m,_){return[m].concat(_)},pd=ke("variable name"),cs=/^[_a-z\u0430-\u044F0-9]/i,hs=ot(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),md=ke("space or tab"),bd=/^[ \t]/,gd=ot([" ","	"],!1,!1),vd=ke("new line"),yd=/^[\n]/,wd=ot([`
`],!1,!1),_d=ke("whitespace"),us=/^[ \t\n\r]/,fs=ot([" ","	",`
`,"\r"],!1,!1),Sd=ke("if !<condition>)"),v=0,ge=0,Di=[{line:1,column:1}],at=0,Nn=[],z=0,Ri;if("startRule"in a){if(!(a.startRule in s))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');o=s[a.startRule]}function Dv(){return i.substring(ge,v)}function Rv(){return Vr(ge,v)}function Bv(m,_){throw _=_!==void 0?_:Vr(ge,v),ps([ke(m)],i.substring(ge,v),_)}function Nv(m,_){throw _=_!==void 0?_:Vr(ge,v),Td(m,_)}function be(m,_){return{type:"literal",text:m,ignoreCase:_}}function ot(m,_,j){return{type:"class",parts:m,inverted:_,ignoreCase:j}}function Lv(){return{type:"any"}}function xd(){return{type:"end"}}function ke(m){return{type:"other",description:m}}function ds(m){var _=Di[m],j;if(_)return _;for(j=m-1;!Di[j];)j--;for(_=Di[j],_={line:_.line,column:_.column};j<m;)i.charCodeAt(j)===10?(_.line++,_.column=1):_.column++,j++;return Di[m]=_,_}function Vr(m,_){var j=ds(m),T=ds(_);return{start:{offset:m,line:j.line,column:j.column},end:{offset:_,line:T.line,column:T.column}}}function re(m){if(v<at)return;v>at&&(at=v,Nn=[]),Nn.push(m)}function Td(m,_){return new t(m,null,null,_)}function ps(m,_,j){return new t(t.buildMessage(m,_),m,_,j)}function ms(){var m,_,j,T,F,U,pe;for(m=v,_=[],j=v,T=[],F=de();F!==n;)T.push(F),F=de();if(T!==n)if(F=cr(),F===n&&(F=null),F!==n){for(U=[],pe=de();pe!==n;)U.push(pe),pe=de();U!==n?(pe=ys(),pe!==n?(ge=j,T=c(F),j=T):(v=j,j=n)):(v=j,j=n)}else v=j,j=n;else v=j,j=n;for(;j!==n;){for(_.push(j),j=v,T=[],F=de();F!==n;)T.push(F),F=de();if(T!==n)if(F=cr(),F===n&&(F=null),F!==n){for(U=[],pe=de();pe!==n;)U.push(pe),pe=de();U!==n?(pe=ys(),pe!==n?(ge=j,T=c(F),j=T):(v=j,j=n)):(v=j,j=n)}else v=j,j=n;else v=j,j=n}return _!==n&&(ge=m,_=l(_)),m=_,m}function cr(){var m;return m=zd(),m===n&&(m=Ud(),m===n&&(m=Wd(),m===n&&(m=Od(),m===n&&(m=jd(),m===n&&(m=kd(),m===n&&(m=Ed(),m===n&&(m=Ad(),m===n&&(m=Id(),m===n&&(m=Dd(),m===n&&(m=Rd(),m===n&&(m=Bd(),m===n&&(m=Nd(),m===n&&(m=Ld(),m===n&&(m=Fd(),m===n&&(m=Gd(),m===n&&(m=Pd(),m===n&&(m=Md()))))))))))))))))),m}function Od(){var m;return m=Cd(),m===n&&(m=Kd()),m}function Cd(){var m,_,j,T;return z++,m=v,i.substr(v,2).toLowerCase()===u?(_=i.substr(v,2),v+=2):(_=n,z===0&&re(f)),_!==n?(j=We(),j!==n?(T=Xr(),T!==n?(ge=m,_=d(T),m=_):(v=m,m=n)):(v=m,m=n)):(v=m,m=n),z--,m===n&&(_=n,z===0&&re(h)),m}function jd(){var m,_,j,T,F;if(m=v,i.substr(v,4).toLowerCase()===b?(_=i.substr(v,4),v+=4):(_=n,z===0&&re(g)),_!==n){if(j=v,T=[],F=de(),F!==n)for(;F!==n;)T.push(F),F=de();else T=n;T!==n?(F=cr(),F!==n?(ge=j,T=y(F),j=T):(v=j,j=n)):(v=j,j=n),j===n&&(j=null),j!==n?(ge=m,_=S(j),m=_):(v=m,m=n)}else v=m,m=n;return m}function kd(){var m,_,j,T,F;if(m=v,i.substr(v,5).toLowerCase()===B?(_=i.substr(v,5),v+=5):(_=n,z===0&&re(W)),_!==n){if(j=v,T=[],F=de(),F!==n)for(;F!==n;)T.push(F),F=de();else T=n;T!==n?(F=cr(),F!==n?(ge=j,T=y(F),j=T):(v=j,j=n)):(v=j,j=n),j===n&&(j=null),j!==n?(ge=m,_=X(j),m=_):(v=m,m=n)}else v=m,m=n;return m}function Ed(){var m,_;return m=v,i.substr(v,5).toLowerCase()===P?(_=i.substr(v,5),v+=5):(_=n,z===0&&re(J)),_!==n&&(ge=m,_=V()),m=_,m}function Ad(){var m,_,j,T;return z++,m=v,i.substr(v,5).toLowerCase()===R?(_=i.substr(v,5),v+=5):(_=n,z===0&&re(N)),_!==n?(j=We(),j!==n?(T=Xr(),T!==n?(ge=m,_=k(T),m=_):(v=m,m=n)):(v=m,m=n)):(v=m,m=n),z--,m===n&&(_=n,z===0&&re(Y)),m}function Id(){var m,_;return m=v,i.substr(v,8).toLowerCase()===w?(_=i.substr(v,8),v+=8):(_=n,z===0&&re(E)),_!==n&&(ge=m,_=I()),m=_,m}function Dd(){var m,_;return m=v,i.substr(v,2).toLowerCase()===O?(_=i.substr(v,2),v+=2):(_=n,z===0&&re(ie)),_!==n&&(ge=m,_=x()),m=_,m}function Rd(){var m,_,j,T;return z++,m=v,i.substr(v,5).toLowerCase()===D?(_=i.substr(v,5),v+=5):(_=n,z===0&&re(L)),_!==n?(j=We(),j!==n?(T=Xr(),T!==n?(ge=m,_=K(T),m=_):(v=m,m=n)):(v=m,m=n)):(v=m,m=n),z--,m===n&&(_=n,z===0&&re(C)),m}function Bd(){var m,_;return m=v,i.substr(v,9).toLowerCase()===q?(_=i.substr(v,9),v+=9):(_=n,z===0&&re(Q)),_!==n&&(ge=m,_=ee()),m=_,m}function Nd(){var m,_;return m=v,i.substr(v,6).toLowerCase()===M?(_=i.substr(v,6),v+=6):(_=n,z===0&&re(A)),_!==n&&(ge=m,_=G()),m=_,m}function Ld(){var m,_,j,T,F,U,pe;if(z++,m=v,i.substr(v,4).toLowerCase()===$?(_=i.substr(v,4),v+=4):(_=n,z===0&&re(te)),_!==n)if(j=We(),j!==n)if(T=Xr(),T!==n){if(F=v,U=[],pe=de(),pe!==n)for(;pe!==n;)U.push(pe),pe=de();else U=n;U!==n?(pe=cr(),pe!==n?(ge=F,U=ne(T,pe),F=U):(v=F,F=n)):(v=F,F=n),F===n&&(F=null),F!==n?(ge=m,_=fe(T,F),m=_):(v=m,m=n)}else v=m,m=n;else v=m,m=n;else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(Z)),m}function Fd(){var m,_,j,T,F;if(m=v,i.substr(v,7).toLowerCase()===me?(_=i.substr(v,7),v+=7):(_=n,z===0&&re(oe)),_!==n){if(j=v,T=[],F=de(),F!==n)for(;F!==n;)T.push(F),F=de();else T=n;T!==n?(F=cr(),F!==n?(ge=j,T=y(F),j=T):(v=j,j=n)):(v=j,j=n),j===n&&(j=null),j!==n?(ge=m,_=se(j),m=_):(v=m,m=n)}else v=m,m=n;return m}function Pd(){var m,_;return m=v,i.substr(v,8).toLowerCase()===ce?(_=i.substr(v,8),v+=8):(_=n,z===0&&re(ve)),_!==n&&(ge=m,_=xe()),m=_,m}function Md(){var m,_,j,T;return z++,m=v,i.substr(v,6).toLowerCase()===Be?(_=i.substr(v,6),v+=6):(_=n,z===0&&re(Ue)),_!==n?(j=We(),j!==n?(T=Xt(),T!==n?(ge=m,_=Ae(T),m=_):(v=m,m=n)):(v=m,m=n)):(v=m,m=n),z--,m===n&&(_=n,z===0&&re(Ie)),m}function zd(){var m,_,j,T,F,U,pe,we,st;if(m=v,_=qd(),_!==n){if(j=[],T=de(),T!==n)for(;T!==n;)j.push(T),T=de();else j=n;if(j!==n)if(T=We(),T!==n){if(F=[],U=v,pe=gs(),pe!==n){if(we=[],st=de(),st!==n)for(;st!==n;)we.push(st),st=de();else we=n;we!==n?(ge=U,pe=sr(_,pe),U=pe):(v=U,U=n)}else v=U,U=n;for(;U!==n;)if(F.push(U),U=v,pe=gs(),pe!==n){if(we=[],st=de(),st!==n)for(;st!==n;)we.push(st),st=de();else we=n;we!==n?(ge=U,pe=sr(_,pe),U=pe):(v=U,U=n)}else v=U,U=n;F!==n?(U=Zd(),U!==n?(ge=m,_=lr(_,F,U),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n}else v=m,m=n;return m}function Ud(){var m,_,j,T,F,U;if(z++,m=v,_=Xt(),_!==n)if(j=We(),j!==n)if(i.substr(v,2)===Gr?(T=Gr,v+=2):(T=n,z===0&&re(Hr)),T===n&&(i.substr(v,3)===Ii?(T=Ii,v+=3):(T=n,z===0&&re(An))),T!==n){for(F=[],U=de();U!==n;)F.push(U),U=de();F!==n?(U=Vt(),U!==n?(ge=m,_=Zu(_,T,U),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n;else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(En)),m}function Wd(){var m,_,j,T,F,U;if(z++,m=v,_=Vt(),_!==n)if(j=We(),j!==n)if(i.charCodeAt(v)===61?(T=Ju,v++):(T=n,z===0&&re(Qu)),T!==n){for(F=[],U=de();U!==n;)F.push(U),U=de();F!==n?(U=Vt(),U!==n?(ge=m,_=ef(_,T,U),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n;else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(Ku)),m}function Bi(){var m,_,j,T,F,U,pe,we;if(z++,m=v,_=Yd(),_!==n){for(j=[],T=de();T!==n;)j.push(T),T=de();if(j!==n)if(i.charCodeAt(v)===40?(T=Do,v++):(T=n,z===0&&re(Ro)),T!==n){for(F=[],U=de();U!==n;)F.push(U),U=de();if(F!==n){for(U=[],pe=vs();pe!==n;)U.push(pe),pe=vs();if(U!==n){for(pe=[],we=de();we!==n;)pe.push(we),we=de();pe!==n?(i.charCodeAt(v)===41?(we=In,v++):(we=n,z===0&&re(Dn)),we!==n?(ge=m,_=rf(_,U),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n}else v=m,m=n}else v=m,m=n;else v=m,m=n}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(tf)),m}function Gd(){var m,_,j,T,F,U;if(z++,m=v,_=Bi(),_!==n){if(j=[],T=v,F=[],U=de(),U!==n)for(;U!==n;)F.push(U),U=de();else F=n;for(F!==n?(U=Bi(),U!==n?(ge=T,F=Bo(_,U),T=F):(v=T,T=n)):(v=T,T=n);T!==n;){if(j.push(T),T=v,F=[],U=de(),U!==n)for(;U!==n;)F.push(U),U=de();else F=n;F!==n?(U=Bi(),U!==n?(ge=T,F=Bo(_,U),T=F):(v=T,T=n)):(v=T,T=n)}j!==n?(ge=m,_=af(_,j),m=_):(v=m,m=n)}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(nf)),m}function Hd(){var m,_,j,T;if(z++,m=v,_=$d(),_!==n){for(j=[],T=de();T!==n;)j.push(T),T=de();j!==n?(T=Vt(),T!==n?(ge=m,_=sf(_,T),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(of)),m}function Xr(){var m,_,j,T,F,U;if(z++,m=v,i.charCodeAt(v)===40?(_=Do,v++):(_=n,z===0&&re(Ro)),_!==n){for(j=[],T=de();T!==n;)j.push(T),T=de();if(j!==n)if(T=Vt(),T!==n){for(F=[],U=de();U!==n;)F.push(U),U=de();F!==n?(i.charCodeAt(v)===41?(U=In,v++):(U=n,z===0&&re(Dn)),U!==n?(ge=m,_=Lo(T),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(No)),m}function Vd(){var m,_,j,T,F,U,pe;if(z++,m=v,_=v,j=v,i.charCodeAt(v)===34?(T=Fo,v++):(T=n,z===0&&re(Po)),T!==n){for(F=[],Mo.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re(zo));U!==n;)F.push(U),Mo.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re(zo));F!==n?(i.charCodeAt(v)===34?(U=Fo,v++):(U=n,z===0&&re(Po)),U!==n?(T=[T,F,U],j=T):(v=j,j=n)):(v=j,j=n)}else v=j,j=n;if(j===n){if(j=v,i.charCodeAt(v)===39?(T=Uo,v++):(T=n,z===0&&re(Wo)),T!==n){for(F=[],Go.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re(Ho));U!==n;)F.push(U),Go.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re(Ho));F!==n?(i.charCodeAt(v)===39?(U=Uo,v++):(U=n,z===0&&re(Wo)),U!==n?(T=[T,F,U],j=T):(v=j,j=n)):(v=j,j=n)}else v=j,j=n;if(j===n){if(j=v,cf.test(i.charAt(v))?(T=i.charAt(v),v++):(T=n,z===0&&re(hf)),T===n&&(T=null),T!==n)if(uf.test(i.charAt(v))?(F=i.charAt(v),v++):(F=n,z===0&&re(ff)),F!==n){for(U=[],Vo.test(i.charAt(v))?(pe=i.charAt(v),v++):(pe=n,z===0&&re(Xo));pe!==n;)U.push(pe),Vo.test(i.charAt(v))?(pe=i.charAt(v),v++):(pe=n,z===0&&re(Xo));U!==n?(T=[T,F,U],j=T):(v=j,j=n)}else v=j,j=n;else v=j,j=n;if(j===n)if(j=v,i.charCodeAt(v)===35?(T=df,v++):(T=n,z===0&&re(pf)),T!==n){for(F=[],Yo.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re($o));U!==n;)F.push(U),Yo.test(i.charAt(v))?(U=i.charAt(v),v++):(U=n,z===0&&re($o));F!==n?(T=[T,F],j=T):(v=j,j=n)}else v=j,j=n}}return j!==n?_=i.substring(_,v):_=j,_!==n&&(ge=m,_=mf(_)),m=_,z--,m===n&&(_=n,z===0&&re(lf)),m}function Xd(){var m,_;return m=v,_=Xt(),_!==n&&(ge=m,_=bf(_)),m=_,m}function Yd(){var m,_;return z++,m=Xt(),z--,m===n&&(_=n,z===0&&re(gf)),m}function $d(){var m;return i.charCodeAt(v)===45?(m=qo,v++):(m=n,z===0&&re(Zo)),m===n&&(i.charCodeAt(v)===43?(m=Ko,v++):(m=n,z===0&&re(Jo)),m===n&&(i.charCodeAt(v)===33?(m=vf,v++):(m=n,z===0&&re(yf)))),m}function bs(){var m,_;return m=v,i.charCodeAt(v)===94?(_=wf,v++):(_=n,z===0&&re(_f)),_!==n&&(ge=m,_=Sf()),m=_,m===n&&(i.charCodeAt(v)===42?(m=xf,v++):(m=n,z===0&&re(Tf)),m===n&&(i.charCodeAt(v)===47?(m=Of,v++):(m=n,z===0&&re(Cf)),m===n&&(i.charCodeAt(v)===37?(m=jf,v++):(m=n,z===0&&re(kf)),m===n&&(i.charCodeAt(v)===43?(m=Ko,v++):(m=n,z===0&&re(Jo)),m===n&&(i.charCodeAt(v)===45?(m=qo,v++):(m=n,z===0&&re(Zo)),m===n&&(i.substr(v,2)===Qo?(m=Qo,v+=2):(m=n,z===0&&re(Ef)),m===n&&(i.substr(v,2)===es?(m=es,v+=2):(m=n,z===0&&re(Af)),m===n&&(i.charCodeAt(v)===62?(m=If,v++):(m=n,z===0&&re(Df)),m===n&&(i.substr(v,2)===ts?(m=ts,v+=2):(m=n,z===0&&re(Rf)),m===n&&(i.substr(v,2)===rs?(m=rs,v+=2):(m=n,z===0&&re(Bf)),m===n&&(i.charCodeAt(v)===60?(m=Nf,v++):(m=n,z===0&&re(Lf)),m===n&&(i.substr(v,2)===is?(m=is,v+=2):(m=n,z===0&&re(Ff)),m===n&&(i.substr(v,2)===ns?(m=ns,v+=2):(m=n,z===0&&re(Pf)),m===n&&(i.substr(v,2)===as?(m=as,v+=2):(m=n,z===0&&re(Mf)),m===n&&(i.charCodeAt(v)===38?(m=zf,v++):(m=n,z===0&&re(Uf)),m===n&&(i.substr(v,2)===os?(m=os,v+=2):(m=n,z===0&&re(Wf)),m===n&&(i.charCodeAt(v)===124?(m=Gf,v++):(m=n,z===0&&re(Hf))))))))))))))))))),m}function Vt(){var m,_,j,T,F,U,pe,we;if(z++,m=v,_=Ln(),_!==n){for(j=[],T=v,F=[],U=de();U!==n;)F.push(U),U=de();if(F!==n)if(U=bs(),U!==n){for(pe=[],we=de();we!==n;)pe.push(we),we=de();pe!==n?(we=Ln(),we!==n?(ge=T,F=ss(_,U,we),T=F):(v=T,T=n)):(v=T,T=n)}else v=T,T=n;else v=T,T=n;for(;T!==n;){for(j.push(T),T=v,F=[],U=de();U!==n;)F.push(U),U=de();if(F!==n)if(U=bs(),U!==n){for(pe=[],we=de();we!==n;)pe.push(we),we=de();pe!==n?(we=Ln(),we!==n?(ge=T,F=ss(_,U,we),T=F):(v=T,T=n)):(v=T,T=n)}else v=T,T=n;else v=T,T=n}j!==n?(ge=m,_=Xf(_,j),m=_):(v=m,m=n)}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(Vf)),m}function Ln(){var m,_,j,T;if(z++,m=v,i.charCodeAt(v)===126?(_=$f,v++):(_=n,z===0&&re(qf)),_===n&&(_=null),_!==n){for(j=[],T=de();T!==n;)j.push(T),T=de();j!==n?(T=Hd(),T===n&&(T=Vd(),T===n&&(T=Bi(),T===n&&(T=Xd(),T===n&&(T=Xr())))),T!==n?(ge=m,_=Zf(_,T),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(Yf)),m}function qd(){var m;return i.substr(v,6).toLowerCase()===Kf?(m=i.substr(v,6),v+=6):(m=n,z===0&&re(Jf)),m===n&&(i.substr(v,6).toLowerCase()===Qf?(m=i.substr(v,6),v+=6):(m=n,z===0&&re(ed)),m===n&&(i.substr(v,5).toLowerCase()===td?(m=i.substr(v,5),v+=5):(m=n,z===0&&re(rd)),m===n&&(i.substr(v,8).toLowerCase()===id?(m=i.substr(v,8),v+=8):(m=n,z===0&&re(nd)),m===n&&(i.substr(v,7).toLowerCase()===ad?(m=i.substr(v,7),v+=7):(m=n,z===0&&re(od)))))),m}function gs(){var m;return i.substr(v,5).toLowerCase()===sd?(m=i.substr(v,5),v+=5):(m=n,z===0&&re(ld)),m===n&&(i.substr(v,6).toLowerCase()===cd?(m=i.substr(v,6),v+=6):(m=n,z===0&&re(hd)),m===n&&(i.substr(v,9).toLowerCase()===ud?(m=i.substr(v,9),v+=9):(m=n,z===0&&re(fd)))),m}function Zd(){var m,_,j,T,F,U,pe,we;if(m=v,_=Xt(),_!==n){for(j=[],T=v,F=We(),F!==n?(i.charCodeAt(v)===44?(U=Rn,v++):(U=n,z===0&&re(Bn)),U!==n?(pe=We(),pe!==n?(we=Xt(),we!==n?(ge=T,F=ls(_,we),T=F):(v=T,T=n)):(v=T,T=n)):(v=T,T=n)):(v=T,T=n);T!==n;)j.push(T),T=v,F=We(),F!==n?(i.charCodeAt(v)===44?(U=Rn,v++):(U=n,z===0&&re(Bn)),U!==n?(pe=We(),pe!==n?(we=Xt(),we!==n?(ge=T,F=ls(_,we),T=F):(v=T,T=n)):(v=T,T=n)):(v=T,T=n)):(v=T,T=n);j!==n?(ge=m,_=dd(_,j),m=_):(v=m,m=n)}else v=m,m=n;return m}function vs(){var m,_,j,T,F;for(m=v,_=[],j=de();j!==n;)_.push(j),j=de();if(_!==n)if(j=Vt(),j!==n){for(T=[],F=de();F!==n;)T.push(F),F=de();T!==n?(i.charCodeAt(v)===44?(F=Rn,v++):(F=n,z===0&&re(Bn)),F===n&&(F=null),F!==n?(ge=m,_=y(j),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n;return m}function Xt(){var m,_,j;if(z++,m=v,_=[],cs.test(i.charAt(v))?(j=i.charAt(v),v++):(j=n,z===0&&re(hs)),j!==n)for(;j!==n;)_.push(j),cs.test(i.charAt(v))?(j=i.charAt(v),v++):(j=n,z===0&&re(hs));else _=n;return _!==n?m=i.substring(m,v):m=_,z--,m===n&&(_=n,z===0&&re(pd)),m}function de(){var m,_;return z++,bd.test(i.charAt(v))?(m=i.charAt(v),v++):(m=n,z===0&&re(gd)),z--,m===n&&(_=n,z===0&&re(md)),m}function ys(){var m,_;return z++,yd.test(i.charAt(v))?(m=i.charAt(v),v++):(m=n,z===0&&re(wd)),z--,m===n&&(_=n,z===0&&re(vd)),m}function We(){var m,_;for(z++,m=[],us.test(i.charAt(v))?(_=i.charAt(v),v++):(_=n,z===0&&re(fs));_!==n;)m.push(_),us.test(i.charAt(v))?(_=i.charAt(v),v++):(_=n,z===0&&re(fs));return z--,m===n&&(_=n,z===0&&re(_d)),m}function Kd(){var m,_,j,T;return z++,m=v,i.substr(v,2).toLowerCase()===u?(_=i.substr(v,2),v+=2):(_=n,z===0&&re(f)),_!==n?(j=We(),j!==n?(T=Jd(),T!==n?(ge=m,_=d(T),m=_):(v=m,m=n)):(v=m,m=n)):(v=m,m=n),z--,m===n&&(_=n,z===0&&re(Sd)),m}function Jd(){var m,_,j,T,F;for(z++,m=v,_=[],j=de();j!==n;)_.push(j),j=de();if(_!==n)if(j=Vt(),j!==n){for(T=[],F=de();F!==n;)T.push(F),F=de();T!==n?(i.charCodeAt(v)===41?(F=In,v++):(F=n,z===0&&re(Dn)),F!==n?(ge=m,_=Lo(j),m=_):(v=m,m=n)):(v=m,m=n)}else v=m,m=n;else v=m,m=n;return z--,m===n&&(_=n,z===0&&re(No)),m}if(Ri=o(),Ri!==n&&v===i.length)return Ri;throw Ri!==n&&v<i.length&&re(xd()),ps(Nn,at<i.length?i.charAt(at):null,at<i.length?Vr(at,at+1):Vr(at,at))}return{SyntaxError:t,parse:r}}()}),fu=ue(()=>{}),du=ue(()=>{}),pu=ue(()=>{}),Ir=ue(H=>{var p=p||{version:"4.2.0"};typeof H!="undefined"?H.fabric=p:typeof define=="function"&&define.amd&&define([],function(){return p});if(typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?p.document=document:p.document=document.implementation.createHTMLDocument(""),p.window=window;else{var zg=fu(),mu=new zg.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;p.document=mu.document,p.jsdomImplForWrapper=du().implForWrapper,p.nodeCanvas=pu().Canvas,p.window=mu,DOMParser=p.window.DOMParser}p.isTouchSupported="ontouchstart"in p.window||"ontouchstart"in p.document||p.window&&p.window.navigator&&p.window.navigator.maxTouchPoints>0;p.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";p.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];p.DPI=96;p.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";p.commaWsp="(?:\\s+,?\\s*|,\\s*)";p.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;p.reNonWord=/[ \n\.,;!\?\-]/;p.fontPaths={};p.iMatrix=[1,0,0,1,0,0];p.svgNS="http://www.w3.org/2000/svg";p.perfLimitSizeTotal=2097152;p.maxCacheSideLimit=4096;p.minCacheSideLimit=256;p.charWidthsCache={};p.textureSize=2048;p.disableStyleCopyPaste=!1;p.enableGLFiltering=!0;p.devicePixelRatio=p.window.devicePixelRatio||p.window.webkitDevicePixelRatio||p.window.mozDevicePixelRatio||1;p.browserShadowBlurConstant=1;p.arcToSegmentsCache={};p.boundsOfCurveCache={};p.cachesBoundsOfCurve=!0;p.forceGLPutImageData=!1;p.initFilterBackend=function(){if(p.enableGLFiltering&&p.isWebglSupported&&p.isWebglSupported(p.textureSize))return console.log("max texture size: "+p.maxTextureSize),new p.WebglFilterBackend({tileSize:p.textureSize});if(p.Canvas2dFilterBackend)return new p.Canvas2dFilterBackend};typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=p);(function(){function e(a,n){if(!this.__eventListeners[a])return;var s=this.__eventListeners[a];n?s[s.indexOf(n)]=!1:p.util.array.fill(s,!1)}function t(a,n){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var s in a)this.on(s,a[s]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(n);return this}function r(a,n){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)e.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var s in a)e.call(this,s,a[s]);else e.call(this,a,n);return this}function i(a,n){if(!this.__eventListeners)return this;var s=this.__eventListeners[a];if(!s)return this;for(var o=0,c=s.length;o<c;o++)s[o]&&s[o].call(this,n||{});return this.__eventListeners[a]=s.filter(function(l){return l!==!1}),this}p.Observable={fire:i,on:t,off:r}})();p.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,r){var i=this._objects;return r?i[t]=e:i.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e=this._objects,t,r=!1,i=0,a=arguments.length;i<a;i++)t=e.indexOf(arguments[i]),t!==-1&&(r=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&r&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var r=this.getObjects(),i=0,a=r.length;i<a;i++)e.call(t,r[i],i,r);return this},getObjects:function(e){return typeof e=="undefined"?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(e){return this._objects.indexOf(e)>-1},complexity:function(){return this._objects.reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}};p.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){e&&e.colorStops&&!(e instanceof p.Gradient)&&this.set(t,new p.Gradient(e))},_initPattern:function(e,t,r){e&&e.source&&!(e instanceof p.Pattern)?this.set(t,new p.Pattern(e,r)):r&&r()},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},get:function(e){return this[e]}};(function(e){var t=Math.sqrt,r=Math.atan2,i=Math.pow,a=Math.PI/180,n=Math.PI/2;p.util={cos:function(s){if(s===0)return 1;s<0&&(s=-s);var o=s/n;switch(o){case 1:case 3:return 0;case 2:return-1}return Math.cos(s)},sin:function(s){if(s===0)return 0;var o=s/n,c=1;s<0&&(c=-1);switch(o){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(s)},removeFromArray:function(s,o){var c=s.indexOf(o);return c!==-1&&s.splice(c,1),s},getRandomInt:function(s,o){return Math.floor(Math.random()*(o-s+1))+s},degreesToRadians:function(s){return s*a},radiansToDegrees:function(s){return s/a},rotatePoint:function(s,o,c){s.subtractEquals(o);var l=p.util.rotateVector(s,c);return new p.Point(l.x,l.y).addEquals(o)},rotateVector:function(s,o){var c=p.util.sin(o),l=p.util.cos(o),h=s.x*l-s.y*c,u=s.x*c+s.y*l;return{x:h,y:u}},transformPoint:function(s,o,c){return c?new p.Point(o[0]*s.x+o[2]*s.y,o[1]*s.x+o[3]*s.y):new p.Point(o[0]*s.x+o[2]*s.y+o[4],o[1]*s.x+o[3]*s.y+o[5])},makeBoundingBoxFromPoints:function(s,o){if(o)for(var c=0;c<s.length;c++)s[c]=p.util.transformPoint(s[c],o);var l=[s[0].x,s[1].x,s[2].x,s[3].x],h=p.util.array.min(l),u=p.util.array.max(l),f=u-h,d=[s[0].y,s[1].y,s[2].y,s[3].y],b=p.util.array.min(d),g=p.util.array.max(d),y=g-b;return{left:h,top:b,width:f,height:y}},invertTransform:function(s){var o=1/(s[0]*s[3]-s[1]*s[2]),c=[o*s[3],-o*s[1],-o*s[2],o*s[0]],l=p.util.transformPoint({x:s[4],y:s[5]},c,!0);return c[4]=-l.x,c[5]=-l.y,c},toFixed:function(s,o){return parseFloat(Number(s).toFixed(o))},parseUnit:function(s,o){var c=/\D{0,2}$/.exec(s),l=parseFloat(s);o||(o=p.Text.DEFAULT_SVG_FONT_SIZE);switch(c[0]){case"mm":return l*p.DPI/25.4;case"cm":return l*p.DPI/2.54;case"in":return l*p.DPI;case"pt":return l*p.DPI/72;case"pc":return l*p.DPI/72*12;case"em":return l*o;default:return l}},falseFunction:function(){return!1},getKlass:function(s,o){return s=p.util.string.camelize(s.charAt(0).toUpperCase()+s.slice(1)),p.util.resolveNamespace(o)[s]},getSvgAttributes:function(s){var o=["instantiated_by_use","style","id","class"];switch(s){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"]);break}return o},resolveNamespace:function(s){if(!s)return p;var o=s.split("."),c=o.length,l,h=e||p.window;for(l=0;l<c;++l)h=h[o[l]];return h},loadImage:function(s,o,c,l){if(!s){o&&o.call(c,s);return}var h=p.util.createImage(),u=function(){o&&o.call(c,h,!1),h=h.onload=h.onerror=null};h.onload=u,h.onerror=function(){p.log("Error loading "+h.src),o&&o.call(c,null,!0),h=h.onload=h.onerror=null},s.indexOf("data")!==0&&l!==void 0&&l!==null&&(h.crossOrigin=l),s.substring(0,14)==="data:image/svg"&&(h.onload=null,p.util.loadImageInDom(h,u)),h.src=s},loadImageInDom:function(s,o){var c=p.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(s),p.document.querySelector("body").appendChild(c),s.onload=function(){o(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(s,o,c,l){s=s||[];var h=[],u=0,f=s.length;function d(){++u===f&&(o&&o(h.filter(function(b){return b})))}if(!f){o&&o(h);return}s.forEach(function(b,g){if(!b||!b.type){d();return}var y=p.util.getKlass(b.type,c);y.fromObject(b,function(S,B){B||(h[g]=S),l&&l(b,S,B),d()})})},enlivenPatterns:function(s,o){s=s||[];function c(){++h===u&&(o&&o(l))}var l=[],h=0,u=s.length;if(!u){o&&o(l);return}s.forEach(function(f,d){f&&f.source?new p.Pattern(f,function(b){l[d]=b,c()}):(l[d]=f,c())})},groupSVGElements:function(s,o,c){var l;return s&&s.length===1?s[0]:(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),l=new p.Group(s,o),typeof c!="undefined"&&(l.sourcePath=c),l)},populateWithProperties:function(s,o,c){if(c&&Object.prototype.toString.call(c)==="[object Array]")for(var l=0,h=c.length;l<h;l++)c[l]in s&&(o[c[l]]=s[c[l]])},drawDashedLine:function(s,o,c,l,h,u){var f=l-o,d=h-c,b=t(f*f+d*d),g=r(d,f),y=u.length,S=0,B=!0;for(s.save(),s.translate(o,c),s.moveTo(0,0),s.rotate(g),o=0;b>o;)o+=u[S++%y],o>b&&(o=b),s[B?"lineTo":"moveTo"](o,0),B=!B;s.restore()},createCanvasElement:function(){return p.document.createElement("canvas")},copyCanvasElement:function(s){var o=p.util.createCanvasElement();return o.width=s.width,o.height=s.height,o.getContext("2d").drawImage(s,0,0),o},toDataURL:function(s,o,c){return s.toDataURL("image/"+o,c)},createImage:function(){return p.document.createElement("img")},multiplyTransformMatrices:function(s,o,c){return[s[0]*o[0]+s[2]*o[1],s[1]*o[0]+s[3]*o[1],s[0]*o[2]+s[2]*o[3],s[1]*o[2]+s[3]*o[3],c?0:s[0]*o[4]+s[2]*o[5]+s[4],c?0:s[1]*o[4]+s[3]*o[5]+s[5]]},qrDecompose:function(s){var o=r(s[1],s[0]),c=i(s[0],2)+i(s[1],2),l=t(c),h=(s[0]*s[3]-s[2]*s[1])/l,u=r(s[0]*s[2]+s[1]*s[3],c);return{angle:o/a,scaleX:l,scaleY:h,skewX:u/a,skewY:0,translateX:s[4],translateY:s[5]}},calcRotateMatrix:function(s){if(!s.angle)return p.iMatrix.concat();var o=p.util.degreesToRadians(s.angle),c=p.util.cos(o),l=p.util.sin(o);return[c,l,-l,c,0,0]},calcDimensionsMatrix:function(s){var o=typeof s.scaleX=="undefined"?1:s.scaleX,c=typeof s.scaleY=="undefined"?1:s.scaleY,l=[s.flipX?-o:o,0,0,s.flipY?-c:c,0,0],h=p.util.multiplyTransformMatrices,u=p.util.degreesToRadians;return s.skewX&&(l=h(l,[1,0,Math.tan(u(s.skewX)),1],!0)),s.skewY&&(l=h(l,[1,Math.tan(u(s.skewY)),0,1],!0)),l},composeMatrix:function(s){var o=[1,0,0,1,s.translateX||0,s.translateY||0],c=p.util.multiplyTransformMatrices;return s.angle&&(o=c(o,p.util.calcRotateMatrix(s))),(s.scaleX!==1||s.scaleY!==1||s.skewX||s.skewY||s.flipX||s.flipY)&&(o=c(o,p.util.calcDimensionsMatrix(s))),o},resetObjectTransform:function(s){s.scaleX=1,s.scaleY=1,s.skewX=0,s.skewY=0,s.flipX=!1,s.flipY=!1,s.rotate(0)},saveObjectTransform:function(s){return{scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,angle:s.angle,left:s.left,flipX:s.flipX,flipY:s.flipY,top:s.top}},isTransparent:function(s,o,c,l){l>0&&(o>l?o-=l:o=0,c>l?c-=l:c=0);var h=!0,u,f,d=s.getImageData(o,c,l*2||1,l*2||1),b=d.data.length;for(u=3;u<b&&!(f=d.data[u],h=f<=0,h===!1);u+=4);return d=null,h},parsePreserveAspectRatioAttribute:function(s){var o="meet",c="Mid",l="Mid",h=s.split(" "),u;return h&&h.length&&(o=h.pop(),o!=="meet"&&o!=="slice"?(u=o,o="meet"):h.length&&(u=h.pop())),c=u!=="none"?u.slice(1,4):"none",l=u!=="none"?u.slice(5,8):"none",{meetOrSlice:o,alignX:c,alignY:l}},clearFabricFontCache:function(s){s=(s||"").toLowerCase(),s?p.charWidthsCache[s]&&delete p.charWidthsCache[s]:p.charWidthsCache={}},limitDimsByArea:function(s,o){var c=Math.sqrt(o*s),l=Math.floor(o/c);return{x:Math.floor(c),y:l}},capValue:function(s,o,c){return Math.max(s,Math.min(o,c))},findScaleToFit:function(s,o){return Math.min(o.width/s.width,o.height/s.height)},findScaleToCover:function(s,o){return Math.max(o.width/s.width,o.height/s.height)},matrixToSVG:function(s){return"matrix("+s.map(function(o){return p.util.toFixed(o,p.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},sizeAfterTransform:function(s,o,c){var l=s/2,h=o/2,u=[{x:-l,y:-h},{x:l,y:-h},{x:-l,y:h},{x:l,y:h}],f=p.util.calcDimensionsMatrix(c),d=p.util.makeBoundingBoxFromPoints(u,f);return{x:d.width,y:d.height}}}})((typeof H!="undefined",H));(function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r={m:"l",M:"L"};function i(R,N,k,w,E,I,O,ie,x,C,D){var L=p.util.cos(R),K=p.util.sin(R),q=p.util.cos(N),Q=p.util.sin(N),ee=k*E*q-w*I*Q+O,M=w*E*q+k*I*Q+ie,A=C+x*(-k*E*K-w*I*L),G=D+x*(-w*E*K+k*I*L),Z=ee+x*(k*E*Q+w*I*q),$=M+x*(w*E*Q-k*I*q);return["C",A,G,Z,$,ee,M]}function a(R,N,k,w,E,I,O){var ie=Math.PI,x=O*ie/180,C=p.util.sin(x),D=p.util.cos(x),L=0,K=0;k=Math.abs(k),w=Math.abs(w);var q=-D*R*.5-C*N*.5,Q=-D*N*.5+C*R*.5,ee=k*k,M=w*w,A=Q*Q,G=q*q,Z=ee*M-ee*A-M*G,$=0;if(Z<0){var te=Math.sqrt(1-Z/(ee*M));k*=te,w*=te}else $=(E===I?-1:1)*Math.sqrt(Z/(ee*A+M*G));var ne=$*k*Q/w,fe=-$*w*q/k,me=D*ne-C*fe+R*.5,oe=C*ne+D*fe+N*.5,se=n(1,0,(q-ne)/k,(Q-fe)/w),ce=n((q-ne)/k,(Q-fe)/w,(-q-ne)/k,(-Q-fe)/w);I===0&&ce>0?ce-=2*ie:I===1&&ce<0&&(ce+=2*ie);for(var ve=Math.ceil(Math.abs(ce/ie*2)),xe=[],Ie=ce/ve,Be=8/3*Math.sin(Ie/4)*Math.sin(Ie/4)/Math.sin(Ie/2),Ue=se+Ie,Ae=0;Ae<ve;Ae++)xe[Ae]=i(se,Ue,D,C,k,w,me,oe,Be,L,K),L=xe[Ae][5],K=xe[Ae][6],se=Ue,Ue+=Ie;return xe}function n(R,N,k,w){var E=Math.atan2(N,R),I=Math.atan2(w,k);return I>=E?I-E:2*Math.PI-(E-I)}function s(R,N,k,w,E,I,O,ie){var x;if(p.cachesBoundsOfCurve&&(x=e.call(arguments),p.boundsOfCurveCache[x]))return p.boundsOfCurveCache[x];var C=Math.sqrt,D=Math.min,L=Math.max,K=Math.abs,q=[],Q=[[],[]],ee,M,A,G,Z,$,te,ne;M=6*R-12*k+6*E,ee=-3*R+9*k-9*E+3*O,A=3*k-3*R;for(var fe=0;fe<2;++fe){if(fe>0&&(M=6*N-12*w+6*I,ee=-3*N+9*w-9*I+3*ie,A=3*w-3*N),K(ee)<1e-12){if(K(M)<1e-12)continue;G=-A/M,0<G&&G<1&&q.push(G);continue}if(te=M*M-4*A*ee,te<0)continue;ne=C(te),Z=(-M+ne)/(2*ee),0<Z&&Z<1&&q.push(Z),$=(-M-ne)/(2*ee),0<$&&$<1&&q.push($)}for(var me,oe,se=q.length,ce=se,ve;se--;)G=q[se],ve=1-G,me=ve*ve*ve*R+3*ve*ve*G*k+3*ve*G*G*E+G*G*G*O,Q[0][se]=me,oe=ve*ve*ve*N+3*ve*ve*G*w+3*ve*G*G*I+G*G*G*ie,Q[1][se]=oe;Q[0][ce]=R,Q[1][ce]=N,Q[0][ce+1]=O,Q[1][ce+1]=ie;var xe=[{x:D.apply(null,Q[0]),y:D.apply(null,Q[1])},{x:L.apply(null,Q[0]),y:L.apply(null,Q[1])}];return p.cachesBoundsOfCurve&&(p.boundsOfCurveCache[x]=xe),xe}function o(R,N,k){for(var w=k[1],E=k[2],I=k[3],O=k[4],ie=k[5],x=k[6],C=k[7],D=a(x-R,C-N,w,E,O,ie,I),L=0,K=D.length;L<K;L++)D[L][1]+=R,D[L][2]+=N,D[L][3]+=R,D[L][4]+=N,D[L][5]+=R,D[L][6]+=N;return D}function c(R){var N=0,k=0,w=R.length,E=0,I=0,O,ie,x,C=[],D,L,K;for(ie=0;ie<w;++ie){x=!1,O=R[ie].slice(0);switch(O[0]){case"l":O[0]="L",O[1]+=N,O[2]+=k;case"L":N=O[1],k=O[2];break;case"h":O[1]+=N;case"H":O[0]="L",O[2]=k,N=O[1];break;case"v":O[1]+=k;case"V":O[0]="L",k=O[1],O[1]=N,O[2]=k;break;case"m":O[0]="M",O[1]+=N,O[2]+=k;case"M":N=O[1],k=O[2],E=O[1],I=O[2];break;case"c":O[0]="C",O[1]+=N,O[2]+=k,O[3]+=N,O[4]+=k,O[5]+=N,O[6]+=k;case"C":L=O[3],K=O[4],N=O[5],k=O[6];break;case"s":O[0]="S",O[1]+=N,O[2]+=k,O[3]+=N,O[4]+=k;case"S":D==="C"?(L=2*N-L,K=2*k-K):(L=N,K=k),N=O[3],k=O[4],O[0]="C",O[5]=O[3],O[6]=O[4],O[3]=O[1],O[4]=O[2],O[1]=L,O[2]=K,L=O[3],K=O[4];break;case"q":O[0]="Q",O[1]+=N,O[2]+=k,O[3]+=N,O[4]+=k;case"Q":L=O[1],K=O[2],N=O[3],k=O[4];break;case"t":O[0]="T",O[1]+=N,O[2]+=k;case"T":D==="Q"?(L=2*N-L,K=2*k-K):(L=N,K=k),O[0]="Q",N=O[1],k=O[2],O[1]=L,O[2]=K,O[3]=N,O[4]=k;break;case"a":O[0]="A",O[6]+=N,O[7]+=k;case"A":x=!0,C=C.concat(o(N,k,O)),N=O[6],k=O[7];break;case"z":case"Z":N=E,k=I;break;default:}x||C.push(O),D=O[0]}return C}function l(R,N,k,w){return Math.sqrt((k-R)*(k-R)+(w-N)*(w-N))}function h(R){return R*R*R}function u(R){return 3*R*R*(1-R)}function f(R){return 3*R*(1-R)*(1-R)}function d(R){return(1-R)*(1-R)*(1-R)}function b(R,N,k,w,E,I,O,ie){return function(x){var C=h(x),D=u(x),L=f(x),K=d(x);return{x:O*C+E*D+k*L+R*K,y:ie*C+I*D+w*L+N*K}}}function g(R){return R*R}function y(R){return 2*R*(1-R)}function S(R){return(1-R)*(1-R)}function B(R,N,k,w,E,I){return function(O){var ie=g(O),x=y(O),C=S(O);return{x:E*ie+k*x+R*C,y:I*ie+w*x+N*C}}}function W(R,N,k){var w={x:N,y:k},E,I=0,O;for(O=.01;O<=1;O+=.01)E=R(O),I+=l(w.x,w.y,E.x,E.y),w=E;return I}function X(R){for(var N=0,k=R.length,w,E=0,I=0,O=0,ie=0,x=[],C,D,L=0;L<k;L++){w=R[L],D={x:E,y:I,command:w[0]};switch(w[0]){case"M":D.length=0,O=E=w[1],ie=I=w[2];break;case"L":D.length=l(E,I,w[1],w[2]),E=w[1],I=w[2];break;case"C":C=b(E,I,w[1],w[2],w[3],w[4],w[5],w[6]),D.length=W(C,E,I),E=w[5],I=w[6];break;case"Q":C=B(E,I,w[1],w[2],w[3],w[4]),D.length=W(C,E,I),E=w[3],I=w[4];break;case"Z":case"z":D.destX=O,D.destY=ie,D.length=l(E,I,O,ie),E=O,I=ie;break}N+=D.length,x.push(D)}return x.push({length:N,x:E,y:I}),x}function P(R,N,k){k||(k=X(R));for(var w=k[k.length-1]*N,E=0;w-k[E]>0&&E<k.length;)w-=k[E],E++;var I=k[E],O=w/I.length,ie=I.length,x=R[E];switch(ie){case"Z":case"z":return new p.Point(I.x,I.y).lerp(new p.Point(I.destX,I.destY),O);case"L":return new p.Point(I.x,I.y).lerp(new p.Point(x[1],x[2]),O);case"C":return b(I.x,I.y,x[1],x[2],x[3],x[4],x[5],x[6])(O);case"Q":return B(I.x,I.y,x[1],x[2],x[3],x[4])(O)}}function J(R){var N=[],k=[],w,E,I=p.rePathCommand,O="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",ie="("+O+")"+p.commaWsp,x="([01])"+p.commaWsp+"?",C=ie+"?"+ie+"?"+ie+x+x+ie+"?("+O+")",D=new RegExp(C,"g"),L,K,q;if(!R||!R.match)return N;q=R.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var Q=0,ee,M=q.length;Q<M;Q++){w=q[Q],K=w.slice(1).trim(),k.length=0;var A=w.charAt(0);if(ee=[A],A.toLowerCase()==="a")for(var G;G=D.exec(K);)for(var Z=1;Z<G.length;Z++)k.push(G[Z]);else for(;L=I.exec(K);)k.push(L[0]);for(var Z=0,$=k.length;Z<$;Z++)E=parseFloat(k[Z]),isNaN(E)||ee.push(E);var te=t[A.toLowerCase()],ne=r[A]||A;if(ee.length-1>te)for(var fe=1,me=ee.length;fe<me;fe+=te)N.push([A].concat(ee.slice(fe,fe+te))),A=ne;else N.push(ee)}return N}function V(R,N,k,w,E,I,O,ie,x){for(var C=0,D=0,L,K=[],q=a(ie-R,x-N,k,w,I,O,E),Q=0,ee=q.length;Q<ee;Q++)L=s(C,D,q[Q][1],q[Q][2],q[Q][3],q[Q][4],q[Q][5],q[Q][6]),K.push({x:L[0].x+R,y:L[0].y+N}),K.push({x:L[1].x+R,y:L[1].y+N}),C=q[Q][5],D=q[Q][6];return K}function Y(R,N,k,w){w=w.slice(0).unshift("X");var E=o(N,k,w);E.forEach(function(I){R.bezierCurveTo.apply(R,I.slice(1))})}p.util.parsePath=J,p.util.makePathSimpler=c,p.util.getPathSegmentsInfo=X,p.util.fromArcToBeizers=o,p.util.getBoundsOfCurve=s,p.util.getPointOnPath=P,p.util.getBoundsOfArc=V,p.util.drawArc=Y})();(function(){var e=Array.prototype.slice;function t(s,o){for(var c=e.call(arguments,2),l=[],h=0,u=s.length;h<u;h++)l[h]=c.length?s[h][o].apply(s[h],c):s[h][o].call(s[h]);return l}function r(s,o){return n(s,o,function(c,l){return c>=l})}function i(s,o){return n(s,o,function(c,l){return c<l})}function a(s,o){for(var c=s.length;c--;)s[c]=o;return s}function n(s,o,c){if(!s||s.length===0)return;var l=s.length-1,h=o?s[l][o]:s[l];if(o)for(;l--;)c(s[l][o],h)&&(h=s[l][o]);else for(;l--;)c(s[l],h)&&(h=s[l]);return h}p.util.array={fill:a,invoke:t,min:i,max:r}})();(function(){function e(r,i,a){if(a)if(!p.isLikelyNode&&i instanceof Element)r=i;else if(i instanceof Array){r=[];for(var n=0,s=i.length;n<s;n++)r[n]=e({},i[n],a)}else if(i&&typeof i=="object")for(var o in i)o==="canvas"||o==="group"?r[o]=null:i.hasOwnProperty(o)&&(r[o]=e({},i[o],a));else r=i;else for(var o in i)r[o]=i[o];return r}function t(r,i){return e({},r,i)}p.util.object={extend:e,clone:t},p.util.object.extend(p.util,p.Observable)})();(function(){function e(n){return n.replace(/-+(.)?/g,function(s,o){return o?o.toUpperCase():""})}function t(n,s){return n.charAt(0).toUpperCase()+(s?n.slice(1):n.slice(1).toLowerCase())}function r(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(n){var s=0,o,c=[];for(s=0,o;s<n.length;s++){if((o=a(n,s))===!1)continue;c.push(o)}return c}function a(n,s){var o=n.charCodeAt(s);if(isNaN(o))return"";if(o<55296||o>57343)return n.charAt(s);if(55296<=o&&o<=56319){if(n.length<=s+1)throw"High surrogate without following low surrogate";var c=n.charCodeAt(s+1);if(56320>c||c>57343)throw"High surrogate without following low surrogate";return n.charAt(s)+n.charAt(s+1)}if(s===0)throw"Low surrogate without preceding high surrogate";var l=n.charCodeAt(s-1);if(55296>l||l>56319)throw"Low surrogate without preceding high surrogate";return!1}p.util.string={camelize:e,capitalize:t,escapeXml:r,graphemeSplit:i}})();(function(){var e=Array.prototype.slice,t=function(){},r=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),i=function(o,c,l){for(var h in c)h in o.prototype&&typeof o.prototype[h]=="function"&&(c[h]+"").indexOf("callSuper")>-1?o.prototype[h]=function(u){return function(){var f=this.constructor.superclass;this.constructor.superclass=l;var d=c[u].apply(this,arguments);if(this.constructor.superclass=f,u!=="initialize")return d}}(h):o.prototype[h]=c[h],r&&(c.toString!==Object.prototype.toString&&(o.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=c.valueOf))};function a(){}function n(o){for(var c=null,l=this;l.constructor.superclass;){var h=l.constructor.superclass.prototype[o];if(l[o]!==h){c=h;break}l=l.constructor.superclass.prototype}return c?arguments.length>1?c.apply(this,e.call(arguments,1)):c.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}function s(){var o=null,c=e.call(arguments,0);typeof c[0]=="function"&&(o=c.shift());function l(){this.initialize.apply(this,arguments)}l.superclass=o,l.subclasses=[],o&&(a.prototype=o.prototype,l.prototype=new a,o.subclasses.push(l));for(var h=0,u=c.length;h<u;h++)i(l,c[h],o);return l.prototype.initialize||(l.prototype.initialize=t),l.prototype.constructor=l,l.prototype.callSuper=n,l}p.util.createClass=s})();(function(){var e=!!p.document.createElement("div").attachEvent,t=["touchstart","touchmove","touchend"];p.util.addListener=function(i,a,n,s){i&&i.addEventListener(a,n,e?!1:s)},p.util.removeListener=function(i,a,n,s){i&&i.removeEventListener(a,n,e?!1:s)};function r(i){var a=i.changedTouches;return a&&a[0]?a[0]:i}p.util.getPointer=function(i){var a=i.target,n=p.util.getScrollLeftTop(a),s=r(i);return{x:s.clientX+n.left,y:s.clientY+n.top}},p.util.isTouchEvent=function(i){return t.indexOf(i.type)>-1||i.pointerType==="touch"}})();(function(){function e(s,o){var c=s.style;if(!c)return s;if(typeof o=="string")return s.style.cssText+=";"+o,o.indexOf("opacity")>-1?n(s,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):s;for(var l in o)if(l==="opacity")n(s,o[l]);else{var h=l==="float"||l==="cssFloat"?typeof c.styleFloat=="undefined"?"cssFloat":"styleFloat":l;c[h]=o[l]}return s}var t=p.document.createElement("div"),r=typeof t.style.opacity=="string",i=typeof t.style.filter=="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(s){return s};r?n=function(s,o){return s.style.opacity=o,s}:i&&(n=function(s,o){var c=s.style;return s.currentStyle&&!s.currentStyle.hasLayout&&(c.zoom=1),a.test(c.filter)?(o=o>=.9999?"":"alpha(opacity="+o*100+")",c.filter=c.filter.replace(a,o)):c.filter+=" alpha(opacity="+o*100+")",s}),p.util.setStyle=e})();(function(){var e=Array.prototype.slice;function t(d){return typeof d=="string"?p.document.getElementById(d):d}var r,i=function(d){return e.call(d,0)};try{r=i(p.document.childNodes)instanceof Array}catch(d){}r||(i=function(d){for(var b=new Array(d.length),g=d.length;g--;)b[g]=d[g];return b});function a(d,b){var g=p.document.createElement(d);for(var y in b)y==="class"?g.className=b[y]:y==="for"?g.htmlFor=b[y]:g.setAttribute(y,b[y]);return g}function n(d,b){d&&(" "+d.className+" ").indexOf(" "+b+" ")===-1&&(d.className+=(d.className?" ":"")+b)}function s(d,b,g){return typeof b=="string"&&(b=a(b,g)),d.parentNode&&d.parentNode.replaceChild(b,d),b.appendChild(d),b}function o(d){for(var b=0,g=0,y=p.document.documentElement,S=p.document.body||{scrollLeft:0,scrollTop:0};d&&(d.parentNode||d.host)&&!(d=d.parentNode||d.host,d===p.document?(b=S.scrollLeft||y.scrollLeft||0,g=S.scrollTop||y.scrollTop||0):(b+=d.scrollLeft||0,g+=d.scrollTop||0),d.nodeType===1&&d.style.position==="fixed"););return{left:b,top:g}}function c(d){var b,g=d&&d.ownerDocument,y={left:0,top:0},S={left:0,top:0},B,W={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return S;for(var X in W)S[W[X]]+=parseInt(l(d,X),10)||0;return b=g.documentElement,typeof d.getBoundingClientRect!="undefined"&&(y=d.getBoundingClientRect()),B=o(d),{left:y.left+B.left-(b.clientLeft||0)+S.left,top:y.top+B.top-(b.clientTop||0)+S.top}}var l;p.document.defaultView&&p.document.defaultView.getComputedStyle?l=function(d,b){var g=p.document.defaultView.getComputedStyle(d,null);return g?g[b]:void 0}:l=function(d,b){var g=d.style[b];return!g&&d.currentStyle&&(g=d.currentStyle[b]),g},function(){var d=p.document.documentElement.style,b="userSelect"in d?"userSelect":"MozUserSelect"in d?"MozUserSelect":"WebkitUserSelect"in d?"WebkitUserSelect":"KhtmlUserSelect"in d?"KhtmlUserSelect":"";function g(S){return typeof S.onselectstart!="undefined"&&(S.onselectstart=p.util.falseFunction),b?S.style[b]="none":typeof S.unselectable=="string"&&(S.unselectable="on"),S}function y(S){return typeof S.onselectstart!="undefined"&&(S.onselectstart=null),b?S.style[b]="":typeof S.unselectable=="string"&&(S.unselectable=""),S}p.util.makeElementUnselectable=g,p.util.makeElementSelectable=y}();function h(d){var b=p.jsdomImplForWrapper(d);return b._canvas||b._image}function u(d){if(!p.isLikelyNode)return;var b=p.jsdomImplForWrapper(d);b&&(b._image=null,b._canvas=null,b._currentSrc=null,b._attributes=null,b._classList=null)}function f(d,b){d.imageSmoothingEnabled=d.imageSmoothingEnabled||d.webkitImageSmoothingEnabled||d.mozImageSmoothingEnabled||d.msImageSmoothingEnabled||d.oImageSmoothingEnabled,d.imageSmoothingEnabled=b}p.util.setImageSmoothing=f,p.util.getById=t,p.util.toArray=i,p.util.addClass=n,p.util.makeElement=a,p.util.wrapElement=s,p.util.getScrollLeftTop=o,p.util.getElementOffset=c,p.util.getNodeCanvas=h,p.util.cleanUpJsdomNode=u})();(function(){function e(i,a){return i+(/\?/.test(i)?"&":"?")+a}function t(){}function r(i,a){a||(a={});var n=a.method?a.method.toUpperCase():"GET",s=a.onComplete||function(){},o=new p.window.XMLHttpRequest,c=a.body||a.parameters;return o.onreadystatechange=function(){o.readyState===4&&(s(o),o.onreadystatechange=t)},n==="GET"&&(c=null,typeof a.parameters=="string"&&(i=e(i,a.parameters))),o.open(n,i,!0),(n==="POST"||n==="PUT")&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}p.util.request=r})();p.log=console.log;p.warn=console.warn;(function(){function e(){return!1}function t(o,c,l,h){return-l*Math.cos(o/h*(Math.PI/2))+l+c}function r(o){n(function(c){o||(o={});var l=c||+new Date,h=o.duration||500,u=l+h,f,d=o.onChange||e,b=o.abort||e,g=o.onComplete||e,y=o.easing||t,S="startValue"in o?o.startValue:0,B="endValue"in o?o.endValue:100,W=o.byValue||B-S;o.onStart&&o.onStart(),function X(P){f=P||+new Date;var J=f>u?h:f-l,V=J/h,Y=y(J,S,W,h),R=Math.abs((Y-S)/W);if(b()){g(B,1,1);return}if(f>u){d(B,1,1),g(B,1,1);return}else d(Y,R,V),n(X)}(l)})}var i=p.window.requestAnimationFrame||p.window.webkitRequestAnimationFrame||p.window.mozRequestAnimationFrame||p.window.oRequestAnimationFrame||p.window.msRequestAnimationFrame||function(o){return p.window.setTimeout(o,1e3/60)},a=p.window.cancelAnimationFrame||p.window.clearTimeout;function n(){return i.apply(p.window,arguments)}function s(){return a.apply(p.window,arguments)}p.util.animate=r,p.util.requestAnimFrame=n,p.util.cancelAnimFrame=s})();(function(){function e(r,i,a){var n="rgba("+parseInt(r[0]+a*(i[0]-r[0]),10)+","+parseInt(r[1]+a*(i[1]-r[1]),10)+","+parseInt(r[2]+a*(i[2]-r[2]),10);return n+=","+(r&&i?parseFloat(r[3]+a*(i[3]-r[3])):1),n+=")",n}function t(r,i,a,n){var s=new p.Color(r).getSource(),o=new p.Color(i).getSource(),c=n.onComplete,l=n.onChange;n=n||{},p.util.animate(p.util.object.extend(n,{duration:a||500,startValue:s,endValue:o,byValue:o,easing:function(h,u,f,d){var b=n.colorEasing?n.colorEasing(h,d):1-Math.cos(h/d*(Math.PI/2));return e(u,f,b)},onComplete:function(h,u,f){if(c)return c(e(o,o,0),u,f)},onChange:function(h,u,f){if(l){if(Array.isArray(h))return l(e(h,h,0),u,f);l(h,u,f)}}}))}p.util.animateColor=t})();(function(){function e(w,E,I,O){return w<Math.abs(E)?(w=E,O=I/4):E===0&&w===0?O=I/(2*Math.PI)*Math.asin(1):O=I/(2*Math.PI)*Math.asin(E/w),{a:w,c:E,p:I,s:O}}function t(w,E,I){return w.a*Math.pow(2,10*(E-=1))*Math.sin((E*I-w.s)*(2*Math.PI)/w.p)}function r(w,E,I,O){return I*((w=w/O-1)*w*w+1)+E}function i(w,E,I,O){return w/=O/2,w<1?I/2*w*w*w+E:I/2*((w-=2)*w*w+2)+E}function a(w,E,I,O){return I*(w/=O)*w*w*w+E}function n(w,E,I,O){return-I*((w=w/O-1)*w*w*w-1)+E}function s(w,E,I,O){return w/=O/2,w<1?I/2*w*w*w*w+E:-I/2*((w-=2)*w*w*w-2)+E}function o(w,E,I,O){return I*(w/=O)*w*w*w*w+E}function c(w,E,I,O){return I*((w=w/O-1)*w*w*w*w+1)+E}function l(w,E,I,O){return w/=O/2,w<1?I/2*w*w*w*w*w+E:I/2*((w-=2)*w*w*w*w+2)+E}function h(w,E,I,O){return-I*Math.cos(w/O*(Math.PI/2))+I+E}function u(w,E,I,O){return I*Math.sin(w/O*(Math.PI/2))+E}function f(w,E,I,O){return-I/2*(Math.cos(Math.PI*w/O)-1)+E}function d(w,E,I,O){return w===0?E:I*Math.pow(2,10*(w/O-1))+E}function b(w,E,I,O){return w===O?E+I:I*(-Math.pow(2,-10*w/O)+1)+E}function g(w,E,I,O){return w===0?E:w===O?E+I:(w/=O/2,w<1?I/2*Math.pow(2,10*(w-1))+E:I/2*(-Math.pow(2,-10*--w)+2)+E)}function y(w,E,I,O){return-I*(Math.sqrt(1-(w/=O)*w)-1)+E}function S(w,E,I,O){return I*Math.sqrt(1-(w=w/O-1)*w)+E}function B(w,E,I,O){return w/=O/2,w<1?-I/2*(Math.sqrt(1-w*w)-1)+E:I/2*(Math.sqrt(1-(w-=2)*w)+1)+E}function W(w,E,I,O){var ie=1.70158,x=0,C=I;if(w===0)return E;if(w/=O,w===1)return E+I;x||(x=O*.3);var D=e(C,I,x,ie);return-t(D,w,O)+E}function X(w,E,I,O){var ie=1.70158,x=0,C=I;if(w===0)return E;if(w/=O,w===1)return E+I;x||(x=O*.3);var D=e(C,I,x,ie);return D.a*Math.pow(2,-10*w)*Math.sin((w*O-D.s)*(2*Math.PI)/D.p)+D.c+E}function P(w,E,I,O){var ie=1.70158,x=0,C=I;if(w===0)return E;if(w/=O/2,w===2)return E+I;x||(x=O*(.3*1.5));var D=e(C,I,x,ie);return w<1?-.5*t(D,w,O)+E:D.a*Math.pow(2,-10*(w-=1))*Math.sin((w*O-D.s)*(2*Math.PI)/D.p)*.5+D.c+E}function J(w,E,I,O,ie){return ie===void 0&&(ie=1.70158),I*(w/=O)*w*((ie+1)*w-ie)+E}function V(w,E,I,O,ie){return ie===void 0&&(ie=1.70158),I*((w=w/O-1)*w*((ie+1)*w+ie)+1)+E}function Y(w,E,I,O,ie){return ie===void 0&&(ie=1.70158),w/=O/2,w<1?I/2*(w*w*(((ie*=1.525)+1)*w-ie))+E:I/2*((w-=2)*w*(((ie*=1.525)+1)*w+ie)+2)+E}function R(w,E,I,O){return I-N(O-w,0,I,O)+E}function N(w,E,I,O){return(w/=O)<1/2.75?I*(7.5625*w*w)+E:w<2/2.75?I*(7.5625*(w-=1.5/2.75)*w+.75)+E:w<2.5/2.75?I*(7.5625*(w-=2.25/2.75)*w+.9375)+E:I*(7.5625*(w-=2.625/2.75)*w+.984375)+E}function k(w,E,I,O){return w<O/2?R(w*2,0,I,O)*.5+E:N(w*2-O,0,I,O)*.5+I*.5+E}p.util.ease={easeInQuad:function(w,E,I,O){return I*(w/=O)*w+E},easeOutQuad:function(w,E,I,O){return-I*(w/=O)*(w-2)+E},easeInOutQuad:function(w,E,I,O){return w/=O/2,w<1?I/2*w*w+E:-I/2*(--w*(w-2)-1)+E},easeInCubic:function(w,E,I,O){return I*(w/=O)*w*w+E},easeOutCubic:r,easeInOutCubic:i,easeInQuart:a,easeOutQuart:n,easeInOutQuart:s,easeInQuint:o,easeOutQuint:c,easeInOutQuint:l,easeInSine:h,easeOutSine:u,easeInOutSine:f,easeInExpo:d,easeOutExpo:b,easeInOutExpo:g,easeInCirc:y,easeOutCirc:S,easeInOutCirc:B,easeInElastic:W,easeOutElastic:X,easeInOutElastic:P,easeInBack:J,easeOutBack:V,easeInOutBack:Y,easeInBounce:R,easeOutBounce:N,easeInOutBounce:k}})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,a=t.util.toFixed,n=t.util.parseUnit,s=t.util.multiplyTransformMatrices,o=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],c=["symbol","image","marker","pattern","view","svg"],l=["pattern","defs","symbol","metadata","clipPath","mask","desc"],h=["symbol","g","a","svg","clipPath","defs"],u={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},d="font-size",b="clip-path";t.svgValidTagNamesRegEx=S(o),t.svgViewBoxElementsRegEx=S(c),t.svgInvalidAncestorsRegEx=S(l),t.svgValidParentsRegEx=S(h),t.cssRules={},t.gradientDefs={},t.clipPaths={};function g(x){return x in u?u[x]:x}function y(x,C,D,L){var K=Object.prototype.toString.call(C)==="[object Array]",q;if((x==="fill"||x==="stroke")&&C==="none")C="";else{if(x==="strokeUniform")return C==="non-scaling-stroke";if(x==="strokeDashArray")C==="none"?C=null:C=C.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(x==="transformMatrix")D&&D.transformMatrix?C=s(D.transformMatrix,t.parseTransformAttribute(C)):C=t.parseTransformAttribute(C);else if(x==="visible")C=C!=="none"&&C!=="hidden",D&&D.visible===!1&&(C=!1);else if(x==="opacity")C=parseFloat(C),D&&typeof D.opacity!="undefined"&&(C*=D.opacity);else if(x==="textAnchor")C=C==="start"?"left":C==="end"?"right":"center";else if(x==="charSpacing")q=n(C,L)/L*1e3;else if(x==="paintFirst"){var Q=C.indexOf("fill"),ee=C.indexOf("stroke"),C="fill";(Q>-1&&ee>-1&&ee<Q||Q===-1&&ee>-1)&&(C="stroke")}else{if(x==="href"||x==="xlink:href"||x==="font")return C;if(x==="imageSmoothing")return C==="optimizeQuality";q=K?C.map(n):n(C,L)}}return!K&&isNaN(q)?C:q}function S(x){return new RegExp("^("+x.join("|")+")\\b","i")}function B(x){for(var C in f){if(typeof x[f[C]]=="undefined"||x[C]==="")continue;if(typeof x[C]=="undefined"){if(!t.Object.prototype[C])continue;x[C]=t.Object.prototype[C]}if(x[C].indexOf("url(")===0)continue;var D=new t.Color(x[C]);x[C]=D.setAlpha(a(D.getAlpha()*x[f[C]],2)).toRgba()}return x}function W(x,C){var D,L=[],K,q,Q;for(q=0,Q=C.length;q<Q;q++)D=C[q],K=x.getElementsByTagName(D),L=L.concat(Array.prototype.slice.call(K));return L}t.parseTransformAttribute=function(){function x(se,ce){var ve=t.util.cos(ce[0]),xe=t.util.sin(ce[0]),Ie=0,Be=0;ce.length===3&&(Ie=ce[1],Be=ce[2]),se[0]=ve,se[1]=xe,se[2]=-xe,se[3]=ve,se[4]=Ie-(ve*Ie-xe*Be),se[5]=Be-(xe*Ie+ve*Be)}function C(se,ce){var ve=ce[0],xe=ce.length===2?ce[1]:ce[0];se[0]=ve,se[3]=xe}function D(se,ce,ve){se[ve]=Math.tan(t.util.degreesToRadians(ce[0]))}function L(se,ce){se[4]=ce[0],ce.length===2&&(se[5]=ce[1])}var K=t.iMatrix,q=t.reNum,Q=t.commaWsp,ee="(?:(skewX)\\s*\\(\\s*("+q+")\\s*\\))",M="(?:(skewY)\\s*\\(\\s*("+q+")\\s*\\))",A="(?:(rotate)\\s*\\(\\s*("+q+")(?:"+Q+"("+q+")"+Q+"("+q+"))?\\s*\\))",G="(?:(scale)\\s*\\(\\s*("+q+")(?:"+Q+"("+q+"))?\\s*\\))",Z="(?:(translate)\\s*\\(\\s*("+q+")(?:"+Q+"("+q+"))?\\s*\\))",$="(?:(matrix)\\s*\\(\\s*("+q+")"+Q+"("+q+")"+Q+"("+q+")"+Q+"("+q+")"+Q+"("+q+")"+Q+"("+q+")\\s*\\))",te="(?:"+$+"|"+Z+"|"+G+"|"+A+"|"+ee+"|"+M+")",ne="(?:"+te+"(?:"+Q+"*"+te+")*)",fe="^\\s*(?:"+ne+"?)\\s*$",me=new RegExp(fe),oe=new RegExp(te,"g");return function(se){var ce=K.concat(),ve=[];if(!se||se&&!me.test(se))return ce;se.replace(oe,function(Ie){var Be=new RegExp(te).exec(Ie).filter(function(sr){return!!sr}),Ue=Be[1],Ae=Be.slice(2).map(parseFloat);switch(Ue){case"translate":L(ce,Ae);break;case"rotate":Ae[0]=t.util.degreesToRadians(Ae[0]),x(ce,Ae);break;case"scale":C(ce,Ae);break;case"skewX":D(ce,Ae,2);break;case"skewY":D(ce,Ae,1);break;case"matrix":ce=Ae;break}ve.push(ce.concat()),ce=K.concat()});for(var xe=ve[0];ve.length>1;)ve.shift(),xe=t.util.multiplyTransformMatrices(xe,ve[0]);return xe}}();function X(x,C){var D,L;x.replace(/;\s*$/,"").split(";").forEach(function(K){var q=K.split(":");D=q[0].trim().toLowerCase(),L=q[1].trim(),C[D]=L})}function P(x,C){var D,L;for(var K in x){if(typeof x[K]=="undefined")continue;D=K.toLowerCase(),L=x[K],C[D]=L}}function J(x,C){var D={};for(var L in t.cssRules[C])if(V(x,L.split(" ")))for(var K in t.cssRules[C][L])D[K]=t.cssRules[C][L][K];return D}function V(x,C){var D,L=!0;return D=R(x,C.pop()),D&&C.length&&(L=Y(x,C)),D&&L&&C.length===0}function Y(x,C){for(var D,L=!0;x.parentNode&&x.parentNode.nodeType===1&&C.length;)L&&(D=C.pop()),x=x.parentNode,L=R(x,D);return C.length===0}function R(x,C){var D=x.nodeName,L=x.getAttribute("class"),K=x.getAttribute("id"),q,Q;if(q=new RegExp("^"+D,"i"),C=C.replace(q,""),K&&C.length&&(q=new RegExp("#"+K+"(?![a-zA-Z\\-]+)","i"),C=C.replace(q,"")),L&&C.length)for(L=L.split(" "),Q=L.length;Q--;)q=new RegExp("\\."+L[Q]+"(?![a-zA-Z\\-]+)","i"),C=C.replace(q,"");return C.length===0}function N(x,C){var D;if(x.getElementById&&(D=x.getElementById(C)),D)return D;var L,K,q,Q=x.getElementsByTagName("*");for(K=0,q=Q.length;K<q;K++)if(L=Q[K],C===L.getAttribute("id"))return L}function k(x){for(var C=W(x,["use","svg:use"]),D=0;C.length&&D<C.length;){var L=C[D],K=(L.getAttribute("xlink:href")||L.getAttribute("href")).substr(1),q=L.getAttribute("x")||0,Q=L.getAttribute("y")||0,ee=N(x,K).cloneNode(!0),M=(ee.getAttribute("transform")||"")+" translate("+q+", "+Q+")",A,G=C.length,Z,$,te,ne,fe=t.svgNS;if(E(ee),/^svg$/i.test(ee.nodeName)){var me=ee.ownerDocument.createElementNS(fe,"g");for($=0,te=ee.attributes,ne=te.length;$<ne;$++)Z=te.item($),me.setAttributeNS(fe,Z.nodeName,Z.nodeValue);for(;ee.firstChild;)me.appendChild(ee.firstChild);ee=me}for($=0,te=L.attributes,ne=te.length;$<ne;$++){if(Z=te.item($),Z.nodeName==="x"||Z.nodeName==="y"||Z.nodeName==="xlink:href"||Z.nodeName==="href")continue;Z.nodeName==="transform"?M=Z.nodeValue+" "+M:ee.setAttribute(Z.nodeName,Z.nodeValue)}ee.setAttribute("transform",M),ee.setAttribute("instantiated_by_use","1"),ee.removeAttribute("id"),A=L.parentNode,A.replaceChild(ee,L),C.length===G&&D++}}var w=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function E(x){if(!t.svgViewBoxElementsRegEx.test(x.nodeName))return;var C=x.getAttribute("viewBox"),D=1,L=1,K=0,q=0,Q,ee,M,A,G=x.getAttribute("width"),Z=x.getAttribute("height"),$=x.getAttribute("x")||0,te=x.getAttribute("y")||0,ne=x.getAttribute("preserveAspectRatio")||"",fe=!C||!(C=C.match(w)),me=!G||!Z||G==="100%"||Z==="100%",oe=fe&&me,se={},ce="",ve=0,xe=0;if(se.width=0,se.height=0,se.toBeParsed=oe,fe&&(($||te)&&x.parentNode.nodeName!=="#document"&&(ce=" translate("+n($)+" "+n(te)+") ",M=(x.getAttribute("transform")||"")+ce,x.setAttribute("transform",M),x.removeAttribute("x"),x.removeAttribute("y"))),oe)return se;if(fe)return se.width=n(G),se.height=n(Z),se;if(K=-parseFloat(C[1]),q=-parseFloat(C[2]),Q=parseFloat(C[3]),ee=parseFloat(C[4]),se.minX=K,se.minY=q,se.viewBoxWidth=Q,se.viewBoxHeight=ee,me?(se.width=Q,se.height=ee):(se.width=n(G),se.height=n(Z),D=se.width/Q,L=se.height/ee),ne=t.util.parsePreserveAspectRatioAttribute(ne),ne.alignX!=="none"&&(ne.meetOrSlice==="meet"&&(L=D=D>L?L:D),ne.meetOrSlice==="slice"&&(L=D=D>L?D:L),ve=se.width-Q*D,xe=se.height-ee*D,ne.alignX==="Mid"&&(ve/=2),ne.alignY==="Mid"&&(xe/=2),ne.alignX==="Min"&&(ve=0),ne.alignY==="Min"&&(xe=0)),D===1&&L===1&&K===0&&q===0&&$===0&&te===0)return se;if(($||te)&&x.parentNode.nodeName!=="#document"&&(ce=" translate("+n($)+" "+n(te)+") "),M=ce+" matrix("+D+" 0 0 "+L+" "+(K*D+ve)+" "+(q*L+xe)+") ",x.nodeName==="svg"){for(A=x.ownerDocument.createElementNS(t.svgNS,"g");x.firstChild;)A.appendChild(x.firstChild);x.appendChild(A)}else A=x,A.removeAttribute("x"),A.removeAttribute("y"),M=A.getAttribute("transform")+M;return A.setAttribute("transform",M),se}function I(x,C){for(;x&&(x=x.parentNode);)if(x.nodeName&&C.test(x.nodeName.replace("svg:",""))&&!x.getAttribute("instantiated_by_use"))return!0;return!1}t.parseSVGDocument=function(x,C,D,L){if(!x)return;k(x);var K=t.Object.__uid++,q,Q,ee=E(x),M=t.util.toArray(x.getElementsByTagName("*"));if(ee.crossOrigin=L&&L.crossOrigin,ee.svgUid=K,M.length===0&&t.isLikelyNode){M=x.selectNodes('//*[name(.)!="svg"]');var A=[];for(q=0,Q=M.length;q<Q;q++)A[q]=M[q];M=A}var G=M.filter(function($){return E($),t.svgValidTagNamesRegEx.test($.nodeName.replace("svg:",""))&&!I($,t.svgInvalidAncestorsRegEx)});if(!G||G&&!G.length){C&&C([],{});return}var Z={};M.filter(function($){return $.nodeName.replace("svg:","")==="clipPath"}).forEach(function($){var te=$.getAttribute("id");Z[te]=t.util.toArray($.getElementsByTagName("*")).filter(function(ne){return t.svgValidTagNamesRegEx.test(ne.nodeName.replace("svg:",""))})}),t.gradientDefs[K]=t.getGradientDefs(x),t.cssRules[K]=t.getCSSRules(x),t.clipPaths[K]=Z,t.parseElements(G,function($,te){C&&(C($,ee,te,M),delete t.gradientDefs[K],delete t.cssRules[K],delete t.clipPaths[K])},i(ee),D,L)};function O(x,C){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],L="xlink:href",K=C.getAttribute(L).substr(1),q=N(x,K);if(q&&q.getAttribute(L)&&O(x,q),D.forEach(function(ee){q&&!C.hasAttribute(ee)&&q.hasAttribute(ee)&&C.setAttribute(ee,q.getAttribute(ee))}),!C.children.length)for(var Q=q.cloneNode(!0);Q.firstChild;)C.appendChild(Q.firstChild);C.removeAttribute(L)}var ie=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");r(t,{parseFontDeclaration:function(x,C){var D=x.match(ie);if(!D)return;var L=D[1],K=D[3],q=D[4],Q=D[5],ee=D[6];L&&(C.fontStyle=L),K&&(C.fontWeight=isNaN(parseFloat(K))?K:parseFloat(K)),q&&(C.fontSize=n(q)),ee&&(C.fontFamily=ee),Q&&(C.lineHeight=Q==="normal"?1:Q)},getGradientDefs:function(x){var C=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=W(x,C),L,K=0,q={};for(K=D.length;K--;)L=D[K],L.getAttribute("xlink:href")&&O(x,L),q[L.getAttribute("id")]=L;return q},parseAttributes:function(x,C,D){if(!x)return;var L,K={},q,Q;typeof D=="undefined"&&(D=x.getAttribute("svgUid")),x.parentNode&&t.svgValidParentsRegEx.test(x.parentNode.nodeName)&&(K=t.parseAttributes(x.parentNode,C,D));var ee=C.reduce(function(ne,fe){return L=x.getAttribute(fe),L&&(ne[fe]=L),ne},{}),M=r(J(x,D),t.parseStyleAttribute(x));ee=r(ee,M),M[b]&&x.setAttribute(b,M[b]),q=Q=K.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,ee[d]&&(ee[d]=q=n(ee[d],Q));var A,G,Z={};for(var $ in ee)A=g($),G=y(A,ee[$],K,q),Z[A]=G;Z&&Z.font&&t.parseFontDeclaration(Z.font,Z);var te=r(K,Z);return t.svgValidParentsRegEx.test(x.nodeName)?te:B(te)},parseElements:function(x,C,D,L,K){new t.ElementsParser(x,C,D,L,K).parse()},parseStyleAttribute:function(x){var C={},D=x.getAttribute("style");return D&&(typeof D=="string"?X(D,C):P(D,C)),C},parsePointsAttribute:function(x){if(!x)return null;x=x.replace(/,/g," ").trim(),x=x.split(/\s+/);var C=[],D,L;for(D=0,L=x.length;D<L;D+=2)C.push({x:parseFloat(x[D]),y:parseFloat(x[D+1])});return C},getCSSRules:function(x){var C=x.getElementsByTagName("style"),D,L,K={},q;for(D=0,L=C.length;D<L;D++){var Q=C[D].textContent||"";if(Q=Q.replace(/\/\*[\s\S]*?\*\//g,""),Q.trim()==="")continue;q=Q.match(/[^{]*\{[\s\S]*?\}/g),q=q.map(function(ee){return ee.trim()}),q.forEach(function(ee){var M=ee.match(/([\s\S]*?)\s*\{([^}]*)\}/),A={},G=M[2].trim(),Z=G.replace(/;$/,"").split(/\s*;\s*/);for(D=0,L=Z.length;D<L;D++){var $=Z[D].split(/\s*:\s*/),te=$[0],ne=$[1];A[te]=ne}ee=M[1],ee.split(",").forEach(function(fe){if(fe=fe.replace(/^svg/i,"").trim(),fe==="")return;K[fe]?t.util.object.extend(K[fe],A):K[fe]=t.util.object.clone(A)})})}return K},loadSVGFromURL:function(x,C,D,L){x=x.replace(/^\n\s*/,"").trim(),new t.util.request(x,{method:"get",onComplete:K});function K(q){var Q=q.responseXML;if(!Q||!Q.documentElement)return C&&C(null),!1;t.parseSVGDocument(Q.documentElement,function(ee,M,A,G){C&&C(ee,M,A,G)},D,L)}},loadSVGFromString:function(x,C,D,L){var K=new t.window.DOMParser,q=K.parseFromString(x.trim(),"text/xml");t.parseSVGDocument(q.documentElement,function(Q,ee,M,A){C(Q,ee,M,A)},D,L)}})})((typeof H!="undefined",H));p.ElementsParser=function(e,t,r,i,a,n){this.elements=e,this.callback=t,this.options=r,this.reviver=i,this.svgUid=r&&r.svgUid||0,this.parsingOptions=a,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n};(function(e){e.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var t=this;this.elements.forEach(function(r,i){r.setAttribute("svgUid",t.svgUid),t.createObject(r,i)})},e.findTag=function(t){return p[p.util.string.capitalize(t.tagName.replace("svg:",""))]},e.createObject=function(t,r){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(r,t),this.options)}catch(a){p.log(a)}else this.checkIfDone()},e.createCallback=function(t,r){var i=this;return function(a){var n;i.resolveGradient(a,r,"fill"),i.resolveGradient(a,r,"stroke"),a instanceof p.Image&&a._originalElement&&(n=a.parsePreserveAspectRatioAttribute(r)),a._removeTransformMatrix(n),i.resolveClipPath(a,r),i.reviver&&i.reviver(r,a),i.instances[t]=a,i.checkIfDone()}},e.extractPropertyDefinition=function(t,r,i){var a=t[r],n=this.regexUrl;if(!n.test(a))return;n.lastIndex=0;var s=n.exec(a)[1];return n.lastIndex=0,p[i][this.svgUid][s]},e.resolveGradient=function(t,r,i){var a=this.extractPropertyDefinition(t,i,"gradientDefs");if(a){var n=r.getAttribute(i+"-opacity"),s=p.Gradient.fromElement(a,t,n,this.options);t.set(i,s)}},e.createClipPathCallback=function(t,r){return function(i){i._removeTransformMatrix(),i.fillRule=i.clipRule,r.push(i)}},e.resolveClipPath=function(t,r){var i=this.extractPropertyDefinition(t,"clipPath","clipPaths"),a,n,s,o,c,l;if(i){o=[],s=p.util.invertTransform(t.calcTransformMatrix());for(var h=i[0].parentNode,u=r;u.parentNode&&u.getAttribute("clip-path")!==t.clipPath;)u=u.parentNode;u.parentNode.appendChild(h);for(var f=0;f<i.length;f++)a=i[f],n=this.findTag(a),n.fromElement(a,this.createClipPathCallback(t,o),this.options);o.length===1?i=o[0]:i=new p.Group(o),c=p.util.multiplyTransformMatrices(s,i.calcTransformMatrix()),i.clipPath&&this.resolveClipPath(i,u);var l=p.util.qrDecompose(c);i.flipX=!1,i.flipY=!1,i.set("scaleX",l.scaleX),i.set("scaleY",l.scaleY),i.angle=l.angle,i.skewX=l.skewX,i.skewY=0,i.setPositionByOrigin({x:l.translateX,y:l.translateY},"center","center"),t.clipPath=i}else delete t.clipPath},e.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(t){return t!=null}),this.callback(this.instances,this.elements))}})(p.ElementsParser.prototype);(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=r;function r(i,a){this.x=i,this.y=a}r.prototype={type:"point",constructor:r,add:function(i){return new r(this.x+i.x,this.y+i.y)},addEquals:function(i){return this.x+=i.x,this.y+=i.y,this},scalarAdd:function(i){return new r(this.x+i,this.y+i)},scalarAddEquals:function(i){return this.x+=i,this.y+=i,this},subtract:function(i){return new r(this.x-i.x,this.y-i.y)},subtractEquals:function(i){return this.x-=i.x,this.y-=i.y,this},scalarSubtract:function(i){return new r(this.x-i,this.y-i)},scalarSubtractEquals:function(i){return this.x-=i,this.y-=i,this},multiply:function(i){return new r(this.x*i,this.y*i)},multiplyEquals:function(i){return this.x*=i,this.y*=i,this},divide:function(i){return new r(this.x/i,this.y/i)},divideEquals:function(i){return this.x/=i,this.y/=i,this},eq:function(i){return this.x===i.x&&this.y===i.y},lt:function(i){return this.x<i.x&&this.y<i.y},lte:function(i){return this.x<=i.x&&this.y<=i.y},gt:function(i){return this.x>i.x&&this.y>i.y},gte:function(i){return this.x>=i.x&&this.y>=i.y},lerp:function(i,a){return typeof a=="undefined"&&(a=.5),a=Math.max(Math.min(1,a),0),new r(this.x+(i.x-this.x)*a,this.y+(i.y-this.y)*a)},distanceFrom:function(i){var a=this.x-i.x,n=this.y-i.y;return Math.sqrt(a*a+n*n)},midPointFrom:function(i){return this.lerp(i)},min:function(i){return new r(Math.min(this.x,i.x),Math.min(this.y,i.y))},max:function(i){return new r(Math.max(this.x,i.x),Math.max(this.y,i.y))},toString:function(){return this.x+","+this.y},setXY:function(i,a){return this.x=i,this.y=a,this},setX:function(i){return this.x=i,this},setY:function(i){return this.y=i,this},setFromPoint:function(i){return this.x=i.x,this.y=i.y,this},swap:function(i){var a=this.x,n=this.y;this.x=i.x,this.y=i.y,i.x=a,i.y=n},clone:function(){return new r(this.x,this.y)}}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}function r(i){this.status=i,this.points=[]}t.Intersection=r,t.Intersection.prototype={constructor:r,appendPoint:function(i){return this.points.push(i),this},appendPoints:function(i){return this.points=this.points.concat(i),this}},t.Intersection.intersectLineLine=function(i,a,n,s){var o,c=(s.x-n.x)*(i.y-n.y)-(s.y-n.y)*(i.x-n.x),l=(a.x-i.x)*(i.y-n.y)-(a.y-i.y)*(i.x-n.x),h=(s.y-n.y)*(a.x-i.x)-(s.x-n.x)*(a.y-i.y);if(h!==0){var u=c/h,f=l/h;0<=u&&u<=1&&0<=f&&f<=1?(o=new r("Intersection"),o.appendPoint(new t.Point(i.x+u*(a.x-i.x),i.y+u*(a.y-i.y)))):o=new r}else c===0||l===0?o=new r("Coincident"):o=new r("Parallel");return o},t.Intersection.intersectLinePolygon=function(i,a,n){var s=new r,o=n.length,c,l,h,u;for(u=0;u<o;u++)c=n[u],l=n[(u+1)%o],h=r.intersectLineLine(i,a,c,l),s.appendPoints(h.points);return s.points.length>0&&(s.status="Intersection"),s},t.Intersection.intersectPolygonPolygon=function(i,a){var n=new r,s=i.length,o;for(o=0;o<s;o++){var c=i[o],l=i[(o+1)%s],h=r.intersectLinePolygon(c,l,a);n.appendPoints(h.points)}return n.points.length>0&&(n.status="Intersection"),n},t.Intersection.intersectPolygonRectangle=function(i,a,n){var s=a.min(n),o=a.max(n),c=new t.Point(o.x,s.y),l=new t.Point(s.x,o.y),h=r.intersectLinePolygon(s,c,i),u=r.intersectLinePolygon(c,o,i),f=r.intersectLinePolygon(o,l,i),d=r.intersectLinePolygon(l,s,i),b=new r;return b.appendPoints(h.points),b.appendPoints(u.points),b.appendPoints(f.points),b.appendPoints(d.points),b.points.length>0&&(b.status="Intersection"),b}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}function r(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}t.Color=r,t.Color.prototype={_tryParsingColor:function(a){var n;a in r.colorNameMap&&(a=r.colorNameMap[a]),a==="transparent"&&(n=[255,255,255,0]),n||(n=r.sourceFromHex(a)),n||(n=r.sourceFromRgb(a)),n||(n=r.sourceFromHsl(a)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(a,n,s){a/=255,n/=255,s/=255;var o,c,l,h=t.util.array.max([a,n,s]),u=t.util.array.min([a,n,s]);if(l=(h+u)/2,h===u)o=c=0;else{var f=h-u;c=l>.5?f/(2-h-u):f/(h+u);switch(h){case a:o=(n-s)/f+(n<s?6:0);break;case n:o=(s-a)/f+2;break;case s:o=(a-n)/f+4;break}o/=6}return[Math.round(o*360),Math.round(c*100),Math.round(l*100)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),n=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)"},toHsla:function(){var a=this.getSource(),n=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),n,s,o;return n=a[0].toString(16),n=n.length===1?"0"+n:n,s=a[1].toString(16),s=s.length===1?"0"+s:s,o=a[2].toString(16),o=o.length===1?"0"+o:o,n.toUpperCase()+s.toUpperCase()+o.toUpperCase()},toHexa:function(){var a=this.getSource(),n;return n=Math.round(a[3]*255),n=n.toString(16),n=n.length===1?"0"+n:n,this.toHex()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var n=this.getSource();return n[3]=a,this.setSource(n),this},toGrayscale:function(){var a=this.getSource(),n=parseInt((a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),10),s=a[3];return this.setSource([n,n,n,s]),this},toBlackWhite:function(a){var n=this.getSource(),s=(n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),o=n[3];return a=a||127,s=Number(s)<Number(a)?0:255,this.setSource([s,s,s,o]),this},overlayWith:function(a){a instanceof r||(a=new r(a));var n=[],s=this.getAlpha(),o=.5,c=this.getSource(),l=a.getSource(),h;for(h=0;h<3;h++)n.push(Math.round(c[h]*(1-o)+l[h]*o));return n[3]=s,this.setSource(n),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(a,n,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?a+(n-a)*6*s:s<1/2?n:s<2/3?a+(n-a)*(2/3-s)*6:a}t.Color.fromRgb=function(a){return r.fromSource(r.sourceFromRgb(a))},t.Color.sourceFromRgb=function(a){var n=a.match(r.reRGBa);if(n){var s=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),o=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),c=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(s,10),parseInt(o,10),parseInt(c,10),n[4]?parseFloat(n[4]):1]}},t.Color.fromRgba=r.fromRgb,t.Color.fromHsl=function(a){return r.fromSource(r.sourceFromHsl(a))},t.Color.sourceFromHsl=function(a){var n=a.match(r.reHSLa);if(!n)return;var s=(parseFloat(n[1])%360+360)%360/360,o=parseFloat(n[2])/(/%$/.test(n[2])?100:1),c=parseFloat(n[3])/(/%$/.test(n[3])?100:1),l,h,u;if(o===0)l=h=u=c;else{var f=c<=.5?c*(o+1):c+o-c*o,d=c*2-f;l=i(d,f,s+1/3),h=i(d,f,s),u=i(d,f,s-1/3)}return[Math.round(l*255),Math.round(h*255),Math.round(u*255),n[4]?parseFloat(n[4]):1]},t.Color.fromHsla=r.fromHsl,t.Color.fromHex=function(a){return r.fromSource(r.sourceFromHex(a))},t.Color.sourceFromHex=function(a){if(a.match(r.reHex)){var n=a.slice(a.indexOf("#")+1),s=n.length===3||n.length===4,o=n.length===8||n.length===4,c=s?n.charAt(0)+n.charAt(0):n.substring(0,2),l=s?n.charAt(1)+n.charAt(1):n.substring(2,4),h=s?n.charAt(2)+n.charAt(2):n.substring(4,6),u=o?s?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(c,16),parseInt(l,16),parseInt(h,16),parseFloat((parseInt(u,16)/255).toFixed(2))]}},t.Color.fromSource=function(a){var n=new r;return n.setSource(a),n}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=["e","se","s","sw","w","nw","n","ne","e"],i=["ns","nesw","ew","nwse"],a={},n="left",s="top",o="right",c="bottom",l="center",h={top:c,bottom:s,left:o,right:n,center:l},u=t.util.radiansToDegrees,f=Math.sign||function(M){return(M>0)-(M<0)||+M};function d(M,A){var G=M.angle+u(Math.atan2(A.y,A.x))+360;return Math.round(G%360/45)}function b(M,A){var G=A.transform.target,Z=G.canvas,$=t.util.object.clone(A);$.target=G,Z&&Z.fire("object:"+M,$),G.fire(M,A)}function g(M,A){var G=A.canvas,Z=G.uniScaleKey,$=M[Z];return G.uniformScaling&&!$||!G.uniformScaling&&$}function y(M){return M.originX===l&&M.originY===l}function S(M,A,G){var Z=M.lockScalingX,$=M.lockScalingY;return Z&&$||(!A&&(Z||$)&&G||Z&&A==="x")?!0:!!($&&A==="y")}function B(M,A,G){var Z="not-allowed",$=g(M,G),te="";if(A.x!==0&&A.y===0?te="x":A.x===0&&A.y!==0&&(te="y"),S(G,te,$))return Z;var ne=d(G,A);return r[ne]+"-resize"}function W(M,A,G){var Z="not-allowed";if(A.x!==0&&G.lockSkewingY)return Z;if(A.y!==0&&G.lockSkewingX)return Z;var $=d(G,A)%4;return i[$]+"-resize"}function X(M,A,G){return M[G.canvas.altActionKey]?a.skewCursorStyleHandler(M,A,G):a.scaleCursorStyleHandler(M,A,G)}function P(M,A,G){var Z=M[G.canvas.altActionKey];if(A.x===0)return Z?"skewX":"scaleY";if(A.y===0)return Z?"skewY":"scaleX"}function J(M,A,G){return G.lockRotation?"not-allowed":A.cursorStyle}function V(M,A,G,Z){return{e:M,transform:A,pointer:{x:G,y:Z}}}function Y(M){return function(A,G,Z,$){var te=G.target,ne=te.getCenterPoint(),fe=te.translateToOriginPoint(ne,G.originX,G.originY),me=M(A,G,Z,$);return te.setPositionByOrigin(fe,G.originX,G.originY),me}}function R(M,A,G,Z,$){var te=M.target,ne=te.controls[M.corner],fe=te.canvas.getZoom(),me=te.padding/fe,oe=te.toLocalPoint(new t.Point(Z,$),A,G);return oe.x>=me&&(oe.x-=me),oe.x<=-me&&(oe.x+=me),oe.y>=me&&(oe.y-=me),oe.y<=me&&(oe.y+=me),oe.x-=ne.offsetX,oe.y-=ne.offsetY,oe}function N(M){return M.flipX&&!M.flipY||!M.flipX&&M.flipY}function k(M,A,G,Z,$){if(M[A]!==0){var te=M._getTransformedDimensions()[Z],ne=$/te*M[G];M.set(G,ne)}}function w(M,A,G,Z){var $=A.target,te=$._getTransformedDimensions(0,$.skewY),ne=R(A,A.originX,A.originY,G,Z),fe=Math.abs(ne.x*2)-te.x,me=$.skewX,oe;fe<2?oe=0:(oe=u(Math.atan2(fe/$.scaleX,te.y/$.scaleY)),A.originX===n&&A.originY===c&&(oe=-oe),A.originX===o&&A.originY===s&&(oe=-oe),N($)&&(oe=-oe));var se=me!==oe;if(se){var ce=$._getTransformedDimensions().y;$.set("skewX",oe),k($,"skewY","scaleY","y",ce),b("skewing",V(M,A,G,Z))}return se}function E(M,A,G,Z){var $=A.target,te=$._getTransformedDimensions($.skewX,0),ne=R(A,A.originX,A.originY,G,Z),fe=Math.abs(ne.y*2)-te.y,me=$.skewY,oe;fe<2?oe=0:(oe=u(Math.atan2(fe/$.scaleY,te.x/$.scaleX)),A.originX===n&&A.originY===c&&(oe=-oe),A.originX===o&&A.originY===s&&(oe=-oe),N($)&&(oe=-oe));var se=me!==oe;if(se){var ce=$._getTransformedDimensions().x;$.set("skewY",oe),k($,"skewX","scaleX","x",ce),b("skewing",V(M,A,G,Z))}return se}function I(M,A,G,Z){var $=A.target,te=$.skewX,ne,fe=A.originY;if($.lockSkewingX)return!1;if(te===0){var me=R(A,l,l,G,Z);me.x>0?ne=n:ne=o}else te>0&&(ne=fe===s?n:o),te<0&&(ne=fe===s?o:n),N($)&&(ne=ne===n?o:n);A.originX=ne;var oe=Y(w);return oe(M,A,G,Z)}function O(M,A,G,Z){var $=A.target,te=$.skewY,ne,fe=A.originX;if($.lockSkewingY)return!1;if(te===0){var me=R(A,l,l,G,Z);me.y>0?ne=s:ne=c}else te>0&&(ne=fe===n?s:c),te<0&&(ne=fe===n?c:s),N($)&&(ne=ne===s?c:s);A.originY=ne;var oe=Y(E);return oe(M,A,G,Z)}function ie(M,A,G,Z){var $=A,te=$.target,ne=te.translateToOriginPoint(te.getCenterPoint(),$.originX,$.originY);if(te.lockRotation)return!1;var fe=Math.atan2($.ey-ne.y,$.ex-ne.x),me=Math.atan2(Z-ne.y,G-ne.x),oe=u(me-fe+$.theta),se=!0;if(te.snapAngle>0){var ce=te.snapAngle,ve=te.snapThreshold||ce,xe=Math.ceil(oe/ce)*ce,Ie=Math.floor(oe/ce)*ce;Math.abs(oe-Ie)<ve?oe=Ie:Math.abs(oe-xe)<ve&&(oe=xe)}return oe<0&&(oe=360+oe),oe%=360,se=te.angle!==oe,te.angle=oe,se&&b("rotating",V(M,A,G,Z)),se}function x(M,A,G,Z,$){$=$||{};var te=A.target,ne=te.lockScalingX,fe=te.lockScalingY,me=$.by,oe,se,ce,ve,xe=g(M,te),Ie=S(te,me,xe),Be,Ue,Ae=A.gestureScale;if(Ie)return!1;if(Ae)se=A.scaleX*Ae,ce=A.scaleY*Ae;else{if(oe=R(A,A.originX,A.originY,G,Z),Be=me!=="y"?f(oe.x):1,Ue=me!=="x"?f(oe.y):1,A.signX||(A.signX=Be),A.signY||(A.signY=Ue),te.lockScalingFlip&&(A.signX!==Be||A.signY!==Ue))return!1;if(ve=te._getTransformedDimensions(),xe&&!me){var sr=Math.abs(oe.x)+Math.abs(oe.y),lr=A.original,En=Math.abs(ve.x*lr.scaleX/te.scaleX)+Math.abs(ve.y*lr.scaleY/te.scaleY),Gr=sr/En,Hr;se=lr.scaleX*Gr,ce=lr.scaleY*Gr}else se=Math.abs(oe.x*te.scaleX/ve.x),ce=Math.abs(oe.y*te.scaleY/ve.y);y(A)&&(se*=2,ce*=2),A.signX!==Be&&me!=="y"&&(A.originX=h[A.originX],se*=-1,A.signX=Be),A.signY!==Ue&&me!=="x"&&(A.originY=h[A.originY],ce*=-1,A.signY=Ue)}var Ii=te.scaleX,An=te.scaleY;return me?(me==="x"&&te.set("scaleX",se),me==="y"&&te.set("scaleY",ce)):(!ne&&te.set("scaleX",se),!fe&&te.set("scaleY",ce)),Hr=Ii!==te.scaleX||An!==te.scaleY,Hr&&b("scaling",V(M,A,G,Z)),Hr}function C(M,A,G,Z){return x(M,A,G,Z)}function D(M,A,G,Z){return x(M,A,G,Z,{by:"x"})}function L(M,A,G,Z){return x(M,A,G,Z,{by:"y"})}function K(M,A,G,Z){return M[A.target.canvas.altActionKey]?a.skewHandlerX(M,A,G,Z):a.scalingY(M,A,G,Z)}function q(M,A,G,Z){return M[A.target.canvas.altActionKey]?a.skewHandlerY(M,A,G,Z):a.scalingX(M,A,G,Z)}function Q(M,A,G,Z){var $=A.target,te=R(A,A.originX,A.originY,G,Z),ne=$.strokeWidth/($.strokeUniform?$.scaleX:1),fe=y(A)?2:1,me=$.width,oe,se=Math.abs(te.x*fe/$.scaleX)-ne;return $.set("width",Math.max(se,0)),oe=me!==se,oe&&b("resizing",V(M,A,G,Z)),oe}function ee(M,A,G,Z){var $=A.target,te=G-A.offsetX,ne=Z-A.offsetY,fe=!$.get("lockMovementX")&&$.left!==te,me=!$.get("lockMovementY")&&$.top!==ne;return fe&&$.set("left",te),me&&$.set("top",ne),(fe||me)&&b("moving",V(M,A,G,Z)),fe||me}a.scaleCursorStyleHandler=B,a.skewCursorStyleHandler=W,a.scaleSkewCursorStyleHandler=X,a.rotationWithSnapping=Y(ie),a.scalingEqually=Y(C),a.scalingX=Y(D),a.scalingY=Y(L),a.scalingYOrSkewingX=K,a.scalingXOrSkewingY=q,a.changeWidth=Y(Q),a.skewHandlerX=I,a.skewHandlerY=O,a.dragHandler=ee,a.scaleOrSkewActionName=P,a.rotationStyleHandler=J,a.fireEvent=b,a.wrapWithFixedAnchor=Y,a.getLocalPoint=R,t.controlsUtils=a})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.degreesToRadians,i=t.controlsUtils;function a(s,o,c,l,h){l=l||{};var u=l.cornerSize||h.cornerSize,f=typeof l.transparentCorners!="undefined"?l.transparentCorners:this.transparentCorners,d=f?"stroke":"fill",b=!f&&(l.cornerStrokeColor||h.cornerStrokeColor);s.save(),s.fillStyle=l.cornerColor||h.cornerColor,s.strokeStyle=l.cornerStrokeColor||h.cornerStrokeColor,s.lineWidth=1,s.beginPath(),s.arc(o,c,u/2,0,2*Math.PI,!1),s[d](),b&&s.stroke(),s.restore()}function n(s,o,c,l,h){l=l||{};var u=l.cornerSize||h.cornerSize,f=typeof l.transparentCorners!="undefined"?l.transparentCorners:h.transparentCorners,d=f?"stroke":"fill",b=!f&&(l.cornerStrokeColor||h.cornerStrokeColor),g=u/2;s.save(),s.fillStyle=l.cornerColor||h.cornerColor,s.strokeStyle=l.strokeCornerColor||h.strokeCornerColor,s.lineWidth=1,s.translate(o,c),s.rotate(r(h.angle)),s[d+"Rect"](-g,-g,u,u),b&&s.strokeRect(-g,-g,u,u),s.restore()}i.renderCircleControl=a,i.renderSquareControl=n})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});function r(i){for(var a in i)this[a]=i[a]}t.Control=r,t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(i,a){return a.cursorStyle},getActionName:function(i,a){return a.actionName},getVisibility:function(i,a){var n=i._controlsVisibility;return n&&typeof n[a]!="undefined"?n[a]:this.visible},setVisibility:function(i){this.visible=i},positionHandler:function(i,a){var n=t.util.transformPoint({x:this.x*i.x+this.offsetX,y:this.y*i.y+this.offsetY},a);return n},render:function(i,a,n,s,o){s=s||{};switch(s.cornerStyle||o.cornerStyle){case"circle":t.controlsUtils.renderCircleControl.call(this,i,a,n,s,o);break;default:t.controlsUtils.renderSquareControl.call(this,i,a,n,s,o)}}}})((typeof H!="undefined",H));(function(){function e(n,s){var o=n.getAttribute("style"),c=n.getAttribute("offset")||0,l,h,u,f;if(c=parseFloat(c)/(/%$/.test(c)?100:1),c=c<0?0:c>1?1:c,o){var d=o.split(/\s*;\s*/);for(d[d.length-1]===""&&d.pop(),f=d.length;f--;){var b=d[f].split(/\s*:\s*/),g=b[0].trim(),y=b[1].trim();g==="stop-color"?l=y:g==="stop-opacity"&&(u=y)}}return l||(l=n.getAttribute("stop-color")||"rgb(0,0,0)"),u||(u=n.getAttribute("stop-opacity")),l=new p.Color(l),h=l.getAlpha(),u=isNaN(parseFloat(u))?1:parseFloat(u),u*=h*s,{offset:c,color:l.toRgb(),opacity:u}}function t(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function r(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}var i=p.util.object.clone;p.Gradient=p.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(n){n||(n={}),n.coords||(n.coords={});var s,o=this;Object.keys(n).forEach(function(c){o[c]=n[c]}),this.id?this.id+="_"+p.Object.__uid++:this.id=p.Object.__uid++,s={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0},this.type==="radial"&&(s.r1=n.coords.r1||0,s.r2=n.coords.r2||0),this.coords=s,this.colorStops=n.colorStops.slice()},addColorStop:function(n){for(var s in n){var o=new p.Color(n[s]);this.colorStops.push({offset:parseFloat(s),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(n){var s={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return p.util.populateWithProperties(this,s,n),s},toSVG:function(n,s){var o=i(this.coords,!0),c,l,s=s||{},h,u,f=i(this.colorStops,!0),d=o.r1>o.r2,b=this.gradientTransform?this.gradientTransform.concat():p.iMatrix.concat(),g=-this.offsetX,y=-this.offsetY,S=!!s.additionalTransform,B=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(f.sort(function(V,Y){return V.offset-Y.offset}),B==="objectBoundingBox"?(g/=n.width,y/=n.height):(g+=n.width/2,y+=n.height/2),n.type==="path"&&(g-=n.pathOffset.x,y-=n.pathOffset.y),b[4]-=g,b[5]-=y,u='id="SVGID_'+this.id+'" gradientUnits="'+B+'"',u+=' gradientTransform="'+(S?s.additionalTransform+" ":"")+p.util.matrixToSVG(b)+'" ',this.type==="linear"?h=["<linearGradient ",u,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",u,' cx="',d?o.x1:o.x2,'" cy="',d?o.y1:o.y2,'" r="',d?o.r1:o.r2,'" fx="',d?o.x2:o.x1,'" fy="',d?o.y2:o.y1,`">
`]),this.type==="radial"){if(d)for(f=f.concat(),f.reverse(),c=0,l=f.length;c<l;c++)f[c].offset=1-f[c].offset;var W=Math.min(o.r1,o.r2);if(W>0){var X=Math.max(o.r1,o.r2),P=W/X;for(c=0,l=f.length;c<l;c++)f[c].offset+=P*(1-f[c].offset)}}for(c=0,l=f.length;c<l;c++){var J=f[c];h.push("<stop ",'offset="',J.offset*100+"%",'" style="stop-color:',J.color,typeof J.opacity!="undefined"?";stop-opacity: "+J.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(n){var s,o=p.util.object.clone(this.coords),c,l;if(!this.type)return;for(this.type==="linear"?s=n.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(s=n.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),c=0,l=this.colorStops.length;c<l;c++){var h=this.colorStops[c].color,u=this.colorStops[c].opacity,f=this.colorStops[c].offset;typeof u!="undefined"&&(h=new p.Color(h).setAlpha(u).toRgba()),s.addColorStop(f,h)}return s}}),p.util.object.extend(p.Gradient,{fromElement:function(n,s,o,c){var l=parseFloat(o)/(/%$/.test(o)?100:1);l=l<0?0:l>1?1:l,isNaN(l)&&(l=1);var h=n.getElementsByTagName("stop"),u,f=n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",d=n.getAttribute("gradientTransform")||"",b=[],g,y,S=0,B=0,W;for(n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?(u="linear",g=t(n)):(u="radial",g=r(n)),y=h.length;y--;)b.push(e(h[y],l));W=p.parseTransformAttribute(d),a(s,g,c,f),f==="pixels"&&(S=-s.left,B=-s.top);var X=new p.Gradient({id:n.getAttribute("id"),type:u,coords:g,colorStops:b,gradientUnits:f,gradientTransform:W,offsetX:S,offsetY:B});return X}});function a(n,s,o,c){var l,h;Object.keys(s).forEach(function(u){l=s[u],l==="Infinity"?h=1:l==="-Infinity"?h=0:(h=parseFloat(s[u],10),typeof l=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(l)&&(h*=.01,c==="pixels"&&((u==="x1"||u==="x2"||u==="r2")&&(h*=o.viewBoxWidth||o.width),(u==="y1"||u==="y2")&&(h*=o.viewBoxHeight||o.height)))),s[u]=h})}})();(function(){"use strict";var e=p.util.toFixed;p.Pattern=p.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,r){if(t||(t={}),this.id=p.Object.__uid++,this.setOptions(t),!t.source||t.source&&typeof t.source!="string"){r&&r(this);return}else{var i=this;this.source=p.util.createImage(),p.util.loadImage(t.source,function(a,n){i.source=a,r&&r(i,n)},null,this.crossOrigin)}},toObject:function(t){var r=p.Object.NUM_FRACTION_DIGITS,i,a;return typeof this.source.src=="string"?i=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(i=this.source.toDataURL()),a={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:e(this.offsetX,r),offsetY:e(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},p.util.populateWithProperties(this,a,t),a},toSVG:function(t){var r=typeof this.source=="function"?this.source():this.source,i=r.width/t.width,a=r.height/t.height,n=this.offsetX/t.width,s=this.offsetY/t.height,o="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(a=1,s&&(a+=Math.abs(s))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(i=1,n&&(i+=Math.abs(n))),r.src?o=r.src:r.toDataURL&&(o=r.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+n+'" y="'+s+'" width="'+i+'" height="'+a+`">
<image x="0" y="0" width="`+r.width+'" height="'+r.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(t){for(var r in t)this[r]=t[r]},toLive:function(t){var r=this.source;if(!r)return"";if(typeof r.src!="undefined"){if(!r.complete)return"";if(r.naturalWidth===0||r.naturalHeight===0)return""}return t.createPattern(r,this.repeat)}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.toFixed;if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(i){typeof i=="string"&&(i=this._parseShadow(i));for(var a in i)this[a]=i[a];this.id=t.Object.__uid++},_parseShadow:function(i){var a=i.trim(),n=t.Shadow.reOffsetsAndBlur.exec(a)||[],s=a.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:s.trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(i){var a=40,n=40,s=t.Object.NUM_FRACTION_DIGITS,o=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-i.angle)),c=20,l=new t.Color(this.color);return i.width&&i.height&&(a=r((Math.abs(o.x)+this.blur)/i.width,s)*100+c,n=r((Math.abs(o.y)+this.blur)/i.height,s)*100+c),i.flipX&&(o.x*=-1),i.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+a+'%" width="'+(100+2*a)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+r(this.blur?this.blur/2:0,s)+`"></feGaussianBlur>
	<feOffset dx="`+r(o.x,s)+'" dy="'+r(o.y,s)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+l.toRgb()+'" flood-opacity="'+l.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var i={},a=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(n){this[n]!==a[n]&&(i[n]=this[n])},this),i}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})((typeof H!="undefined",H));(function(){"use strict";if(p.StaticCanvas){p.warn("fabric.StaticCanvas is already defined.");return}var e=p.util.object.extend,t=p.util.getElementOffset,r=p.util.removeFromArray,i=p.util.toFixed,a=p.util.transformPoint,n=p.util.invertTransform,s=p.util.getNodeCanvas,o=p.util.createCanvasElement,c=new Error("Could not initialize `canvas` element");p.StaticCanvas=p.util.createClass(p.CommonMethods,{initialize:function(l,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(l,h)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:p.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(l,h){var u=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(l),this._initOptions(h),this.interactive||this._initRetinaScaling(),h.overlayImage&&this.setOverlayImage(h.overlayImage,u),h.backgroundImage&&this.setBackgroundImage(h.backgroundImage,u),h.backgroundColor&&this.setBackgroundColor(h.backgroundColor,u),h.overlayColor&&this.setOverlayColor(h.overlayColor,u),this.calcOffset()},_isRetinaScaling:function(){return p.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?p.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling())return;var l=p.devicePixelRatio;this.__initRetinaScaling(l,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(l,this.upperCanvasEl,this.contextTop)},__initRetinaScaling:function(l,h,u){h.setAttribute("width",this.width*l),h.setAttribute("height",this.height*l),u.scale(l,l)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(l,h,u){return this.__setBgOverlayImage("overlayImage",l,h,u)},setBackgroundImage:function(l,h,u){return this.__setBgOverlayImage("backgroundImage",l,h,u)},setOverlayColor:function(l,h){return this.__setBgOverlayColor("overlayColor",l,h)},setBackgroundColor:function(l,h){return this.__setBgOverlayColor("backgroundColor",l,h)},__setBgOverlayImage:function(l,h,u,f){return typeof h=="string"?p.util.loadImage(h,function(d,b){if(d){var g=new p.Image(d,f);this[l]=g,g.canvas=this}u&&u(d,b)},this,f&&f.crossOrigin):(f&&h.setOptions(f),this[l]=h,h&&(h.canvas=this),u&&u(h,!1)),this},__setBgOverlayColor:function(l,h,u){return this[l]=h,this._initGradient(h,l),this._initPattern(h,l,u),this},_createCanvasElement:function(){var l=o();if(!l)throw c;if(l.style||(l.style={}),typeof l.getContext=="undefined")throw c;return l},_initOptions:function(l){var h=this.lowerCanvasEl;if(this._setOptions(l),this.width=this.width||parseInt(h.width,10)||0,this.height=this.height||parseInt(h.height,10)||0,!this.lowerCanvasEl.style)return;h.width=this.width,h.height=this.height,h.style.width=this.width+"px",h.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(l){l&&l.getContext?this.lowerCanvasEl=l:this.lowerCanvasEl=p.util.getById(l)||this._createCanvasElement(),p.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(l,h){return this.setDimensions({width:l},h)},setHeight:function(l,h){return this.setDimensions({height:l},h)},setDimensions:function(l,h){var u;h=h||{};for(var f in l)u=l[f],h.cssOnly||(this._setBackstoreDimension(f,l[f]),u+="px",this.hasLostContext=!0),h.backstoreOnly||this._setCssDimension(f,u);return this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles()),this._initRetinaScaling(),this.calcOffset(),h.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(l,h){return this.lowerCanvasEl[l]=h,this.upperCanvasEl&&(this.upperCanvasEl[l]=h),this.cacheCanvasEl&&(this.cacheCanvasEl[l]=h),this[l]=h,this},_setCssDimension:function(l,h){return this.lowerCanvasEl.style[l]=h,this.upperCanvasEl&&(this.upperCanvasEl.style[l]=h),this.wrapperEl&&(this.wrapperEl.style[l]=h),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(l){var h=this._activeObject,u,f,d;for(this.viewportTransform=l,f=0,d=this._objects.length;f<d;f++)u=this._objects[f],u.group||u.setCoords(!0);return h&&h.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(l,h){var u=l,f=this.viewportTransform.slice(0);l=a(l,n(this.viewportTransform)),f[0]=h,f[3]=h;var d=a(l,f);return f[4]+=u.x-d.x,f[5]+=u.y-d.y,this.setViewportTransform(f)},setZoom:function(l){return this.zoomToPoint(new p.Point(0,0),l),this},absolutePan:function(l){var h=this.viewportTransform.slice(0);return h[4]=-l.x,h[5]=-l.y,this.setViewportTransform(h)},relativePan:function(l){return this.absolutePan(new p.Point(-l.x-this.viewportTransform[4],-l.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(l){this.stateful&&l.setupState(),l._set("canvas",this),l.setCoords(),this.fire("object:added",{target:l}),l.fire("added")},_onObjectRemoved:function(l){this.fire("object:removed",{target:l}),l.fire("removed"),delete l.canvas},clearContext:function(l){return l.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var l=this.contextContainer;return this.renderCanvas(l,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=p.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var l={},h=this.width,u=this.height,f=n(this.viewportTransform);return l.tl=a({x:0,y:0},f),l.br=a({x:h,y:u},f),l.tr=new p.Point(l.br.x,l.tl.y),l.bl=new p.Point(l.tl.x,l.br.y),this.vptCoords=l,l},cancelRequestedRender:function(){this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(l,h){var u=this.viewportTransform,f=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(l),p.util.setImageSmoothing(l,this.imageSmoothingEnabled),this.fire("before:render",{ctx:l}),this._renderBackground(l),l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._renderObjects(l,h),l.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),f&&(f.canvas=this,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(l)),this._renderOverlay(l),this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),this.fire("after:render",{ctx:l})},drawClipPathOnCanvas:function(l){var h=this.viewportTransform,u=this.clipPath;l.save(),l.transform(h[0],h[1],h[2],h[3],h[4],h[5]),l.globalCompositeOperation="destination-in",u.transform(l),l.scale(1/u.zoomX,1/u.zoomY),l.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),l.restore()},_renderObjects:function(l,h){var u,f;for(u=0,f=h.length;u<f;++u)h[u]&&h[u].render(l)},_renderBackgroundOrOverlay:function(l,h){var u=this[h+"Color"],f=this[h+"Image"],d=this.viewportTransform,b=this[h+"Vpt"];if(!u&&!f)return;if(u){l.save(),l.beginPath(),l.moveTo(0,0),l.lineTo(this.width,0),l.lineTo(this.width,this.height),l.lineTo(0,this.height),l.closePath(),l.fillStyle=u.toLive?u.toLive(l,this):u,b&&l.transform(d[0],d[1],d[2],d[3],d[4],d[5]),l.transform(1,0,0,1,u.offsetX||0,u.offsetY||0);var g=u.gradientTransform||u.patternTransform;g&&l.transform(g[0],g[1],g[2],g[3],g[4],g[5]),l.fill(),l.restore()}f&&(l.save(),b&&l.transform(d[0],d[1],d[2],d[3],d[4],d[5]),f.render(l),l.restore())},_renderBackground:function(l){this._renderBackgroundOrOverlay(l,"background")},_renderOverlay:function(l){this._renderBackgroundOrOverlay(l,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(l){return this._centerObject(l,new p.Point(this.getCenter().left,l.getCenterPoint().y))},centerObjectV:function(l){return this._centerObject(l,new p.Point(l.getCenterPoint().x,this.getCenter().top))},centerObject:function(l){var h=this.getCenter();return this._centerObject(l,new p.Point(h.left,h.top))},viewportCenterObject:function(l){var h=this.getVpCenter();return this._centerObject(l,h)},viewportCenterObjectH:function(l){var h=this.getVpCenter();return this._centerObject(l,new p.Point(h.x,l.getCenterPoint().y)),this},viewportCenterObjectV:function(l){var h=this.getVpCenter();return this._centerObject(l,new p.Point(l.getCenterPoint().x,h.y))},getVpCenter:function(){var l=this.getCenter(),h=n(this.viewportTransform);return a({x:l.left,y:l.top},h)},_centerObject:function(l,h){return l.setPositionByOrigin(h,"center","center"),l.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(l){return this.toDatalessObject(l)},toObject:function(l){return this._toObjectMethod("toObject",l)},toDatalessObject:function(l){return this._toObjectMethod("toDatalessObject",l)},_toObjectMethod:function(l,h){var u=this.clipPath,f={version:p.version,objects:this._toObjects(l,h)};return u&&(f.clipPath=this._toObject(this.clipPath,l,h)),e(f,this.__serializeBgOverlay(l,h)),p.util.populateWithProperties(this,f,h),f},_toObjects:function(l,h){return this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){return this._toObject(u,l,h)},this)},_toObject:function(l,h,u){var f;this.includeDefaultValues||(f=l.includeDefaultValues,l.includeDefaultValues=!1);var d=l[h](u);return this.includeDefaultValues||(l.includeDefaultValues=f),d},__serializeBgOverlay:function(l,h){var u={},f=this.backgroundImage,d=this.overlayImage;return this.backgroundColor&&(u.background=this.backgroundColor.toObject?this.backgroundColor.toObject(h):this.backgroundColor),this.overlayColor&&(u.overlay=this.overlayColor.toObject?this.overlayColor.toObject(h):this.overlayColor),f&&!f.excludeFromExport&&(u.backgroundImage=this._toObject(f,l,h)),d&&!d.excludeFromExport&&(u.overlayImage=this._toObject(d,l,h)),u},svgViewportTransformation:!0,toSVG:function(l,h){l||(l={}),l.reviver=h;var u=[];return this._setSVGPreamble(u,l),this._setSVGHeader(u,l),this.clipPath&&u.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(u,"background"),this._setSVGBgOverlayImage(u,"backgroundImage",h),this._setSVGObjects(u,h),this.clipPath&&u.push(`</g>
`),this._setSVGBgOverlayColor(u,"overlay"),this._setSVGBgOverlayImage(u,"overlayImage",h),u.push("</svg>"),u.join("")},_setSVGPreamble:function(l,h){if(h.suppressPreamble)return;l.push('<?xml version="1.0" encoding="',h.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(l,h){var u=h.width||this.width,f=h.height||this.height,d,b='viewBox="0 0 '+this.width+" "+this.height+'" ',g=p.Object.NUM_FRACTION_DIGITS;h.viewBox?b='viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" ':this.svgViewportTransformation&&(d=this.viewportTransform,b='viewBox="'+i(-d[4]/d[0],g)+" "+i(-d[5]/d[3],g)+" "+i(this.width/d[0],g)+" "+i(this.height/d[3],g)+'" '),l.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',u,'" ','height="',f,'" ',b,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",p.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(h),`</defs>
`)},createSVGClipPathMarkup:function(l){var h=this.clipPath;return h?(h.clipPathId="CLIPPATH_"+p.Object.__uid++,'<clipPath id="'+h.clipPathId+`" >
`+this.clipPath.toClipPathSVG(l.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var l=this,h=["background","overlay"].map(function(u){var f=l[u+"Color"];if(f&&f.toLive){var d=l[u+"Vpt"],b=l.viewportTransform,g={width:l.width/(d?b[0]:1),height:l.height/(d?b[3]:1)};return f.toSVG(g,{additionalTransform:d?p.util.matrixToSVG(b):""})}});return h.join("")},createSVGFontFacesMarkup:function(){var l="",h={},u,f,d,b,g,y,S,B,W,X=p.fontPaths,P=[];for(this._objects.forEach(function V(Y){P.push(Y),Y._objects&&Y._objects.forEach(V)}),B=0,W=P.length;B<W;B++){if(u=P[B],f=u.fontFamily,u.type.indexOf("text")===-1||h[f]||!X[f])continue;if(h[f]=!0,!u.styles)continue;d=u.styles;for(g in d){b=d[g];for(S in b)y=b[S],f=y.fontFamily,!h[f]&&X[f]&&(h[f]=!0)}}for(var J in h)l+=[`		@font-face {
`,"			font-family: '",J,`';
`,"			src: url('",X[J],`');
`,`		}
`].join("");return l&&(l=['	<style type="text/css">',`<![CDATA[
`,l,"]]>",`</style>
`].join("")),l},_setSVGObjects:function(l,h){var u,f,d,b=this._objects;for(f=0,d=b.length;f<d;f++){if(u=b[f],u.excludeFromExport)continue;this._setSVGObject(l,u,h)}},_setSVGObject:function(l,h,u){l.push(h.toSVG(u))},_setSVGBgOverlayImage:function(l,h,u){this[h]&&!this[h].excludeFromExport&&this[h].toSVG&&l.push(this[h].toSVG(u))},_setSVGBgOverlayColor:function(l,h){var u=this[h+"Color"],f=this.viewportTransform,d=this.width,b=this.height;if(!u)return;if(u.toLive){var g=u.repeat,y=p.util.invertTransform(f),S=this[h+"Vpt"],B=S?p.util.matrixToSVG(y):"";l.push('<rect transform="'+B+" translate(",d/2,",",b/2,')"',' x="',u.offsetX-d/2,'" y="',u.offsetY-b/2,'" ','width="',g==="repeat-y"||g==="no-repeat"?u.source.width:d,'" height="',g==="repeat-x"||g==="no-repeat"?u.source.height:b,'" fill="url(#SVGID_'+u.id+')"',`></rect>
`)}else l.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',u,'"',`></rect>
`)},sendToBack:function(l){if(!l)return this;var h=this._activeObject,u,f,d;if(l===h&&l.type==="activeSelection")for(d=h._objects,u=d.length;u--;)f=d[u],r(this._objects,f),this._objects.unshift(f);else r(this._objects,l),this._objects.unshift(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(l){if(!l)return this;var h=this._activeObject,u,f,d;if(l===h&&l.type==="activeSelection")for(d=h._objects,u=0;u<d.length;u++)f=d[u],r(this._objects,f),this._objects.push(f);else r(this._objects,l),this._objects.push(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(l,h){if(!l)return this;var u=this._activeObject,f,d,b,g,y,S=0;if(l===u&&l.type==="activeSelection")for(y=u._objects,f=0;f<y.length;f++)d=y[f],b=this._objects.indexOf(d),b>0+S&&(g=b-1,r(this._objects,d),this._objects.splice(g,0,d)),S++;else b=this._objects.indexOf(l),b!==0&&(g=this._findNewLowerIndex(l,b,h),r(this._objects,l),this._objects.splice(g,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(l,h,u){var f,d;if(u)for(f=h,d=h-1;d>=0;--d){var b=l.intersectsWithObject(this._objects[d])||l.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(l);if(b){f=d;break}}else f=h-1;return f},bringForward:function(l,h){if(!l)return this;var u=this._activeObject,f,d,b,g,y,S=0;if(l===u&&l.type==="activeSelection")for(y=u._objects,f=y.length;f--;)d=y[f],b=this._objects.indexOf(d),b<this._objects.length-1-S&&(g=b+1,r(this._objects,d),this._objects.splice(g,0,d)),S++;else b=this._objects.indexOf(l),b!==this._objects.length-1&&(g=this._findNewUpperIndex(l,b,h),r(this._objects,l),this._objects.splice(g,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(l,h,u){var f,d,b;if(u)for(f=h,d=h+1,b=this._objects.length;d<b;++d){var g=l.intersectsWithObject(this._objects[d])||l.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(l);if(g){f=d;break}}else f=h+1;return f},moveTo:function(l,h){return r(this._objects,l),this._objects.splice(h,0,l),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(l){l.dispose&&l.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,p.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(p.StaticCanvas.prototype,p.Observable),e(p.StaticCanvas.prototype,p.Collection),e(p.StaticCanvas.prototype,p.DataURLExporter),e(p.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(l){var h=o();if(!h||!h.getContext)return null;var u=h.getContext("2d");if(!u)return null;switch(l){case"setLineDash":return typeof u.setLineDash!="undefined";default:return null}}}),p.StaticCanvas.prototype.toJSON=p.StaticCanvas.prototype.toObject,p.isLikelyNode&&(p.StaticCanvas.prototype.createPNGStream=function(){var l=s(this.lowerCanvasEl);return l&&l.createPNGStream()},p.StaticCanvas.prototype.createJPEGStream=function(l){var h=s(this.lowerCanvasEl);return h&&h.createJPEGStream(l)})})();p.BaseBrush=p.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,p.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(!this.shadow)return;var e=this.canvas,t=this.shadow,r=e.contextTop,i=e.getZoom();e&&e._isRetinaScaling()&&(i*=p.devicePixelRatio),r.shadowColor=t.color,r.shadowBlur=t.blur*i,r.shadowOffsetX=t.offsetX*i,r.shadowOffsetY=t.offsetY*i},needsFullRender:function(){var e=new p.Color(this.color);return e.getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});(function(){p.PencilBrush=p.util.createClass(p.BaseBrush,{decimate:.4,initialize:function(e){this.canvas=e,this._points=[]},_drawSegment:function(e,t,r){var i=t.midPointFrom(r);return e.quadraticCurveTo(t.x,t.y,i.x,i.y),i},onMouseDown:function(e,t){if(!this.canvas._isMainEvent(t.e))return;this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e,t){if(!this.canvas._isMainEvent(t.e))return;if(this._captureDrawingPath(e)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var r=this._points,i=r.length,a=this.canvas.contextTop;this._saveAndTransform(a),this.oldEnd&&(a.beginPath(),a.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(a,r[i-2],r[i-1],!0),a.stroke(),a.restore()}},onMouseUp:function(e){return this.canvas._isMainEvent(e.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(e){var t=new p.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return this._points.length>1&&e.eq(this._points[this._points.length-1])?!1:(this._points.push(e),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new p.Point(e.x,e.y);return this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t,r,i=this._points[0],a=this._points[1];if(this._saveAndTransform(e),e.beginPath(),this._points.length===2&&i.x===a.x&&i.y===a.y){var n=this.width/1e3;i=new p.Point(i.x,i.y),a=new p.Point(a.x,a.y),i.x-=n,a.x+=n}for(e.moveTo(i.x,i.y),t=1,r=this._points.length;t<r;t++)this._drawSegment(e,i,a),i=this._points[t],a=this._points[t+1];e.lineTo(i.x,i.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=[],r,i=this.width/1e3,a=new p.Point(e[0].x,e[0].y),n=new p.Point(e[1].x,e[1].y),s=e.length,o=1,c=0,l=s>2;for(l&&(o=e[2].x<n.x?-1:e[2].x===n.x?0:1,c=e[2].y<n.y?-1:e[2].y===n.y?0:1),t.push("M ",a.x-o*i," ",a.y-c*i," "),r=1;r<s;r++){if(!a.eq(n)){var h=a.midPointFrom(n);t.push("Q ",a.x," ",a.y," ",h.x," ",h.y," ")}a=e[r],r+1<e.length&&(n=e[r+1])}return l&&(o=a.x>e[r-2].x?1:a.x===e[r-2].x?0:-1,c=a.y>e[r-2].y?1:a.y===e[r-2].y?0:-1),t.push("L ",a.x+o*i," ",a.y+c*i),t},createPath:function(e){var t=new p.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new p.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var r=this.canvas.getZoom(),i=Math.pow(t/r,2),a,n=e.length-1,s=e[0],o=[s],c;for(a=1;a<n;a++)c=Math.pow(s.x-e[a].x,2)+Math.pow(s.y-e[a].y,2),c>=i&&(s=e[a],o.push(s));return o.length===1&&o.push(new p.Point(o[0].x,o[0].y)),o},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var r=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}})})();p.CircleBrush=p.util.createClass(p.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),r=this.canvas.contextTop;this._saveAndTransform(r),this.dot(r,t),r.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e=this.canvas.contextTop,t,r,i=this.points;for(this._saveAndTransform(e),t=0,r=i.length;t<r;t++)this.dot(e,i[t]);e.restore()},onMouseMove:function(e){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,t,r;this.canvas.renderOnAddRemove=!1;var i=[];for(t=0,r=this.points.length;t<r;t++){var a=this.points[t],n=new p.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&(n.shadow=new p.Shadow(this.shadow)),i.push(n)}var s=new p.Group(i);s.canvas=this.canvas,this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},addPoint:function(e){var t=new p.Point(e.x,e.y),r=p.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,i=new p.Color(this.color).setAlpha(p.util.getRandomInt(0,100)/100).toRgba();return t.radius=r,t.fill=i,this.points.push(t),t}});p.SprayBrush=p.util.createClass(p.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],r=0,i=this.sprayChunks.length;r<i;r++)for(var a=this.sprayChunks[r],n=0,s=a.length;n<s;n++){var o=new p.Rect({width:a[n].width,height:a[n].width,left:a[n].x+1,top:a[n].y+1,originX:"center",originY:"center",fill:this.color});t.push(o)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var c=new p.Group(t);this.shadow&&c.set("shadow",new p.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t={},r,i,a;for(i=0,a=e.length;i<a;i++)r=e[i].left+""+e[i].top,t[r]||(t[r]=e[i]);var n=[];for(r in t)n.push(t[r]);return n},render:function(e){var t=this.canvas.contextTop,r,i;for(t.fillStyle=this.color,this._saveAndTransform(t),r=0,i=e.length;r<i;r++){var a=e[r];typeof a.opacity!="undefined"&&(t.globalAlpha=a.opacity),t.fillRect(a.x,a.y,a.width,a.width)}t.restore()},_render:function(){var e=this.canvas.contextTop,t,r;for(e.fillStyle=this.color,this._saveAndTransform(e),t=0,r=this.sprayChunks.length;t<r;t++)this.render(this.sprayChunks[t]);e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,r,i,a=this.width/2,n;for(n=0;n<this.density;n++){t=p.util.getRandomInt(e.x-a,e.x+a),r=p.util.getRandomInt(e.y-a,e.y+a),this.dotWidthVariance?i=p.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):i=this.dotWidth;var s=new p.Point(t,r);s.width=i,this.randomOpacity&&(s.opacity=p.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}});p.PatternBrush=p.util.createClass(p.PencilBrush,{getPatternSrc:function(){var e=20,t=5,r=p.util.createCanvasElement(),i=r.getContext("2d");return r.width=r.height=e+t,i.fillStyle=this.color,i.beginPath(),i.arc(e/2,e/2,e/2,0,Math.PI*2,!1),i.closePath(),i.fill(),r},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),r=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new p.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-r.x,offsetY:-r.y}),t}});(function(){var e=p.util.getPointer,t=p.util.degreesToRadians,r=Math.abs,i=p.StaticCanvas.supports("setLineDash"),a=p.util.isTouchEvent,n=.5;p.Canvas=p.util.createClass(p.StaticCanvas,{initialize:function(o,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=p.PencilBrush&&new p.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o=this.getActiveObjects(),c,l,h;if(o.length>0&&!this.preserveObjectStacking){l=[],h=[];for(var u=0,f=this._objects.length;u<f;u++)c=this._objects[u],o.indexOf(c)===-1?l.push(c):h.push(c);o.length>1&&(this._activeObject._objects=h),l.push.apply(l,h)}else l=this._objects;return l},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var o=this.contextContainer;return this.renderCanvas(o,this._chooseObjectsToRender()),this},renderTopLayer:function(o){o.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(o),this.contextTopDirty=!0),o.restore()},renderTop:function(){var o=this.contextTop;return this.clearContext(o),this.renderTopLayer(o),this.fire("after:render"),this},_normalizePointer:function(o,c){var l=o.calcTransformMatrix(),h=p.util.invertTransform(l),u=this.restorePointerVpt(c);return p.util.transformPoint(u,h)},isTargetTransparent:function(o,c,l){if(o.shouldCache()&&o._cacheCanvas&&o!==this._activeObject){var h=this._normalizePointer(o,{x:c,y:l}),u=Math.max(o.cacheTranslationX+h.x*o.zoomX,0),f=Math.max(o.cacheTranslationY+h.y*o.zoomY,0),y=p.util.isTransparent(o._cacheContext,Math.round(u),Math.round(f),this.targetFindTolerance);return y}var d=this.contextCache,b=o.selectionBackgroundColor,g=this.viewportTransform;o.selectionBackgroundColor="",this.clearContext(d),d.save(),d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),o.render(d),d.restore(),o===this._activeObject&&o._renderControls(d,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),o.selectionBackgroundColor=b;var y=p.util.isTransparent(d,c,l,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(o){var c=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?c=!!this.selectionKey.find(function(l){return o[l]===!0}):c=o[this.selectionKey],c},_shouldClearSelection:function(o,c){var l=this.getActiveObjects(),h=this._activeObject;return!c||c&&h&&l.length>1&&l.indexOf(c)===-1&&h!==c&&!this._isSelectionKeyPressed(o)||c&&!c.evented||c&&!c.selectable&&h&&h!==c},_shouldCenterTransform:function(o,c,l){if(!o)return;var h;return c==="scale"||c==="scaleX"||c==="scaleY"||c==="resizing"?h=this.centeredScaling||o.centeredScaling:c==="rotate"&&(h=this.centeredRotation||o.centeredRotation),h?!l:l},_getOriginFromCorner:function(o,c){var l={x:o.originX,y:o.originY};return c==="ml"||c==="tl"||c==="bl"?l.x="right":(c==="mr"||c==="tr"||c==="br")&&(l.x="left"),c==="tl"||c==="mt"||c==="tr"?l.y="bottom":c==="bl"||c==="mb"||c==="br"?l.y="top":c==="mtr"&&(l.x="center",l.y="center"),l},_getActionFromCorner:function(o,c,l,h){if(!c||!o)return"drag";var u=h.controls[c];return u.getActionName(l,u,h)},_setupCurrentTransform:function(o,c,l){if(!c)return;var h=this.getPointer(o),u=c.__corner,f=l&&u?c.controls[u].getActionHandler():p.controlsUtils.dragHandler,d=this._getActionFromCorner(l,u,o,c),b=this._getOriginFromCorner(c,u),g=o[this.centeredKey],y={target:c,action:d,actionHandler:f,corner:u,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:h.x-c.left,offsetY:h.y-c.top,originX:b.x,originY:b.y,ex:h.x,ey:h.y,lastX:h.x,lastY:h.y,theta:t(c.angle),width:c.width*c.scaleX,shiftKey:o.shiftKey,altKey:g,original:p.util.saveObjectTransform(c)};this._shouldCenterTransform(c,d,g)&&(y.originX="center",y.originY="center"),y.original.originX=b.x,y.original.originY=b.y,this._currentTransform=y,this._beforeTransform(o)},setCursor:function(o){this.upperCanvasEl.style.cursor=o},_drawSelection:function(o){var c=this._groupSelector,l=c.left,h=c.top,u=r(l),f=r(h);if(this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(c.ex-(l>0?0:-l),c.ey-(h>0?0:-h),u,f)),!this.selectionLineWidth||!this.selectionBorderColor)return;if(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!i){var d=c.ex+n-(l>0?0:u),b=c.ey+n-(h>0?0:f);o.beginPath(),p.util.drawDashedLine(o,d,b,d+u,b,this.selectionDashArray),p.util.drawDashedLine(o,d,b+f-1,d+u,b+f-1,this.selectionDashArray),p.util.drawDashedLine(o,d,b,d,b+f,this.selectionDashArray),p.util.drawDashedLine(o,d+u-1,b,d+u-1,b+f,this.selectionDashArray),o.closePath(),o.stroke()}else p.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(c.ex+n-(l>0?0:u),c.ey+n-(h>0?0:f),u,f)},findTarget:function(o,c){if(this.skipTargetFind)return;var l=!0,h=this.getPointer(o,l),u=this._activeObject,f=this.getActiveObjects(),d,b,g=a(o);if(this.targets=[],f.length>1&&!c&&u===this._searchPossibleTargets([u],h))return u;if(f.length===1&&u._findTargetCorner(h,g))return u;if(f.length===1&&u===this._searchPossibleTargets([u],h))if(this.preserveObjectStacking)d=u,b=this.targets,this.targets=[];else return u;var y=this._searchPossibleTargets(this._objects,h);return o[this.altSelectionKey]&&y&&d&&y!==d&&(y=d,this.targets=b),y},_checkTarget:function(o,c,l){if(c&&c.visible&&c.evented&&(c.containsPoint(o)||!!c._findTargetCorner(o)))if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var h=this.isTargetTransparent(c,l.x,l.y);if(!h)return!0}else return!0},_searchPossibleTargets:function(o,c){for(var l,h=o.length,u;h--;){var f=o[h],d=f.group?this._normalizePointer(f.group,c):c;if(this._checkTarget(d,f,c)){l=o[h],l.subTargetCheck&&l instanceof p.Group&&(u=this._searchPossibleTargets(l._objects,c),u&&this.targets.push(u));break}}return l},restorePointerVpt:function(o){return p.util.transformPoint(o,p.util.invertTransform(this.viewportTransform))},getPointer:function(o,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var l=e(o),h=this.upperCanvasEl,u=h.getBoundingClientRect(),f=u.width||0,d=u.height||0,b;(!f||!d)&&("top"in u&&"bottom"in u&&(d=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(f=Math.abs(u.right-u.left))),this.calcOffset(),l.x=l.x-this._offset.left,l.y=l.y-this._offset.top,c||(l=this.restorePointerVpt(l));var g=this.getRetinaScaling();return g!==1&&(l.x/=g,l.y/=g),f===0||d===0?b={width:1,height:1}:b={width:h.width/f,height:h.height/d},{x:l.x*b.width,y:l.y*b.height}},_createUpperCanvas:function(){var o=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,l=this.upperCanvasEl;l?l.className="":(l=this._createCanvasElement(),this.upperCanvasEl=l),p.util.addClass(l,"upper-canvas "+o),this.wrapperEl.appendChild(l),this._copyCanvasStyle(c,l),this._applyCanvasStyle(l),this.contextTop=l.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=p.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),p.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),p.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(o){var c=this.width||o.width,l=this.height||o.height;p.util.setStyle(o,{position:"absolute",width:c+"px",height:l+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),o.width=c,o.height=l,p.util.makeElementUnselectable(o)},_copyCanvasStyle:function(o,c){c.style.cssText=o.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var o=this._activeObject;return o?o.type==="activeSelection"&&o._objects?o._objects.slice(0):[o]:[]},_onObjectRemoved:function(o){o===this._activeObject&&(this.fire("before:selection:cleared",{target:o}),this._discardActiveObject(),this.fire("selection:cleared",{target:o}),o.fire("deselected")),o===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",o)},_fireSelectionEvents:function(o,c){var l=!1,h=this.getActiveObjects(),u=[],f=[],d={e:c};o.forEach(function(b){h.indexOf(b)===-1&&(l=!0,b.fire("deselected",d),f.push(b))}),h.forEach(function(b){o.indexOf(b)===-1&&(l=!0,b.fire("selected",d),u.push(b))}),o.length>0&&h.length>0?(d.selected=u,d.deselected=f,d.updated=u[0]||f[0],d.target=this._activeObject,l&&this.fire("selection:updated",d)):h.length>0?(d.selected=u,d.target=this._activeObject,this.fire("selection:created",d)):o.length>0&&(d.deselected=f,this.fire("selection:cleared",d))},setActiveObject:function(o,c){var l=this.getActiveObjects();return this._setActiveObject(o,c),this._fireSelectionEvents(l,c),this},_setActiveObject:function(o,c){return this._activeObject===o?!1:this._discardActiveObject(c,o)?o.onSelect({e:c})?!1:(this._activeObject=o,!0):!1},_discardActiveObject:function(o,c){var l=this._activeObject;if(l){if(l.onDeselect({e:o,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(o){var c=this.getActiveObjects(),l=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:l,e:o}),this._discardActiveObject(o),this._fireSelectionEvents(c,o),this},dispose:function(){var o=this.wrapperEl;return this.removeListeners(),o.removeChild(this.upperCanvasEl),o.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(c){p.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this)),o.parentNode&&o.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,p.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(o){var c=this._activeObject;c&&c._renderControls(o)},_toObject:function(o,c,l){var h=this._realizeGroupTransformOnObject(o),u=this.callSuper("_toObject",o,c,l);return this._unwindGroupTransformOnObject(o,h),u},_realizeGroupTransformOnObject:function(o){if(o.group&&o.group.type==="activeSelection"&&this._activeObject===o.group){var c=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],l={};return c.forEach(function(h){l[h]=o[h]}),this._activeObject.realizeTransform(o),l}else return null},_unwindGroupTransformOnObject:function(o,c){c&&o.set(c)},_setSVGObject:function(o,c,l){var h=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",o,c,l),this._unwindGroupTransformOnObject(c,h)},setViewportTransform:function(o){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),p.StaticCanvas.prototype.setViewportTransform.call(this,o)}});for(var s in p.StaticCanvas)s!=="prototype"&&(p.Canvas[s]=p.StaticCanvas[s])})();(function(){var e=p.util.addListener,t=p.util.removeListener,r=3,i=2,a=1,n={passive:!1};function s(o,c){return o.button&&o.button===c-1}p.util.object.extend(p.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,c){var l=this.upperCanvasEl,h=this._getEventPrefix();o(p.window,"resize",this._onResize),o(l,h+"down",this._onMouseDown),o(l,h+"move",this._onMouseMove,n),o(l,h+"out",this._onMouseOut),o(l,h+"enter",this._onMouseEnter),o(l,"wheel",this._onMouseWheel),o(l,"contextmenu",this._onContextMenu),o(l,"dblclick",this._onDoubleClick),o(l,"dragover",this._onDragOver),o(l,"dragenter",this._onDragEnter),o(l,"dragleave",this._onDragLeave),o(l,"drop",this._onDrop),this.enablePointerEvents||o(l,"touchstart",this._onTouchStart,n),typeof eventjs!="undefined"&&c in eventjs&&(eventjs[c](l,"gesture",this._onGesture),eventjs[c](l,"drag",this._onDrag),eventjs[c](l,"orientation",this._onOrientationChange),eventjs[c](l,"shake",this._onShake),eventjs[c](l,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var o=this._getEventPrefix();t(p.document,o+"up",this._onMouseUp),t(p.document,"touchend",this._onTouchEnd,n),t(p.document,o+"move",this._onMouseMove,n),t(p.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){if(this.eventsBound)return;this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0},_onGesture:function(o,c){this.__onTransformGesture&&this.__onTransformGesture(o,c)},_onDrag:function(o,c){this.__onDrag&&this.__onDrag(o,c)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var c=this._hoveredTarget;this.fire("mouse:out",{target:c,e:o}),this._hoveredTarget=null,c&&c.fire("mouseout",{e:o});var l=this;this._hoveredTargets.forEach(function(h){l.fire("mouse:out",{target:c,e:o}),h&&c.fire("mouseout",{e:o})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(h){h.isEditing&&h.hiddenTextarea.focus()})},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,c){this.__onOrientationChange&&this.__onOrientationChange(o,c)},_onShake:function(o,c){this.__onShake&&this.__onShake(o,c)},_onLongPress:function(o,c){this.__onLongPress&&this.__onLongPress(o,c)},_onDragOver:function(o){o.preventDefault();var c=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(c,o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var c=o.changedTouches;return c?c[0]&&c[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0?!0:o.isPrimary===!1?!1:o.type==="touchend"&&o.touches.length===0?!0:o.changedTouches?o.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();e(p.document,"touchend",this._onTouchEnd,n),e(p.document,"touchmove",this._onMouseMove,n),t(c,l+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();t(c,l+"move",this._onMouseMove,n),e(p.document,l+"up",this._onMouseUp),e(p.document,l+"move",this._onMouseMove,n)},_onTouchEnd:function(o){if(o.touches.length>0)return;this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var c=this._getEventPrefix();t(p.document,"touchend",this._onTouchEnd,n),t(p.document,"touchmove",this._onMouseMove,n);var l=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(l.upperCanvasEl,c+"down",l._onMouseDown),l._willAddMouseDown=0},400)},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();this._isMainEvent(o)&&(t(p.document,l+"up",this._onMouseUp),t(p.document,l+"move",this._onMouseMove,n),e(c,l+"move",this._onMouseMove,n))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var c=this._activeObject;return!!c!==!!o||c&&o&&c!==o?!0:(c&&c.isEditing,!1)},__onMouseUp:function(o){var c,l=this._currentTransform,h=this._groupSelector,u=!1,f=!h||h.left===0&&h.top===0;if(this._cacheTransformEventData(o),c=this._target,this._handleEvent(o,"up:before"),s(o,r)){this.fireRightClick&&this._handleEvent(o,"up",r,f);return}if(s(o,i)){this.fireMiddleClick&&this._handleEvent(o,"up",i,f),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(o);return}if(!this._isMainEvent(o))return;if(l&&(this._finalizeCurrentTransform(o),u=l.actionPerformed),!f){var d=c===this._activeObject;this._maybeGroupObjects(o),u||(u=this._shouldRender(c)||!d&&c===this._activeObject)}if(c){var b=c._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o)),g=c.controls[b],y=g&&g.getMouseUpHandler(o,c,g);y&&y(o,c,g),c.isMoving=!1}this._setCursorFromEvent(o,c),this._handleEvent(o,"up",a,f),this._groupSelector=null,this._currentTransform=null,c&&(c.__corner=0),u?this.requestRenderAll():f||this.renderTop()},_simpleEventHandler:function(o,c){var l=this.findTarget(c),h=this.targets,u={e:c,target:l,subTargets:h};if(this.fire(o,u),l&&l.fire(o,u),!h)return l;for(var f=0;f<h.length;f++)h[f].fire(o,u);return l},_handleEvent:function(o,c,l,h){var u=this._target,f=this.targets||[],d={e:o,target:u,subTargets:f,button:l||a,isClick:h||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};c==="up"&&(d.currentTarget=this.findTarget(o),d.currentSubTargets=this.targets),this.fire("mouse:"+c,d),u&&u.fire("mouse"+c,d);for(var b=0;b<f.length;b++)f[b].fire("mouse"+c,d)},_finalizeCurrentTransform:function(o){var c=this._currentTransform,l=c.target,h,u={e:o,target:l,transform:c,action:c.action};l._scaling&&(l._scaling=!1),l.setCoords(),(c.actionPerformed||this.stateful&&l.hasStateChanged())&&(c.actionPerformed&&(h=this._addEventOptions(u,c),this._fire(h,u)),this._fire("modified",u))},_addEventOptions:function(o,c){var l,h;switch(c.action){case"scaleX":l="scaled",h="x";break;case"scaleY":l="scaled",h="y";break;case"skewX":l="skewed",h="x";break;case"skewY":l="skewed",h="y";break;case"scale":l="scaled",h="equally";break;case"rotate":l="rotated";break;case"drag":l="moved";break}return o.by=h,l},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var c=this.getPointer(o);this.freeDrawingBrush.onMouseDown(c,{e:o,pointer:c}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var c=this.getPointer(o);this.freeDrawingBrush.onMouseMove(c,{e:o,pointer:c})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var c=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:c}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var c=this._target;if(s(o,r)){this.fireRightClick&&this._handleEvent(o,"down",r);return}if(s(o,i)){this.fireMiddleClick&&this._handleEvent(o,"down",i);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(o);return}if(!this._isMainEvent(o))return;if(this._currentTransform)return;var l=this._pointer;this._previousPointer=l;var h=this._shouldRender(c),u=this._shouldGroup(o,c);if(this._shouldClearSelection(o,c)?this.discardActiveObject(o):u&&(this._handleGrouping(o,c),c=this._activeObject),this.selection&&(!c||!c.selectable&&!c.isEditing&&c!==this._activeObject)&&(this._groupSelector={ex:l.x,ey:l.y,top:0,left:0}),c){var f=c===this._activeObject;c.selectable&&this.setActiveObject(c,o);var d=c._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o));if(c.__corner=d,c===this._activeObject&&(d||!u)){var b=c.controls[d],g=b&&b.getMouseDownHandler(o,c,b);g&&g(o,c,b),this._setupCurrentTransform(o,c,f)}}this._handleEvent(o,"down"),(h||u)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var c=this._currentTransform;this.stateful&&c.target.saveState(),this.fire("before:transform",{e:o,transform:c})},__onMouseMove:function(o){this._handleEvent(o,"move:before"),this._cacheTransformEventData(o);var c,l;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(o);return}if(!this._isMainEvent(o))return;var h=this._groupSelector;h?(l=this._pointer,h.left=l.x-h.ex,h.top=l.y-h.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(c=this.findTarget(o)||null,this._setCursorFromEvent(o,c),this._fireOverOutEvents(c,o)),this._handleEvent(o,"move"),this._resetTransformEventData()},_fireOverOutEvents:function(o,c){var l=this._hoveredTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:l,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var d=0;d<f;d++)this.fireSyntheticInOutEvents(u[d],c,{oldTarget:h[d],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,c){var l=this._draggedoverTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:l,evtOut:"dragleave",evtIn:"dragenter"});for(var d=0;d<f;d++)this.fireSyntheticInOutEvents(u[d],c,{oldTarget:h[d],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,c,l){var h,u,f=l.oldTarget,d,b,g=f!==o,y=l.canvasEvtIn,S=l.canvasEvtOut;g&&(h={e:c,target:o,previousTarget:f},u={e:c,target:f,nextTarget:o}),b=o&&g,d=f&&g,d&&(S&&this.fire(S,u),f.fire(l.evtOut,u)),b&&(y&&this.fire(y,h),o.fire(l.evtIn,h))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var c=this.getPointer(o),l=this._currentTransform;l.reset=!1,l.target.isMoving=!0,l.shiftKey=o.shiftKey,l.altKey=o[this.centeredKey],this._performTransformAction(o,l,c),l.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,c,l){var h=l.x,u=l.y,f=c.action,d=!1,b=c.actionHandler;b&&(d=b(o,c,h,u)),f==="drag"&&d&&this.setCursor(c.target.moveCursor||this.moveCursor),c.actionPerformed=c.actionPerformed||d},_fire:p.controlsUtils.fireEvent,_setCursorFromEvent:function(o,c){if(!c)return this.setCursor(this.defaultCursor),!1;var l=c.hoverCursor||this.hoverCursor,h=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,u=(!h||!h.contains(c))&&c._findTargetCorner(this.getPointer(o,!0));u?this.setCursor(this.getCornerCursor(u,c,o)):(c.subTargetCheck&&this.targets.concat().reverse().map(function(f){l=f.hoverCursor||l}),this.setCursor(l))},getCornerCursor:function(o,c,l){var h=c.controls[o];return h.cursorStyleHandler(l,h,c)}})})();(function(){var e=Math.min,t=Math.max;p.util.object.extend(p.Canvas.prototype,{_shouldGroup:function(r,i){var a=this._activeObject;return a&&this._isSelectionKeyPressed(r)&&i&&i.selectable&&this.selection&&(a!==i||a.type==="activeSelection")&&!i.onSelect({e:r})},_handleGrouping:function(r,i){var a=this._activeObject;if(a.__corner)return;if(i===a&&(i=this.findTarget(r,!0),!i||!i.selectable))return;a&&a.type==="activeSelection"?this._updateActiveSelection(i,r):this._createActiveSelection(i,r)},_updateActiveSelection:function(r,i){var a=this._activeObject,n=a._objects.slice(0);a.contains(r)?(a.removeWithUpdate(r),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat(),a.size()===1&&this._setActiveObject(a.item(0),i)):(a.addWithUpdate(r),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,i)},_createActiveSelection:function(r,i){var a=this.getActiveObjects(),n=this._createGroup(r);this._hoveredTarget=n,this._setActiveObject(n,i),this._fireSelectionEvents(a,i)},_createGroup:function(r){var i=this._objects,a=i.indexOf(this._activeObject)<i.indexOf(r),n=a?[this._activeObject,r]:[r,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new p.ActiveSelection(n,{canvas:this})},_groupSelectedObjects:function(r){var i=this._collectObjects(r),a;i.length===1?this.setActiveObject(i[0],r):i.length>1&&(a=new p.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(a,r))},_collectObjects:function(r){for(var i=[],a,n=this._groupSelector.ex,s=this._groupSelector.ey,o=n+this._groupSelector.left,c=s+this._groupSelector.top,l=new p.Point(e(n,o),e(s,c)),h=new p.Point(t(n,o),t(s,c)),u=!this.selectionFullyContained,f=n===o&&s===c,d=this._objects.length;d--;){if(a=this._objects[d],!a||!a.selectable||!a.visible)continue;if((u&&a.intersectsWithRect(l,h)||a.isContainedWithinRect(l,h)||u&&a.containsPoint(l)||u&&a.containsPoint(h))&&(i.push(a),f))break}return i.length>1&&(i=i.filter(function(b){return!b.onSelect({e:r})})),i},_maybeGroupObjects:function(r){this.selection&&this._groupSelector&&this._groupSelectedObjects(r),this.setCursor(this.defaultCursor),this._groupSelector=null}})})();(function(){p.util.object.extend(p.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",r=e.quality||1,i=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),a=this.toCanvasElement(i,e);return p.util.toDataURL(a,t,r)},toCanvasElement:function(e,t){e=e||1,t=t||{};var r=(t.width||this.width)*e,i=(t.height||this.height)*e,a=this.getZoom(),n=this.width,s=this.height,o=a*e,c=this.viewportTransform,l=(c[4]-(t.left||0))*e,h=(c[5]-(t.top||0))*e,u=this.interactive,f=[o,0,0,o,l,h],d=this.enableRetinaScaling,b=p.util.createCanvasElement(),g=this.contextTop;return b.width=r,b.height=i,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=r,this.height=i,this.calcViewportBoundaries(),this.renderCanvas(b.getContext("2d"),this._objects),this.viewportTransform=c,this.width=n,this.height=s,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=d,this.contextTop=g,b}})})();p.util.object.extend(p.StaticCanvas.prototype,{loadFromJSON:function(e,t,r){if(!e)return;var i=typeof e=="string"?JSON.parse(e):p.util.object.clone(e),a=this,n=i.clipPath,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete i.clipPath,this._enlivenObjects(i.objects,function(o){a.clear(),a._setBgOverlay(i,function(){n?a._enlivenObjects([n],function(c){a.clipPath=c[0],a.__setupCanvas.call(a,i,o,s,t)}):a.__setupCanvas.call(a,i,o,s,t)})},r),this},__setupCanvas:function(e,t,r,i){var a=this;t.forEach(function(n,s){a.insertAt(n,s)}),this.renderOnAddRemove=r,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),i&&i()},_setBgOverlay:function(e,t){var r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var i=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(t&&t())};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,i),this.__setBgOverlay("overlayImage",e.overlayImage,r,i),this.__setBgOverlay("backgroundColor",e.background,r,i),this.__setBgOverlay("overlayColor",e.overlay,r,i)},__setBgOverlay:function(e,t,r,i){var a=this;if(!t){r[e]=!0,i&&i();return}e==="backgroundImage"||e==="overlayImage"?p.util.enlivenObjects([t],function(n){a[e]=n[0],r[e]=!0,i&&i()}):this["set"+p.util.string.capitalize(e,!0)](t,function(){r[e]=!0,i&&i()})},_enlivenObjects:function(e,t,r){if(!e||e.length===0){t&&t([]);return}p.util.enlivenObjects(e,function(i){t&&t(i)},null,r)},_toDataURL:function(e,t){this.clone(function(r){t(r.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,r){this.clone(function(i){r(i.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var r=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(i){i.loadFromJSON(r,function(){e&&e(i)})})},cloneWithoutData:function(e){var t=p.util.createCanvasElement();t.width=this.width,t.height=this.height;var r=new p.Canvas(t);this.backgroundImage?(r.setBackgroundImage(this.backgroundImage.src,function(){r.renderAll(),e&&e(r)}),r.backgroundImageOpacity=this.backgroundImageOpacity,r.backgroundImageStretch=this.backgroundImageStretch):e&&e(r)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,a=t.util.toFixed,n=t.util.string.capitalize,s=t.util.degreesToRadians,o=t.StaticCanvas.supports("setLineDash"),c=!t.isLikelyNode,l=2;if(t.Object)return;t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(h){h&&this.setOptions(h)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(h){var u=t.perfLimitSizeTotal,f=h.width,d=h.height,b=t.maxCacheSideLimit,g=t.minCacheSideLimit;if(f<=b&&d<=b&&f*d<=u)return f<g&&(h.width=g),d<g&&(h.height=g),h;var y=f/d,S=t.util.limitDimsByArea(y,u),B=t.util.capValue,W=B(g,S.x,b),X=B(g,S.y,b);return f>W&&(h.zoomX/=f/W,h.width=W,h.capped=!0),d>X&&(h.zoomY/=d/X,h.height=X,h.capped=!0),h},_getCacheCanvasDimensions:function(){var h=this.getTotalObjectScaling(),u=this._getTransformedDimensions(0,0),f=u.x*h.scaleX/this.scaleX,d=u.y*h.scaleY/this.scaleY;return{width:f+l,height:d+l,zoomX:h.scaleX,zoomY:h.scaleY,x:f,y:d}},_updateCacheCanvas:function(){var h=this.canvas;if(this.noScaleCache&&h&&h._currentTransform){var u=h._currentTransform.target,f=h._currentTransform.action;if(this===u&&f.slice&&f.slice(0,5)==="scale")return!1}var d=this._cacheCanvas,b=this._limitCacheSize(this._getCacheCanvasDimensions()),g=t.minCacheSideLimit,y=b.width,S=b.height,B,W,X=b.zoomX,P=b.zoomY,J=y!==this.cacheWidth||S!==this.cacheHeight,V=this.zoomX!==X||this.zoomY!==P,Y=J||V,R=0,N=0,k=!1;if(J){var w=this._cacheCanvas.width,E=this._cacheCanvas.height,I=y>w||S>E,O=(y<w*.9||S<E*.9)&&w>g&&E>g;k=I||O,I&&!b.capped&&(y>g||S>g)&&(R=y*.1,N=S*.1)}return Y?(k?(d.width=Math.ceil(y+R),d.height=Math.ceil(S+N)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,d.width,d.height)),B=b.x/2,W=b.y/2,this.cacheTranslationX=Math.round(d.width/2-B)+B,this.cacheTranslationY=Math.round(d.height/2-W)+W,this.cacheWidth=y,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(X,P),this.zoomX=X,this.zoomY=P,!0):!1},setOptions:function(h){this._setOptions(h),this._initGradient(h.fill,"fill"),this._initGradient(h.stroke,"stroke"),this._initPattern(h.fill,"fill"),this._initPattern(h.stroke,"stroke")},transform:function(h){var u=this.group&&!this.group._transformDone||this.group&&this.canvas&&h===this.canvas.contextTop,f=this.calcTransformMatrix(!u);h.transform(f[0],f[1],f[2],f[3],f[4],f[5])},toObject:function(h){var u=t.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:a(this.left,u),top:a(this.top,u),width:a(this.width,u),height:a(this.height,u),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,u),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,u),scaleX:a(this.scaleX,u),scaleY:a(this.scaleY,u),angle:a(this.angle,u),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,u),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:a(this.skewX,u),skewY:a(this.skewY,u)};return this.clipPath&&(f.clipPath=this.clipPath.toObject(h),f.clipPath.inverted=this.clipPath.inverted,f.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,f,h),this.includeDefaultValues||(f=this._removeDefaultValues(f)),f},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(h){var u=t.util.getKlass(h.type).prototype,f=u.stateProperties;return f.forEach(function(d){if(d==="left"||d==="top")return;h[d]===u[d]&&delete h[d];var b=Object.prototype.toString.call(h[d])==="[object Array]"&&Object.prototype.toString.call(u[d])==="[object Array]";b&&h[d].length===0&&u[d].length===0&&delete h[d]}),h},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){var h=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(h.scaleX),scaleY:Math.abs(h.scaleY)}},getTotalObjectScaling:function(){var h=this.getObjectScaling(),u=h.scaleX,f=h.scaleY;if(this.canvas){var d=this.canvas.getZoom(),b=this.canvas.getRetinaScaling();u*=d*b,f*=d*b}return{scaleX:u,scaleY:f}},getObjectOpacity:function(){var h=this.opacity;return this.group&&(h*=this.group.getObjectOpacity()),h},_set:function(h,u){var f=h==="scaleX"||h==="scaleY",d=this[h]!==u,b=!1;return f&&(u=this._constrainScale(u)),h==="scaleX"&&u<0?(this.flipX=!this.flipX,u*=-1):h==="scaleY"&&u<0?(this.flipY=!this.flipY,u*=-1):h==="shadow"&&u&&!(u instanceof t.Shadow)?u=new t.Shadow(u):h==="dirty"&&this.group&&this.group.set("dirty",u),this[h]=u,d&&(b=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(h)>-1?(this.dirty=!0,b&&this.group.set("dirty",!0)):b&&this.stateProperties.indexOf(h)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(h){if(this.isNotVisible())return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;h.save(),this._setupCompositeOperation(h),this.drawSelectionBackground(h),this.transform(h),this._setOpacity(h),this._setShadow(h,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(h)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(h),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),h.restore()},renderCache:function(h){h=h||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,h.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"?!0:!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(h){var u=this.clipPath;if(h.save(),u.inverted?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="destination-in",u.absolutePositioned){var f=t.util.invertTransform(this.calcTransformMatrix());h.transform(f[0],f[1],f[2],f[3],f[4],f[5])}u.transform(h),h.scale(1/u.zoomX,1/u.zoomY),h.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),h.restore()},drawObject:function(h,u){var f=this.fill,d=this.stroke;u?(this.fill="black",this.stroke="",this._setClippingProperties(h)):(this._renderBackground(h),this._setStrokeStyles(h,this),this._setFillStyles(h,this)),this._render(h),this._drawClipPath(h),this.fill=f,this.stroke=d},_drawClipPath:function(h){var u=this.clipPath;if(!u)return;u.canvas=this.canvas,u.shouldCache(),u._transformDone=!0,u.renderCache({forClipping:!0}),this.drawClipPathOnCache(h)},drawCacheOnCanvas:function(h){h.scale(1/this.zoomX,1/this.zoomY),h.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(h){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!h&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!h){var u=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-u/2,-f/2,u,f)}return!0}return!1},_renderBackground:function(h){if(!this.backgroundColor)return;var u=this._getNonTransformedDimensions();h.fillStyle=this.backgroundColor,h.fillRect(-u.x/2,-u.y/2,u.x,u.y),this._removeShadow(h)},_setOpacity:function(h){this.group&&!this.group._transformDone?h.globalAlpha=this.getObjectOpacity():h.globalAlpha*=this.opacity},_setStrokeStyles:function(h,u){u.stroke&&(h.lineWidth=u.strokeWidth,h.lineCap=u.strokeLineCap,h.lineDashOffset=u.strokeDashOffset,h.lineJoin=u.strokeLineJoin,h.miterLimit=u.strokeMiterLimit,h.strokeStyle=u.stroke.toLive?u.stroke.toLive(h,this):u.stroke)},_setFillStyles:function(h,u){u.fill&&(h.fillStyle=u.fill.toLive?u.fill.toLive(h,this):u.fill)},_setClippingProperties:function(h){h.globalAlpha=1,h.strokeStyle="transparent",h.fillStyle="#000000"},_setLineDash:function(h,u,f){if(!u||u.length===0)return;1&u.length&&u.push.apply(u,u),o?h.setLineDash(u):f&&f(h)},_renderControls:function(h,u){var f=this.getViewportTransform(),d=this.calcTransformMatrix(),b,g,y;u=u||{},g=typeof u.hasBorders!="undefined"?u.hasBorders:this.hasBorders,y=typeof u.hasControls!="undefined"?u.hasControls:this.hasControls,d=t.util.multiplyTransformMatrices(f,d),b=t.util.qrDecompose(d),h.save(),h.translate(b.translateX,b.translateY),h.lineWidth=1*this.borderScaleFactor,this.group||(h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),u.forActiveSelection?(h.rotate(s(b.angle)),g&&this.drawBordersInGroup(h,b,u)):(h.rotate(s(this.angle)),g&&this.drawBorders(h,u)),y&&this.drawControls(h,u),h.restore()},_setShadow:function(h){if(!this.shadow)return;var u=this.shadow,f=this.canvas,d,b=f&&f.viewportTransform[0]||1,g=f&&f.viewportTransform[3]||1;u.nonScaling?d={scaleX:1,scaleY:1}:d=this.getObjectScaling(),f&&f._isRetinaScaling()&&(b*=t.devicePixelRatio,g*=t.devicePixelRatio),h.shadowColor=u.color,h.shadowBlur=u.blur*t.browserShadowBlurConstant*(b+g)*(d.scaleX+d.scaleY)/4,h.shadowOffsetX=u.offsetX*b*d.scaleX,h.shadowOffsetY=u.offsetY*g*d.scaleY},_removeShadow:function(h){if(!this.shadow)return;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_applyPatternGradientTransform:function(h,u){if(!u||!u.toLive)return{offsetX:0,offsetY:0};var f=u.gradientTransform||u.patternTransform,d=-this.width/2+u.offsetX||0,b=-this.height/2+u.offsetY||0;return u.gradientUnits==="percentage"?h.transform(this.width,0,0,this.height,d,b):h.transform(1,0,0,1,d,b),f&&h.transform(f[0],f[1],f[2],f[3],f[4],f[5]),{offsetX:d,offsetY:b}},_renderPaintInOrder:function(h){this.paintFirst==="stroke"?(this._renderStroke(h),this._renderFill(h)):(this._renderFill(h),this._renderStroke(h))},_render:function(){},_renderFill:function(h){if(!this.fill)return;h.save(),this._applyPatternGradientTransform(h,this.fill),this.fillRule==="evenodd"?h.fill("evenodd"):h.fill(),h.restore()},_renderStroke:function(h){if(!this.stroke||this.strokeWidth===0)return;if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeUniform&&this.group){var u=this.getObjectScaling();h.scale(1/u.scaleX,1/u.scaleY)}else this.strokeUniform&&h.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(h,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(h,this.stroke):this._applyPatternGradientTransform(h,this.stroke),h.stroke(),h.restore()},_applyPatternForTransformedGradient:function(h,u){var f=this._limitCacheSize(this._getCacheCanvasDimensions()),d=t.util.createCanvasElement(),b,g=this.canvas.getRetinaScaling(),y=f.x/this.scaleX/g,S=f.y/this.scaleY/g;d.width=y,d.height=S,b=d.getContext("2d"),b.beginPath(),b.moveTo(0,0),b.lineTo(y,0),b.lineTo(y,S),b.lineTo(0,S),b.closePath(),b.translate(y/2,S/2),b.scale(f.zoomX/this.scaleX/g,f.zoomY/this.scaleY/g),this._applyPatternGradientTransform(b,u),b.fillStyle=u.toLive(h),b.fill(),h.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),h.scale(g*this.scaleX/f.zoomX,g*this.scaleY/f.zoomY),h.strokeStyle=b.createPattern(d,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var h=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",h.scaleX),this.set("scaleY",h.scaleY),this.angle=h.angle,this.skewX=h.skewX,this.skewY=0}},_removeTransformMatrix:function(h){var u=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),u=t.util.transformPoint(u,this.transformMatrix)),this.transformMatrix=null,h&&(this.scaleX*=h.scaleX,this.scaleY*=h.scaleY,this.cropX=h.cropX,this.cropY=h.cropY,u.x+=h.offsetLeft,u.y+=h.offsetTop,this.width=h.width,this.height=h.height),this.setPositionByOrigin(u,"center","center")},clone:function(h,u){var f=this.toObject(u);this.constructor.fromObject?this.constructor.fromObject(f,h):t.Object._fromObject("Object",f,h)},cloneAsImage:function(h,u){var f=this.toCanvasElement(u);return h&&h(new t.Image(f)),this},toCanvasElement:function(h){h||(h={});var u=t.util,f=u.saveObjectTransform(this),d=this.group,b=this.shadow,g=Math.abs,y=(h.multiplier||1)*(h.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,h.withoutTransform&&u.resetObjectTransform(this),h.withoutShadow&&(this.shadow=null);var S=t.util.createCanvasElement(),B=this.getBoundingRect(!0,!0),W=this.shadow,X,P={x:0,y:0},J,V,Y;W&&(J=W.blur,W.nonScaling?X={scaleX:1,scaleY:1}:X=this.getObjectScaling(),P.x=2*Math.round(g(W.offsetX)+J)*g(X.scaleX),P.y=2*Math.round(g(W.offsetY)+J)*g(X.scaleY)),V=B.width+P.x,Y=B.height+P.y,S.width=Math.ceil(V),S.height=Math.ceil(Y);var R=new t.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});h.format==="jpeg"&&(R.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(R.width/2,R.height/2),"center","center");var N=this.canvas;R.add(this);var k=R.toCanvasElement(y||1,h);return this.shadow=b,this.set("canvas",N),d&&(this.group=d),this.set(f).setCoords(),R._objects=[],R.dispose(),R=null,k},toDataURL:function(h){return h||(h={}),t.util.toDataURL(this.toCanvasElement(h),h.format||"png",h.quality||1)},isType:function(h){return this.type===h},complexity:function(){return 1},toJSON:function(h){return this.toObject(h)},rotate:function(h){var u=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return u&&this._setOriginToCenter(),this.set("angle",h),u&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(h,u){u=u||this.canvas.getPointer(h);var f=new t.Point(u.x,u.y),d=this._getLeftTopCoords();return this.angle&&(f=t.util.rotatePoint(f,d,s(-this.angle))),{x:f.x-d.x,y:f.y-d.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),r(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(h,u,f,d){var b=t[h];u=i(u,!0),t.util.enlivenPatterns([u.fill,u.stroke],function(g){typeof g[0]!="undefined"&&(u.fill=g[0]),typeof g[1]!="undefined"&&(u.stroke=g[1]),t.util.enlivenObjects([u.clipPath],function(y){u.clipPath=y[0];var S=d?new b(u[d],u):new b(u);f&&f(S)})})},t.Object.__uid=0})((typeof H!="undefined",H));(function(){var e=p.util.degreesToRadians,t={left:-.5,center:0,right:.5},r={top:-.5,center:0,bottom:.5};p.util.object.extend(p.Object.prototype,{translateToGivenOrigin:function(i,a,n,s,o){var c=i.x,l=i.y,h,u,f;return typeof a=="string"?a=t[a]:a-=.5,typeof s=="string"?s=t[s]:s-=.5,h=s-a,typeof n=="string"?n=r[n]:n-=.5,typeof o=="string"?o=r[o]:o-=.5,u=o-n,(h||u)&&(f=this._getTransformedDimensions(),c=i.x+h*f.x,l=i.y+u*f.y),new p.Point(c,l)},translateToCenterPoint:function(i,a,n){var s=this.translateToGivenOrigin(i,a,n,"center","center");return this.angle?p.util.rotatePoint(s,i,e(this.angle)):s},translateToOriginPoint:function(i,a,n){var s=this.translateToGivenOrigin(i,"center","center",a,n);return this.angle?p.util.rotatePoint(s,i,e(this.angle)):s},getCenterPoint:function(){var i=new p.Point(this.left,this.top);return this.translateToCenterPoint(i,this.originX,this.originY)},getPointByOrigin:function(i,a){var n=this.getCenterPoint();return this.translateToOriginPoint(n,i,a)},toLocalPoint:function(i,a,n){var s=this.getCenterPoint(),o,c;return typeof a!="undefined"&&typeof n!="undefined"?o=this.translateToGivenOrigin(s,"center","center",a,n):o=new p.Point(this.left,this.top),c=new p.Point(i.x,i.y),this.angle&&(c=p.util.rotatePoint(c,s,-e(this.angle))),c.subtractEquals(o)},setPositionByOrigin:function(i,a,n){var s=this.translateToCenterPoint(i,a,n),o=this.translateToOriginPoint(s,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(i){var a=e(this.angle),n=this.getScaledWidth(),s=p.util.cos(a)*n,o=p.util.sin(a)*n,c,l;typeof this.originX=="string"?c=t[this.originX]:c=this.originX-.5,typeof i=="string"?l=t[i]:l=i-.5,this.left+=s*(l-c),this.top+=o*(l-c),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var i=this.getCenterPoint();this.originX="center",this.originY="center",this.left=i.x,this.top=i.y},_resetOrigin:function(){var i=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=i.x,this.top=i.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function e(n){return[new p.Point(n.tl.x,n.tl.y),new p.Point(n.tr.x,n.tr.y),new p.Point(n.br.x,n.br.y),new p.Point(n.bl.x,n.bl.y)]}var t=p.util,r=t.degreesToRadians,i=t.multiplyTransformMatrices,a=t.transformPoint;t.object.extend(p.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(n,s){return s?n?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),n?this.aCoords:this.lineCoords)},getCoords:function(n,s){return e(this._getCoords(n,s))},intersectsWithRect:function(n,s,o,c){var l=this.getCoords(o,c),h=p.Intersection.intersectPolygonRectangle(l,n,s);return h.status==="Intersection"},intersectsWithObject:function(n,s,o){var c=p.Intersection.intersectPolygonPolygon(this.getCoords(s,o),n.getCoords(s,o));return c.status==="Intersection"||n.isContainedWithinObject(this,s,o)||this.isContainedWithinObject(n,s,o)},isContainedWithinObject:function(n,s,o){for(var c=this.getCoords(s,o),l=s?n.aCoords:n.lineCoords,h=0,u=n._getImageLines(l);h<4;h++)if(!n.containsPoint(c[h],u))return!1;return!0},isContainedWithinRect:function(n,s,o,c){var l=this.getBoundingRect(o,c);return l.left>=n.x&&l.left+l.width<=s.x&&l.top>=n.y&&l.top+l.height<=s.y},containsPoint:function(n,s,o,c){var l=this._getCoords(o,c),s=s||this._getImageLines(l),h=this._findCrossPoints(n,s);return h!==0&&h%2===1},isOnScreen:function(n){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br,c=this.getCoords(!0,n);return c.some(function(l){return l.x<=o.x&&l.x>=s.x&&l.y<=o.y&&l.y>=s.y})||this.intersectsWithRect(s,o,!0,n)?!0:this._containsCenterOfCanvas(s,o,n)},_containsCenterOfCanvas:function(n,s,o){var c={x:(n.x+s.x)/2,y:(n.y+s.y)/2};return!!this.containsPoint(c,null,!0,o)},isPartiallyOnScreen:function(n){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;if(this.intersectsWithRect(s,o,!0,n))return!0;var c=this.getCoords(!0,n).every(function(l){return(l.x>=o.x||l.x<=s.x)&&(l.y>=o.y||l.y<=s.y)});return c&&this._containsCenterOfCanvas(s,o,n)},_getImageLines:function(n){var s={topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}};return s},_findCrossPoints:function(n,s){var o,c,l,h,u,f=0,d;for(var b in s){if(d=s[b],d.o.y<n.y&&d.d.y<n.y)continue;if(d.o.y>=n.y&&d.d.y>=n.y)continue;if(d.o.x===d.d.x&&d.o.x>=n.x?u=d.o.x:(o=0,c=(d.d.y-d.o.y)/(d.d.x-d.o.x),l=n.y-o*n.x,h=d.o.y-c*d.o.x,u=-(l-h)/(o-c)),u>=n.x&&(f+=1),f===2)break}return f},getBoundingRect:function(n,s){var o=this.getCoords(n,s);return t.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n===0?1e-4:n},scale:function(n){return this._set("scaleX",n),this._set("scaleY",n),this.setCoords()},scaleToWidth:function(n,s){var o=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(n/this.width/o)},scaleToHeight:function(n,s){var o=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(n/this.height/o)},calcCoords:function(n){return n?this.calcACoords():this.calcOCoords()},calcLineCoords:function(){var n=this.getViewportTransform(),s=this.padding,o=r(this.angle),c=t.cos(o),l=t.sin(o),h=c*s,u=l*s,f=h+u,d=h-u,b=this.calcACoords(),g={tl:a(b.tl,n),tr:a(b.tr,n),bl:a(b.bl,n),br:a(b.br,n)};return s&&(g.tl.x-=d,g.tl.y-=f,g.tr.x+=f,g.tr.y-=d,g.bl.x-=f,g.bl.y+=d,g.br.x+=d,g.br.y+=f),g},calcOCoords:function(){var n=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=this.getViewportTransform(),c=i(o,s),l=i(c,n),l=i(l,[1/o[0],0,0,1/o[3],0,0]),h=this._calculateCurrentDimensions(),u={};return this.forEachControl(function(f,d,b){u[d]=f.positionHandler(h,l,b)}),u},calcACoords:function(){var n=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=i(s,n),c=this._getTransformedDimensions(),l=c.x/2,h=c.y/2;return{tl:a({x:-l,y:-h},o),tr:a({x:l,y:-h},o),bl:a({x:-l,y:h},o),br:a({x:l,y:h},o)}},setCoords:function(n){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),n?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return t.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var n=this.getCenterPoint();return[1,0,0,1,n.x,n.y]},transformMatrixKey:function(n){var s="_",o="";return!n&&this.group&&(o=this.group.transformMatrixKey(n)+s),o+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(n){var s=this.calcOwnMatrix();if(n||!this.group)return s;var o=this.transformMatrixKey(n),c=this.matrixCache||(this.matrixCache={});return c.key===o?c.value:(this.group&&(s=i(this.group.calcTransformMatrix(!1),s)),c.key=o,c.value=s,s)},calcOwnMatrix:function(){var n=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===n)return s.value;var o=this._calcTranslateMatrix(),c={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=n,s.value=t.composeMatrix(c),s.value},_calcDimensionsTransformMatrix:function(n,s,o){return t.calcDimensionsMatrix({skewX:n,skewY:s,scaleX:this.scaleX*(o&&this.flipX?-1:1),scaleY:this.scaleY*(o&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var n=this.strokeWidth,s=this.width+n,o=this.height+n;return{x:s,y:o}},_getTransformedDimensions:function(n,s){typeof n=="undefined"&&(n=this.skewX),typeof s=="undefined"&&(s=this.skewY);var o=this._getNonTransformedDimensions(),c,l,h=n===0&&s===0;if(this.strokeUniform?(c=this.width,l=this.height):(c=o.x,l=o.y),h)return this._finalizeDimensions(c*this.scaleX,l*this.scaleY);var u=t.sizeAfterTransform(c,l,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:n,skewY:s});return this._finalizeDimensions(u.x,u.y)},_finalizeDimensions:function(n,s){return this.strokeUniform?{x:n+this.strokeWidth,y:s+this.strokeWidth}:{x:n,y:s}},_calculateCurrentDimensions:function(){var n=this.getViewportTransform(),s=this._getTransformedDimensions(),o=a(s,n,!0);return o.scalarAdd(2*this.padding)}})})();p.util.object.extend(p.Object.prototype,{sendToBack:function(){return this.group?p.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?p.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?p.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?p.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&this.group.type!=="activeSelection"?p.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}});(function(){function e(r,i){if(i){if(i.toLive)return r+": url(#SVGID_"+i.id+"); ";var a=new p.Color(i),n=r+": "+a.toRgb()+"; ",s=a.getAlpha();return s!==1&&(n+=r+"-opacity: "+s.toString()+"; "),n}else return r+": none; "}var t=p.util.toFixed;p.util.object.extend(p.Object.prototype,{getSvgStyles:function(r){var i=this.fillRule?this.fillRule:"nonzero",a=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",c=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=typeof this.opacity!="undefined"?this.opacity:"1",u=this.visible?"":" visibility: hidden;",f=r?"":this.getSvgFilter(),d=e("fill",this.fill),b=e("stroke",this.stroke);return[b,"stroke-width: ",a,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",c,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",h,";",f,u].join("")},getSvgSpanStyles:function(r,i){var a="; ",n=r.fontFamily?"font-family: "+(r.fontFamily.indexOf("'")===-1&&r.fontFamily.indexOf('"')===-1?"'"+r.fontFamily+"'":r.fontFamily)+a:"",s=r.strokeWidth?"stroke-width: "+r.strokeWidth+a:"",n=n,o=r.fontSize?"font-size: "+r.fontSize+"px"+a:"",c=r.fontStyle?"font-style: "+r.fontStyle+a:"",l=r.fontWeight?"font-weight: "+r.fontWeight+a:"",h=r.fill?e("fill",r.fill):"",u=r.stroke?e("stroke",r.stroke):"",f=this.getSvgTextDecoration(r),d=r.deltaY?"baseline-shift: "+-r.deltaY+"; ":"";return f&&(f="text-decoration: "+f+a),[u,s,n,o,c,l,f,h,d,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(r){return["overline","underline","line-through"].filter(function(i){return r[i.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(r,i){var a=r?this.calcTransformMatrix():this.calcOwnMatrix(),n='transform="'+p.util.matrixToSVG(a);return n+(i||"")+'" '},_setSVGBg:function(r){if(this.backgroundColor){var i=p.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),`"></rect>
`)}},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(r),{reviver:r})},toClipPathSVG:function(r){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(r),{reviver:r})},_createBaseClipPathSVGMarkup:function(r,i){i=i||{};var a=i.reviver,n=i.additionalTransform||"",s=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),o=r.indexOf("COMMON_PARTS");return r[o]=s,a?a(r.join("")):r.join("")},_createBaseSVGMarkup:function(r,i){i=i||{};var a=i.noStyle,n=i.reviver,s=a?"":'style="'+this.getSvgStyles()+'" ',o=i.withShadow?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=c&&c.absolutePositioned,u=this.stroke,f=this.fill,d=this.shadow,b,g=[],y,S=r.indexOf("COMMON_PARTS"),B=i.additionalTransform;return c&&(c.clipPathId="CLIPPATH_"+p.Object.__uid++,y='<clipPath id="'+c.clipPathId+`" >
`+c.toClipPathSVG(n)+`</clipPath>
`),h&&g.push("<g ",o,this.getSvgCommons(),` >
`),g.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons(),` >
`),b=[s,l,a?"":this.addPaintOrder()," ",B?'transform="'+B+'" ':""].join(""),r[S]=b,f&&f.toLive&&g.push(f.toSVG(this)),u&&u.toLive&&g.push(u.toSVG(this)),d&&g.push(d.toSVG(this)),c&&g.push(y),g.push(r.join("")),g.push(`</g>
`),h&&g.push(`</g>
`),n?n(g.join("")):g.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})})();(function(){var e=p.util.object.extend,t="stateProperties";function r(a,n,s){var o={},c=!0;s.forEach(function(l){o[l]=a[l]}),e(a[n],o,c)}function i(a,n,s){if(a===n)return!0;if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(var o=0,c=a.length;o<c;o++)if(!i(a[o],n[o]))return!1;return!0}else if(a&&typeof a=="object"){var l=Object.keys(a),h;if(!n||typeof n!="object"||!s&&l.length!==Object.keys(n).length)return!1;for(var o=0,c=l.length;o<c;o++){if(h=l[o],h==="canvas"||h==="group")continue;if(!i(a[h],n[h]))return!1}return!0}}p.util.object.extend(p.Object.prototype,{hasStateChanged:function(a){a=a||t;var n="_"+a;return Object.keys(this[n]).length<this[a].length?!0:!i(this[n],this,!0)},saveState:function(a){var n=a&&a.propertySet||t,s="_"+n;return this[s]?(r(this,s,this[n]),a&&a.stateProperties&&r(this,s,a.stateProperties),this):this.setupState(a)},setupState:function(a){a=a||{};var n=a.propertySet||t;return a.propertySet=n,this["_"+n]={},this.saveState(a),this}})})();(function(){var e=p.util.degreesToRadians;p.util.object.extend(p.Object.prototype,{_findTargetCorner:function(t,r){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i=t.x,a=t.y,n,s,o=Object.keys(this.oCoords),c=o.length-1,l;for(this.__corner=0;c>=0;c--){if(l=o[c],!this.isControlVisible(l))continue;if(s=this._getImageLines(r?this.oCoords[l].touchCorner:this.oCoords[l].corner),n=this._findCrossPoints({x:i,y:a},s),n!==0&&n%2===1)return this.__corner=l,l}return!1},forEachControl:function(t){for(var r in this.controls)t(this.controls[r],r,this)},_setCornerCoords:function(){var t=this.oCoords,r=e(45-this.angle),i=p.util.cos(r),a=p.util.sin(r),n=this.cornerSize*.707106,s=this.touchCornerSize*.707106,o=n*i,c=n*a,l=s*i,h=s*a,u,f;for(var d in t)u=t[d].x,f=t[d].y,t[d].corner={tl:{x:u-c,y:f-o},tr:{x:u+o,y:f-c},bl:{x:u-o,y:f+c},br:{x:u+c,y:f+o}},t[d].touchCorner={tl:{x:u-h,y:f-l},tr:{x:u+l,y:f-h},bl:{x:u-l,y:f+h},br:{x:u+h,y:f+l}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var r=this.getCenterPoint(),i=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;return t.translate(r.x,r.y),t.scale(1/a[0],1/a[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(t,r){r=r||{};var i=this._calculateCurrentDimensions(),a=this.borderScaleFactor,n=i.x+a,s=i.y+a,o=typeof r.hasControls!="undefined"?r.hasControls:this.hasControls,c=!1;return t.save(),t.strokeStyle=r.borderColor||this.borderColor,this._setLineDash(t,r.borderDashArray||this.borderDashArray,null),t.strokeRect(-n/2,-s/2,n,s),o&&(t.beginPath(),this.forEachControl(function(l,h,u){l.withConnection&&l.getVisibility(u,h)&&(c=!0,t.moveTo(l.x*n,l.y*s),t.lineTo(l.x*n+l.offsetX,l.y*s+l.offsetY))}),c&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,r,i){i=i||{};var a=p.util.sizeAfterTransform(this.width,this.height,r),n=this.strokeWidth,s=this.strokeUniform,o=this.borderScaleFactor,c=a.x+n*(s?this.canvas.getZoom():r.scaleX)+o,l=a.y+n*(s?this.canvas.getZoom():r.scaleY)+o;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-c/2,-l/2,c,l),t.restore(),this},drawControls:function(t,r){return r=r||{},t.save(),t.setTransform(this.canvas.getRetinaScaling(),0,0,this.canvas.getRetinaScaling(),0,0),t.strokeStyle=t.fillStyle=r.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=r.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,r.cornerDashArray||this.cornerDashArray,null),this.setCoords(),this.forEachControl(function(i,a,n){i.getVisibility(n,a)&&i.render(t,n.oCoords[a].x,n.oCoords[a].y,r,n)}),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,r){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=r,this},setControlsVisibility:function(t){t||(t={});for(var r in t)this.setControlVisible(r,t[r]);return this},onDeselect:function(){},onSelect:function(){}})})();p.util.object.extend(p.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,a=t.onChange||r,n=this;return p.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(s){e.set("left",s),n.requestRenderAll(),a()},onComplete:function(){e.setCoords(),i()}}),this},fxCenterObjectV:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,a=t.onChange||r,n=this;return p.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(s){e.set("top",s),n.requestRenderAll(),a()},onComplete:function(){e.setCoords(),i()}}),this},fxRemove:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,a=t.onChange||r,n=this;return p.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(s){e.set("opacity",s),n.requestRenderAll(),a()},onComplete:function(){n.remove(e),i()}}),this}});p.util.object.extend(p.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,r;for(t in arguments[0])e.push(t);for(var i=0,a=e.length;i<a;i++)t=e[i],r=i!==a-1,this._animate(t,arguments[0][t],arguments[1],r)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,r,i){var a=this,n;t=t.toString(),r?r=p.util.object.clone(r):r={},~e.indexOf(".")&&(n=e.split("."));var s=a.colorProperties.indexOf(e)>-1||n&&a.colorProperties.indexOf(n[1])>-1,o=n?this.get(n[0])[n[1]]:this.get(e);"from"in r||(r.from=o),s||(~t.indexOf("=")?t=o+parseFloat(t.replace("=","")):t=parseFloat(t));var c={startValue:r.from,endValue:t,byValue:r.by,easing:r.easing,duration:r.duration,abort:r.abort&&function(){return r.abort.call(a)},onChange:function(l,h,u){if(n?a[n[0]][n[1]]=l:a.set(e,l),i)return;r.onChange&&r.onChange(l,h,u)},onComplete:function(l,h,u){if(i)return;a.setCoords(),r.onComplete&&r.onComplete(l,h,u)}};s?p.util.animateColor(c.startValue,c.endValue,c.duration,c):p.util.animate(c)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,a={x1:1,x2:1,y1:1,y2:1},n=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(o,c){o||(o=[0,0,0,0]),this.callSuper("initialize",c),this.set("x1",o[0]),this.set("y1",o[1]),this.set("x2",o[2]),this.set("y2",o[3]),this._setWidthHeight(c)},_setWidthHeight:function(o){o||(o={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in o?o.left:this._getLeftToOriginX(),this.top="top"in o?o.top:this._getTopToOriginY()},_set:function(o,c){return this.callSuper("_set",o,c),typeof a[o]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(o){if(o.beginPath(),!this.strokeDashArray||this.strokeDashArray&&n){var c=this.calcLinePoints();o.moveTo(c.x1,c.y1),o.lineTo(c.x2,c.y2)}o.lineWidth=this.strokeWidth;var l=o.strokeStyle;o.strokeStyle=this.stroke||o.fillStyle,this.stroke&&this._renderStroke(o),o.strokeStyle=l},_renderDashedStroke:function(o){var c=this.calcLinePoints();o.beginPath(),t.util.drawDashedLine(o,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray),o.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(o){return r(this.callSuper("toObject",o),this.calcLinePoints())},_getNonTransformedDimensions:function(){var o=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(o.y-=this.strokeWidth),this.height===0&&(o.x-=this.strokeWidth)),o},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1,l=o*this.width*.5,h=c*this.height*.5,u=o*this.width*-.5,f=c*this.height*-.5;return{x1:l,x2:u,y1:h,y2:f}},_toSVG:function(){var o=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`" />
`]}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(o,c,l){l=l||{};var h=t.parseAttributes(o,t.Line.ATTRIBUTE_NAMES),u=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];c(new t.Line(u,r(h,l)))},t.Line.fromObject=function(o,c){function l(u){delete u.points,c&&c(u)}var h=i(o,!0);h.points=[o.x1,o.y1,o.x2,o.y2],t.Object._fromObject("Line",h,l,"points")};function s(o,c){var l=o.origin,h=o.axis1,u=o.axis2,f=o.dimension,d=c.nearest,b=c.center,g=c.farthest;return function(){switch(this.get(l)){case d:return Math.min(this.get(h),this.get(u));case b:return Math.min(this.get(h),this.get(u))+.5*this.get(f);case g:return Math.max(this.get(h),this.get(u))}}}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:r*2,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(a,n){return this.callSuper("_set",a,n),a==="radius"&&this.setRadius(n),this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},_toSVG:function(){var a,n=0,s=0,o=(this.endAngle-this.startAngle)%(2*r);if(o===0)a=["<circle ","COMMON_PARTS",'cx="'+n+'" cy="'+s+'" ','r="',this.radius,`" />
`];else{var c=t.util.cos(this.startAngle)*this.radius,l=t.util.sin(this.startAngle)*this.radius,h=t.util.cos(this.endAngle)*this.radius,u=t.util.sin(this.endAngle)*this.radius,f=o>r?"1":"0";a=['<path d="M '+c+" "+l," A "+this.radius+" "+this.radius," 0 ",+f+" 1"," "+h+" "+u,'" ',"COMMON_PARTS",` />
`]}return a},_render:function(a){a.beginPath(),a.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",a*2).set("height",a*2)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(a,n){var s=t.parseAttributes(a,t.Circle.ATTRIBUTE_NAMES);if(!i(s))throw new Error("value of `r` attribute is required and can not be negative");s.left=(s.left||0)-s.radius,s.top=(s.top||0)-s.radius,n(new t.Circle(s))};function i(a){return"radius"in a&&a.radius>=0}t.Circle.fromObject=function(a,n){return t.Object._fromObject("Circle",a,n)}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(r){var i=this.width/2,a=this.height/2;r.beginPath(),r.moveTo(-i,a),r.lineTo(0,-a),r.lineTo(i,a),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){var i=this.width/2,a=this.height/2;r.beginPath(),t.util.drawDashedLine(r,-i,a,0,-a,this.strokeDashArray),t.util.drawDashedLine(r,0,-a,i,a,this.strokeDashArray),t.util.drawDashedLine(r,i,a,-i,a,this.strokeDashArray),r.closePath()},_toSVG:function(){var r=this.width/2,i=this.height/2,a=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return["<polygon ","COMMON_PARTS",'points="',a,'" />']}}),t.Triangle.fromObject=function(r,i){return t.Object._fromObject("Triangle",r,i)}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI*2;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this.set("rx",i&&i.rx||0),this.set("ry",i&&i.ry||0)},_set:function(i,a){this.callSuper("_set",i,a);switch(i){case"rx":this.rx=a,this.set("width",a*2);break;case"ry":this.ry=a,this.set("height",a*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(i){i.beginPath(),i.save(),i.transform(1,0,0,this.ry/this.rx,0,0),i.arc(0,0,this.rx,0,r,!1),i.restore(),this._renderPaintInOrder(i)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(i,a){var n=t.parseAttributes(i,t.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,a(new t.Ellipse(n))},t.Ellipse.fromObject=function(i,a){return t.Object._fromObject("Ellipse",i,a)}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend;if(t.Rect){t.warn("fabric.Rect is already defined");return}t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(i){var a=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,s=this.width,o=this.height,c=-this.width/2,l=-this.height/2,h=a!==0||n!==0,u=1-.5522847498;i.beginPath(),i.moveTo(c+a,l),i.lineTo(c+s-a,l),h&&i.bezierCurveTo(c+s-u*a,l,c+s,l+u*n,c+s,l+n),i.lineTo(c+s,l+o-n),h&&i.bezierCurveTo(c+s,l+o-u*n,c+s-u*a,l+o,c+s-a,l+o),i.lineTo(c+a,l+o),h&&i.bezierCurveTo(c+u*a,l+o,c,l+o-u*n,c,l+o-n),i.lineTo(c,l+n),h&&i.bezierCurveTo(c,l+u*n,c+u*a,l,c+a,l),i.closePath(),this._renderPaintInOrder(i)},_renderDashedStroke:function(i){var a=-this.width/2,n=-this.height/2,s=this.width,o=this.height;i.beginPath(),t.util.drawDashedLine(i,a,n,a+s,n,this.strokeDashArray),t.util.drawDashedLine(i,a+s,n,a+s,n+o,this.strokeDashArray),t.util.drawDashedLine(i,a+s,n+o,a,n+o,this.strokeDashArray),t.util.drawDashedLine(i,a,n+o,a,n,this.strokeDashArray),i.closePath()},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){var i=-this.width/2,a=-this.height/2;return["<rect ","COMMON_PARTS",'x="',i,'" y="',a,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(i,a,n){if(!i)return a(null);n=n||{};var s=t.parseAttributes(i,t.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0,s.height=s.height||0,s.width=s.width||0;var o=new t.Rect(r(n?t.util.object.clone(n):{},s));o.visible=o.visible&&o.width>0&&o.height>0,a(o)},t.Rect.fromObject=function(i,a){return t.Object._fromObject("Rect",i,a)}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.array.min,a=t.util.array.max,n=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(s,o){o=o||{},this.points=s||[],this.callSuper("initialize",o),this._setPositionDimensions(o)},_setPositionDimensions:function(s){var o=this._calcDimensions(s),c;this.width=o.width,this.height=o.height,s.fromSVG||(c=this.translateToGivenOrigin({x:o.left-this.strokeWidth/2,y:o.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof s.left=="undefined"&&(this.left=s.fromSVG?o.left:c.x),typeof s.top=="undefined"&&(this.top=s.fromSVG?o.top:c.y),this.pathOffset={x:o.left+this.width/2,y:o.top+this.height/2}},_calcDimensions:function(){var s=this.points,o=i(s,"x")||0,c=i(s,"y")||0,l=a(s,"x")||0,h=a(s,"y")||0,u=l-o,f=h-c;return{left:o,top:c,width:u,height:f}},toObject:function(s){return r(this.callSuper("toObject",s),{points:this.points.concat()})},_toSVG:function(){for(var s=[],o=this.pathOffset.x,c=this.pathOffset.y,l=t.Object.NUM_FRACTION_DIGITS,h=0,u=this.points.length;h<u;h++)s.push(n(this.points[h].x-o,l),",",n(this.points[h].y-c,l)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',s.join(""),`" />
`]},commonRender:function(s){var o,c=this.points.length,l=this.pathOffset.x,h=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;s.beginPath(),s.moveTo(this.points[0].x-l,this.points[0].y-h);for(var u=0;u<c;u++)o=this.points[u],s.lineTo(o.x-l,o.y-h);return!0},_render:function(s){if(!this.commonRender(s))return;this._renderPaintInOrder(s)},_renderDashedStroke:function(s){var o,c;s.beginPath();for(var l=0,h=this.points.length;l<h;l++)o=this.points[l],c=this.points[l+1]||o,t.util.drawDashedLine(s,o.x,o.y,c.x,c.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(s){return function(o,c,l){if(!o)return c(null);l||(l={});var h=t.parsePointsAttribute(o.getAttribute("points")),u=t.parseAttributes(o,t[s].ATTRIBUTE_NAMES);u.fromSVG=!0,c(new t[s](h,r(u,l)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(s,o){return t.Object._fromObject("Polyline",s,o,"points")}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_render:function(r){if(!this.commonRender(r))return;r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){this.callSuper("_renderDashedStroke",r),r.closePath()}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(r,i){return t.Object._fromObject("Polygon",r,i,"points")}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max,a=t.util.object.extend,n=Object.prototype.toString,s=t.util.toFixed;if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(o,c){c=c||{},this.callSuper("initialize",c),o||(o=[]);var l=n.call(o)==="[object Array]";if(this.path=l?t.util.makePathSimpler(o):t.util.makePathSimpler(t.util.parsePath(o)),!this.path)return;t.Polyline.prototype._setPositionDimensions.call(this,c)},_renderPathCommands:function(o){var c,l=0,h=0,u=0,f=0,d=0,b=0,g=-this.pathOffset.x,y=-this.pathOffset.y;o.beginPath();for(var S=0,B=this.path.length;S<B;++S){c=this.path[S];switch(c[0]){case"L":u=c[1],f=c[2],o.lineTo(u+g,f+y);break;case"M":u=c[1],f=c[2],l=u,h=f,o.moveTo(u+g,f+y);break;case"C":u=c[5],f=c[6],d=c[3],b=c[4],o.bezierCurveTo(c[1]+g,c[2]+y,d+g,b+y,u+g,f+y);break;case"Q":o.quadraticCurveTo(c[1]+g,c[2]+y,c[3]+g,c[4]+y),u=c[3],f=c[4],d=c[1],b=c[2];break;case"z":case"Z":u=l,f=h,o.closePath();break}}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return a(this.callSuper("toObject",o),{path:this.path.map(function(c){return c.slice()})})},toDatalessObject:function(o){var c=this.toObject(["sourcePath"].concat(o));return c.sourcePath&&delete c.path,c},_toSVG:function(){var o=this.path.map(function(c){return c.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=t.Object.NUM_FRACTION_DIGITS;return" translate("+s(-this.pathOffset.x,o)+", "+s(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var c=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},toSVG:function(o){var c=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var o=[],c=[],l,h=0,u=0,f=0,d=0,b,g=0,y=this.path.length;g<y;++g){l=this.path[g];switch(l[0]){case"L":f=l[1],d=l[2],b=[];break;case"M":f=l[1],d=l[2],h=f,u=d,b=[];break;case"C":b=t.util.getBoundsOfCurve(f,d,l[1],l[2],l[3],l[4],l[5],l[6]),f=l[5],d=l[6];break;case"Q":b=t.util.getBoundsOfCurve(f,d,l[1],l[2],l[1],l[2],l[3],l[4]),f=l[3],d=l[4];break;case"z":case"Z":f=h,d=u;break}b.forEach(function(V){o.push(V.x),c.push(V.y)}),o.push(f),c.push(d)}var S=r(o)||0,B=r(c)||0,W=i(o)||0,X=i(c)||0,P=W-S,J=X-B;return{left:S,top:B,width:P,height:J}}}),t.Path.fromObject=function(o,c){if(typeof o.sourcePath=="string"){var l=o.sourcePath;t.loadSVGFromURL(l,function(h){var u=h[0];u.setOptions(o),c&&c(u)})}else t.Object._fromObject("Path",o,c,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(o,c,l){var h=t.parseAttributes(o,t.Path.ATTRIBUTE_NAMES);h.fromSVG=!0,c(new t.Path(h.d,a(h,l)))}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max;if(t.Group)return;t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,n,s){n=n||{},this._objects=[],s&&this.callSuper("initialize",n),this._objects=a||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(s)this._updateObjectsACoords();else{var c=n&&n.centerPoint;n.originX!==void 0&&(this.originX=n.originX),n.originY!==void 0&&(this.originY=n.originY),c||this._calcBounds(),this._updateObjectsCoords(c),delete n.centerPoint,this.callSuper("initialize",n)}this.setCoords()},_updateObjectsACoords:function(){for(var a=!0,n=this._objects.length;n--;)this._objects[n].setCoords(a)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],a)},_updateObjectCoords:function(a,n){var s=a.left,o=a.top,c=!0;a.set({left:s-n.x,top:o-n.y}),a.group=this,a.setCoords(c)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),t.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(a){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group},_set:function(a,n){var s=this._objects.length;if(this.useSetOnGroup)for(;s--;)this._objects[s].setOnGroup(a,n);if(a==="canvas")for(;s--;)this._objects[s]._set(a,n);t.Object.prototype._set.call(this,a,n)},toObject:function(a){var n=this.includeDefaultValues,s=this._objects.map(function(c){var l=c.includeDefaultValues;c.includeDefaultValues=n;var h=c.toObject(a);return c.includeDefaultValues=l,h}),o=t.Object.prototype.toObject.call(this,a);return o.objects=s,o},toDatalessObject:function(a){var n,s=this.sourcePath;if(s)n=s;else{var o=this.includeDefaultValues;n=this._objects.map(function(l){var h=l.includeDefaultValues;l.includeDefaultValues=o;var u=l.toDatalessObject(a);return l.includeDefaultValues=h,u})}var c=t.Object.prototype.toDatalessObject.call(this,a);return c.objects=n,c},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=t.Object.prototype.shouldCache.call(this);if(a){for(var n=0,s=this._objects.length;n<s;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1}return a},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var a=0,n=this._objects.length;a<n;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var n=0,s=this._objects.length;n<s;n++)this._objects[n].render(a);this._drawClipPath(a)},isCacheDirty:function(a){if(this.callSuper("isCacheDirty",a))return!0;if(!this.statefullCache)return!1;for(var n=0,s=this._objects.length;n<s;n++)if(this._objects[n].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-c/2,o,c)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var n=a.calcTransformMatrix(),s=t.util.qrDecompose(n),o=new t.Point(s.translateX,s.translateY);return a.flipX=!1,a.flipY=!1,a.set("scaleX",s.scaleX),a.set("scaleY",s.scaleY),a.skewX=s.skewX,a.skewY=s.skewY,a.angle=s.angle,a.setPositionByOrigin(o,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),delete a.group,a.setCoords(),this},destroy:function(){return this._objects.forEach(function(a){a.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(!this.canvas)return;var a=this._objects,n=this.canvas;this._objects=[];var s=this.toObject();delete s.objects;var o=new t.ActiveSelection([]);return o.set(s),o.type="activeSelection",n.remove(this),a.forEach(function(c){c.group=o,c.dirty=!0,n.add(c)}),o.canvas=n,o._objects=a,n._activeObject=o,o.setCoords(),o},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var a=!0;return this.forEachObject(function(n){n.setCoords(a)}),this},_calcBounds:function(a){for(var n=[],s=[],o,c,l=["tr","br","bl","tl"],h=0,u=this._objects.length,f,d=l.length;h<u;++h)for(o=this._objects[h],o.aCoords=o.calcACoords(),f=0;f<d;f++)c=l[f],n.push(o.aCoords[c].x),s.push(o.aCoords[c].y);this._getBounds(n,s,a)},_getBounds:function(a,n,s){var o=new t.Point(r(a),r(n)),c=new t.Point(i(a),i(n)),l=o.y||0,h=o.x||0,u=c.x-o.x||0,f=c.y-o.y||0;this.width=u,this.height=f,s||this.setPositionByOrigin({x:h,y:l},"left","top")},_toSVG:function(a){for(var n=["<g ","COMMON_PARTS",` >
`],s=0,o=this._objects.length;s<o;s++)n.push("		",this._objects[s].toSVG(a));return n.push(`</g>
`),n},getSvgStyles:function(){var a=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",n=this.visible?"":" visibility: hidden;";return[a,this.getSvgFilter(),n].join("")},toClipPathSVG:function(a){for(var n=[],s=0,o=this._objects.length;s<o;s++)n.push("	",this._objects[s].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(n,{reviver:a})}}),t.Group.fromObject=function(a,n){var s=a.objects,o=t.util.object.clone(a,!0);if(delete o.objects,typeof s=="string"){t.loadSVGFromURL(s,function(c){var l=t.util.groupSVGElements(c,a,s);l.set(o),n&&n(l)});return}t.util.enlivenObjects(s,function(c){t.util.enlivenObjects([a.clipPath],function(l){var h=t.util.object.clone(a,!0);h.clipPath=l[0],delete h.objects,n&&n(new t.Group(c,h,!0))})})}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.ActiveSelection)return;t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(r,i){i=i||{},this._objects=r||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var r=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),a=new t.Group([]);if(delete i.type,a.set(i),r.forEach(function(s){s.canvas.remove(s),s.group=a}),a._objects=r,!this.canvas)return a;var n=this.canvas;return n.add(a),n._activeObject=a,a.setCoords(),a},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(r,i,a){r.save(),r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",r,i),a=a||{},typeof a.hasControls=="undefined"&&(a.hasControls=!1),a.forActiveSelection=!0;for(var n=0,s=this._objects.length;n<s;n++)this._objects[n]._renderControls(r,a);r.restore()}}),t.ActiveSelection.fromObject=function(r,i){t.util.enlivenObjects(r.objects,function(a){delete r.objects,i&&i(new t.ActiveSelection(a,r,!0))})}})((typeof H!="undefined",H));(function(e){"use strict";var t=p.util.object.extend;if(e.fabric||(e.fabric={}),e.fabric.Image){p.warn("fabric.Image is already defined.");return}p.Image=p.util.createClass(p.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:p.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(r,i){i||(i={}),this.filters=[],this.cacheKey="texture"+p.Object.__uid++,this.callSuper("initialize",i),this._initElement(r,i)},getElement:function(){return this._element||{}},setElement:function(r,i){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=r,this._originalElement=r,this._initConfig(i),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(r){var i=p.filterBackend;i&&i.evictCachesForKey&&i.evictCachesForKey(r)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(r){p.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var r=this.getElement();return{width:r.naturalWidth||r.width,height:r.naturalHeight||r.height}},_stroke:function(r){if(!this.stroke||this.strokeWidth===0)return;var i=this.width/2,a=this.height/2;r.beginPath(),r.moveTo(-i,-a),r.lineTo(i,-a),r.lineTo(i,a),r.lineTo(-i,a),r.lineTo(-i,-a),r.closePath()},_renderDashedStroke:function(r){var i=-this.width/2,a=-this.height/2,n=this.width,s=this.height;r.save(),this._setStrokeStyles(r,this),r.beginPath(),p.util.drawDashedLine(r,i,a,i+n,a,this.strokeDashArray),p.util.drawDashedLine(r,i+n,a,i+n,a+s,this.strokeDashArray),p.util.drawDashedLine(r,i+n,a+s,i,a+s,this.strokeDashArray),p.util.drawDashedLine(r,i,a+s,i,a,this.strokeDashArray),r.closePath(),r.restore()},toObject:function(r){var i=[];this.filters.forEach(function(n){n&&i.push(n.toObject())});var a=t(this.callSuper("toObject",["cropX","cropY"].concat(r)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(a.resizeFilter=this.resizeFilter.toObject()),a},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var r=[],i=[],a,n=this._element,s=-this.width/2,o=-this.height/2,c="",l="";if(!n)return[];if(this.hasCrop()){var h=p.Object.__uid++;r.push('<clipPath id="imageCrop_'+h+`">
`,'	<rect x="'+s+'" y="'+o+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(l='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',o-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,l,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var u=this.fill;this.fill=null,a=["	<rect ",'x="',s,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=u}return this.paintFirst!=="fill"?r=r.concat(a,i):r=r.concat(i,a),r},getSrc:function(r){var i=r?this._element:this._originalElement;return i?i.toDataURL?i.toDataURL():this.srcFromAttribute?i.getAttribute("src"):i.src:this.src||""},setSrc:function(r,i,a){return p.util.loadImage(r,function(n,s){this.setElement(n,a),this._setWidthHeight(),i&&i(this,s)},this,a&&a.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var r=this.resizeFilter,i=this.minimumScaleTrigger,a=this.getTotalObjectScaling(),n=a.scaleX,s=a.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!r||n>i&&s>i){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,this._lastScaleY=s;return}p.filterBackend||(p.filterBackend=p.initFilterBackend());var c=p.util.createCanvasElement(),l=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,h=o.width,u=o.height;c.width=h,c.height=u,this._element=c,this._lastScaleX=r.scaleX=n,this._lastScaleY=r.scaleY=s,p.filterBackend.applyFilters([r],o,h,u,this._element,l),this._filterScalingX=c.width/this._originalElement.width,this._filterScalingY=c.height/this._originalElement.height},applyFilters:function(r){if(r=r||this.filters||[],r=r.filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),r.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var i=this._originalElement,a=i.naturalWidth||i.width,n=i.naturalHeight||i.height;if(this._element===this._originalElement){var s=p.util.createCanvasElement();s.width=a,s.height=n,this._element=s,this._filteredEl=s}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,a,n),this._lastScaleX=1,this._lastScaleY=1;return p.filterBackend||(p.filterBackend=p.initFilterBackend()),p.filterBackend.applyFilters(r,this._originalElement,a,n,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(r){p.util.setImageSmoothing(r,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(r),this._renderPaintInOrder(r)},drawCacheOnCanvas:function(r){p.util.setImageSmoothing(r,this.imageSmoothing),p.Object.prototype.drawCacheOnCanvas.call(this,r)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(r){var i=this._element;if(!i)return;var a=this._filterScalingX,n=this._filterScalingY,s=this.width,o=this.height,c=Math.min,l=Math.max,h=l(this.cropX,0),u=l(this.cropY,0),f=i.naturalWidth||i.width,d=i.naturalHeight||i.height,b=h*a,g=u*n,y=c(s*a,f-b),S=c(o*n,d-g),B=-s/2,W=-o/2,X=c(s,f/a-h),P=c(o,d/a-u);i&&r.drawImage(i,b,g,y,S,B,W,X,P)},_needsResize:function(){var r=this.getTotalObjectScaling();return r.scaleX!==this._lastScaleX||r.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(r,i){this.setElement(p.util.getById(r),i),p.util.addClass(this.getElement(),p.Image.CSS_CANVAS)},_initConfig:function(r){r||(r={}),this.setOptions(r),this._setWidthHeight(r)},_initFilters:function(r,i){r&&r.length?p.util.enlivenObjects(r,function(a){i&&i(a)},"fabric.Image.filters"):i&&i()},_setWidthHeight:function(r){r||(r={});var i=this.getElement();this.width=r.width||i.naturalWidth||i.width||0,this.height=r.height||i.naturalHeight||i.height||0},parsePreserveAspectRatioAttribute:function(){var r=p.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,a=this._element.height,n=1,s=1,o=0,c=0,l=0,h=0,u,f=this.width,d=this.height,b={width:f,height:d};return r&&(r.alignX!=="none"||r.alignY!=="none")?(r.meetOrSlice==="meet"&&(n=s=p.util.findScaleToFit(this._element,b),u=(f-i*n)/2,r.alignX==="Min"&&(o=-u),r.alignX==="Max"&&(o=u),u=(d-a*s)/2,r.alignY==="Min"&&(c=-u),r.alignY==="Max"&&(c=u)),r.meetOrSlice==="slice"&&(n=s=p.util.findScaleToCover(this._element,b),u=i-f/n,r.alignX==="Mid"&&(l=u/2),r.alignX==="Max"&&(l=u),u=a-d/s,r.alignY==="Mid"&&(h=u/2),r.alignY==="Max"&&(h=u),i=f/n,a=d/s)):(n=f/i,s=d/a),{width:i,height:a,scaleX:n,scaleY:s,offsetLeft:o,offsetTop:c,cropX:l,cropY:h}}}),p.Image.CSS_CANVAS="canvas-img",p.Image.prototype.getSvgSrc=p.Image.prototype.getSrc,p.Image.fromObject=function(r,i){var a=p.util.object.clone(r);p.util.loadImage(a.src,function(n,s){if(s){i&&i(null,!0);return}p.Image.prototype._initFilters.call(a,a.filters,function(o){a.filters=o||[],p.Image.prototype._initFilters.call(a,[a.resizeFilter],function(c){a.resizeFilter=c[0],p.util.enlivenObjects([a.clipPath],function(l){a.clipPath=l[0];var h=new p.Image(n,a);i(h,!1)})})})},null,a.crossOrigin)},p.Image.fromURL=function(r,i,a){p.util.loadImage(r,function(n,s){i&&i(new p.Image(n,a),s)},null,a&&a.crossOrigin)},p.Image.ATTRIBUTE_NAMES=p.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),p.Image.fromElement=function(r,i,a){var n=p.parseAttributes(r,p.Image.ATTRIBUTE_NAMES);p.Image.fromURL(n["xlink:href"],i,t(a?p.util.object.clone(a):{},n))}})((typeof H!="undefined",H));p.util.object.extend(p.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?Math.round((e-1)/90)*90:Math.round(e/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},r=e.onComplete||t,i=e.onChange||t,a=this;return p.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){a.rotate(n),i()},onComplete:function(){a.setCoords(),r()}}),this}});p.util.object.extend(p.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}});(function(){"use strict";function e(r,i){var a="precision "+i+` float;
void main(){}`,n=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(n,a),r.compileShader(n),!!r.getShaderParameter(n,r.COMPILE_STATUS)}p.isWebglSupported=function(r){if(p.isLikelyNode)return!1;r=r||p.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),a=i.getContext("webgl")||i.getContext("experimental-webgl"),n=!1;if(a){p.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),n=p.maxTextureSize>=r;for(var s=["highp","mediump","lowp"],o=0;o<3;o++)if(e(a,s[o])){p.webGlPrecision=s[o];break}}return this.isSupported=n,n},p.WebglFilterBackend=t;function t(r){r&&r.tileSize&&(this.tileSize=r.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}t.prototype={tileSize:2048,resources:{},setupGLContext:function(r,i){this.dispose(),this.createWebGLCanvas(r,i),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(r,i)},chooseFastestCopyGLTo2DMethod:function(r,i){var a=typeof window.performance!="undefined",n;try{new ImageData(1,1),n=!0}catch(b){n=!1}var s=typeof ArrayBuffer!="undefined",o=typeof Uint8ClampedArray!="undefined";if(!(a&&n&&s&&o))return;var c=p.util.createCanvasElement(),l=new ArrayBuffer(r*i*4);if(p.forceGLPutImageData){this.imageBuffer=l,this.copyGLTo2D=ho;return}var h={imageBuffer:l,destinationWidth:r,destinationHeight:i,targetCanvas:c},u,f,d;c.width=r,c.height=i,u=window.performance.now(),co.call(h,this.gl,h),f=window.performance.now()-u,u=window.performance.now(),ho.call(h,this.gl,h),d=window.performance.now()-u,f>d?(this.imageBuffer=l,this.copyGLTo2D=ho):this.copyGLTo2D=co},createWebGLCanvas:function(r,i){var a=p.util.createCanvasElement();a.width=r,a.height=i;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},s=a.getContext("webgl",n);if(s||(s=a.getContext("experimental-webgl",n)),!s)return;s.clearColor(0,0,0,0),this.canvas=a,this.gl=s},applyFilters:function(r,i,a,n,s,o){var c=this.gl,l;o&&(l=this.getCachedTexture(o,i));var h={originalWidth:i.width||i.originalWidth,originalHeight:i.height||i.originalHeight,sourceWidth:a,sourceHeight:n,destinationWidth:a,destinationHeight:n,context:c,sourceTexture:this.createTexture(c,a,n,!l&&i),targetTexture:this.createTexture(c,a,n),originalTexture:l||this.createTexture(c,a,n,!l&&i),passes:r.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},u=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,u),r.forEach(function(f){f&&f.applyTo(h)}),Ug(h),this.copyGLTo2D(c,h),c.bindTexture(c.TEXTURE_2D,null),c.deleteTexture(h.sourceTexture),c.deleteTexture(h.targetTexture),c.deleteFramebuffer(u),s.getContext("2d").setTransform(1,0,0,1,0,0),h},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(r,i,a,n){var s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i,a,0,r.RGBA,r.UNSIGNED_BYTE,null),s},getCachedTexture:function(r,i){if(this.textureCache[r])return this.textureCache[r];var a=this.createTexture(this.gl,i.width,i.height,i);return this.textureCache[r]=a,a},evictCachesForKey:function(r){this.textureCache[r]&&(this.gl.deleteTexture(this.textureCache[r]),delete this.textureCache[r])},copyGLTo2D:co,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var r=this.gl,i={renderer:"",vendor:""};if(!r)return i;var a=r.getExtension("WEBGL_debug_renderer_info");if(a){var n=r.getParameter(a.UNMASKED_RENDERER_WEBGL),s=r.getParameter(a.UNMASKED_VENDOR_WEBGL);n&&(i.renderer=n.toLowerCase()),s&&(i.vendor=s.toLowerCase())}return this.gpuInfo=i,i}}})();function Ug(e){var t=e.targetCanvas,r=t.width,i=t.height,a=e.destinationWidth,n=e.destinationHeight;(r!==a||i!==n)&&(t.width=a,t.height=n)}function co(e,t){var r=e.canvas,i=t.targetCanvas,a=i.getContext("2d");a.translate(0,i.height),a.scale(1,-1);var n=r.height-i.height;a.drawImage(r,0,n,i.width,i.height,0,0,i.width,i.height)}function ho(e,t){var r=t.targetCanvas,i=r.getContext("2d"),a=t.destinationWidth,n=t.destinationHeight,s=a*n*4,o=new Uint8Array(this.imageBuffer,0,s),c=new Uint8ClampedArray(this.imageBuffer,0,s);e.readPixels(0,0,a,n,e.RGBA,e.UNSIGNED_BYTE,o);var l=new ImageData(c,a,n);i.putImageData(l,0,0)}(function(){"use strict";var e=function(){};p.Canvas2dFilterBackend=t;function t(){}t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(r,i,a,n,s){var o=s.getContext("2d");o.drawImage(i,0,0,a,n);var c=o.getImageData(0,0,a,n),l=o.getImageData(0,0,a,n),h={sourceWidth:a,sourceHeight:n,imageData:c,originalEl:i,originalImageData:l,canvasEl:s,ctx:o,filterBackend:this};return r.forEach(function(u){u.applyTo(h)}),(h.imageData.width!==a||h.imageData.height!==n)&&(s.width=h.imageData.width,s.height=h.imageData.height),o.putImageData(h.imageData,0,0),h}}})();p.Image=p.Image||{};p.Image.filters=p.Image.filters||{};p.Image.filters.BaseFilter=p.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,r){t=t||this.fragmentSource,r=r||this.vertexSource,p.webGlPrecision!=="highp"&&(t=t.replace(/precision highp float/g,"precision "+p.webGlPrecision+" float"));var i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(i));var a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(a));var n=e.createProgram();if(e.attachShader(n,i),e.attachShader(n,a),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(n));var s=this.getAttributeLocations(e,n),o=this.getUniformLocations(e,n)||{};return o.uStepW=e.getUniformLocation(n,"uStepW"),o.uStepH=e.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:s,uniformLocations:o}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,r){var i=t.aPosition,a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t=e.context,r,i;e.passes>1?(r=e.destinationWidth,i=e.destinationHeight,(e.sourceWidth!==r||e.sourceHeight!==i)&&(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,r,i)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=p.Image.filters[this.type].prototype;if(e)if(Array.isArray(t[e])){for(var r=t[e].length;r--;)if(this[e][r]!==t[e][r])return!1;return!0}else return t[e]===this[e];else return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,r=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(r.program),this.sendAttributeData(t,r.attributeLocations,e.aPosition),t.uniform1f(r.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(r.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,r.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,r){e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}});p.Image.filters.BaseFilter.fromObject=function(e,t){var r=new p.Image.filters[e.type](e);return t&&t(r),r};(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.ColorMatrix=i(r.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a),this.matrix=this.matrix.slice(0)},applyTo2d:function(a){var n=a.imageData,s=n.data,o=s.length,c=this.matrix,l,h,u,f,d,b=this.colorsOnly;for(d=0;d<o;d+=4)l=s[d],h=s[d+1],u=s[d+2],b?(s[d]=l*c[0]+h*c[1]+u*c[2]+c[4]*255,s[d+1]=l*c[5]+h*c[6]+u*c[7]+c[9]*255,s[d+2]=l*c[10]+h*c[11]+u*c[12]+c[14]*255):(f=s[d+3],s[d]=l*c[0]+h*c[1]+u*c[2]+f*c[3]+c[4]*255,s[d+1]=l*c[5]+h*c[6]+u*c[7]+f*c[8]+c[9]*255,s[d+2]=l*c[10]+h*c[11]+u*c[12]+f*c[13]+c[14]*255,s[d+3]=l*c[15]+h*c[16]+u*c[17]+f*c[18]+c[19]*255)},getUniformLocations:function(a,n){return{uColorMatrix:a.getUniformLocation(n,"uColorMatrix"),uConstants:a.getUniformLocation(n,"uConstants")}},sendUniformData:function(a,n){var s=this.matrix,o=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],c=[s[4],s[9],s[14],s[19]];a.uniformMatrix4fv(n.uColorMatrix,!1,o),a.uniform4fv(n.uConstants,c)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Brightness=i(r.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(this.brightness===0)return;var n=a.imageData,s=n.data,o,c=s.length,l=Math.round(this.brightness*255);for(o=0;o<c;o+=4)s[o]=s[o]+l,s[o+1]=s[o+1]+l,s[o+2]=s[o+2]+l},getUniformLocations:function(a,n){return{uBrightness:a.getUniformLocation(n,"uBrightness")}},sendUniformData:function(a,n){a.uniform1f(n.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,a=t.util.createClass;i.Convolute=a(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(n){var s=Math.sqrt(this.matrix.length),o=this.type+"_"+s+"_"+(this.opaque?1:0),c=this.fragmentSource[o];return n.programCache.hasOwnProperty(o)||(n.programCache[o]=this.createProgram(n.context,c)),n.programCache[o]},applyTo2d:function(n){var s=n.imageData,o=s.data,c=this.matrix,l=Math.round(Math.sqrt(c.length)),h=Math.floor(l/2),u=s.width,f=s.height,d=n.ctx.createImageData(u,f),b=d.data,g=this.opaque?1:0,y,S,B,W,X,P,J,V,Y,R,N,k,w;for(N=0;N<f;N++)for(R=0;R<u;R++){for(X=(N*u+R)*4,y=0,S=0,B=0,W=0,w=0;w<l;w++)for(k=0;k<l;k++){if(J=N+w-h,P=R+k-h,J<0||J>=f||P<0||P>=u)continue;V=(J*u+P)*4,Y=c[w*l+k],y+=o[V]*Y,S+=o[V+1]*Y,B+=o[V+2]*Y,g||(W+=o[V+3]*Y)}b[X]=y,b[X+1]=S,b[X+2]=B,g?b[X+3]=o[X+3]:b[X+3]=W}n.imageData=d},getUniformLocations:function(n,s){return{uMatrix:n.getUniformLocation(s,"uMatrix"),uOpaque:n.getUniformLocation(s,"uOpaque"),uHalfSize:n.getUniformLocation(s,"uHalfSize"),uSize:n.getUniformLocation(s,"uSize")}},sendUniformData:function(n,s){n.uniform1fv(s.uMatrix,this.matrix)},toObject:function(){return r(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Grayscale=i(r.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(a){var n=a.imageData,s=n.data,o,c=s.length,l,h=this.mode;for(o=0;o<c;o+=4)h==="average"?l=(s[o]+s[o+1]+s[o+2])/3:h==="lightness"?l=(Math.min(s[o],s[o+1],s[o+2])+Math.max(s[o],s[o+1],s[o+2]))/2:h==="luminosity"&&(l=.21*s[o]+.72*s[o+1]+.07*s[o+2]),s[o]=l,s[o+1]=l,s[o+2]=l},retrieveShader:function(a){var n=this.type+"_"+this.mode;if(!a.programCache.hasOwnProperty(n)){var s=this.fragmentSource[this.mode];a.programCache[n]=this.createProgram(a.context,s)}return a.programCache[n]},getUniformLocations:function(a,n){return{uMode:a.getUniformLocation(n,"uMode")}},sendUniformData:function(a,n){var s=1;a.uniform1i(n.uMode,s)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Invert=i(r.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(a){var n=a.imageData,s=n.data,o,c=s.length;for(o=0;o<c;o+=4)s[o]=255-s[o],s[o+1]=255-s[o+1],s[o+2]=255-s[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(a,n){return{uInvert:a.getUniformLocation(n,"uInvert")}},sendUniformData:function(a,n){a.uniform1i(n.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,a=t.util.createClass;i.Noise=a(i.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(n){if(this.noise===0)return;var s=n.imageData,o=s.data,c,l=o.length,h=this.noise,u;for(c=0,l=o.length;c<l;c+=4)u=(.5-Math.random())*h,o[c]+=u,o[c+1]+=u,o[c+2]+=u},getUniformLocations:function(n,s){return{uNoise:n.getUniformLocation(s,"uNoise"),uSeed:n.getUniformLocation(s,"uSeed")}},sendUniformData:function(n,s){n.uniform1f(s.uNoise,this.noise/255),n.uniform1f(s.uSeed,Math.random())},toObject:function(){return r(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Pixelate=i(r.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(a){var n=a.imageData,s=n.data,o=n.height,c=n.width,l,h,u,f,d,b,g,y,S,B,W;for(h=0;h<o;h+=this.blocksize)for(u=0;u<c;u+=this.blocksize)for(l=h*4*c+u*4,f=s[l],d=s[l+1],b=s[l+2],g=s[l+3],B=Math.min(h+this.blocksize,o),W=Math.min(u+this.blocksize,c),y=h;y<B;y++)for(S=u;S<W;S++)l=y*4*c+S*4,s[l]=f,s[l+1]=d,s[l+2]=b,s[l+3]=g},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(a,n){return{uBlocksize:a.getUniformLocation(n,"uBlocksize"),uStepW:a.getUniformLocation(n,"uStepW"),uStepH:a.getUniformLocation(n,"uStepH")}},sendUniformData:function(a,n){a.uniform1f(n.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,a=t.util.createClass;i.RemoveColor=a(i.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(n){var s=n.imageData,o=s.data,c,l=this.distance*255,h,u,f,d=new t.Color(this.color).getSource(),b=[d[0]-l,d[1]-l,d[2]-l],g=[d[0]+l,d[1]+l,d[2]+l];for(c=0;c<o.length;c+=4)h=o[c],u=o[c+1],f=o[c+2],h>b[0]&&u>b[1]&&f>b[2]&&h<g[0]&&u<g[1]&&f<g[2]&&(o[c+3]=0)},getUniformLocations:function(n,s){return{uLow:n.getUniformLocation(s,"uLow"),uHigh:n.getUniformLocation(s,"uHigh")}},sendUniformData:function(n,s){var o=new t.Color(this.color).getSource(),c=parseFloat(this.distance),l=[0+o[0]/255-c,0+o[1]/255-c,0+o[2]/255-c,1],h=[o[0]/255+c,o[1]/255+c,o[2]/255+c,1];n.uniform4fv(s.uLow,l),n.uniform4fv(s.uHigh,h)},toObject:function(){return r(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass,a={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in a)r[n]=i(r.ColorMatrix,{type:n,matrix:a[n],mainParameter:!1,colorsOnly:!0}),t.Image.filters[n].fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendColor=i(r.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(a){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[a]+`}
}`},retrieveShader:function(a){var n=this.type+"_"+this.mode,s;return a.programCache.hasOwnProperty(n)||(s=this.buildSource(this.mode),a.programCache[n]=this.createProgram(a.context,s)),a.programCache[n]},applyTo2d:function(a){var n=a.imageData,s=n.data,o=s.length,c,l,h,u,f,d,b,g=1-this.alpha;b=new t.Color(this.color).getSource(),c=b[0]*this.alpha,l=b[1]*this.alpha,h=b[2]*this.alpha;for(var y=0;y<o;y+=4){u=s[y],f=s[y+1],d=s[y+2];switch(this.mode){case"multiply":s[y]=u*c/255,s[y+1]=f*l/255,s[y+2]=d*h/255;break;case"screen":s[y]=255-(255-u)*(255-c)/255,s[y+1]=255-(255-f)*(255-l)/255,s[y+2]=255-(255-d)*(255-h)/255;break;case"add":s[y]=u+c,s[y+1]=f+l,s[y+2]=d+h;break;case"diff":case"difference":s[y]=Math.abs(u-c),s[y+1]=Math.abs(f-l),s[y+2]=Math.abs(d-h);break;case"subtract":s[y]=u-c,s[y+1]=f-l,s[y+2]=d-h;break;case"darken":s[y]=Math.min(u,c),s[y+1]=Math.min(f,l),s[y+2]=Math.min(d,h);break;case"lighten":s[y]=Math.max(u,c),s[y+1]=Math.max(f,l),s[y+2]=Math.max(d,h);break;case"overlay":s[y]=c<128?2*u*c/255:255-2*(255-u)*(255-c)/255,s[y+1]=l<128?2*f*l/255:255-2*(255-f)*(255-l)/255,s[y+2]=h<128?2*d*h/255:255-2*(255-d)*(255-h)/255;break;case"exclusion":s[y]=c+u-2*c*u/255,s[y+1]=l+f-2*l*f/255,s[y+2]=h+d-2*h*d/255;break;case"tint":s[y]=c+u*g,s[y+1]=l+f*g,s[y+2]=h+d*g}}},getUniformLocations:function(a,n){return{uColor:a.getUniformLocation(n,"uColor")}},sendUniformData:function(a,n){var s=new t.Color(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,a.uniform4fv(n.uColor,s)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendImage=i(r.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(a){var n=this.type+"_"+this.mode,s=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(n)||(a.programCache[n]=this.createProgram(a.context,s)),a.programCache[n]},applyToWebGL:function(a){var n=a.context,s=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(n,s,n.TEXTURE1),this.callSuper("applyToWebGL",a),this.unbindAdditionalTexture(n,n.TEXTURE1)},createTexture:function(a,n){return a.getCachedTexture(n.cacheKey,n._element)},calculateMatrix:function(){var a=this.image,n=a._element.width,s=a._element.height;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/n,-a.top/s,1]},applyTo2d:function(a){var n=a.imageData,s=a.filterBackend.resources,o=n.data,c=o.length,l=n.width,h=n.height,u,f,d,b,g,y,S,B,W,X,P=this.image,J;s.blendImage||(s.blendImage=t.util.createCanvasElement()),W=s.blendImage,X=W.getContext("2d"),W.width!==l||W.height!==h?(W.width=l,W.height=h):X.clearRect(0,0,l,h),X.setTransform(P.scaleX,0,0,P.scaleY,P.left,P.top),X.drawImage(P._element,0,0,l,h),J=X.getImageData(0,0,l,h).data;for(var V=0;V<c;V+=4){g=o[V],y=o[V+1],S=o[V+2],B=o[V+3],u=J[V],f=J[V+1],d=J[V+2],b=J[V+3];switch(this.mode){case"multiply":o[V]=g*u/255,o[V+1]=y*f/255,o[V+2]=S*d/255,o[V+3]=B*b/255;break;case"mask":o[V+3]=b;break}}},getUniformLocations:function(a,n){return{uTransformMatrix:a.getUniformLocation(n,"uTransformMatrix"),uImage:a.getUniformLocation(n,"uImage")}},sendUniformData:function(a,n){var s=this.calculateMatrix();a.uniform1i(n.uImage,1),a.uniformMatrix3fv(n.uTransformMatrix,!1,s)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(a,n){t.Image.fromObject(a.image,function(s){var o=t.util.object.clone(a);o.image=s,n(new t.Image.filters.BlendImage(o))})}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.pow,i=Math.floor,a=Math.sqrt,n=Math.abs,s=Math.round,o=Math.sin,c=Math.ceil,l=t.Image.filters,h=t.util.createClass;l.Resize=h(l.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(u,f){return{uDelta:u.getUniformLocation(f,"uDelta"),uTaps:u.getUniformLocation(f,"uTaps")}},sendUniformData:function(u,f){u.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),u.uniform1fv(f.uTaps,this.taps)},retrieveShader:function(u){var f=this.getFilterWindow(),d=this.type+"_"+f;if(!u.programCache.hasOwnProperty(d)){var b=this.generateShader(f);u.programCache[d]=this.createProgram(u.context,b)}return u.programCache[d]},getFilterWindow:function(){var u=this.tempScale;return Math.ceil(this.lanczosLobes/u)},getTaps:function(){for(var u=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,d=this.getFilterWindow(),b=new Array(d),g=1;g<=d;g++)b[g-1]=u(g*f);return b},generateShader:function(u){for(var f=new Array(u),d=this.fragmentSourceTOP,u,b=1;b<=u;b++)f[b-1]=b+".0 * uDelta";return d+="uniform float uTaps["+u+`];
`,d+=`void main() {
`,d+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,d+=`  float sum = 1.0;
`,f.forEach(function(g,y){d+="  color += texture2D(uTexture, vTexCoord + "+g+") * uTaps["+y+`];
`,d+="  color += texture2D(uTexture, vTexCoord - "+g+") * uTaps["+y+`];
`,d+="  sum += 2.0 * uTaps["+y+`];
`}),d+=`  gl_FragColor = color / sum;
`,d+="}",d},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(u){u.webgl?(u.passes++,this.width=u.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=u.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),u.destinationWidth=this.dW,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceWidth=u.destinationWidth,this.height=u.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),u.destinationHeight=this.dH,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceHeight=u.destinationHeight):this.applyTo2d(u)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(u){return function(f){if(f>=u||f<=-u)return 0;if(f<11920929e-14&&f>-11920929e-14)return 1;f*=Math.PI;var d=f/u;return o(f)/f*o(d)/d}},applyTo2d:function(u){var f=u.imageData,d=this.scaleX,b=this.scaleY;this.rcpScaleX=1/d,this.rcpScaleY=1/b;var g=f.width,y=f.height,S=s(g*d),B=s(y*b),W;this.resizeType==="sliceHack"?W=this.sliceByTwo(u,g,y,S,B):this.resizeType==="hermite"?W=this.hermiteFastResize(u,g,y,S,B):this.resizeType==="bilinear"?W=this.bilinearFiltering(u,g,y,S,B):this.resizeType==="lanczos"&&(W=this.lanczosResize(u,g,y,S,B)),u.imageData=W},sliceByTwo:function(u,f,d,b,g){var y=u.imageData,S=.5,B=!1,W=!1,X=f*S,P=d*S,J=t.filterBackend.resources,V,Y,R=0,N=0,k=f,w=0;for(J.sliceByTwo||(J.sliceByTwo=document.createElement("canvas")),V=J.sliceByTwo,(V.width<f*1.5||V.height<d)&&(V.width=f*1.5,V.height=d),Y=V.getContext("2d"),Y.clearRect(0,0,f*1.5,d),Y.putImageData(y,0,0),b=i(b),g=i(g);!B||!W;)f=X,d=P,b<i(X*S)?X=i(X*S):(X=b,B=!0),g<i(P*S)?P=i(P*S):(P=g,W=!0),Y.drawImage(V,R,N,f,d,k,w,X,P),R=k,N=w,w+=P;return Y.getImageData(R,N,b,g)},lanczosResize:function(u,f,d,b,g){function y(I){var O,ie,x,C,D,L,K,q,Q,ee,M;for(w.x=(I+.5)*P,E.x=i(w.x),O=0;O<g;O++){for(w.y=(O+.5)*J,E.y=i(w.y),D=0,L=0,K=0,q=0,Q=0,ie=E.x-R;ie<=E.x+R;ie++){if(ie<0||ie>=f)continue;ee=i(1e3*n(ie-w.x)),k[ee]||(k[ee]={});for(var A=E.y-N;A<=E.y+N;A++){if(A<0||A>=d)continue;M=i(1e3*n(A-w.y)),k[ee][M]||(k[ee][M]=X(a(r(ee*V,2)+r(M*Y,2))/1e3)),x=k[ee][M],x>0&&(C=(A*f+ie)*4,D+=x,L+=x*S[C],K+=x*S[C+1],q+=x*S[C+2],Q+=x*S[C+3])}}C=(O*b+I)*4,W[C]=L/D,W[C+1]=K/D,W[C+2]=q/D,W[C+3]=Q/D}return++I<b?y(I):B}var S=u.imageData.data,B=u.ctx.createImageData(b,g),W=B.data,X=this.lanczosCreate(this.lanczosLobes),P=this.rcpScaleX,J=this.rcpScaleY,V=2/this.rcpScaleX,Y=2/this.rcpScaleY,R=c(P*this.lanczosLobes/2),N=c(J*this.lanczosLobes/2),k={},w={},E={};return y(0)},bilinearFiltering:function(u,f,d,b,g){var y,S,B,W,X,P,J,V,Y,R,N,k,w=0,E,I=this.rcpScaleX,O=this.rcpScaleY,ie=4*(f-1),x=u.imageData,C=x.data,D=u.ctx.createImageData(b,g),L=D.data;for(J=0;J<g;J++)for(V=0;V<b;V++)for(X=i(I*V),P=i(O*J),Y=I*V-X,R=O*J-P,E=4*(P*f+X),N=0;N<4;N++)y=C[E+N],S=C[E+4+N],B=C[E+ie+N],W=C[E+ie+4+N],k=y*(1-Y)*(1-R)+S*Y*(1-R)+B*R*(1-Y)+W*Y*R,L[w++]=k;return D},hermiteFastResize:function(u,f,d,b,g){for(var y=this.rcpScaleX,S=this.rcpScaleY,B=c(y/2),W=c(S/2),X=u.imageData,P=X.data,J=u.ctx.createImageData(b,g),V=J.data,Y=0;Y<g;Y++)for(var R=0;R<b;R++){for(var N=(R+Y*b)*4,k=0,w=0,E=0,I=0,O=0,ie=0,x=0,C=(Y+.5)*S,D=i(Y*S);D<(Y+1)*S;D++)for(var L=n(C-(D+.5))/W,K=(R+.5)*y,q=L*L,Q=i(R*y);Q<(R+1)*y;Q++){var ee=n(K-(Q+.5))/B,M=a(q+ee*ee);if(M>1&&M<-1)continue;k=2*M*M*M-3*M*M+1,k>0&&(ee=4*(Q+D*f),x+=k*P[ee+3],E+=k,P[ee+3]<255&&(k=k*P[ee+3]/250),I+=k*P[ee],O+=k*P[ee+1],ie+=k*P[ee+2],w+=k)}V[N]=I/w,V[N+1]=O/w,V[N+2]=ie/w,V[N+3]=x/E}return J},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Contrast=i(r.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(this.contrast===0)return;var n=a.imageData,s,o,c=n.data,o=c.length,l=Math.floor(this.contrast*255),h=259*(l+255)/(255*(259-l));for(s=0;s<o;s+=4)c[s]=h*(c[s]-128)+128,c[s+1]=h*(c[s+1]-128)+128,c[s+2]=h*(c[s+2]-128)+128},getUniformLocations:function(a,n){return{uContrast:a.getUniformLocation(n,"uContrast")}},sendUniformData:function(a,n){a.uniform1f(n.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Saturation=i(r.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(this.saturation===0)return;var n=a.imageData,s=n.data,o=s.length,c=-this.saturation,l,h;for(l=0;l<o;l+=4)h=Math.max(s[l],s[l+1],s[l+2]),s[l]+=h!==s[l]?(h-s[l])*c:0,s[l+1]+=h!==s[l+1]?(h-s[l+1])*c:0,s[l+2]+=h!==s[l+2]?(h-s[l+2])*c:0},getUniformLocations:function(a,n){return{uSaturation:a.getUniformLocation(n,"uSaturation")}},sendUniformData:function(a,n){a.uniform1f(n.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Blur=i(r.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var n=a.filterBackend.resources,s,o,c=a.imageData.width,l=a.imageData.height;n.blurLayer1||(n.blurLayer1=t.util.createCanvasElement(),n.blurLayer2=t.util.createCanvasElement()),s=n.blurLayer1,o=n.blurLayer2,(s.width!==c||s.height!==l)&&(o.width=s.width=c,o.height=s.height=l);var h=s.getContext("2d"),u=o.getContext("2d"),f=15,d,b,g,y,S=this.blur*.06*.5;for(h.putImageData(a.imageData,0,0),u.clearRect(0,0,c,l),y=-f;y<=f;y++)d=(Math.random()-.5)/4,b=y/f,g=S*b*c+d,u.globalAlpha=1-Math.abs(b),u.drawImage(s,g,d),h.drawImage(o,0,0),u.globalAlpha=1,u.clearRect(0,0,o.width,o.height);for(y=-f;y<=f;y++)d=(Math.random()-.5)/4,b=y/f,g=S*b*l+d,u.globalAlpha=1-Math.abs(b),u.drawImage(s,d,g),h.drawImage(o,0,0),u.globalAlpha=1,u.clearRect(0,0,o.width,o.height);a.ctx.drawImage(s,0,0);var B=a.ctx.getImageData(0,0,s.width,s.height);return h.globalAlpha=1,h.clearRect(0,0,s.width,s.height),B},getUniformLocations:function(a,n){return{delta:a.getUniformLocation(n,"uDelta")}},sendUniformData:function(a,n){var s=this.chooseRightDelta();a.uniform2fv(n.delta,s)},chooseRightDelta:function(){var a=1,n=[0,0],s;return this.horizontal?this.aspectRatio>1&&(a=1/this.aspectRatio):this.aspectRatio<1&&(a=this.aspectRatio),s=a*this.blur*.12,this.horizontal?n[0]=s:n[1]=s,n}}),r.Blur.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Gamma=i(r.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(a){this.gamma=[1,1,1],r.BaseFilter.prototype.initialize.call(this,a)},applyTo2d:function(a){var n=a.imageData,s=n.data,o=this.gamma,c=s.length,l=1/o[0],h=1/o[1],u=1/o[2],f;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),f=0,c=256;f<c;f++)this.rVals[f]=Math.pow(f/255,l)*255,this.gVals[f]=Math.pow(f/255,h)*255,this.bVals[f]=Math.pow(f/255,u)*255;for(f=0,c=s.length;f<c;f+=4)s[f]=this.rVals[s[f]],s[f+1]=this.gVals[s[f+1]],s[f+2]=this.bVals[s[f+2]]},getUniformLocations:function(a,n){return{uGamma:a.getUniformLocation(n,"uGamma")}},sendUniformData:function(a,n){a.uniform3fv(n.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Composed=i(r.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a),this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1,this.subFilters.forEach(function(n){n.applyTo(a)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(a){return!a.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(a,n){var s=a.subFilters||[],o=s.map(function(l){return new t.Image.filters[l.type](l)}),c=new t.Image.filters.Composed({subFilters:o});return n&&n(c),c}})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.HueRotation=i(r.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,n=t.util.cos(a),s=t.util.sin(a),o=1/3,c=Math.sqrt(o)*s,l=1-n;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=n+l/3,this.matrix[1]=o*l-c,this.matrix[2]=o*l+c,this.matrix[5]=o*l+c,this.matrix[6]=n+o*l,this.matrix[7]=o*l-c,this.matrix[10]=o*l-c,this.matrix[11]=o*l+c,this.matrix[12]=n+o*l},isNeutralState:function(a){return this.calculateMatrix(),r.BaseFilter.prototype.isNeutralState.call(this,a)},applyTo:function(a){this.calculateMatrix(),r.BaseFilter.prototype.applyTo.call(this,a)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof H!="undefined",H));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.clone;if(t.Text){t.warn("fabric.Text is already defined");return}t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,a){this.styles=a?a.styles||{}:{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",a),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){if(this.__skipDimension)return;this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},enlargeSpaces:function(){for(var i,a,n,s,o,c,l,h=0,u=this._textLines.length;h<u;h++){if(this.textAlign!=="justify"&&(h===u-1||this.isEndOfWrapping(h)))continue;if(s=0,o=this._textLines[h],a=this.getLineWidth(h),a<this.width&&(l=this.textLines[h].match(this._reSpacesAndTabs))){n=l.length,i=(this.width-a)/n;for(var f=0,d=o.length;f<=d;f++)c=this.__charBounds[h][f],this._reSpaceAndTab.test(o[f])?(c.width+=i,c.kernedWidth+=i,c.left+=s,s+=i):c.left+=s}}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),a=this.fontSize;return i.width+=a*i.zoomX,i.height+=a*i.zoomY,i},_render:function(i){this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,a,n){i.textBaseline="alphabetic",i.font=this._getFontDeclaration(a,n)},calcTextWidth:function(){for(var i=this.getLineWidth(0),a=1,n=this._textLines.length;a<n;a++){var s=this.getLineWidth(a);s>i&&(i=s)}return i},_renderTextLine:function(i,a,n,s,o,c){this._renderChars(i,a,n,s,o,c)},_renderTextLinesBackground:function(i){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;for(var a=0,n,s,o=i.fillStyle,c,l,h=this._getLeftOffset(),u=this._getTopOffset(),f=0,d=0,b,g,y=0,S=this._textLines.length;y<S;y++){if(n=this.getHeightOfLine(y),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",y)){a+=n;continue}c=this._textLines[y],s=this._getLineLeftOffset(y),d=0,f=0,l=this.getValueOfPropertyAt(y,0,"textBackgroundColor");for(var B=0,W=c.length;B<W;B++)b=this.__charBounds[y][B],g=this.getValueOfPropertyAt(y,B,"textBackgroundColor"),g!==l?(i.fillStyle=l,l&&i.fillRect(h+s+f,u+a,d,n/this.lineHeight),f=b.left,d=b.width,l=g):d+=b.kernedWidth;g&&(i.fillStyle=g,i.fillRect(h+s+f,u+a,d,n/this.lineHeight)),a+=n}i.fillStyle=o,this._removeShadow(i)},getFontCache:function(i){var a=i.fontFamily.toLowerCase();t.charWidthsCache[a]||(t.charWidthsCache[a]={});var n=t.charWidthsCache[a],s=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return n[s]||(n[s]={}),n[s]},_applyCharStyles:function(i,a,n,s,o){this._setFillStyles(a,o),this._setStrokeStyles(a,o),a.font=this._getFontDeclaration(o)},_measureChar:function(i,a,n,s){var o=this.getFontCache(a),c=this._getFontDeclaration(a),l=this._getFontDeclaration(s),h=n+i,u=c===l,f,d,b,g=a.fontSize/this.CACHE_FONT_SIZE,y;if(n&&o[n]!==void 0&&(b=o[n]),o[i]!==void 0&&(y=f=o[i]),u&&o[h]!==void 0&&(d=o[h],y=d-b),f===void 0||b===void 0||d===void 0){var S=this.getMeasuringContext();this._setTextStyles(S,a,!0)}return f===void 0&&(y=f=S.measureText(i).width,o[i]=f),b===void 0&&u&&n&&(b=S.measureText(n).width,o[n]=b),u&&d===void 0&&(d=S.measureText(h).width,o[h]=d,y=d-b),{width:f*g,kernedWidth:y*g}},getHeightOfChar:function(i,a){return this.getValueOfPropertyAt(i,a,"fontSize")},measureLine:function(i){var a=this._measureLine(i);return this.charSpacing!==0&&(a.width-=this._getWidthOfCharSpacing()),a.width<0&&(a.width=0),a},_measureLine:function(i){var a=0,n,s,o=this._textLines[i],c,l,h=0,u=new Array(o.length);for(this.__charBounds[i]=u,n=0;n<o.length;n++)s=o[n],l=this._getGraphemeBox(s,i,n,c),u[n]=l,a+=l.kernedWidth,c=s;return u[n]={left:l?l.left+l.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:a,numOfSpaces:h}},_getGraphemeBox:function(i,a,n,s,o){var c=this.getCompleteStyleDeclaration(a,n),l=s?this.getCompleteStyleDeclaration(a,n-1):{},h=this._measureChar(i,c,s,l),u=h.kernedWidth,f=h.width,d;this.charSpacing!==0&&(d=this._getWidthOfCharSpacing(),f+=d,u+=d);var b={width:f,left:0,height:c.fontSize,kernedWidth:u,deltaY:c.deltaY};if(n>0&&!o){var g=this.__charBounds[a][n-1];b.left=g.left+g.width+h.kernedWidth-h.width}return b},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var a=this._textLines[i],n=this.getHeightOfChar(i,0),s=1,o=a.length;s<o;s++)n=Math.max(this.getHeightOfChar(i,s),n);return this.__lineHeights[i]=n*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,a=0,n=0,s=this._textLines.length;n<s;n++)i=this.getHeightOfLine(n),a+=n===s-1?i/this.lineHeight:i;return a},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,a){i.save();for(var n=0,s=this._getLeftOffset(),o=this._getTopOffset(),c=this._applyPatternGradientTransform(i,a==="fillText"?this.fill:this.stroke),l=0,h=this._textLines.length;l<h;l++){var u=this.getHeightOfLine(l),f=u/this.lineHeight,d=this._getLineLeftOffset(l);this._renderTextLine(a,i,this._textLines[l],s+d-c.offsetX,o+n+f-c.offsetY,l),n+=u}i.restore()},_renderTextFill:function(i){if(!this.fill&&!this.styleHas("fill"))return;this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles())return;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore()},_renderChars:function(i,a,n,s,o,c){var l=this.getHeightOfLine(c),h=this.textAlign.indexOf("justify")!==-1,u,f,d="",b,g=0,y,S=!h&&this.charSpacing===0&&this.isEmptyStyles(c);if(a.save(),o-=l*this._fontSizeFraction/this.lineHeight,S){this._renderChar(i,a,c,0,n.join(""),s,o,l),a.restore();return}for(var B=0,W=n.length-1;B<=W;B++)y=B===W||this.charSpacing,d+=n[B],b=this.__charBounds[c][B],g===0?(s+=b.kernedWidth-b.width,g+=b.width):g+=b.kernedWidth,h&&!y&&(this._reSpaceAndTab.test(n[B])&&(y=!0)),y||(u=u||this.getCompleteStyleDeclaration(c,B),f=this.getCompleteStyleDeclaration(c,B+1),y=this._hasStyleChanged(u,f)),y&&(this._renderChar(i,a,c,B,d,s,o,l),d="",u=f,s+=g,g=0);a.restore()},_renderChar:function(i,a,n,s,o,c,l){var h=this._getStyleDeclaration(n,s),u=this.getCompleteStyleDeclaration(n,s),f=i==="fillText"&&u.fill,d=i==="strokeText"&&u.stroke&&u.strokeWidth;if(!d&&!f)return;h&&a.save(),this._applyCharStyles(i,a,n,s,u),h&&h.textBackgroundColor&&this._removeShadow(a),h&&h.deltaY&&(l+=h.deltaY),f&&a.fillText(o,c,l),d&&a.strokeText(o,c,l),h&&a.restore()},setSuperscript:function(i,a){return this._setScript(i,a,this.superscript)},setSubscript:function(i,a){return this._setScript(i,a,this.subscript)},_setScript:function(i,a,n){var s=this.get2DCursorLocation(i,!0),o=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),c=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),l={fontSize:o*n.size,deltaY:c+o*n.baseline};return this.setSelectionStyles(l,i,a),this},_hasStyleChanged:function(i,a){return i.fill!==a.fill||i.stroke!==a.stroke||i.strokeWidth!==a.strokeWidth||i.fontSize!==a.fontSize||i.fontFamily!==a.fontFamily||i.fontWeight!==a.fontWeight||i.fontStyle!==a.fontStyle||i.deltaY!==a.deltaY},_hasStyleChangedForSvg:function(i,a){return this._hasStyleChanged(i,a)||i.overline!==a.overline||i.underline!==a.underline||i.linethrough!==a.linethrough},_getLineLeftOffset:function(i){var a=this.getLineWidth(i);return this.textAlign==="center"?(this.width-a)/2:this.textAlign==="right"?this.width-a:this.textAlign==="justify-center"&&this.isEndOfWrapping(i)?(this.width-a)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(i)?this.width-a:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i])return this.__lineWidths[i];var a,n=this._textLines[i],s;return n===""?a=0:(s=this.measureLine(i),a=s.width),this.__lineWidths[i]=a,a},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,a,n){var s=this._getStyleDeclaration(i,a);return s&&typeof s[n]!="undefined"?s[n]:this[n]},_renderTextDecoration:function(i,a){if(!this[a]&&!this.styleHas(a))return;for(var n,s,o,c,l,h,u,f,d=this._getLeftOffset(),b=this._getTopOffset(),g,y,S,B,W,X,P,J,V=this._getWidthOfCharSpacing(),Y=0,R=this._textLines.length;Y<R;Y++){if(n=this.getHeightOfLine(Y),!this[a]&&!this.styleHas(a,Y)){b+=n;continue}u=this._textLines[Y],X=n/this.lineHeight,c=this._getLineLeftOffset(Y),y=0,S=0,f=this.getValueOfPropertyAt(Y,0,a),J=this.getValueOfPropertyAt(Y,0,"fill"),g=b+X*(1-this._fontSizeFraction),s=this.getHeightOfChar(Y,0),l=this.getValueOfPropertyAt(Y,0,"deltaY");for(var N=0,k=u.length;N<k;N++)B=this.__charBounds[Y][N],W=this.getValueOfPropertyAt(Y,N,a),P=this.getValueOfPropertyAt(Y,N,"fill"),o=this.getHeightOfChar(Y,N),h=this.getValueOfPropertyAt(Y,N,"deltaY"),(W!==f||P!==J||o!==s||h!==l)&&S>0?(i.fillStyle=J,f&&J&&i.fillRect(d+c+y,g+this.offsets[a]*s+l,S,this.fontSize/15),y=B.left,S=B.width,f=W,J=P,s=o,l=h):S+=B.kernedWidth;i.fillStyle=P,W&&P&&i.fillRect(d+c+y,g+this.offsets[a]*s+l,S-V,this.fontSize/15),b+=n}this._removeShadow(i)},_getFontDeclaration:function(i,a){var n=i||this,s=this.fontFamily,o=t.Text.genericFonts.indexOf(s.toLowerCase())>-1,c=s===void 0||s.indexOf("'")>-1||s.indexOf(",")>-1||s.indexOf('"')>-1||o?n.fontFamily:'"'+n.fontFamily+'"';return[t.isLikelyNode?n.fontWeight:n.fontStyle,t.isLikelyNode?n.fontStyle:n.fontWeight,a?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",c].join(" ")},render:function(i){if(!this.visible)return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)},_splitTextIntoLines:function(i){for(var a=i.split(this._reNewline),n=new Array(a.length),s=[`
`],o=[],c=0;c<a.length;c++)n[c]=t.util.string.graphemeSplit(a[c]),o=o.concat(n[c],s);return o.pop(),{_unwrappedLines:n,lines:a,graphemeText:o,graphemeLines:n}},toObject:function(i){var a=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(i),n=this.callSuper("toObject",a);return n.styles=r(this.styles,!0),n},set:function(i,a){this.callSuper("set",i,a);var n=!1;if(typeof i=="object")for(var s in i)n=n||this._dimensionAffectingProps.indexOf(s)!==-1;else n=this._dimensionAffectingProps.indexOf(i)!==-1;return n&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(i,a,n){if(!i)return a(null);var s=t.parseAttributes(i,t.Text.ATTRIBUTE_NAMES),o=s.textAnchor||"left";if(n=t.util.object.extend(n?r(n):{},s),n.top=n.top||0,n.left=n.left||0,s.textDecoration){var c=s.textDecoration;c.indexOf("underline")!==-1&&(n.underline=!0),c.indexOf("overline")!==-1&&(n.overline=!0),c.indexOf("line-through")!==-1&&(n.linethrough=!0),delete n.textDecoration}"dx"in s&&(n.left+=s.dx),"dy"in s&&(n.top+=s.dy),"fontSize"in n||(n.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in i?l=i.textContent:"firstChild"in i&&i.firstChild!==null&&("data"in i.firstChild&&i.firstChild.data!==null&&(l=i.firstChild.data)),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var h=n.strokeWidth;n.strokeWidth=0;var u=new t.Text(l,n),f=u.getScaledHeight()/u.height,d=(u.height+u.strokeWidth)*u.lineHeight-u.height,b=d*f,g=u.getScaledHeight()+b,y=0;o==="center"&&(y=u.getScaledWidth()/2),o==="right"&&(y=u.getScaledWidth()),u.set({left:u.left-y,top:u.top-(g-u.fontSize*(.07+u._fontSizeFraction))/u.lineHeight,strokeWidth:typeof h!="undefined"?h:1}),a(u)},t.Text.fromObject=function(i,a){return t.Object._fromObject("Text",i,a,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)})((typeof H!="undefined",H));(function(){p.util.object.extend(p.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(typeof e!="undefined"&&!this.styles[e])return!0;var t=typeof e=="undefined"?this.styles:{line:this.styles[e]};for(var r in t)for(var i in t[r])for(var a in t[r][i])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||e==="")return!1;if(typeof t!="undefined"&&!this.styles[t])return!1;var r=typeof t=="undefined"?this.styles:{0:this.styles[t]};for(var i in r)for(var a in r[i])if(typeof r[i][a][e]!="undefined")return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||e==="")return!1;var t=this.styles,r=0,i,a,n=!0,s=0,o;for(var c in t){i=0;for(var l in t[c]){var o=t[c][l],h=o.hasOwnProperty(e);r++,h?(a?o[e]!==a&&(n=!1):a=o[e],o[e]===this[e]&&delete o[e]):n=!1,Object.keys(o).length!==0?i++:delete t[c][l]}i===0&&delete t[c]}for(var u=0;u<this._textLines.length;u++)s+=this._textLines[u].length;n&&r===s&&(this[e]=a,this.removeStyle(e))},removeStyle:function(e){if(!this.styles||!e||e==="")return;var t=this.styles,r,i,a;for(i in t){r=t[i];for(a in r)delete r[a][e],Object.keys(r[a]).length===0&&delete r[a];Object.keys(r).length===0&&delete t[i]}},_extendStyles:function(e,t){var r=this.get2DCursorLocation(e);this._getLineStyle(r.lineIndex)||this._setLineStyle(r.lineIndex),this._getStyleDeclaration(r.lineIndex,r.charIndex)||this._setStyleDeclaration(r.lineIndex,r.charIndex,{}),p.util.object.extend(this._getStyleDeclaration(r.lineIndex,r.charIndex),t)},get2DCursorLocation:function(e,t){typeof e=="undefined"&&(e=this.selectionStart);for(var r=t?this._unwrappedTextLines:this._textLines,i=r.length,a=0;a<i;a++){if(e<=r[a].length)return{lineIndex:a,charIndex:e};e-=r[a].length+this.missingNewlineOffset(a)}return{lineIndex:a-1,charIndex:r[a-1].length<e?r[a-1].length:e}},getSelectionStyles:function(e,t,r){typeof e=="undefined"&&(e=this.selectionStart||0),typeof t=="undefined"&&(t=this.selectionEnd||e);for(var i=[],a=e;a<t;a++)i.push(this.getStyleAtPosition(a,r));return i},getStyleAtPosition:function(e,t){var r=this.get2DCursorLocation(e),i=t?this.getCompleteStyleDeclaration(r.lineIndex,r.charIndex):this._getStyleDeclaration(r.lineIndex,r.charIndex);return i||{}},setSelectionStyles:function(e,t,r){typeof t=="undefined"&&(t=this.selectionStart||0),typeof r=="undefined"&&(r=this.selectionEnd||t);for(var i=t;i<r;i++)this._extendStyles(i,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var r=this.styles&&this.styles[e];return r?r[t]:null},getCompleteStyleDeclaration:function(e,t){for(var r=this._getStyleDeclaration(e,t)||{},i={},a,n=0;n<this._styleProperties.length;n++)a=this._styleProperties[n],i[a]=typeof r[a]=="undefined"?this[a]:r[a];return i},_setStyleDeclaration:function(e,t,r){this.styles[e][t]=r},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}})})();(function(){function e(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}p.IText=p.util.createClass(p.Text,p.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,r){this.callSuper("initialize",t,r),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,r){this[t]!==r&&(this._fireSelectionChanged(),this[t]=r),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var r=this.canvas.contextTop,i=this.canvas.viewportTransform;r.save(),r.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(r),this._clearTextArea(r),t||r.restore()},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var t=this._getCursorBoundaries(),r=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,r):this.renderSelection(t,r),r.restore()},_clearTextArea:function(t){var r=this.width+4,i=this.height+4;t.clearRect(-r/2,-i/2,r,i)},_getCursorBoundaries:function(t){typeof t=="undefined"&&(t=this.selectionStart);var r=this._getLeftOffset(),i=this._getTopOffset(),a=this._getCursorBoundariesOffsets(t);return{left:r,top:i,leftOffset:a.left,topOffset:a.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var r,i,a,n=0,s=0,o,c=this.get2DCursorLocation(t);a=c.charIndex,i=c.lineIndex;for(var l=0;l<i;l++)n+=this.getHeightOfLine(l);r=this._getLineLeftOffset(i);var h=this.__charBounds[i][a];return h&&(s=h.left),this.charSpacing!==0&&a===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing()),o={top:n,left:r+(s>0?s:0)},this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(t,r){var i=this.get2DCursorLocation(),a=i.lineIndex,n=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(a,n,"fontSize"),o=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/o,l=t.topOffset,h=this.getValueOfPropertyAt(a,n,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(a)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,r),r.fillStyle=this.cursorColor||this.getValueOfPropertyAt(a,n,"fill"),r.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,r.fillRect(t.left+t.leftOffset-c/2,l+t.top+h,c,s)},renderSelection:function(t,r){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,a=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=this.textAlign.indexOf("justify")!==-1,s=this.get2DCursorLocation(i),o=this.get2DCursorLocation(a),c=s.lineIndex,l=o.lineIndex,h=s.charIndex<0?0:s.charIndex,u=o.charIndex<0?0:o.charIndex,f=c;f<=l;f++){var d=this._getLineLeftOffset(f)||0,b=this.getHeightOfLine(f),g=0,y=0,S=0;if(f===c&&(y=this.__charBounds[c][h].left),f>=c&&f<l)S=n&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===l)if(u===0)S=this.__charBounds[l][u].left;else{var B=this._getWidthOfCharSpacing();S=this.__charBounds[l][u-1].left+this.__charBounds[l][u-1].width-B}g=b,(this.lineHeight<1||f===l&&this.lineHeight>1)&&(b/=this.lineHeight),this.inCompositionMode?(r.fillStyle=this.compositionColor||"black",r.fillRect(t.left+d+y,t.top+t.topOffset+b,S-y,1)):(r.fillStyle=this.selectionColor,r.fillRect(t.left+d+y,t.top+t.topOffset,S-y,b)),t.topOffset+=g}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),r=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:r}}}),p.IText.fromObject=function(t,r){if(e(t),t.styles)for(var i in t.styles)for(var a in t.styles[i])e(t.styles[i][a]);p.Object._fromObject("IText",t,r,"text")}})();(function(){var e=p.util.object.clone;p.util.object.extend(p.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var r=t.canvas;r&&(r._hasITextHandlers||(r._hasITextHandlers=!0,t._initCanvasHandlers(r)),r._iTextInstances=r._iTextInstances||[],r._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var r=t.canvas;r&&(r._iTextInstances=r._iTextInstances||[],p.util.removeFromArray(r._iTextInstances,t),r._iTextInstances.length===0&&(r._hasITextHandlers=!1,t._removeCanvasHandlers(r)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,r,i,a){var n;return n={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",r,{duration:i,onComplete:function(){n.isAborted||t[a]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return n.isAborted}}),n},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var r=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){r._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,r=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&r&&r.clearContext(r.contextTop||r.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var r=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i--;for(;/\S/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findWordBoundaryRight:function(t){var r=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},findLineBoundaryLeft:function(t){for(var r=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findLineBoundaryRight:function(t){for(var r=0,i=t;!/\n/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},searchWordBoundary:function(t,r){for(var i=this._text,a=this._reSpace.test(i[t])?t-1:t,n=i[a],s=p.reNonWord;!s.test(n)&&a>0&&a<i.length;)a+=r,n=i[a];return s.test(n)&&(a+=r===1?0:1),a},selectWord:function(t){t=t||this.selectionStart;var r=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var r=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){return this.isEditing||!this.editable?void 0:(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this)},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.selected=!1,r.isEditing&&r.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(!this.__isMousedown||!this.isEditing)return;var r=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,a=this.selectionEnd;if((r!==this.__selectionStartOnMouseDown||i===a)&&(i===r||a===r))return;r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==i||this.selectionEnd!==a)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection())},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,r,i){var a=i.slice(0,t),n=p.util.string.graphemeSplit(a).length;if(t===r)return{selectionStart:n,selectionEnd:n};var s=i.slice(t,r),o=p.util.string.graphemeSplit(s).length;return{selectionStart:n,selectionEnd:n+o}},fromGraphemeToStringSelection:function(t,r,i){var a=i.slice(0,t),n=a.join("").length;if(t===r)return{selectionStart:n,selectionEnd:n};var s=i.slice(t,r),o=s.join("").length;return{selectionStart:n,selectionEnd:n+o}},_updateTextarea:function(){if(this.cursorOffsetCache={},!this.hiddenTextarea)return;if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()},updateFromTextArea:function(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),a=i.lineIndex,n=i.charIndex,s=this.getValueOfPropertyAt(a,n,"fontSize")*this.lineHeight,o=r.leftOffset,c=this.calcTransformMatrix(),l={x:r.left+o,y:r.top+r.topOffset+s},h=this.canvas.getRetinaScaling(),u=this.canvas.upperCanvasEl,f=u.width/h,d=u.height/h,b=f-s,g=d-s,y=u.clientWidth/f,S=u.clientHeight/d;return l=p.util.transformPoint(l,c),l=p.util.transformPoint(l,this.canvas.viewportTransform),l.x*=y,l.y*=S,l.x<0&&(l.x=0),l.x>b&&(l.x=b),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps)return;this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){var t=this._textBeforeEdit!==this.text,r=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,r&&(r.blur&&r.blur(),r.parentNode&&r.parentNode.removeChild(r)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,r){var i=this.get2DCursorLocation(t,!0),a=this.get2DCursorLocation(r,!0),n=i.lineIndex,s=i.charIndex,o=a.lineIndex,c=a.charIndex,l,h;if(n!==o){if(this.styles[n])for(l=s;l<this._unwrappedTextLines[n].length;l++)delete this.styles[n][l];if(this.styles[o])for(l=c;l<this._unwrappedTextLines[o].length;l++)h=this.styles[o][l],h&&(this.styles[n]||(this.styles[n]={}),this.styles[n][s+l-c]=h);for(l=n+1;l<=o;l++)delete this.styles[l];this.shiftLineStyles(o,n-o)}else if(this.styles[n]){h=this.styles[n];var u=c-s,f,d;for(l=s;l<c;l++)delete h[l];for(d in this.styles[n])f=parseInt(d,10),f>=c&&(h[f-u]=h[d],delete h[d])}},shiftLineStyles:function(t,r){var i=e(this.styles);for(var a in this.styles){var n=parseInt(a,10);n>t&&(this.styles[n+r]=i[n],i[n-r]||delete this.styles[n])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,r,i,a){var n,s={},o=!1,c=this._unwrappedTextLines[t].length===r;i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(n=this.styles[t][r===0?r:r-1]);for(var l in this.styles[t]){var h=parseInt(l,10);h>=r&&(o=!0,s[h-r]=this.styles[t][l],c&&r===0||delete this.styles[t][l])}var u=!1;for(o&&!c&&(this.styles[t+i]=s,u=!0),u&&i--;i>0;)a&&a[i-1]?this.styles[t+i]={0:e(a[i-1])}:n?this.styles[t+i]={0:e(n)}:delete this.styles[t+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(t,r,i,a){this.styles||(this.styles={});var n=this.styles[t],s=n?e(n):{};i||(i=1);for(var o in s){var c=parseInt(o,10);c>=r&&(n[c+i]=s[c],s[c-i]||delete n[c])}if(this._forceClearCache=!0,a){for(;i--;){if(!Object.keys(a[i]).length)continue;this.styles[t]||(this.styles[t]={}),this.styles[t][r+i]=e(a[i])}return}if(!n)return;for(var l=n[r?r-1:1];l&&i--;)this.styles[t][r+i]=e(l)},insertNewStyleBlock:function(t,r,i){for(var a=this.get2DCursorLocation(r,!0),n=[0],s=0,o=0;o<t.length;o++)t[o]===`
`?(s++,n[s]=0):n[s]++;n[0]>0&&(this.insertCharStyleObject(a.lineIndex,a.charIndex,n[0],i),i=i&&i.slice(n[0]+1)),s&&this.insertNewlineStyleObject(a.lineIndex,a.charIndex+n[0],s);for(var o=1;o<s;o++)n[o]>0?this.insertCharStyleObject(a.lineIndex+o,0,n[o],i):i&&(this.styles[a.lineIndex+o][0]=i[0]),i=i&&i.slice(n[o]+1);n[o]>0&&this.insertCharStyleObject(a.lineIndex+o,0,n[o],i)},setSelectionStartEndWithShift:function(t,r,i){i<=t?(r===t?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<r?this._selectionDirection==="right"?this.selectionEnd=i:this.selectionStart=i:(r===t?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=r),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})})();p.util.object.extend(p.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(!this.canvas)return;this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){if(!this.isEditing)return;this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){if(!this.isEditing)return;this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())},_mouseDownHandlerBefore:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.selected=this===this.canvas._activeObject},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&e.e.button!==1)return;if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),r=this.selectionStart,i=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(r,i,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t=this.getLocalPointer(e),r=0,i=0,a=0,n=0,s=0,o,c,l=0,h=this._textLines.length;l<h&&a<=t.y;l++)a+=this.getHeightOfLine(l)*this.scaleY,s=l,l>0&&(n+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));o=this._getLineLeftOffset(s),i=o*this.scaleX,c=this._textLines[s];for(var u=0,f=c.length;u<f&&(r=i,i+=this.__charBounds[s][u].kernedWidth*this.scaleX,i<=t.x);u++)n++;return this._getNewSelectionStartFromOffset(t,r,i,n,f)},_getNewSelectionStartFromOffset:function(e,t,r,i,a){var n=e.x-t,s=r-e.x,o=s>n||s<0?0:1,c=i+o;return this.flipX&&(c=a-c),c>this._text.length&&(c=this._text.length),c}});p.util.object.extend(p.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=p.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+e.fontSize+";",p.document.body.appendChild(this.hiddenTextarea),p.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),p.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),p.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),p.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(p.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing)return;if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else if(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapDown[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()},onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapUp[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;var r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,i=this._text.length,a=r.length,n,s,o=a-i,c=this.selectionStart,l=this.selectionEnd,h=c!==l,u,f,d;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),g=c>b.selectionStart;h?(n=this._text.slice(c,l),o+=l-c):a<i&&(g?n=this._text.slice(l+o,l):n=this._text.slice(c,c-o)),s=r.slice(b.selectionEnd-o,b.selectionEnd),n&&n.length&&(s.length&&(u=this.getSelectionStyles(c,c+1,!1),u=s.map(function(){return u[0]})),h?(f=c,d=l):g?(f=l-n.length,d=l):(f=l,d=l+n.length),this.removeStyleFromTo(f,d)),s.length&&(t&&s.join("")===p.copiedText&&!p.disableStyleCopyPaste&&(u=p.copiedTextStyle),this.insertNewStyleBlock(s,c,u)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){if(this.selectionStart===this.selectionEnd)return;p.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?p.copiedTextStyle=null:p.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||p.window.clipboardData},_getWidthBeforeCursor:function(e,t){var r=this._getLineLeftOffset(e),i;return t>0&&(i=this.__charBounds[e][t-1],r+=i.left+i.width),r},getDownCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),a=i.lineIndex;if(a===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-r;var n=i.charIndex,s=this._getWidthBeforeCursor(a,n),o=this._getIndexOnLine(a+1,s),c=this._textLines[a].slice(n);return c.length+o+1+this.missingNewlineOffset(a)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),a=i.lineIndex;if(a===0||e.metaKey||e.keyCode===33)return-r;var n=i.charIndex,s=this._getWidthBeforeCursor(a,n),o=this._getIndexOnLine(a-1,s),c=this._textLines[a].slice(0,n),l=this.missingNewlineOffset(a-1);return-this._textLines[a-1].length+o-c.length+(1-l)},_getIndexOnLine:function(e,t){for(var r=this._textLines[e],i=this._getLineLeftOffset(e),a=i,n=0,s,o,c=0,l=r.length;c<l;c++)if(s=this.__charBounds[e][c].width,a+=s,a>t){o=!0;var h=a-s,u=a,f=Math.abs(h-t),d=Math.abs(u-t);n=d<f?c:c-1;break}return o||(n=r.length-1),n},moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var r="get"+e+"CursorOffset",i=this[r](t,this._selectionDirection==="right");t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),i!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t=this._selectionDirection==="left"?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,r){var i;if(e.altKey)i=this["findWordBoundary"+r](this[t]);else if(e.metaKey||e.keyCode===35||e.keyCode===36)i=this["findLineBoundary"+r](this[t]);else return this[t]+=r==="Left"?-1:1,!0;if(typeof i!==void 0&&this[t]!==i)return this[t]=i,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(e,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(e,"selectionStart")},moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var r="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?r+="Shift":r+="outShift",this[r](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(e,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(e,"selectionEnd")},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){typeof t=="undefined"&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,r,i){typeof i=="undefined"&&(i=r),i>r&&this.removeStyleFromTo(r,i);var a=p.util.string.graphemeSplit(e);this.insertNewStyleBlock(a,r,t),this._text=[].concat(this._text.slice(0,r),a,this._text.slice(i)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}});(function(){var e=p.util.toFixed,t=/  +/g;p.util.object.extend(p.Text.prototype,{_toSVG:function(){var r=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(),{reviver:r,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(r){var i=!0,a=this.getSvgTextDecoration(this);return[r.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",a?'text-decoration="'+a+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",r.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(r,i){var a=[],n=[],s=r,o;this._setSVGBg(n);for(var c=0,l=this._textLines.length;c<l;c++)o=this._getLineLeftOffset(c),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(n,c,i+o,s),this._setSVGTextLineText(a,c,i+o,s),s+=this.getHeightOfLine(c);return{textSpans:a,textBgRects:n}},_createTextCharSpan:function(r,i,a,n){var s=r!==r.trim()||r.match(t),o=this.getSvgSpanStyles(i,s),c=o?'style="'+o+'"':"",l=i.deltaY,h="",u=p.Object.NUM_FRACTION_DIGITS;return l&&(h=' dy="'+e(l,u)+'" '),['<tspan x="',e(a,u),'" y="',e(n,u),'" ',h,c,">",p.util.string.escapeXml(r),"</tspan>"].join("")},_setSVGTextLineText:function(r,i,a,n){var s=this.getHeightOfLine(i),o=this.textAlign.indexOf("justify")!==-1,c,l,h="",u,f,d=0,b=this._textLines[i],g;n+=s*(1-this._fontSizeFraction)/this.lineHeight;for(var y=0,S=b.length-1;y<=S;y++)g=y===S||this.charSpacing,h+=b[y],u=this.__charBounds[i][y],d===0?(a+=u.kernedWidth-u.width,d+=u.width):d+=u.kernedWidth,o&&!g&&(this._reSpaceAndTab.test(b[y])&&(g=!0)),g||(c=c||this.getCompleteStyleDeclaration(i,y),l=this.getCompleteStyleDeclaration(i,y+1),g=this._hasStyleChangedForSvg(c,l)),g&&(f=this._getStyleDeclaration(i,y)||{},r.push(this._createTextCharSpan(h,f,a,n)),h="",c=l,a+=d,d=0)},_pushTextBgRect:function(r,i,a,n,s,o){var c=p.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(i),' x="',e(a,c),'" y="',e(n,c),'" width="',e(s,c),'" height="',e(o,c),`"></rect>
`)},_setSVGTextLineBg:function(r,i,a,n){for(var s=this._textLines[i],o=this.getHeightOfLine(i)/this.lineHeight,c=0,l=0,h,u,f=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),d=0,b=s.length;d<b;d++)h=this.__charBounds[i][d],u=this.getValueOfPropertyAt(i,d,"textBackgroundColor"),u!==f?(f&&this._pushTextBgRect(r,f,a+l,n,c,o),l=h.left,c=h.width,f=u):c+=h.kernedWidth;u&&this._pushTextBgRect(r,u,a+l,n,c,o)},_getFillAttributes:function(r){var i=r&&typeof r=="string"?new p.Color(r):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+r+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(r){for(var i=0,a=0,n=0;n<r;n++)i+=this.getHeightOfLine(n);return a=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*a/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(r){var i=p.Object.prototype.getSvgStyles.call(this,r);return i+" white-space: pre;"}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){if(this.__skipDimension)return;this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},_generateStyleMap:function(r){for(var i=0,a=0,n=0,s={},o=0;o<r.graphemeLines.length;o++)r.graphemeText[n]===`
`&&o>0?(a=0,n++,i++):!this.splitByGrapheme&&this._reSpaceAndTab.test(r.graphemeText[n])&&o>0&&(a++,n++),s[o]={line:i,offset:a},n+=r.graphemeLines[o].length,a+=r.graphemeLines[o].length;return s},styleHas:function(r,i){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[i];a&&(i=a.line)}return t.Text.prototype.styleHas.call(this,r,i)},isEmptyStyles:function(r){if(!this.styles)return!0;var i=0,a=r+1,n,s,o=!1,c=this._styleMap[r],l=this._styleMap[r+1];c&&(r=c.line,i=c.offset),l&&(a=l.line,o=a===r,n=l.offset),s=typeof r=="undefined"?this.styles:{line:this.styles[r]};for(var h in s)for(var u in s[h])if(u>=i&&(!o||u<n))for(var f in s[h][u])return!1;return!0},_getStyleDeclaration:function(r,i){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[r];if(!a)return null;r=a.line,i=a.offset+i}return this.callSuper("_getStyleDeclaration",r,i)},_setStyleDeclaration:function(r,i,a){var n=this._styleMap[r];r=n.line,i=n.offset+i,this.styles[r][i]=a},_deleteStyleDeclaration:function(r,i){var a=this._styleMap[r];r=a.line,i=a.offset+i,delete this.styles[r][i]},_getLineStyle:function(r){var i=this._styleMap[r];return!!this.styles[i.line]},_setLineStyle:function(r){var i=this._styleMap[r];this.styles[i.line]={}},_wrapText:function(r,i){var a=[],n;for(this.isWrapping=!0,n=0;n<r.length;n++)a=a.concat(this._wrapLine(r[n],n,i));return this.isWrapping=!1,a},_measureWord:function(r,i,a){var n=0,s,o=!0;a=a||0;for(var c=0,l=r.length;c<l;c++){var h=this._getGraphemeBox(r[c],i,c+a,s,o);n+=h.kernedWidth,s=r[c]}return n},_wrapLine:function(r,i,a,n){var s=0,o=this.splitByGrapheme,c=[],l=[],h=o?t.util.string.graphemeSplit(r):r.split(this._wordJoiners),u="",f=0,d=o?"":" ",b=0,g=0,y=0,S=!0,B=this._getWidthOfCharSpacing(),n=n||0;h.length===0&&h.push([]),a-=n;for(var W=0;W<h.length;W++)u=o?h[W]:t.util.string.graphemeSplit(h[W]),b=this._measureWord(u,i,f),f+=u.length,s+=g+b-B,s>=a&&!S?(c.push(l),l=[],s=b,S=!0):s+=B,!S&&!o&&l.push(d),l=l.concat(u),g=o?0:this._measureWord([d],i,f),f++,S=!1,b>y&&(y=b);return W&&c.push(l),y+n>this.dynamicMinWidth&&(this.dynamicMinWidth=y-B+n),c},isEndOfWrapping:function(r){return this._styleMap[r+1]?this._styleMap[r+1].line!==this._styleMap[r].line:!0},missingNewlineOffset:function(r){return this.splitByGrapheme?this.isEndOfWrapping(r)?1:0:1},_splitTextIntoLines:function(r){for(var i=t.Text.prototype._splitTextIntoLines.call(this,r),a=this._wrapText(i.lines,this.width),n=new Array(a.length),s=0;s<a.length;s++)n[s]=a[s].join("");return i.lines=n,i.graphemeLines=a,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var r={};for(var i in this._styleMap)this._textLines[i]&&(r[this._styleMap[i].line]=1);for(var i in this.styles)r[i]||delete this.styles[i]},toObject:function(r){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(r))}}),t.Textbox.fromObject=function(r,i){return t.Object._fromObject("Textbox",r,i,"text")}})((typeof H!="undefined",H));(function(){var e=p.controlsUtils,t=e.scaleSkewCursorStyleHandler,r=e.scaleCursorStyleHandler,i=e.scalingEqually,a=e.scalingYOrSkewingX,n=e.scalingXOrSkewingY,s=e.scaleOrSkewActionName,o=p.Object.prototype.controls;if(o.ml=new p.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:n,getActionName:s}),o.mr=new p.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:n,getActionName:s}),o.mb=new p.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:a,getActionName:s}),o.mt=new p.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:a,getActionName:s}),o.tl=new p.Control({x:-.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),o.tr=new p.Control({x:.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),o.bl=new p.Control({x:-.5,y:.5,cursorStyleHandler:r,actionHandler:i}),o.br=new p.Control({x:.5,y:.5,cursorStyleHandler:r,actionHandler:i}),o.mtr=new p.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),p.Textbox){var c=p.Textbox.prototype.controls={};c.mtr=o.mtr,c.tr=o.tr,c.br=o.br,c.tl=o.tl,c.bl=o.bl,c.mt=o.mt,c.mb=o.mb,c.mr=new p.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),c.ml=new p.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}})()}),xi=ue(Av=>{np(Av,{FastestExecutor:()=>$u,SmoothExecutor:()=>Yu,options:()=>Xu,setLogLevel:()=>Io,unzip:()=>Vu,version:()=>qu});const Vu=Hu,Xu={},Iv=console.log;function Io(e){console.log=e==="err"?function(){}:Iv}Io("err");const Yu=_s,$u=Ss,qu="0.7.1"});class _s{constructor(){this.frameId=0;this._running=!1}_loop(e){return requestAnimationFrame(()=>{e()?this.frameId=this._loop(e):this._running=!1})}_unloop(){cancelAnimationFrame(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._running=!0,this.frameId=this._loop(e)}stop(){if(!this._running)return;this._running=!1,this._unloop()}}class Ss{constructor(e){this.frameId=0;this._running=!1;this.timeout=typeof e=="number"?e:0}_loop(e){return setTimeout(()=>{e()?this.frameId=this._loop(e):this._running=!1},this.timeout)}_unloop(){clearTimeout(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._running=!0,this.frameId=this._loop(e)}stop(){if(!this._running)return;this._running=!1,this._unloop()}}const ku=lt(Kh()),Jh=["brushTools","penTools","bitmapTools","doubleBitmapTools","fontTools","stringTools","textTools"];function Er(e){return e?e.map(t=>le({},t)):void 0}function Qh(e){var r,i;const t=le({},e);return t.brushTools=Er(e.brushTools),t.penTools=Er(e.penTools),t.bitmapTools=Er(e.bitmapTools),t.doubleBitmapTools=Er(e.doubleBitmapTools),t.fontTools=Er(e.fontTools),t.stringTools=Er(e.stringTools),t.textTools=(r=e.textTools)==null?void 0:r.map(a=>le(le({},a),{textCollection:a.textCollection.map(n=>le({},n))})),t.elements=(i=e.elements)==null?void 0:i.map(a=>a.type==="otGROUP2D"?le(le({},a),{childHandles:a.childHandles.slice()}):le({},a)),t.elementOrder=e.elementOrder&&e.elementOrder.slice(),t}function eu(e,t){const r=e.find(i=>i.handle===t);if(!r||r.type!=="otGROUP2D")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${t}`);return r}function tu(e,t){const r=t.childHandles[0],i=e.find(a=>a.handle===r);return!i||i.type!=="otDOUBLEBITMAP2D"?void 0:i}function xg(e,t){const r=new Map;let i=1;for(const a of t){for(;e.some(n=>n.handle===i);)i++;r.set(a.handle,i),a.handle=i,e.push(a)}return r}function Tg(e,t){const r={};for(const i of Jh){const a=t[i];if(!a)continue;const n=e[i];if(!n){e[i]=a;continue}r[i]=xg(n,a)}return r}function Ft(e,t,r){if(!e)return;for(const i of e){const a=i[t];i[t]=r.get(a)||a}}function Og(e,t,r){switch(t){case"fontTools":{const{textTools:i}=e;i&&i.forEach(a=>Ft(a.textCollection,"fontHandle",r));break}case"stringTools":{const{textTools:i}=e;i&&i.forEach(a=>Ft(a.textCollection,"stringHandle",r));break}case"bitmapTools":{Ft(e.brushTools,"dibHandle",r);break}}}function Cg(e,t,r){switch(t){case"brushTools":const i=e.filter(c=>c.type==="otLINE2D");Ft(i,"brushHandle",r);break;case"penTools":const a=e.filter(c=>c.type==="otLINE2D");Ft(a,"penHandle",r);break;case"bitmapTools":const n=e.filter(c=>c.type==="otBITMAP2D");Ft(n,"bmpHandle",r);break;case"doubleBitmapTools":const s=e.filter(c=>c.type==="otDOUBLEBITMAP2D");Ft(s,"bmpHandle",r);break;case"textTools":const o=e.filter(c=>c.type==="otTEXT2D");Ft(o,"textToolHandle",r);break}}function jg(e,t){for(const r of Jh){const i=t[r];if(!i)continue;Og(e,r,i),e.elements&&Cg(e.elements,r,i)}}function kg(e){let t,r;for(const i of e){if(i.type==="otGROUP2D")continue;(t===void 0||i.position.x<t)&&(t=i.position.x),(r===void 0||i.position.y<r)&&(r=i.position.y)}return{x:t||0,y:r||0}}function Eg(e,t){return e.some(r=>r.type==="otGROUP2D"&&r.childHandles.includes(t.handle))}function Ag(e,t,r){const i=new Map;if(t.length===0)return{map:i,rootHandle:0};let a=1;const n=[];for(const o of t){for(o.type!=="otGROUP2D"&&(o.position={x:o.position.x+r.x,y:o.position.y+r.y});e.some(c=>c.handle===a);)a++;Eg(t,o)||n.push(a),i.set(o.handle,a),o.handle=a,e.push(o)}if(t.length===1)return{map:i,rootHandle:t[0].handle};for(;e.some(o=>o.handle===a);)a++;const s={type:"otGROUP2D",handle:a,childHandles:n,options:0,name:""};return e.push(s),{map:i,rootHandle:s.handle}}function Ig(e,t){for(const r of e){if(r.type!=="otGROUP2D")continue;r.childHandles=r.childHandles.map(i=>t.get(i)||i)}}function Dg(e,t){return e.map(r=>t.get(r)||r)}function Rg(e){return e.elements!==void 0&&e.elements.length>0}class ru{constructor(e){const t=Qh(e);if(!Rg(t))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=t}get result(){return this.scheme}insertChildImage(e,t,r){const{scheme:i}=this,a=Qh(t),n=Tg(i,a);if(jg(a,n),!a.elements)return;const s=eu(i.elements,e),o=tu(i.elements,s);o&&(o.options=1);const c=kg(a.elements),l={x:r.x-c.x,y:r.y-c.y},{map:h,rootHandle:u}=Ag(i.elements,a.elements,l);if(Ig(a.elements,h),s.childHandles.push(u),!a.elementOrder)return;const f=Dg(a.elementOrder,h),d=i.elementOrder;i.elementOrder=d?d.concat(f):f}replaceIcon(e,t){const{scheme:r}=this,i=eu(r.elements,e),a=tu(r.elements,i);if(!a)return;const n={type:"ttREFTODOUBLEDIB2D",handle:0,filename:t};let s=1;if(r.doubleBitmapTools){for(;r.doubleBitmapTools.some(o=>o.handle===s);)s++;r.doubleBitmapTools.push(n)}else r.doubleBitmapTools=[n];a.bmpHandle=n.handle=s}}class iu{constructor(e){const t=this.lib=new Map;for(const r of e){const i=r.name.toUpperCase(),a=t.size;if(t.set(i,r),t.size===a){const n=e.filter(s=>s.name.toUpperCase()===i).map(s=>s.filepathDos);throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: "${r.name}" \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445:
${n.join(`;
`)}.`)}}}get(e){return this.lib.get(e.toUpperCase())}getComposedScheme(e){const t=this.get(e);if(!(t==null?void 0:t.scheme))return;if(!t.children)return t.scheme;const r=new ru(t.scheme);for(const i of t.children){const a=this.get(i.classname);if(!a)throw Error(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${i.classname} #${i.schemeInfo.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const{handle:n,position:s}=i.schemeInfo;a.iconFile&&r.replaceIcon(n,a.iconFile),a.image&&r.insertChildImage(n,a.image,s)}return r.result}}const Qa=/[/\\]/;function Ar(e){return e.split(Qa).map(t=>t.trim()).filter(t=>t.length>0)}function eo(e){if(e.length!==1||!/[A-Z]/.test(e))throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043F\u0440\u0435\u0444\u0438\u043A\u0441 \u0434\u0438\u0441\u043A\u0430: ${e}.`)}function nu(e,t){const r=e.split(":");if(r.length>2)throw Error("\u0414\u0432\u043E\u0435\u0442\u043E\u0447\u0438\u0435 \u043F\u043E\u0441\u043B\u0435 \u043F\u0440\u0435\u0444\u0438\u043A\u0441\u0430 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u043D\u043E \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044C\u0441\u044F \u043B\u0438\u0448\u044C \u0435\u0434\u0438\u043D\u043E\u0436\u0434\u044B.");let i=t,a=r[0];if(r.length!==1){a=r[1];const n=r[0].trim().toUpperCase();eo(n),i=n}return[i,Ar(a)]}const ju=lt(xi()),Cu=lt(xi());class ye extends Map{static create(e){return new Map(e)}static getFreeHandle(e,t){let r=t||0;for(;e.has(++r););return r}}var ae;(function(e){e[e.PI=Math.PI]="PI",e[e.WORD8=0]="WORD8",e[e.INT8=1]="INT8",e[e.WORD16=2]="WORD16",e[e.INT16=3]="INT16",e[e.WORD32=4]="WORD32",e[e.INT32=5]="INT32",e[e.FLOAT32=6]="FLOAT32",e[e.FLOAT40=7]="FLOAT40",e[e.FLOAT64=8]="FLOAT64",e[e.FLOAT80=9]="FLOAT80",e[e.PEN2D=1]="PEN2D",e[e.BRUSH2D=2]="BRUSH2D",e[e.DIB2D=3]="DIB2D",e[e.DOUBLEDIB2D=4]="DOUBLEDIB2D",e[e.FONT2D=5]="FONT2D",e[e.STRING2D=6]="STRING2D",e[e.TEXT2D=7]="TEXT2D",e[e.SPACE3D=8]="SPACE3D",e[e.TEXTURE3D=9]="TEXTURE3D",e[e.SIZE_RESTORED=0]="SIZE_RESTORED",e[e.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",e[e.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",e[e.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",e[e.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",e[e.OTGROUP2D=3]="OTGROUP2D",e[e.OTRGROUP2D=4]="OTRGROUP2D",e[e.OTGROUP3D=5]="OTGROUP3D",e[e.OTOBJECT3D=10]="OTOBJECT3D",e[e.OTLINE_2D=20]="OTLINE_2D",e[e.OTBITMAP_2D=21]="OTBITMAP_2D",e[e.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",e[e.OTTEXT_2D=23]="OTTEXT_2D",e[e.OTVIEW3D_2D=24]="OTVIEW3D_2D",e[e.OTEDITFRAME=50]="OTEDITFRAME",e[e.OTROTATECENTER=51]="OTROTATECENTER",e[e.OTFRAME3D=52]="OTFRAME3D",e[e.OTAXIS3D=53]="OTAXIS3D",e[e.OTPEN2D=101]="OTPEN2D",e[e.OTBRUSH2D=102]="OTBRUSH2D",e[e.OTDIB2D=103]="OTDIB2D",e[e.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",e[e.OTFONT2D=105]="OTFONT2D",e[e.OTSTRING2D=106]="OTSTRING2D",e[e.OTTEXT2D=107]="OTTEXT2D",e[e.OTREFTODIB2D=110]="OTREFTODIB2D",e[e.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",e[e.ATTRSET=1]="ATTRSET",e[e.ATTRRESET=2]="ATTRRESET",e[e.ATTRPUT=3]="ATTRPUT",e[e.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",e[e.PFC_SETCURRENT=16384]="PFC_SETCURRENT",e[e.PFC_SETFRAME=8192]="PFC_SETFRAME",e[e.PFC_PENS=1]="PFC_PENS",e[e.PFC_BRUHS=2]="PFC_BRUHS",e[e.PFC_DIBS=4]="PFC_DIBS",e[e.PFC_DDIBS=8]="PFC_DDIBS",e[e.PFC_STRINGS=16]="PFC_STRINGS",e[e.PFC_FONTS=32]="PFC_FONTS",e[e.PFC_TEXTS=64]="PFC_TEXTS",e[e.PFC_3D=128]="PFC_3D",e[e.PFC_ALL=255]="PFC_ALL",e[e.OID_RESERVED=32e3]="OID_RESERVED",e[e.OID_RCENTER=32001]="OID_RCENTER",e[e.OID_FRAME2D1=32002]="OID_FRAME2D1",e[e.OID_FRAME2D2=32003]="OID_FRAME2D2",e[e.OID_FRAME2D3=32004]="OID_FRAME2D3",e[e.OID_FRAME2D4=32005]="OID_FRAME2D4",e[e.OID_FRAME2D5=32006]="OID_FRAME2D5",e[e.OID_FRAME2D6=32007]="OID_FRAME2D6",e[e.OID_FRAME2D7=32008]="OID_FRAME2D7",e[e.OID_FRAME2D8=32009]="OID_FRAME2D8",e[e.OID_FRAME2D=32010]="OID_FRAME2D",e[e.OID_AXIS3D=32100]="OID_AXIS3D",e[e.OID_FRAME3D1=32102]="OID_FRAME3D1",e[e.OID_FRAME3D2=32103]="OID_FRAME3D2",e[e.OID_FRAME3D3=32104]="OID_FRAME3D3",e[e.OID_FRAME3D4=32105]="OID_FRAME3D4",e[e.OID_FRAME3D5=32106]="OID_FRAME3D5",e[e.OID_FRAME3D6=32107]="OID_FRAME3D6",e[e.OID_FRAME3D7=32108]="OID_FRAME3D7",e[e.OID_FRAME3D8=32109]="OID_FRAME3D8",e[e.OID_FRAME3D=32110]="OID_FRAME3D",e[e.MB_OK=0]="MB_OK",e[e.MB_OKCANCEL=1]="MB_OKCANCEL",e[e.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",e[e.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",e[e.MB_YESNO=4]="MB_YESNO",e[e.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",e[e.MB_TYPEMASK=15]="MB_TYPEMASK",e[e.MB_ICONHAND=16]="MB_ICONHAND",e[e.MB_ICONQUESTION=32]="MB_ICONQUESTION",e[e.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",e[e.MB_ICONASTERISK=64]="MB_ICONASTERISK",e[e.MB_ICONMASK=240]="MB_ICONMASK",e[e.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",e[e.MB_ICONSTOP=16]="MB_ICONSTOP",e[e.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",e[e.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",e[e.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",e[e.MB_DEFMASK=3840]="MB_DEFMASK",e[e.MB_APPLMODAL=0]="MB_APPLMODAL",e[e.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",e[e.MB_TASKMODAL=8192]="MB_TASKMODAL",e[e.MB_NOFOCUS=32768]="MB_NOFOCUS",e[e.SW_HIDE=0]="SW_HIDE",e[e.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",e[e.SW_NORMAL=1]="SW_NORMAL",e[e.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",e[e.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",e[e.SW_MAXIMIZE=3]="SW_MAXIMIZE",e[e.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",e[e.SW_SHOW=5]="SW_SHOW",e[e.SW_MINIMIZE=6]="SW_MINIMIZE",e[e.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",e[e.SW_SHOWNA=8]="SW_SHOWNA",e[e.SW_RESTORE=9]="SW_RESTORE",e[e.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",e[e.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",e[e.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",e[e.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",e[e.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",e[e.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",e[e.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",e[e.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",e[e.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",e[e.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",e[e.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",e[e.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",e[e.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",e[e.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",e[e.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",e[e.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",e[e.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",e[e.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",e[e.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",e[e.MCIERR_DRIVER=278]="MCIERR_DRIVER",e[e.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",e[e.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",e[e.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",e[e.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",e[e.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",e[e.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",e[e.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",e[e.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",e[e.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",e[e.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",e[e.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",e[e.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",e[e.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",e[e.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",e[e.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",e[e.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",e[e.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",e[e.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",e[e.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",e[e.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",e[e.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",e[e.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",e[e.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",e[e.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",e[e.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",e[e.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",e[e.MCIERR_GET_CD=307]="MCIERR_GET_CD",e[e.MCIERR_SET_CD=308]="MCIERR_SET_CD",e[e.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",e[e.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",e[e.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",e[e.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",e[e.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",e[e.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",e[e.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",e[e.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",e[e.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",e[e.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",e[e.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",e[e.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",e[e.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",e[e.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",e[e.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",e[e.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",e[e.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",e[e.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",e[e.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",e[e.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",e[e.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",e[e.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",e[e.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",e[e.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",e[e.WS_VISIBLE=268435456]="WS_VISIBLE",e[e.WS_DISABLED=134217728]="WS_DISABLED",e[e.WS_CAPTION=12582912]="WS_CAPTION",e[e.WS_BORDER=8388608]="WS_BORDER",e[e.WS_DLGFRAME=4194304]="WS_DLGFRAME",e[e.WS_VSCROLL=2097152]="WS_VSCROLL",e[e.WS_HSCROLL=1048576]="WS_HSCROLL",e[e.WS_SYSMENU=524288]="WS_SYSMENU",e[e.WS_THICKFRAME=262144]="WS_THICKFRAME",e[e.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",e[e.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",e[e.WS_GROUP=131072]="WS_GROUP",e[e.WS_TABSTOP=65536]="WS_TABSTOP",e[e.WS_OVERLAPPED=0]="WS_OVERLAPPED",e[e.WS_POPUP=2147483648]="WS_POPUP",e[e.WS_CHILD=1073741824]="WS_CHILD",e[e.IDX_PRIMARY=1]="IDX_PRIMARY",e[e.IDX_UNIQUE=2]="IDX_UNIQUE",e[e.IDX_DESCENDING=4]="IDX_DESCENDING",e[e.IDX_MAINTAINED=8]="IDX_MAINTAINED",e[e.IDX_SUBSET=16]="IDX_SUBSET",e[e.IDX_EXPR=32]="IDX_EXPR",e[e.IDX_IDXOOD=64]="IDX_IDXOOD",e[e.IDX_CASEINSENS=128]="IDX_CASEINSENS",e[e.FLDDBCHAR=513]="FLDDBCHAR",e[e.FLDDBNUM=514]="FLDDBNUM",e[e.FLDDBMEMO=515]="FLDDBMEMO",e[e.FLDDBBOOL=516]="FLDDBBOOL",e[e.FLDDBDATE=517]="FLDDBDATE",e[e.FLDDBFLOAT=518]="FLDDBFLOAT",e[e.FLDDBLOCK=519]="FLDDBLOCK",e[e.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",e[e.FLDDBBINARY=521]="FLDDBBINARY",e[e.FLDDBBYTES=522]="FLDDBBYTES",e[e.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",e[e.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",e[e.BS_CHECKBOX=2]="BS_CHECKBOX",e[e.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",e[e.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",e[e.BS_3STATE=5]="BS_3STATE",e[e.BS_AUTO3STATE=6]="BS_AUTO3STATE",e[e.BS_GROUPBOX=7]="BS_GROUPBOX",e[e.BS_USERBUTTON=8]="BS_USERBUTTON",e[e.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",e[e.BS_OWNERDRAW=11]="BS_OWNERDRAW",e[e.BS_LEFTTEXT=32]="BS_LEFTTEXT",e[e.ES_LEFT=0]="ES_LEFT",e[e.ES_CENTER=1]="ES_CENTER",e[e.ES_RIGHT=2]="ES_RIGHT",e[e.ES_MULTILINE=4]="ES_MULTILINE",e[e.ES_UPPERCASE=8]="ES_UPPERCASE",e[e.ES_LOWERCASE=16]="ES_LOWERCASE",e[e.ES_PASSWORD=32]="ES_PASSWORD",e[e.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",e[e.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",e[e.ES_NOHIDESEL=256]="ES_NOHIDESEL",e[e.SBS_HORZ=0]="SBS_HORZ",e[e.SBS_VERT=1]="SBS_VERT",e[e.SBS_TOPALIGN=2]="SBS_TOPALIGN",e[e.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",e[e.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",e[e.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",e[e.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",e[e.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",e[e.SBS_SIZEBOX=8]="SBS_SIZEBOX",e[e.LBS_NOTIFY=1]="LBS_NOTIFY",e[e.LBS_SORT=2]="LBS_SORT",e[e.LBS_NOREDRAW=4]="LBS_NOREDRAW",e[e.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",e[e.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",e[e.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",e[e.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",e[e.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",e[e.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",e[e.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",e[e.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",e[e.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",e[e.CBS_SIMPLE=1]="CBS_SIMPLE",e[e.CBS_DROPDOWN=2]="CBS_DROPDOWN",e[e.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",e[e.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",e[e.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",e[e.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",e[e.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",e[e.CBS_SORT=256]="CBS_SORT",e[e.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",e[e.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",e[e.BS_SOLID=0]="BS_SOLID",e[e.BS_NULL=1]="BS_NULL",e[e.BS_HATCHED=2]="BS_HATCHED",e[e.BS_PATTERN=3]="BS_PATTERN",e[e.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",e[e.HS_HORIZONTAL=0]="HS_HORIZONTAL",e[e.HS_VERTICAL=1]="HS_VERTICAL",e[e.HS_FDIAGONAL=2]="HS_FDIAGONAL",e[e.HS_BDIAGONAL=3]="HS_BDIAGONAL",e[e.HS_CROSS=4]="HS_CROSS",e[e.HS_DIAGCROSS=5]="HS_DIAGCROSS",e[e.PS_SOLID=0]="PS_SOLID",e[e.PS_DASH=1]="PS_DASH",e[e.PS_DOT=2]="PS_DOT",e[e.PS_DASHDOT=3]="PS_DASHDOT",e[e.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",e[e.PS_NULL=5]="PS_NULL",e[e.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",e[e.R2_BLACK=1]="R2_BLACK",e[e.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",e[e.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",e[e.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",e[e.R2_MASKPENNOT=5]="R2_MASKPENNOT",e[e.R2_NOT=6]="R2_NOT",e[e.R2_XORPEN=7]="R2_XORPEN",e[e.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",e[e.R2_MASKPEN=9]="R2_MASKPEN",e[e.R2_NOTXORPEN=10]="R2_NOTXORPEN",e[e.R2_NOP=11]="R2_NOP",e[e.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",e[e.R2_COPYPEN=13]="R2_COPYPEN",e[e.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",e[e.R2_MERGEPEN=15]="R2_MERGEPEN",e[e.R2_WHITE=16]="R2_WHITE",e[e.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",e[e.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",e[e.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",e[e.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",e[e.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",e[e.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",e[e.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",e[e.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",e[e.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.CUR_ARROW=0]="CUR_ARROW",e[e.CUR_CROSS=1]="CUR_CROSS",e[e.CUR_TEXT=2]="CUR_TEXT",e[e.CUR_NO=3]="CUR_NO",e[e.CUR_SIZE=4]="CUR_SIZE",e[e.CUR_SIZENESW=5]="CUR_SIZENESW",e[e.CUR_SIZENS=6]="CUR_SIZENS",e[e.CUR_SIZENWSE=7]="CUR_SIZENWSE",e[e.CUR_SIZEWE=8]="CUR_SIZEWE",e[e.CUR_UPARROW=9]="CUR_UPARROW",e[e.CUR_WAIT=10]="CUR_WAIT",e[e.CUR_LINK=11]="CUR_LINK",e[e.CUR_HELP=12]="CUR_HELP",e[e.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",e[e.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",e[e.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",e[e.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",e[e.FOG_NONE=0]="FOG_NONE",e[e.FOG_EXP=1]="FOG_EXP",e[e.FOG_EXP2=2]="FOG_EXP2",e[e.FOG_LINEAR=3]="FOG_LINEAR",e[e.TEX_TYPE_1D=1]="TEX_TYPE_1D",e[e.TEX_TYPE_2D=2]="TEX_TYPE_2D",e[e.TEX_TYPE_3D=3]="TEX_TYPE_3D",e[e.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",e[e.SBF_ONE=0]="SBF_ONE",e[e.SBF_ZERO=1]="SBF_ZERO",e[e.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",e[e.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",e[e.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",e[e.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",e[e.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",e[e.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",e[e.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",e[e.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",e[e.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",e[e.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",e[e.CMPF_LESS=2]="CMPF_LESS",e[e.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",e[e.CMPF_EQUAL=4]="CMPF_EQUAL",e[e.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",e[e.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",e[e.CMPF_GREATER=7]="CMPF_GREATER",e[e.CULL_NONE=1]="CULL_NONE",e[e.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",e[e.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",e[e.SO_FLAT=0]="SO_FLAT",e[e.SO_GOURAUD=1]="SO_GOURAUD",e[e.SO_PHONG=2]="SO_PHONG",e[e.PM_POINTS=1]="PM_POINTS",e[e.PM_WIREFRAME=2]="PM_WIREFRAME",e[e.PM_SOLID=3]="PM_SOLID",e[e.LT_POINT=0]="LT_POINT",e[e.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",e[e.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",e[e.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",e[e.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",e[e.OT_POINT_LIST=1]="OT_POINT_LIST",e[e.OT_LINE_LIST=2]="OT_LINE_LIST",e[e.OT_LINE_STRIP=3]="OT_LINE_STRIP",e[e.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",e[e.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",e[e.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",e[e.BBT_POINT=0]="BBT_POINT",e[e.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",e[e.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",e[e.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",e[e.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",e[e.GMM_RELATIVE=0]="GMM_RELATIVE",e[e.GMM_PIXELS=1]="GMM_PIXELS",e[e.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",e[e.GHA_LEFT=0]="GHA_LEFT",e[e.GHA_CENTER=1]="GHA_CENTER",e[e.GHA_RIGHT=2]="GHA_RIGHT",e[e.GVA_TOP=0]="GVA_TOP",e[e.GVA_CENTER=1]="GVA_CENTER",e[e.GVA_BOTTOM=2]="GVA_BOTTOM",e[e.MTHA_LEFT=0]="MTHA_LEFT",e[e.MTHA_CENTER=1]="MTHA_CENTER",e[e.MTVA_BELOW=0]="MTVA_BELOW",e[e.MTVA_ABOVE=1]="MTVA_ABOVE",e[e.MTVA_CENTER=2]="MTVA_CENTER",e[e.PT_BOOL=0]="PT_BOOL",e[e.PT_REAL=1]="PT_REAL",e[e.PT_INT=2]="PT_INT",e[e.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",e[e.PT_SHORT=4]="PT_SHORT",e[e.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",e[e.PT_LONG=6]="PT_LONG",e[e.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",e[e.PT_STRING=8]="PT_STRING",e[e.PT_VECTOR3=9]="PT_VECTOR3",e[e.PT_MATRIX3=10]="PT_MATRIX3",e[e.PT_MATRIX4=11]="PT_MATRIX4",e[e.PT_QUATERNION=12]="PT_QUATERNION",e[e.PT_COLOURVALUE=13]="PT_COLOURVALUE",e[e.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",e[e.NUI_SP_SPINE=1]="NUI_SP_SPINE",e[e.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",e[e.NUI_SP_HEAD=3]="NUI_SP_HEAD",e[e.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",e[e.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",e[e.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",e[e.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",e[e.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",e[e.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",e[e.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",e[e.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",e[e.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",e[e.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",e[e.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",e[e.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",e[e.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",e[e.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",e[e.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",e[e.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",e[e.NUI_SP_COUNT=20]="NUI_SP_COUNT",e[e.WM_DESTROY=2]="WM_DESTROY",e[e.WM_MOVE=3]="WM_MOVE",e[e.WM_SIZE=5]="WM_SIZE",e[e.WM_CLOSE=16]="WM_CLOSE",e[e.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",e[e.WM_COMMAND=273]="WM_COMMAND",e[e.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",e[e.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",e[e.WM_LBUTTONUP=514]="WM_LBUTTONUP",e[e.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",e[e.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",e[e.WM_RBUTTONUP=517]="WM_RBUTTONUP",e[e.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",e[e.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",e[e.WM_MBUTTONUP=520]="WM_MBUTTONUP",e[e.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",e[e.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",e[e.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",e[e.WM_KEYDOWN=256]="WM_KEYDOWN",e[e.WM_KEYUP=257]="WM_KEYUP",e[e.WM_CANCLOSE=1538]="WM_CANCLOSE",e[e.WM_SPACEDONE=1539]="WM_SPACEDONE",e[e.WM_SPACEINIT=1540]="WM_SPACEINIT",e[e.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",e[e.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(ae||(ae={}));class to{constructor({project:e,graphics:t}={}){this._level=0;this.oldFloats=new Float64Array(0);this.newFloats=new Float64Array(0);this.oldInts=new Int32Array(0);this.newInts=new Int32Array(0);this.oldStrings=new Array;this.newStrings=new Array;this.olds=[];this.news=[];this.project=e,this.graphics=t}init({floatsCount:e,intsCount:t,stringsCount:r}){return this.oldFloats=new Float64Array(e),this.newFloats=new Float64Array(e),this.oldInts=new Int32Array(t),this.newInts=new Int32Array(t),this.oldStrings=new Array(r).fill(""),this.newStrings=new Array(r).fill(""),this.olds[he.Float]=this.oldFloats,this.olds[he.Handle]=this.oldInts,this.olds[he.ColorRef]=this.oldInts,this.olds[he.String]=this.oldStrings,this.news[he.Float]=this.newFloats,this.news[he.Handle]=this.newInts,this.news[he.ColorRef]=this.newInts,this.news[he.String]=this.newStrings,this}sync(){this.oldFloats.set(this.newFloats),this.oldInts.set(this.newInts);for(let e=0;e<this.newStrings.length;e++)this.oldStrings[e]=this.newStrings[e];return this}assertZeroIndexEmpty(){if(this.oldFloats[0]!==0||this.newFloats[0]!==0||this.oldInts[0]!==0||this.newInts[0]!==0||this.oldStrings[0]!==""||this.newStrings[0]!=="")throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}get level(){return this._level}inc(){++this._level}dec(){--this._level}getTime(e,t,r,i,a,n,s,o){const c=new Date;e[t]=c.getHours(),r[i]=c.getMinutes(),a[n]=c.getSeconds(),s[o]=c.getMilliseconds()*.1}getDate(e,t,r,i,a,n){const s=new Date;e[t]=s.getFullYear(),r[i]=s.getMonth(),a[n]=s.getDate()}getTickCount(){return new Date().getTime()-Bg}newArray(){throw Error("\u0424\u0443\u043D\u043A\u0446\u0438\u044F New \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}MCISendString(){return 263}}const Bg=new Date().getTime();var he;(function(e){e[e.Float=1]="Float",e[e.Handle=2]="Handle",e[e.String=3]="String",e[e.ColorRef=4]="ColorRef"})(he||(he={}));const Ng=["getClassName","getHObject","setVar","sendMessage","setCapture","releaseCapture","registerObject","unregisterObject"],Lg=["closeAll","openSchemeWindow","loadSpaceWindow","createObjectFromFile2D","createDIB2d","createDoubleDib2D","getClassDirectory","fileExist"],Fg=["getAsyncKeyState","getWindowName","getWindowSpace","getSpaceOrg2dx","getSpaceOrg2dy","setSpaceOrg2d","getScaleSpace2d","setScaleSpace2d","getObjectOrg2dx","getObjectOrg2dy","setObjectOrg2d","rotateObject2d","getActualWidth2d","getActualHeight2d","getObjectWidth2d","getObjectHeight2d","setObjectSize2d","getZOrder2d","setZOrder2d","setObjectName2d","setShowObject2d","objectToTop2d","deleteObject2d","createGroup2d","getGroupItem2d","delGroupItem2d","getObject2dByName","getObjectParent2d","deleteGroup2d","getObjectFromPoint2d","isObjectsIntersect2d","createPolyLine2d","createLine2d","addPoint2d","getVectorPoint2dx","getVectorPoint2dy","setVectorPoint2d","getPenObject2d","getBrushObject2d","createRasterText2D","getTextObject2d","getControlText2d","setControlText2d","createBitmap2d","createDoubleBitmap2D","setBitmapSrcRect2d","createPen2d","getPenStyle2d","setPenStyle2d","getPenWidth2d","setPenWidth2d","getPenColor2d","setPenColor2d","getPenRop2d","setPenRop2d","createBrush2d","getBrushStyle2d","setBrushStyle2d","getBrushHatch2d","setBrushHatch2d","getBrushColor2d","setBrushColor2d","getBrushRop2d","setBrushRop2d","createText2D","getTextCount2d","getTextFont2d","getTextString2d","getTextFgColor2d","getTextBkColor2d","setText2D","createString2D","getstring2d","setString2d","createFont2D","getWindowProp","isWindowExist","getWindowOrgX","getWindowOrgY","setWindowOrg","getWindowWidth","getWindowHeight","getClientWidth","getClientHeight","setClientSize","showWindow","closeWindow","bringWindowToTop","setWindowTransparent","setWindowTransparentColor","setWindowOwner","getScreenWidth","getScreenHeight","getWorkAreaX","getWorkAreaY","getWorkAreaWidth","getWorkAreaHeight"],ro="schema",io="project",vn="graphics",au=new Map([["ROUND","roundPrec"],["ADDSLASH","addSlash"],["NEW","env.newArray"],["MCISENDSTRING","env.MCISendString"],["GETTICKCOUNT","env.getTickCount"],...Ng.map(e=>[e.toUpperCase(),`${ro}.${e}`]),...Lg.map(e=>[e.toUpperCase(),`${io}.${e}`]),...Fg.map(e=>[e.toUpperCase(),`${vn}.${e}`])]),no="'",ao='"';function ou(e){let t="",r;for(let i=0;i<e.length;++i){const a=e[i];if(a===no&&r!==ao?r=r?void 0:no:a===ao&&r!==no&&(r=r?void 0:ao),r){t+=a;continue}if(a==="/"){const n=e[i+1];if(n==="*"){for(i+=2;i<e.length&&(e[i]!=="*"||e[i+1]!=="/");)++i;++i;continue}if(n==="/"){for(++i;i<e.length&&e[++i]!==`
`;);t[t.length-1]!==`
`&&(t+=`
`);continue}}if(a===";"||a===`
`){t[t.length-1]!==`
`&&(t+=`
`);continue}if(a==="\r"){e[i+1]===`
`&&++i,t[t.length-1]!==`
`&&(t+=`
`);continue}t+=a}return t[t.length-1]===`
`?t:t+`
`}const cu=lt(lu()),yi=new Map([[he.Float,"Floats"],[he.Handle,"Ints"],[he.ColorRef,"Ints"],[he.String,"Strings"]]),Pg="TLB",Mg=`
function right(a, n) {
    return a.substr(a.length - n);
}
function roundPrec(a, b) {
    const pw = Math.ceil(100 ** b);
    return Math.round(a * pw + Number.EPSILON) / pw;
}
function addSlash(a) {
    return a[a.length - 1] === "\\\\" ? a : a + "\\\\";
}
const { ${Pg} } = ${ro};
const { newFloats, newStrings, newInts, oldFloats, oldInts, oldStrings, ${io}, ${vn} } = env;
`;let oo=!1;function yn(e,t){e.isNew&&e.type!=="var"&&(oo=!0);switch(e.type){case"const":{const r=e.value;return r[0]==="#"?r.length>1?r.substring(1,r.length):"0":r[0]==='"'||r[0]==="'"?"`"+r.substring(1,r.length-1).split("\\").join("\\\\").split("`").join("\\`")+"`":r}case"-":return"-"+St(e.operand,t);case"!":return"!"+St(e.operand,t);case"var":{if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const r=e.name.toUpperCase(),i=t.nameUCToId.get(r);if(i===void 0){const n=ae[r];if(n===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0438\u043B\u0438 \u043A\u043E\u043D\u0441\u0442\u0430\u043D\u0442\u0430: ${e.name}`);return n}const a=yi.get(t.types[i]);if(!a)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${t.types[i]} ${e.to}`);return`${e.isNew?"new":"old"}${a}[TLB[${i}]]`}case"call":{const r=e.name.toUpperCase();if(r==="EXIT")return"return";if(r==="SYSTEM")return"0";if(r==="GETTIME"){const n=yi.get(he.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const s=e.args.map(o=>{const c=o.first.name,l=t.nameUCToId.get(c.toUpperCase());if(l===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetTime: ${c}`);return`${o.first.isNew?"new":"old"}${n},TLB[${l}]`});return`env.getTime(${s.join(",")})`}if(r==="GETDATE"){const n=yi.get(he.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const s=e.args.map(o=>{const c=o.first.name,l=t.nameUCToId.get(c.toUpperCase());if(l===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetDate: ${c}`);return`${o.first.isNew?"new":"old"}${n},TLB[${l}]`});return`env.getDate(${s.join(",")})`}if(r==="GETACTUALSIZE2D"){const n=yi.get(he.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const s=e.args.slice(0,2).map(c=>St(c,t)),o=e.args.slice(2,4).map(c=>{const l=c.first.name,h=t.nameUCToId.get(l.toUpperCase());if(h===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetActualSize2d: ${l}`);return`${c.first.isNew?"new":"old"}${n},TLB[${h}]`});return`${vn}.getActualSize2d(${s.join(",")},${o.join(",")})`}const i=e.args.map(n=>St(n,t));if(r==="NOT")return`((${i[0]})>0===true?0:1)`;if(r==="AND")return`(((${i[0]})>0&&(${i[1]})>0)===true?1:0)`;if(r==="SQR")return`(${i[0]})**2`;if(r==="ABS")return`(Math.abs(${i[0]})||0)`;if(r==="TRUNC")return`(Math.trunc(${i[0]})||0)`;if(r==="SQRT")return`(Math.sqrt(${i[0]})||0)`;if(r==="SIN")return`(Math.sin(${i[0]})||0)`;if(r==="COS")return`(Math.cos(${i[0]})||0)`;if(r==="MIN")return`(Math.min(${i[0]}, ${i[1]})||0)`;if(r==="MAX")return`(Math.max(${i[0]}, ${i[1]})||0)`;if(r==="AVERAGE")return`((${i[0]})/2+(${i[1]})/2)`;if(r==="HANDLE")return`(parseInt(${i[0]})||0)`;if(r==="FLOAT")return`(parseFloat(${i[0]})||0)`;if(r==="STRING")return`(Math.round((${i[0]})*100000)/100000).toString()`;if(r==="LENGTH")return`(${i[0]}).length`;if(r==="SUBSTR")return`(${i[0]}).substr(${i[1]},${i[2]})`;if(r==="LEFT")return`(${i[0]}).substr(0,${i[1]})`;if(r==="RIGHT")return`right(${i[0]}, ${i[1]})`;const a=au.get(r);return a||wi.set(r,e.name),`${a||e.name}(${i.join(",")})`}case"expression":return`(${St(e.body,t)})`;default:throw console.log(e),Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u043D\u0434: ${e.type}`)}}function St(e,t){const r=yn(e.first,t),i=e.rest.map(a=>a.action==="/"?`/(${yn(a.op,t)} || Infinity)`:a.action+yn(a.op,t));return r+i.join("")}let so=!1;function hu(e,t){switch(e.type){case":=":{if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const r=t.nameUCToId.get(e.to.toUpperCase());if(r===void 0)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${e.to}`);const i=yi.get(t.types[r]);if(!i)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${t.types[r]} ${e.to}`);return`new${i}[TLB[${r}]] = ${St(e.operand,t)};`}case"varsDec":return;case"=":so=!0;return;case"switch":return"do{let exc=false;{";case"case":return`}if ((${St(e.expr.body,t)})&&exc===false) {exc=true;`;case"default":return"}if (exc===false) {exc=true;";case"endswitch":return"}}while(false);";case"if":case"while":return`${e.type} (${St(e.expr.body,t)}) {`;case"endif":case"endwhile":return"}";case"else":return"} else {";case"do":return"do {";case"until":return`}
while(${St(e.expr.body,t)});`;case"break":return"break;";case"callChain":return e.functions.map(r=>`${yn(r,t)}`).join("; ")+";";default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: ${e.type}`)}}const wi=new Map,_i=new Map;function lo(e,t,r){wi.clear();const i=ou(e);let a;try{a=cu.parse(i)}catch(s){throw console.log(i),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${r}: ${s.message}`)}if(a.length===0)return;if(a[0].type==="function"){console.warn(`\u041E\u0431\u044A\u044F\u0432\u043B\u0435\u043D\u0438\u0435 ${r} \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u0438 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E`);return}let n="";so=oo=!1;for(let s=0;s<a.length;++s)try{const o=a[s];{const l=hu(o,t);l&&(n+=l+`
`)}let c=o.then;for(;c;){const l=hu(c,t);l&&(n+=l+`
`),c=c.then}}catch(o){throw console.log(i.split(`
`).filter(c=>c.trim()).map((c,l)=>`${l+1}: ${c}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 ${r}: ${o.message} \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 ${s+1}`)}if(so&&console.warn(`\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B`),oo&&console.warn(`${r}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),n.length===0)return;console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${r}`),wi.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...wi.values()].join(", ")} \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),wi.forEach((s,o)=>_i.set(o,s));try{return new Function("schema","env",Mg+n+`//# sourceURL=${r}`)}catch(s){throw console.log(i.split(`
`).filter(o=>o.trim()).map((o,c)=>`${c+1}: ${o}`).join(`
`)),console.log(n),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r}: ${s.message}`)}}class uu{constructor(e,t){this.x=0;this.y=0;this.width=0;this.height=0;this.hidden=!1;const r=this.elem=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("class","stratum-textbox"),r.style.setProperty("position","absolute"),this.set(t),e.appendChild(r)}updateValues(){const{elem:e,x:t,y:r,width:i,height:a,hidden:n,text:s}=this;e.style.setProperty("left",t+"px"),e.style.setProperty("top",r+"px"),e.style.setProperty("width",i+"px"),e.style.setProperty("height",a+"px"),e.hidden=n,e.value=s}set(e){return Object.assign(this,e),this.updateValues(),this}get text(){return this.elem.value}set text(e){this.elem.value=e}destroy(){this.elem.remove()}onEdit(e){this.elem.addEventListener("input",e)}offEdit(e){this.elem.removeEventListener("input",e)}}const po=lt(Ir()),Wg=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],bu=1<<24,gu=2<<24;function vu(e){const t=e.toLowerCase().trim();if(t.startsWith("transparent"))return bu;if(t.startsWith("syscolor"))return gu|parseInt(t.split("(")[1].split(")")[0]);if(t.startsWith("rgb")){const r=t.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0446\u0432\u0435\u0442: ${e}`)}function nt(e){if(e&bu)return"transparent";const t=e&255;if(e&gu)return Wg[t]||"black";const r=e>>8&255,i=e>>16&255;return`rgb(${t},${r},${i})`}const wu=lt(Ir()),yu={selection:!1,preserveObjectStacking:!0,renderOnAddRemove:!1},Dr={selectable:!1,hoverCursor:"pointer"};class uo{constructor({handle:e,isVisible:t,selectable:r,position:i,scale:a,bmpOrigin:n,bmpSize:s,bmpTool:o},c,l){this.viewRef=c;this.requestRedraw=l;this.type="bitmap";this.handle=e,this.posX=i.x,this.posY=i.y,this.visible=t,this.imageLoaded=!!o.image;const h=le(le({},Dr),{left:i.x-c.x,top:i.y-c.y,cropX:n&&n.x,cropY:n&&n.y,width:s.x,height:s.y,scaleX:a?a.x:1,scaleY:a?a.y:1,visible:t&&this.imageLoaded});this.selectable=r,this.obj=new wu.fabric.Image(o.image,h),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}hasPoint(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){const e=this.imageLoaded;this.obj.set({visible:e}),this.visible=e,this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.visible=!1,this.requestRedraw()}updateBitmap(e){this.imageLoaded=!!e.image;const{cropX:t,cropY:r,width:i,height:a,scaleX:n,scaleY:s}=this.obj,o=this.visible&&this.imageLoaded;this.obj.setElement(e.image).set({cropX:t,cropY:r,width:i,height:a,scaleX:n,scaleY:s,visible:o}).setCoords(),this.requestRedraw()}setRect(e,t,r,i){this.obj.set({cropX:e,cropY:t,width:r,height:i}),this.requestRedraw()}}const Rr=lt(Ir());function _u(e){if(!e)return;switch(e.fillType){case"SOLID":return nt(e.color);case"PATTERN":const t=e.bmpTool;return t&&t.image?new Rr.fabric.Pattern({source:t.image}):"white";default:return}}class Br{constructor({handle:e,points:t,position:r,isVisible:i,selectable:a,brush:n,pen:s},o,c){this.viewRef=o;this.requestRedraw=c;this.type="line";this.handle=e,this.posX=r.x,this.posY=r.y;const l=le(le({},Dr),{left:r.x-o.x,top:r.y-o.y,fill:_u(n),stroke:s&&s.style!=="NULL"?nt(s.color):void 0,strokeWidth:s?s.width||.5:0,visible:i});this.selectable=n?a:!1,this.obj=new Rr.fabric.Polyline(t,l),this.visibleArea=Br.calcSize(t).size}static calcSize(e){const t=e.length>0?e.reduce((r,i)=>({minX:Math.min(r.minX,i.x),maxX:Math.max(r.maxX,i.x),minY:Math.min(r.minY,i.y),maxY:Math.max(r.maxY,i.y)}),{minX:e[0].x,maxX:e[0].x,minY:e[0].y,maxY:e[0].y}):{minX:0,maxX:0,minY:0,maxY:0};return{position:{x:t.minX,y:t.minY},size:{x:t.maxX-t.minX,y:t.maxY-t.minY}}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}hasPoint(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updatePen(e){this.obj.set({strokeWidth:e.width,stroke:nt(e.color)}),this.requestRedraw()}updateBrush(e){this.obj.set({fill:_u(e)}),this.requestRedraw()}setPointPosition(e,t,r){this.obj.points[e]=new Rr.fabric.Point(t,r),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:a}=Br.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}addPoint(e,t,r){e<0?this.obj.points.push(new Rr.fabric.Point(t,r)):this.obj.points.splice(e,0,new Rr.fabric.Point(t,r)),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:a}=Br.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}}const Su=lt(Ir());class fo{constructor({handle:e,isVisible:t,selectable:r,position:i,angle:a,textTool:n},s,o){this.viewRef=s;this.requestRedraw=o;this.type="text";this.handle=e,this.posX=i.x,this.posY=i.y;const{text:c,size:l}=n.assembledText,h=n.getFragment(0),u=le(le({},Dr),{left:i.x-s.x,top:i.y-s.y,angle:-(a||0)*.1,backgroundColor:nt(h.backgroundColor),fill:nt(h.foregroundColor),fontWeight:h.font.bold?"bold":"normal",fontFamily:h.font.name,visible:t,fontSize:l});this.selectable=r,this.obj=new Su.fabric.Text(c,u),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}hasPoint(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updateTextTool(e){const{text:t,size:r}=e.assembledText,i=e.getFragment(0);this.obj.set({text:t,fontSize:r,backgroundColor:nt(i.backgroundColor),fill:nt(i.foregroundColor),fontWeight:i.font.bold?"bold":"normal",fontFamily:i.font.name}),this.requestRedraw()}}class xu{constructor({handle:e,isVisible:t,position:r,classname:i,controlSize:a,text:n},s,o){this.viewRef=s;this.type="control";this.subs=new Set;if(i!=="Edit")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0432\u0432\u043E\u0434\u0430 \u0442\u0438\u043F\u0430 "${i}" \u043F\u043E\u043A\u0430 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F`);this.handle=e,this.posX=r.x,this.posY=r.y,this.selectable=!1,this.visibleArea=le({},a),this.inp=o.textInput({x:r.x-s.x,y:r.y-s.y,width:a.x,height:a.y,hidden:!t,text:n}),this.inp.onEdit(()=>{for(const c of this.subs)c.receive(ae.WM_CONTROLNOTIFY,this.handle,-1,768)})}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.inp.set({x:e-r.x,y:t-r.y})}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.inp.set({x:e-r,y:t-i}),this.posX=e,this.posY=t}scaleTo(e,t){}setAngle(e){}hasPoint(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}testIntersect(e,t){if(this.inp.hidden)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.inp.set({hidden:!1})}hide(){this.inp.set({hidden:!0})}onChange(e){this.subs.add(e)}offChange(e){this.subs.delete(e)}setText(e){this.inp.set({text:e})}getText(){return this.inp.text}destroyHtml(){this.inp.destroy()}}class mo{constructor(e,t,r){this.wnd=t;this.sceneHandle=r;this.objects=ye.create();this.objectsByZReversed=[];this.view={x:0,y:0};this.shouldRedraw=!1;this.moveSubs=new Map;this.leftButtonUpSubs=new Map;this.leftButtonDownSubs=new Map;this.rightButtonUpSubs=new Map;this.rightButtonDownSubs=new Map;this.middleButtonUpSubs=new Map;this.middleButtonDownSubs=new Map;this.canvas=new po.fabric.StaticCanvas(e,yu);const i=a=>{const n=a.target.getBoundingClientRect(),s=this.view.x+a.clientX-n.left,o=this.view.y+a.clientY-n.top,c=a.buttons&1?1:0,l=a.buttons&2?2:0,h=a.buttons&4?16:0,u=c|l|h;Si[1]=c,Si[2]=l,Si[4]=h;switch(a.type){case"pointerdown":{switch(a.button){case 0:this.mevent(this.leftButtonDownSubs,ae.WM_LBUTTONDOWN,s,o,u);return;case 1:this.mevent(this.middleButtonDownSubs,ae.WM_MBUTTONDOWN,s,o,u);return;case 2:this.mevent(this.rightButtonDownSubs,ae.WM_RBUTTONDOWN,s,o,u);return}return}case"pointerup":{switch(a.button){case 0:this.mevent(this.leftButtonUpSubs,ae.WM_LBUTTONUP,s,o,u);return;case 1:this.mevent(this.middleButtonUpSubs,ae.WM_MBUTTONUP,s,o,u);return;case 2:this.mevent(this.rightButtonUpSubs,ae.WM_RBUTTONUP,s,o,u);return}return}case"pointerleave":{this.mevent(this.leftButtonUpSubs,ae.WM_LBUTTONUP,s,o,0);return}case"pointermove":this.mevent(this.moveSubs,ae.WM_MOUSEMOVE,s,o,u);return}};e.addEventListener("pointerdown",i),e.addEventListener("pointerup",i),e.addEventListener("pointerleave",i),e.addEventListener("pointermove",i)}requestRedraw(){this.shouldRedraw=!0}assertNoObject(e){if(this.objects.has(e))throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${e} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`)}createLine(e){this.assertNoObject(e.handle);const t=new Br(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createText(e){this.assertNoObject(e.handle);const t=new fo(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createBitmap(e){this.assertNoObject(e.handle);const t=new uo(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createControl(e){this.assertNoObject(e.handle);const t=new xu(e,this.view,this.wnd);return this.objects.set(e.handle,t),t}updateBrush(e){const{bmpTool:t,color:r}=e;t&&t.image?this.canvas.backgroundImage=new po.fabric.Image(t.image):this.canvas.backgroundColor=nt(r),this.requestRedraw()}placeObjects(e){const t=[];for(const r of e){const i=this.objects.get(r);if(!i)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${r} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`);i.type!=="control"&&this.canvas.add(i.obj),t.push(i)}this.objectsByZReversed=t.reverse().concat(this.objectsByZReversed),this.requestRedraw()}appendObjectToEnd(e){e.type!=="control"&&this.canvas.add(e.obj),this.objectsByZReversed=[e].concat(this.objectsByZReversed),this.requestRedraw()}moveObjectToTop(e){e.type!=="control"&&e.obj.bringToFront();const t=this.objectsByZReversed;this.objectsByZReversed=[e].concat(t.filter(r=>r!==e)),this.requestRedraw()}moveObjectRangeToTop(e){const t=[];for(const i of this.objectsByZReversed.reverse())e.includes(i)&&(i.type!=="control"&&i.obj.bringToFront(),t.push(i));const r=this.objectsByZReversed;this.objectsByZReversed=t.reverse().concat(r.filter(i=>!t.includes(i))),this.requestRedraw()}removeObject(e){e.type==="control"?e.destroyHtml():this.canvas.remove(e.obj),this.objects.delete(e.handle),this.objectsByZReversed=this.objectsByZReversed.filter(t=>t!==e),this.requestRedraw()}setView(e,t){this.view.x=e,this.view.y=t;for(const r of this.objects.values())r.updateAfterViewTranslate();this.requestRedraw()}pointInObject(e,t,r){const i=this.objects.get(e);return i!==void 0?i.hasPoint(t,r):!1}handleAtPoint(e,t){for(const r of this.objectsByZReversed)if(r.selectable===!0&&r.testIntersect(e,t))return r.handle;return 0}setWidth(e){this.canvas.setWidth(e)}setHeight(e){this.canvas.setHeight(e)}calcOffset(){this.canvas.calcOffset(),this.shouldRedraw=!0}redraw(){return this.shouldRedraw===!1?!1:(this.shouldRedraw=!1,this.canvas.renderAll(),!0)}onMouse(e,t,r){switch(t){case ae.WM_MOUSEMOVE:this.moveSubs.set(e,r);break;case ae.WM_LBUTTONDOWN:this.leftButtonDownSubs.set(e,r);break;case ae.WM_LBUTTONUP:this.leftButtonUpSubs.set(e,r);break;case ae.WM_RBUTTONDOWN:this.rightButtonDownSubs.set(e,r);break;case ae.WM_RBUTTONUP:this.rightButtonUpSubs.set(e,r);break;case ae.WM_MBUTTONDOWN:this.middleButtonDownSubs.set(e,r);break;case ae.WM_MBUTTONUP:this.middleButtonUpSubs.set(e,r);break;case ae.WM_ALLMOUSEMESSAGE:this.moveSubs.set(e,r),this.leftButtonDownSubs.set(e,r),this.leftButtonUpSubs.set(e,r),this.rightButtonDownSubs.set(e,r),this.rightButtonUpSubs.set(e,r),this.middleButtonDownSubs.set(e,r),this.middleButtonUpSubs.set(e,r);break}}offMouse(e,t){switch(t){case ae.WM_MOUSEMOVE:this.moveSubs.delete(e);break;case ae.WM_LBUTTONDOWN:this.leftButtonDownSubs.delete(e);break;case ae.WM_LBUTTONUP:this.leftButtonUpSubs.delete(e);break;case ae.WM_RBUTTONDOWN:this.rightButtonDownSubs.delete(e);break;case ae.WM_RBUTTONUP:this.rightButtonUpSubs.delete(e);break;case ae.WM_MBUTTONDOWN:this.middleButtonDownSubs.delete(e);break;case ae.WM_MBUTTONUP:this.middleButtonUpSubs.delete(e);break;case ae.WM_ALLMOUSEMESSAGE:this.moveSubs.delete(e),this.leftButtonDownSubs.delete(e),this.leftButtonUpSubs.delete(e),this.rightButtonDownSubs.delete(e),this.rightButtonUpSubs.delete(e),this.middleButtonDownSubs.delete(e),this.middleButtonUpSubs.delete(e);break}}mevent(e,t,r,i,a){for(const[n,s]of e)(s<1||n.captureEventsFromSpace===this.sceneHandle||this.pointInObject(s,r,i))&&n.receive(t,r,i,a)}}const yo=lt(xi());class Pt{constructor(e,t){this.p=0;this.meta=le({},t),this.v=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength)}get position(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}get size(){return this.v.byteLength}eof(){return this.p>=this.size}bytes(e){const t=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,t}byte(){const e=this.v.getUint8(this.p);return this.p+=1,e}int16(){const e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){const e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){const e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){const e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){const e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?Pt.d.decode(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){const t=this.p;let r=0;for(;r<e-1&&this.v.getUint8(t+ ++r)!==0;);const i=this.fixedString(r);return this.p+=1,i}vmString(){const e=this.uint16()*2,t=this.v.getUint8(this.p+e-2)===0?2:1,r=this.fixedString(e-t);return this.p+=t,r}point2d(){return{x:this.float64(),y:this.float64()}}point2dInt(){return{x:this.int16(),y:this.int16()}}}Pt.d=new TextDecoder("windows-1251");class Mt extends Error{constructor(e,t){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.meta.filepathDos||""}:
${t}`)}}class bt extends Mt{constructor(e,t,r){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${t.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}}class Gg{constructor(e,t=!1,r=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.pos=r,this.view=e,this.is_with_alpha=!!t,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){const e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let t=0;t<e;t++){const r=this.view.getUint8(this.pos++),i=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);this.palette[t]={red:a,green:i,blue:r,quad:n}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){const e="bit"+this.bitPP,t=this.width*this.height*4;if(this.data=new Uint8ClampedArray(t),e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){const e=Math.ceil(this.width/8),t=e%4;let r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let a=0;a<e;a++){const n=this.view.getUint8(this.pos++),s=i*this.width*4+a*8*4;for(let o=0;o<8&&a*8+o<this.width;o++){const c=this.palette[n>>7-o&1];this.data[s+o*4]=c.red,this.data[s+o*4+1]=c.green,this.data[s+o*4+2]=c.blue,this.data[s+o*4+3]=0}}t!==0&&(this.pos+=4-t)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0,r=!1;const i=a=>{const n=this.palette[a];this.data[e]=n.red,this.data[e+1]=n.green,this.data[e+2]=n.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const a=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);if(a===0)if(n===0){this.bottom_up?t--:t++,e=t*this.width*4,r=!1;continue}else{if(n===1)break;if(n===2){const s=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.bottom_up?t-=o:t+=o,e+=o*this.width*4+s*4}else{let s=this.view.getUint8(this.pos++);for(let o=0;o<n;o++)r?i.call(this,s&15):i.call(this,(s&240)>>4),o&1&&o+1<n&&(s=this.view.getUint8(this.pos++)),r=!r;(n+1>>1&1)===1&&this.pos++}}else for(let s=0;s<a;s++)r?i.call(this,n&15):i.call(this,(n&240)>>4),r=!r}}else{const e=Math.ceil(this.width/2),t=e%4;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let a=0;a<e;a++){const n=this.view.getUint8(this.pos++),s=i*this.width*4+a*2*4,o=n>>4,c=n&15;let l=this.palette[o];if(this.data[s]=l.red,this.data[s+1]=l.green,this.data[s+2]=l.blue,this.data[s+3]=255,a*2+1>=this.width)break;l=this.palette[c],this.data[s+4]=l.red,this.data[s+4+1]=l.green,this.data[s+4+2]=l.blue,this.data[s+4+3]=0}t!==0&&(this.pos+=4-t)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0;const r=i=>{const a=this.palette[i];this.data[e]=a.red,this.data[e+1]=a.green,this.data[e+2]=a.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const i=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);if(i===0)if(a===0){this.bottom_up?t--:t++,e=t*this.width*4;continue}else{if(a===1)break;if(a===2){const n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);this.bottom_up?t-=s:t+=s,e+=s*this.width*4+n*4}else{for(let n=0;n<a;n++){const s=this.view.getUint8(this.pos++);r.call(this,s)}(a&1)===1&&this.pos++}}else for(let n=0;n<i;n++)r.call(this,a)}}else{const e=this.width%4;for(let t=this.height-1;t>=0;t--){const r=this.bottom_up?t:this.height-1-t;for(let i=0;i<this.width;i++){const a=this.view.getUint8(this.pos++),n=r*this.width*4+i*4;if(a<this.palette.length){const s=this.palette[a];this.data[n]=s.red,this.data[n+1]=s.green,this.data[n+2]=s.blue,this.data[n+3]=255}else this.data[n]=255,this.data[n+1]=255,this.data[n+2]=255,this.data[n+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){const e=this.width%3,t=parseInt("11111",2),r=t;for(let i=this.height-1;i>=0;i--){const a=this.bottom_up?i:this.height-1-i;for(let n=0;n<this.width;n++){const s=this.view.getUint16(this.pos,!0);this.pos+=2;const o=(s&r)/r*255|0,c=(s>>5&r)/r*255|0,l=(s>>10&r)/r*255|0,h=a*this.width*4+n*4;this.data[h]=l,this.data[h+1]=c,this.data[h+2]=o,this.data[h+3]=255}this.pos+=e}}bit16(){const e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);const t=[0,0,0];for(let r=0;r<16;r++)this.maskRed>>r&1&&t[0]++,this.maskGreen>>r&1&&t[1]++,this.maskBlue>>r&1&&t[2]++;t[1]+=t[0],t[2]+=t[1],t[0]=8-t[0],t[1]-=8,t[2]-=8;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let a=0;a<this.width;a++){const n=this.view.getUint16(this.pos,!0);this.pos+=2;const s=(n&this.maskBlue)<<t[0],o=(n&this.maskGreen)>>t[1],c=(n&this.maskRed)>>t[2],l=i*this.width*4+a*4;this.data[l]=c,this.data[l+1]=o,this.data[l+2]=s,this.data[l+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=n,this.data[s+1]=a,this.data[s+2]=i,this.data[s+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){this.view.getUint8(this.pos++);const i=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=n,this.data[s+1]=a,this.data[s+2]=i,this.data[s+3]=255}}}else for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);const s=t*this.width*4+r*4;this.data[s]=n,this.data[s+1]=a,this.data[s+2]=i,this.data[s+3]=255}}}getData(){return this.data}}function bo(e){return new Gg(e)}function Tu(e){return{width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}function go(e){const t=e.position,r=e.uint16();if(r!==19778)throw new bt(e,r,19778);const i=e.int32();return e.seek(t),i}function vo(e){return new DataView(e.buffer,e.byteOffset)}function wn(e){const t=e.bytes(go(e)),{width:r,height:i}=Tu(vo(t)),a=new Blob([t],{type:"image/bmp"}),n=window.URL||window.webkitURL;return{base64Image:n.createObjectURL(a),width:r,height:i}}const _n=document.createElement("canvas"),Hg=_n.getContext("2d");function Nr(e){const t=e.bytes(go(e)),r=e.bytes(go(e)),{data:i,width:a,height:n}=bo(vo(t)),{data:s}=bo(vo(r));for(let o=3;o<i.length&&o<s.length;o+=4)i[o]=255^s[o-1];return _n.width=a,_n.height=n,Hg.putImageData(new ImageData(i,a,n),0,0),{base64Image:_n.toDataURL(),width:a,height:n}}class Ke{constructor(e){this.subs=new Map;this.handle=e.handle}subscribe(e,t){this.subs.set(e,t)}unsubscribe(e){this.subs.delete(e)}get subCount(){return this.subs.size}dispatchChanges(){this.subs.forEach(e=>e())}}class or extends Ke{constructor(e){super(e);this.size=e.width&&e.height?{x:e.width,y:e.height}:void 0,this._image=e.image,this.asyncLoaded=!e.image}get image(){return this._image}setImage(e){this._image=e,this.dispatchChanges()}setPixel(e,t,r){throw this.asyncLoaded?Error(`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${this.handle} \u0431\u044B\u043B\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0430\u0441\u0438\u043D\u0445\u0440\u043E\u043D\u043D\u043E`):new Error("Method not implemented.")}getPixel(e,t){throw new Error("Method not implemented.")}}function Lr(e){return new Promise(t=>{const r=new Image;r.onload=()=>t(r),r.src=e})}function Vg(e){return ct(this,null,function*(){return new Promise(t=>ct(this,null,function*(){const r=yield fetch(e),i=yield r.arrayBuffer();let a;try{a=Nr(new Pt(i))}catch(s){r.status===200&&console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e}`);return}const n=yield Lr(a.base64Image);t(n)}))})}class Ti{static loadFromParams(e){if(e.type==="ttDIB2D"||e.type==="ttDOUBLEDIB2D"){const a=new or(e);return Lr(e.base64Image).then(n=>a.setImage(n)).catch(()=>{const n=e.type==="ttDIB2D"?"\u0411\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430";console.error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442 "${n}" #${e.handle}`)}),a}const t=new or(e),r=e.filename.toUpperCase(),i=this.cachedIcons.get(r);if(i)i.then(a=>t.setImage(a));else if(yo.options.iconsLocation){const a=`${yo.options.iconsLocation}/${r}`,n=e.type==="ttREFTODIB2D"?Lr(a):Vg(a);this.cachedIcons.set(r,n),n.then(s=>t.setImage(s))}return t}}Ti.cachedIcons=new Map;const xn=lt(Ir());class Sn{constructor({handle:e,name:t,options:r}){this._layer=0;this._isVisible=1;this._selectable=1;if(e===0)throw new Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${t} \u0438\u043C\u0435\u0435\u0442 \u043D\u0443\u043B\u0435\u0432\u043E\u0439 \u0434\u0435\u0441\u043A\u0440\u0438\u043F\u0442\u043E\u0440.`);this.handle=e,this._name=t||"",this.options=r||0,r&&(this._isVisible=r&1?0:1,this._selectable=r&8?0:1,this._layer=(r&7936)>>8)}get parent(){return this._parent}get name(){return this._name}setName(e){return this._name=e,1}}const Xg=180/Math.PI;class zt extends Sn{constructor(e){super(e);this.positionX=0;this.positionY=0;this._angle=0;this.width=0;this.height=0;this._layerVisible=!0;this._hiddenLayers=0;const{position:t,size:r}=e;this.positionX=t.x,this.positionY=t.y,r&&(this.width=r.x,this.height=r.y),this.wasShowed=!!this._isVisible}setPosition(e,t){return this.positionX===e&&this.positionY===t||(this.positionX=e,this.positionY=t,this._isVisible&&this._layerVisible&&this.renderable.setPosition(e,t),this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height)),1}setSize(e,t){return this.width=e,this.height=t,this._isVisible&&this._layerVisible&&this.renderable.scaleTo(e,t),1}get angle(){return this.type==="otTEXT2D"?this._angle:0}rotate(e,t,r){const{positionX:i,positionY:a}=this,n=xn.fabric.util.rotatePoint(new xn.fabric.Point(i,a),new xn.fabric.Point(e,t),r),s=this._angle+r*Xg;return this._angle=s,this._isVisible&&this._layerVisible&&(this.renderable.setAngle(s),this.setPosition(n.x,n.y)),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return this._isVisible}setVisibility(e){const t=e>0?1:0;return t===this._isVisible||(this._isVisible=t,t!==0&&this._layerVisible?this.showVisual():this.hideVisual()),1}showVisual(){if(this.renderable.show(),this.wasShowed)return;this.renderable.setPosition(this.positionX,this.positionY),this.renderable.setAngle(this.angle),this.renderable.scaleTo(this.width,this.height),this.wasShowed=!0}hideVisual(){this.renderable.hide(),this.wasShowed=!1}get isSelectable(){return this._selectable}updateLayerVisibility(e){if(this._layerVisible===e)return;this._layerVisible=e,e?this.showVisual():this.hideVisual()}setHiddenLayers(e){if(this._hiddenLayers===e)return;this._hiddenLayers=e,this.updateLayerVisibility(!(e>>this._layer&1))}get layer(){return this._layer}setLayer(e){if(this._layer===e)return;this._layer=e,this.updateLayerVisibility(!(this._hiddenLayers>>e&1))}}class Fr extends zt{static create(e,t,r){const i=e.bmpHandle,a=e.type==="otBITMAP2D"?r.bitmaps.get(i):r.doubleBitmaps.get(i);return a?new Fr(e,t,a):void 0}constructor(e,t,r){super(e);this.type=e.type;const i=e.bmpSize||e.size||r.size;if(!i){const n=`${e.type==="otBITMAP2D"?"\u0411":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431"}\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430`;throw Error(`${n} #${e.handle}: \u0443 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435\u0442 \u0440\u0430\u0437\u043C\u0435\u0440\u043E\u0432 (\u043E\u0431\u044A\u0435\u043A\u0442: ${this.handle}).`)}const a={x:e.size&&e.bmpSize?e.size.x/e.bmpSize.x:1,y:e.size&&e.bmpSize?e.size.y/e.bmpSize.y:1};if(this.renderable=t.createBitmap({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,scale:a,bmpSize:i,bmpOrigin:e.bmpOrigin,bmpTool:r}),!e.size){const n=this.renderable.getVisibleAreaSize();this.width=n.x,this.height=n.y}this._bmpTool=r,r.subscribe(this,()=>this.renderable.updateBitmap(r))}get bmpTool(){return this._bmpTool}setRect(e,t,r,i){return this.renderable.setRect(e,t,r,i),1}changeBmpTool(e){return this.bmpTool.unsubscribe(this),e.subscribe(this,()=>this.renderable.updateBitmap(e)),this._bmpTool=e,1}unsubFromTools(){this.bmpTool.unsubscribe(this)}}class wo extends zt{constructor(e,t){super(e);this.type="otCONTROL2D";if(this.renderable=t.createControl({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,classname:e.classname,text:e.text,controlSize:e.controlSize}),!e.size){const r=this.renderable.getVisibleAreaSize();this.width=r.x,this.height=r.y}}get text(){return this.renderable.getText()}setText(e){return this.renderable.setText(e),1}}class Pr extends zt{constructor(e,t,r){super(e);this.type="otLINE2D";if(this.points=e.points.slice(),e.penHandle){const i=r&&r.pens.get(e.penHandle);this.changePen(i)}if(e.brushHandle){const i=r&&r.brushes.get(e.brushHandle);this.changeBrush(i)}if(this.renderable=t.createLine({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,points:this.points,pen:this.pen,brush:this.brush}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}}static calculatePosition(e){let t=e[0].x,r=e[0].y;for(const i of e)i.x<t&&(t=i.x),i.y<r&&(r=i.y);return{x:t,y:r}}static create(e,t,r){const i=e.position||this.calculatePosition(e.points);return new Pr(le(le({},e),{position:i}),t,r)}get pen(){return this._pen}get brush(){return this._brush}get hpen(){return this.pen!==void 0?this.pen.handle:0}get hbrush(){return this.brush!==void 0?this.brush.handle:0}pointX(e){const t=this.points[e];return t!==void 0?t.x:0}pointY(e){const t=this.points[e];return t!==void 0?t.y:0}setPointXY(e,t,r){const i=this.points[e];return i===void 0?0:(i.x===t&&i.y===r||(i.x=t,i.y=r,this.renderable.setPointPosition(e,t,r)),1)}addPoint(e,t,r){return e===-1?this.points.push({x:t,y:r}):this.points.splice(e,0,{x:t,y:r}),this.renderable.addPoint(e,t,r),1}changePen(e){return this.pen&&this.pen.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updatePen(e)),this._pen=e,1}changeBrush(e){return this.brush&&this.brush.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updateBrush(e)),this._brush=e,1}unsubFromTools(){this.pen&&this.pen.unsubscribe(this),this.brush&&this.brush.unsubscribe(this)}}class Mr extends zt{constructor(e,t,r){super(e);this.type="otTEXT2D";if(this._angle=e.angle||0,this.renderable=t.createText({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,angle:e.angle,textTool:r}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}this._text=r,r.subscribe(this,()=>this.renderable.updateTextTool(r))}static create(e,t,r){const i=r.texts.get(e.textToolHandle);return i?new Mr(e,t,i):void 0}get textTool(){return this._text}changeTextTool(e){return this._text.unsubscribe(this),this._text=e,e.subscribe(this,()=>this.renderable.updateTextTool(e)),1}unsubFromTools(){this.textTool.unsubscribe(this)}}class zr extends Sn{constructor(e){super(e);this.type="otGROUP2D";this.angle=0;this.positionX=0;this.positionY=0;this.width=0;this.height=0;this.items=[];this.handleChildChanges=!0;e.items&&e.items.length!==0&&this.addItems(e.items)}recalcCoords(){let e,t,r,i;for(const a of this.items){if(!a.isVisible)continue;(e===void 0||a.positionX<e)&&(e=a.positionX),(r===void 0||a.positionY<r)&&(r=a.positionY),(t===void 0||a.positionX+a.width>t)&&(t=a.positionX+a.width),(i===void 0||a.positionY+a.height>i)&&(i=a.positionY+a.height)}this.positionX=e||0,this.positionY=r||0,this.width=t-e||0,this.height=i-r||0,this.parent&&this.parent.recalcCoords()}getItem(e){return this.items[e]}getItemHandle(e){const t=this.items[e];return t!==void 0?t.handle:0}hasItem(e){return e.parent===this?1:0}addItemFast(e){return e.parent===this?0:(this.items.includes(e)||this.items.push(e),e._parent=this,1)}addItem(e){return this.addItemFast(e)&&this.recalcCoords(),1}addItems(e){for(const t of e)this.addItemFast(t);return this.recalcCoords(),1}removeItem(e){if(e.parent!==this)return 0;e._parent=void 0;const t=this.items.indexOf(e);return t<0?0:(this.items.splice(t,1),this.recalcCoords(),1)}getItemsRecursive(e){e||(e=[]);for(const t of this.items)t.type==="otGROUP2D"?t.getItemsRecursive(e):e.push(t);return e}handleChildTransform(e,t,r,i){if(!this.handleChildChanges)return;e<this.positionX&&(this.positionX=e),t<this.positionY&&(this.positionY=t),e+r>this.positionX+this.width&&(this.width=e+r-this.positionX),t+i>this.positionY+this.height&&(this.height=t+i-this.positionY),this.parent&&this.parent.handleChildTransform(e,t,r,i)}setPosition(e,t){if(this.positionX===e&&this.positionY===t)return 1;const r=e-this.positionX,i=t-this.positionY;this.handleChildChanges=!1;for(const a of this.items)a.setPosition(a.positionX+r,a.positionY+i);return this.handleChildChanges=!0,this.positionX=e,this.positionY=t,this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height),1}setSize(e,t){if(this.width===e&&this.height===t)return 1;const r=e/this.width,i=t/this.height;this.handleChildChanges=!1;for(const a of this.items)a.setSize(a.width*r,a.height*i);return this.handleChildChanges=!0,this.width=e,this.height=t,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,e,t),1}rotate(e,t,r){this.handleChildChanges=!1;for(const i of this.items)i.rotate(e,t,r);return this.handleChildChanges=!0,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,this.width,this.height),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return 1}setVisibility(e){if(e)return 1;throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E: \u043F\u043E\u043F\u044B\u0442\u043A\u0430 \u0441\u043A\u0440\u044B\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442-\u0433\u0440\u0443\u043F\u043F\u0443.")}removeAllItems(){this.items.forEach(e=>e._parent=void 0),this.items=[]}}const Yg={0:"SOLID",1:"NULL",2:"HATCED",3:"PATTERN"};class Oi extends Ke{constructor(e,t){super(e);if(this._style=e.style,this._hatch=e.hatch,this._rop=e.rop2,this._color=e.color,this._fillType=Yg[e.style],this._fillType==="HATCED"?console.warn("\u0421\u0442\u0438\u043B\u044C \u0437\u0430\u043B\u0438\u0432\u043A\u0438 HATCED \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D"):this._fillType||console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0437\u0430\u043B\u0438\u0432\u043A\u0438: ${e.style}`),e.dibHandle){const r=t&&t.get(e.dibHandle);this.changeBmpTool(r)}}get style(){return this._style}get hatch(){return this._hatch}get rop(){return this._rop}get color(){return this._color}get fillType(){return this._fillType}get bmpTool(){return this._bmpTool}setRop(e){return this._rop=e,1}setHatch(e){return this._hatch=e,1}setStyle(e){return this._style=e,1}setColor(e){return this._color=e,this.dispatchChanges(),1}setFillType(e){return this._fillType=e,this.dispatchChanges(),1}changeBmpTool(e){return this._bmpTool&&this._bmpTool.unsubscribe(this),e&&e.subscribe(this,()=>this.dispatchChanges()),this._bmpTool=e,this.dispatchChanges(),1}unsubFromBmpTool(){this.bmpTool&&this.bmpTool.unsubscribe(this)}}class Ci extends Ke{constructor(e){super(e);this._name=e.fontName.toLowerCase().startsWith("arial")?"Arial":e.fontName,this._size=-(e.height||0)||e.size,this._bold=!!e.weight}get name(){return this._name}get size(){return this._size}get bold(){return this._bold}}class ji extends Ke{constructor(e){super(e);this._color=e.color,this._width=e.width,this._rop2=e.rop2,this._style=e.style===5?"NULL":"SOLID",this._style2=e.style}get rop(){return this._rop2}get color(){return this._color}get width(){return this._width}get style(){return this._style}get style2(){return this._style2}setStyle(e){return this._style2=e,this._style=e===5?"NULL":"SOLID",1}setRop(e){return this._rop2=e,1}setColor(e){return this._color=e,this.dispatchChanges(),1}setWidth(e){return this._width=e,this.dispatchChanges(),1}}class ki extends Ke{constructor(e){super(e);this._text=e.text}get text(){return this._text}setText(e){return this._text=e,this.dispatchChanges(),1}}class Ur extends Ke{static create(e,t,r){const i=e.textCollection.length,a=new Array;for(let n=0;n<i;n++){const{fontHandle:s,stringHandle:o,foregroundColor:c,backgroundColor:l}=e.textCollection[n],h=t.get(s);if(!h)return;const u=r.get(o);if(!u)return;a[n]={font:h,stringFragment:u,foregroundColor:c,backgroundColor:l}}return new Ur({handle:e.handle,fragments:a})}constructor(e){super(e);e.fragments.forEach(t=>{t.font.subscribe(this,()=>this.update()),t.stringFragment.subscribe(this,()=>this.update())}),this.fragments=e.fragments}get textCount(){return this.fragments.length}get assembledText(){if(!this.cachedString){const e=this.fragments.reduce((r,i)=>r+i.stringFragment.text,""),t=this.fragments.reduce((r,i)=>r+i.font.size,0)/this.fragments.length;this.cachedString={text:e,size:t}}return this.cachedString}getFragment(e){return this.fragments[e]}getStringHandle(e){const t=this.fragments[0];return t!==void 0?t.stringFragment.handle:0}getFontHandle(e){const t=this.fragments[0];return t!==void 0?t.font.handle:0}getFgColor(e){const t=this.fragments[0];return t!==void 0?t.foregroundColor:0}getBgColor(e){const t=this.fragments[0];return t!==void 0?t.backgroundColor:0}setValues(e,t,r,i,a){throw Error()}updateVals2(e,t,r,i,a){const n=this.fragments[0];if(n===void 0)return 0;const s=n.font;t!==void 0&&s!==t&&(n.font=t,s&&s.unsubscribe(this),t.subscribe(this,()=>this.dispatchChanges()));const o=n.stringFragment;return r!==void 0&&o!==r&&(n.stringFragment=r,o&&o.unsubscribe(this),r.subscribe(this,()=>this.dispatchChanges())),n.foregroundColor=i,n.backgroundColor=a,this.update(),1}update(){this.cachedString=void 0,this.dispatchChanges()}unsubFromTools(){this.fragments.forEach(({font:e,stringFragment:t})=>{e.unsubscribe(this),t.unsubscribe(this)})}}class Tn{constructor(e={}){this.bitmaps=e.bitmaps||ye.create(),this.brushes=e.brushes||ye.create(),this.doubleBitmaps=e.doubleBitmaps||ye.create(),this.fonts=e.fonts||ye.create(),this.pens=e.pens||ye.create(),this.strings=e.strings||ye.create(),this.texts=e.texts||ye.create()}createBitmap(e){const t=ye.getFreeHandle(this.bitmaps),{base64Image:r,width:i,height:a}=e,n=new or({handle:t,width:i,height:a});return Lr(r).then(s=>n.setImage(s)),this.bitmaps.set(t,n),t}createBrush(e,t,r,i,a){const n=ye.getFreeHandle(this.brushes),s=new Oi({handle:n,color:r,style:e,dibHandle:i,hatch:t,rop2:a},this.bitmaps);return this.brushes.set(n,s),n}createDoubleBitmap(e){const t=ye.getFreeHandle(this.doubleBitmaps),{base64Image:r,width:i,height:a}=e,n=new or({handle:t,width:i,height:a});return Lr(r).then(s=>n.setImage(s)),this.doubleBitmaps.set(t,n),t}createFont(e,t,r){const i=ye.getFreeHandle(this.fonts),a=!!(r&1),n=!!(r&2),s=!!(r&4),o=!!(r&8),c=new Ci({handle:i,fontName:e,size:t,weight:+o});return this.fonts.set(i,c),i}createPen(e,t,r,i){const a=ye.getFreeHandle(this.pens),n=new ji({handle:a,width:t,color:r,style:e,rop2:i});return this.pens.set(a,n),a}createString(e){const t=ye.getFreeHandle(this.strings),r=new ki({handle:t,text:e});return this.strings.set(t,r),t}createText(e,t,r,i){const a=ye.getFreeHandle(this.texts),n=[{fontHandle:e,stringHandle:t,foregroundColor:r,backgroundColor:i}],s=Ur.create({handle:a,textCollection:n},this.fonts,this.strings);return s===void 0?0:(this.texts.set(a,s),s.handle)}deleteTool(e,t){switch(e){case"ttDIB2D":return this.bitmaps.delete(t)?1:0;case"ttBRUSH2D":const r=this.brushes.get(t);return r?(r.unsubFromBmpTool(),this.brushes.delete(t),1):0;case"ttDOUBLEDIB2D":return this.doubleBitmaps.delete(t)?1:0;case"ttFONT2D":return this.fonts.delete(t)?1:0;case"ttPEN2D":return this.pens.delete(t)?1:0;case"ttSTRING2D":return this.strings.delete(t)?1:0;case"ttTEXT2D":const i=this.texts.get(t);return i?(i.unsubFromTools(),this.texts.delete(t),1):0}}merge(e){e.bitmaps.forEach(t=>{const r=ye.getFreeHandle(this.bitmaps);t.handle=r,this.bitmaps.set(r,t)}),e.brushes.forEach(t=>{const r=ye.getFreeHandle(this.brushes);t.handle=r,this.brushes.set(r,t)}),e.doubleBitmaps.forEach(t=>{const r=ye.getFreeHandle(this.doubleBitmaps);t.handle=r,this.doubleBitmaps.set(r,t)}),e.fonts.forEach(t=>{const r=ye.getFreeHandle(this.fonts);t.handle=r,this.fonts.set(r,t)}),e.pens.forEach(t=>{const r=ye.getFreeHandle(this.pens);t.handle=r,this.pens.set(r,t)}),e.strings.forEach(t=>{const r=ye.getFreeHandle(this.strings);t.handle=r,this.strings.set(r,t)}),e.texts.forEach(t=>{const r=ye.getFreeHandle(this.texts);t.handle=r,this.texts.set(r,t)})}}function _o(e){const{bitmapTools:t,brushTools:r,doubleBitmapTools:i,fontTools:a,penTools:n,stringTools:s,textTools:o}=e,c=t&&ye.create(t.map(g=>[g.handle,Ti.loadFromParams(g)])),l=r&&ye.create(r.map(g=>[g.handle,new Oi(g,c)])),h=i&&ye.create(i.map(g=>[g.handle,Ti.loadFromParams(g)])),u=a&&ye.create(a.map(g=>[g.handle,new Ci(g)])),f=n&&ye.create(n.map(g=>[g.handle,new ji(g)])),d=s&&ye.create(s.map(g=>[g.handle,new ki(g)])),b=o&&ye.create(o.map(g=>{const y=Ur.create(g,u,d);if(!y)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0422\u0435\u043A\u0441\u0442 #${g.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);return[g.handle,y]}));return new Tn({bitmaps:c,brushes:l,doubleBitmaps:h,fonts:u,pens:f,strings:d,texts:b})}function $g(e,t,r){switch(e.type){case"otLINE2D":return new Pr(e,t,r);case"otBITMAP2D":case"otDOUBLEBITMAP2D":return Fr.create(e,t,r);case"otTEXT2D":return Mr.create(e,t,r);case"otCONTROL2D":return new wo(e,t)}}function So(e,t,r,i){const a=ye.create(),n=[];for(const s of e){let o;if(s.type==="otGROUP2D")o=new zr(s),n.push({obj:o,data:s});else{if(o=$g(s,t,r),!o)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C ${s.type} #${s.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);o.setHiddenLayers(i)}a.set(s.handle,o)}for(const{obj:s,data:o}of n){const c=o.childHandles.map(l=>{const h=a.get(l);if(!h)throw Error(`\u0413\u0440\u0443\u043F\u043F\u0430 #${o.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043D\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 #${l}`);if(h.parent)throw Error(`\u0413\u0440\u0443\u043F\u043F\u0430 #${o.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043E\u0431\u044A\u0435\u043A\u0442 #${l}, \u0441\u043E\u0441\u0442\u043E\u044F\u0449\u0438\u0439 \u0432 \u0434\u0440\u0443\u0433\u043E\u0439 \u0433\u0440\u0443\u043F\u043F\u0435`);return h});s.addItems(c)}return a}class xo{constructor({vdr:e,renderer:t}){this._originX=0;this._originY=0;this.layers=0;this.scale=1;if(this.renderer=t,e){const{origin:r,layers:i,brushHandle:a,elements:n,elementOrder:s}=e;if(this.setOrigin(r.x,r.y),this.layers=i,this.tools=_o(e),a){const o=this.tools.brushes.get(a);o&&(o.subscribe(this,()=>this.renderer.updateBrush(o)),t.updateBrush(o))}this.objects=n?So(n,t,this.tools,i):ye.create(),s&&t.placeObjects(s)}else this.tools=new Tn,this.objects=ye.create()}setScale(e){return 1}insertVectorDrawing(e,t,r,i){const a=_o(i),n=[],s=new Map;if(i.elements){let c=0;const l=i.elements.map(h=>{const u=c=ye.getFreeHandle(this.objects,c);return s.set(h.handle,u),le(le({},h),{handle:u})});l.forEach(h=>{h.type==="otGROUP2D"&&(h.childHandles=h.childHandles.map(u=>s.get(u)))});for(const h of So(l,this.renderer,a,i.layers).values())this.objects.set(h.handle,h),h.parent||n.push(h)}if(this.tools.merge(a),n.length===0)return 0;let o;if(n.length>1){const c=ye.getFreeHandle(this.objects);o=new zr({handle:c,items:n}),this.objects.set(c,o)}else o=n[0];return o.setPosition(e,t),i.elementOrder&&this.renderer.placeObjects(i.elementOrder.map(c=>s.get(c))),o.handle}get originX(){return this._originX}get originY(){return this._originY}setOrigin(e,t){return e===this._originX&&t===this.originY||(this._originX=e,this._originY=t,this.renderer.setView(e,t)),1}setLayers(e){if(this.layers!==e)for(const t of this.objects.values())t.type!=="otGROUP2D"&&t.setHiddenLayers(e)}createLine(e,t,r){const i=ye.getFreeHandle(this.objects),a=Array.from({length:r.length/2},(s,o)=>({x:r[o*2],y:r[o*2+1]})),n=Pr.create({handle:i,brushHandle:t,penHandle:e,points:a},this.renderer,this.tools);return this.objects.set(i,n),this.renderer.appendObjectToEnd(n.renderable),i}createBitmap(e,t,r,i){const a=ye.getFreeHandle(this.objects),n=Fr.create({handle:a,bmpHandle:r,position:{x:e,y:t},type:i?"otDOUBLEBITMAP2D":"otBITMAP2D"},this.renderer,this.tools);return n===void 0?0:(this.objects.set(a,n),this.renderer.appendObjectToEnd(n.renderable),a)}createText(e,t,r,i){const a=ye.getFreeHandle(this.objects),n=Mr.create({handle:a,angle:i,position:{x:t,y:r},textToolHandle:e},this.renderer,this.tools);return n===void 0?0:(this.objects.set(a,n),this.renderer.appendObjectToEnd(n.renderable),a)}createGroup(e){const t=new Array(e.length);for(let a=0;a<e.length;a++){const n=e[a],s=this.objects.get(n);s!==void 0&&(t[a]=s)}const r=ye.getFreeHandle(this.objects),i=new zr({handle:r,items:t});return this.objects.set(r,i),r}getObject(e){return this.objects.get(e)}getObject2dByName(e,t){const r=this.findObjectByName(t,e);return r!==void 0?r.handle:0}getObjectParent2d(e){const t=this.objects.get(e);return t!==void 0&&t.parent!==void 0?t.parent.handle:0}getGroupItem2d(e,t){const r=this.objects.get(e);return r!==void 0&&r.type==="otGROUP2D"?r.getItemHandle(t):0}delGroupItem2d(e,t){const r=this.objects.get(t);return r!==void 0&&r.parent!==void 0?r.parent.removeItem(r):0}getObjectFromPoint2d(e,t){const r=this.getObjectFromPoint(e,t);return r!==void 0?r.handle:0}deleteObject(e){const t=this.objects.get(e);if(t===void 0)return 0;if(t.parent!==void 0&&t.parent.removeItem(t),t.type!=="otGROUP2D")t.type!=="otCONTROL2D"&&t.unsubFromTools(),this.renderer.removeObject(t.renderable);else{const r=t.items;t.removeAllItems();for(const i of r)this.deleteObject(i.handle)}return this.objects.delete(e),1}deleteGroup2d(e){const t=this.objects.get(e);return t===void 0||t.type!=="otGROUP2D"?0:(t.removeAllItems(),this.objects.delete(e),1)}moveObjectToTop(e){const t=this.objects.get(e);return t===void 0?0:(t.type==="otGROUP2D"?this.renderer.moveObjectRangeToTop(t.getItemsRecursive().map(r=>r.renderable)):this.renderer.moveObjectToTop(t.renderable),1)}findObjectInGroup(e,t){for(const r of t.items){if(r.name===e)return r;if(r.type==="otGROUP2D")return this.findObjectInGroup(e,r)}return}findObjectByName(e,t){if(t===0){for(const i of this.objects.values())if(i.name===e)return i;return}const r=this.objects.get(t);return r!==void 0&&r.type==="otGROUP2D"?this.findObjectInGroup(e,r):void 0}getObjectFromPoint(e,t){const r=this.renderer.handleAtPoint(e,t);if(!r)return;let i=this.objects.get(r);if(!i)return;for(;i.parent;)i=i.parent;return i}isIntersect(e,t){const r=this.objects.get(e);if(r===void 0)return 0;const i=this.objects.get(t);if(i===void 0)return 0;const a=r.positionX,n=a+r.width,s=r.positionY,o=s+r.height,c=i.positionX,l=c+i.width,h=i.positionY,u=h+i.height;return n>=c&&l>=a&&o>=h&&u>=s?1:0}}class Ou{constructor({handle:e,wname:t,attribute:r,vdr:i,host:a,disableResize:n}){this.classname="";this.filename="";this.prevWidth=0;this.prevHeight=0;this.closeSubs=new Set;this.sizeSubs=new Set;this.originX=0;this.originY=0;var l;if(this.ignoreSetSize=n!=null?n:!1,this.resizible=!((l=i==null?void 0:i.otDATAITEMS)==null?void 0:l.some(h=>h.id===11)),i==null?void 0:i.source){const{name:h,origin:u}=i.source;u==="class"?this.classname=h:u==="file"&&(this.filename=h)}const s=this.view=document.createElement("div");s.style.setProperty("position","relative"),s.style.setProperty("overflow","hidden"),s.style.setProperty("width","100%"),s.style.setProperty("height","100%");const o=document.createElement("canvas");o.style.setProperty("top","0px"),o.style.setProperty("left","0px"),o.style.setProperty("position","absolute"),o.style.setProperty("touch-action","pinch-zoom");const c=this.rnd=new mo(o,this,e);s.appendChild(o),this.wnd=a.window({title:r.toUpperCase().includes("WS_NOCAPTION")?void 0:t,view:s}),this.prevWidth=this.width,this.prevWidth=this.height,this.scene=new xo({vdr:i,renderer:c})}textInput(e){return new uu(this.view,e)}onClose(e){this.closeSubs.add(e)}offClose(e){this.closeSubs.delete(e)}dispatchClose(){for(const e of this.closeSubs)e.receive(ae.WM_SPACEDONE)}onResize(e){this.sizeSubs.add(e)}offResize(e){this.sizeSubs.delete(e)}onMouse(e,t,r){this.rnd.onMouse(e,t,r)}offMouse(e,t){this.rnd.offMouse(e,t)}redraw(){const{view:e,rnd:t}=this,r=e.clientWidth,i=e.clientHeight;let a=!1;if(r!==this.prevWidth&&(this.prevWidth=r,t.setWidth(r),a=!0),i!==this.prevHeight&&(this.prevHeight=i,t.setHeight(i),a=!0),a){t.calcOffset();for(const n of this.sizeSubs)n.receive(ae.WM_SIZE,r,i)}this.rnd.redraw()}close(){this.wnd.close()}getProp(e){const t=e.toUpperCase();return t==="CLASSNAME"?this.classname:t==="FILENAME"?this.filename:""}get width(){const e=this.view.clientWidth;return e>0?e:window.innerWidth}get height(){const e=this.view.clientHeight;return e>0?e:window.innerHeight}setSize(e,t){if(this.ignoreSetSize===!0)return 1;if(this.wnd.setSize(e,t),this.resizible===!0)return 1;const{view:{style:r}}=this;return r.setProperty("width",e+"px"),r.setProperty("height",t+"px"),1}toTop(){return this.wnd.toTop(),1}setAttrib(e){return 1}setOrigin(e,t){return this.originX=e,this.originY=t,1}}const Si=new Uint8Array(256);class To{constructor(e){this.host=e;this.hspaceToWname=new Map;this.wnameToHspace=new Map;this.scenes=new Map;this.windows=new Map;this.computer=new Cu.SmoothExecutor}getAsyncKeyState(e){return Si[e]>0?1:0}getWindowName(e){const t=this.hspaceToWname.get(e);return typeof t!="undefined"?t:""}getSpaceOrg2dx(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.originX:0}getSpaceOrg2dy(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.originY:0}setSpaceOrg2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.setOrigin(t,r):0}getScaleSpace2d(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.scale:0}setScaleSpace2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.setScale(t):0}getObjectOrg2dx(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.positionX:0}getObjectOrg2dy(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.positionY:0}setObjectOrg2d(e,t,r,i){const a=this.getObject(e,t);return typeof a!="undefined"?a.setPosition(r,i):0}rotateObject2d(e,t,r,i,a){const n=this.getObject(e,t);return typeof n!="undefined"?n.rotate(r,i,a):0}getActualWidth2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.width:0}getActualHeight2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.height:0}getActualSize2d(e,t,r,i,a,n){const s=this.getObject(e,t);return typeof s=="undefined"?0:(r[i]=s.width,a[n]=s.height,1)}getObjectWidth2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.width:0}getObjectHeight2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.height:0}setObjectSize2d(e,t,r,i){const a=this.getObject(e,t);return typeof a!="undefined"?a.setSize(r,i):0}getZOrder2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.zOrder:0}setZOrder2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.setZorder(r):0}setObjectName2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.setName(r):0}setShowObject2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.setVisibility(r):0}objectToTop2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.moveObjectToTop(t):0}deleteObject2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.deleteObject(t):0}createGroup2d(e,...t){const r=this.scenes.get(e);return typeof r!="undefined"?r.createGroup(t):0}getGroupItem2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.getGroupItem2d(t,r):0}delGroupItem2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.delGroupItem2d(t,r):0}getObject2dByName(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.getObject2dByName(t,r):0}getObjectParent2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.getObjectParent2d(t):0}deleteGroup2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.deleteGroup2d(t):0}getObjectFromPoint2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.getObjectFromPoint2d(t,r):0}isObjectsIntersect2d(e,t,r,i){const a=this.scenes.get(e);return typeof a!="undefined"?a.isIntersect(t,r):0}createPolyLine2d(e,t,r,...i){const a=this.scenes.get(e);return typeof a!="undefined"?a.createLine(t,r,i):0}createLine2d(e,t,r,i,a){const n=this.scenes.get(e);return typeof n!="undefined"?n.createLine(t,r,[i,a]):0}addPoint2d(e,t,r,i,a){const n=this.getObject(e,t);return typeof n!="undefined"&&n.type==="otLINE2D"?n.addPoint(r,i,a):0}getVectorPoint2dx(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"&&i.type==="otLINE2D"?i.pointX(r):0}getVectorPoint2dy(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"&&i.type==="otLINE2D"?i.pointY(r):0}setVectorPoint2d(e,t,r,i,a){const n=this.getObject(e,t);return typeof n!="undefined"&&n.type==="otLINE2D"?n.setPointXY(r,i,a):0}getPenObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"&&r.type==="otLINE2D"?r.hpen:0}getBrushObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"&&r.type==="otLINE2D"?r.hbrush:0}createRasterText2D(e,t,r,i,a){const n=this.scenes.get(e);return typeof n!="undefined"?n.createText(t,r,i,a):0}getTextObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"&&r.type==="otTEXT2D"?r.textTool.handle:0}getControlText2d(e,t,r,i){const a=this.getObject(e,t);return typeof a=="undefined"||a.type!=="otCONTROL2D"?"":typeof r=="undefined"||typeof i=="undefined"?a.text:a.text.slice(r,r+i)}setControlText2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"&&i.type==="otCONTROL2D"?i.setText(r):0}createBitmap2d(e,t,r,i){const a=this.scenes.get(e);return typeof a!="undefined"?a.createBitmap(r,i,t,!1):0}createDoubleBitmap2D(e,t,r,i){const a=this.scenes.get(e);return typeof a!="undefined"?a.createBitmap(r,i,t,!0):0}setBitmapSrcRect2d(e,t,r,i,a,n){const s=this.getObject(e,t);return typeof s!="undefined"&&(s.type==="otBITMAP2D"||s.type==="otDOUBLEBITMAP2D")?s.setRect(r,i,a,n):0}createPen2d(e,t,r,i,a){const n=this.scenes.get(e);return typeof n!="undefined"?n.tools.createPen(t,r,i,a):0}getPenStyle2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.style2:0}setPenStyle2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setStyle(r):0}getPenWidth2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.width:0}setPenWidth2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setWidth(r):0}getPenColor2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.color:0}setPenColor2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setColor(r):0}getPenRop2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.rop:0}setPenRop2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setRop(r):0}createBrush2d(e,t,r,i,a,n){const s=this.scenes.get(e);return typeof s!="undefined"?s.tools.createBrush(t,r,i,a,n):0}getBrushStyle2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.style:0}setBrushStyle2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setStyle(r):0}getBrushHatch2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.hatch:0}setBrushHatch2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setHatch(r):0}getBrushColor2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.color:0}setBrushColor2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setColor(r):0}getBrushRop2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.rop:0}setBrushRop2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setRop(r):0}createText2D(e,t,r,i,a){const n=this.scenes.get(e);return typeof n!="undefined"?n.tools.createText(t,r,i,a):0}getTextCount2d(e,t){const r=this.getTText(e,t);return typeof r!="undefined"?r.textCount:0}getTextFont2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.getFontHandle(r):0}getTextString2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.getStringHandle(r):0}getTextFgColor2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.getFgColor(r):0}getTextBkColor2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.getBgColor(r):0}setText2D(e,t,r,i,a,n,s){const o=this.getTText(e,t);if(typeof o=="undefined")return 0;const c=typeof s!="undefined"?r:0,l=typeof s!="undefined"?i:r,h=typeof s!="undefined"?a:i,u=typeof s!="undefined"?n:a,f=typeof s!="undefined"?s:n;return o.updateVals2(c,this.getTFont(e,l),this.getTString(e,h),u,f)}createString2D(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.createString(t):0}getstring2d(e,t){const r=this.getTString(e,t);return typeof r!="undefined"?r.text:""}setString2d(e,t,r){const i=this.getTString(e,t);return typeof i!="undefined"?i.setText(r):0}createFont2D(e,t,r,i){const a=this.scenes.get(e);return typeof a!="undefined"?a.tools.createFont(t,r,i):0}isWindowExist(e){const t=this.windows.get(e);return typeof t!="undefined"?1:0}getWindowSpace(e){const t=this.wnameToHspace.get(e);return typeof t!="undefined"?t:0}getWindowProp(e,t){const r=this.windows.get(e);return typeof r!="undefined"?r.getProp(t):""}getWindowOrgX(e){const t=this.windows.get(e);return typeof t!="undefined"?t.originX:0}getWindowOrgY(e){const t=this.windows.get(e);return typeof t!="undefined"?t.originY:0}setWindowOrg(e,t,r){const i=this.windows.get(e);return typeof i!="undefined"?i.setOrigin(t,r):0}getWindowWidth(e){const t=this.windows.get(e);return typeof t!="undefined"?t.width:0}getWindowHeight(e){const t=this.windows.get(e);return typeof t!="undefined"?t.height:0}getClientWidth(e){const t=this.windows.get(e);return typeof t!="undefined"?t.width:0}getClientHeight(e){const t=this.windows.get(e);return typeof t!="undefined"?t.height:0}setClientSize(e,t,r){const i=this.windows.get(e);return typeof i!="undefined"?i.setSize(t,r):0}bringWindowToTop(e){const t=this.windows.get(e);return typeof t!="undefined"?t.toTop():0}showWindow(e,t){const r=this.windows.get(e);return typeof r!="undefined"?r.setAttrib(t):0}closeWindow(e){const t=this.windows.get(e);if(typeof t=="undefined")return 0;t.close(),this.windows.delete(e);const r=this.wnameToHspace.get(e);return typeof r!="undefined"&&(this.wnameToHspace.delete(e),this.hspaceToWname.delete(r),this.scenes.delete(r)),1}setWindowTransparent(){return 1}setWindowTransparentColor(){return 1}setWindowOwner(){return 1}getScreenWidth(){return screen.width}getScreenHeight(){return screen.height}getWorkAreaX(){return 0}getWorkAreaY(){return 0}getWorkAreaWidth(){return this.host.width}getWorkAreaHeight(){return this.host.height}subscribe(e,t,r,i){const a=typeof t=="string"?t:this.hspaceToWname.get(t);if(!a)return;const n=this.windows.get(a);if(typeof n=="undefined")return;switch(i){case ae.WM_CONTROLNOTIFY:{const s=n.scene.objects.get(r);if(typeof s=="undefined"||s.type!=="otCONTROL2D")return;s.renderable.onChange(e);break}case ae.WM_SIZE:n.onResize(e);break;case ae.WM_SPACEDONE:n.onClose(e);break;case ae.WM_MOUSEMOVE:case ae.WM_LBUTTONDOWN:case ae.WM_LBUTTONUP:case ae.WM_LBUTTONDBLCLK:case ae.WM_RBUTTONDOWN:case ae.WM_RBUTTONUP:case ae.WM_RBUTTONDBLCLK:case ae.WM_MBUTTONDOWN:case ae.WM_MBUTTONUP:case ae.WM_MBUTTONDBLCLK:case ae.WM_ALLMOUSEMESSAGE:{n.onMouse(e,i,r);break}default:break}}unsubscribe(e,t,r){const i=typeof t=="string"?t:this.hspaceToWname.get(t);if(!i)return;const a=this.windows.get(i);if(typeof a=="undefined")return;switch(r){case ae.WM_SIZE:a.offResize(e);break;case ae.WM_SPACEDONE:a.offClose(e);break;case ae.WM_MOUSEMOVE:case ae.WM_LBUTTONDOWN:case ae.WM_LBUTTONUP:case ae.WM_LBUTTONDBLCLK:case ae.WM_RBUTTONDOWN:case ae.WM_RBUTTONUP:case ae.WM_RBUTTONDBLCLK:case ae.WM_MBUTTONDOWN:case ae.WM_MBUTTONUP:case ae.WM_MBUTTONDBLCLK:case ae.WM_ALLMOUSEMESSAGE:{a.offMouse(e,r);break}default:break}}openWindow(e,t,r,i){const a=this.wnameToHspace.get(e);if(typeof a!="undefined")return a;const n=ye.getFreeHandle(this.scenes),s=new Ou({handle:n,wname:e,attribute:t,host:this.host,vdr:r,disableResize:i==null?void 0:i.options.disableWindowResize});return s.wnd.on("closed",()=>{this.closeWindow(e),s.dispatchClose()}),this.hspaceToWname.set(n,e),this.wnameToHspace.set(e,n),this.scenes.set(n,s.scene),this.windows.set(e,s),this.computer.run(()=>this.redrawAll()),n}insertVDR(e,t,r,i,a){const n=this.scenes.get(e);return typeof n!="undefined"?n.insertVectorDrawing(t,r,i,a):0}createBitmap(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.createBitmap(t):0}createDoubleBitmap(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.createDoubleBitmap(t):0}closeAllWindows(e){this.windows.forEach(t=>t.close()),this.hspaceToWname.clear(),this.wnameToHspace.clear(),this.scenes.clear(),this.windows.clear()}getObject(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objects.get(t):void 0}getTPen(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.pens.get(t):void 0}getTBrush(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.brushes.get(t):void 0}getTText(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.texts.get(t):void 0}getTString(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.strings.get(t):void 0}getTFont(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.tools.fonts.get(t):void 0}redrawAll(){const e=this.windows;return e.forEach(t=>t.redraw()),e.size>0}}function On(e,t){switch(e){case he.String:return t;case he.Float:return parseFloat(t)||0;case he.Handle:return(t.startsWith("#")?parseInt(t.substring(1,t.length)):parseInt(t))||0;case he.ColorRef:return vu(t)}}function qg(e,t){const r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${e.proto.name}: ${i}`);for(const{handle1:i,handle2:a,connectedVars:n}of t){const s=i===0?e:e.child(i),o=a===0?e:e.child(a);if(s?s.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),o?o.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${a} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${a} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),!s||!s.proto.vars||!o||!o.proto.vars)continue;const c=s.proto.vars,l=o.proto.vars,h=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${s.proto.name} #${i}`,u=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${o.proto.name} #${a}`;for(const{name1:f,name2:d}of n){const b=c.nameUCToId.get(f.toUpperCase()),g=l.nameUCToId.get(d.toUpperCase());if(b===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${f} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${h}`),g===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${d} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${u}`),b===void 0||g===void 0)continue;if(!s.connectVar(b,o,g)){const y=he[s.proto.vars.types[b]],S=he[o.proto.vars.types[g]];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${f} (${y}) \u0432 ${h} \u0438 ${d} (${S}) \u0432 ${u}`)}}}}function Oo(e,t,r,i){const a=t.get(e);if(!a)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${e}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const n=new xt(a,r,i);if(a.children){const s=a.children.map(o=>Oo(o.classname,t,r,le({parent:n},o.schemeInfo)));n.setChildren(s)}return a.links&&qg(n,a.links),n}class Co{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,t){if(e.type!==t.type)return!1;if(e.indexWasSet||t.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(t),t.connectedNodes.add(e),!0}shareIndex(e){if(this.indexWasSet)return;this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(t=>t.shareIndex(e))}getIndex(e){if(!this.indexWasSet)switch(this.type){case he.Float:this.shareIndex(e.floatsCount++);break;case he.Handle:case he.ColorRef:this.shareIndex(e.intsCount++);break;case he.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}}class xt{constructor(e,t,r){this.handle=0;this.name="";this.position={x:0,y:0};this.parent=this;this.varGraphNodes=[];this.isDisabled=xt.alwaysEnabled;this.disOrEnVarId=-1;this.children=[];this.captureEventsFromSpace=0;this.idTypes=[];this.cachedNames=[];this.classNodeCache=new Map;var i;this.model=(i=e.model)!=null?i:xt.NoModel,this.proto=e,this.env=t,r&&(this.handle=r.handle,this.name=r.name,this.position=r.position,this.parent=r.parent);{const a=this.vars=e.vars;this.varGraphNodes=a.types.map(o=>new Co(o)),this.TLB=new Uint16Array(a.count);const n=this.proto._enableVarId,s=this.proto._disableVarId;n>0&&(s<0||n<s)&&(this.isDisabled=xt.disabledByEnable,this.disOrEnVarId=n),s>0&&(n<0||s<n)&&(this.isDisabled=xt.disabledByDisable,this.disOrEnVarId=s)}{let a=this;for(;a.parent!==a;)a=a.parent;this.root=a,this.neighMapUC=new Map([["",this],["\\",a]]),r&&this.neighMapUC.set("..",r.parent)}}static build(e,t,r){return Oo(e,t,r)}getHObject(){return this.handle}getClassName(e){const t=this.resolve(e);return typeof t=="undefined"?"":t.proto.name}setVar(e,t,r){const i=this.resolve(e);if(typeof i=="undefined")return;const{vars:a}=i.proto;if(typeof a=="undefined")return;const n=a.nameUCToId.get(t.toUpperCase());typeof n!="undefined"&&i.setVarValue2(n,a.types[n],r)}sendMessage(e,t,...r){const{env:i,vars:a,TLB:n,cachedNames:s}=this;if(i.level>58)return;if(e!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 SendMessage \u0441 objectName=${e} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);if(r.length%2!==0)throw Error("SendMessage: \u043A\u043E\u043B-\u0432\u043E \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0447\u0435\u0442\u043D\u044B\u043C");const o=t.toUpperCase(),c=this.findClasses(o);if(c.length===0)return;const l=c[0],h=l.vars,u=l.model;if(a.count===0||h.count===0){for(const y of c){if(y===this)continue;i.inc(),u(y,i),i.dec()}return}let f=r.length===s.length;if(f===!0){for(let y=0;y<r.length;y++)if(r[y]!==s[y]){f=!1;break}}if(f===!1){this.cachedNames=r;const y=this.idTypes=new Array(r.length+r.length/2);let S=0;for(let B=0;B<r.length;B+=2){const W=r[B].toUpperCase(),X=a.nameUCToId.get(W);if(typeof X=="undefined")continue;const P=r[B+1].toUpperCase(),J=h.nameUCToId.get(P);if(typeof J=="undefined")continue;const V=a.types[X],Y=h.types[J];if(V!==Y)continue;y[S+0]=X,y[S+1]=J,y[S+2]=V,S+=3}}const{idTypes:d}=this,{news:b,olds:g}=i;for(const y of c){if(y===this)continue;for(let S=0;S<d.length;S+=3){const B=d[S+2];if(typeof B=="undefined")continue;const W=n[d[S+0]],X=y.TLB[d[S+1]],P=b[B],J=g[B],V=P[W];P[X]=V,J[X]=V}i.inc(),u(y,i),i.dec();for(let S=0;S<d.length;S+=3){const B=d[S+2];if(typeof B=="undefined")continue;const W=n[d[S+0]],X=y.TLB[d[S+1]],P=b[B],J=g[B],V=P[X];P[W]=V,J[W]=V}}}setCapture(e,t,r){if(t!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 setCapture \u0441 path=${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const i=this;if(typeof i=="undefined"||i.proto.msgVarId<0)return;i.captureEventsFromSpace=e}releaseCapture(){this.captureEventsFromSpace=0}registerObject(e,t,r,i,a){if(r!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 RegisterObject \u0441 path=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const n=this;if(typeof n=="undefined"||n.proto.msgVarId<0)return;this.env.graphics.subscribe(n,e,t,i)}unregisterObject(e,t,r){if(t!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 UnRegisterObject \u0441 path=${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const i=this;if(typeof i=="undefined"||i.proto.msgVarId<0)return;this.env.graphics.unsubscribe(i,e,r)}receive(e,...t){const{proto:r}=this;if(r.msgVarId<0)return;this.setVarValue2(r.msgVarId,he.Float,e);switch(e){case ae.WM_CONTROLNOTIFY:this.setVarValue2(r._hobjectVarId,he.Handle,t[0]),this.setVarValue2(r.iditemVarId,he.Float,t[1]),this.setVarValue2(r.wnotifycodeVarId,he.Float,t[2]);break;case ae.WM_SIZE:this.setVarValue2(r.nwidthVarId,he.Float,t[0]),this.setVarValue2(r.nheightVarId,he.Float,t[1]);break;case ae.WM_MOUSEMOVE:case ae.WM_LBUTTONDOWN:case ae.WM_LBUTTONUP:case ae.WM_LBUTTONDBLCLK:case ae.WM_RBUTTONDOWN:case ae.WM_RBUTTONUP:case ae.WM_RBUTTONDBLCLK:case ae.WM_MBUTTONDOWN:case ae.WM_MBUTTONUP:case ae.WM_MBUTTONDBLCLK:this.setVarValue2(r.xposVarId,he.Float,t[0]),this.setVarValue2(r.yposVarId,he.Float,t[1]),this.setVarValue2(r.fwkeysVarId,he.Float,t[2]);break}const{env:i,TLB:a,model:n}=this;n(this,i);const{newFloats:s,oldFloats:o,newInts:c,oldInts:l,newStrings:h,oldStrings:u}=i;for(const f of a)o[f]=s[f],l[f]=c[f],u[f]=h[f]}setChildren(e){if(this.children.length>0)throw Error("\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return(this.children=e).forEach(t=>{t.name&&this.neighMapUC.set(t.name.toUpperCase(),t)}),this}child(e){return this.children.find(t=>t.handle===e)}connectVar(e,t,r){return Co.connect(this.varGraphNodes[e],t.varGraphNodes[r])}createTLB(){const e={floatsCount:1,intsCount:1,stringsCount:1};return function t({children:r,TLB:i,varGraphNodes:a}){r.forEach(t),i.set(a.map(n=>n.getIndex(e)))}(this),e}applyDefaults(){this.children.forEach(t=>t.applyDefaults());const{vars:e}=this.proto;if(!e)return this;for(let t=0;t<e.count;++t){const r=e.types[t],i=e.defaultValues[t];if(typeof i!="undefined"){this.setNewVarValue(t,r,i);continue}switch(t){case this.proto.orgxVarId:this.setNewVarValue(t,r,this.position.x);break;case this.proto.orgyVarId:this.setNewVarValue(t,r,this.position.y);break;case this.proto._hobjectVarId:this.setNewVarValue(t,r,this.handle);break;case this.proto._objnameVarId:this.setNewVarValue(t,r,this.name);break;case this.proto._classnameVarId:this.setNewVarValue(t,r,this.proto.name);break}}return this}applyVarSet(e){const{name:t,vars:r}=this.proto;if(r&&t.toUpperCase()===e.classname.toUpperCase())for(const i of e.values){const a=r.nameUCToId.get(i.name.toUpperCase());if(typeof a=="undefined")continue;const n=r.types[a];this.setNewVarValue(a,n,On(n,i.value))}return e.childSets.forEach(i=>{var a;return(a=this.child(i.handle))==null?void 0:a.applyVarSet(i)}),this}compute(){if(this.isDisabled(this)===!0)return;for(const e of this.children)e.compute();this.model(this,this.env)}resolve(e){if(e==="")return this;const t=e.split("\\");let r=e[0]==="\\"?this.root:this;for(let i=0;i<t.length;++i){const a=r.neighMapUC.get(t[i]);if(typeof a=="undefined")return;r=a}return r}setNewVarValue(e,t,r){if(e<0)return;this.env.news[t][this.TLB[e]]=r}setVarValue2(e,t,r){if(e<0)return;const i=this.TLB[e];this.env.olds[t][i]=r,this.env.news[t][i]=r}findClasses(e){const{root:t}=this,r=t.classNodeCache.get(e);if(typeof r!="undefined")return r;const i=new Array;return function a(n){n.children.forEach(a),n.proto.name.toUpperCase()===e&&i.push(n)}(t),t.classNodeCache.set(e,i),i}static alwaysEnabled(){return!1}static disabledByEnable({env:e,disOrEnVarId:t,TLB:r}){return e.newFloats[r[t]]<=0}static disabledByDisable({env:e,disOrEnVarId:t,TLB:r}){return e.newFloats[r[t]]>0}static NoModel(){}}class Zg{constructor(e,t){this.view=e;this.origTitle=document.title,t&&(document.title=this.origTitle?`${this.origTitle} - ${t}`:t)}setTitle(e){document.title=e}setSize(e,t){const{view:{clientWidth:r,clientHeight:i,style:a}}=this;r!==e&&a.setProperty("width",e+"px"),i!==t&&a.setProperty("height",t+"px")}close(){this.view.remove(),document.title=this.origTitle}on(){}off(){}toTop(){}}class Kg{constructor(e,t){this.wnd=e;this.handlers=new Set;this.sizedOnce=!1;t&&(e.document.title=t)}on(e,t){if(e!=="closed")return;this.wnd.addEventListener("beforeunload",t),this.handlers.add(t)}off(e,t){if(e!=="closed")return;t?(this.wnd.removeEventListener("beforeunload",t),this.handlers.delete(t)):(this.handlers.forEach(r=>this.wnd.removeEventListener("beforeunload",r)),this.handlers.clear())}setTitle(e){this.wnd.document.title=e}setSize(e,t){if(this.sizedOnce===!0)return;const{wnd:r}=this;r.addEventListener("resize",()=>r.resizeTo(e+r.outerWidth-r.innerWidth+15,t+r.outerHeight-r.innerHeight+15),{once:!0}),this.sizedOnce=!0}toTop(){}close(){this.off("closed"),this.wnd.close()}}class jo{constructor(e){this.root=e}get width(){return window.innerWidth}get height(){return window.innerHeight}window({title:e,view:t}){if(this.root)return this.root.appendChild(t),new Zg(t,e);const r=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!r)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${e}`);return r.document.body.appendChild(t),new Kg(r,e)}}class ko{constructor({dir:e,prjInfo:t,classes:r,stt:i,options:a}){this.shouldClose=!1;this._state="closed";this._diag={iterations:0,missingCommands:[]};this._computer=new ju.SmoothExecutor;this.handlers={closed:new Set,error:new Set};this.graphics=new To(new jo);this.dir=e,this.prjInfo=t,this.classes=r,this.stt=i,this.options=le({},a)}get state(){return this._state}get diag(){return this._diag}get computer(){return this._computer}set computer(e){if(e===this._computer)return;this._computer.running&&(this._computer.stop(),this.loop&&e.run(this.loop)),this._computer=e}play(e){if(this.loop)return this;e&&(this.graphics.host=e instanceof HTMLElement?new jo(e):e),_i.clear();const t=new to({graphics:this.graphics,project:this}),r=xt.build(this.prjInfo.rootClassName,this.classes,t);return _i.size>0&&console.log(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438:
${[..._i.values()].join(`
`)}`),t.init(r.createTLB()),r.applyDefaults(),this.stt&&r.applyVarSet(this.stt),this._diag.iterations=0,this.shouldClose=!1,this.loop=()=>{t.sync().assertZeroIndexEmpty();try{r.compute()}catch(i){return console.error(i),this._state="error",this.handlers.error.forEach(a=>a(i.message)),!1}return++this._diag.iterations,this.shouldClose===!0?(this.close(),this.handlers.closed.forEach(i=>i()),!1):!0},this.computer.run(this.loop),this._state="playing",this}close(){return this.computer.stop(),this.loop=void 0,this.graphics.closeAllWindows(),this._state="closed",this}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,t){return this.handlers[e].add(t),this}off(e,t){return t?this.handlers[e].delete(t):this.handlers[e].clear(),this}closeAll(){this.shouldClose=!0}openSchemeWindow(e,t,r){const i=this.classes.getComposedScheme(t);return this.graphics.openWindow(e,r,i,this)}loadSpaceWindow(e,t,r){const i=this.dir.get(t),a=i&&!i.dir?i.readSyncAs("vdr"):void 0;return this.graphics.openWindow(e,r,a,this)}createObjectFromFile2D(e,t,r,i,a){const n=this.dir.get(t),s=n&&!n.dir&&n.readSyncAs("vdr");return s?this.graphics.insertVDR(e,r,i,a,s):0}createDIB2d(e,t){const r=this.dir.get(t),i=r&&!r.dir&&r.readSyncAs("bmp");return i?this.graphics.createBitmap(e,i):0}createDoubleDib2D(e,t){const r=this.dir.get(t),i=r&&!r.dir&&r.readSyncAs("dbm");return i?this.graphics.createDoubleBitmap(e,i):0}getClassDirectory(e){const t=this.classes.get(e);return t!==void 0?t.directoryDos:""}fileExist(e){const t=this.dir.get(e);return t!==void 0?1:0}}class Wt{constructor(){this.disks=new Map}static fromZip(r){return ct(this,arguments,function*(e,t={}){const i=new TextDecoder(t.encoding||"cp866");let a;try{a=yield ku.loadAsync(e,{decodeFileName:l=>i.decode(l),createFolders:!1})}catch(l){const h=e instanceof File?`\u0424\u0430\u0439\u043B ${e.name}`:e instanceof Blob?`Blob { size: ${e.size}, type: ${e.type} }`:`${e.toString()}(${e.byteLength})`;throw Error(`${h} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F ZIP-\u0430\u0440\u0445\u0438\u0432\u043E\u043C`)}const n=new Wt,[s,o]=nu(t.directory||"",Wt.defaultPrefix);let c=new Ut(s,n);n.disks.set(s,c);for(const l of o)c=c.createLocalDir(l);return a.forEach((l,h)=>{const u=l.split(Qa);let f=c;for(let d=0;d<u.length-1;d++)f=f.createLocalDir(u[d]);h.dir||f.createLocalFile(u[u.length-1],h)}),n})}disk(e){return this.disks.get(e.toUpperCase())}merge(e){if(!(e instanceof Wt))throw Error("fs is not instanceof VFS");const{disks:t}=e,{disks:r}=this;for(const[i,a]of t)r.set(i,(r.get(i)||new Ut(i,this)).merge(a));return this}*files(e){for(const t of this.disks.values())for(const r of t.files(e))yield r}project(){return ct(this,arguments,function*(e={}){var n;let t,r;{let s;const o=new Array,c=e.path&&Ar(e.path).join("\\").toUpperCase();for(const l of this.files(/.+\.(prj|spj)$/i)){if(c&&!l.pathDos.toUpperCase().includes(c))continue;s=l,o.push(l.pathDos)}if(o.length>1)throw Error(`\u041D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432:
${o.join(`
`)}`);if(!s)throw Error("\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432");t=s.parent,console.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${s.pathDos}`),r=yield s.readAs("prj")}let i;{const s=new Set([t]),o=(n=r.settings)==null?void 0:n.classSearchPaths;if(o){const d=o.split(",").map(b=>b.trim()).filter(b=>b);for(const b of d){const g=t.get(b);(g==null?void 0:g.dir)&&s.add(g)}}const c=e.additionalClassPaths;if(c)for(const d of c){const b=(this.disks.get(Wt.defaultPrefix)||t).get(d);(b==null?void 0:b.dir)&&s.add(b)}for(let d of s)for(;d!==d.parent;d=d.parent)s.has(d.parent)&&s.delete(d);const l=[...s];console.log(`\u041F\u0443\u0442\u0438 \u043F\u043E\u0438\u0441\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:
${l.map(d=>d.pathDos).join(`;
`)}`);const h=l.map(d=>[...d.files(/.+\.cls$/i)]),u=new Array().concat(...h),f=yield Promise.all(u.map(d=>d.readAs("cls")));console.log(`\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E ${u.length} \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043E\u0431\u044A\u0435\u043C\u043E\u043C ${(f.reduce((d,b)=>d+b.byteSize,0)/1024).toFixed()} \u041A\u0411`),i=new iu(f)}let a;{const s=t.get("_preload.stt");if(s&&!s.dir)try{a=yield s.readAs("stt")}catch(o){console.warn(o.message)}}return new ko({dir:t,prjInfo:r,classes:i,stt:a,options:e})})}}Wt.defaultPrefix="C";const Eo=e=>Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u0430\u0442\u0430\u043B\u043E\u0433 ${e} - \u043F\u043E \u044D\u0442\u043E\u043C\u0443 \u043F\u0443\u0442\u0438 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0444\u0430\u0439\u043B.`);class Ut{constructor(e,t){this.localName=e;this.nodes=new Map;this.dir=!0;t instanceof Ut?(this.fs=t.fs,this.parent=t,this.pathDos=t.pathDos+"\\"+e):(this.fs=t,this.parent=this,eo(e),this.pathDos=this.localName=e+":")}resolve(e){if(e.length===0)return;const t=e[0].length===2&&e[0][1]===":";let r;if(t){const a=this.fs.disk(e[0][0]);if(e.length===1)return a;if(a===void 0)return;r=a}else r=this;for(let a=t?1:0;a<e.length-1;a++)if(e[a]==="..")r=r.parent;else{const n=r.nodes.get(e[a].toUpperCase());if(!(n==null?void 0:n.dir))return;r=n}const i=e[e.length-1];return i===".."?r.parent:r.nodes.get(i.toUpperCase())}get(e){return this.resolve(Ar(e))}create(e,t,r){const i=Ar(t),a=this.resolve(i.slice(0,i.length-1));if(!(a==null?void 0:a.dir))return;const n=i[i.length-1],s=n.toUpperCase(),o=a.nodes.get(s);if(o)return o.dir&&e==="dir"?o:void 0;const c=e==="file"?new Ei(n,a,r):new Ut(n,a);return a.nodes.set(s,c),c}setLocalSafe(e,t){const{nodes:r}=this,i=r.size;if(r.set(e.toUpperCase(),t),r.size===i)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${t.pathDos}`)}createLocalFile(e,t){const r=new Ei(e,this,t);this.setLocalSafe(e,r)}createLocalDir(e){const{nodes:t}=this,r=e.toUpperCase(),i=t.get(r);if(i){if(i.dir)return i;throw Eo(i.pathDos)}const a=new Ut(e,this);return t.set(r,a),a}merge({nodes:e}){const{nodes:t}=this;for(const[r,i]of e){let a=t.get(r);if(a&&!a.dir)throw Eo(a.pathDos);if(i.dir){a||(a=new Ut(i.localName,this),t.set(r,a)),a.merge(i);continue}if(a)throw Eo(a.pathDos);t.set(r,i.hardlink(this))}return this}*_files(){for(const e of this.nodes.values()){if(!e.dir){yield e;continue}for(const t of e._files())yield t}}*files(e){if(!e)return this._files();for(const t of this._files())e.test(t.pathDos)&&(yield t)}}var Te;(function(e){e[e.CR_MATH=1]="CR_MATH",e[e.CR_MATHDATA=2]="CR_MATHDATA",e[e.CR_FLAGS=4]="CR_FLAGS",e[e.CR_VARS=5]="CR_VARS",e[e.CR_CHILDS=6]="CR_CHILDS",e[e.CR_LINKS=7]="CR_LINKS",e[e.CR_ICON=8]="CR_ICON",e[e.CR_SCHEME=9]="CR_SCHEME",e[e.CR_TEXT=10]="CR_TEXT",e[e.CR_VARSIZE=11]="CR_VARSIZE",e[e.CR_IMAGE=12]="CR_IMAGE",e[e.CR_CODE=13]="CR_CODE",e[e.CR_INFO=14]="CR_INFO",e[e.CR_VARS1=15]="CR_VARS1",e[e.CR_CHILDSname=16]="CR_CHILDSname",e[e.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",e[e.CR_DEFICON=20]="CR_DEFICON",e[e.CR_CLASSTIME=21]="CR_CLASSTIME",e[e.CR_ICONFILE=22]="CR_ICONFILE",e[e.CR_HELPFILE=25]="CR_HELPFILE",e[e.CR_EQU=30]="CR_EQU",e[e.CR_MOVEINFO=31]="CR_MOVEINFO",e[e.RR_VERSION=40]="RR_VERSION",e[e.PR_MAINCLASS=100]="PR_MAINCLASS",e[e.PR_PASSWORD=101]="PR_PASSWORD",e[e.PR_VARS=102]="PR_VARS",e[e.PR_WATCH=103]="PR_WATCH",e[e.VR_CLASSES=1e3]="VR_CLASSES",e[e.VR_VARS=1001]="VR_VARS",e[e.VR_SETVAR=1002]="VR_SETVAR",e[e.CR_CLASSINFO=8e3]="CR_CLASSINFO",e[e.PPR_FIELDS=2048]="PPR_FIELDS",e[e.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",e[e.PPR_SCALEMODE=2050]="PPR_SCALEMODE",e[e.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",e[e.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",e[e.PPR_USEADDF=2053]="PPR_USEADDF",e[e.PPR_SRCRECT=2054]="PPR_SRCRECT",e[e.PPR_USESRC=2055]="PPR_USESRC",e[e.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",e[e.CLF_LOADED=1]="CLF_LOADED",e[e.CLF_PROJECT=2]="CLF_PROJECT",e[e.CLF_MODIFY=4]="CLF_MODIFY",e[e.CLF_READONLY=8]="CLF_READONLY",e[e.CLF_NORECURSE=16]="CLF_NORECURSE",e[e.CLF_ADDLIB=32]="CLF_ADDLIB",e[e.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",e[e.CLF_LIBRARY=256]="CLF_LIBRARY",e[e.CLF_PACKFILE=512]="CLF_PACKFILE",e[e.CF_PROTECTED=1]="CF_PROTECTED",e[e.CF_ONEFASE=2]="CF_ONEFASE",e[e.CF_COMPILED=4]="CF_COMPILED",e[e.CF_VIRTUAL=8]="CF_VIRTUAL",e[e.CF_SCHEME=16]="CF_SCHEME",e[e.CF_MODIFY=32]="CF_MODIFY",e[e.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",e[e.CF_BUILDIN=256]="CF_BUILDIN",e[e.CF_ICON=512]="CF_ICON",e[e.CF_PROCEDURE=1024]="CF_PROCEDURE",e[e.CF_STRUCTURE=2048]="CF_STRUCTURE",e[e.CF_USEDEFICON=4096]="CF_USEDEFICON",e[e.CF_SIZEABLE=8192]="CF_SIZEABLE",e[e.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",e[e.TCF_WASSAVE=1]="TCF_WASSAVE",e[e.TCF_NEWCLASS=2]="TCF_NEWCLASS",e[e.OF_DISABLED=1]="OF_DISABLED",e[e.OF_ONEFASE=2]="OF_ONEFASE",e[e.OF_ERROR=4]="OF_ERROR",e[e.LF_DISABLED=1]="LF_DISABLED",e[e.LF_AUTOLINK=2]="LF_AUTOLINK",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_NOREAD=4]="VF_NOREAD",e[e.VF_NOWRITE=8]="VF_NOWRITE",e[e.VF_STATIC=16]="VF_STATIC",e[e.VF_ONSCHEME=32]="VF_ONSCHEME",e[e.VF_PARAMETER=64]="VF_PARAMETER",e[e.VF_LEFT=128]="VF_LEFT",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.VF_NOSAVE=2048]="VF_NOSAVE",e[e.VF_GLOBAL=4096]="VF_GLOBAL",e[e.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",e[e.SF_EXTERNAL=1]="SF_EXTERNAL",e[e.SF_EDITING=2]="SF_EDITING",e[e.STATE_FAST=0]="STATE_FAST",e[e.STATE_VARS=1]="STATE_VARS",e[e.STATE_DEBUG=2]="STATE_DEBUG",e[e.STATE_SET=3]="STATE_SET",e[e.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",e[e.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",e[e.CHF_WASSIZED=4]="CHF_WASSIZED",e[e.CHF_PREPROCESS=8]="CHF_PREPROCESS",e[e.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",e[e.IF_CORRECTED=1]="IF_CORRECTED",e[e.EF_RUNNING=1]="EF_RUNNING",e[e.EF_MUSTSTOP=2]="EF_MUSTSTOP",e[e.EF_STEPACTIVE=4]="EF_STEPACTIVE",e[e.EF_EQUACTIVE=8]="EF_EQUACTIVE",e[e.EF_MSGACTIVE=16]="EF_MSGACTIVE",e[e.EF_BYTIMER=32]="EF_BYTIMER"})(Te||(Te={}));function Eu(e){e.bytes(1)}function Jg(e){Eu(e),e.uint16()}function Qg(e){return e.uint16()}function ev(e){const t=e.uint16(),r=e.uint16(),i=e.bytes(r);return{id:t,size:r,data:i}}function tv(e){return{foregroundColor:e.int32(),backgroundColor:e.int32(),fontHandle:e.uint16(),stringHandle:e.uint16()}}function Gt(e){Jg(e)}function rv(){return Qg}function iv(e){return Eu(e),ev}function nv(){return tv}function Au(e){e.otPRIMARYCOLLECTION=rv,e.otDATAITEMS=iv,e.otOBJECTCOLLECTION=Gt,e.otPENCOLLECTION=Gt,e.otBRUSHCOLLECTION=Gt,e.otDOUBLEDIBCOLLECTION=Gt,e.otFONTCOLLECTION=Gt,e.otSTRINGCOLLECTION=Gt,e.otTEXTCOLLECTION=Gt,e.otDIBCOLLECTION=Gt,e.otLOGTEXTCOLLECTION=nv}var Me;(function(e){e[e.otGROUP=1]="otGROUP",e[e.otCOLLECTION=1e3]="otCOLLECTION",e[e.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",e[e.otPENCOLLECTION=1004]="otPENCOLLECTION",e[e.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",e[e.otDIBCOLLECTION=1006]="otDIBCOLLECTION",e[e.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",e[e.otFONTCOLLECTION=1008]="otFONTCOLLECTION",e[e.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",e[e.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",e[e.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",e[e.ot3DCOLLECTION=1012]="ot3DCOLLECTION",e[e.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",e[e.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",e[e.otDATAITEMS=1022]="otDATAITEMS",e[e.otMATERIALS3D=1024]="otMATERIALS3D",e[e.otSPACE2D=17458]="otSPACE2D",e[e.otSPACE3D=17459]="otSPACE3D",e[e.otSPACE3Df=25668]="otSPACE3Df",e[e.otGROUP2D=3]="otGROUP2D",e[e.otRGROUP2D=4]="otRGROUP2D",e[e.otGROUP3D=5]="otGROUP3D",e[e.otOBJECT3D=10]="otOBJECT3D",e[e.otCAMERA3D=11]="otCAMERA3D",e[e.otLIGHT3D=12]="otLIGHT3D",e[e.otLINE2D=20]="otLINE2D",e[e.otBITMAP2D=21]="otBITMAP2D",e[e.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",e[e.otTEXT2D=23]="otTEXT2D",e[e.otVIEW3D2D=24]="otVIEW3D2D",e[e.otUSEROBJECT2D=25]="otUSEROBJECT2D",e[e.otCONTROL2D=26]="otCONTROL2D",e[e.otEDITFRAME2D=50]="otEDITFRAME2D",e[e.otROTATECENTER2D=51]="otROTATECENTER2D",e[e.otFRAME3D=52]="otFRAME3D",e[e.otAXIS3D=53]="otAXIS3D",e[e.ttPEN2D=101]="ttPEN2D",e[e.ttBRUSH2D=102]="ttBRUSH2D",e[e.ttDIB2D=103]="ttDIB2D",e[e.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",e[e.ttFONT2D=105]="ttFONT2D",e[e.ttSTRING2D=106]="ttSTRING2D",e[e.ttTEXT2D=107]="ttTEXT2D",e[e.ttREFTODIB2D=110]="ttREFTODIB2D",e[e.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",e[e.ctINFONAME=200]="ctINFONAME",e[e.ctINFOAUTOR=201]="ctINFOAUTOR",e[e.ctINFOINFO=202]="ctINFOINFO",e[e.ctCRDSYSTEM=203]="ctCRDSYSTEM",e[e.stSPACEDATA=204]="stSPACEDATA",e[e.stOBJNAME=205]="stOBJNAME"})(Me||(Me={}));function Iu(e){return{handle:e.uint16(),options:e.uint16(),name:e.meta.fileversion>=258&&e.meta.fileversion<768?e.string():""}}function Ai(e){return le(le({},Iu(e)),{position:e.meta.fileversion<512?e.point2dInt():e.point2d(),size:e.meta.fileversion<512?e.point2dInt():e.point2d()})}function Du(e){return le(le({},Iu(e)),{childHandles:Je(e,!0,Me.otPRIMARYCOLLECTION).data})}function av(e){return Du(e)}function ov(e){let t=le(le({},Ai(e)),{penHandle:e.uint16(),brushHandle:e.uint16()});const r=e.uint16();t.points=new Array(r);for(let a=0;a<r;a++)t.points[a]=e.meta.fileversion<512?e.point2dInt():e.point2d();if(e.meta.fileversion<=512)return t;const i=e.bytes(1)[0];return i&&(t.arrows=e.bytes(i)),t}function Ru(e){return le(le({},Ai(e)),{bmpOrigin:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpSize:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpAngle:e.int16(),bmpHandle:e.uint16()})}function sv(e){return le(le({},Ai(e)),{textToolHandle:e.uint16(),delta:e.meta.fileversion<512?e.point2dInt():e.point2d(),angle:e.int16()})}function lv(e){const t=le(le({},Ai(e)),{classname:e.string(),text:e.string(),dwStyle:e.int32(),exStyle:e.int32(),id:e.uint16(),controlSize:e.point2dInt()});if(!["Edit","Button","ComboBox"].includes(t.classname))throw new Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u0430: ${t.classname}`);return e.uint16(),t}function cv(e){return Ai(e)}function Bu(e){e.otGROUP=Du,e.otGROUP2D=av,e.otLINE2D=ov,e.otBITMAP2D=Ru,e.otDOUBLEBITMAP2D=Ru,e.otTEXT2D=sv,e.otCONTROL2D=lv,e.otSPACE2D=cv}function Ht(e){return{refCount:e.uint16(),handle:e.uint16()}}function hv(e){return le(le({},Ht(e)),{color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()})}function uv(e){return le(le({},Ht(e)),{color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()})}function fv(e){return le(le({},Ht(e)),wn(e))}function dv(e){return le(le({},Ht(e)),Nr(e))}function pv(e){const t=Ht(e),r=e.position,i=le(le({},t),{height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),fontName:e.nulltString(32)});return e.seek(r+50),e.meta.fileversion>=515?(i.size=e.int32(),i.style=e.int32()):(i.size=22,i.style=0),i}function mv(e){return le(le({},Ht(e)),{text:e.string()})}function bv(e){return le(le({},Ht(e)),{textCollection:Je(e,!0,Me.otLOGTEXTCOLLECTION).data})}function Nu(e){return le(le({},Ht(e)),{filename:e.string()})}function gv(e){return Nu(e)}function Lu(e){e.ttPEN2D=hv,e.ttBRUSH2D=uv,e.ttDIB2D=fv,e.ttDOUBLEDIB2D=dv,e.ttFONT2D=pv,e.ttSTRING2D=mv,e.ttTEXT2D=bv,e.ttREFTODIB2D=Nu,e.ttREFTODOUBLEDIB2D=gv}const Ao={},Cn={};(function(){Au(Ao),Bu(Cn),Lu(Cn)})();class Wr{constructor(e){if(this.stream=e,this.start=e.position,this.code=e.int16(),e.meta.fileversion>=768&&(this.size=e.int32()),this.size<0)throw Error("chunk size < 0")}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.stream.position-this.start}readNextSubChunk(){return this.start+this.size<=this.stream.position?0:new Wr(this.stream)}goEnd(){this.stream.seek(this.start+this.size)}checkReaded(){const e=this.readedBytes();if(e>this.size)throw Error(`Chunk data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk not readed: ${e} instead of ${this.size}`)}}function Je(e,t,r){const i=new Wr(e);if(i.code===-1)return;if(i.code===0)throw Error("Chunk not an object or collection");if(r!==void 0&&r!==i.code)throw Error(`Chunk code is ${i.code} instead of ${r}`);if(i.code===203){const o=e.uint16(),c=e.int16(),l=e.point2d(),h=Array.from({length:9},()=>e.float64());i.checkReaded();const u={type:o,objectHandle:c,center:l,matrix:h};return{type:"crdSystem",data:u}}const a=i.code>999&&i.code<1200;if(t&&!a)throw Error("not a collection: "+i.code);const n=Object.keys(Me).find(o=>Me[o]===i.code);if(n===void 0)throw Error(`Unknown ${a?"collection":"object"}: ${i.code}`);const s=(a?Fu:vv)(e,n);if(e.meta.fileversion<768)return Array.isArray(s)?{type:n,data:s}:le({type:n},s);for(;i.hasData();){const o=new Wr(e);switch(o.code){case Me.otDATAITEMS:Fu(e,"otDATAITEMS");break;case Me.stOBJNAME:s.name=e.fixedString(o.size-o.readedBytes());break;default:throw Error("Unknown postchunk: "+o.code)}}return i.checkReaded(),Array.isArray(s)?{type:n,data:s}:le({type:n},s)}function Fu(e,t){const r=e.uint16();e.uint16(),e.uint16();const i=Ao[t];if(!i)throw Error("No get item function for "+t);const a=i(e)||Je,n=new Array(r);for(let s=0;s<r;s++)n[s]=a(e);return n}function vv(e,t){const r=Cn[t];if(!r)throw Error("No item function for "+t);return r(e)}function yv(e,t){const r=new Wr(e);if(r.code!==Me.stSPACEDATA)throw"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x";for(t.origin=e.point2d(),t.scale_div=e.point2d(),t.scale_mul=e.point2d(),t.state=e.uint16(),t.brushHandle=e.uint16(),t.layers=e.uint32(),t.defaultFlags=e.uint16();r.hasData();){const{type:i,data:a}=Je(e,!0);t[i]=a}r.checkReaded()}function wv(e,t,r){const i=e.int32()+r,a=e.int32()+r,n=()=>e.meta.fileversion<512?e.point2dInt():e.point2d();t.origin=n(),t.scale_div=n(),t.scale_mul=n(),e.string(),t.state=e.uint16(),e.string(),e.string(),e.string(),Je(e,!1),Je(e,!1),t.brushHandle=e.uint16(),e.seek(i),t.otPRIMARYCOLLECTION=Je(e,!0,Me.otPRIMARYCOLLECTION).data,t.otOBJECTCOLLECTION=Je(e,!0,Me.otOBJECTCOLLECTION).data,e.seek(a);const s=e.uint16();for(let o=0;o<s;o++){const{type:c,data:l}=Je(e,!0);t[c]=l}if(e.meta.fileversion>258){t.layers=e.uint32(),t.defaultFlags=e.uint16();let o=e.uint16();for(;o;){switch(o){case 0:break;default:return}o=e.uint16()}}else t.layers=0,t.defaultFlags=0;e.string()}function _v(e){const t=e.uint16();if(t!==17458)throw new bt(e,t,17458);const r=e.position,i={fileversion:e.uint16(),minVersion:e.uint16()};return e.meta.fileversion=i.fileversion,i.fileversion>=768?yv(e,i):wv(e,i,r),i}const Sv={otBRUSHCOLLECTION:"brushTools",otPENCOLLECTION:"penTools",otDIBCOLLECTION:"bitmapTools",otDOUBLEDIBCOLLECTION:"doubleBitmapTools",otSTRINGCOLLECTION:"stringTools",otFONTCOLLECTION:"fontTools",otTEXTCOLLECTION:"textTools",otOBJECTCOLLECTION:"elements",otPRIMARYCOLLECTION:"elementOrder"};function xv(e){for(const t of Object.keys(e)){const r=Sv[t];if(!r)continue;const i=e[t];delete e[t],e[r]=i}return e}function jn(e){return xv(_v(e))}function Tv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const a=e.string(),n=e.string(),s=e.string(),o=e.string().toUpperCase();if(o!=="STRING"&&o!=="FLOAT"&&o!=="INTEGER"&&o!=="HANDLE"&&o!=="COLORREF")throw new Mt(e,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${o}.`);const c=e.int32();r[i]={name:a,description:n,defaultValue:s,type:o,flags:c}}return r}function Ov(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const a=e.uint16(),n=e.uint16(),s=e.uint16(),o=e.int32(),c=e.uint16(),l=e.uint16(),h=new Array(c);for(let u=0;u<c;u++){const f=e.string(),d=e.string();h[u]={name1:f,name2:d}}r[i]={handle1:a,handle2:n,linkHandle:s,flags:o,connectedVars:h,contactPadHandle:l}}return r}function Cv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const a=e.string(),n=e.uint16(),s=e.string();if(!e.meta.fileversion)throw Error("filversion?");const o=e.meta.fileversion<12290?e.point2dInt():e.point2d(),c=e.byte();r[i]={classname:a,schemeInfo:{handle:n,name:s,position:o},flags:c}}return r}function Pu(e,t,r){var o;const i=e.int32();if(i&Te.SF_EXTERNAL){const c=e.string();console.warn(`${r} ${t} (${e.meta.filepathDos||"?"}): \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${c}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);return}const a=e.bytes(e.int32()),n=new Pt(a);let s;try{s=jn(n)}catch(c){console.warn(`${r} ${t} (${e.meta.filepathDos||"?"}): \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${c.message}`);return}if(s.source={origin:"class",name:t},n.position!==n.size){const c=n.position,l=n.size-c,h=((o=n.meta.fileversion)==null?void 0:o.toString(16))||"?",u=`${r} ${t} (${e.meta.filepathDos||"?"}): \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${c} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${l}. v0x${h}.`;console.warn(u)}return s}function Mu(e){const t=e.uint16();if(t!==16979)throw new bt(e,t,16979);const r=e.int32();e.int32(),e.int32();const i=e.string();return{name:i,version:r}}function zu(e,t,r){const i={};let a=e.uint16();if(a===Te.CR_VARS1&&(i.vars=Tv(e),a=e.uint16()),a===Te.CR_LINKS&&(i.links=Ov(e),a=e.uint16()),(a===Te.CR_CHILDSnameXY||a===Te.CR_CHILDSname||a===Te.CR_CHILDS)&&(i.children=Cv(e),a=e.uint16()),a===Te.CR_ICON){const n=e.int32();e.skip(n-4),a=e.uint16()}if(a===Te.CR_SCHEME){const n=e.int32();r.readScheme?i.scheme=Pu(e,t,"\u0421\u0445\u0435\u043C\u0430"):e.skip(n-4),a=e.uint16()}if(a===Te.CR_IMAGE){const n=e.int32();r.readImage?i.image=Pu(e,t,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"):e.skip(n-4),a=e.uint16()}if(a===Te.CR_TEXT&&(i.sourceCode=e.string(),a=e.uint16()),a===Te.CR_INFO&&(i.description=e.string(),a=e.uint16()),a===Te.CR_VARSIZE&&(i.varsize=e.uint16(),a=e.uint16()),a===Te.CR_FLAGS&&(i.flags=e.int32(),a=e.uint16()),a===Te.CR_DEFICON&&(i.iconIndex=e.uint16(),a=e.uint16()),a===Te.CR_ICONFILE&&(i.iconFile=e.string(),a=e.uint16()),a===Te.CR_CODE){const n=e.int32()*2;if(r.parseBytecode!==void 0){const s=e.bytes(n);try{i.code=r.parseBytecode(s)}catch(o){console.warn(`\u0411\u0430\u0439\u0442\u043A\u043E\u0434 ${t} (${e.meta.filepathDos||"?"}): \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${o.message}`)}}else e.skip(n);a=e.uint16()}return a===Te.CR_EQU?(console.warn(`${t} (${e.meta.filepathDos||"?"}):
\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F.`),i):(a!==Te.CR_CLASSTIME&&e.meta.fileversion===12291&&console.warn(`${t} (${e.meta.filepathDos||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),i)}class kn{constructor(e){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;this.compiled=!1;const t=this.filepathDos=e.meta.filepathDos||"";this.directoryDos=t.substring(0,t.lastIndexOf("\\")+1),this.byteSize=e.size;const r=Mu(e);this.name=r.name,e.meta.fileversion=r.version,this.__body={loaded:!1,stream:e}}get children(){return this.body.children}get links(){return this.body.links}get image(){return this.body.image}get iconFile(){return this.body.iconFile}get scheme(){return this.body.scheme}get vars(){if(typeof this._vars!="undefined")return this._vars;const e=this.body.vars;if(!e)return this._vars={count:0,nameUCToId:new Map,defaultValues:[],types:[]};const t=e.map(i=>i.name.toUpperCase()),r=e.map(i=>{switch(i.type){case"FLOAT":case"INTEGER":return he.Float;case"HANDLE":return he.Handle;case"STRING":return he.String;case"COLORREF":return he.ColorRef}});for(let i=0;i<e.length;i++){const a=t[i],n=r[i];a==="_ENABLE"&&n===he.Float?this._enableVarId=i:a==="_DISABLE"&&n===he.Float?this._disableVarId=i:a==="MSG"&&n===he.Float?this.msgVarId=i:a==="_HOBJECT"&&n===he.Handle?this._hobjectVarId=i:a==="IDITEM"&&n===he.Float?this.iditemVarId=i:a==="WNOTIFYCODE"&&n===he.Float?this.wnotifycodeVarId=i:a==="NWIDTH"&&n===he.Float?this.nwidthVarId=i:a==="NHEIGHT"&&n===he.Float?this.nheightVarId=i:a==="XPOS"&&n===he.Float?this.xposVarId=i:a==="YPOS"&&n===he.Float?this.yposVarId=i:a==="FWKEYS"&&n===he.Float?this.fwkeysVarId=i:a==="ORGX"&&n===he.Float?this.orgxVarId=i:a==="ORGY"&&n===he.Float?this.orgyVarId=i:a==="_OBJNAME"&&n===he.String?this._objnameVarId=i:a==="_CLASSNAME"&&n===he.String&&(this._classnameVarId=i)}return this._vars={count:e.length,nameUCToId:new Map(t.map((i,a)=>[i,a])),types:r,defaultValues:e.map((i,a)=>i.defaultValue!==""?On(r[a],i.defaultValue):void 0)}}get model(){if(this.compiled===!0)return this._model;const{sourceCode:e}=this.body;if(e===void 0){this.compiled=!0;return}return this._model=lo(e,this.vars,this.name),this.compiled=!0,this._model}get body(){const{__body:e}=this;if(e.loaded)return e.data;console.log(`\u0427\u0438\u0442\u0430\u0435\u043C ${this.name} (${e.stream.meta.filepathDos})`);const t=zu(e.stream,this.name,kn.blocks);return this.__body={loaded:!0,data:t},t}}kn.blocks={readScheme:!0,readImage:!0};const jv={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone"};function kv(e){const t={},r=e.uint16();for(let i=0;i<r;i++){const a=e.uint16(),n=e.byte(),s=e.byte(),o=e.fixedString(s-1);e.byte();let c;switch(n){case 0:c=e.int32();break;case 1:c=e.float64();break;case 2:c=e.fixedString(a-s-3),e.byte();break;default:throw new Mt(e,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${n}`)}const l=jv[o];l?t[l]=c:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${o} (${c})`)}return t}function Ev(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const a=Array.from({length:e.uint16()},()=>e.uint16()),n=e.string(),s=e.string();r[i]={path:a,name:n,info:s}}return r}function Uu(e){const t=e.uint16();if(t!==26697)throw new bt(e,t,26697);const r={rootClassName:""};let i=0;for(;(i=e.uint16())!==0;)switch(i){case Te.PR_PASSWORD:e.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case Te.PR_MAINCLASS:r.rootClassName=e.string();break;case Te.PR_VARS:r.settings=kv(e);break;case Te.PR_WATCH:r.watchedVariables=Ev(e);break}if(!r.rootClassName)throw new Mt(e,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}function Wu(e){const t=e.int32(),r=e.uint16(),i=e.string(),a=e.int32(),n=Array.from({length:e.uint16()},()=>({name:e.string(),value:e.string()})),s=[];for(;e.position<t;)s.push(Wu(e));return{handle:r,classname:i,classId:a,values:n,childSets:s}}function Gu(e){const t=e.uint16();if(t!==19)throw new bt(e,t,19);e.seek(21),e.string(),e.uint16(),e.uint16();switch(e.uint16()){case Te.VR_CLASSES:throw new Mt(e,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case Te.VR_SETVAR:return Wu(e)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}class Ei{constructor(e,t,r){this.localName=e;this.dir=!1;this.startLoading=!1;this.warnShowed=!1;this.buf=r||new ArrayBuffer(0),this.parent=t,this.pathDos=t.pathDos+"\\"+e}hardlink(e,t){return new Ei(t||this.localName,e,this.buf)}arraybuffer(){return ct(this,null,function*(){return this.buf instanceof ArrayBuffer||(this.buf=yield this.buf.async("arraybuffer")),this.buf})}makeSync(){return ct(this,null,function*(){yield this.arraybuffer()})}read(e,t){if(this.cache)return this.cache;const r=new Pt(e,{filepathDos:this.pathDos});switch(t){case"prj":return this.cache=Uu(r);case"cls":return this.cache=new kn(r);case"stt":return this.cache=Gu(r);case"vdr":{const i=this.cache=jn(r);if(i.source={origin:"file",name:this.pathDos},r.position!==r.size){const a=`${this.pathDos}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${r.position} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${r.size-r.position}. v0x${r.meta.fileversion&&r.meta.fileversion.toString(16)}.`;console.warn(a)}return i}case"bmp":return this.cache=wn(r);case"dbm":return this.cache=Nr(r)}}readAs(e){return ct(this,null,function*(){const t=yield this.arraybuffer();return this.read(t,e)})}readSyncAs(e){const{buf:t}=this;if(!(t instanceof ArrayBuffer)){if(this.startLoading)return;this.startLoading=!0,t.async("arraybuffer").then(r=>this.buf=r),console.warn(`${this.pathDos} \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044F \u0430\u0441\u0438\u043D\u0445\u0440\u043E\u043D\u043D\u043E.`);return}try{return this.read(t,e)}catch(r){this.warnShowed||(console.warn(`${this.pathDos}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${r.message}`),this.warnShowed=!0);return}}}function Hu(e,t){return Wt.fromZip(e,t)}return xi();})();
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
