require=function(){function v(D,u,p){function f(b,t){if(!u[b]){if(!D[b]){var i=typeof require=="function"&&require;if(!t&&i)return i(b,!0);if(m)return m(b,!0);var n=new Error("Cannot find module '"+b+"'");throw n.code="MODULE_NOT_FOUND",n}var o=u[b]={exports:{}};D[b][0].call(o.exports,function(w){var g=D[b][1][w];return f(g||w)},o,o.exports,v,D,u,p)}return u[b].exports}for(var m=typeof require=="function"&&require,h=0;h<p.length;h++)f(p[h]);return f}return v}()({1:[function(v,D,u){D.exports=function(f,m,h){if(f.filter)return f.filter(m,h);if(f==null)throw new TypeError;if(typeof m!="function")throw new TypeError;for(var b=[],t=0;t<f.length;t++){if(!p.call(f,t))continue;var i=f[t];m.call(h,i,t,f)&&b.push(i)}return b};var p=Object.prototype.hasOwnProperty},{}],2:[function(v,D,u){(function(p){(function(){"use strict";var f=v("object-assign");/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function m(B,k){if(B===k)return 0;for(var F=B.length,$=k.length,oe=0,Ee=Math.min(F,$);oe<Ee;++oe)if(B[oe]!==k[oe]){F=B[oe],$=k[oe];break}return F<$?-1:$<F?1:0}function h(B){return p.Buffer&&typeof p.Buffer.isBuffer=="function"?p.Buffer.isBuffer(B):!!(B!=null&&B._isBuffer)}var b=v("util/"),t=Object.prototype.hasOwnProperty,i=Array.prototype.slice,n=function(){return function(){}.name==="foo"}();function o(B){return Object.prototype.toString.call(B)}function w(B){return h(B)||typeof p.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(B):B?B instanceof DataView?!0:!!(B.buffer&&B.buffer instanceof ArrayBuffer):!1}var g=D.exports=T,l=/\s*function\s+([^\(\s]*)\s*/;function e(B){if(!b.isFunction(B))return;if(n)return B.name;var k=B.toString(),F=k.match(l);return F&&F[1]}g.AssertionError=function(k){this.name="AssertionError",this.actual=k.actual,this.expected=k.expected,this.operator=k.operator,k.message?(this.message=k.message,this.generatedMessage=!1):(this.message=A(this),this.generatedMessage=!0);var F=k.stackStartFunction||E;if(Error.captureStackTrace)Error.captureStackTrace(this,F);else{var $=new Error;if($.stack){var oe=$.stack,Ee=e(F),he=oe.indexOf(`
`+Ee);if(he>=0){var W=oe.indexOf(`
`,he+1);oe=oe.substring(W+1)}this.stack=oe}}},b.inherits(g.AssertionError,Error);function d(B,k){return typeof B=="string"?B.length<k?B:B.slice(0,k):B}function y(B){if(n||!b.isFunction(B))return b.inspect(B);var k=e(B),F=k?": "+k:"";return"[Function"+F+"]"}function A(B){return d(y(B.actual),128)+" "+B.operator+" "+d(y(B.expected),128)}function E(B,k,F,$,oe){throw new g.AssertionError({message:F,actual:B,expected:k,operator:$,stackStartFunction:oe})}g.fail=E;function T(B,k){B||E(B,!0,k,"==",g.ok)}g.ok=T,g.equal=function(k,F,$){k!=F&&E(k,F,$,"==",g.equal)},g.notEqual=function(k,F,$){k==F&&E(k,F,$,"!=",g.notEqual)},g.deepEqual=function(k,F,$){_(k,F,!1)||E(k,F,$,"deepEqual",g.deepEqual)},g.deepStrictEqual=function(k,F,$){_(k,F,!0)||E(k,F,$,"deepStrictEqual",g.deepStrictEqual)};function _(B,k,F,$){if(B===k)return!0;if(h(B)&&h(k))return m(B,k)===0;if(b.isDate(B)&&b.isDate(k))return B.getTime()===k.getTime();if(b.isRegExp(B)&&b.isRegExp(k))return B.source===k.source&&B.global===k.global&&B.multiline===k.multiline&&B.lastIndex===k.lastIndex&&B.ignoreCase===k.ignoreCase;if((B===null||typeof B!="object")&&(k===null||typeof k!="object"))return F?B===k:B==k;if(w(B)&&w(k)&&o(B)===o(k)&&!(B instanceof Float32Array||B instanceof Float64Array))return m(new Uint8Array(B.buffer),new Uint8Array(k.buffer))===0;if(h(B)!==h(k))return!1;$=$||{actual:[],expected:[]};var oe=$.actual.indexOf(B);return oe!==-1&&oe===$.expected.indexOf(k)?!0:($.actual.push(B),$.expected.push(k),N(B,k,F,$))}function S(B){return Object.prototype.toString.call(B)=="[object Arguments]"}function N(B,k,F,$){if(B==null||k===null||k===void 0)return!1;if(b.isPrimitive(B)||b.isPrimitive(k))return B===k;if(F&&Object.getPrototypeOf(B)!==Object.getPrototypeOf(k))return!1;var oe=S(B),Ee=S(k);if(oe&&!Ee||!oe&&Ee)return!1;if(oe)return B=i.call(B),k=i.call(k),_(B,k,F);var he=se(B),W=se(k),V,Q;if(he.length!==W.length)return!1;for(he.sort(),W.sort(),Q=he.length-1;Q>=0;Q--)if(he[Q]!==W[Q])return!1;for(Q=he.length-1;Q>=0;Q--)if(V=he[Q],!_(B[V],k[V],F,$))return!1;return!0}g.notDeepEqual=function(k,F,$){_(k,F,!1)&&E(k,F,$,"notDeepEqual",g.notDeepEqual)},g.notDeepStrictEqual=L;function L(B,k,F){_(B,k,!0)&&E(B,k,F,"notDeepStrictEqual",L)}g.strictEqual=function(k,F,$){k!==F&&E(k,F,$,"===",g.strictEqual)},g.notStrictEqual=function(k,F,$){k===F&&E(k,F,$,"!==",g.notStrictEqual)};function H(B,k){if(!B||!k)return!1;if(Object.prototype.toString.call(k)=="[object RegExp]")return k.test(B);try{if(B instanceof k)return!0}catch(F){}return Error.isPrototypeOf(k)?!1:k.call({},B)===!0}function P(B){var k;try{B()}catch(F){k=F}return k}function K(B,k,F,$){var oe;if(typeof k!="function")throw new TypeError('"block" argument must be a function');typeof F=="string"&&($=F,F=null),oe=P(k),$=(F&&F.name?" ("+F.name+").":".")+($?" "+$:"."),B&&!oe&&E(oe,F,"Missing expected exception"+$);var Ee=typeof $=="string",he=!B&&b.isError(oe),W=!B&&oe&&!F;if((he&&Ee&&H(oe,F)||W)&&E(oe,F,"Got unwanted exception"+$),B&&oe&&F&&!H(oe,F)||!B&&oe)throw oe}g.throws=function(B,k,F){K(!0,B,k,F)},g.doesNotThrow=function(B,k,F){K(!1,B,k,F)},g.ifError=function(B){if(B)throw B};function te(B,k){B||E(B,!0,k,"==",te)}g.strict=f(te,g,{equal:g.strictEqual,deepEqual:g.deepStrictEqual,notEqual:g.notStrictEqual,notDeepEqual:g.notDeepStrictEqual}),g.strict.strict=g.strict;var se=Object.keys||function(B){var k=[];for(var F in B)t.call(B,F)&&k.push(F);return k}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"object-assign":27,"util/":5}],3:[function(v,D,u){typeof Object.create=="function"?D.exports=function(f,m){f.super_=m,f.prototype=Object.create(m.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}})}:D.exports=function(f,m){f.super_=m;var h=function(){};h.prototype=m.prototype,f.prototype=new h,f.prototype.constructor=f}},{}],4:[function(v,D,u){D.exports=function(f){return f&&typeof f=="object"&&typeof f.copy=="function"&&typeof f.fill=="function"&&typeof f.readUInt8=="function"}},{}],5:[function(v,D,u){(function(p,f){(function(){var m=/%[sdj%]/g;u.format=function(W){if(!N(W)){for(var V=[],Q=0;Q<arguments.length;Q++)V.push(t(arguments[Q]));return V.join(" ")}for(var Q=1,be=arguments,Z=be.length,Y=String(W).replace(m,function(ue){if(ue==="%%")return"%";if(Q>=Z)return ue;switch(ue){case"%s":return String(be[Q++]);case"%d":return Number(be[Q++]);case"%j":try{return JSON.stringify(be[Q++])}catch(ce){return"[Circular]"}default:return ue}}),q=be[Q];Q<Z;q=be[++Q])T(q)||!K(q)?Y+=" "+q:Y+=" "+t(q);return Y},u.deprecate=function(W,V){if(H(f.process))return function(){return u.deprecate(W,V).apply(this,arguments)};if(p.noDeprecation===!0)return W;var Q=!1;function be(){if(!Q){if(p.throwDeprecation)throw new Error(V);p.traceDeprecation?console.trace(V):console.error(V),Q=!0}return W.apply(this,arguments)}return be};var h={},b;u.debuglog=function(W){if(H(b)&&(b=p.env.NODE_DEBUG||""),W=W.toUpperCase(),!h[W])if(new RegExp("\\b"+W+"\\b","i").test(b)){var V=p.pid;h[W]=function(){var Q=u.format.apply(u,arguments);console.error("%s %d: %s",W,V,Q)}}else h[W]=function(){};return h[W]};function t(W,V){var Q={seen:[],stylize:n};return arguments.length>=3&&(Q.depth=arguments[2]),arguments.length>=4&&(Q.colors=arguments[3]),E(V)?Q.showHidden=V:V&&u._extend(Q,V),H(Q.showHidden)&&(Q.showHidden=!1),H(Q.depth)&&(Q.depth=2),H(Q.colors)&&(Q.colors=!1),H(Q.customInspect)&&(Q.customInspect=!0),Q.colors&&(Q.stylize=i),w(Q,W,Q.depth)}u.inspect=t,t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},t.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function i(W,V){var Q=t.styles[V];return Q?"["+t.colors[Q][0]+"m"+W+"["+t.colors[Q][1]+"m":W}function n(W,V){return W}function o(W){var V={};return W.forEach(function(Q,be){V[Q]=!0}),V}function w(W,V,Q){if(W.customInspect&&V&&B(V.inspect)&&V.inspect!==u.inspect&&!(V.constructor&&V.constructor.prototype===V)){var be=V.inspect(Q,W);return N(be)||(be=w(W,be,Q)),be}var Z=g(W,V);if(Z)return Z;var Y=Object.keys(V),q=o(Y);if(W.showHidden&&(Y=Object.getOwnPropertyNames(V)),se(V)&&(Y.indexOf("message")>=0||Y.indexOf("description")>=0))return l(V);if(Y.length===0){if(B(V)){var ue=V.name?": "+V.name:"";return W.stylize("[Function"+ue+"]","special")}if(P(V))return W.stylize(RegExp.prototype.toString.call(V),"regexp");if(te(V))return W.stylize(Date.prototype.toString.call(V),"date");if(se(V))return l(V)}var ce="",ye=!1,me=["{","}"];if(A(V)&&(ye=!0,me=["[","]"]),B(V)){var M=V.name?": "+V.name:"";ce=" [Function"+M+"]"}if(P(V)&&(ce=" "+RegExp.prototype.toString.call(V)),te(V)&&(ce=" "+Date.prototype.toUTCString.call(V)),se(V)&&(ce=" "+l(V)),Y.length===0&&(!ye||V.length==0))return me[0]+ce+me[1];if(Q<0)return P(V)?W.stylize(RegExp.prototype.toString.call(V),"regexp"):W.stylize("[Object]","special");W.seen.push(V);var j;return ye?j=e(W,V,Q,q,Y):j=Y.map(function(ie){return d(W,V,Q,q,ie,ye)}),W.seen.pop(),y(j,ce,me)}function g(W,V){if(H(V))return W.stylize("undefined","undefined");if(N(V)){var Q="'"+JSON.stringify(V).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return W.stylize(Q,"string")}if(S(V))return W.stylize(""+V,"number");if(E(V))return W.stylize(""+V,"boolean");if(T(V))return W.stylize("null","null")}function l(W){return"["+Error.prototype.toString.call(W)+"]"}function e(W,V,Q,be,Z){for(var Y=[],q=0,ue=V.length;q<ue;++q)he(V,String(q))?Y.push(d(W,V,Q,be,String(q),!0)):Y.push("");return Z.forEach(function(ce){ce.match(/^\d+$/)||Y.push(d(W,V,Q,be,ce,!0))}),Y}function d(W,V,Q,be,Z,Y){var q,ue,ce;if(ce=Object.getOwnPropertyDescriptor(V,Z)||{value:V[Z]},ce.get?ce.set?ue=W.stylize("[Getter/Setter]","special"):ue=W.stylize("[Getter]","special"):ce.set&&(ue=W.stylize("[Setter]","special")),he(be,Z)||(q="["+Z+"]"),ue||(W.seen.indexOf(ce.value)<0?(T(Q)?ue=w(W,ce.value,null):ue=w(W,ce.value,Q-1),ue.indexOf(`
`)>-1&&(Y?ue=ue.split(`
`).map(function(ye){return"  "+ye}).join(`
`).substr(2):ue=`
`+ue.split(`
`).map(function(ye){return"   "+ye}).join(`
`))):ue=W.stylize("[Circular]","special")),H(q)){if(Y&&Z.match(/^\d+$/))return ue;q=JSON.stringify(""+Z),q.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(q=q.substr(1,q.length-2),q=W.stylize(q,"name")):(q=q.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),q=W.stylize(q,"string"))}return q+": "+ue}function y(W,V,Q){var be=0,Z=W.reduce(function(Y,q){return be++,q.indexOf(`
`)>=0&&be++,Y+q.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Z>60?Q[0]+(V===""?"":V+`
 `)+" "+W.join(`,
  `)+" "+Q[1]:Q[0]+V+" "+W.join(", ")+" "+Q[1]}function A(W){return Array.isArray(W)}u.isArray=A;function E(W){return typeof W=="boolean"}u.isBoolean=E;function T(W){return W===null}u.isNull=T;function _(W){return W==null}u.isNullOrUndefined=_;function S(W){return typeof W=="number"}u.isNumber=S;function N(W){return typeof W=="string"}u.isString=N;function L(W){return typeof W=="symbol"}u.isSymbol=L;function H(W){return W===void 0}u.isUndefined=H;function P(W){return K(W)&&F(W)==="[object RegExp]"}u.isRegExp=P;function K(W){return typeof W=="object"&&W!==null}u.isObject=K;function te(W){return K(W)&&F(W)==="[object Date]"}u.isDate=te;function se(W){return K(W)&&(F(W)==="[object Error]"||W instanceof Error)}u.isError=se;function B(W){return typeof W=="function"}u.isFunction=B;function k(W){return W===null||typeof W=="boolean"||typeof W=="number"||typeof W=="string"||typeof W=="symbol"||typeof W=="undefined"}u.isPrimitive=k,u.isBuffer=v("./support/isBuffer");function F(W){return Object.prototype.toString.call(W)}function $(W){return W<10?"0"+W.toString(10):W.toString(10)}var oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ee(){var W=new Date,V=[$(W.getHours()),$(W.getMinutes()),$(W.getSeconds())].join(":");return[W.getDate(),oe[W.getMonth()],V].join(" ")}u.log=function(){console.log("%s - %s",Ee(),u.format.apply(u,arguments))},u.inherits=v("inherits"),u._extend=function(W,V){if(!V||!K(V))return W;for(var Q=Object.keys(V),be=Q.length;be--;)W[Q[be]]=V[Q[be]];return W};function he(W,V){return Object.prototype.hasOwnProperty.call(W,V)}}).call(this)}).call(this,v("_process"),typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./support/isBuffer":4,_process:39,inherits:3}],6:[function(v,D,u){(function(p){(function(){"use strict";var f=v("array-filter");D.exports=function(){return f(["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],function(h){return typeof p[h]=="function"})}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"array-filter":1}],7:[function(v,D,u){"use strict";u.byteLength=n,u.toByteArray=w,u.fromByteArray=e;for(var p=[],f=[],m=typeof Uint8Array!="undefined"?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=0,t=h.length;b<t;++b)p[b]=h[b],f[h.charCodeAt(b)]=b;f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63;function i(d){var y=d.length;if(y%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var A=d.indexOf("=");A===-1&&(A=y);var E=A===y?0:4-A%4;return[A,E]}function n(d){var y=i(d),A=y[0],E=y[1];return(A+E)*3/4-E}function o(d,y,A){return(y+A)*3/4-A}function w(d){var y,A=i(d),E=A[0],T=A[1],_=new m(o(d,E,T)),S=0,N=T>0?E-4:E,L;for(L=0;L<N;L+=4)y=f[d.charCodeAt(L)]<<18|f[d.charCodeAt(L+1)]<<12|f[d.charCodeAt(L+2)]<<6|f[d.charCodeAt(L+3)],_[S++]=y>>16&255,_[S++]=y>>8&255,_[S++]=y&255;return T===2&&(y=f[d.charCodeAt(L)]<<2|f[d.charCodeAt(L+1)]>>4,_[S++]=y&255),T===1&&(y=f[d.charCodeAt(L)]<<10|f[d.charCodeAt(L+1)]<<4|f[d.charCodeAt(L+2)]>>2,_[S++]=y>>8&255,_[S++]=y&255),_}function g(d){return p[d>>18&63]+p[d>>12&63]+p[d>>6&63]+p[d&63]}function l(d,y,A){for(var E,T=[],_=y;_<A;_+=3)E=(d[_]<<16&16711680)+(d[_+1]<<8&65280)+(d[_+2]&255),T.push(g(E));return T.join("")}function e(d){for(var y,A=d.length,E=A%3,T=[],_=16383,S=0,N=A-E;S<N;S+=_)T.push(l(d,S,S+_>N?N:S+_));return E===1?(y=d[A-1],T.push(p[y>>2]+p[y<<4&63]+"==")):E===2&&(y=(d[A-2]<<8)+d[A-1],T.push(p[y>>10]+p[y>>4&63]+p[y<<2&63]+"=")),T.join("")}},{}],8:[function(v,D,u){},{}],9:[function(v,D,u){(function(p,f){(function(){"use strict";var m=v("assert"),h=v("pako/lib/zlib/zstream"),b=v("pako/lib/zlib/deflate.js"),t=v("pako/lib/zlib/inflate.js"),i=v("pako/lib/zlib/constants");for(var n in i)u[n]=i[n];u.NONE=0,u.DEFLATE=1,u.INFLATE=2,u.GZIP=3,u.GUNZIP=4,u.DEFLATERAW=5,u.INFLATERAW=6,u.UNZIP=7;var o=31,w=139;function g(l){if(typeof l!="number"||l<u.DEFLATE||l>u.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=l,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}g.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,m(this.init_done,"close before init"),m(this.mode<=u.UNZIP),this.mode===u.DEFLATE||this.mode===u.GZIP||this.mode===u.DEFLATERAW?b.deflateEnd(this.strm):(this.mode===u.INFLATE||this.mode===u.GUNZIP||this.mode===u.INFLATERAW||this.mode===u.UNZIP)&&t.inflateEnd(this.strm),this.mode=u.NONE,this.dictionary=null},g.prototype.write=function(l,e,d,y,A,E,T){return this._write(!0,l,e,d,y,A,E,T)},g.prototype.writeSync=function(l,e,d,y,A,E,T){return this._write(!1,l,e,d,y,A,E,T)},g.prototype._write=function(l,e,d,y,A,E,T,_){if(m.equal(arguments.length,8),m(this.init_done,"write before init"),m(this.mode!==u.NONE,"already finalized"),m.equal(!1,this.write_in_progress,"write already in progress"),m.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,m.equal(!1,e===void 0,"must provide flush value"),this.write_in_progress=!0,e!==u.Z_NO_FLUSH&&e!==u.Z_PARTIAL_FLUSH&&e!==u.Z_SYNC_FLUSH&&e!==u.Z_FULL_FLUSH&&e!==u.Z_FINISH&&e!==u.Z_BLOCK)throw new Error("Invalid flush value");if(d==null&&(d=f.alloc(0),A=0,y=0),this.strm.avail_in=A,this.strm.input=d,this.strm.next_in=y,this.strm.avail_out=_,this.strm.output=E,this.strm.next_out=T,this.flush=e,!l)return this._process(),this._checkError()?this._afterSync():void 0;var S=this;return p.nextTick(function(){S._process(),S._after()}),this},g.prototype._afterSync=function(){var l=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,l]},g.prototype._process=function(){var l=null;switch(this.mode){case u.DEFLATE:case u.GZIP:case u.DEFLATERAW:this.err=b.deflate(this.strm,this.flush);break;case u.UNZIP:this.strm.avail_in>0&&(l=this.strm.next_in);switch(this.gzip_id_bytes_read){case 0:if(l===null)break;if(this.strm.input[l]===o){if(this.gzip_id_bytes_read=1,l++,this.strm.avail_in===1)break}else{this.mode=u.INFLATE;break}case 1:if(l===null)break;this.strm.input[l]===w?(this.gzip_id_bytes_read=2,this.mode=u.GUNZIP):this.mode=u.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case u.INFLATE:case u.GUNZIP:case u.INFLATERAW:for(this.err=t.inflate(this.strm,this.flush),this.err===u.Z_NEED_DICT&&this.dictionary&&(this.err=t.inflateSetDictionary(this.strm,this.dictionary),this.err===u.Z_OK?this.err=t.inflate(this.strm,this.flush):this.err===u.Z_DATA_ERROR&&(this.err=u.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===u.GUNZIP&&this.err===u.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=t.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},g.prototype._checkError=function(){switch(this.err){case u.Z_OK:case u.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===u.Z_FINISH)return this._error("unexpected end of file"),!1;break;case u.Z_STREAM_END:break;case u.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},g.prototype._after=function(){if(!this._checkError())return;var l=this.strm.avail_out,e=this.strm.avail_in;this.write_in_progress=!1,this.callback(e,l),this.pending_close&&this.close()},g.prototype._error=function(l){this.strm.msg&&(l=this.strm.msg),this.onerror(l,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},g.prototype.init=function(l,e,d,y,A){m(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),m(l>=8&&l<=15,"invalid windowBits"),m(e>=-1&&e<=9,"invalid compression level"),m(d>=1&&d<=9,"invalid memlevel"),m(y===u.Z_FILTERED||y===u.Z_HUFFMAN_ONLY||y===u.Z_RLE||y===u.Z_FIXED||y===u.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(e,l,d,y,A),this._setDictionary()},g.prototype.params=function(){throw new Error("deflateParams Not supported")},g.prototype.reset=function(){this._reset(),this._setDictionary()},g.prototype._init=function(l,e,d,y,A){this.level=l,this.windowBits=e,this.memLevel=d,this.strategy=y,this.flush=u.Z_NO_FLUSH,this.err=u.Z_OK,(this.mode===u.GZIP||this.mode===u.GUNZIP)&&(this.windowBits+=16),this.mode===u.UNZIP&&(this.windowBits+=32),(this.mode===u.DEFLATERAW||this.mode===u.INFLATERAW)&&(this.windowBits=-1*this.windowBits),this.strm=new h;switch(this.mode){case u.DEFLATE:case u.GZIP:case u.DEFLATERAW:this.err=b.deflateInit2(this.strm,this.level,u.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case u.INFLATE:case u.GUNZIP:case u.INFLATERAW:case u.UNZIP:this.err=t.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==u.Z_OK&&this._error("Init error"),this.dictionary=A,this.write_in_progress=!1,this.init_done=!0},g.prototype._setDictionary=function(){if(this.dictionary==null)return;this.err=u.Z_OK;switch(this.mode){case u.DEFLATE:case u.DEFLATERAW:this.err=b.deflateSetDictionary(this.strm,this.dictionary);break;default:break}this.err!==u.Z_OK&&this._error("Failed to set dictionary")},g.prototype._reset=function(){this.err=u.Z_OK;switch(this.mode){case u.DEFLATE:case u.DEFLATERAW:case u.GZIP:this.err=b.deflateReset(this.strm);break;case u.INFLATE:case u.INFLATERAW:case u.GUNZIP:this.err=t.inflateReset(this.strm);break;default:break}this.err!==u.Z_OK&&this._error("Failed to reset stream")},u.Zlib=g}).call(this)}).call(this,v("_process"),v("buffer").Buffer)},{_process:39,assert:2,buffer:11,"pako/lib/zlib/constants":30,"pako/lib/zlib/deflate.js":32,"pako/lib/zlib/inflate.js":34,"pako/lib/zlib/zstream":38}],10:[function(v,D,u){(function(p){(function(){"use strict";var f=v("buffer").Buffer,m=v("stream").Transform,h=v("./binding"),b=v("util"),t=v("assert").ok,i=v("buffer").kMaxLength,n="Cannot create final Buffer. It would be larger than 0x"+i.toString(16)+" bytes";h.Z_MIN_WINDOWBITS=8,h.Z_MAX_WINDOWBITS=15,h.Z_DEFAULT_WINDOWBITS=15,h.Z_MIN_CHUNK=64,h.Z_MAX_CHUNK=Infinity,h.Z_DEFAULT_CHUNK=16*1024,h.Z_MIN_MEMLEVEL=1,h.Z_MAX_MEMLEVEL=9,h.Z_DEFAULT_MEMLEVEL=8,h.Z_MIN_LEVEL=-1,h.Z_MAX_LEVEL=9,h.Z_DEFAULT_LEVEL=h.Z_DEFAULT_COMPRESSION;for(var o=Object.keys(h),w=0;w<o.length;w++){var g=o[w];g.match(/^Z/)&&Object.defineProperty(u,g,{enumerable:!0,value:h[g],writable:!1})}for(var l={Z_OK:h.Z_OK,Z_STREAM_END:h.Z_STREAM_END,Z_NEED_DICT:h.Z_NEED_DICT,Z_ERRNO:h.Z_ERRNO,Z_STREAM_ERROR:h.Z_STREAM_ERROR,Z_DATA_ERROR:h.Z_DATA_ERROR,Z_MEM_ERROR:h.Z_MEM_ERROR,Z_BUF_ERROR:h.Z_BUF_ERROR,Z_VERSION_ERROR:h.Z_VERSION_ERROR},e=Object.keys(l),d=0;d<e.length;d++){var y=e[d];l[l[y]]=y}Object.defineProperty(u,"codes",{enumerable:!0,value:Object.freeze(l),writable:!1}),u.Deflate=T,u.Inflate=_,u.Gzip=S,u.Gunzip=N,u.DeflateRaw=L,u.InflateRaw=H,u.Unzip=P,u.createDeflate=function(k){return new T(k)},u.createInflate=function(k){return new _(k)},u.createDeflateRaw=function(k){return new L(k)},u.createInflateRaw=function(k){return new H(k)},u.createGzip=function(k){return new S(k)},u.createGunzip=function(k){return new N(k)},u.createUnzip=function(k){return new P(k)},u.deflate=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new T(F),k,$)},u.deflateSync=function(k,F){return E(new T(F),k)},u.gzip=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new S(F),k,$)},u.gzipSync=function(k,F){return E(new S(F),k)},u.deflateRaw=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new L(F),k,$)},u.deflateRawSync=function(k,F){return E(new L(F),k)},u.unzip=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new P(F),k,$)},u.unzipSync=function(k,F){return E(new P(F),k)},u.inflate=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new _(F),k,$)},u.inflateSync=function(k,F){return E(new _(F),k)},u.gunzip=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new N(F),k,$)},u.gunzipSync=function(k,F){return E(new N(F),k)},u.inflateRaw=function(k,F,$){return typeof F=="function"&&($=F,F={}),A(new H(F),k,$)},u.inflateRawSync=function(k,F){return E(new H(F),k)};function A(k,F,$){var oe=[],Ee=0;k.on("error",W),k.on("end",V),k.end(F),he();function he(){for(var Q;(Q=k.read())!==null;)oe.push(Q),Ee+=Q.length;k.once("readable",he)}function W(Q){k.removeListener("end",V),k.removeListener("readable",he),$(Q)}function V(){var Q,be=null;Ee>=i?be=new RangeError(n):Q=f.concat(oe,Ee),oe=[],k.close(),$(be,Q)}}function E(k,F){if(typeof F=="string"&&(F=f.from(F)),!f.isBuffer(F))throw new TypeError("Not a string or buffer");var $=k._finishFlushFlag;return k._processChunk(F,$)}function T(k){if(!(this instanceof T))return new T(k);te.call(this,k,h.DEFLATE)}function _(k){if(!(this instanceof _))return new _(k);te.call(this,k,h.INFLATE)}function S(k){if(!(this instanceof S))return new S(k);te.call(this,k,h.GZIP)}function N(k){if(!(this instanceof N))return new N(k);te.call(this,k,h.GUNZIP)}function L(k){if(!(this instanceof L))return new L(k);te.call(this,k,h.DEFLATERAW)}function H(k){if(!(this instanceof H))return new H(k);te.call(this,k,h.INFLATERAW)}function P(k){if(!(this instanceof P))return new P(k);te.call(this,k,h.UNZIP)}function K(k){return k===h.Z_NO_FLUSH||k===h.Z_PARTIAL_FLUSH||k===h.Z_SYNC_FLUSH||k===h.Z_FULL_FLUSH||k===h.Z_FINISH||k===h.Z_BLOCK}function te(k,F){var $=this;if(this._opts=k=k||{},this._chunkSize=k.chunkSize||u.Z_DEFAULT_CHUNK,m.call(this,k),k.flush&&!K(k.flush))throw new Error("Invalid flush flag: "+k.flush);if(k.finishFlush&&!K(k.finishFlush))throw new Error("Invalid flush flag: "+k.finishFlush);if(this._flushFlag=k.flush||h.Z_NO_FLUSH,this._finishFlushFlag=typeof k.finishFlush!="undefined"?k.finishFlush:h.Z_FINISH,k.chunkSize&&(k.chunkSize<u.Z_MIN_CHUNK||k.chunkSize>u.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+k.chunkSize);if(k.windowBits&&(k.windowBits<u.Z_MIN_WINDOWBITS||k.windowBits>u.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+k.windowBits);if(k.level&&(k.level<u.Z_MIN_LEVEL||k.level>u.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+k.level);if(k.memLevel&&(k.memLevel<u.Z_MIN_MEMLEVEL||k.memLevel>u.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+k.memLevel);if(k.strategy&&(k.strategy!=u.Z_FILTERED&&k.strategy!=u.Z_HUFFMAN_ONLY&&k.strategy!=u.Z_RLE&&k.strategy!=u.Z_FIXED&&k.strategy!=u.Z_DEFAULT_STRATEGY))throw new Error("Invalid strategy: "+k.strategy);if(k.dictionary&&!f.isBuffer(k.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new h.Zlib(F);var oe=this;this._hadError=!1,this._handle.onerror=function(W,V){se(oe),oe._hadError=!0;var Q=new Error(W);Q.errno=V,Q.code=u.codes[V],oe.emit("error",Q)};var Ee=u.Z_DEFAULT_COMPRESSION;typeof k.level=="number"&&(Ee=k.level);var he=u.Z_DEFAULT_STRATEGY;typeof k.strategy=="number"&&(he=k.strategy),this._handle.init(k.windowBits||u.Z_DEFAULT_WINDOWBITS,Ee,k.memLevel||u.Z_DEFAULT_MEMLEVEL,he,k.dictionary),this._buffer=f.allocUnsafe(this._chunkSize),this._offset=0,this._level=Ee,this._strategy=he,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!$._handle},configurable:!0,enumerable:!0})}b.inherits(te,m),te.prototype.params=function(k,F,$){if(k<u.Z_MIN_LEVEL||k>u.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+k);if(F!=u.Z_FILTERED&&F!=u.Z_HUFFMAN_ONLY&&F!=u.Z_RLE&&F!=u.Z_FIXED&&F!=u.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+F);if(this._level!==k||this._strategy!==F){var oe=this;this.flush(h.Z_SYNC_FLUSH,function(){t(oe._handle,"zlib binding closed"),oe._handle.params(k,F),oe._hadError||(oe._level=k,oe._strategy=F,$&&$())})}else p.nextTick($)},te.prototype.reset=function(){return t(this._handle,"zlib binding closed"),this._handle.reset()},te.prototype._flush=function(k){this._transform(f.alloc(0),"",k)},te.prototype.flush=function(k,F){var $=this,oe=this._writableState;(typeof k=="function"||k===void 0&&!F)&&(F=k,k=h.Z_FULL_FLUSH),oe.ended?F&&p.nextTick(F):oe.ending?F&&this.once("end",F):oe.needDrain?F&&this.once("drain",function(){return $.flush(k,F)}):(this._flushFlag=k,this.write(f.alloc(0),"",F))},te.prototype.close=function(k){se(this,k),p.nextTick(B,this)};function se(k,F){if(F&&p.nextTick(F),!k._handle)return;k._handle.close(),k._handle=null}function B(k){k.emit("close")}te.prototype._transform=function(k,F,$){var oe,Ee=this._writableState,he=Ee.ending||Ee.ended,W=he&&(!k||Ee.length===k.length);if(k!==null&&!f.isBuffer(k))return $(new Error("invalid input"));if(!this._handle)return $(new Error("zlib binding closed"));W?oe=this._finishFlushFlag:(oe=this._flushFlag,k.length>=Ee.length&&(this._flushFlag=this._opts.flush||h.Z_NO_FLUSH)),this._processChunk(k,oe,$)},te.prototype._processChunk=function(k,F,$){var oe=k&&k.length,Ee=this._chunkSize-this._offset,he=0,W=this,V=typeof $=="function";if(!V){var Q=[],be=0,Z;this.on("error",function(ye){Z=ye}),t(this._handle,"zlib binding closed");do var Y=this._handle.writeSync(F,k,he,oe,this._buffer,this._offset,Ee);while(!this._hadError&&ce(Y[0],Y[1]));if(this._hadError)throw Z;if(be>=i)throw se(this),new RangeError(n);var q=f.concat(Q,be);return se(this),q}t(this._handle,"zlib binding closed");var ue=this._handle.write(F,k,he,oe,this._buffer,this._offset,Ee);ue.buffer=k,ue.callback=ce;function ce(ye,me){if(this&&(this.buffer=null,this.callback=null),W._hadError)return;var M=Ee-me;if(t(M>=0,"have should not go down"),M>0){var j=W._buffer.slice(W._offset,W._offset+M);W._offset+=M,V?W.push(j):(Q.push(j),be+=j.length)}if((me===0||W._offset>=W._chunkSize)&&(Ee=W._chunkSize,W._offset=0,W._buffer=f.allocUnsafe(W._chunkSize)),me===0){if(he+=oe-ye,oe=ye,!V)return!0;var ie=W._handle.write(F,k,he,oe,W._buffer,W._offset,W._chunkSize);ie.callback=ce,ie.buffer=k;return}if(!V)return!1;$()}},b.inherits(T,te),b.inherits(_,te),b.inherits(S,te),b.inherits(N,te),b.inherits(L,te),b.inherits(H,te),b.inherits(P,te)}).call(this)}).call(this,v("_process"))},{"./binding":9,_process:39,assert:2,buffer:11,stream:41,util:61}],11:[function(v,D,u){(function(p){(function(){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */"use strict";var f=v("base64-js"),m=v("ieee754");u.Buffer=i,u.SlowBuffer=E,u.INSPECT_MAX_BYTES=50;var h=2147483647;u.kMaxLength=h,i.TYPED_ARRAY_SUPPORT=b(),!i.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function b(){try{var c=new Uint8Array(1);return c.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},c.foo()===42}catch(s){return!1}}Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){return i.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){return i.isBuffer(this)?this.byteOffset:void 0}});function t(c){if(c>h)throw new RangeError('The value "'+c+'" is invalid for option "size"');var s=new Uint8Array(c);return s.__proto__=i.prototype,s}function i(c,s,r){if(typeof c=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(c)}return n(c,s,r)}typeof Symbol!="undefined"&&Symbol.species!=null&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192;function n(c,s,r){if(typeof c=="string")return l(c,s);if(ArrayBuffer.isView(c))return e(c);if(c==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c);if(ve(c,ArrayBuffer)||c&&ve(c.buffer,ArrayBuffer))return d(c,s,r);if(typeof c=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var R=c.valueOf&&c.valueOf();if(R!=null&&R!==c)return i.from(R,s,r);var z=y(c);if(z)return z;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof c[Symbol.toPrimitive]=="function")return i.from(c[Symbol.toPrimitive]("string"),s,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c)}i.from=function(c,s,r){return n(c,s,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array;function o(c){if(typeof c!="number")throw new TypeError('"size" argument must be of type number');if(c<0)throw new RangeError('The value "'+c+'" is invalid for option "size"')}function w(c,s,r){return o(c),c<=0?t(c):s!==void 0?typeof r=="string"?t(c).fill(s,r):t(c).fill(s):t(c)}i.alloc=function(c,s,r){return w(c,s,r)};function g(c){return o(c),t(c<0?0:A(c)|0)}i.allocUnsafe=function(c){return g(c)},i.allocUnsafeSlow=function(c){return g(c)};function l(c,s){if((typeof s!="string"||s==="")&&(s="utf8"),!i.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var r=T(c,s)|0,R=t(r),z=R.write(c,s);return z!==r&&(R=R.slice(0,z)),R}function e(c){for(var s=c.length<0?0:A(c.length)|0,r=t(s),R=0;R<s;R+=1)r[R]=c[R]&255;return r}function d(c,s,r){if(s<0||c.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(c.byteLength<s+(r||0))throw new RangeError('"length" is outside of buffer bounds');var R;return s===void 0&&r===void 0?R=new Uint8Array(c):r===void 0?R=new Uint8Array(c,s):R=new Uint8Array(c,s,r),R.__proto__=i.prototype,R}function y(c){if(i.isBuffer(c)){var s=A(c.length)|0,r=t(s);return r.length===0||c.copy(r,0,0,s),r}if(c.length!==void 0)return typeof c.length!="number"||C(c.length)?t(0):e(c);if(c.type==="Buffer"&&Array.isArray(c.data))return e(c.data)}function A(c){if(c>=h)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h.toString(16)+" bytes");return c|0}function E(c){return+c!=c&&(c=0),i.alloc(+c)}i.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==i.prototype},i.compare=function(s,r){if(ve(s,Uint8Array)&&(s=i.from(s,s.offset,s.byteLength)),ve(r,Uint8Array)&&(r=i.from(r,r.offset,r.byteLength)),!i.isBuffer(s)||!i.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===r)return 0;for(var R=s.length,z=r.length,re=0,ae=Math.min(R,z);re<ae;++re)if(s[re]!==r[re]){R=s[re],z=r[re];break}return R<z?-1:z<R?1:0},i.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(s,r){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return i.alloc(0);var R;if(r===void 0)for(r=0,R=0;R<s.length;++R)r+=s[R].length;var z=i.allocUnsafe(r),re=0;for(R=0;R<s.length;++R){var ae=s[R];if(ve(ae,Uint8Array)&&(ae=i.from(ae)),!i.isBuffer(ae))throw new TypeError('"list" argument must be an Array of Buffers');ae.copy(z,re),re+=ae.length}return z};function T(c,s){if(i.isBuffer(c))return c.length;if(ArrayBuffer.isView(c)||ve(c,ArrayBuffer))return c.byteLength;if(typeof c!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof c);var r=c.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&r===0)return 0;for(var z=!1;;)switch(s){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return me(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return ie(c).length;default:if(z)return R?-1:me(c).length;s=(""+s).toLowerCase(),z=!0}}i.byteLength=T;function _(c,s,r){var R=!1;if((s===void 0||s<0)&&(s=0),s>this.length)return"";if((r===void 0||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,s>>>=0,r<=s)return"";for(c||(c="utf8");;)switch(c){case"hex":return W(this,s,r);case"utf8":case"utf-8":return F(this,s,r);case"ascii":return Ee(this,s,r);case"latin1":case"binary":return he(this,s,r);case"base64":return k(this,s,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,s,r);default:if(R)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),R=!0}}i.prototype._isBuffer=!0;function S(c,s,r){var R=c[s];c[s]=c[r],c[r]=R}i.prototype.swap16=function(){var s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<s;r+=2)S(this,r,r+1);return this},i.prototype.swap32=function(){var s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<s;r+=4)S(this,r,r+3),S(this,r+1,r+2);return this},i.prototype.swap64=function(){var s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<s;r+=8)S(this,r,r+7),S(this,r+1,r+6),S(this,r+2,r+5),S(this,r+3,r+4);return this},i.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?F(this,0,s):_.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(s){if(!i.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:i.compare(this,s)===0},i.prototype.inspect=function(){var s="",r=u.INSPECT_MAX_BYTES;return s=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(s+=" ... "),"<Buffer "+s+">"},i.prototype.compare=function(s,r,R,z,re){if(ve(s,Uint8Array)&&(s=i.from(s,s.offset,s.byteLength)),!i.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(r===void 0&&(r=0),R===void 0&&(R=s?s.length:0),z===void 0&&(z=0),re===void 0&&(re=this.length),r<0||R>s.length||z<0||re>this.length)throw new RangeError("out of range index");if(z>=re&&r>=R)return 0;if(z>=re)return-1;if(r>=R)return 1;if(r>>>=0,R>>>=0,z>>>=0,re>>>=0,this===s)return 0;for(var ae=re-z,Se=R-r,ke=Math.min(ae,Se),Ie=this.slice(z,re),Ne=s.slice(r,R),Re=0;Re<ke;++Re)if(Ie[Re]!==Ne[Re]){ae=Ie[Re],Se=Ne[Re];break}return ae<Se?-1:Se<ae?1:0};function N(c,s,r,R,z){if(c.length===0)return-1;if(typeof r=="string"?(R=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,C(r)&&(r=z?0:c.length-1),r<0&&(r=c.length+r),r>=c.length){if(z)return-1;r=c.length-1}else if(r<0)if(z)r=0;else return-1;if(typeof s=="string"&&(s=i.from(s,R)),i.isBuffer(s))return s.length===0?-1:L(c,s,r,R,z);if(typeof s=="number")return s=s&255,typeof Uint8Array.prototype.indexOf=="function"?z?Uint8Array.prototype.indexOf.call(c,s,r):Uint8Array.prototype.lastIndexOf.call(c,s,r):L(c,[s],r,R,z);throw new TypeError("val must be string, number or Buffer")}function L(c,s,r,R,z){var re=1,ae=c.length,Se=s.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(c.length<2||s.length<2)return-1;re=2,ae/=2,Se/=2,r/=2}function ke(Le,De){return re===1?Le[De]:Le.readUInt16BE(De*re)}var Ie;if(z){var Ne=-1;for(Ie=r;Ie<ae;Ie++)if(ke(c,Ie)===ke(s,Ne===-1?0:Ie-Ne)){if(Ne===-1&&(Ne=Ie),Ie-Ne+1===Se)return Ne*re}else Ne!==-1&&(Ie-=Ie-Ne),Ne=-1}else for(r+Se>ae&&(r=ae-Se),Ie=r;Ie>=0;Ie--){for(var Re=!0,Ue=0;Ue<Se;Ue++)if(ke(c,Ie+Ue)!==ke(s,Ue)){Re=!1;break}if(Re)return Ie}return-1}i.prototype.includes=function(s,r,R){return this.indexOf(s,r,R)!==-1},i.prototype.indexOf=function(s,r,R){return N(this,s,r,R,!0)},i.prototype.lastIndexOf=function(s,r,R){return N(this,s,r,R,!1)};function H(c,s,r,R){r=Number(r)||0;var z=c.length-r;R?(R=Number(R),R>z&&(R=z)):R=z;var re=s.length;R>re/2&&(R=re/2);for(var ae=0;ae<R;++ae){var Se=parseInt(s.substr(ae*2,2),16);if(C(Se))return ae;c[r+ae]=Se}return ae}function P(c,s,r,R){return pe(me(s,c.length-r),c,r,R)}function K(c,s,r,R){return pe(M(s),c,r,R)}function te(c,s,r,R){return K(c,s,r,R)}function se(c,s,r,R){return pe(ie(s),c,r,R)}function B(c,s,r,R){return pe(j(s,c.length-r),c,r,R)}i.prototype.write=function(s,r,R,z){if(r===void 0)z="utf8",R=this.length,r=0;else if(R===void 0&&typeof r=="string")z=r,R=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(R)?(R=R>>>0,z===void 0&&(z="utf8")):(z=R,R=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var re=this.length-r;if((R===void 0||R>re)&&(R=re),s.length>0&&(R<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");for(var ae=!1;;)switch(z){case"hex":return H(this,s,r,R);case"utf8":case"utf-8":return P(this,s,r,R);case"ascii":return K(this,s,r,R);case"latin1":case"binary":return te(this,s,r,R);case"base64":return se(this,s,r,R);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,s,r,R);default:if(ae)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),ae=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(c,s,r){return s===0&&r===c.length?f.fromByteArray(c):f.fromByteArray(c.slice(s,r))}function F(c,s,r){r=Math.min(c.length,r);for(var R=[],z=s;z<r;){var re=c[z],ae=null,Se=re>239?4:re>223?3:re>191?2:1;if(z+Se<=r){var ke,Ie,Ne,Re;switch(Se){case 1:re<128&&(ae=re);break;case 2:ke=c[z+1],(ke&192)===128&&(Re=(re&31)<<6|ke&63,Re>127&&(ae=Re));break;case 3:ke=c[z+1],Ie=c[z+2],(ke&192)===128&&(Ie&192)===128&&(Re=(re&15)<<12|(ke&63)<<6|Ie&63,Re>2047&&(Re<55296||Re>57343)&&(ae=Re));break;case 4:ke=c[z+1],Ie=c[z+2],Ne=c[z+3],(ke&192)===128&&(Ie&192)===128&&(Ne&192)===128&&(Re=(re&15)<<18|(ke&63)<<12|(Ie&63)<<6|Ne&63,Re>65535&&Re<1114112&&(ae=Re))}}ae===null?(ae=65533,Se=1):ae>65535&&(ae-=65536,R.push(ae>>>10&1023|55296),ae=56320|ae&1023),R.push(ae),z+=Se}return oe(R)}var $=4096;function oe(c){var s=c.length;if(s<=$)return String.fromCharCode.apply(String,c);for(var r="",R=0;R<s;)r+=String.fromCharCode.apply(String,c.slice(R,R+=$));return r}function Ee(c,s,r){var R="";r=Math.min(c.length,r);for(var z=s;z<r;++z)R+=String.fromCharCode(c[z]&127);return R}function he(c,s,r){var R="";r=Math.min(c.length,r);for(var z=s;z<r;++z)R+=String.fromCharCode(c[z]);return R}function W(c,s,r){var R=c.length;(!s||s<0)&&(s=0),(!r||r<0||r>R)&&(r=R);for(var z="",re=s;re<r;++re)z+=ye(c[re]);return z}function V(c,s,r){for(var R=c.slice(s,r),z="",re=0;re<R.length;re+=2)z+=String.fromCharCode(R[re]+R[re+1]*256);return z}i.prototype.slice=function(s,r){var R=this.length;s=~~s,r=r===void 0?R:~~r,s<0?(s+=R,s<0&&(s=0)):s>R&&(s=R),r<0?(r+=R,r<0&&(r=0)):r>R&&(r=R),r<s&&(r=s);var z=this.subarray(s,r);return z.__proto__=i.prototype,z};function Q(c,s,r){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+s>r)throw new RangeError("Trying to access beyond buffer length")}i.prototype.readUIntLE=function(s,r,R){s=s>>>0,r=r>>>0,R||Q(s,r,this.length);for(var z=this[s],re=1,ae=0;++ae<r&&(re*=256);)z+=this[s+ae]*re;return z},i.prototype.readUIntBE=function(s,r,R){s=s>>>0,r=r>>>0,R||Q(s,r,this.length);for(var z=this[s+--r],re=1;r>0&&(re*=256);)z+=this[s+--r]*re;return z},i.prototype.readUInt8=function(s,r){return s=s>>>0,r||Q(s,1,this.length),this[s]},i.prototype.readUInt16LE=function(s,r){return s=s>>>0,r||Q(s,2,this.length),this[s]|this[s+1]<<8},i.prototype.readUInt16BE=function(s,r){return s=s>>>0,r||Q(s,2,this.length),this[s]<<8|this[s+1]},i.prototype.readUInt32LE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},i.prototype.readUInt32BE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},i.prototype.readIntLE=function(s,r,R){s=s>>>0,r=r>>>0,R||Q(s,r,this.length);for(var z=this[s],re=1,ae=0;++ae<r&&(re*=256);)z+=this[s+ae]*re;return re*=128,z>=re&&(z-=Math.pow(2,8*r)),z},i.prototype.readIntBE=function(s,r,R){s=s>>>0,r=r>>>0,R||Q(s,r,this.length);for(var z=r,re=1,ae=this[s+--z];z>0&&(re*=256);)ae+=this[s+--z]*re;return re*=128,ae>=re&&(ae-=Math.pow(2,8*r)),ae},i.prototype.readInt8=function(s,r){return s=s>>>0,r||Q(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},i.prototype.readInt16LE=function(s,r){s=s>>>0,r||Q(s,2,this.length);var R=this[s]|this[s+1]<<8;return R&32768?R|4294901760:R},i.prototype.readInt16BE=function(s,r){s=s>>>0,r||Q(s,2,this.length);var R=this[s+1]|this[s]<<8;return R&32768?R|4294901760:R},i.prototype.readInt32LE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},i.prototype.readInt32BE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},i.prototype.readFloatLE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),m.read(this,s,!0,23,4)},i.prototype.readFloatBE=function(s,r){return s=s>>>0,r||Q(s,4,this.length),m.read(this,s,!1,23,4)},i.prototype.readDoubleLE=function(s,r){return s=s>>>0,r||Q(s,8,this.length),m.read(this,s,!0,52,8)},i.prototype.readDoubleBE=function(s,r){return s=s>>>0,r||Q(s,8,this.length),m.read(this,s,!1,52,8)};function be(c,s,r,R,z,re){if(!i.isBuffer(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>z||s<re)throw new RangeError('"value" argument is out of bounds');if(r+R>c.length)throw new RangeError("Index out of range")}i.prototype.writeUIntLE=function(s,r,R,z){if(s=+s,r=r>>>0,R=R>>>0,!z){var re=Math.pow(2,8*R)-1;be(this,s,r,R,re,0)}var ae=1,Se=0;for(this[r]=s&255;++Se<R&&(ae*=256);)this[r+Se]=s/ae&255;return r+R},i.prototype.writeUIntBE=function(s,r,R,z){if(s=+s,r=r>>>0,R=R>>>0,!z){var re=Math.pow(2,8*R)-1;be(this,s,r,R,re,0)}var ae=R-1,Se=1;for(this[r+ae]=s&255;--ae>=0&&(Se*=256);)this[r+ae]=s/Se&255;return r+R},i.prototype.writeUInt8=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,1,255,0),this[r]=s&255,r+1},i.prototype.writeUInt16LE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,2,65535,0),this[r]=s&255,this[r+1]=s>>>8,r+2},i.prototype.writeUInt16BE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,2,65535,0),this[r]=s>>>8,this[r+1]=s&255,r+2},i.prototype.writeUInt32LE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,4,4294967295,0),this[r+3]=s>>>24,this[r+2]=s>>>16,this[r+1]=s>>>8,this[r]=s&255,r+4},i.prototype.writeUInt32BE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,4,4294967295,0),this[r]=s>>>24,this[r+1]=s>>>16,this[r+2]=s>>>8,this[r+3]=s&255,r+4},i.prototype.writeIntLE=function(s,r,R,z){if(s=+s,r=r>>>0,!z){var re=Math.pow(2,8*R-1);be(this,s,r,R,re-1,-re)}var ae=0,Se=1,ke=0;for(this[r]=s&255;++ae<R&&(Se*=256);)s<0&&ke===0&&this[r+ae-1]!==0&&(ke=1),this[r+ae]=(s/Se>>0)-ke&255;return r+R},i.prototype.writeIntBE=function(s,r,R,z){if(s=+s,r=r>>>0,!z){var re=Math.pow(2,8*R-1);be(this,s,r,R,re-1,-re)}var ae=R-1,Se=1,ke=0;for(this[r+ae]=s&255;--ae>=0&&(Se*=256);)s<0&&ke===0&&this[r+ae+1]!==0&&(ke=1),this[r+ae]=(s/Se>>0)-ke&255;return r+R},i.prototype.writeInt8=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,1,127,-128),s<0&&(s=255+s+1),this[r]=s&255,r+1},i.prototype.writeInt16LE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,2,32767,-32768),this[r]=s&255,this[r+1]=s>>>8,r+2},i.prototype.writeInt16BE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,2,32767,-32768),this[r]=s>>>8,this[r+1]=s&255,r+2},i.prototype.writeInt32LE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,4,2147483647,-2147483648),this[r]=s&255,this[r+1]=s>>>8,this[r+2]=s>>>16,this[r+3]=s>>>24,r+4},i.prototype.writeInt32BE=function(s,r,R){return s=+s,r=r>>>0,R||be(this,s,r,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[r]=s>>>24,this[r+1]=s>>>16,this[r+2]=s>>>8,this[r+3]=s&255,r+4};function Z(c,s,r,R,z,re){if(r+R>c.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Y(c,s,r,R,z){return s=+s,r=r>>>0,z||Z(c,s,r,4,34028234663852886e22,-34028234663852886e22),m.write(c,s,r,R,23,4),r+4}i.prototype.writeFloatLE=function(s,r,R){return Y(this,s,r,!0,R)},i.prototype.writeFloatBE=function(s,r,R){return Y(this,s,r,!1,R)};function q(c,s,r,R,z){return s=+s,r=r>>>0,z||Z(c,s,r,8,17976931348623157e292,-17976931348623157e292),m.write(c,s,r,R,52,8),r+8}i.prototype.writeDoubleLE=function(s,r,R){return q(this,s,r,!0,R)},i.prototype.writeDoubleBE=function(s,r,R){return q(this,s,r,!1,R)},i.prototype.copy=function(s,r,R,z){if(!i.isBuffer(s))throw new TypeError("argument should be a Buffer");if(R||(R=0),!z&&z!==0&&(z=this.length),r>=s.length&&(r=s.length),r||(r=0),z>0&&z<R&&(z=R),z===R)return 0;if(s.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(R<0||R>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),s.length-r<z-R&&(z=s.length-r+R);var re=z-R;if(this===s&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(r,R,z);else if(this===s&&R<r&&r<z)for(var ae=re-1;ae>=0;--ae)s[ae+r]=this[ae+R];else Uint8Array.prototype.set.call(s,this.subarray(R,z),r);return re},i.prototype.fill=function(s,r,R,z){if(typeof s=="string"){if(typeof r=="string"?(z=r,r=0,R=this.length):typeof R=="string"&&(z=R,R=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!i.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(s.length===1){var re=s.charCodeAt(0);(z==="utf8"&&re<128||z==="latin1")&&(s=re)}}else typeof s=="number"&&(s=s&255);if(r<0||this.length<r||this.length<R)throw new RangeError("Out of range index");if(R<=r)return this;r=r>>>0,R=R===void 0?this.length:R>>>0,s||(s=0);var ae;if(typeof s=="number")for(ae=r;ae<R;++ae)this[ae]=s;else{var Se=i.isBuffer(s)?s:i.from(s,z),ke=Se.length;if(ke===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(ae=0;ae<R-r;++ae)this[ae+r]=Se[ae%ke]}return this};var ue=/[^+/0-9A-Za-z-_]/g;function ce(c){if(c=c.split("=")[0],c=c.trim().replace(ue,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function ye(c){return c<16?"0"+c.toString(16):c.toString(16)}function me(c,s){s=s||Infinity;for(var r,R=c.length,z=null,re=[],ae=0;ae<R;++ae){if(r=c.charCodeAt(ae),r>55295&&r<57344){if(!z){if(r>56319){(s-=3)>-1&&re.push(239,191,189);continue}else if(ae+1===R){(s-=3)>-1&&re.push(239,191,189);continue}z=r;continue}if(r<56320){(s-=3)>-1&&re.push(239,191,189),z=r;continue}r=(z-55296<<10|r-56320)+65536}else z&&((s-=3)>-1&&re.push(239,191,189));if(z=null,r<128){if((s-=1)<0)break;re.push(r)}else if(r<2048){if((s-=2)<0)break;re.push(r>>6|192,r&63|128)}else if(r<65536){if((s-=3)<0)break;re.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((s-=4)<0)break;re.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return re}function M(c){for(var s=[],r=0;r<c.length;++r)s.push(c.charCodeAt(r)&255);return s}function j(c,s){for(var r,R,z,re=[],ae=0;ae<c.length&&!((s-=2)<0);++ae)r=c.charCodeAt(ae),R=r>>8,z=r%256,re.push(z),re.push(R);return re}function ie(c){return f.toByteArray(ce(c))}function pe(c,s,r,R){for(var z=0;z<R&&!(z+r>=s.length||z>=c.length);++z)s[z+r]=c[z];return z}function ve(c,s){return c instanceof s||c!=null&&c.constructor!=null&&c.constructor.name!=null&&c.constructor.name===s.name}function C(c){return c!==c}}).call(this)}).call(this,v("buffer").Buffer)},{"base64-js":7,buffer:11,ieee754:22}],12:[function(v,D,u){"use strict";var p,f=TypeError,m=Object.getOwnPropertyDescriptor;if(m)try{m({},"")}catch(H){m=null}var h=function(){throw new f},b=m?function(){try{return arguments.callee,h}catch(H){try{return m(arguments,"callee").get}catch(P){return h}}}():h,t=v("has-symbols")(),i=Object.getPrototypeOf||function(H){return H.__proto__},n,o=n?i(n):p,w,g=w?w.constructor:p,l,e=l?i(l):p,d=l?l():p,y=typeof Uint8Array=="undefined"?p:i(Uint8Array),A={"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?p:ArrayBuffer,"%ArrayBufferPrototype%":typeof ArrayBuffer=="undefined"?p:ArrayBuffer.prototype,"%ArrayIteratorPrototype%":t?i([][Symbol.iterator]()):p,"%ArrayPrototype%":Array.prototype,"%ArrayProto_entries%":Array.prototype.entries,"%ArrayProto_forEach%":Array.prototype.forEach,"%ArrayProto_keys%":Array.prototype.keys,"%ArrayProto_values%":Array.prototype.values,"%AsyncFromSyncIteratorPrototype%":p,"%AsyncFunction%":g,"%AsyncFunctionPrototype%":g?g.prototype:p,"%AsyncGenerator%":l?i(d):p,"%AsyncGeneratorFunction%":e,"%AsyncGeneratorPrototype%":e?e.prototype:p,"%AsyncIteratorPrototype%":d&&t&&Symbol.asyncIterator?d[Symbol.asyncIterator]():p,"%Atomics%":typeof Atomics=="undefined"?p:Atomics,"%Boolean%":Boolean,"%BooleanPrototype%":Boolean.prototype,"%DataView%":typeof DataView=="undefined"?p:DataView,"%DataViewPrototype%":typeof DataView=="undefined"?p:DataView.prototype,"%Date%":Date,"%DatePrototype%":Date.prototype,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%ErrorPrototype%":Error.prototype,"%eval%":eval,"%EvalError%":EvalError,"%EvalErrorPrototype%":EvalError.prototype,"%Float32Array%":typeof Float32Array=="undefined"?p:Float32Array,"%Float32ArrayPrototype%":typeof Float32Array=="undefined"?p:Float32Array.prototype,"%Float64Array%":typeof Float64Array=="undefined"?p:Float64Array,"%Float64ArrayPrototype%":typeof Float64Array=="undefined"?p:Float64Array.prototype,"%Function%":Function,"%FunctionPrototype%":Function.prototype,"%Generator%":n?i(n()):p,"%GeneratorFunction%":o,"%GeneratorPrototype%":o?o.prototype:p,"%Int8Array%":typeof Int8Array=="undefined"?p:Int8Array,"%Int8ArrayPrototype%":typeof Int8Array=="undefined"?p:Int8Array.prototype,"%Int16Array%":typeof Int16Array=="undefined"?p:Int16Array,"%Int16ArrayPrototype%":typeof Int16Array=="undefined"?p:Int8Array.prototype,"%Int32Array%":typeof Int32Array=="undefined"?p:Int32Array,"%Int32ArrayPrototype%":typeof Int32Array=="undefined"?p:Int32Array.prototype,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":t?i(i([][Symbol.iterator]())):p,"%JSON%":typeof JSON=="object"?JSON:p,"%JSONParse%":typeof JSON=="object"?JSON.parse:p,"%Map%":typeof Map=="undefined"?p:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!t?p:i(new Map()[Symbol.iterator]()),"%MapPrototype%":typeof Map=="undefined"?p:Map.prototype,"%Math%":Math,"%Number%":Number,"%NumberPrototype%":Number.prototype,"%Object%":Object,"%ObjectPrototype%":Object.prototype,"%ObjProto_toString%":Object.prototype.toString,"%ObjProto_valueOf%":Object.prototype.valueOf,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?p:Promise,"%PromisePrototype%":typeof Promise=="undefined"?p:Promise.prototype,"%PromiseProto_then%":typeof Promise=="undefined"?p:Promise.prototype.then,"%Promise_all%":typeof Promise=="undefined"?p:Promise.all,"%Promise_reject%":typeof Promise=="undefined"?p:Promise.reject,"%Promise_resolve%":typeof Promise=="undefined"?p:Promise.resolve,"%Proxy%":typeof Proxy=="undefined"?p:Proxy,"%RangeError%":RangeError,"%RangeErrorPrototype%":RangeError.prototype,"%ReferenceError%":ReferenceError,"%ReferenceErrorPrototype%":ReferenceError.prototype,"%Reflect%":typeof Reflect=="undefined"?p:Reflect,"%RegExp%":RegExp,"%RegExpPrototype%":RegExp.prototype,"%Set%":typeof Set=="undefined"?p:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!t?p:i(new Set()[Symbol.iterator]()),"%SetPrototype%":typeof Set=="undefined"?p:Set.prototype,"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?p:SharedArrayBuffer,"%SharedArrayBufferPrototype%":typeof SharedArrayBuffer=="undefined"?p:SharedArrayBuffer.prototype,"%String%":String,"%StringIteratorPrototype%":t?i(""[Symbol.iterator]()):p,"%StringPrototype%":String.prototype,"%Symbol%":t?Symbol:p,"%SymbolPrototype%":t?Symbol.prototype:p,"%SyntaxError%":SyntaxError,"%SyntaxErrorPrototype%":SyntaxError.prototype,"%ThrowTypeError%":b,"%TypedArray%":y,"%TypedArrayPrototype%":y?y.prototype:p,"%TypeError%":f,"%TypeErrorPrototype%":f.prototype,"%Uint8Array%":typeof Uint8Array=="undefined"?p:Uint8Array,"%Uint8ArrayPrototype%":typeof Uint8Array=="undefined"?p:Uint8Array.prototype,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?p:Uint8ClampedArray,"%Uint8ClampedArrayPrototype%":typeof Uint8ClampedArray=="undefined"?p:Uint8ClampedArray.prototype,"%Uint16Array%":typeof Uint16Array=="undefined"?p:Uint16Array,"%Uint16ArrayPrototype%":typeof Uint16Array=="undefined"?p:Uint16Array.prototype,"%Uint32Array%":typeof Uint32Array=="undefined"?p:Uint32Array,"%Uint32ArrayPrototype%":typeof Uint32Array=="undefined"?p:Uint32Array.prototype,"%URIError%":URIError,"%URIErrorPrototype%":URIError.prototype,"%WeakMap%":typeof WeakMap=="undefined"?p:WeakMap,"%WeakMapPrototype%":typeof WeakMap=="undefined"?p:WeakMap.prototype,"%WeakSet%":typeof WeakSet=="undefined"?p:WeakSet,"%WeakSetPrototype%":typeof WeakSet=="undefined"?p:WeakSet.prototype},E=v("function-bind"),T=E.call(Function.call,String.prototype.replace),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,S=/\\(\\)?/g,N=function(P){var K=[];return T(P,_,function(te,se,B,k){K[K.length]=B?T(k,S,"$1"):se||te}),K},L=function(P,K){if(!(P in A))throw new SyntaxError("intrinsic "+P+" does not exist!");if(typeof A[P]=="undefined"&&!K)throw new f("intrinsic "+P+" exists, but is not available. Please file an issue!");return A[P]};D.exports=function(P,K){if(typeof P!="string"||P.length===0)throw new TypeError("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof K!="boolean")throw new TypeError('"allowMissing" argument must be a boolean');for(var te=N(P),se=L("%"+(te.length>0?te[0]:"")+"%",K),B=1;B<te.length;B+=1)if(se!=null)if(m&&B+1>=te.length){var k=m(se,te[B]);if(!K&&!(te[B]in se))throw new f("base intrinsic for "+P+" exists, but the property is not available.");se=k&&"get"in k&&!("originalValue"in k.get)?k.get:se[te[B]]}else se=se[te[B]];return se}},{"function-bind":19,"has-symbols":20}],13:[function(v,D,u){"use strict";var p=v("function-bind"),f=v("../GetIntrinsic"),m=f("%Function.prototype.apply%"),h=f("%Function.prototype.call%"),b=f("%Reflect.apply%",!0)||p.call(h,m),t=f("%Object.defineProperty%",!0);if(t)try{t({},"a",{value:1})}catch(n){t=null}D.exports=function(){return b(p,h,arguments)};var i=function(){return b(p,m,arguments)};t?t(D.exports,"apply",{value:i}):D.exports.apply=i},{"../GetIntrinsic":12,"function-bind":19}],14:[function(v,D,u){"use strict";var p=v("../GetIntrinsic"),f=v("./callBind"),m=f(p("String.prototype.indexOf"));D.exports=function(b,t){var i=p(b,!!t);return typeof i=="function"&&m(b,".prototype.")?f(i):i}},{"../GetIntrinsic":12,"./callBind":13}],15:[function(v,D,u){"use strict";var p=v("../GetIntrinsic"),f=p("%Object.getOwnPropertyDescriptor%");if(f)try{f([],"length")}catch(m){f=null}D.exports=f},{"../GetIntrinsic":12}],16:[function(v,D,u){"use strict";var p=typeof Reflect=="object"?Reflect:null,f=p&&typeof p.apply=="function"?p.apply:function(S,N,L){return Function.prototype.apply.call(S,N,L)},m;p&&typeof p.ownKeys=="function"?m=p.ownKeys:Object.getOwnPropertySymbols?m=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:m=function(S){return Object.getOwnPropertyNames(S)};function h(_){console&&console.warn&&console.warn(_)}var b=Number.isNaN||function(S){return S!==S};function t(){t.init.call(this)}D.exports=t,D.exports.once=T,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var i=10;function n(_){if(typeof _!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof _)}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(_){if(typeof _!="number"||_<0||b(_))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+_+".");i=_}}),t.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||b(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function o(_){return _._maxListeners===void 0?t.defaultMaxListeners:_._maxListeners}t.prototype.getMaxListeners=function(){return o(this)},t.prototype.emit=function(S){for(var N=[],L=1;L<arguments.length;L++)N.push(arguments[L]);var H=S==="error",P=this._events;if(P!==void 0)H=H&&P.error===void 0;else if(!H)return!1;if(H){var K;if(N.length>0&&(K=N[0]),K instanceof Error)throw K;var te=new Error("Unhandled error."+(K?" ("+K.message+")":""));throw te.context=K,te}var se=P[S];if(se===void 0)return!1;if(typeof se=="function")f(se,this,N);else for(var B=se.length,k=y(se,B),L=0;L<B;++L)f(k[L],this,N);return!0};function w(_,S,N,L){var H,P,K;if(n(N),P=_._events,P===void 0?(P=_._events=Object.create(null),_._eventsCount=0):(P.newListener!==void 0&&(_.emit("newListener",S,N.listener?N.listener:N),P=_._events),K=P[S]),K===void 0)K=P[S]=N,++_._eventsCount;else if(typeof K=="function"?K=P[S]=L?[N,K]:[K,N]:L?K.unshift(N):K.push(N),H=o(_),H>0&&K.length>H&&!K.warned){K.warned=!0;var te=new Error("Possible EventEmitter memory leak detected. "+K.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");te.name="MaxListenersExceededWarning",te.emitter=_,te.type=S,te.count=K.length,h(te)}return _}t.prototype.addListener=function(S,N){return w(this,S,N,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(S,N){return w(this,S,N,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(_,S,N){var L={fired:!1,wrapFn:void 0,target:_,type:S,listener:N},H=g.bind(L);return H.listener=N,L.wrapFn=H,H}t.prototype.once=function(S,N){return n(N),this.on(S,l(this,S,N)),this},t.prototype.prependOnceListener=function(S,N){return n(N),this.prependListener(S,l(this,S,N)),this},t.prototype.removeListener=function(S,N){var L,H,P,K,te;if(n(N),H=this._events,H===void 0)return this;if(L=H[S],L===void 0)return this;if(L===N||L.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete H[S],H.removeListener&&this.emit("removeListener",S,L.listener||N));else if(typeof L!="function"){for(P=-1,K=L.length-1;K>=0;K--)if(L[K]===N||L[K].listener===N){te=L[K].listener,P=K;break}if(P<0)return this;P===0?L.shift():A(L,P),L.length===1&&(H[S]=L[0]),H.removeListener!==void 0&&this.emit("removeListener",S,te||N)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(S){var N,L,H;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[S]),this;if(arguments.length===0){var P=Object.keys(L),K;for(H=0;H<P.length;++H){if(K=P[H],K==="removeListener")continue;this.removeAllListeners(K)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=L[S],typeof N=="function")this.removeListener(S,N);else if(N!==void 0)for(H=N.length-1;H>=0;H--)this.removeListener(S,N[H]);return this};function e(_,S,N){var L=_._events;if(L===void 0)return[];var H=L[S];return H===void 0?[]:typeof H=="function"?N?[H.listener||H]:[H]:N?E(H):y(H,H.length)}t.prototype.listeners=function(S){return e(this,S,!0)},t.prototype.rawListeners=function(S){return e(this,S,!1)},t.listenerCount=function(_,S){return typeof _.listenerCount=="function"?_.listenerCount(S):d.call(_,S)},t.prototype.listenerCount=d;function d(_){var S=this._events;if(S!==void 0){var N=S[_];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}t.prototype.eventNames=function(){return this._eventsCount>0?m(this._events):[]};function y(_,S){for(var N=new Array(S),L=0;L<S;++L)N[L]=_[L];return N}function A(_,S){for(;S+1<_.length;S++)_[S]=_[S+1];_.pop()}function E(_){for(var S=new Array(_.length),N=0;N<S.length;++N)S[N]=_[N].listener||_[N];return S}function T(_,S){return new Promise(function(N,L){function H(){P!==void 0&&_.removeListener("error",P),N([].slice.call(arguments))}var P;S!=="error"&&(P=function(te){_.removeListener(S,H),L(te)},_.once("error",P)),_.once(S,H)})}},{}],17:[function(v,D,u){var p=Object.prototype.hasOwnProperty,f=Object.prototype.toString;D.exports=function(h,b,t){if(f.call(b)!=="[object Function]")throw new TypeError("iterator must be a function");var i=h.length;if(i===+i)for(var n=0;n<i;n++)b.call(t,h[n],n,h);else for(var o in h)p.call(h,o)&&b.call(t,h[o],o,h)}},{}],18:[function(v,D,u){"use strict";var p="Function.prototype.bind called on incompatible ",f=Array.prototype.slice,m=Object.prototype.toString,h="[object Function]";D.exports=function(t){var i=this;if(typeof i!="function"||m.call(i)!==h)throw new TypeError(p+i);for(var n=f.call(arguments,1),o,w=function(){if(this instanceof o){var y=i.apply(this,n.concat(f.call(arguments)));return Object(y)===y?y:this}else return i.apply(t,n.concat(f.call(arguments)))},g=Math.max(0,i.length-n.length),l=[],e=0;e<g;e++)l.push("$"+e);if(o=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(w),i.prototype){var d=function(){};d.prototype=i.prototype,o.prototype=new d,d.prototype=null}return o}},{}],19:[function(v,D,u){"use strict";var p=v("./implementation");D.exports=Function.prototype.bind||p},{"./implementation":18}],20:[function(v,D,u){(function(p){(function(){"use strict";var f=p.Symbol,m=v("./shams");D.exports=function(){return typeof f!="function"||(typeof Symbol!="function"||(typeof f("foo")!="symbol"||typeof Symbol("bar")!="symbol"))?!1:m()}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./shams":21}],21:[function(v,D,u){"use strict";D.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var f={},m=Symbol("test"),h=Object(m);if(typeof m=="string")return!1;if(Object.prototype.toString.call(m)!=="[object Symbol]")return!1;if(Object.prototype.toString.call(h)!=="[object Symbol]")return!1;var b=42;f[m]=b;for(m in f)return!1;if(typeof Object.keys=="function"&&Object.keys(f).length!==0)return!1;if(typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(f).length!==0)return!1;var t=Object.getOwnPropertySymbols(f);if(t.length!==1||t[0]!==m)return!1;if(!Object.prototype.propertyIsEnumerable.call(f,m))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(f,m);if(i.value!==b||i.enumerable!==!0)return!1}return!0}},{}],22:[function(v,D,u){u.read=function(p,f,m,h,b){var t,i,n=b*8-h-1,o=(1<<n)-1,w=o>>1,g=-7,l=m?b-1:0,e=m?-1:1,d=p[f+l];for(l+=e,t=d&(1<<-g)-1,d>>=-g,g+=n;g>0;t=t*256+p[f+l],l+=e,g-=8);for(i=t&(1<<-g)-1,t>>=-g,g+=h;g>0;i=i*256+p[f+l],l+=e,g-=8);if(t===0)t=1-w;else{if(t===o)return i?NaN:(d?-1:1)*Infinity;i=i+Math.pow(2,h),t=t-w}return(d?-1:1)*i*Math.pow(2,t-h)},u.write=function(p,f,m,h,b,t){var i,n,o,w=t*8-b-1,g=(1<<w)-1,l=g>>1,e=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=h?0:t-1,y=h?1:-1,A=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===Infinity?(n=isNaN(f)?1:0,i=g):(i=Math.floor(Math.log(f)/Math.LN2),f*(o=Math.pow(2,-i))<1&&(i--,o*=2),i+l>=1?f+=e/o:f+=e*Math.pow(2,1-l),f*o>=2&&(i++,o/=2),i+l>=g?(n=0,i=g):i+l>=1?(n=(f*o-1)*Math.pow(2,b),i=i+l):(n=f*Math.pow(2,l-1)*Math.pow(2,b),i=0));b>=8;p[m+d]=n&255,d+=y,n/=256,b-=8);for(i=i<<b|n,w+=b;w>0;p[m+d]=i&255,d+=y,i/=256,w-=8);p[m+d-y]|=A*128}},{}],23:[function(v,D,u){typeof Object.create=="function"?D.exports=function(f,m){m&&(f.super_=m,f.prototype=Object.create(m.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}))}:D.exports=function(f,m){if(m){f.super_=m;var h=function(){};h.prototype=m.prototype,f.prototype=new h,f.prototype.constructor=f}}},{}],24:[function(v,D,u){"use strict";var p=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",f=Object.prototype.toString,m=function(i){return p&&i&&typeof i=="object"&&Symbol.toStringTag in i?!1:f.call(i)==="[object Arguments]"},h=function(i){return m(i)?!0:i!==null&&typeof i=="object"&&typeof i.length=="number"&&i.length>=0&&f.call(i)!=="[object Array]"&&f.call(i.callee)==="[object Function]"},b=function(){return m(arguments)}();m.isLegacyArguments=h,D.exports=b?m:h},{}],25:[function(v,D,u){"use strict";var p=Object.prototype.toString,f=Function.prototype.toString,m=/^\s*(?:function)?\*/,h=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",b=Object.getPrototypeOf,t=function(){if(!h)return!1;try{return Function("return function*() {}")()}catch(o){}},i=t(),n=i?b(i):{};D.exports=function(w){if(typeof w!="function")return!1;if(m.test(f.call(w)))return!0;if(!h){var g=p.call(w);return g==="[object GeneratorFunction]"}return b(w)===n}},{}],26:[function(v,D,u){(function(p){(function(){"use strict";var f=v("foreach"),m=v("available-typed-arrays"),h=v("es-abstract/helpers/callBound"),b=h("Object.prototype.toString"),t=v("has-symbols")(),i=t&&typeof Symbol.toStringTag=="symbol",n=m(),o=h("Array.prototype.indexOf",!0)||function(A,E){for(var T=0;T<A.length;T+=1)if(A[T]===E)return T;return-1},w=h("String.prototype.slice"),g={},l=v("es-abstract/helpers/getOwnPropertyDescriptor"),e=Object.getPrototypeOf;i&&l&&e&&f(n,function(y){var A=new p[y];if(!(Symbol.toStringTag in A))throw new EvalError("this engine has support for Symbol.toStringTag, but "+y+" does not have the property! Please report this.");var E=e(A),T=l(E,Symbol.toStringTag);if(!T){var _=e(E);T=l(_,Symbol.toStringTag)}g[y]=T.get});var d=function(A){var E=!1;return f(g,function(T,_){if(!E)try{E=T.call(A)===_}catch(S){}}),E};D.exports=function(A){if(!A||typeof A!="object")return!1;if(!i){var E=w(b(A),8,-1);return o(n,E)>-1}return l?d(A):!1}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"available-typed-arrays":6,"es-abstract/helpers/callBound":14,"es-abstract/helpers/getOwnPropertyDescriptor":15,foreach:17,"has-symbols":20}],27:[function(v,D,u){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/"use strict";var p=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable;function h(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function b(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var i={},n=0;n<10;n++)i["_"+String.fromCharCode(n)]=n;var o=Object.getOwnPropertyNames(i).map(function(g){return i[g]});if(o.join("")!=="0123456789")return!1;var w={};return"abcdefghijklmnopqrst".split("").forEach(function(g){w[g]=g}),!(Object.keys(Object.assign({},w)).join("")!=="abcdefghijklmnopqrst")}catch(g){return!1}}D.exports=b()?Object.assign:function(t,i){for(var n,o=h(t),w,g=1;g<arguments.length;g++){n=Object(arguments[g]);for(var l in n)f.call(n,l)&&(o[l]=n[l]);if(p){w=p(n);for(var e=0;e<w.length;e++)m.call(n,w[e])&&(o[w[e]]=n[w[e]])}}return o}},{}],28:[function(v,D,u){"use strict";var p=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function f(b,t){return Object.prototype.hasOwnProperty.call(b,t)}u.assign=function(b){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(!i)continue;if(typeof i!="object")throw new TypeError(i+"must be non-object");for(var n in i)f(i,n)&&(b[n]=i[n])}return b},u.shrinkBuf=function(b,t){return b.length===t?b:b.subarray?b.subarray(0,t):(b.length=t,b)};var m={arraySet:function(b,t,i,n,o){if(t.subarray&&b.subarray){b.set(t.subarray(i,i+n),o);return}for(var w=0;w<n;w++)b[o+w]=t[i+w]},flattenChunks:function(b){var t,i,n,o,w,g;for(n=0,t=0,i=b.length;t<i;t++)n+=b[t].length;for(g=new Uint8Array(n),o=0,t=0,i=b.length;t<i;t++)w=b[t],g.set(w,o),o+=w.length;return g}},h={arraySet:function(b,t,i,n,o){for(var w=0;w<n;w++)b[o+w]=t[i+w]},flattenChunks:function(b){return[].concat.apply([],b)}};u.setTyped=function(b){b?(u.Buf8=Uint8Array,u.Buf16=Uint16Array,u.Buf32=Int32Array,u.assign(u,m)):(u.Buf8=Array,u.Buf16=Array,u.Buf32=Array,u.assign(u,h))},u.setTyped(p)},{}],29:[function(v,D,u){"use strict";function p(f,m,h,b){for(var t=f&65535|0,i=f>>>16&65535|0,n=0;h!==0;){n=h>2e3?2e3:h,h-=n;do t=t+m[b++]|0,i=i+t|0;while(--n);t%=65521,i%=65521}return t|i<<16|0}D.exports=p},{}],30:[function(v,D,u){"use strict";D.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(v,D,u){"use strict";function p(){for(var h,b=[],t=0;t<256;t++){h=t;for(var i=0;i<8;i++)h=h&1?3988292384^h>>>1:h>>>1;b[t]=h}return b}var f=p();function m(h,b,t,i){var n=f,o=i+t;h^=-1;for(var w=i;w<o;w++)h=h>>>8^n[(h^b[w])&255];return h^-1}D.exports=m},{}],32:[function(v,D,u){"use strict";var p=v("../utils/common"),f=v("./trees"),m=v("./adler32"),h=v("./crc32"),b=v("./messages"),t=0,i=1,n=3,o=4,w=5,g=0,l=1,e=-2,d=-3,y=-5,A=-1,E=1,T=2,_=3,S=4,N=0,L=2,H=8,P=9,K=15,te=8,se=29,B=256,k=B+1+se,F=30,$=19,oe=2*k+1,Ee=15,he=3,W=258,V=W+he+1,Q=32,be=42,Z=69,Y=73,q=91,ue=103,ce=113,ye=666,me=1,M=2,j=3,ie=4,pe=3;function ve(a,J){return a.msg=b[J],J}function C(a){return(a<<1)-(a>4?9:0)}function c(a){for(var J=a.length;--J>=0;)a[J]=0}function s(a){var J=a.state,ee=J.pending;if(ee>a.avail_out&&(ee=a.avail_out),ee===0)return;p.arraySet(a.output,J.pending_buf,J.pending_out,ee,a.next_out),a.next_out+=ee,J.pending_out+=ee,a.total_out+=ee,a.avail_out-=ee,J.pending-=ee,J.pending===0&&(J.pending_out=0)}function r(a,J){f._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,J),a.block_start=a.strstart,s(a.strm)}function R(a,J){a.pending_buf[a.pending++]=J}function z(a,J){a.pending_buf[a.pending++]=J>>>8&255,a.pending_buf[a.pending++]=J&255}function re(a,J,ee,O){var U=a.avail_in;return U>O&&(U=O),U===0?0:(a.avail_in-=U,p.arraySet(J,a.input,a.next_in,U,ee),a.state.wrap===1?a.adler=m(a.adler,J,U,ee):a.state.wrap===2&&(a.adler=h(a.adler,J,U,ee)),a.next_in+=U,a.total_in+=U,U)}function ae(a,J){var ee=a.max_chain_length,O=a.strstart,U,X,Te=a.prev_length,ge=a.nice_match,_e=a.strstart>a.w_size-V?a.strstart-(a.w_size-V):0,Oe=a.window,Ze=a.w_mask,Ce=a.prev,xe=a.strstart+W,Be=Oe[O+Te-1],Pe=Oe[O+Te];a.prev_length>=a.good_match&&(ee>>=2),ge>a.lookahead&&(ge=a.lookahead);do{if(U=J,Oe[U+Te]!==Pe||Oe[U+Te-1]!==Be||Oe[U]!==Oe[O]||Oe[++U]!==Oe[O+1])continue;O+=2,U++;do;while(Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&Oe[++O]===Oe[++U]&&O<xe);if(X=W-(xe-O),O=xe-W,X>Te){if(a.match_start=J,Te=X,X>=ge)break;Be=Oe[O+Te-1],Pe=Oe[O+Te]}}while((J=Ce[J&Ze])>_e&&--ee!==0);return Te<=a.lookahead?Te:a.lookahead}function Se(a){var J=a.w_size,ee,O,U,X,Te;do{if(X=a.window_size-a.lookahead-a.strstart,a.strstart>=J+(J-V)){p.arraySet(a.window,a.window,J,J,0),a.match_start-=J,a.strstart-=J,a.block_start-=J,O=a.hash_size,ee=O;do U=a.head[--ee],a.head[ee]=U>=J?U-J:0;while(--O);O=J,ee=O;do U=a.prev[--ee],a.prev[ee]=U>=J?U-J:0;while(--O);X+=J}if(a.strm.avail_in===0)break;if(O=re(a.strm,a.window,a.strstart+a.lookahead,X),a.lookahead+=O,a.lookahead+a.insert>=he)for(Te=a.strstart-a.insert,a.ins_h=a.window[Te],a.ins_h=(a.ins_h<<a.hash_shift^a.window[Te+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[Te+he-1])&a.hash_mask,a.prev[Te&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=Te,Te++,a.insert--,a.lookahead+a.insert<he););}while(a.lookahead<V&&a.strm.avail_in!==0)}function ke(a,J){var ee=65535;for(ee>a.pending_buf_size-5&&(ee=a.pending_buf_size-5);;){if(a.lookahead<=1){if(Se(a),a.lookahead===0&&J===t)return me;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var O=a.block_start+ee;if((a.strstart===0||a.strstart>=O)&&(a.lookahead=a.strstart-O,a.strstart=O,r(a,!1),a.strm.avail_out===0))return me;if(a.strstart-a.block_start>=a.w_size-V&&(r(a,!1),a.strm.avail_out===0))return me}return a.insert=0,J===o?(r(a,!0),a.strm.avail_out===0?j:ie):(a.strstart>a.block_start&&(r(a,!1),a.strm.avail_out===0),me)}function Ie(a,J){for(var ee,O;;){if(a.lookahead<V){if(Se(a),a.lookahead<V&&J===t)return me;if(a.lookahead===0)break}if(ee=0,a.lookahead>=he&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+he-1])&a.hash_mask,ee=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),ee!==0&&a.strstart-ee<=a.w_size-V&&(a.match_length=ae(a,ee)),a.match_length>=he)if(O=f._tr_tally(a,a.strstart-a.match_start,a.match_length-he),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=he){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+he-1])&a.hash_mask,ee=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else O=f._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(O&&(r(a,!1),a.strm.avail_out===0))return me}return a.insert=a.strstart<he-1?a.strstart:he-1,J===o?(r(a,!0),a.strm.avail_out===0?j:ie):a.last_lit&&(r(a,!1),a.strm.avail_out===0)?me:M}function Ne(a,J){for(var ee,O,U;;){if(a.lookahead<V){if(Se(a),a.lookahead<V&&J===t)return me;if(a.lookahead===0)break}if(ee=0,a.lookahead>=he&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+he-1])&a.hash_mask,ee=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=he-1,ee!==0&&a.prev_length<a.max_lazy_match&&a.strstart-ee<=a.w_size-V&&(a.match_length=ae(a,ee),a.match_length<=5&&(a.strategy===E||a.match_length===he&&a.strstart-a.match_start>4096)&&(a.match_length=he-1)),a.prev_length>=he&&a.match_length<=a.prev_length){U=a.strstart+a.lookahead-he,O=f._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-he),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=U&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+he-1])&a.hash_mask,ee=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);if(a.match_available=0,a.match_length=he-1,a.strstart++,O&&(r(a,!1),a.strm.avail_out===0))return me}else if(a.match_available){if(O=f._tr_tally(a,0,a.window[a.strstart-1]),O&&r(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return me}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(O=f._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<he-1?a.strstart:he-1,J===o?(r(a,!0),a.strm.avail_out===0?j:ie):a.last_lit&&(r(a,!1),a.strm.avail_out===0)?me:M}function Re(a,J){for(var ee,O,U,X,Te=a.window;;){if(a.lookahead<=W){if(Se(a),a.lookahead<=W&&J===t)return me;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=he&&a.strstart>0&&(U=a.strstart-1,O=Te[U],O===Te[++U]&&O===Te[++U]&&O===Te[++U])){X=a.strstart+W;do;while(O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&O===Te[++U]&&U<X);a.match_length=W-(X-U),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=he?(ee=f._tr_tally(a,1,a.match_length-he),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(ee=f._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),ee&&(r(a,!1),a.strm.avail_out===0))return me}return a.insert=0,J===o?(r(a,!0),a.strm.avail_out===0?j:ie):a.last_lit&&(r(a,!1),a.strm.avail_out===0)?me:M}function Ue(a,J){for(var ee;;){if(a.lookahead===0&&(Se(a),a.lookahead===0)){if(J===t)return me;break}if(a.match_length=0,ee=f._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,ee&&(r(a,!1),a.strm.avail_out===0))return me}return a.insert=0,J===o?(r(a,!0),a.strm.avail_out===0?j:ie):a.last_lit&&(r(a,!1),a.strm.avail_out===0)?me:M}function Le(a,J,ee,O,U){this.good_length=a,this.max_lazy=J,this.nice_length=ee,this.max_chain=O,this.func=U}var De;De=[new Le(0,0,0,0,ke),new Le(4,4,8,4,Ie),new Le(4,5,16,8,Ie),new Le(4,6,32,32,Ie),new Le(4,4,16,16,Ne),new Le(8,16,32,32,Ne),new Le(8,16,128,128,Ne),new Le(8,32,128,256,Ne),new Le(32,128,258,1024,Ne),new Le(32,258,258,4096,Ne)];function je(a){a.window_size=2*a.w_size,c(a.head),a.max_lazy_match=De[a.level].max_lazy,a.good_match=De[a.level].good_length,a.nice_match=De[a.level].nice_length,a.max_chain_length=De[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=he-1,a.match_available=0,a.ins_h=0}function x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=H,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new p.Buf16(oe*2),this.dyn_dtree=new p.Buf16((2*F+1)*2),this.bl_tree=new p.Buf16((2*$+1)*2),c(this.dyn_ltree),c(this.dyn_dtree),c(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new p.Buf16(Ee+1),this.heap=new p.Buf16(2*k+1),c(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new p.Buf16(2*k+1),c(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function le(a){var J;return!a||!a.state?ve(a,e):(a.total_in=a.total_out=0,a.data_type=L,J=a.state,J.pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap?be:ce,a.adler=J.wrap===2?0:1,J.last_flush=t,f._tr_init(J),g)}function de(a){var J=le(a);return J===g&&je(a.state),J}function we(a,J){return!a||!a.state||a.state.wrap!==2?e:(a.state.gzhead=J,g)}function G(a,J,ee,O,U,X){if(!a)return e;var Te=1;if(J===A&&(J=6),O<0?(Te=0,O=-O):O>15&&(Te=2,O-=16),U<1||U>P||ee!==H||O<8||O>15||J<0||J>9||X<0||X>S)return ve(a,e);O===8&&(O=9);var ge=new x;return a.state=ge,ge.strm=a,ge.wrap=Te,ge.gzhead=null,ge.w_bits=O,ge.w_size=1<<ge.w_bits,ge.w_mask=ge.w_size-1,ge.hash_bits=U+7,ge.hash_size=1<<ge.hash_bits,ge.hash_mask=ge.hash_size-1,ge.hash_shift=~~((ge.hash_bits+he-1)/he),ge.window=new p.Buf8(ge.w_size*2),ge.head=new p.Buf16(ge.hash_size),ge.prev=new p.Buf16(ge.w_size),ge.lit_bufsize=1<<U+6,ge.pending_buf_size=ge.lit_bufsize*4,ge.pending_buf=new p.Buf8(ge.pending_buf_size),ge.d_buf=1*ge.lit_bufsize,ge.l_buf=(1+2)*ge.lit_bufsize,ge.level=J,ge.strategy=X,ge.method=ee,de(a)}function ne(a,J){return G(a,J,H,K,te,N)}function I(a,J){var ee,O,U,X;if(!a||!a.state||J>w||J<0)return a?ve(a,e):e;if(O=a.state,!a.output||!a.input&&a.avail_in!==0||O.status===ye&&J!==o)return ve(a,a.avail_out===0?y:e);if(O.strm=a,ee=O.last_flush,O.last_flush=J,O.status===be)if(O.wrap===2)a.adler=0,R(O,31),R(O,139),R(O,8),O.gzhead?(R(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),R(O,O.gzhead.time&255),R(O,O.gzhead.time>>8&255),R(O,O.gzhead.time>>16&255),R(O,O.gzhead.time>>24&255),R(O,O.level===9?2:O.strategy>=T||O.level<2?4:0),R(O,O.gzhead.os&255),O.gzhead.extra&&O.gzhead.extra.length&&(R(O,O.gzhead.extra.length&255),R(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(a.adler=h(a.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=Z):(R(O,0),R(O,0),R(O,0),R(O,0),R(O,0),R(O,O.level===9?2:O.strategy>=T||O.level<2?4:0),R(O,pe),O.status=ce);else{var Te=H+(O.w_bits-8<<4)<<8,ge=-1;O.strategy>=T||O.level<2?ge=0:O.level<6?ge=1:O.level===6?ge=2:ge=3,Te|=ge<<6,O.strstart!==0&&(Te|=Q),Te+=31-Te%31,O.status=ce,z(O,Te),O.strstart!==0&&(z(O,a.adler>>>16),z(O,a.adler&65535)),a.adler=1}if(O.status===Z)if(O.gzhead.extra){for(U=O.pending;O.gzindex<(O.gzhead.extra.length&65535)&&!(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),s(a),U=O.pending,O.pending===O.pending_buf_size));)R(O,O.gzhead.extra[O.gzindex]&255),O.gzindex++;O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=Y)}else O.status=Y;if(O.status===Y)if(O.gzhead.name){U=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),s(a),U=O.pending,O.pending===O.pending_buf_size)){X=1;break}O.gzindex<O.gzhead.name.length?X=O.gzhead.name.charCodeAt(O.gzindex++)&255:X=0,R(O,X)}while(X!==0);O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),X===0&&(O.gzindex=0,O.status=q)}else O.status=q;if(O.status===q)if(O.gzhead.comment){U=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),s(a),U=O.pending,O.pending===O.pending_buf_size)){X=1;break}O.gzindex<O.gzhead.comment.length?X=O.gzhead.comment.charCodeAt(O.gzindex++)&255:X=0,R(O,X)}while(X!==0);O.gzhead.hcrc&&O.pending>U&&(a.adler=h(a.adler,O.pending_buf,O.pending-U,U)),X===0&&(O.status=ue)}else O.status=ue;if(O.status===ue&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&s(a),O.pending+2<=O.pending_buf_size&&(R(O,a.adler&255),R(O,a.adler>>8&255),a.adler=0,O.status=ce)):O.status=ce),O.pending!==0){if(s(a),a.avail_out===0)return O.last_flush=-1,g}else if(a.avail_in===0&&C(J)<=C(ee)&&J!==o)return ve(a,y);if(O.status===ye&&a.avail_in!==0)return ve(a,y);if(a.avail_in!==0||O.lookahead!==0||J!==t&&O.status!==ye){var _e=O.strategy===T?Ue(O,J):O.strategy===_?Re(O,J):De[O.level].func(O,J);if((_e===j||_e===ie)&&(O.status=ye),_e===me||_e===j)return a.avail_out===0&&(O.last_flush=-1),g;if(_e===M&&(J===i?f._tr_align(O):J!==w&&(f._tr_stored_block(O,0,0,!1),J===n&&(c(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),s(a),a.avail_out===0))return O.last_flush=-1,g}return J!==o?g:O.wrap<=0?l:(O.wrap===2?(R(O,a.adler&255),R(O,a.adler>>8&255),R(O,a.adler>>16&255),R(O,a.adler>>24&255),R(O,a.total_in&255),R(O,a.total_in>>8&255),R(O,a.total_in>>16&255),R(O,a.total_in>>24&255)):(z(O,a.adler>>>16),z(O,a.adler&65535)),s(a),O.wrap>0&&(O.wrap=-O.wrap),O.pending!==0?g:l)}function fe(a){var J;return!a||!a.state?e:(J=a.state.status,J!==be&&J!==Z&&J!==Y&&J!==q&&J!==ue&&J!==ce&&J!==ye?ve(a,e):(a.state=null,J===ce?ve(a,d):g))}function Ae(a,J){var ee=J.length,O,U,X,Te,ge,_e,Oe,Ze;if(!a||!a.state)return e;if(O=a.state,Te=O.wrap,Te===2||Te===1&&O.status!==be||O.lookahead)return e;for(Te===1&&(a.adler=m(a.adler,J,ee,0)),O.wrap=0,ee>=O.w_size&&(Te===0&&(c(O.head),O.strstart=0,O.block_start=0,O.insert=0),Ze=new p.Buf8(O.w_size),p.arraySet(Ze,J,ee-O.w_size,O.w_size,0),J=Ze,ee=O.w_size),ge=a.avail_in,_e=a.next_in,Oe=a.input,a.avail_in=ee,a.next_in=0,a.input=J,Se(O);O.lookahead>=he;){U=O.strstart,X=O.lookahead-(he-1);do O.ins_h=(O.ins_h<<O.hash_shift^O.window[U+he-1])&O.hash_mask,O.prev[U&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=U,U++;while(--X);O.strstart=U,O.lookahead=he-1,Se(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=he-1,O.match_available=0,a.next_in=_e,a.input=Oe,a.avail_in=ge,O.wrap=Te,g}u.deflateInit=ne,u.deflateInit2=G,u.deflateReset=de,u.deflateResetKeep=le,u.deflateSetHeader=we,u.deflate=I,u.deflateEnd=fe,u.deflateSetDictionary=Ae,u.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":28,"./adler32":29,"./crc32":31,"./messages":36,"./trees":37}],33:[function(v,D,u){"use strict";var p=30,f=12;D.exports=function(h,b){var t,i,n,o,w,g,l,e,d,y,A,E,T,_,S,N,L,H,P,K,te,se,B,k,F;t=h.state,i=h.next_in,k=h.input,n=i+(h.avail_in-5),o=h.next_out,F=h.output,w=o-(b-h.avail_out),g=o+(h.avail_out-257),l=t.dmax,e=t.wsize,d=t.whave,y=t.wnext,A=t.window,E=t.hold,T=t.bits,_=t.lencode,S=t.distcode,N=(1<<t.lenbits)-1,L=(1<<t.distbits)-1;e:do{T<15&&(E+=k[i++]<<T,T+=8,E+=k[i++]<<T,T+=8),H=_[E&N];t:for(;;){if(P=H>>>24,E>>>=P,T-=P,P=H>>>16&255,P===0)F[o++]=H&65535;else if(P&16){K=H&65535,P&=15,P&&(T<P&&(E+=k[i++]<<T,T+=8),K+=E&(1<<P)-1,E>>>=P,T-=P),T<15&&(E+=k[i++]<<T,T+=8,E+=k[i++]<<T,T+=8),H=S[E&L];r:for(;;){if(P=H>>>24,E>>>=P,T-=P,P=H>>>16&255,P&16){if(te=H&65535,P&=15,T<P&&(E+=k[i++]<<T,T+=8,T<P&&(E+=k[i++]<<T,T+=8)),te+=E&(1<<P)-1,te>l){h.msg="invalid distance too far back",t.mode=p;break e}if(E>>>=P,T-=P,P=o-w,te>P){if(P=te-P,P>d&&t.sane){h.msg="invalid distance too far back",t.mode=p;break e}if(se=0,B=A,y===0){if(se+=e-P,P<K){K-=P;do F[o++]=A[se++];while(--P);se=o-te,B=F}}else if(y<P){if(se+=e+y-P,P-=y,P<K){K-=P;do F[o++]=A[se++];while(--P);if(se=0,y<K){P=y,K-=P;do F[o++]=A[se++];while(--P);se=o-te,B=F}}}else if(se+=y-P,P<K){K-=P;do F[o++]=A[se++];while(--P);se=o-te,B=F}for(;K>2;)F[o++]=B[se++],F[o++]=B[se++],F[o++]=B[se++],K-=3;K&&(F[o++]=B[se++],K>1&&(F[o++]=B[se++]))}else{se=o-te;do F[o++]=F[se++],F[o++]=F[se++],F[o++]=F[se++],K-=3;while(K>2);K&&(F[o++]=F[se++],K>1&&(F[o++]=F[se++]))}}else if((P&64)===0){H=S[(H&65535)+(E&(1<<P)-1)];continue r}else{h.msg="invalid distance code",t.mode=p;break e}break}}else if((P&64)===0){H=_[(H&65535)+(E&(1<<P)-1)];continue t}else if(P&32){t.mode=f;break e}else{h.msg="invalid literal/length code",t.mode=p;break e}break}}while(i<n&&o<g);K=T>>3,i-=K,T-=K<<3,E&=(1<<T)-1,h.next_in=i,h.next_out=o,h.avail_in=i<n?5+(n-i):5-(i-n),h.avail_out=o<g?257+(g-o):257-(o-g),t.hold=E,t.bits=T;return}},{}],34:[function(v,D,u){"use strict";var p=v("../utils/common"),f=v("./adler32"),m=v("./crc32"),h=v("./inffast"),b=v("./inftrees"),t=0,i=1,n=2,o=4,w=5,g=6,l=0,e=1,d=2,y=-2,A=-3,E=-4,T=-5,_=8,S=1,N=2,L=3,H=4,P=5,K=6,te=7,se=8,B=9,k=10,F=11,$=12,oe=13,Ee=14,he=15,W=16,V=17,Q=18,be=19,Z=20,Y=21,q=22,ue=23,ce=24,ye=25,me=26,M=27,j=28,ie=29,pe=30,ve=31,C=32,c=852,s=592,r=15,R=r;function z(G){return(G>>>24&255)+(G>>>8&65280)+((G&65280)<<8)+((G&255)<<24)}function re(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new p.Buf16(320),this.work=new p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(G){var ne;return!G||!G.state?y:(ne=G.state,G.total_in=G.total_out=ne.total=0,G.msg="",ne.wrap&&(G.adler=ne.wrap&1),ne.mode=S,ne.last=0,ne.havedict=0,ne.dmax=32768,ne.head=null,ne.hold=0,ne.bits=0,ne.lencode=ne.lendyn=new p.Buf32(c),ne.distcode=ne.distdyn=new p.Buf32(s),ne.sane=1,ne.back=-1,l)}function Se(G){var ne;return!G||!G.state?y:(ne=G.state,ne.wsize=0,ne.whave=0,ne.wnext=0,ae(G))}function ke(G,ne){var I,fe;return!G||!G.state?y:(fe=G.state,ne<0?(I=0,ne=-ne):(I=(ne>>4)+1,ne<48&&(ne&=15)),ne&&(ne<8||ne>15)?y:(fe.window!==null&&fe.wbits!==ne&&(fe.window=null),fe.wrap=I,fe.wbits=ne,Se(G)))}function Ie(G,ne){var I,fe;return G?(fe=new re,G.state=fe,fe.window=null,I=ke(G,ne),I!==l&&(G.state=null),I):y}function Ne(G){return Ie(G,R)}var Re=!0,Ue,Le;function De(G){if(Re){var ne;for(Ue=new p.Buf32(512),Le=new p.Buf32(32),ne=0;ne<144;)G.lens[ne++]=8;for(;ne<256;)G.lens[ne++]=9;for(;ne<280;)G.lens[ne++]=7;for(;ne<288;)G.lens[ne++]=8;for(b(i,G.lens,0,288,Ue,0,G.work,{bits:9}),ne=0;ne<32;)G.lens[ne++]=5;b(n,G.lens,0,32,Le,0,G.work,{bits:5}),Re=!1}G.lencode=Ue,G.lenbits=9,G.distcode=Le,G.distbits=5}function je(G,ne,I,fe){var Ae,a=G.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new p.Buf8(a.wsize)),fe>=a.wsize?(p.arraySet(a.window,ne,I-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(Ae=a.wsize-a.wnext,Ae>fe&&(Ae=fe),p.arraySet(a.window,ne,I-fe,Ae,a.wnext),fe-=Ae,fe?(p.arraySet(a.window,ne,I-fe,fe,0),a.wnext=fe,a.whave=a.wsize):(a.wnext+=Ae,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=Ae))),0}function x(G,ne){var I,fe,Ae,a,J,ee,O,U,X,Te,ge,_e,Oe,Ze,Ce=0,xe,Be,Pe,Me,Ye,Ke,Fe,He,ze=new p.Buf8(4),Ge,We,Ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!G||!G.state||!G.output||!G.input&&G.avail_in!==0)return y;I=G.state,I.mode===$&&(I.mode=oe),J=G.next_out,Ae=G.output,O=G.avail_out,a=G.next_in,fe=G.input,ee=G.avail_in,U=I.hold,X=I.bits,Te=ee,ge=O,He=l;e:for(;;)switch(I.mode){case S:if(I.wrap===0){I.mode=oe;break}for(;X<16;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(I.wrap&2&&U===35615){I.check=0,ze[0]=U&255,ze[1]=U>>>8&255,I.check=m(I.check,ze,2,0),U=0,X=0,I.mode=N;break}if(I.flags=0,I.head&&(I.head.done=!1),!(I.wrap&1)||(((U&255)<<8)+(U>>8))%31){G.msg="incorrect header check",I.mode=pe;break}if((U&15)!==_){G.msg="unknown compression method",I.mode=pe;break}if(U>>>=4,X-=4,Fe=(U&15)+8,I.wbits===0)I.wbits=Fe;else if(Fe>I.wbits){G.msg="invalid window size",I.mode=pe;break}I.dmax=1<<Fe,G.adler=I.check=1,I.mode=U&512?k:$,U=0,X=0;break;case N:for(;X<16;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(I.flags=U,(I.flags&255)!==_){G.msg="unknown compression method",I.mode=pe;break}if(I.flags&57344){G.msg="unknown header flags set",I.mode=pe;break}I.head&&(I.head.text=U>>8&1),I.flags&512&&(ze[0]=U&255,ze[1]=U>>>8&255,I.check=m(I.check,ze,2,0)),U=0,X=0,I.mode=L;case L:for(;X<32;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.head&&(I.head.time=U),I.flags&512&&(ze[0]=U&255,ze[1]=U>>>8&255,ze[2]=U>>>16&255,ze[3]=U>>>24&255,I.check=m(I.check,ze,4,0)),U=0,X=0,I.mode=H;case H:for(;X<16;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.head&&(I.head.xflags=U&255,I.head.os=U>>8),I.flags&512&&(ze[0]=U&255,ze[1]=U>>>8&255,I.check=m(I.check,ze,2,0)),U=0,X=0,I.mode=P;case P:if(I.flags&1024){for(;X<16;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.length=U,I.head&&(I.head.extra_len=U),I.flags&512&&(ze[0]=U&255,ze[1]=U>>>8&255,I.check=m(I.check,ze,2,0)),U=0,X=0}else I.head&&(I.head.extra=null);I.mode=K;case K:if(I.flags&1024&&(_e=I.length,_e>ee&&(_e=ee),_e&&(I.head&&(Fe=I.head.extra_len-I.length,I.head.extra||(I.head.extra=new Array(I.head.extra_len)),p.arraySet(I.head.extra,fe,a,_e,Fe)),I.flags&512&&(I.check=m(I.check,fe,_e,a)),ee-=_e,a+=_e,I.length-=_e),I.length))break e;I.length=0,I.mode=te;case te:if(I.flags&2048){if(ee===0)break e;_e=0;do Fe=fe[a+_e++],I.head&&Fe&&I.length<65536&&(I.head.name+=String.fromCharCode(Fe));while(Fe&&_e<ee);if(I.flags&512&&(I.check=m(I.check,fe,_e,a)),ee-=_e,a+=_e,Fe)break e}else I.head&&(I.head.name=null);I.length=0,I.mode=se;case se:if(I.flags&4096){if(ee===0)break e;_e=0;do Fe=fe[a+_e++],I.head&&Fe&&I.length<65536&&(I.head.comment+=String.fromCharCode(Fe));while(Fe&&_e<ee);if(I.flags&512&&(I.check=m(I.check,fe,_e,a)),ee-=_e,a+=_e,Fe)break e}else I.head&&(I.head.comment=null);I.mode=B;case B:if(I.flags&512){for(;X<16;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(U!==(I.check&65535)){G.msg="header crc mismatch",I.mode=pe;break}U=0,X=0}I.head&&(I.head.hcrc=I.flags>>9&1,I.head.done=!0),G.adler=I.check=0,I.mode=$;break;case k:for(;X<32;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}G.adler=I.check=z(U),U=0,X=0,I.mode=F;case F:if(I.havedict===0)return G.next_out=J,G.avail_out=O,G.next_in=a,G.avail_in=ee,I.hold=U,I.bits=X,d;G.adler=I.check=1,I.mode=$;case $:if(ne===w||ne===g)break e;case oe:if(I.last){U>>>=X&7,X-=X&7,I.mode=M;break}for(;X<3;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.last=U&1,U>>>=1,X-=1;switch(U&3){case 0:I.mode=Ee;break;case 1:if(De(I),I.mode=Z,ne===g){U>>>=2,X-=2;break e}break;case 2:I.mode=V;break;case 3:G.msg="invalid block type",I.mode=pe}U>>>=2,X-=2;break;case Ee:for(U>>>=X&7,X-=X&7;X<32;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if((U&65535)!==(U>>>16^65535)){G.msg="invalid stored block lengths",I.mode=pe;break}if(I.length=U&65535,U=0,X=0,I.mode=he,ne===g)break e;case he:I.mode=W;case W:if(_e=I.length,_e){if(_e>ee&&(_e=ee),_e>O&&(_e=O),_e===0)break e;p.arraySet(Ae,fe,a,_e,J),ee-=_e,a+=_e,O-=_e,J+=_e,I.length-=_e;break}I.mode=$;break;case V:for(;X<14;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(I.nlen=(U&31)+257,U>>>=5,X-=5,I.ndist=(U&31)+1,U>>>=5,X-=5,I.ncode=(U&15)+4,U>>>=4,X-=4,I.nlen>286||I.ndist>30){G.msg="too many length or distance symbols",I.mode=pe;break}I.have=0,I.mode=Q;case Q:for(;I.have<I.ncode;){for(;X<3;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.lens[Ve[I.have++]]=U&7,U>>>=3,X-=3}for(;I.have<19;)I.lens[Ve[I.have++]]=0;if(I.lencode=I.lendyn,I.lenbits=7,Ge={bits:I.lenbits},He=b(t,I.lens,0,19,I.lencode,0,I.work,Ge),I.lenbits=Ge.bits,He){G.msg="invalid code lengths set",I.mode=pe;break}I.have=0,I.mode=be;case be:for(;I.have<I.nlen+I.ndist;){for(;!(Ce=I.lencode[U&(1<<I.lenbits)-1],xe=Ce>>>24,Be=Ce>>>16&255,Pe=Ce&65535,xe<=X);){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(Pe<16)U>>>=xe,X-=xe,I.lens[I.have++]=Pe;else{if(Pe===16){for(We=xe+2;X<We;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(U>>>=xe,X-=xe,I.have===0){G.msg="invalid bit length repeat",I.mode=pe;break}Fe=I.lens[I.have-1],_e=3+(U&3),U>>>=2,X-=2}else if(Pe===17){for(We=xe+3;X<We;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}U>>>=xe,X-=xe,Fe=0,_e=3+(U&7),U>>>=3,X-=3}else{for(We=xe+7;X<We;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}U>>>=xe,X-=xe,Fe=0,_e=11+(U&127),U>>>=7,X-=7}if(I.have+_e>I.nlen+I.ndist){G.msg="invalid bit length repeat",I.mode=pe;break}for(;_e--;)I.lens[I.have++]=Fe}}if(I.mode===pe)break;if(I.lens[256]===0){G.msg="invalid code -- missing end-of-block",I.mode=pe;break}if(I.lenbits=9,Ge={bits:I.lenbits},He=b(i,I.lens,0,I.nlen,I.lencode,0,I.work,Ge),I.lenbits=Ge.bits,He){G.msg="invalid literal/lengths set",I.mode=pe;break}if(I.distbits=6,I.distcode=I.distdyn,Ge={bits:I.distbits},He=b(n,I.lens,I.nlen,I.ndist,I.distcode,0,I.work,Ge),I.distbits=Ge.bits,He){G.msg="invalid distances set",I.mode=pe;break}if(I.mode=Z,ne===g)break e;case Z:I.mode=Y;case Y:if(ee>=6&&O>=258){G.next_out=J,G.avail_out=O,G.next_in=a,G.avail_in=ee,I.hold=U,I.bits=X,h(G,ge),J=G.next_out,Ae=G.output,O=G.avail_out,a=G.next_in,fe=G.input,ee=G.avail_in,U=I.hold,X=I.bits,I.mode===$&&(I.back=-1);break}for(I.back=0;!(Ce=I.lencode[U&(1<<I.lenbits)-1],xe=Ce>>>24,Be=Ce>>>16&255,Pe=Ce&65535,xe<=X);){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(Be&&(Be&240)===0){for(Me=xe,Ye=Be,Ke=Pe;!(Ce=I.lencode[Ke+((U&(1<<Me+Ye)-1)>>Me)],xe=Ce>>>24,Be=Ce>>>16&255,Pe=Ce&65535,Me+xe<=X);){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}U>>>=Me,X-=Me,I.back+=Me}if(U>>>=xe,X-=xe,I.back+=xe,I.length=Pe,Be===0){I.mode=me;break}if(Be&32){I.back=-1,I.mode=$;break}if(Be&64){G.msg="invalid literal/length code",I.mode=pe;break}I.extra=Be&15,I.mode=q;case q:if(I.extra){for(We=I.extra;X<We;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.length+=U&(1<<I.extra)-1,U>>>=I.extra,X-=I.extra,I.back+=I.extra}I.was=I.length,I.mode=ue;case ue:for(;!(Ce=I.distcode[U&(1<<I.distbits)-1],xe=Ce>>>24,Be=Ce>>>16&255,Pe=Ce&65535,xe<=X);){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if((Be&240)===0){for(Me=xe,Ye=Be,Ke=Pe;!(Ce=I.distcode[Ke+((U&(1<<Me+Ye)-1)>>Me)],xe=Ce>>>24,Be=Ce>>>16&255,Pe=Ce&65535,Me+xe<=X);){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}U>>>=Me,X-=Me,I.back+=Me}if(U>>>=xe,X-=xe,I.back+=xe,Be&64){G.msg="invalid distance code",I.mode=pe;break}I.offset=Pe,I.extra=Be&15,I.mode=ce;case ce:if(I.extra){for(We=I.extra;X<We;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}I.offset+=U&(1<<I.extra)-1,U>>>=I.extra,X-=I.extra,I.back+=I.extra}if(I.offset>I.dmax){G.msg="invalid distance too far back",I.mode=pe;break}I.mode=ye;case ye:if(O===0)break e;if(_e=ge-O,I.offset>_e){if(_e=I.offset-_e,_e>I.whave&&I.sane){G.msg="invalid distance too far back",I.mode=pe;break}_e>I.wnext?(_e-=I.wnext,Oe=I.wsize-_e):Oe=I.wnext-_e,_e>I.length&&(_e=I.length),Ze=I.window}else Ze=Ae,Oe=J-I.offset,_e=I.length;_e>O&&(_e=O),O-=_e,I.length-=_e;do Ae[J++]=Ze[Oe++];while(--_e);I.length===0&&(I.mode=Y);break;case me:if(O===0)break e;Ae[J++]=I.length,O--,I.mode=Y;break;case M:if(I.wrap){for(;X<32;){if(ee===0)break e;ee--,U|=fe[a++]<<X,X+=8}if(ge-=O,G.total_out+=ge,I.total+=ge,ge&&(G.adler=I.check=I.flags?m(I.check,Ae,ge,J-ge):f(I.check,Ae,ge,J-ge)),ge=O,(I.flags?U:z(U))!==I.check){G.msg="incorrect data check",I.mode=pe;break}U=0,X=0}I.mode=j;case j:if(I.wrap&&I.flags){for(;X<32;){if(ee===0)break e;ee--,U+=fe[a++]<<X,X+=8}if(U!==(I.total&4294967295)){G.msg="incorrect length check",I.mode=pe;break}U=0,X=0}I.mode=ie;case ie:He=e;break e;case pe:He=A;break e;case ve:return E;case C:default:return y}return G.next_out=J,G.avail_out=O,G.next_in=a,G.avail_in=ee,I.hold=U,I.bits=X,(I.wsize||ge!==G.avail_out&&I.mode<pe&&(I.mode<M||ne!==o))&&je(G,G.output,G.next_out,ge-G.avail_out)?(I.mode=ve,E):(Te-=G.avail_in,ge-=G.avail_out,G.total_in+=Te,G.total_out+=ge,I.total+=ge,I.wrap&&ge&&(G.adler=I.check=I.flags?m(I.check,Ae,ge,G.next_out-ge):f(I.check,Ae,ge,G.next_out-ge)),G.data_type=I.bits+(I.last?64:0)+(I.mode===$?128:0)+(I.mode===Z||I.mode===he?256:0),(Te===0&&ge===0||ne===o)&&He===l&&(He=T),He)}function le(G){if(!G||!G.state)return y;var ne=G.state;return ne.window&&(ne.window=null),G.state=null,l}function de(G,ne){var I;return!G||!G.state?y:(I=G.state,(I.wrap&2)===0?y:(I.head=ne,ne.done=!1,l))}function we(G,ne){var I=ne.length,fe,Ae,a;return!G||!G.state?y:(fe=G.state,fe.wrap!==0&&fe.mode!==F?y:fe.mode===F&&(Ae=1,Ae=f(Ae,ne,I,0),Ae!==fe.check)?A:(a=je(G,ne,I,I),a?(fe.mode=ve,E):(fe.havedict=1,l)))}u.inflateReset=Se,u.inflateReset2=ke,u.inflateResetKeep=ae,u.inflateInit=Ne,u.inflateInit2=Ie,u.inflate=x,u.inflateEnd=le,u.inflateGetHeader=de,u.inflateSetDictionary=we,u.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":28,"./adler32":29,"./crc32":31,"./inffast":33,"./inftrees":35}],35:[function(v,D,u){"use strict";var p=v("../utils/common"),f=15,m=852,h=592,b=0,t=1,i=2,n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],w=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];D.exports=function(e,d,y,A,E,T,_,S){var N=S.bits,L=0,H=0,P=0,K=0,te=0,se=0,B=0,k=0,F=0,$=0,oe,Ee,he,W,V,Q=null,be=0,Z,Y=new p.Buf16(f+1),q=new p.Buf16(f+1),ue=null,ce=0,ye,me,M;for(L=0;L<=f;L++)Y[L]=0;for(H=0;H<A;H++)Y[d[y+H]]++;for(te=N,K=f;K>=1&&!(Y[K]!==0);K--);if(te>K&&(te=K),K===0)return E[T++]=1<<24|64<<16|0,E[T++]=1<<24|64<<16|0,S.bits=1,0;for(P=1;P<K&&!(Y[P]!==0);P++);for(te<P&&(te=P),k=1,L=1;L<=f;L++)if(k<<=1,k-=Y[L],k<0)return-1;if(k>0&&(e===b||K!==1))return-1;for(q[1]=0,L=1;L<f;L++)q[L+1]=q[L]+Y[L];for(H=0;H<A;H++)d[y+H]!==0&&(_[q[d[y+H]]++]=H);if(e===b?(Q=ue=_,Z=19):e===t?(Q=n,be-=257,ue=o,ce-=257,Z=256):(Q=w,ue=g,Z=-1),$=0,H=0,L=P,V=T,se=te,B=0,he=-1,F=1<<te,W=F-1,e===t&&F>m||e===i&&F>h)return 1;for(;;){ye=L-B,_[H]<Z?(me=0,M=_[H]):_[H]>Z?(me=ue[ce+_[H]],M=Q[be+_[H]]):(me=32+64,M=0),oe=1<<L-B,Ee=1<<se,P=Ee;do Ee-=oe,E[V+($>>B)+Ee]=ye<<24|me<<16|M|0;while(Ee!==0);for(oe=1<<L-1;$&oe;)oe>>=1;if(oe!==0?($&=oe-1,$+=oe):$=0,H++,--Y[L]===0){if(L===K)break;L=d[y+_[H]]}if(L>te&&($&W)!==he){for(B===0&&(B=te),V+=P,se=L-B,k=1<<se;se+B<K&&!(k-=Y[se+B],k<=0);)se++,k<<=1;if(F+=1<<se,e===t&&F>m||e===i&&F>h)return 1;he=$&W,E[he]=te<<24|se<<16|V-T|0}}return $!==0&&(E[V+$]=L-B<<24|64<<16|0),S.bits=te,0}},{"../utils/common":28}],36:[function(v,D,u){"use strict";D.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],37:[function(v,D,u){"use strict";var p=v("../utils/common"),f=4,m=0,h=1,b=2;function t(x){for(var le=x.length;--le>=0;)x[le]=0}var i=0,n=1,o=2,w=3,g=258,l=29,e=256,d=e+1+l,y=30,A=19,E=2*d+1,T=15,_=16,S=7,N=256,L=16,H=17,P=18,K=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],te=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],se=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=512,F=new Array((d+2)*2);t(F);var $=new Array(y*2);t($);var oe=new Array(k);t(oe);var Ee=new Array(g-w+1);t(Ee);var he=new Array(l);t(he);var W=new Array(y);t(W);function V(x,le,de,we,G){this.static_tree=x,this.extra_bits=le,this.extra_base=de,this.elems=we,this.max_length=G,this.has_stree=x&&x.length}var Q,be,Z;function Y(x,le){this.dyn_tree=x,this.max_code=0,this.stat_desc=le}function q(x){return x<256?oe[x]:oe[256+(x>>>7)]}function ue(x,le){x.pending_buf[x.pending++]=le&255,x.pending_buf[x.pending++]=le>>>8&255}function ce(x,le,de){x.bi_valid>_-de?(x.bi_buf|=le<<x.bi_valid&65535,ue(x,x.bi_buf),x.bi_buf=le>>_-x.bi_valid,x.bi_valid+=de-_):(x.bi_buf|=le<<x.bi_valid&65535,x.bi_valid+=de)}function ye(x,le,de){ce(x,de[le*2],de[le*2+1])}function me(x,le){var de=0;do de|=x&1,x>>>=1,de<<=1;while(--le>0);return de>>>1}function M(x){x.bi_valid===16?(ue(x,x.bi_buf),x.bi_buf=0,x.bi_valid=0):x.bi_valid>=8&&(x.pending_buf[x.pending++]=x.bi_buf&255,x.bi_buf>>=8,x.bi_valid-=8)}function j(x,le){var de=le.dyn_tree,we=le.max_code,G=le.stat_desc.static_tree,ne=le.stat_desc.has_stree,I=le.stat_desc.extra_bits,fe=le.stat_desc.extra_base,Ae=le.stat_desc.max_length,a,J,ee,O,U,X,Te=0;for(O=0;O<=T;O++)x.bl_count[O]=0;for(de[x.heap[x.heap_max]*2+1]=0,a=x.heap_max+1;a<E;a++){if(J=x.heap[a],O=de[de[J*2+1]*2+1]+1,O>Ae&&(O=Ae,Te++),de[J*2+1]=O,J>we)continue;x.bl_count[O]++,U=0,J>=fe&&(U=I[J-fe]),X=de[J*2],x.opt_len+=X*(O+U),ne&&(x.static_len+=X*(G[J*2+1]+U))}if(Te===0)return;do{for(O=Ae-1;x.bl_count[O]===0;)O--;x.bl_count[O]--,x.bl_count[O+1]+=2,x.bl_count[Ae]--,Te-=2}while(Te>0);for(O=Ae;O!==0;O--)for(J=x.bl_count[O];J!==0;){if(ee=x.heap[--a],ee>we)continue;de[ee*2+1]!==O&&(x.opt_len+=(O-de[ee*2+1])*de[ee*2],de[ee*2+1]=O),J--}}function ie(x,le,de){var we=new Array(T+1),G=0,ne,I;for(ne=1;ne<=T;ne++)we[ne]=G=G+de[ne-1]<<1;for(I=0;I<=le;I++){var fe=x[I*2+1];if(fe===0)continue;x[I*2]=me(we[fe]++,fe)}}function pe(){var x,le,de,we,G,ne=new Array(T+1);for(de=0,we=0;we<l-1;we++)for(he[we]=de,x=0;x<1<<K[we];x++)Ee[de++]=we;for(Ee[de-1]=we,G=0,we=0;we<16;we++)for(W[we]=G,x=0;x<1<<te[we];x++)oe[G++]=we;for(G>>=7;we<y;we++)for(W[we]=G<<7,x=0;x<1<<te[we]-7;x++)oe[256+G++]=we;for(le=0;le<=T;le++)ne[le]=0;for(x=0;x<=143;)F[x*2+1]=8,x++,ne[8]++;for(;x<=255;)F[x*2+1]=9,x++,ne[9]++;for(;x<=279;)F[x*2+1]=7,x++,ne[7]++;for(;x<=287;)F[x*2+1]=8,x++,ne[8]++;for(ie(F,d+1,ne),x=0;x<y;x++)$[x*2+1]=5,$[x*2]=me(x,5);Q=new V(F,K,e+1,d,T),be=new V($,te,0,y,T),Z=new V(new Array(0),se,0,A,S)}function ve(x){var le;for(le=0;le<d;le++)x.dyn_ltree[le*2]=0;for(le=0;le<y;le++)x.dyn_dtree[le*2]=0;for(le=0;le<A;le++)x.bl_tree[le*2]=0;x.dyn_ltree[N*2]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function C(x){x.bi_valid>8?ue(x,x.bi_buf):x.bi_valid>0&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function c(x,le,de,we){C(x),we&&(ue(x,de),ue(x,~de)),p.arraySet(x.pending_buf,x.window,le,de,x.pending),x.pending+=de}function s(x,le,de,we){var G=le*2,ne=de*2;return x[G]<x[ne]||x[G]===x[ne]&&we[le]<=we[de]}function r(x,le,de){for(var we=x.heap[de],G=de<<1;G<=x.heap_len&&!(G<x.heap_len&&s(le,x.heap[G+1],x.heap[G],x.depth)&&G++,s(le,we,x.heap[G],x.depth));)x.heap[de]=x.heap[G],de=G,G<<=1;x.heap[de]=we}function R(x,le,de){var we,G,ne=0,I,fe;if(x.last_lit!==0)do we=x.pending_buf[x.d_buf+ne*2]<<8|x.pending_buf[x.d_buf+ne*2+1],G=x.pending_buf[x.l_buf+ne],ne++,we===0?ye(x,G,le):(I=Ee[G],ye(x,I+e+1,le),fe=K[I],fe!==0&&(G-=he[I],ce(x,G,fe)),we--,I=q(we),ye(x,I,de),fe=te[I],fe!==0&&(we-=W[I],ce(x,we,fe)));while(ne<x.last_lit);ye(x,N,le)}function z(x,le){var de=le.dyn_tree,we=le.stat_desc.static_tree,G=le.stat_desc.has_stree,ne=le.stat_desc.elems,I,fe,Ae=-1,a;for(x.heap_len=0,x.heap_max=E,I=0;I<ne;I++)de[I*2]!==0?(x.heap[++x.heap_len]=Ae=I,x.depth[I]=0):de[I*2+1]=0;for(;x.heap_len<2;)a=x.heap[++x.heap_len]=Ae<2?++Ae:0,de[a*2]=1,x.depth[a]=0,x.opt_len--,G&&(x.static_len-=we[a*2+1]);for(le.max_code=Ae,I=x.heap_len>>1;I>=1;I--)r(x,de,I);a=ne;do I=x.heap[1],x.heap[1]=x.heap[x.heap_len--],r(x,de,1),fe=x.heap[1],x.heap[--x.heap_max]=I,x.heap[--x.heap_max]=fe,de[a*2]=de[I*2]+de[fe*2],x.depth[a]=(x.depth[I]>=x.depth[fe]?x.depth[I]:x.depth[fe])+1,de[I*2+1]=de[fe*2+1]=a,x.heap[1]=a++,r(x,de,1);while(x.heap_len>=2);x.heap[--x.heap_max]=x.heap[1],j(x,le),ie(de,Ae,x.bl_count)}function re(x,le,de){var we,G=-1,ne,I=le[0*2+1],fe=0,Ae=7,a=4;for(I===0&&(Ae=138,a=3),le[(de+1)*2+1]=65535,we=0;we<=de;we++){if(ne=I,I=le[(we+1)*2+1],++fe<Ae&&ne===I)continue;fe<a?x.bl_tree[ne*2]+=fe:ne!==0?(ne!==G&&x.bl_tree[ne*2]++,x.bl_tree[L*2]++):fe<=10?x.bl_tree[H*2]++:x.bl_tree[P*2]++,fe=0,G=ne,I===0?(Ae=138,a=3):ne===I?(Ae=6,a=3):(Ae=7,a=4)}}function ae(x,le,de){var we,G=-1,ne,I=le[0*2+1],fe=0,Ae=7,a=4;for(I===0&&(Ae=138,a=3),we=0;we<=de;we++){if(ne=I,I=le[(we+1)*2+1],++fe<Ae&&ne===I)continue;if(fe<a)do ye(x,ne,x.bl_tree);while(--fe!==0);else ne!==0?(ne!==G&&(ye(x,ne,x.bl_tree),fe--),ye(x,L,x.bl_tree),ce(x,fe-3,2)):fe<=10?(ye(x,H,x.bl_tree),ce(x,fe-3,3)):(ye(x,P,x.bl_tree),ce(x,fe-11,7));fe=0,G=ne,I===0?(Ae=138,a=3):ne===I?(Ae=6,a=3):(Ae=7,a=4)}}function Se(x){var le;for(re(x,x.dyn_ltree,x.l_desc.max_code),re(x,x.dyn_dtree,x.d_desc.max_code),z(x,x.bl_desc),le=A-1;le>=3&&!(x.bl_tree[B[le]*2+1]!==0);le--);return x.opt_len+=3*(le+1)+5+5+4,le}function ke(x,le,de,we){var G;for(ce(x,le-257,5),ce(x,de-1,5),ce(x,we-4,4),G=0;G<we;G++)ce(x,x.bl_tree[B[G]*2+1],3);ae(x,x.dyn_ltree,le-1),ae(x,x.dyn_dtree,de-1)}function Ie(x){var le=4093624447,de;for(de=0;de<=31;de++,le>>>=1)if(le&1&&x.dyn_ltree[de*2]!==0)return m;if(x.dyn_ltree[9*2]!==0||x.dyn_ltree[10*2]!==0||x.dyn_ltree[13*2]!==0)return h;for(de=32;de<e;de++)if(x.dyn_ltree[de*2]!==0)return h;return m}var Ne=!1;function Re(x){Ne||(pe(),Ne=!0),x.l_desc=new Y(x.dyn_ltree,Q),x.d_desc=new Y(x.dyn_dtree,be),x.bl_desc=new Y(x.bl_tree,Z),x.bi_buf=0,x.bi_valid=0,ve(x)}function Ue(x,le,de,we){ce(x,(i<<1)+(we?1:0),3),c(x,le,de,!0)}function Le(x){ce(x,n<<1,3),ye(x,N,F),M(x)}function De(x,le,de,we){var G,ne,I=0;x.level>0?(x.strm.data_type===b&&(x.strm.data_type=Ie(x)),z(x,x.l_desc),z(x,x.d_desc),I=Se(x),G=x.opt_len+3+7>>>3,ne=x.static_len+3+7>>>3,ne<=G&&(G=ne)):G=ne=de+5,de+4<=G&&le!==-1?Ue(x,le,de,we):x.strategy===f||ne===G?(ce(x,(n<<1)+(we?1:0),3),R(x,F,$)):(ce(x,(o<<1)+(we?1:0),3),ke(x,x.l_desc.max_code+1,x.d_desc.max_code+1,I+1),R(x,x.dyn_ltree,x.dyn_dtree)),ve(x),we&&C(x)}function je(x,le,de){return x.pending_buf[x.d_buf+x.last_lit*2]=le>>>8&255,x.pending_buf[x.d_buf+x.last_lit*2+1]=le&255,x.pending_buf[x.l_buf+x.last_lit]=de&255,x.last_lit++,le===0?x.dyn_ltree[de*2]++:(x.matches++,le--,x.dyn_ltree[(Ee[de]+e+1)*2]++,x.dyn_dtree[q(le)*2]++),x.last_lit===x.lit_bufsize-1}u._tr_init=Re,u._tr_stored_block=Ue,u._tr_flush_block=De,u._tr_tally=je,u._tr_align=Le},{"../utils/common":28}],38:[function(v,D,u){"use strict";function p(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}D.exports=p},{}],39:[function(v,D,u){var p=D.exports={},f,m;function h(){throw new Error("setTimeout has not been defined")}function b(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?f=setTimeout:f=h}catch(A){f=h}try{typeof clearTimeout=="function"?m=clearTimeout:m=b}catch(A){m=b}})();function t(A){if(f===setTimeout)return setTimeout(A,0);if((f===h||!f)&&setTimeout)return f=setTimeout,setTimeout(A,0);try{return f(A,0)}catch(E){try{return f.call(null,A,0)}catch(T){return f.call(this,A,0)}}}function i(A){if(m===clearTimeout)return clearTimeout(A);if((m===b||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(A);try{return m(A)}catch(E){try{return m.call(null,A)}catch(T){return m.call(this,A)}}}var n=[],o=!1,w,g=-1;function l(){if(!o||!w)return;o=!1,w.length?n=w.concat(n):g=-1,n.length&&e()}function e(){if(o)return;var A=t(l);o=!0;for(var E=n.length;E;){for(w=n,n=[];++g<E;)w&&w[g].run();g=-1,E=n.length}w=null,o=!1,i(A)}p.nextTick=function(A){var E=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)E[T-1]=arguments[T];n.push(new d(A,E)),n.length===1&&!o&&t(e)};function d(A,E){this.fun=A,this.array=E}d.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={};function y(){}p.on=y,p.addListener=y,p.once=y,p.off=y,p.removeListener=y,p.removeAllListeners=y,p.emit=y,p.prependListener=y,p.prependOnceListener=y,p.listeners=function(A){return[]},p.binding=function(A){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(A){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],40:[function(v,D,u){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var p=v("buffer"),f=p.Buffer;function m(b,t){for(var i in b)t[i]=b[i]}f.from&&f.alloc&&f.allocUnsafe&&f.allocUnsafeSlow?D.exports=p:(m(p,u),u.Buffer=h);function h(b,t,i){return f(b,t,i)}h.prototype=Object.create(f.prototype),m(f,h),h.from=function(b,t,i){if(typeof b=="number")throw new TypeError("Argument must not be a number");return f(b,t,i)},h.alloc=function(b,t,i){if(typeof b!="number")throw new TypeError("Argument must be a number");var n=f(b);return t!==void 0?typeof i=="string"?n.fill(t,i):n.fill(t):n.fill(0),n},h.allocUnsafe=function(b){if(typeof b!="number")throw new TypeError("Argument must be a number");return f(b)},h.allocUnsafeSlow=function(b){if(typeof b!="number")throw new TypeError("Argument must be a number");return p.SlowBuffer(b)}},{buffer:11}],41:[function(v,D,u){D.exports=m;var p=v("events").EventEmitter,f=v("inherits");f(m,p),m.Readable=v("readable-stream/lib/_stream_readable.js"),m.Writable=v("readable-stream/lib/_stream_writable.js"),m.Duplex=v("readable-stream/lib/_stream_duplex.js"),m.Transform=v("readable-stream/lib/_stream_transform.js"),m.PassThrough=v("readable-stream/lib/_stream_passthrough.js"),m.finished=v("readable-stream/lib/internal/streams/end-of-stream.js"),m.pipeline=v("readable-stream/lib/internal/streams/pipeline.js"),m.Stream=m;function m(){p.call(this)}m.prototype.pipe=function(h,b){var t=this;function i(d){h.writable&&(h.write(d)===!1&&t.pause&&t.pause())}t.on("data",i);function n(){t.readable&&t.resume&&t.resume()}h.on("drain",n),!h._isStdio&&(!b||b.end!==!1)&&(t.on("end",w),t.on("close",g));var o=!1;function w(){if(o)return;o=!0,h.end()}function g(){if(o)return;o=!0,typeof h.destroy=="function"&&h.destroy()}function l(d){if(e(),p.listenerCount(this,"error")===0)throw d}t.on("error",l),h.on("error",l);function e(){t.removeListener("data",i),h.removeListener("drain",n),t.removeListener("end",w),t.removeListener("close",g),t.removeListener("error",l),h.removeListener("error",l),t.removeListener("end",e),t.removeListener("close",e),h.removeListener("close",e)}return t.on("end",e),t.on("close",e),h.on("close",e),h.emit("pipe",t),h}},{events:16,inherits:23,"readable-stream/lib/_stream_duplex.js":43,"readable-stream/lib/_stream_passthrough.js":44,"readable-stream/lib/_stream_readable.js":45,"readable-stream/lib/_stream_transform.js":46,"readable-stream/lib/_stream_writable.js":47,"readable-stream/lib/internal/streams/end-of-stream.js":51,"readable-stream/lib/internal/streams/pipeline.js":53}],42:[function(v,D,u){"use strict";function p(n,o){n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.__proto__=o}var f={};function m(n,o,w){w||(w=Error);function g(e,d,y){return typeof o=="string"?o:o(e,d,y)}var l=function(e){p(d,e);function d(y,A,E){return e.call(this,g(y,A,E))||this}return d}(w);l.prototype.name=w.name,l.prototype.code=n,f[n]=l}function h(n,o){if(Array.isArray(n)){var w=n.length;return n=n.map(function(g){return String(g)}),w>2?"one of ".concat(o," ").concat(n.slice(0,w-1).join(", "),", or ")+n[w-1]:w===2?"one of ".concat(o," ").concat(n[0]," or ").concat(n[1]):"of ".concat(o," ").concat(n[0])}else return"of ".concat(o," ").concat(String(n))}function b(n,o,w){return n.substr(!w||w<0?0:+w,o.length)===o}function t(n,o,w){return(w===void 0||w>n.length)&&(w=n.length),n.substring(w-o.length,w)===o}function i(n,o,w){return typeof w!="number"&&(w=0),w+o.length>n.length?!1:n.indexOf(o,w)!==-1}m("ERR_INVALID_OPT_VALUE",function(n,o){return'The value "'+o+'" is invalid for option "'+n+'"'},TypeError),m("ERR_INVALID_ARG_TYPE",function(n,o,w){var g;typeof o=="string"&&b(o,"not ")?(g="must not be",o=o.replace(/^not /,"")):g="must be";var l;if(t(n," argument"))l="The ".concat(n," ").concat(g," ").concat(h(o,"type"));else{var e=i(n,".")?"property":"argument";l='The "'.concat(n,'" ').concat(e," ").concat(g," ").concat(h(o,"type"))}return l+=". Received type ".concat(typeof w),l},TypeError),m("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),m("ERR_METHOD_NOT_IMPLEMENTED",function(n){return"The "+n+" method is not implemented"}),m("ERR_STREAM_PREMATURE_CLOSE","Premature close"),m("ERR_STREAM_DESTROYED",function(n){return"Cannot call "+n+" after a stream was destroyed"}),m("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),m("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),m("ERR_STREAM_WRITE_AFTER_END","write after end"),m("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),m("ERR_UNKNOWN_ENCODING",function(n){return"Unknown encoding: "+n},TypeError),m("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),D.exports.codes=f},{}],43:[function(v,D,u){(function(p){(function(){"use strict";var f=Object.keys||function(g){var l=[];for(var e in g)l.push(e);return l};D.exports=n;var m=v("./_stream_readable"),h=v("./_stream_writable");v("inherits")(n,m);for(var b=f(h.prototype),t=0;t<b.length;t++){var i=b[t];n.prototype[i]||(n.prototype[i]=h.prototype[i])}function n(g){if(!(this instanceof n))return new n(g);m.call(this,g),h.call(this,g),this.allowHalfOpen=!0,g&&(g.readable===!1&&(this.readable=!1),g.writable===!1&&(this.writable=!1),g.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(n.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(n.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(n.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){if(this._writableState.ended)return;p.nextTick(w,this)}function w(g){g.end()}Object.defineProperty(n.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(l){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=l,this._writableState.destroyed=l}})}).call(this)}).call(this,v("_process"))},{"./_stream_readable":45,"./_stream_writable":47,_process:39,inherits:23}],44:[function(v,D,u){"use strict";D.exports=f;var p=v("./_stream_transform");v("inherits")(f,p);function f(m){if(!(this instanceof f))return new f(m);p.call(this,m)}f.prototype._transform=function(m,h,b){b(null,m)}},{"./_stream_transform":46,inherits:23}],45:[function(v,D,u){(function(p,f){(function(){"use strict";D.exports=k;var m;k.ReadableState=B;var h=v("events").EventEmitter,b=function(c,s){return c.listeners(s).length},t=v("./internal/streams/stream"),i=v("buffer").Buffer,n=f.Uint8Array||function(){};function o(C){return i.from(C)}function w(C){return i.isBuffer(C)||C instanceof n}var g=v("util"),l;g&&g.debuglog?l=g.debuglog("stream"):l=function(){};var e=v("./internal/streams/buffer_list"),d=v("./internal/streams/destroy"),y=v("./internal/streams/state"),A=y.getHighWaterMark,E=v("../errors").codes,T=E.ERR_INVALID_ARG_TYPE,_=E.ERR_STREAM_PUSH_AFTER_EOF,S=E.ERR_METHOD_NOT_IMPLEMENTED,N=E.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,L,H,P;v("inherits")(k,t);var K=d.errorOrDestroy,te=["error","close","destroy","pause","resume"];function se(C,c,s){if(typeof C.prependListener=="function")return C.prependListener(c,s);!C._events||!C._events[c]?C.on(c,s):Array.isArray(C._events[c])?C._events[c].unshift(s):C._events[c]=[s,C._events[c]]}function B(C,c,s){m=m||v("./_stream_duplex"),C=C||{},typeof s!="boolean"&&(s=c instanceof m),this.objectMode=!!C.objectMode,s&&(this.objectMode=this.objectMode||!!C.readableObjectMode),this.highWaterMark=A(this,C,"readableHighWaterMark",s),this.buffer=new e,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=C.emitClose!==!1,this.autoDestroy=!!C.autoDestroy,this.destroyed=!1,this.defaultEncoding=C.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,C.encoding&&(L||(L=v("string_decoder/").StringDecoder),this.decoder=new L(C.encoding),this.encoding=C.encoding)}function k(C){if(m=m||v("./_stream_duplex"),!(this instanceof k))return new k(C);var c=this instanceof m;this._readableState=new B(C,this,c),this.readable=!0,C&&(typeof C.read=="function"&&(this._read=C.read),typeof C.destroy=="function"&&(this._destroy=C.destroy)),t.call(this)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(c){if(!this._readableState)return;this._readableState.destroyed=c}}),k.prototype.destroy=d.destroy,k.prototype._undestroy=d.undestroy,k.prototype._destroy=function(C,c){c(C)},k.prototype.push=function(C,c){var s=this._readableState,r;return s.objectMode?r=!0:typeof C=="string"&&(c=c||s.defaultEncoding,c!==s.encoding&&(C=i.from(C,c),c=""),r=!0),F(this,C,c,!1,r)},k.prototype.unshift=function(C){return F(this,C,null,!0,!1)};function F(C,c,s,r,R){l("readableAddChunk",c);var z=C._readableState;if(c===null)z.reading=!1,V(C,z);else{var re;if(R||(re=oe(z,c)),re)K(C,re);else if(z.objectMode||c&&c.length>0)if(typeof c!="string"&&!z.objectMode&&Object.getPrototypeOf(c)!==i.prototype&&(c=o(c)),r)z.endEmitted?K(C,new N):$(C,z,c,!0);else if(z.ended)K(C,new _);else{if(z.destroyed)return!1;z.reading=!1,z.decoder&&!s?(c=z.decoder.write(c),z.objectMode||c.length!==0?$(C,z,c,!1):Z(C,z)):$(C,z,c,!1)}else r||(z.reading=!1,Z(C,z))}return!z.ended&&(z.length<z.highWaterMark||z.length===0)}function $(C,c,s,r){c.flowing&&c.length===0&&!c.sync?(c.awaitDrain=0,C.emit("data",s)):(c.length+=c.objectMode?1:s.length,r?c.buffer.unshift(s):c.buffer.push(s),c.needReadable&&Q(C)),Z(C,c)}function oe(C,c){var s;return!w(c)&&typeof c!="string"&&c!==void 0&&!C.objectMode&&(s=new T("chunk",["string","Buffer","Uint8Array"],c)),s}k.prototype.isPaused=function(){return this._readableState.flowing===!1},k.prototype.setEncoding=function(C){L||(L=v("string_decoder/").StringDecoder);var c=new L(C);this._readableState.decoder=c,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";s!==null;)r+=c.write(s.data),s=s.next;return this._readableState.buffer.clear(),r!==""&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var Ee=1073741824;function he(C){return C>=Ee?C=Ee:(C--,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,C|=C>>>16,C++),C}function W(C,c){return C<=0||c.length===0&&c.ended?0:c.objectMode?1:C!==C?c.flowing&&c.length?c.buffer.head.data.length:c.length:(C>c.highWaterMark&&(c.highWaterMark=he(C)),C<=c.length?C:c.ended?c.length:(c.needReadable=!0,0))}k.prototype.read=function(C){l("read",C),C=parseInt(C,10);var c=this._readableState,s=C;if(C!==0&&(c.emittedReadable=!1),C===0&&c.needReadable&&((c.highWaterMark!==0?c.length>=c.highWaterMark:c.length>0)||c.ended))return l("read: emitReadable",c.length,c.ended),c.length===0&&c.ended?ie(this):Q(this),null;if(C=W(C,c),C===0&&c.ended)return c.length===0&&ie(this),null;var r=c.needReadable;l("need readable",r),(c.length===0||c.length-C<c.highWaterMark)&&(r=!0,l("length less than watermark",r)),c.ended||c.reading?(r=!1,l("reading or ended",r)):r&&(l("do read"),c.reading=!0,c.sync=!0,c.length===0&&(c.needReadable=!0),this._read(c.highWaterMark),c.sync=!1,c.reading||(C=W(s,c)));var R;return C>0?R=j(C,c):R=null,R===null?(c.needReadable=c.length<=c.highWaterMark,C=0):(c.length-=C,c.awaitDrain=0),c.length===0&&(c.ended||(c.needReadable=!0),s!==C&&c.ended&&ie(this)),R!==null&&this.emit("data",R),R};function V(C,c){if(l("onEofChunk"),c.ended)return;if(c.decoder){var s=c.decoder.end();s&&s.length&&(c.buffer.push(s),c.length+=c.objectMode?1:s.length)}c.ended=!0,c.sync?Q(C):(c.needReadable=!1,c.emittedReadable||(c.emittedReadable=!0,be(C)))}function Q(C){var c=C._readableState;l("emitReadable",c.needReadable,c.emittedReadable),c.needReadable=!1,c.emittedReadable||(l("emitReadable",c.flowing),c.emittedReadable=!0,p.nextTick(be,C))}function be(C){var c=C._readableState;l("emitReadable_",c.destroyed,c.length,c.ended),!c.destroyed&&(c.length||c.ended)&&(C.emit("readable"),c.emittedReadable=!1),c.needReadable=!c.flowing&&!c.ended&&c.length<=c.highWaterMark,M(C)}function Z(C,c){c.readingMore||(c.readingMore=!0,p.nextTick(Y,C,c))}function Y(C,c){for(;!c.reading&&!c.ended&&(c.length<c.highWaterMark||c.flowing&&c.length===0);){var s=c.length;if(l("maybeReadMore read 0"),C.read(0),s===c.length)break}c.readingMore=!1}k.prototype._read=function(C){K(this,new S("_read()"))},k.prototype.pipe=function(C,c){var s=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=C;break;case 1:r.pipes=[r.pipes,C];break;default:r.pipes.push(C);break}r.pipesCount+=1,l("pipe count=%d opts=%j",r.pipesCount,c);var R=(!c||c.end!==!1)&&C!==p.stdout&&C!==p.stderr,z=R?ae:De;r.endEmitted?p.nextTick(z):s.once("end",z),C.on("unpipe",re);function re(je,x){l("onunpipe"),je===s&&(x&&x.hasUnpiped===!1&&(x.hasUnpiped=!0,Ie()))}function ae(){l("onend"),C.end()}var Se=q(s);C.on("drain",Se);var ke=!1;function Ie(){l("cleanup"),C.removeListener("close",Ue),C.removeListener("finish",Le),C.removeListener("drain",Se),C.removeListener("error",Re),C.removeListener("unpipe",re),s.removeListener("end",ae),s.removeListener("end",De),s.removeListener("data",Ne),ke=!0,r.awaitDrain&&(!C._writableState||C._writableState.needDrain)&&Se()}s.on("data",Ne);function Ne(je){l("ondata");var x=C.write(je);l("dest.write",x),x===!1&&((r.pipesCount===1&&r.pipes===C||r.pipesCount>1&&ve(r.pipes,C)!==-1)&&!ke&&(l("false write response, pause",r.awaitDrain),r.awaitDrain++),s.pause())}function Re(je){l("onerror",je),De(),C.removeListener("error",Re),b(C,"error")===0&&K(C,je)}se(C,"error",Re);function Ue(){C.removeListener("finish",Le),De()}C.once("close",Ue);function Le(){l("onfinish"),C.removeListener("close",Ue),De()}C.once("finish",Le);function De(){l("unpipe"),s.unpipe(C)}return C.emit("pipe",s),r.flowing||(l("pipe resume"),s.resume()),C};function q(C){return function(){var s=C._readableState;l("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&b(C,"data")&&(s.flowing=!0,M(C))}}k.prototype.unpipe=function(C){var c=this._readableState,s={hasUnpiped:!1};if(c.pipesCount===0)return this;if(c.pipesCount===1)return C&&C!==c.pipes?this:(C||(C=c.pipes),c.pipes=null,c.pipesCount=0,c.flowing=!1,C&&C.emit("unpipe",this,s),this);if(!C){var r=c.pipes,R=c.pipesCount;c.pipes=null,c.pipesCount=0,c.flowing=!1;for(var z=0;z<R;z++)r[z].emit("unpipe",this,{hasUnpiped:!1});return this}var re=ve(c.pipes,C);return re===-1?this:(c.pipes.splice(re,1),c.pipesCount-=1,c.pipesCount===1&&(c.pipes=c.pipes[0]),C.emit("unpipe",this,s),this)},k.prototype.on=function(C,c){var s=t.prototype.on.call(this,C,c),r=this._readableState;return C==="data"?(r.readableListening=this.listenerCount("readable")>0,r.flowing!==!1&&this.resume()):C==="readable"&&(!r.endEmitted&&!r.readableListening&&(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,l("on readable",r.length,r.reading),r.length?Q(this):r.reading||p.nextTick(ce,this))),s},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(C,c){var s=t.prototype.removeListener.call(this,C,c);return C==="readable"&&p.nextTick(ue,this),s},k.prototype.removeAllListeners=function(C){var c=t.prototype.removeAllListeners.apply(this,arguments);return(C==="readable"||C===void 0)&&p.nextTick(ue,this),c};function ue(C){var c=C._readableState;c.readableListening=C.listenerCount("readable")>0,c.resumeScheduled&&!c.paused?c.flowing=!0:C.listenerCount("data")>0&&C.resume()}function ce(C){l("readable nexttick read 0"),C.read(0)}k.prototype.resume=function(){var C=this._readableState;return C.flowing||(l("resume"),C.flowing=!C.readableListening,ye(this,C)),C.paused=!1,this};function ye(C,c){c.resumeScheduled||(c.resumeScheduled=!0,p.nextTick(me,C,c))}function me(C,c){l("resume",c.reading),c.reading||C.read(0),c.resumeScheduled=!1,C.emit("resume"),M(C),c.flowing&&!c.reading&&C.read(0)}k.prototype.pause=function(){return l("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(l("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function M(C){var c=C._readableState;for(l("flow",c.flowing);c.flowing&&C.read()!==null;);}k.prototype.wrap=function(C){var c=this,s=this._readableState,r=!1;C.on("end",function(){if(l("wrapped end"),s.decoder&&!s.ended){var re=s.decoder.end();re&&re.length&&c.push(re)}c.push(null)}),C.on("data",function(re){if(l("wrapped data"),s.decoder&&(re=s.decoder.write(re)),s.objectMode&&re==null)return;if(!s.objectMode&&(!re||!re.length))return;var ae=c.push(re);ae||(r=!0,C.pause())});for(var R in C)this[R]===void 0&&typeof C[R]=="function"&&(this[R]=function(ae){return function(){return C[ae].apply(C,arguments)}}(R));for(var z=0;z<te.length;z++)C.on(te[z],this.emit.bind(this,te[z]));return this._read=function(re){l("wrapped _read",re),r&&(r=!1,C.resume())},this},typeof Symbol=="function"&&(k.prototype[Symbol.asyncIterator]=function(){return H===void 0&&(H=v("./internal/streams/async_iterator")),H(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(c){this._readableState&&(this._readableState.flowing=c)}}),k._fromList=j,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function j(C,c){if(c.length===0)return null;var s;return c.objectMode?s=c.buffer.shift():!C||C>=c.length?(c.decoder?s=c.buffer.join(""):c.buffer.length===1?s=c.buffer.first():s=c.buffer.concat(c.length),c.buffer.clear()):s=c.buffer.consume(C,c.decoder),s}function ie(C){var c=C._readableState;l("endReadable",c.endEmitted),c.endEmitted||(c.ended=!0,p.nextTick(pe,c,C))}function pe(C,c){if(l("endReadableNT",C.endEmitted,C.length),!C.endEmitted&&C.length===0&&(C.endEmitted=!0,c.readable=!1,c.emit("end"),C.autoDestroy)){var s=c._writableState;(!s||s.autoDestroy&&s.finished)&&c.destroy()}}typeof Symbol=="function"&&(k.from=function(C,c){return P===void 0&&(P=v("./internal/streams/from")),P(k,C,c)});function ve(C,c){for(var s=0,r=C.length;s<r;s++)if(C[s]===c)return s;return-1}}).call(this)}).call(this,v("_process"),typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":42,"./_stream_duplex":43,"./internal/streams/async_iterator":48,"./internal/streams/buffer_list":49,"./internal/streams/destroy":50,"./internal/streams/from":52,"./internal/streams/state":54,"./internal/streams/stream":55,_process:39,buffer:11,events:16,inherits:23,"string_decoder/":56,util:8}],46:[function(v,D,u){"use strict";D.exports=n;var p=v("../errors").codes,f=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,h=p.ERR_TRANSFORM_ALREADY_TRANSFORMING,b=p.ERR_TRANSFORM_WITH_LENGTH_0,t=v("./_stream_duplex");v("inherits")(n,t);function i(g,l){var e=this._transformState;e.transforming=!1;var d=e.writecb;if(d===null)return this.emit("error",new m);e.writechunk=null,e.writecb=null,l!=null&&this.push(l),d(g);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}function n(g){if(!(this instanceof n))return new n(g);t.call(this,g),this._transformState={afterTransform:i.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,g&&(typeof g.transform=="function"&&(this._transform=g.transform),typeof g.flush=="function"&&(this._flush=g.flush)),this.on("prefinish",o)}function o(){var g=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(l,e){w(g,l,e)}):w(this,null,null)}n.prototype.push=function(g,l){return this._transformState.needTransform=!1,t.prototype.push.call(this,g,l)},n.prototype._transform=function(g,l,e){e(new f("_transform()"))},n.prototype._write=function(g,l,e){var d=this._transformState;if(d.writecb=e,d.writechunk=g,d.writeencoding=l,!d.transforming){var y=this._readableState;(d.needTransform||y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}},n.prototype._read=function(g){var l=this._transformState;l.writechunk!==null&&!l.transforming?(l.transforming=!0,this._transform(l.writechunk,l.writeencoding,l.afterTransform)):l.needTransform=!0},n.prototype._destroy=function(g,l){t.prototype._destroy.call(this,g,function(e){l(e)})};function w(g,l,e){if(l)return g.emit("error",l);if(e!=null&&g.push(e),g._writableState.length)throw new b;if(g._transformState.transforming)throw new h;return g.push(null)}},{"../errors":42,"./_stream_duplex":43,inherits:23}],47:[function(v,D,u){(function(p,f){(function(){"use strict";D.exports=B;function m(M,j,ie){this.chunk=M,this.encoding=j,this.callback=ie,this.next=null}function h(M){var j=this;this.next=null,this.entry=null,this.finish=function(){me(j,M)}}var b;B.WritableState=te;var t={deprecate:v("util-deprecate")},i=v("./internal/streams/stream"),n=v("buffer").Buffer,o=f.Uint8Array||function(){};function w(M){return n.from(M)}function g(M){return n.isBuffer(M)||M instanceof o}var l=v("./internal/streams/destroy"),e=v("./internal/streams/state"),d=e.getHighWaterMark,y=v("../errors").codes,A=y.ERR_INVALID_ARG_TYPE,E=y.ERR_METHOD_NOT_IMPLEMENTED,T=y.ERR_MULTIPLE_CALLBACK,_=y.ERR_STREAM_CANNOT_PIPE,S=y.ERR_STREAM_DESTROYED,N=y.ERR_STREAM_NULL_VALUES,L=y.ERR_STREAM_WRITE_AFTER_END,H=y.ERR_UNKNOWN_ENCODING,P=l.errorOrDestroy;v("inherits")(B,i);function K(){}function te(M,j,ie){b=b||v("./_stream_duplex"),M=M||{},typeof ie!="boolean"&&(ie=j instanceof b),this.objectMode=!!M.objectMode,ie&&(this.objectMode=this.objectMode||!!M.writableObjectMode),this.highWaterMark=d(this,M,"writableHighWaterMark",ie),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var pe=M.decodeStrings===!1;this.decodeStrings=!pe,this.defaultEncoding=M.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(ve){V(j,ve)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=M.emitClose!==!1,this.autoDestroy=!!M.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new h(this)}te.prototype.getBuffer=function(){for(var j=this.bufferedRequest,ie=[];j;)ie.push(j),j=j.next;return ie},function(){try{Object.defineProperty(te.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(M){}}();var se;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(se=Function.prototype[Symbol.hasInstance],Object.defineProperty(B,Symbol.hasInstance,{value:function(j){return se.call(this,j)?!0:this!==B?!1:j&&j._writableState instanceof te}})):se=function(j){return j instanceof this};function B(M){b=b||v("./_stream_duplex");var j=this instanceof b;if(!j&&!se.call(B,this))return new B(M);this._writableState=new te(M,this,j),this.writable=!0,M&&(typeof M.write=="function"&&(this._write=M.write),typeof M.writev=="function"&&(this._writev=M.writev),typeof M.destroy=="function"&&(this._destroy=M.destroy),typeof M.final=="function"&&(this._final=M.final)),i.call(this)}B.prototype.pipe=function(){P(this,new _)};function k(M,j){var ie=new L;P(M,ie),p.nextTick(j,ie)}function F(M,j,ie,pe){var ve;return ie===null?ve=new N:typeof ie!="string"&&!j.objectMode&&(ve=new A("chunk",["string","Buffer"],ie)),ve?(P(M,ve),p.nextTick(pe,ve),!1):!0}B.prototype.write=function(M,j,ie){var pe=this._writableState,ve=!1,C=!pe.objectMode&&g(M);return C&&!n.isBuffer(M)&&(M=w(M)),typeof j=="function"&&(ie=j,j=null),C?j="buffer":j||(j=pe.defaultEncoding),typeof ie!="function"&&(ie=K),pe.ending?k(this,ie):(C||F(this,pe,M,ie))&&(pe.pendingcb++,ve=oe(this,pe,C,M,j,ie)),ve},B.prototype.cork=function(){this._writableState.corked++},B.prototype.uncork=function(){var M=this._writableState;M.corked&&(M.corked--,!M.writing&&!M.corked&&!M.bufferProcessing&&M.bufferedRequest&&Z(this,M))},B.prototype.setDefaultEncoding=function(j){if(typeof j=="string"&&(j=j.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((j+"").toLowerCase())>-1))throw new H(j);return this._writableState.defaultEncoding=j,this},Object.defineProperty(B.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function $(M,j,ie){return!M.objectMode&&M.decodeStrings!==!1&&typeof j=="string"&&(j=n.from(j,ie)),j}Object.defineProperty(B.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function oe(M,j,ie,pe,ve,C){if(!ie){var c=$(j,pe,ve);pe!==c&&(ie=!0,ve="buffer",pe=c)}var s=j.objectMode?1:pe.length;j.length+=s;var r=j.length<j.highWaterMark;if(r||(j.needDrain=!0),j.writing||j.corked){var R=j.lastBufferedRequest;j.lastBufferedRequest={chunk:pe,encoding:ve,isBuf:ie,callback:C,next:null},R?R.next=j.lastBufferedRequest:j.bufferedRequest=j.lastBufferedRequest,j.bufferedRequestCount+=1}else Ee(M,j,!1,s,pe,ve,C);return r}function Ee(M,j,ie,pe,ve,C,c){j.writelen=pe,j.writecb=c,j.writing=!0,j.sync=!0,j.destroyed?j.onwrite(new S("write")):ie?M._writev(ve,j.onwrite):M._write(ve,C,j.onwrite),j.sync=!1}function he(M,j,ie,pe,ve){--j.pendingcb,ie?(p.nextTick(ve,pe),p.nextTick(ce,M,j),M._writableState.errorEmitted=!0,P(M,pe)):(ve(pe),M._writableState.errorEmitted=!0,P(M,pe),ce(M,j))}function W(M){M.writing=!1,M.writecb=null,M.length-=M.writelen,M.writelen=0}function V(M,j){var ie=M._writableState,pe=ie.sync,ve=ie.writecb;if(typeof ve!="function")throw new T;if(W(ie),j)he(M,ie,pe,j,ve);else{var C=Y(ie)||M.destroyed;!C&&!ie.corked&&!ie.bufferProcessing&&ie.bufferedRequest&&Z(M,ie),pe?p.nextTick(Q,M,ie,C,ve):Q(M,ie,C,ve)}}function Q(M,j,ie,pe){ie||be(M,j),j.pendingcb--,pe(),ce(M,j)}function be(M,j){j.length===0&&j.needDrain&&(j.needDrain=!1,M.emit("drain"))}function Z(M,j){j.bufferProcessing=!0;var ie=j.bufferedRequest;if(M._writev&&ie&&ie.next){var pe=j.bufferedRequestCount,ve=new Array(pe),C=j.corkedRequestsFree;C.entry=ie;for(var c=0,s=!0;ie;)ve[c]=ie,ie.isBuf||(s=!1),ie=ie.next,c+=1;ve.allBuffers=s,Ee(M,j,!0,j.length,ve,"",C.finish),j.pendingcb++,j.lastBufferedRequest=null,C.next?(j.corkedRequestsFree=C.next,C.next=null):j.corkedRequestsFree=new h(j),j.bufferedRequestCount=0}else{for(;ie;){var r=ie.chunk,R=ie.encoding,z=ie.callback,re=j.objectMode?1:r.length;if(Ee(M,j,!1,re,r,R,z),ie=ie.next,j.bufferedRequestCount--,j.writing)break}ie===null&&(j.lastBufferedRequest=null)}j.bufferedRequest=ie,j.bufferProcessing=!1}B.prototype._write=function(M,j,ie){ie(new E("_write()"))},B.prototype._writev=null,B.prototype.end=function(M,j,ie){var pe=this._writableState;return typeof M=="function"?(ie=M,M=null,j=null):typeof j=="function"&&(ie=j,j=null),M!=null&&this.write(M,j),pe.corked&&(pe.corked=1,this.uncork()),pe.ending||ye(this,pe,ie),this},Object.defineProperty(B.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Y(M){return M.ending&&M.length===0&&M.bufferedRequest===null&&!M.finished&&!M.writing}function q(M,j){M._final(function(ie){j.pendingcb--,ie&&P(M,ie),j.prefinished=!0,M.emit("prefinish"),ce(M,j)})}function ue(M,j){!j.prefinished&&!j.finalCalled&&(typeof M._final=="function"&&!j.destroyed?(j.pendingcb++,j.finalCalled=!0,p.nextTick(q,M,j)):(j.prefinished=!0,M.emit("prefinish")))}function ce(M,j){var ie=Y(j);if(ie&&(ue(M,j),j.pendingcb===0&&(j.finished=!0,M.emit("finish"),j.autoDestroy))){var pe=M._readableState;(!pe||pe.autoDestroy&&pe.endEmitted)&&M.destroy()}return ie}function ye(M,j,ie){j.ending=!0,ce(M,j),ie&&(j.finished?p.nextTick(ie):M.once("finish",ie)),j.ended=!0,M.writable=!1}function me(M,j,ie){var pe=M.entry;for(M.entry=null;pe;){var ve=pe.callback;j.pendingcb--,ve(ie),pe=pe.next}j.corkedRequestsFree.next=M}Object.defineProperty(B.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(j){if(!this._writableState)return;this._writableState.destroyed=j}}),B.prototype.destroy=l.destroy,B.prototype._undestroy=l.undestroy,B.prototype._destroy=function(M,j){j(M)}}).call(this)}).call(this,v("_process"),typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":42,"./_stream_duplex":43,"./internal/streams/destroy":50,"./internal/streams/state":54,"./internal/streams/stream":55,_process:39,buffer:11,inherits:23,"util-deprecate":58}],48:[function(v,D,u){(function(p){(function(){"use strict";var f;function m(_,S,N){return S in _?Object.defineProperty(_,S,{value:N,enumerable:!0,configurable:!0,writable:!0}):_[S]=N,_}var h=v("./end-of-stream"),b=Symbol("lastResolve"),t=Symbol("lastReject"),i=Symbol("error"),n=Symbol("ended"),o=Symbol("lastPromise"),w=Symbol("handlePromise"),g=Symbol("stream");function l(_,S){return{value:_,done:S}}function e(_){var S=_[b];if(S!==null){var N=_[g].read();N!==null&&(_[o]=null,_[b]=null,_[t]=null,S(l(N,!1)))}}function d(_){p.nextTick(e,_)}function y(_,S){return function(N,L){_.then(function(){if(S[n]){N(l(void 0,!0));return}S[w](N,L)},L)}}var A=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((f={get stream(){return this[g]},next:function(){var S=this,N=this[i];if(N!==null)return Promise.reject(N);if(this[n])return Promise.resolve(l(void 0,!0));if(this[g].destroyed)return new Promise(function(K,te){p.nextTick(function(){S[i]?te(S[i]):K(l(void 0,!0))})});var L=this[o],H;if(L)H=new Promise(y(L,this));else{var P=this[g].read();if(P!==null)return Promise.resolve(l(P,!1));H=new Promise(this[w])}return this[o]=H,H}},m(f,Symbol.asyncIterator,function(){return this}),m(f,"return",function(){var S=this;return new Promise(function(N,L){S[g].destroy(null,function(H){if(H){L(H);return}N(l(void 0,!0))})})}),f),A),T=function(S){var N,L=Object.create(E,(N={},m(N,g,{value:S,writable:!0}),m(N,b,{value:null,writable:!0}),m(N,t,{value:null,writable:!0}),m(N,i,{value:null,writable:!0}),m(N,n,{value:S._readableState.endEmitted,writable:!0}),m(N,w,{value:function(P,K){var te=L[g].read();te?(L[o]=null,L[b]=null,L[t]=null,P(l(te,!1))):(L[b]=P,L[t]=K)},writable:!0}),N));return L[o]=null,h(S,function(H){if(H&&H.code!=="ERR_STREAM_PREMATURE_CLOSE"){var P=L[t];P!==null&&(L[o]=null,L[b]=null,L[t]=null,P(H)),L[i]=H;return}var K=L[b];K!==null&&(L[o]=null,L[b]=null,L[t]=null,K(l(void 0,!0))),L[n]=!0}),S.on("readable",d.bind(null,L)),L};D.exports=T}).call(this)}).call(this,v("_process"))},{"./end-of-stream":51,_process:39}],49:[function(v,D,u){"use strict";function p(e,d){var y=Object.keys(e);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(e);d&&(A=A.filter(function(E){return Object.getOwnPropertyDescriptor(e,E).enumerable})),y.push.apply(y,A)}return y}function f(e){for(var d=1;d<arguments.length;d++){var y=arguments[d]!=null?arguments[d]:{};d%2?p(Object(y),!0).forEach(function(A){m(e,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(y)):p(Object(y)).forEach(function(A){Object.defineProperty(e,A,Object.getOwnPropertyDescriptor(y,A))})}return e}function m(e,d,y){return d in e?Object.defineProperty(e,d,{value:y,enumerable:!0,configurable:!0,writable:!0}):e[d]=y,e}function h(e,d){if(!(e instanceof d))throw new TypeError("Cannot call a class as a function")}function b(e,d){for(var y=0;y<d.length;y++){var A=d[y];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(e,A.key,A)}}function t(e,d,y){return d&&b(e.prototype,d),y&&b(e,y),e}var i=v("buffer"),n=i.Buffer,o=v("util"),w=o.inspect,g=w&&w.custom||"inspect";function l(e,d,y){n.prototype.copy.call(e,d,y)}D.exports=function(){function e(){h(this,e),this.head=null,this.tail=null,this.length=0}return t(e,[{key:"push",value:function(y){var A={data:y,next:null};this.length>0?this.tail.next=A:this.head=A,this.tail=A,++this.length}},{key:"unshift",value:function(y){var A={data:y,next:this.head};this.length===0&&(this.tail=A),this.head=A,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var y=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,y}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(y){if(this.length===0)return"";for(var A=this.head,E=""+A.data;A=A.next;)E+=y+A.data;return E}},{key:"concat",value:function(y){if(this.length===0)return n.alloc(0);for(var A=n.allocUnsafe(y>>>0),E=this.head,T=0;E;)l(E.data,A,T),T+=E.data.length,E=E.next;return A}},{key:"consume",value:function(y,A){var E;return y<this.head.data.length?(E=this.head.data.slice(0,y),this.head.data=this.head.data.slice(y)):y===this.head.data.length?E=this.shift():E=A?this._getString(y):this._getBuffer(y),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(y){var A=this.head,E=1,T=A.data;for(y-=T.length;A=A.next;){var _=A.data,S=y>_.length?_.length:y;if(S===_.length?T+=_:T+=_.slice(0,y),y-=S,y===0){S===_.length?(++E,A.next?this.head=A.next:this.head=this.tail=null):(this.head=A,A.data=_.slice(S));break}++E}return this.length-=E,T}},{key:"_getBuffer",value:function(y){var A=n.allocUnsafe(y),E=this.head,T=1;for(E.data.copy(A),y-=E.data.length;E=E.next;){var _=E.data,S=y>_.length?_.length:y;if(_.copy(A,A.length-y,0,S),y-=S,y===0){S===_.length?(++T,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=_.slice(S));break}++T}return this.length-=T,A}},{key:g,value:function(y,A){return w(this,f({},A,{depth:0,customInspect:!1}))}}]),e}()},{buffer:11,util:8}],50:[function(v,D,u){(function(p){(function(){"use strict";function f(n,o){var w=this,g=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return g||l?(o?o(n):n&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,p.nextTick(t,this,n)):p.nextTick(t,this,n)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(n||null,function(e){!o&&e?w._writableState?w._writableState.errorEmitted?p.nextTick(h,w):(w._writableState.errorEmitted=!0,p.nextTick(m,w,e)):p.nextTick(m,w,e):o?(p.nextTick(h,w),o(e)):p.nextTick(h,w)}),this)}function m(n,o){t(n,o),h(n)}function h(n){if(n._writableState&&!n._writableState.emitClose)return;if(n._readableState&&!n._readableState.emitClose)return;n.emit("close")}function b(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function t(n,o){n.emit("error",o)}function i(n,o){var w=n._readableState,g=n._writableState;w&&w.autoDestroy||g&&g.autoDestroy?n.destroy(o):n.emit("error",o)}D.exports={destroy:f,undestroy:b,errorOrDestroy:i}}).call(this)}).call(this,v("_process"))},{_process:39}],51:[function(v,D,u){"use strict";var p=v("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function f(t){var i=!1;return function(){if(i)return;i=!0;for(var n=arguments.length,o=new Array(n),w=0;w<n;w++)o[w]=arguments[w];t.apply(this,o)}}function m(){}function h(t){return t.setHeader&&typeof t.abort=="function"}function b(t,i,n){if(typeof i=="function")return b(t,null,i);i||(i={}),n=f(n||m);var o=i.readable||i.readable!==!1&&t.readable,w=i.writable||i.writable!==!1&&t.writable,g=function(){t.writable||e()},l=t._writableState&&t._writableState.finished,e=function(){w=!1,l=!0,o||n.call(t)},d=t._readableState&&t._readableState.endEmitted,y=function(){o=!1,d=!0,w||n.call(t)},A=function(S){n.call(t,S)},E=function(){var S;if(o&&!d)return(!t._readableState||!t._readableState.ended)&&(S=new p),n.call(t,S);if(w&&!l)return(!t._writableState||!t._writableState.ended)&&(S=new p),n.call(t,S)},T=function(){t.req.on("finish",e)};return h(t)?(t.on("complete",e),t.on("abort",E),t.req?T():t.on("request",T)):w&&!t._writableState&&(t.on("end",g),t.on("close",g)),t.on("end",y),t.on("finish",e),i.error!==!1&&t.on("error",A),t.on("close",E),function(){t.removeListener("complete",e),t.removeListener("abort",E),t.removeListener("request",T),t.req&&t.req.removeListener("finish",e),t.removeListener("end",g),t.removeListener("close",g),t.removeListener("finish",e),t.removeListener("end",y),t.removeListener("error",A),t.removeListener("close",E)}}D.exports=b},{"../../../errors":42}],52:[function(v,D,u){D.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],53:[function(v,D,u){"use strict";var p;function f(e){var d=!1;return function(){if(d)return;d=!0,e.apply(void 0,arguments)}}var m=v("../../../errors").codes,h=m.ERR_MISSING_ARGS,b=m.ERR_STREAM_DESTROYED;function t(e){if(e)throw e}function i(e){return e.setHeader&&typeof e.abort=="function"}function n(e,d,y,A){A=f(A);var E=!1;e.on("close",function(){E=!0}),p===void 0&&(p=v("./end-of-stream")),p(e,{readable:d,writable:y},function(_){if(_)return A(_);E=!0,A()});var T=!1;return function(_){if(E)return;if(T)return;if(T=!0,i(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();A(_||new b("pipe"))}}function o(e){e()}function w(e,d){return e.pipe(d)}function g(e){return e.length?typeof e[e.length-1]!="function"?t:e.pop():t}function l(){for(var e=arguments.length,d=new Array(e),y=0;y<e;y++)d[y]=arguments[y];var A=g(d);if(Array.isArray(d[0])&&(d=d[0]),d.length<2)throw new h("streams");var E,T=d.map(function(_,S){var N=S<d.length-1,L=S>0;return n(_,N,L,function(H){if(E||(E=H),H&&T.forEach(o),N)return;T.forEach(o),A(E)})});return d.reduce(w)}D.exports=l},{"../../../errors":42,"./end-of-stream":51}],54:[function(v,D,u){"use strict";var p=v("../../../errors").codes.ERR_INVALID_OPT_VALUE;function f(h,b,t){return h.highWaterMark!=null?h.highWaterMark:b?h[t]:null}function m(h,b,t,i){var n=f(b,i,t);if(n!=null){if(!(isFinite(n)&&Math.floor(n)===n)||n<0){var o=i?t:"highWaterMark";throw new p(o,n)}return Math.floor(n)}return h.objectMode?16:16*1024}D.exports={getHighWaterMark:m}},{"../../../errors":42}],55:[function(v,D,u){D.exports=v("events").EventEmitter},{events:16}],56:[function(v,D,u){"use strict";var p=v("safe-buffer").Buffer,f=p.isEncoding||function(T){T=""+T;switch(T&&T.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function m(T){if(!T)return"utf8";for(var _;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(_)return;T=(""+T).toLowerCase(),_=!0}}function h(T){var _=m(T);if(typeof _!="string"&&(p.isEncoding===f||!f(T)))throw new Error("Unknown encoding: "+T);return _||T}u.StringDecoder=b;function b(T){this.encoding=h(T);var _;switch(this.encoding){case"utf16le":this.text=l,this.end=e,_=4;break;case"utf8":this.fillLast=o,_=4;break;case"base64":this.text=d,this.end=y,_=3;break;default:this.write=A,this.end=E;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=p.allocUnsafe(_)}b.prototype.write=function(T){if(T.length===0)return"";var _,S;if(this.lastNeed){if(_=this.fillLast(T),_===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<T.length?_?_+this.text(T,S):this.text(T,S):_||""},b.prototype.end=g,b.prototype.text=w,b.prototype.fillLast=function(T){if(this.lastNeed<=T.length)return T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,T.length),this.lastNeed-=T.length};function t(T){return T<=127?0:T>>5===6?2:T>>4===14?3:T>>3===30?4:T>>6===2?-1:-2}function i(T,_,S){var N=_.length-1;if(N<S)return 0;var L=t(_[N]);return L>=0?(L>0&&(T.lastNeed=L-1),L):--N<S||L===-2?0:(L=t(_[N]),L>=0?(L>0&&(T.lastNeed=L-2),L):--N<S||L===-2?0:(L=t(_[N]),L>=0?(L>0&&(L===2?L=0:T.lastNeed=L-3),L):0))}function n(T,_,S){if((_[0]&192)!==128)return T.lastNeed=0,"\uFFFD";if(T.lastNeed>1&&_.length>1){if((_[1]&192)!==128)return T.lastNeed=1,"\uFFFD";if(T.lastNeed>2&&_.length>2&&(_[2]&192)!==128)return T.lastNeed=2,"\uFFFD"}}function o(T){var _=this.lastTotal-this.lastNeed,S=n(this,T,_);if(S!==void 0)return S;if(this.lastNeed<=T.length)return T.copy(this.lastChar,_,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,_,0,T.length),this.lastNeed-=T.length}function w(T,_){var S=i(this,T,_);if(!this.lastNeed)return T.toString("utf8",_);this.lastTotal=S;var N=T.length-(S-this.lastNeed);return T.copy(this.lastChar,0,N),T.toString("utf8",_,N)}function g(T){var _=T&&T.length?this.write(T):"";return this.lastNeed?_+"\uFFFD":_}function l(T,_){if((T.length-_)%2===0){var S=T.toString("utf16le",_);if(S){var N=S.charCodeAt(S.length-1);if(N>=55296&&N<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=T[T.length-1],T.toString("utf16le",_,T.length-1)}function e(T){var _=T&&T.length?this.write(T):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return _+this.lastChar.toString("utf16le",0,S)}return _}function d(T,_){var S=(T.length-_)%3;return S===0?T.toString("base64",_):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=T[T.length-1]:(this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1]),T.toString("base64",_,T.length-S))}function y(T){var _=T&&T.length?this.write(T):"";return this.lastNeed?_+this.lastChar.toString("base64",0,3-this.lastNeed):_}function A(T){return T.toString(this.encoding)}function E(T){return T&&T.length?this.write(T):""}},{"safe-buffer":40}],57:[function(v,D,u){(function(p,f){(function(){var m=v("process/browser.js").nextTick,h=Function.prototype.apply,b=Array.prototype.slice,t={},i=0;u.setTimeout=function(){return new n(h.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new n(h.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(o){o.close()};function n(o,w){this._id=o,this._clearFn=w}n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(o,w){clearTimeout(o._idleTimeoutId),o._idleTimeout=w},u.unenroll=function(o){clearTimeout(o._idleTimeoutId),o._idleTimeout=-1},u._unrefActive=u.active=function(o){clearTimeout(o._idleTimeoutId);var w=o._idleTimeout;w>=0&&(o._idleTimeoutId=setTimeout(function(){o._onTimeout&&o._onTimeout()},w))},u.setImmediate=typeof p=="function"?p:function(o){var w=i++,g=arguments.length<2?!1:b.call(arguments,1);return t[w]=!0,m(function(){t[w]&&(g?o.apply(null,g):o.call(null),u.clearImmediate(w))}),w},u.clearImmediate=typeof f=="function"?f:function(o){delete t[o]}}).call(this)}).call(this,v("timers").setImmediate,v("timers").clearImmediate)},{"process/browser.js":39,timers:57}],58:[function(v,D,u){(function(p){(function(){D.exports=f;function f(h,b){if(m("noDeprecation"))return h;var t=!1;function i(){if(!t){if(m("throwDeprecation"))throw new Error(b);m("traceDeprecation")?console.trace(b):console.warn(b),t=!0}return h.apply(this,arguments)}return i}function m(h){try{if(!p.localStorage)return!1}catch(t){return!1}var b=p.localStorage[h];return b==null?!1:String(b).toLowerCase()==="true"}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],59:[function(v,D,u){arguments[4][4][0].apply(u,arguments)},{dup:4}],60:[function(v,D,u){"use strict";var p=v("is-arguments"),f=v("is-generator-function"),m=v("which-typed-array"),h=v("is-typed-array");function b(r){return r.call.bind(r)}var t=typeof BigInt!="undefined",i=typeof Symbol!="undefined",n=b(Object.prototype.toString),o=b(Number.prototype.valueOf),w=b(String.prototype.valueOf),g=b(Boolean.prototype.valueOf);if(t)var l=b(BigInt.prototype.valueOf);if(i)var e=b(Symbol.prototype.valueOf);function d(r,R){if(typeof r!="object")return!1;try{return R(r),!0}catch(z){return!1}}u.isArgumentsObject=p,u.isGeneratorFunction=f,u.isTypedArray=h;function y(r){return typeof Promise!="undefined"&&r instanceof Promise||r!==null&&typeof r=="object"&&typeof r.then=="function"&&typeof r.catch=="function"}u.isPromise=y;function A(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(r):h(r)||Z(r)}u.isArrayBufferView=A;function E(r){return m(r)==="Uint8Array"}u.isUint8Array=E;function T(r){return m(r)==="Uint8ClampedArray"}u.isUint8ClampedArray=T;function _(r){return m(r)==="Uint16Array"}u.isUint16Array=_;function S(r){return m(r)==="Uint32Array"}u.isUint32Array=S;function N(r){return m(r)==="Int8Array"}u.isInt8Array=N;function L(r){return m(r)==="Int16Array"}u.isInt16Array=L;function H(r){return m(r)==="Int32Array"}u.isInt32Array=H;function P(r){return m(r)==="Float32Array"}u.isFloat32Array=P;function K(r){return m(r)==="Float64Array"}u.isFloat64Array=K;function te(r){return m(r)==="BigInt64Array"}u.isBigInt64Array=te;function se(r){return m(r)==="BigUint64Array"}u.isBigUint64Array=se;function B(r){return n(r)==="[object Map]"}B.working=typeof Map!="undefined"&&B(new Map);function k(r){return typeof Map=="undefined"?!1:B.working?B(r):r instanceof Map}u.isMap=k;function F(r){return n(r)==="[object Set]"}F.working=typeof Set!="undefined"&&F(new Set);function $(r){return typeof Set=="undefined"?!1:F.working?F(r):r instanceof Set}u.isSet=$;function oe(r){return n(r)==="[object WeakMap]"}oe.working=typeof WeakMap!="undefined"&&oe(new WeakMap);function Ee(r){return typeof WeakMap=="undefined"?!1:oe.working?oe(r):r instanceof WeakMap}u.isWeakMap=Ee;function he(r){return n(r)==="[object WeakSet]"}he.working=typeof WeakSet!="undefined"&&he(new WeakSet);function W(r){return he(r)}u.isWeakSet=W;function V(r){return n(r)==="[object ArrayBuffer]"}V.working=typeof ArrayBuffer!="undefined"&&V(new ArrayBuffer);function Q(r){return typeof ArrayBuffer=="undefined"?!1:V.working?V(r):r instanceof ArrayBuffer}u.isArrayBuffer=Q;function be(r){return n(r)==="[object DataView]"}be.working=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"&&be(new DataView(new ArrayBuffer(1),0,1));function Z(r){return typeof DataView=="undefined"?!1:be.working?be(r):r instanceof DataView}u.isDataView=Z;function Y(r){return n(r)==="[object SharedArrayBuffer]"}Y.working=typeof SharedArrayBuffer!="undefined"&&Y(new SharedArrayBuffer);function q(r){return typeof SharedArrayBuffer=="undefined"?!1:Y.working?Y(r):r instanceof SharedArrayBuffer}u.isSharedArrayBuffer=q;function ue(r){return n(r)==="[object AsyncFunction]"}u.isAsyncFunction=ue;function ce(r){return n(r)==="[object Map Iterator]"}u.isMapIterator=ce;function ye(r){return n(r)==="[object Set Iterator]"}u.isSetIterator=ye;function me(r){return n(r)==="[object Generator]"}u.isGeneratorObject=me;function M(r){return n(r)==="[object WebAssembly.Module]"}u.isWebAssemblyCompiledModule=M;function j(r){return d(r,o)}u.isNumberObject=j;function ie(r){return d(r,w)}u.isStringObject=ie;function pe(r){return d(r,g)}u.isBooleanObject=pe;function ve(r){return t&&d(r,l)}u.isBigIntObject=ve;function C(r){return i&&d(r,e)}u.isSymbolObject=C;function c(r){return j(r)||ie(r)||pe(r)||ve(r)||C(r)}u.isBoxedPrimitive=c;function s(r){return typeof Uint8Array!="undefined"&&(Q(r)||q(r))}u.isAnyArrayBuffer=s,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(r){Object.defineProperty(u,r,{enumerable:!1,value:function(){throw new Error(r+" is not supported in userland")}})})},{"is-arguments":24,"is-generator-function":25,"is-typed-array":26,"which-typed-array":62}],61:[function(v,D,u){(function(p){(function(){var f=Object.getOwnPropertyDescriptors||function(Y){for(var q=Object.keys(Y),ue={},ce=0;ce<q.length;ce++)ue[q[ce]]=Object.getOwnPropertyDescriptor(Y,q[ce]);return ue},m=/%[sdj%]/g;u.format=function(Z){if(!L(Z)){for(var Y=[],q=0;q<arguments.length;q++)Y.push(i(arguments[q]));return Y.join(" ")}for(var q=1,ue=arguments,ce=ue.length,ye=String(Z).replace(m,function(M){if(M==="%%")return"%";if(q>=ce)return M;switch(M){case"%s":return String(ue[q++]);case"%d":return Number(ue[q++]);case"%j":try{return JSON.stringify(ue[q++])}catch(j){return"[Circular]"}default:return M}}),me=ue[q];q<ce;me=ue[++q])_(me)||!te(me)?ye+=" "+me:ye+=" "+i(me);return ye},u.deprecate=function(Z,Y){if(typeof p!="undefined"&&p.noDeprecation===!0)return Z;if(typeof p=="undefined")return function(){return u.deprecate(Z,Y).apply(this,arguments)};var q=!1;function ue(){if(!q){if(p.throwDeprecation)throw new Error(Y);p.traceDeprecation?console.trace(Y):console.error(Y),q=!0}return Z.apply(this,arguments)}return ue};var h={},b=/^$/;if(p.env.NODE_DEBUG){var t=p.env.NODE_DEBUG;t=t.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),b=new RegExp("^"+t+"$","i")}u.debuglog=function(Z){if(Z=Z.toUpperCase(),!h[Z])if(b.test(Z)){var Y=p.pid;h[Z]=function(){var q=u.format.apply(u,arguments);console.error("%s %d: %s",Z,Y,q)}}else h[Z]=function(){};return h[Z]};function i(Z,Y){var q={seen:[],stylize:o};return arguments.length>=3&&(q.depth=arguments[2]),arguments.length>=4&&(q.colors=arguments[3]),T(Y)?q.showHidden=Y:Y&&u._extend(q,Y),P(q.showHidden)&&(q.showHidden=!1),P(q.depth)&&(q.depth=2),P(q.colors)&&(q.colors=!1),P(q.customInspect)&&(q.customInspect=!0),q.colors&&(q.stylize=n),g(q,Z,q.depth)}u.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function n(Z,Y){var q=i.styles[Y];return q?"["+i.colors[q][0]+"m"+Z+"["+i.colors[q][1]+"m":Z}function o(Z,Y){return Z}function w(Z){var Y={};return Z.forEach(function(q,ue){Y[q]=!0}),Y}function g(Z,Y,q){if(Z.customInspect&&Y&&k(Y.inspect)&&Y.inspect!==u.inspect&&!(Y.constructor&&Y.constructor.prototype===Y)){var ue=Y.inspect(q,Z);return L(ue)||(ue=g(Z,ue,q)),ue}var ce=l(Z,Y);if(ce)return ce;var ye=Object.keys(Y),me=w(ye);if(Z.showHidden&&(ye=Object.getOwnPropertyNames(Y)),B(Y)&&(ye.indexOf("message")>=0||ye.indexOf("description")>=0))return e(Y);if(ye.length===0){if(k(Y)){var M=Y.name?": "+Y.name:"";return Z.stylize("[Function"+M+"]","special")}if(K(Y))return Z.stylize(RegExp.prototype.toString.call(Y),"regexp");if(se(Y))return Z.stylize(Date.prototype.toString.call(Y),"date");if(B(Y))return e(Y)}var j="",ie=!1,pe=["{","}"];if(E(Y)&&(ie=!0,pe=["[","]"]),k(Y)){var ve=Y.name?": "+Y.name:"";j=" [Function"+ve+"]"}if(K(Y)&&(j=" "+RegExp.prototype.toString.call(Y)),se(Y)&&(j=" "+Date.prototype.toUTCString.call(Y)),B(Y)&&(j=" "+e(Y)),ye.length===0&&(!ie||Y.length==0))return pe[0]+j+pe[1];if(q<0)return K(Y)?Z.stylize(RegExp.prototype.toString.call(Y),"regexp"):Z.stylize("[Object]","special");Z.seen.push(Y);var C;return ie?C=d(Z,Y,q,me,ye):C=ye.map(function(c){return y(Z,Y,q,me,c,ie)}),Z.seen.pop(),A(C,j,pe)}function l(Z,Y){if(P(Y))return Z.stylize("undefined","undefined");if(L(Y)){var q="'"+JSON.stringify(Y).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Z.stylize(q,"string")}if(N(Y))return Z.stylize(""+Y,"number");if(T(Y))return Z.stylize(""+Y,"boolean");if(_(Y))return Z.stylize("null","null")}function e(Z){return"["+Error.prototype.toString.call(Z)+"]"}function d(Z,Y,q,ue,ce){for(var ye=[],me=0,M=Y.length;me<M;++me)W(Y,String(me))?ye.push(y(Z,Y,q,ue,String(me),!0)):ye.push("");return ce.forEach(function(j){j.match(/^\d+$/)||ye.push(y(Z,Y,q,ue,j,!0))}),ye}function y(Z,Y,q,ue,ce,ye){var me,M,j;if(j=Object.getOwnPropertyDescriptor(Y,ce)||{value:Y[ce]},j.get?j.set?M=Z.stylize("[Getter/Setter]","special"):M=Z.stylize("[Getter]","special"):j.set&&(M=Z.stylize("[Setter]","special")),W(ue,ce)||(me="["+ce+"]"),M||(Z.seen.indexOf(j.value)<0?(_(q)?M=g(Z,j.value,null):M=g(Z,j.value,q-1),M.indexOf(`
`)>-1&&(ye?M=M.split(`
`).map(function(ie){return"  "+ie}).join(`
`).substr(2):M=`
`+M.split(`
`).map(function(ie){return"   "+ie}).join(`
`))):M=Z.stylize("[Circular]","special")),P(me)){if(ye&&ce.match(/^\d+$/))return M;me=JSON.stringify(""+ce),me.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(me=me.substr(1,me.length-2),me=Z.stylize(me,"name")):(me=me.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),me=Z.stylize(me,"string"))}return me+": "+M}function A(Z,Y,q){var ue=0,ce=Z.reduce(function(ye,me){return ue++,me.indexOf(`
`)>=0&&ue++,ye+me.replace(/\u001b\[\d\d?m/g,"").length+1},0);return ce>60?q[0]+(Y===""?"":Y+`
 `)+" "+Z.join(`,
  `)+" "+q[1]:q[0]+Y+" "+Z.join(", ")+" "+q[1]}u.types=v("./support/types");function E(Z){return Array.isArray(Z)}u.isArray=E;function T(Z){return typeof Z=="boolean"}u.isBoolean=T;function _(Z){return Z===null}u.isNull=_;function S(Z){return Z==null}u.isNullOrUndefined=S;function N(Z){return typeof Z=="number"}u.isNumber=N;function L(Z){return typeof Z=="string"}u.isString=L;function H(Z){return typeof Z=="symbol"}u.isSymbol=H;function P(Z){return Z===void 0}u.isUndefined=P;function K(Z){return te(Z)&&$(Z)==="[object RegExp]"}u.isRegExp=K,u.types.isRegExp=K;function te(Z){return typeof Z=="object"&&Z!==null}u.isObject=te;function se(Z){return te(Z)&&$(Z)==="[object Date]"}u.isDate=se,u.types.isDate=se;function B(Z){return te(Z)&&($(Z)==="[object Error]"||Z instanceof Error)}u.isError=B,u.types.isNativeError=B;function k(Z){return typeof Z=="function"}u.isFunction=k;function F(Z){return Z===null||typeof Z=="boolean"||typeof Z=="number"||typeof Z=="string"||typeof Z=="symbol"||typeof Z=="undefined"}u.isPrimitive=F,u.isBuffer=v("./support/isBuffer");function $(Z){return Object.prototype.toString.call(Z)}function oe(Z){return Z<10?"0"+Z.toString(10):Z.toString(10)}var Ee=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function he(){var Z=new Date,Y=[oe(Z.getHours()),oe(Z.getMinutes()),oe(Z.getSeconds())].join(":");return[Z.getDate(),Ee[Z.getMonth()],Y].join(" ")}u.log=function(){console.log("%s - %s",he(),u.format.apply(u,arguments))},u.inherits=v("inherits"),u._extend=function(Z,Y){if(!Y||!te(Y))return Z;for(var q=Object.keys(Y),ue=q.length;ue--;)Z[q[ue]]=Y[q[ue]];return Z};function W(Z,Y){return Object.prototype.hasOwnProperty.call(Z,Y)}var V=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;u.promisify=function(Y){if(typeof Y!="function")throw new TypeError('The "original" argument must be of type Function');if(V&&Y[V]){var q=Y[V];if(typeof q!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(q,V,{value:q,enumerable:!1,writable:!1,configurable:!0}),q}function q(){for(var ue,ce,ye=new Promise(function(j,ie){ue=j,ce=ie}),me=[],M=0;M<arguments.length;M++)me.push(arguments[M]);me.push(function(j,ie){j?ce(j):ue(ie)});try{Y.apply(this,me)}catch(j){ce(j)}return ye}return Object.setPrototypeOf(q,Object.getPrototypeOf(Y)),V&&Object.defineProperty(q,V,{value:q,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(q,f(Y))},u.promisify.custom=V;function Q(Z,Y){if(!Z){var q=new Error("Promise was rejected with a falsy value");q.reason=Z,Z=q}return Y(Z)}function be(Z){if(typeof Z!="function")throw new TypeError('The "original" argument must be of type Function');function Y(){for(var q=[],ue=0;ue<arguments.length;ue++)q.push(arguments[ue]);var ce=q.pop();if(typeof ce!="function")throw new TypeError("The last argument must be of type Function");var ye=this,me=function(){return ce.apply(ye,arguments)};Z.apply(this,q).then(function(M){p.nextTick(me.bind(null,null,M))},function(M){p.nextTick(Q.bind(null,M,me))})}return Object.setPrototypeOf(Y,Object.getPrototypeOf(Z)),Object.defineProperties(Y,f(Z)),Y}u.callbackify=be}).call(this)}).call(this,v("_process"))},{"./support/isBuffer":59,"./support/types":60,_process:39,inherits:23}],62:[function(v,D,u){(function(p){(function(){"use strict";var f=v("foreach"),m=v("available-typed-arrays"),h=v("es-abstract/helpers/callBound"),b=h("Object.prototype.toString"),t=v("has-symbols")(),i=t&&typeof Symbol.toStringTag=="symbol",n=m(),o=h("String.prototype.slice"),w={},g=v("es-abstract/helpers/getOwnPropertyDescriptor"),l=Object.getPrototypeOf;i&&g&&l&&f(n,function(y){if(typeof p[y]=="function"){var A=new p[y];if(!(Symbol.toStringTag in A))throw new EvalError("this engine has support for Symbol.toStringTag, but "+y+" does not have the property! Please report this.");var E=l(A),T=g(E,Symbol.toStringTag);if(!T){var _=l(E);T=g(_,Symbol.toStringTag)}w[y]=T.get}});var e=function(A){var E=!1;return f(w,function(T,_){if(!E)try{var S=T.call(A);S===_&&(E=S)}catch(N){}}),E},d=v("is-typed-array");D.exports=function(A){return d(A)?i?e(A):o(b(A),8,-1):!1}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"available-typed-arrays":6,"es-abstract/helpers/callBound":14,"es-abstract/helpers/getOwnPropertyDescriptor":15,foreach:17,"has-symbols":20,"is-typed-array":26}],63:[function(v,D,u){(function(p){(function(){"use strict";var f=p.MutationObserver||p.WebKitMutationObserver,m;if(f){var h=0,b=new f(w),t=p.document.createTextNode("");b.observe(t,{characterData:!0}),m=function(){t.data=h=++h%2}}else if(!p.setImmediate&&typeof p.MessageChannel!="undefined"){var i=new p.MessageChannel;i.port1.onmessage=w,m=function(){i.port2.postMessage(0)}}else"document"in p&&"onreadystatechange"in p.document.createElement("script")?m=function(){var l=p.document.createElement("script");l.onreadystatechange=function(){w(),l.onreadystatechange=null,l.parentNode.removeChild(l),l=null},p.document.documentElement.appendChild(l)}:m=function(){setTimeout(w,0)};var n,o=[];function w(){n=!0;for(var l,e,d=o.length;d;){for(e=o,o=[],l=-1;++l<d;)e[l]();d=o.length}n=!1}D.exports=g;function g(l){o.push(l)===1&&!n&&m()}}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],64:[function(v,D,u){"use strict";var p=v("./utils"),f=v("./support"),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u.encode=function(h){for(var b=[],t,i,n,o,w,g,l,e=0,d=h.length,y=d,A=p.getTypeOf(h)!=="string";e<h.length;)y=d-e,A?(t=h[e++],i=e<d?h[e++]:0,n=e<d?h[e++]:0):(t=h.charCodeAt(e++),i=e<d?h.charCodeAt(e++):0,n=e<d?h.charCodeAt(e++):0),o=t>>2,w=(t&3)<<4|i>>4,g=y>1?(i&15)<<2|n>>6:64,l=y>2?n&63:64,b.push(m.charAt(o)+m.charAt(w)+m.charAt(g)+m.charAt(l));return b.join("")},u.decode=function(h){var b,t,i,n,o,w,g,l=0,e=0,d="data:";if(h.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");h=h.replace(/[^A-Za-z0-9\+\/\=]/g,"");var y=h.length*3/4;if(h.charAt(h.length-1)===m.charAt(64)&&y--,h.charAt(h.length-2)===m.charAt(64)&&y--,y%1!==0)throw new Error("Invalid base64 input, bad content length.");var A;for(f.uint8array?A=new Uint8Array(y|0):A=new Array(y|0);l<h.length;)n=m.indexOf(h.charAt(l++)),o=m.indexOf(h.charAt(l++)),w=m.indexOf(h.charAt(l++)),g=m.indexOf(h.charAt(l++)),b=n<<2|o>>4,t=(o&15)<<4|w>>2,i=(w&3)<<6|g,A[e++]=b,w!==64&&(A[e++]=t),g!==64&&(A[e++]=i);return A}},{"./support":92,"./utils":94}],65:[function(v,D,u){"use strict";var p=v("./external"),f=v("./stream/DataWorker"),m=v("./stream/DataLengthProbe"),h=v("./stream/Crc32Probe"),m=v("./stream/DataLengthProbe");function b(t,i,n,o,w){this.compressedSize=t,this.uncompressedSize=i,this.crc32=n,this.compression=o,this.compressedContent=w}b.prototype={getContentWorker:function(){var t=new f(p.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new m("data_length")),i=this;return t.on("end",function(){if(this.streamInfo.data_length!==i.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new f(p.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},b.createWorkerFrom=function(t,i,n){return t.pipe(new h).pipe(new m("uncompressedSize")).pipe(i.compressWorker(n)).pipe(new m("compressedSize")).withStreamInfo("compression",i)},D.exports=b},{"./external":69,"./stream/Crc32Probe":87,"./stream/DataLengthProbe":88,"./stream/DataWorker":89}],66:[function(v,D,u){"use strict";var p=v("./stream/GenericWorker");u.STORE={magic:"\0\0",compressWorker:function(f){return new p("STORE compression")},uncompressWorker:function(){return new p("STORE decompression")}},u.DEFLATE=v("./flate")},{"./flate":70,"./stream/GenericWorker":90}],67:[function(v,D,u){"use strict";var p=v("./utils");function f(){for(var t,i=[],n=0;n<256;n++){t=n;for(var o=0;o<8;o++)t=t&1?3988292384^t>>>1:t>>>1;i[n]=t}return i}var m=f();function h(t,i,n,o){var w=m,g=o+n;t=t^-1;for(var l=o;l<g;l++)t=t>>>8^w[(t^i[l])&255];return t^-1}function b(t,i,n,o){var w=m,g=o+n;t=t^-1;for(var l=o;l<g;l++)t=t>>>8^w[(t^i.charCodeAt(l))&255];return t^-1}D.exports=function(i,n){if(typeof i=="undefined"||!i.length)return 0;var o=p.getTypeOf(i)!=="string";return o?h(n|0,i,i.length,0):b(n|0,i,i.length,0)}},{"./utils":94}],68:[function(v,D,u){"use strict";u.base64=!1,u.binary=!1,u.dir=!1,u.createFolders=!0,u.date=null,u.compression=null,u.compressionOptions=null,u.comment=null,u.unixPermissions=null,u.dosPermissions=null},{}],69:[function(v,D,u){"use strict";var p=null;typeof Promise!="undefined"?p=Promise:p=v("lie"),D.exports={Promise:p}},{lie:98}],70:[function(v,D,u){"use strict";var p=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",f=v("pako"),m=v("./utils"),h=v("./stream/GenericWorker"),b=p?"uint8array":"array";u.magic="\b\0";function t(i,n){h.call(this,"FlateWorker/"+i),this._pako=null,this._pakoAction=i,this._pakoOptions=n,this.meta={}}m.inherits(t,h),t.prototype.processChunk=function(i){this.meta=i.meta,this._pako===null&&this._createPako(),this._pako.push(m.transformTo(b,i.data),!1)},t.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},t.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},t.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var i=this;this._pako.onData=function(n){i.push({data:n,meta:i.meta})}},u.compressWorker=function(i){return new t("Deflate",i)},u.uncompressWorker=function(){return new t("Inflate",{})}},{"./stream/GenericWorker":90,"./utils":94,pako:99}],71:[function(v,D,u){"use strict";var p=v("../utils"),f=v("../stream/GenericWorker"),m=v("../utf8"),h=v("../crc32"),b=v("../signature"),t=function(e,d){var y="",A;for(A=0;A<d;A++)y+=String.fromCharCode(e&255),e=e>>>8;return y},i=function(e,d){var y=e;return e||(y=d?16893:33204),(y&65535)<<16},n=function(e,d){return(e||0)&63},o=function(e,d,y,A,E,T){var _=e.file,S=e.compression,N=T!==m.utf8encode,L=p.transformTo("string",T(_.name)),H=p.transformTo("string",m.utf8encode(_.name)),P=_.comment,K=p.transformTo("string",T(P)),te=p.transformTo("string",m.utf8encode(P)),se=H.length!==_.name.length,B=te.length!==P.length,k,F,$="",oe="",Ee="",he=_.dir,W=_.date,V={crc32:0,compressedSize:0,uncompressedSize:0};(!d||y)&&(V.crc32=e.crc32,V.compressedSize=e.compressedSize,V.uncompressedSize=e.uncompressedSize);var Q=0;d&&(Q|=8),!N&&(se||B)&&(Q|=2048);var be=0,Z=0;he&&(be|=16),E==="UNIX"?(Z=798,be|=i(_.unixPermissions,he)):(Z=20,be|=n(_.dosPermissions,he)),k=W.getUTCHours(),k=k<<6,k=k|W.getUTCMinutes(),k=k<<5,k=k|W.getUTCSeconds()/2,F=W.getUTCFullYear()-1980,F=F<<4,F=F|W.getUTCMonth()+1,F=F<<5,F=F|W.getUTCDate(),se&&(oe=t(1,1)+t(h(L),4)+H,$+="up"+t(oe.length,2)+oe),B&&(Ee=t(1,1)+t(h(K),4)+te,$+="uc"+t(Ee.length,2)+Ee);var Y="";Y+=`
\0`,Y+=t(Q,2),Y+=S.magic,Y+=t(k,2),Y+=t(F,2),Y+=t(V.crc32,4),Y+=t(V.compressedSize,4),Y+=t(V.uncompressedSize,4),Y+=t(L.length,2),Y+=t($.length,2);var q=b.LOCAL_FILE_HEADER+Y+L+$,ue=b.CENTRAL_FILE_HEADER+t(Z,2)+Y+t(K.length,2)+"\0\0\0\0"+t(be,4)+t(A,4)+L+$+K;return{fileRecord:q,dirRecord:ue}},w=function(e,d,y,A,E){var T="",_=p.transformTo("string",E(A));return T=b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(e,2)+t(e,2)+t(d,4)+t(y,4)+t(_.length,2)+_,T},g=function(e){var d="";return d=b.DATA_DESCRIPTOR+t(e.crc32,4)+t(e.compressedSize,4)+t(e.uncompressedSize,4),d};function l(e,d,y,A){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=d,this.zipPlatform=y,this.encodeFileName=A,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}p.inherits(l,f),l.prototype.push=function(e){var d=e.meta.percent||0,y=this.entriesCount,A=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,f.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:y?(d+100*(y-A-1))/y:100}}))},l.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var d=this.streamFiles&&!e.file.dir;if(d){var y=o(e,d,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:y.fileRecord,meta:{percent:0}})}else this.accumulate=!0},l.prototype.closedSource=function(e){this.accumulate=!1;var d=this.streamFiles&&!e.file.dir,y=o(e,d,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(y.dirRecord),d)this.push({data:g(e),meta:{percent:100}});else for(this.push({data:y.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var e=this.bytesWritten,d=0;d<this.dirRecords.length;d++)this.push({data:this.dirRecords[d],meta:{percent:100}});var y=this.bytesWritten-e,A=w(this.dirRecords.length,y,e,this.zipComment,this.encodeFileName);this.push({data:A,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(e){this._sources.push(e);var d=this;return e.on("data",function(y){d.processChunk(y)}),e.on("end",function(){d.closedSource(d.previous.streamInfo),d._sources.length?d.prepareNextSource():d.end()}),e.on("error",function(y){d.error(y)}),this},l.prototype.resume=function(){if(!f.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},l.prototype.error=function(e){var d=this._sources;if(!f.prototype.error.call(this,e))return!1;for(var y=0;y<d.length;y++)try{d[y].error(e)}catch(A){}return!0},l.prototype.lock=function(){f.prototype.lock.call(this);for(var e=this._sources,d=0;d<e.length;d++)e[d].lock()},D.exports=l},{"../crc32":67,"../signature":85,"../stream/GenericWorker":90,"../utf8":93,"../utils":94}],72:[function(v,D,u){"use strict";var p=v("../compressions"),f=v("./ZipFileWorker"),m=function(h,b){var t=h||b,i=p[t];if(!i)throw new Error(t+" is not a valid compression method !");return i};u.generateWorker=function(h,b,t){var i=new f(b.streamFiles,t,b.platform,b.encodeFileName),n=0;try{h.forEach(function(o,w){n++;var g=m(w.options.compression,b.compression),l=w.options.compressionOptions||b.compressionOptions||{},e=w.dir,d=w.date;w._compressWorker(g,l).withStreamInfo("file",{name:o,dir:e,date:d,comment:w.comment||"",unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions}).pipe(i)}),i.entriesCount=n}catch(o){i.error(o)}return i}},{"../compressions":66,"./ZipFileWorker":71}],73:[function(v,D,u){"use strict";var p=v("./utils"),f=v("./external"),m=v("./utf8"),p=v("./utils"),h=v("./zipEntries"),b=v("./stream/Crc32Probe"),t=v("./nodejsUtils");function i(n){return new f.Promise(function(o,w){var g=n.decompressed.getContentWorker().pipe(new b);g.on("error",function(l){w(l)}).on("end",function(){g.streamInfo.crc32!==n.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):o()}).resume()})}D.exports=function(n,o){var w=this;return o=p.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:m.utf8decode}),t.isNode&&t.isStream(n)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):p.prepareContent("the loaded zip file",n,!0,o.optimizedBinaryString,o.base64).then(function(g){var l=new h(o);return l.load(g),l}).then(function(l){var e=[f.Promise.resolve(l)],d=l.files;if(o.checkCRC32)for(var y=0;y<d.length;y++)e.push(i(d[y]));return f.Promise.all(e)}).then(function(l){for(var e=l.shift(),d=e.files,y=0;y<d.length;y++){var A=d[y];w.file(A.fileNameStr,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:o.createFolders})}return e.zipComment.length&&(w.comment=e.zipComment),w})}},{"./external":69,"./nodejsUtils":74,"./stream/Crc32Probe":87,"./utf8":93,"./utils":94,"./zipEntries":95}],74:[function(v,D,u){(function(p){(function(){"use strict";D.exports={isNode:typeof p!="undefined",newBufferFrom:function(f,m){if(p.from&&p.from!==Uint8Array.from)return p.from(f,m);if(typeof f=="number")throw new Error('The "data" argument must not be a number');return new p(f,m)},allocBuffer:function(f){if(p.alloc)return p.alloc(f);var m=new p(f);return m.fill(0),m},isBuffer:function(f){return p.isBuffer(f)},isStream:function(f){return f&&typeof f.on=="function"&&typeof f.pause=="function"&&typeof f.resume=="function"}}}).call(this)}).call(this,v("buffer").Buffer)},{buffer:11}],75:[function(v,D,u){"use strict";var p=v("../utils"),f=v("../stream/GenericWorker");function m(h,b){f.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(b)}p.inherits(m,f),m.prototype._bindStream=function(h){var b=this;this._stream=h,h.pause(),h.on("data",function(t){b.push({data:t,meta:{percent:0}})}).on("error",function(t){b.isPaused?this.generatedError=t:b.error(t)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},m.prototype.pause=function(){return f.prototype.pause.call(this)?(this._stream.pause(),!0):!1},m.prototype.resume=function(){return f.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},D.exports=m},{"../stream/GenericWorker":90,"../utils":94}],76:[function(v,D,u){"use strict";var p=v("readable-stream").Readable,f=v("../utils");f.inherits(m,p);function m(h,b,t){p.call(this,b),this._helper=h;var i=this;h.on("data",function(n,o){i.push(n)||i._helper.pause(),t&&t(o)}).on("error",function(n){i.emit("error",n)}).on("end",function(){i.push(null)})}m.prototype._read=function(){this._helper.resume()},D.exports=m},{"../utils":94,"readable-stream":78}],77:[function(v,D,u){"use strict";var p=v("./utf8"),f=v("./utils"),m=v("./stream/GenericWorker"),h=v("./stream/StreamHelper"),b=v("./defaults"),t=v("./compressedObject"),i=v("./zipObject"),n=v("./generate"),o=v("./nodejsUtils"),w=v("./nodejs/NodejsStreamInputAdapter"),g=function(E,T,_){var S=f.getTypeOf(T),N,L=f.extend(_||{},b);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&L.unixPermissions&16384&&(L.dir=!0),L.dosPermissions&&L.dosPermissions&16&&(L.dir=!0),L.dir&&(E=e(E)),L.createFolders&&(N=l(E))&&d.call(this,N,!0);var H=S==="string"&&L.binary===!1&&L.base64===!1;(!_||typeof _.binary=="undefined")&&(L.binary=!H);var P=T instanceof t&&T.uncompressedSize===0;(P||L.dir||!T||T.length===0)&&(L.base64=!1,L.binary=!0,T="",L.compression="STORE",S="string");var K=null;T instanceof t||T instanceof m?K=T:o.isNode&&o.isStream(T)?K=new w(E,T):K=f.prepareContent(E,T,L.binary,L.optimizedBinaryString,L.base64);var te=new i(E,K,L);this.files[E]=te},l=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var T=E.lastIndexOf("/");return T>0?E.substring(0,T):""},e=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},d=function(E,T){return T=typeof T!="undefined"?T:b.createFolders,E=e(E),this.files[E]||g.call(this,E,null,{dir:!0,createFolders:T}),this.files[E]};function y(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var T,_,S;for(T in this.files){if(!this.files.hasOwnProperty(T))continue;S=this.files[T],_=T.slice(this.root.length,T.length),_&&T.slice(0,this.root.length)===this.root&&E(_,S)}},filter:function(E){var T=[];return this.forEach(function(_,S){E(_,S)&&T.push(S)}),T},file:function(E,T,_){if(arguments.length===1)if(y(E)){var S=E;return this.filter(function(L,H){return!H.dir&&S.test(L)})}else{var N=this.files[this.root+E];return N&&!N.dir?N:null}else E=this.root+E,g.call(this,E,T,_);return this},folder:function(E){if(!E)return this;if(y(E))return this.filter(function(N,L){return L.dir&&E.test(N)});var T=this.root+E,_=d.call(this,T),S=this.clone();return S.root=_.name,S},remove:function(E){E=this.root+E;var T=this.files[E];if(T||(E.slice(-1)!=="/"&&(E+="/"),T=this.files[E]),T&&!T.dir)delete this.files[E];else for(var _=this.filter(function(N,L){return L.name.slice(0,E.length)===E}),S=0;S<_.length;S++)delete this.files[_[S].name];return this},generate:function(E){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var T,_={};try{if(_=f.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:p.utf8encode}),_.type=_.type.toLowerCase(),_.compression=_.compression.toUpperCase(),_.type==="binarystring"&&(_.type="string"),!_.type)throw new Error("No output type specified.");f.checkSupport(_.type),(_.platform==="darwin"||_.platform==="freebsd"||_.platform==="linux"||_.platform==="sunos")&&(_.platform="UNIX"),_.platform==="win32"&&(_.platform="DOS");var S=_.comment||this.comment||"";T=n.generateWorker(this,_,S)}catch(N){T=new m("error"),T.error(N)}return new h(T,_.type||"string",_.mimeType)},generateAsync:function(E,T){return this.generateInternalStream(E).accumulate(T)},generateNodeStream:function(E,T){return E=E||{},E.type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(T)}};D.exports=A},{"./compressedObject":65,"./defaults":68,"./generate":72,"./nodejs/NodejsStreamInputAdapter":75,"./nodejsUtils":74,"./stream/GenericWorker":90,"./stream/StreamHelper":91,"./utf8":93,"./utils":94,"./zipObject":97}],78:[function(v,D,u){D.exports=v("stream")},{stream:41}],79:[function(v,D,u){"use strict";var p=v("./DataReader"),f=v("../utils");function m(h){p.call(this,h);for(var b=0;b<this.data.length;b++)h[b]=h[b]&255}f.inherits(m,p),m.prototype.byteAt=function(h){return this.data[this.zero+h]},m.prototype.lastIndexOfSignature=function(h){for(var b=h.charCodeAt(0),t=h.charCodeAt(1),i=h.charCodeAt(2),n=h.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===b&&this.data[o+1]===t&&this.data[o+2]===i&&this.data[o+3]===n)return o-this.zero;return-1},m.prototype.readAndCheckSignature=function(h){var b=h.charCodeAt(0),t=h.charCodeAt(1),i=h.charCodeAt(2),n=h.charCodeAt(3),o=this.readData(4);return b===o[0]&&t===o[1]&&i===o[2]&&n===o[3]},m.prototype.readData=function(h){if(this.checkOffset(h),h===0)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,b},D.exports=m},{"../utils":94,"./DataReader":80}],80:[function(v,D,u){"use strict";var p=v("../utils");function f(m){this.data=m,this.length=m.length,this.index=0,this.zero=0}f.prototype={checkOffset:function(m){this.checkIndex(this.index+m)},checkIndex:function(m){if(this.length<this.zero+m||m<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+m+"). Corrupted zip ?")},setIndex:function(m){this.checkIndex(m),this.index=m},skip:function(m){this.setIndex(this.index+m)},byteAt:function(m){},readInt:function(m){var h=0,b;for(this.checkOffset(m),b=this.index+m-1;b>=this.index;b--)h=(h<<8)+this.byteAt(b);return this.index+=m,h},readString:function(m){return p.transformTo("string",this.readData(m))},readData:function(m){},lastIndexOfSignature:function(m){},readAndCheckSignature:function(m){},readDate:function(){var m=this.readInt(4);return new Date(Date.UTC((m>>25&127)+1980,(m>>21&15)-1,m>>16&31,m>>11&31,m>>5&63,(m&31)<<1))}},D.exports=f},{"../utils":94}],81:[function(v,D,u){"use strict";var p=v("./Uint8ArrayReader"),f=v("../utils");function m(h){p.call(this,h)}f.inherits(m,p),m.prototype.readData=function(h){this.checkOffset(h);var b=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,b},D.exports=m},{"../utils":94,"./Uint8ArrayReader":83}],82:[function(v,D,u){"use strict";var p=v("./DataReader"),f=v("../utils");function m(h){p.call(this,h)}f.inherits(m,p),m.prototype.byteAt=function(h){return this.data.charCodeAt(this.zero+h)},m.prototype.lastIndexOfSignature=function(h){return this.data.lastIndexOf(h)-this.zero},m.prototype.readAndCheckSignature=function(h){var b=this.readData(4);return h===b},m.prototype.readData=function(h){this.checkOffset(h);var b=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,b},D.exports=m},{"../utils":94,"./DataReader":80}],83:[function(v,D,u){"use strict";var p=v("./ArrayReader"),f=v("../utils");function m(h){p.call(this,h)}f.inherits(m,p),m.prototype.readData=function(h){if(this.checkOffset(h),h===0)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+h);return this.index+=h,b},D.exports=m},{"../utils":94,"./ArrayReader":79}],84:[function(v,D,u){"use strict";var p=v("../utils"),f=v("../support"),m=v("./ArrayReader"),h=v("./StringReader"),b=v("./NodeBufferReader"),t=v("./Uint8ArrayReader");D.exports=function(i){var n=p.getTypeOf(i);return p.checkSupport(n),n==="string"&&!f.uint8array?new h(i):n==="nodebuffer"?new b(i):f.uint8array?new t(p.transformTo("uint8array",i)):new m(p.transformTo("array",i))}},{"../support":92,"../utils":94,"./ArrayReader":79,"./NodeBufferReader":81,"./StringReader":82,"./Uint8ArrayReader":83}],85:[function(v,D,u){"use strict";u.LOCAL_FILE_HEADER="PK",u.CENTRAL_FILE_HEADER="PK",u.CENTRAL_DIRECTORY_END="PK",u.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",u.ZIP64_CENTRAL_DIRECTORY_END="PK",u.DATA_DESCRIPTOR="PK\x07\b"},{}],86:[function(v,D,u){"use strict";var p=v("./GenericWorker"),f=v("../utils");function m(h){p.call(this,"ConvertWorker to "+h),this.destType=h}f.inherits(m,p),m.prototype.processChunk=function(h){this.push({data:f.transformTo(this.destType,h.data),meta:h.meta})},D.exports=m},{"../utils":94,"./GenericWorker":90}],87:[function(v,D,u){"use strict";var p=v("./GenericWorker"),f=v("../crc32"),m=v("../utils");function h(){p.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}m.inherits(h,p),h.prototype.processChunk=function(b){this.streamInfo.crc32=f(b.data,this.streamInfo.crc32||0),this.push(b)},D.exports=h},{"../crc32":67,"../utils":94,"./GenericWorker":90}],88:[function(v,D,u){"use strict";var p=v("../utils"),f=v("./GenericWorker");function m(h){f.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}p.inherits(m,f),m.prototype.processChunk=function(h){if(h){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+h.data.length}f.prototype.processChunk.call(this,h)},D.exports=m},{"../utils":94,"./GenericWorker":90}],89:[function(v,D,u){"use strict";var p=v("../utils"),f=v("./GenericWorker"),m=16*1024;function h(b){f.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,b.then(function(i){t.dataIsReady=!0,t.data=i,t.max=i&&i.length||0,t.type=p.getTypeOf(i),t.isPaused||t._tickAndRepeat()},function(i){t.error(i)})}p.inherits(h,f),h.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},h.prototype.resume=function(){return f.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,p.delay(this._tickAndRepeat,[],this)),!0):!1},h.prototype._tickAndRepeat=function(){if(this._tickScheduled=!1,this.isPaused||this.isFinished)return;this._tick(),this.isFinished||(p.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},h.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var b=m,t=null,i=Math.min(this.max,this.index+b);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,i);break;case"uint8array":t=this.data.subarray(this.index,i);break;case"array":case"nodebuffer":t=this.data.slice(this.index,i);break}return this.index=i,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},D.exports=h},{"../utils":94,"./GenericWorker":90}],90:[function(v,D,u){"use strict";function p(f){this.name=f||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}p.prototype={push:function(f){this.emit("data",f)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(f){return this.isFinished?!1:(this.isPaused?this.generatedError=f:(this.isFinished=!0,this.emit("error",f),this.previous&&this.previous.error(f),this.cleanUp()),!0)},on:function(f,m){return this._listeners[f].push(m),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(f,m){if(this._listeners[f])for(var h=0;h<this._listeners[f].length;h++)this._listeners[f][h].call(this,m)},pipe:function(f){return f.registerPrevious(this)},registerPrevious:function(f){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=f.streamInfo,this.mergeStreamInfo(),this.previous=f;var m=this;return f.on("data",function(h){m.processChunk(h)}),f.on("end",function(){m.end()}),f.on("error",function(h){m.error(h)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var f=!1;return this.generatedError&&(this.error(this.generatedError),f=!0),this.previous&&this.previous.resume(),!f},flush:function(){},processChunk:function(f){this.push(f)},withStreamInfo:function(f,m){return this.extraStreamInfo[f]=m,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var f in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(f))continue;this.streamInfo[f]=this.extraStreamInfo[f]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var f="Worker "+this.name;return this.previous?this.previous+" -> "+f:f}},D.exports=p},{}],91:[function(v,D,u){(function(p){(function(){"use strict";var f=v("../utils"),m=v("./ConvertWorker"),h=v("./GenericWorker"),b=v("../base64"),t=v("../support"),i=v("../external"),n=null;if(t.nodestream)try{n=v("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function o(e,d,y){switch(e){case"blob":return f.newBlob(f.transformTo("arraybuffer",d),y);case"base64":return b.encode(d);default:return f.transformTo(e,d)}}function w(e,d){var y,A=0,E=null,T=0;for(y=0;y<d.length;y++)T+=d[y].length;switch(e){case"string":return d.join("");case"array":return Array.prototype.concat.apply([],d);case"uint8array":for(E=new Uint8Array(T),y=0;y<d.length;y++)E.set(d[y],A),A+=d[y].length;return E;case"nodebuffer":return p.concat(d);default:throw new Error("concat : unsupported type '"+e+"'")}}function g(e,d){return new i.Promise(function(y,A){var E=[],T=e._internalType,_=e._outputType,S=e._mimeType;e.on("data",function(N,L){E.push(N),d&&d(L)}).on("error",function(N){E=[],A(N)}).on("end",function(){try{var N=o(_,w(T,E),S);y(N)}catch(L){A(L)}E=[]}).resume()})}function l(e,d,y){var A=d;switch(d){case"blob":case"arraybuffer":A="uint8array";break;case"base64":A="string";break}try{this._internalType=A,this._outputType=d,this._mimeType=y,f.checkSupport(A),this._worker=e.pipe(new m(A)),e.lock()}catch(E){this._worker=new h("error"),this._worker.error(E)}}l.prototype={accumulate:function(e){return g(this,e)},on:function(e,d){var y=this;return e==="data"?this._worker.on(e,function(A){d.call(y,A.data,A.meta)}):this._worker.on(e,function(){f.delay(d,arguments,y)}),this},resume:function(){return f.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(f.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new n(this,{objectMode:this._outputType!=="nodebuffer"},e)}},D.exports=l}).call(this)}).call(this,v("buffer").Buffer)},{"../base64":64,"../external":69,"../nodejs/NodejsStreamOutputAdapter":76,"../support":92,"../utils":94,"./ConvertWorker":86,"./GenericWorker":90,buffer:11}],92:[function(v,D,u){(function(p){(function(){"use strict";if(u.base64=!0,u.array=!0,u.string=!0,u.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",u.nodebuffer=typeof p!="undefined",u.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")u.blob=!1;else{var f=new ArrayBuffer(0);try{u.blob=new Blob([f],{type:"application/zip"}).size===0}catch(b){try{var m=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,h=new m;h.append(f),u.blob=h.getBlob("application/zip").size===0}catch(t){u.blob=!1}}}try{u.nodestream=!!v("readable-stream").Readable}catch(b){u.nodestream=!1}}).call(this)}).call(this,v("buffer").Buffer)},{buffer:11,"readable-stream":78}],93:[function(v,D,u){"use strict";for(var p=v("./utils"),f=v("./support"),m=v("./nodejsUtils"),h=v("./stream/GenericWorker"),b=new Array(256),t=0;t<256;t++)b[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;b[254]=b[254]=1;var i=function(l){var e,d,y,A,E,T=l.length,_=0;for(A=0;A<T;A++)d=l.charCodeAt(A),(d&64512)===55296&&A+1<T&&(y=l.charCodeAt(A+1),(y&64512)===56320&&(d=65536+(d-55296<<10)+(y-56320),A++)),_+=d<128?1:d<2048?2:d<65536?3:4;for(f.uint8array?e=new Uint8Array(_):e=new Array(_),E=0,A=0;E<_;A++)d=l.charCodeAt(A),(d&64512)===55296&&A+1<T&&(y=l.charCodeAt(A+1),(y&64512)===56320&&(d=65536+(d-55296<<10)+(y-56320),A++)),d<128?e[E++]=d:d<2048?(e[E++]=192|d>>>6,e[E++]=128|d&63):d<65536?(e[E++]=224|d>>>12,e[E++]=128|d>>>6&63,e[E++]=128|d&63):(e[E++]=240|d>>>18,e[E++]=128|d>>>12&63,e[E++]=128|d>>>6&63,e[E++]=128|d&63);return e},n=function(l,e){var d;for(e=e||l.length,e>l.length&&(e=l.length),d=e-1;d>=0&&(l[d]&192)===128;)d--;return d<0||d===0?e:d+b[l[d]]>e?d:e},o=function(l){var e,d,y,A,E,T=l.length,_=new Array(T*2);for(y=0,d=0;d<T;){if(A=l[d++],A<128){_[y++]=A;continue}if(E=b[A],E>4){_[y++]=65533,d+=E-1;continue}for(A&=E===2?31:E===3?15:7;E>1&&d<T;)A=A<<6|l[d++]&63,E--;if(E>1){_[y++]=65533;continue}A<65536?_[y++]=A:(A-=65536,_[y++]=55296|A>>10&1023,_[y++]=56320|A&1023)}return _.length!==y&&(_.subarray?_=_.subarray(0,y):_.length=y),p.applyFromCharCode(_)};u.utf8encode=function(e){return f.nodebuffer?m.newBufferFrom(e,"utf-8"):i(e)},u.utf8decode=function(e){return f.nodebuffer?p.transformTo("nodebuffer",e).toString("utf-8"):(e=p.transformTo(f.uint8array?"uint8array":"array",e),o(e))};function w(){h.call(this,"utf-8 decode"),this.leftOver=null}p.inherits(w,h),w.prototype.processChunk=function(l){var e=p.transformTo(f.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var d=e;e=new Uint8Array(d.length+this.leftOver.length),e.set(this.leftOver,0),e.set(d,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var y=n(e),A=e;y!==e.length&&(f.uint8array?(A=e.subarray(0,y),this.leftOver=e.subarray(y,e.length)):(A=e.slice(0,y),this.leftOver=e.slice(y,e.length))),this.push({data:u.utf8decode(A),meta:l.meta})},w.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:u.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},u.Utf8DecodeWorker=w;function g(){h.call(this,"utf-8 encode")}p.inherits(g,h),g.prototype.processChunk=function(l){this.push({data:u.utf8encode(l.data),meta:l.meta})},u.Utf8EncodeWorker=g},{"./nodejsUtils":74,"./stream/GenericWorker":90,"./support":92,"./utils":94}],94:[function(v,D,u){"use strict";var p=v("./support"),f=v("./base64"),m=v("./nodejsUtils"),h=v("set-immediate-shim"),b=v("./external");function t(e){var d=null;return p.uint8array?d=new Uint8Array(e.length):d=new Array(e.length),n(e,d)}u.newBlob=function(e,d){u.checkSupport("blob");try{return new Blob([e],{type:d})}catch(E){try{var y=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,A=new y;return A.append(e),A.getBlob(d)}catch(T){throw new Error("Bug : can't construct the Blob.")}}};function i(e){return e}function n(e,d){for(var y=0;y<e.length;++y)d[y]=e.charCodeAt(y)&255;return d}var o={stringifyByChunk:function(e,d,y){var A=[],E=0,T=e.length;if(T<=y)return String.fromCharCode.apply(null,e);for(;E<T;)d==="array"||d==="nodebuffer"?A.push(String.fromCharCode.apply(null,e.slice(E,Math.min(E+y,T)))):A.push(String.fromCharCode.apply(null,e.subarray(E,Math.min(E+y,T)))),E+=y;return A.join("")},stringifyByChar:function(e){for(var d="",y=0;y<e.length;y++)d+=String.fromCharCode(e[y]);return d},applyCanBeUsed:{uint8array:function(){try{return p.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return!1}}(),nodebuffer:function(){try{return p.nodebuffer&&String.fromCharCode.apply(null,m.allocBuffer(1)).length===1}catch(e){return!1}}()}};function w(e){var d=65536,y=u.getTypeOf(e),A=!0;if(y==="uint8array"?A=o.applyCanBeUsed.uint8array:y==="nodebuffer"&&(A=o.applyCanBeUsed.nodebuffer),A)for(;d>1;)try{return o.stringifyByChunk(e,y,d)}catch(E){d=Math.floor(d/2)}return o.stringifyByChar(e)}u.applyFromCharCode=w;function g(e,d){for(var y=0;y<e.length;y++)d[y]=e[y];return d}var l={};l.string={string:i,array:function(e){return n(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return n(e,new Uint8Array(e.length))},nodebuffer:function(e){return n(e,m.allocBuffer(e.length))}},l.array={string:w,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return m.newBufferFrom(e)}},l.arraybuffer={string:function(e){return w(new Uint8Array(e))},array:function(e){return g(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return m.newBufferFrom(new Uint8Array(e))}},l.uint8array={string:w,array:function(e){return g(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return m.newBufferFrom(e)}},l.nodebuffer={string:w,array:function(e){return g(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return g(e,new Uint8Array(e.length))},nodebuffer:i},u.transformTo=function(e,d){if(d||(d=""),!e)return d;u.checkSupport(e);var y=u.getTypeOf(d),A=l[y][e](d);return A},u.getTypeOf=function(e){if(typeof e=="string")return"string";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(p.nodebuffer&&m.isBuffer(e))return"nodebuffer";if(p.uint8array&&e instanceof Uint8Array)return"uint8array";if(p.arraybuffer&&e instanceof ArrayBuffer)return"arraybuffer"},u.checkSupport=function(e){var d=p[e.toLowerCase()];if(!d)throw new Error(e+" is not supported by this platform")},u.MAX_VALUE_16BITS=65535,u.MAX_VALUE_32BITS=-1,u.pretty=function(e){var d="",y,A;for(A=0;A<(e||"").length;A++)y=e.charCodeAt(A),d+="\\x"+(y<16?"0":"")+y.toString(16).toUpperCase();return d},u.delay=function(e,d,y){h(function(){e.apply(y||null,d||[])})},u.inherits=function(e,d){var y=function(){};y.prototype=d.prototype,e.prototype=new y},u.extend=function(){var e={},d,y;for(d=0;d<arguments.length;d++)for(y in arguments[d])arguments[d].hasOwnProperty(y)&&typeof e[y]=="undefined"&&(e[y]=arguments[d][y]);return e},u.prepareContent=function(e,d,y,A,E){var T=b.Promise.resolve(d).then(function(_){var S=p.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1);return S&&typeof FileReader!="undefined"?new b.Promise(function(N,L){var H=new FileReader;H.onload=function(P){N(P.target.result)},H.onerror=function(P){L(P.target.error)},H.readAsArrayBuffer(_)}):_});return T.then(function(_){var S=u.getTypeOf(_);return S?(S==="arraybuffer"?_=u.transformTo("uint8array",_):S==="string"&&(E?_=f.decode(_):y&&(A!==!0&&(_=t(_)))),_):b.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":64,"./external":69,"./nodejsUtils":74,"./support":92,"set-immediate-shim":136}],95:[function(v,D,u){"use strict";var p=v("./reader/readerFor"),f=v("./utils"),m=v("./signature"),h=v("./zipEntry"),b=v("./utf8"),t=v("./support");function i(n){this.files=[],this.loadOptions=n}i.prototype={checkSignature:function(n){if(!this.reader.readAndCheckSignature(n)){this.reader.index-=4;var o=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(o)+", expected "+f.pretty(n)+")")}},isSignature:function(n,o){var w=this.reader.index;this.reader.setIndex(n);var g=this.reader.readString(4),l=g===o;return this.reader.setIndex(w),l},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var n=this.reader.readData(this.zipCommentLength),o=t.uint8array?"uint8array":"array",w=f.transformTo(o,n);this.zipComment=this.loadOptions.decodeFileName(w)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var n=this.zip64EndOfCentralSize-44,o=0,w,g,l;o<n;)w=this.reader.readInt(2),g=this.reader.readInt(4),l=this.reader.readData(g),this.zip64ExtensibleData[w]={id:w,length:g,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var n,o;for(n=0;n<this.files.length;n++)o=this.files[n],this.reader.setIndex(o.localHeaderOffset),this.checkSignature(m.LOCAL_FILE_HEADER),o.readLocalPart(this.reader),o.handleUTF8(),o.processAttributes()},readCentralDir:function(){var n;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(m.CENTRAL_FILE_HEADER);)n=new h({zip64:this.zip64},this.loadOptions),n.readCentralPart(this.reader),this.files.push(n);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var n=this.reader.lastIndexOfSignature(m.CENTRAL_DIRECTORY_END);if(n<0){var o=!this.isSignature(0,m.LOCAL_FILE_HEADER);throw o?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(n);var w=n;if(this.checkSignature(m.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,n=this.reader.lastIndexOfSignature(m.ZIP64_CENTRAL_DIRECTORY_LOCATOR),n<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(n),this.checkSignature(m.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,m.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(m.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(m.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var l=w-g;if(l>0)this.isSignature(w,m.CENTRAL_FILE_HEADER)||(this.reader.zero=l);else if(l<0)throw new Error("Corrupted zip: missing "+Math.abs(l)+" bytes.")},prepareReader:function(n){this.reader=p(n)},load:function(n){this.prepareReader(n),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},D.exports=i},{"./reader/readerFor":84,"./signature":85,"./support":92,"./utf8":93,"./utils":94,"./zipEntry":96}],96:[function(v,D,u){"use strict";var p=v("./reader/readerFor"),f=v("./utils"),m=v("./compressedObject"),h=v("./crc32"),b=v("./utf8"),t=v("./compressions"),i=v("./support"),n=0,o=3,w=function(l){for(var e in t){if(!t.hasOwnProperty(e))continue;if(t[e].magic===l)return t[e]}return null};function g(l,e){this.options=l,this.loadOptions=e}g.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(l){var e,d;if(l.skip(22),this.fileNameLength=l.readInt(2),d=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(e=w(this.compressionMethod),e===null)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new m(this.compressedSize,this.uncompressedSize,this.crc32,e,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var e=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(e),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),l===n&&(this.dosPermissions=this.externalFileAttributes&63),l===o&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(l){if(!this.extraFields[1])return;var e=p(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))},readExtraFields:function(l){var e=l.index+this.extraFieldsLength,d,y,A;for(this.extraFields||(this.extraFields={});l.index+4<e;)d=l.readInt(2),y=l.readInt(2),A=l.readData(y),this.extraFields[d]={id:d,length:y,value:A};l.setIndex(e)},handleUTF8:function(){var l=i.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=b.utf8decode(this.fileName),this.fileCommentStr=b.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(e!==null)this.fileNameStr=e;else{var d=f.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var A=f.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(A)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var e=p(l.value);return e.readInt(1)!==1||h(this.fileName)!==e.readInt(4)?null:b.utf8decode(e.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var e=p(l.value);return e.readInt(1)!==1||h(this.fileComment)!==e.readInt(4)?null:b.utf8decode(e.readData(l.length-5))}return null}},D.exports=g},{"./compressedObject":65,"./compressions":66,"./crc32":67,"./reader/readerFor":84,"./support":92,"./utf8":93,"./utils":94}],97:[function(v,D,u){"use strict";var p=v("./stream/StreamHelper"),f=v("./stream/DataWorker"),m=v("./utf8"),h=v("./compressedObject"),b=v("./stream/GenericWorker"),t=function(w,g,l){this.name=w,this.dir=l.dir,this.date=l.date,this.comment=l.comment,this.unixPermissions=l.unixPermissions,this.dosPermissions=l.dosPermissions,this._data=g,this._dataBinary=l.binary,this.options={compression:l.compression,compressionOptions:l.compressionOptions}};t.prototype={internalStream:function(w){var g=null,l="string";try{if(!w)throw new Error("No output type specified.");l=w.toLowerCase();var e=l==="string"||l==="text";(l==="binarystring"||l==="text")&&(l="string"),g=this._decompressWorker();var d=!this._dataBinary;d&&!e&&(g=g.pipe(new m.Utf8EncodeWorker)),!d&&e&&(g=g.pipe(new m.Utf8DecodeWorker))}catch(y){g=new b("error"),g.error(y)}return new p(g,l,"")},async:function(w,g){return this.internalStream(w).accumulate(g)},nodeStream:function(w,g){return this.internalStream(w||"nodebuffer").toNodejsStream(g)},_compressWorker:function(w,g){if(this._data instanceof h&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var l=this._decompressWorker();return this._dataBinary||(l=l.pipe(new m.Utf8EncodeWorker)),h.createWorkerFrom(l,w,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof b?this._data:new f(this._data)}};for(var i=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],n=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},o=0;o<i.length;o++)t.prototype[i[o]]=n;D.exports=t},{"./compressedObject":65,"./stream/DataWorker":89,"./stream/GenericWorker":90,"./stream/StreamHelper":91,"./utf8":93}],98:[function(v,D,u){"use strict";var p=v("immediate");function f(){}var m={},h=["REJECTED"],b=["FULFILLED"],t=["PENDING"];D.exports=i;function i(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=t,this.queue=[],this.outcome=void 0,E!==f&&g(this,E)}i.prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(_,S);function _(N){function L(){return N}return T.resolve(E()).then(L)}function S(N){function L(){throw N}return T.resolve(E()).then(L)}},i.prototype.catch=function(E){return this.then(null,E)},i.prototype.then=function(E,T){if(typeof E!="function"&&this.state===b||typeof T!="function"&&this.state===h)return this;var _=new this.constructor(f);if(this.state!==t){var S=this.state===b?E:T;o(_,S,this.outcome)}else this.queue.push(new n(_,E,T));return _};function n(E,T,_){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}n.prototype.callFulfilled=function(E){m.resolve(this.promise,E)},n.prototype.otherCallFulfilled=function(E){o(this.promise,this.onFulfilled,E)},n.prototype.callRejected=function(E){m.reject(this.promise,E)},n.prototype.otherCallRejected=function(E){o(this.promise,this.onRejected,E)};function o(E,T,_){p(function(){var S;try{S=T(_)}catch(N){return m.reject(E,N)}S===E?m.reject(E,new TypeError("Cannot resolve promise with itself")):m.resolve(E,S)})}m.resolve=function(E,T){var _=l(w,T);if(_.status==="error")return m.reject(E,_.value);var S=_.value;if(S)g(E,S);else{E.state=b,E.outcome=T;for(var N=-1,L=E.queue.length;++N<L;)E.queue[N].callFulfilled(T)}return E},m.reject=function(E,T){E.state=h,E.outcome=T;for(var _=-1,S=E.queue.length;++_<S;)E.queue[_].callRejected(T);return E};function w(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function g(E,T){var _=!1;function S(P){if(_)return;_=!0,m.reject(E,P)}function N(P){if(_)return;_=!0,m.resolve(E,P)}function L(){T(N,S)}var H=l(L);H.status==="error"&&S(H.value)}function l(E,T){var _={};try{_.value=E(T),_.status="success"}catch(S){_.status="error",_.value=S}return _}i.resolve=e;function e(E){return E instanceof this?E:m.resolve(new this(f),E)}i.reject=d;function d(E){var T=new this(f);return m.reject(T,E)}i.all=y;function y(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=E.length,S=!1;if(!_)return this.resolve([]);for(var N=new Array(_),L=0,H=-1,P=new this(f);++H<_;)K(E[H],H);return P;function K(te,se){T.resolve(te).then(B,function(k){S||(S=!0,m.reject(P,k))});function B(k){N[se]=k,++L===_&&!S&&(S=!0,m.resolve(P,N))}}}i.race=A;function A(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=E.length,S=!1;if(!_)return this.resolve([]);for(var N=-1,L=new this(f);++N<_;)H(E[N]);return L;function H(P){T.resolve(P).then(function(K){S||(S=!0,m.resolve(L,K))},function(K){S||(S=!0,m.reject(L,K))})}}},{immediate:63}],99:[function(v,D,u){"use strict";var p=v("./lib/utils/common").assign,f=v("./lib/deflate"),m=v("./lib/inflate"),h=v("./lib/zlib/constants"),b={};p(b,f,m,h),D.exports=b},{"./lib/deflate":100,"./lib/inflate":101,"./lib/utils/common":102,"./lib/zlib/constants":105}],100:[function(v,D,u){"use strict";var p=v("./zlib/deflate"),f=v("./utils/common"),m=v("./utils/strings"),h=v("./zlib/messages"),b=v("./zlib/zstream"),t=Object.prototype.toString,i=0,n=4,o=0,w=1,g=2,l=-1,e=0,d=8;function y(_){if(!(this instanceof y))return new y(_);this.options=f.assign({level:l,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:e,to:""},_||{});var S=this.options;S.raw&&S.windowBits>0?S.windowBits=-S.windowBits:S.gzip&&S.windowBits>0&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var N=p.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(N!==o)throw new Error(h[N]);if(S.header&&p.deflateSetHeader(this.strm,S.header),S.dictionary){var L;if(typeof S.dictionary=="string"?L=m.string2buf(S.dictionary):t.call(S.dictionary)==="[object ArrayBuffer]"?L=new Uint8Array(S.dictionary):L=S.dictionary,N=p.deflateSetDictionary(this.strm,L),N!==o)throw new Error(h[N]);this._dict_set=!0}}y.prototype.push=function(_,S){var N=this.strm,L=this.options.chunkSize,H,P;if(this.ended)return!1;P=S===~~S?S:S===!0?n:i,typeof _=="string"?N.input=m.string2buf(_):t.call(_)==="[object ArrayBuffer]"?N.input=new Uint8Array(_):N.input=_,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new f.Buf8(L),N.next_out=0,N.avail_out=L),H=p.deflate(N,P),H!==w&&H!==o)return this.onEnd(H),this.ended=!0,!1;(N.avail_out===0||N.avail_in===0&&(P===n||P===g))&&(this.options.to==="string"?this.onData(m.buf2binstring(f.shrinkBuf(N.output,N.next_out))):this.onData(f.shrinkBuf(N.output,N.next_out)))}while((N.avail_in>0||N.avail_out===0)&&H!==w);return P===n?(H=p.deflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===o):(P===g&&(this.onEnd(o),N.avail_out=0),!0)},y.prototype.onData=function(_){this.chunks.push(_)},y.prototype.onEnd=function(_){_===o&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg};function A(_,S){var N=new y(S);if(N.push(_,!0),N.err)throw N.msg||h[N.err];return N.result}function E(_,S){return S=S||{},S.raw=!0,A(_,S)}function T(_,S){return S=S||{},S.gzip=!0,A(_,S)}u.Deflate=y,u.deflate=A,u.deflateRaw=E,u.gzip=T},{"./utils/common":102,"./utils/strings":103,"./zlib/deflate":107,"./zlib/messages":112,"./zlib/zstream":114}],101:[function(v,D,u){"use strict";var p=v("./zlib/inflate"),f=v("./utils/common"),m=v("./utils/strings"),h=v("./zlib/constants"),b=v("./zlib/messages"),t=v("./zlib/zstream"),i=v("./zlib/gzheader"),n=Object.prototype.toString;function o(l){if(!(this instanceof o))return new o(l);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},l||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(l&&l.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&((e.windowBits&15)===0&&(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;var d=p.inflateInit2(this.strm,e.windowBits);if(d!==h.Z_OK)throw new Error(b[d]);if(this.header=new i,p.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=m.string2buf(e.dictionary):n.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(d=p.inflateSetDictionary(this.strm,e.dictionary),d!==h.Z_OK)))throw new Error(b[d])}o.prototype.push=function(l,e){var d=this.strm,y=this.options.chunkSize,A=this.options.dictionary,E,T,_,S,N,L=!1;if(this.ended)return!1;T=e===~~e?e:e===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof l=="string"?d.input=m.binstring2buf(l):n.call(l)==="[object ArrayBuffer]"?d.input=new Uint8Array(l):d.input=l,d.next_in=0,d.avail_in=d.input.length;do{if(d.avail_out===0&&(d.output=new f.Buf8(y),d.next_out=0,d.avail_out=y),E=p.inflate(d,h.Z_NO_FLUSH),E===h.Z_NEED_DICT&&A&&(E=p.inflateSetDictionary(this.strm,A)),E===h.Z_BUF_ERROR&&L===!0&&(E=h.Z_OK,L=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),this.ended=!0,!1;d.next_out&&((d.avail_out===0||E===h.Z_STREAM_END||d.avail_in===0&&(T===h.Z_FINISH||T===h.Z_SYNC_FLUSH))&&(this.options.to==="string"?(_=m.utf8border(d.output,d.next_out),S=d.next_out-_,N=m.buf2string(d.output,_),d.next_out=S,d.avail_out=y-S,S&&f.arraySet(d.output,d.output,_,S,0),this.onData(N)):this.onData(f.shrinkBuf(d.output,d.next_out)))),d.avail_in===0&&d.avail_out===0&&(L=!0)}while((d.avail_in>0||d.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=p.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):(T===h.Z_SYNC_FLUSH&&(this.onEnd(h.Z_OK),d.avail_out=0),!0)},o.prototype.onData=function(l){this.chunks.push(l)},o.prototype.onEnd=function(l){l===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function w(l,e){var d=new o(e);if(d.push(l,!0),d.err)throw d.msg||b[d.err];return d.result}function g(l,e){return e=e||{},e.raw=!0,w(l,e)}u.Inflate=o,u.inflate=w,u.inflateRaw=g,u.ungzip=w},{"./utils/common":102,"./utils/strings":103,"./zlib/constants":105,"./zlib/gzheader":108,"./zlib/inflate":110,"./zlib/messages":112,"./zlib/zstream":114}],102:[function(v,D,u){arguments[4][28][0].apply(u,arguments)},{dup:28}],103:[function(v,D,u){"use strict";var p=v("./common"),f=!0,m=!0;try{String.fromCharCode.apply(null,[0])}catch(i){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(i){m=!1}for(var h=new p.Buf8(256),b=0;b<256;b++)h[b]=b>=252?6:b>=248?5:b>=240?4:b>=224?3:b>=192?2:1;h[254]=h[254]=1,u.string2buf=function(i){var n,o,w,g,l,e=i.length,d=0;for(g=0;g<e;g++)o=i.charCodeAt(g),(o&64512)===55296&&g+1<e&&(w=i.charCodeAt(g+1),(w&64512)===56320&&(o=65536+(o-55296<<10)+(w-56320),g++)),d+=o<128?1:o<2048?2:o<65536?3:4;for(n=new p.Buf8(d),l=0,g=0;l<d;g++)o=i.charCodeAt(g),(o&64512)===55296&&g+1<e&&(w=i.charCodeAt(g+1),(w&64512)===56320&&(o=65536+(o-55296<<10)+(w-56320),g++)),o<128?n[l++]=o:o<2048?(n[l++]=192|o>>>6,n[l++]=128|o&63):o<65536?(n[l++]=224|o>>>12,n[l++]=128|o>>>6&63,n[l++]=128|o&63):(n[l++]=240|o>>>18,n[l++]=128|o>>>12&63,n[l++]=128|o>>>6&63,n[l++]=128|o&63);return n};function t(i,n){if(n<65534&&(i.subarray&&m||!i.subarray&&f))return String.fromCharCode.apply(null,p.shrinkBuf(i,n));for(var o="",w=0;w<n;w++)o+=String.fromCharCode(i[w]);return o}u.buf2binstring=function(i){return t(i,i.length)},u.binstring2buf=function(i){for(var n=new p.Buf8(i.length),o=0,w=n.length;o<w;o++)n[o]=i.charCodeAt(o);return n},u.buf2string=function(i,n){var o,w,g,l,e=n||i.length,d=new Array(e*2);for(w=0,o=0;o<e;){if(g=i[o++],g<128){d[w++]=g;continue}if(l=h[g],l>4){d[w++]=65533,o+=l-1;continue}for(g&=l===2?31:l===3?15:7;l>1&&o<e;)g=g<<6|i[o++]&63,l--;if(l>1){d[w++]=65533;continue}g<65536?d[w++]=g:(g-=65536,d[w++]=55296|g>>10&1023,d[w++]=56320|g&1023)}return t(d,w)},u.utf8border=function(i,n){var o;for(n=n||i.length,n>i.length&&(n=i.length),o=n-1;o>=0&&(i[o]&192)===128;)o--;return o<0||o===0?n:o+h[i[o]]>n?o:n}},{"./common":102}],104:[function(v,D,u){arguments[4][29][0].apply(u,arguments)},{dup:29}],105:[function(v,D,u){arguments[4][30][0].apply(u,arguments)},{dup:30}],106:[function(v,D,u){arguments[4][31][0].apply(u,arguments)},{dup:31}],107:[function(v,D,u){arguments[4][32][0].apply(u,arguments)},{"../utils/common":102,"./adler32":104,"./crc32":106,"./messages":112,"./trees":113,dup:32}],108:[function(v,D,u){"use strict";function p(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}D.exports=p},{}],109:[function(v,D,u){arguments[4][33][0].apply(u,arguments)},{dup:33}],110:[function(v,D,u){arguments[4][34][0].apply(u,arguments)},{"../utils/common":102,"./adler32":104,"./crc32":106,"./inffast":109,"./inftrees":111,dup:34}],111:[function(v,D,u){arguments[4][35][0].apply(u,arguments)},{"../utils/common":102,dup:35}],112:[function(v,D,u){arguments[4][36][0].apply(u,arguments)},{dup:36}],113:[function(v,D,u){arguments[4][37][0].apply(u,arguments)},{"../utils/common":102,dup:37}],114:[function(v,D,u){arguments[4][38][0].apply(u,arguments)},{dup:38}],115:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./interlace"),m=[function(){},function(n,o,w,g){if(g===o.length)throw new Error("Ran out of data");let l=o[g];n[w]=l,n[w+1]=l,n[w+2]=l,n[w+3]=255},function(n,o,w,g){if(g+1>=o.length)throw new Error("Ran out of data");let l=o[g];n[w]=l,n[w+1]=l,n[w+2]=l,n[w+3]=o[g+1]},function(n,o,w,g){if(g+2>=o.length)throw new Error("Ran out of data");n[w]=o[g],n[w+1]=o[g+1],n[w+2]=o[g+2],n[w+3]=255},function(n,o,w,g){if(g+3>=o.length)throw new Error("Ran out of data");n[w]=o[g],n[w+1]=o[g+1],n[w+2]=o[g+2],n[w+3]=o[g+3]}],h=[function(){},function(n,o,w,g){let l=o[0];n[w]=l,n[w+1]=l,n[w+2]=l,n[w+3]=g},function(n,o,w){let g=o[0];n[w]=g,n[w+1]=g,n[w+2]=g,n[w+3]=o[1]},function(n,o,w,g){n[w]=o[0],n[w+1]=o[1],n[w+2]=o[2],n[w+3]=g},function(n,o,w){n[w]=o[0],n[w+1]=o[1],n[w+2]=o[2],n[w+3]=o[3]}];function b(n,o){let w=[],g=0;function l(){if(g===n.length)throw new Error("Ran out of data");let e=n[g];g++;let d,y,A,E,T,_,S,N;switch(o){default:throw new Error("unrecognised depth");case 16:S=n[g],g++,w.push((e<<8)+S);break;case 4:S=e&15,N=e>>4,w.push(N,S);break;case 2:T=e&3,_=e>>2&3,S=e>>4&3,N=e>>6&3,w.push(N,S,_,T);break;case 1:d=e&1,y=e>>1&1,A=e>>2&1,E=e>>3&1,T=e>>4&1,_=e>>5&1,S=e>>6&1,N=e>>7&1,w.push(N,S,_,T,E,A,y,d);break}}return{get:function(e){for(;w.length<e;)l();let d=w.slice(0,e);return w=w.slice(e),d},resetAfterLine:function(){w.length=0},end:function(){if(g!==n.length)throw new Error("extra data found")}}}function t(n,o,w,g,l,e){let d=n.width,y=n.height,A=n.index;for(let E=0;E<y;E++)for(let T=0;T<d;T++){let _=w(T,E,A);m[g](o,l,_,e),e+=g}return e}function i(n,o,w,g,l,e){let d=n.width,y=n.height,A=n.index;for(let E=0;E<y;E++){for(let T=0;T<d;T++){let _=l.get(g),S=w(T,E,A);h[g](o,_,S,e)}l.resetAfterLine()}}u.dataToBitMap=function(n,o){let w=o.width,g=o.height,l=o.depth,e=o.bpp,d=o.interlace,y;l!==8&&(y=b(n,l));let A;l<=8?A=p.alloc(w*g*4):A=new Uint16Array(w*g*4);let E=Math.pow(2,l)-1,T=0,_,S;if(d)_=f.getImagePasses(w,g),S=f.getInterlaceIterator(w,g);else{let N=0;S=function(){let L=N;return N+=4,L},_=[{width:w,height:g}]}for(let N=0;N<_.length;N++)l===8?T=t(_[N],A,S,e,n,T):i(_[N],A,S,e,y,E);if(l===8){if(T!==n.length)throw new Error("extra data found")}else y.end();return A}}).call(this)}).call(this,v("buffer").Buffer)},{"./interlace":125,buffer:11}],116:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./constants");D.exports=function(m,h,b,t){let i=[f.COLORTYPE_COLOR_ALPHA,f.COLORTYPE_ALPHA].indexOf(t.colorType)!==-1;if(t.colorType===t.inputColorType){let E=function(){let T=new ArrayBuffer(2);return new DataView(T).setInt16(0,256,!0),new Int16Array(T)[0]!==256}();if(t.bitDepth===8||t.bitDepth===16&&E)return m}let n=t.bitDepth!==16?m:new Uint16Array(m.buffer),o=255,w=f.COLORTYPE_TO_BPP_MAP[t.inputColorType];w===4&&!t.inputHasAlpha&&(w=3);let g=f.COLORTYPE_TO_BPP_MAP[t.colorType];t.bitDepth===16&&(o=65535,g*=2);let l=p.alloc(h*b*g),e=0,d=0,y=t.bgColor||{};y.red===void 0&&(y.red=o),y.green===void 0&&(y.green=o),y.blue===void 0&&(y.blue=o);function A(){let E,T,_,S=o;switch(t.inputColorType){case f.COLORTYPE_COLOR_ALPHA:S=n[e+3],E=n[e],T=n[e+1],_=n[e+2];break;case f.COLORTYPE_COLOR:E=n[e],T=n[e+1],_=n[e+2];break;case f.COLORTYPE_ALPHA:S=n[e+1],E=n[e],T=E,_=E;break;case f.COLORTYPE_GRAYSCALE:E=n[e],T=E,_=E;break;default:throw new Error("input color type:"+t.inputColorType+" is not supported at present")}return t.inputHasAlpha&&(i||(S/=o,E=Math.min(Math.max(Math.round((1-S)*y.red+S*E),0),o),T=Math.min(Math.max(Math.round((1-S)*y.green+S*T),0),o),_=Math.min(Math.max(Math.round((1-S)*y.blue+S*_),0),o))),{red:E,green:T,blue:_,alpha:S}}for(let E=0;E<b;E++)for(let T=0;T<h;T++){let _=A(n,e);switch(t.colorType){case f.COLORTYPE_COLOR_ALPHA:case f.COLORTYPE_COLOR:t.bitDepth===8?(l[d]=_.red,l[d+1]=_.green,l[d+2]=_.blue,i&&(l[d+3]=_.alpha)):(l.writeUInt16BE(_.red,d),l.writeUInt16BE(_.green,d+2),l.writeUInt16BE(_.blue,d+4),i&&l.writeUInt16BE(_.alpha,d+6));break;case f.COLORTYPE_ALPHA:case f.COLORTYPE_GRAYSCALE:{let S=(_.red+_.green+_.blue)/3;t.bitDepth===8?(l[d]=S,i&&(l[d+1]=_.alpha)):(l.writeUInt16BE(S,d),i&&l.writeUInt16BE(_.alpha,d+2));break}default:throw new Error("unrecognised color Type "+t.colorType)}e+=w,d+=g}return l}}).call(this)}).call(this,v("buffer").Buffer)},{"./constants":118,buffer:11}],117:[function(v,D,u){(function(p,f){(function(){"use strict";let m=v("util"),h=v("stream"),b=D.exports=function(){h.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};m.inherits(b,h),b.prototype.read=function(t,i){this._reads.push({length:Math.abs(t),allowLess:t<0,func:i}),p.nextTick(function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},b.prototype.write=function(t,i){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let n;return f.isBuffer(t)?n=t:n=f.from(t,i||this._encoding),this._buffers.push(n),this._buffered+=n.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},b.prototype.end=function(t,i){if(t&&this.write(t,i),this.writable=!1,!this._buffers)return;this._buffers.length===0?this._end():(this._buffers.push(null),this._process())},b.prototype.destroySoon=b.prototype.end,b.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},b.prototype.destroy=function(){if(!this._buffers)return;this.writable=!1,this._reads=null,this._buffers=null,this.emit("close")},b.prototype._processReadAllowingLess=function(t){this._reads.shift();let i=this._buffers[0];i.length>t.length?(this._buffered-=t.length,this._buffers[0]=i.slice(t.length),t.func.call(this,i.slice(0,t.length))):(this._buffered-=i.length,this._buffers.shift(),t.func.call(this,i))},b.prototype._processRead=function(t){this._reads.shift();let i=0,n=0,o=f.alloc(t.length);for(;i<t.length;){let w=this._buffers[n++],g=Math.min(w.length,t.length-i);w.copy(o,i,0,g),i+=g,g!==w.length&&(this._buffers[--n]=w.slice(g))}n>0&&this._buffers.splice(0,n),this._buffered-=t.length,t.func.call(this,o)},b.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else if(this._buffered>=t.length)this._processRead(t);else break}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}).call(this)}).call(this,v("_process"),v("buffer").Buffer)},{_process:39,buffer:11,stream:41,util:61}],118:[function(v,D,u){"use strict";D.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],119:[function(v,D,u){"use strict";let p=[];(function(){for(let m=0;m<256;m++){let h=m;for(let b=0;b<8;b++)h&1?h=3988292384^h>>>1:h=h>>>1;p[m]=h}})();let f=D.exports=function(){this._crc=-1};f.prototype.write=function(m){for(let h=0;h<m.length;h++)this._crc=p[(this._crc^m[h])&255]^this._crc>>>8;return!0},f.prototype.crc32=function(){return this._crc^-1},f.crc32=function(m){let h=-1;for(let b=0;b<m.length;b++)h=p[(h^m[b])&255]^h>>>8;return h^-1}},{}],120:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./paeth-predictor");function m(y,A,E,T,_){for(let S=0;S<E;S++)T[_+S]=y[A+S]}function h(y,A,E){let T=0,_=A+E;for(let S=A;S<_;S++)T+=Math.abs(y[S]);return T}function b(y,A,E,T,_,S){for(let N=0;N<E;N++){let L=N>=S?y[A+N-S]:0,H=y[A+N]-L;T[_+N]=H}}function t(y,A,E,T){let _=0;for(let S=0;S<E;S++){let N=S>=T?y[A+S-T]:0,L=y[A+S]-N;_+=Math.abs(L)}return _}function i(y,A,E,T,_){for(let S=0;S<E;S++){let N=A>0?y[A+S-E]:0,L=y[A+S]-N;T[_+S]=L}}function n(y,A,E){let T=0,_=A+E;for(let S=A;S<_;S++){let N=A>0?y[S-E]:0,L=y[S]-N;T+=Math.abs(L)}return T}function o(y,A,E,T,_,S){for(let N=0;N<E;N++){let L=N>=S?y[A+N-S]:0,H=A>0?y[A+N-E]:0,P=y[A+N]-(L+H>>1);T[_+N]=P}}function w(y,A,E,T){let _=0;for(let S=0;S<E;S++){let N=S>=T?y[A+S-T]:0,L=A>0?y[A+S-E]:0,H=y[A+S]-(N+L>>1);_+=Math.abs(H)}return _}function g(y,A,E,T,_,S){for(let N=0;N<E;N++){let L=N>=S?y[A+N-S]:0,H=A>0?y[A+N-E]:0,P=A>0&&N>=S?y[A+N-(E+S)]:0,K=y[A+N]-f(L,H,P);T[_+N]=K}}function l(y,A,E,T){let _=0;for(let S=0;S<E;S++){let N=S>=T?y[A+S-T]:0,L=A>0?y[A+S-E]:0,H=A>0&&S>=T?y[A+S-(E+T)]:0,P=y[A+S]-f(N,L,H);_+=Math.abs(P)}return _}let e={0:m,1:b,2:i,3:o,4:g},d={0:h,1:t,2:n,3:w,4:l};D.exports=function(y,A,E,T,_){let S;if(!("filterType"in T)||T.filterType===-1)S=[0,1,2,3,4];else if(typeof T.filterType=="number")S=[T.filterType];else throw new Error("unrecognised filter types");T.bitDepth===16&&(_*=2);let N=A*_,L=0,H=0,P=p.alloc((N+1)*E),K=S[0];for(let te=0;te<E;te++){if(S.length>1){let se=Infinity;for(let B=0;B<S.length;B++){let k=d[S[B]](y,H,N,_);k<se&&(K=S[B],se=k)}}P[L]=K,L++,e[K](y,H,N,P,L,_),L+=N,H+=N}return P}}).call(this)}).call(this,v("buffer").Buffer)},{"./paeth-predictor":129,buffer:11}],121:[function(v,D,u){(function(p){(function(){"use strict";let f=v("util"),m=v("./chunkstream"),h=v("./filter-parse"),b=D.exports=function(t){m.call(this);let i=[],n=this;this._filter=new h(t,{read:this.read.bind(this),write:function(o){i.push(o)},complete:function(){n.emit("complete",p.concat(i))}}),this._filter.start()};f.inherits(b,m)}).call(this)}).call(this,v("buffer").Buffer)},{"./chunkstream":117,"./filter-parse":123,buffer:11,util:61}],122:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./sync-reader"),m=v("./filter-parse");u.process=function(h,b){let t=[],i=new f(h),n=new m(b,{read:i.read.bind(i),write:function(o){t.push(o)},complete:function(){}});return n.start(),i.process(),p.concat(t)}}).call(this)}).call(this,v("buffer").Buffer)},{"./filter-parse":123,"./sync-reader":135,buffer:11}],123:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./interlace"),m=v("./paeth-predictor");function h(t,i,n){let o=t*i;return n!==8&&(o=Math.ceil(o/(8/n))),o}let b=D.exports=function(t,i){let n=t.width,o=t.height,w=t.interlace,g=t.bpp,l=t.depth;if(this.read=i.read,this.write=i.write,this.complete=i.complete,this._imageIndex=0,this._images=[],w){let e=f.getImagePasses(n,o);for(let d=0;d<e.length;d++)this._images.push({byteWidth:h(e[d].width,g,l),height:e[d].height,lineIndex:0})}else this._images.push({byteWidth:h(n,g,l),height:o,lineIndex:0});l===8?this._xComparison=g:l===16?this._xComparison=g*2:this._xComparison=1};b.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},b.prototype._unFilterType1=function(t,i,n){let o=this._xComparison,w=o-1;for(let g=0;g<n;g++){let l=t[1+g],e=g>w?i[g-o]:0;i[g]=l+e}},b.prototype._unFilterType2=function(t,i,n){let o=this._lastLine;for(let w=0;w<n;w++){let g=t[1+w],l=o?o[w]:0;i[w]=g+l}},b.prototype._unFilterType3=function(t,i,n){let o=this._xComparison,w=o-1,g=this._lastLine;for(let l=0;l<n;l++){let e=t[1+l],d=g?g[l]:0,y=l>w?i[l-o]:0,A=Math.floor((y+d)/2);i[l]=e+A}},b.prototype._unFilterType4=function(t,i,n){let o=this._xComparison,w=o-1,g=this._lastLine;for(let l=0;l<n;l++){let e=t[1+l],d=g?g[l]:0,y=l>w?i[l-o]:0,A=l>w&&g?g[l-o]:0,E=m(y,d,A);i[l]=e+E}},b.prototype._reverseFilterLine=function(t){let i=t[0],n,o=this._images[this._imageIndex],w=o.byteWidth;if(i===0)n=t.slice(1,w+1);else{n=p.alloc(w);switch(i){case 1:this._unFilterType1(t,n,w);break;case 2:this._unFilterType2(t,n,w);break;case 3:this._unFilterType3(t,n,w);break;case 4:this._unFilterType4(t,n,w);break;default:throw new Error("Unrecognised filter type - "+i)}}this.write(n),o.lineIndex++,o.lineIndex>=o.height?(this._lastLine=null,this._imageIndex++,o=this._images[this._imageIndex]):this._lastLine=n,o?this.read(o.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this)}).call(this,v("buffer").Buffer)},{"./interlace":125,"./paeth-predictor":129,buffer:11}],124:[function(v,D,u){(function(p){(function(){"use strict";function f(b,t,i,n,o){let w=0;for(let g=0;g<n;g++)for(let l=0;l<i;l++){let e=o[b[w]];if(!e)throw new Error("index "+b[w]+" not in palette");for(let d=0;d<4;d++)t[w+d]=e[d];w+=4}}function m(b,t,i,n,o){let w=0;for(let g=0;g<n;g++)for(let l=0;l<i;l++){let e=!1;if(o.length===1?o[0]===b[w]&&(e=!0):o[0]===b[w]&&o[1]===b[w+1]&&o[2]===b[w+2]&&(e=!0),e)for(let d=0;d<4;d++)t[w+d]=0;w+=4}}function h(b,t,i,n,o){let w=255,g=Math.pow(2,o)-1,l=0;for(let e=0;e<n;e++)for(let d=0;d<i;d++){for(let y=0;y<4;y++)t[l+y]=Math.floor(b[l+y]*w/g+.5);l+=4}}D.exports=function(b,t,i=!1){let n=t.depth,o=t.width,w=t.height,g=t.colorType,l=t.transColor,e=t.palette,d=b;return g===3?f(b,d,o,w,e):(l&&m(b,d,o,w,l),n!==8&&!i&&(n===16&&(d=p.alloc(o*w*4)),h(b,d,o,w,n))),d}}).call(this)}).call(this,v("buffer").Buffer)},{buffer:11}],125:[function(v,D,u){"use strict";let p=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];u.getImagePasses=function(f,m){let h=[],b=f%8,t=m%8,i=(f-b)/8,n=(m-t)/8;for(let o=0;o<p.length;o++){let w=p[o],g=i*w.x.length,l=n*w.y.length;for(let e=0;e<w.x.length&&w.x[e]<b;e++)g++;for(let e=0;e<w.y.length&&w.y[e]<t;e++)l++;g>0&&l>0&&h.push({width:g,height:l,index:o})}return h},u.getInterlaceIterator=function(f){return function(m,h,b){let t=m%p[b].x.length,i=(m-t)/p[b].x.length*8+p[b].x[t],n=h%p[b].y.length,o=(h-n)/p[b].y.length*8+p[b].y[n];return i*4+o*f*4}}},{}],126:[function(v,D,u){(function(p){(function(){"use strict";let f=v("util"),m=v("stream"),h=v("./constants"),b=v("./packer"),t=D.exports=function(i){m.call(this);let n=i||{};this._packer=new b(n),this._deflate=this._packer.createDeflate(),this.readable=!0};f.inherits(t,m),t.prototype.pack=function(i,n,o,w){this.emit("data",p.from(h.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(n,o)),w&&this.emit("data",this._packer.packGAMA(w));let g=this._packer.filterData(i,n,o);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(l){this.emit("data",this._packer.packIDAT(l))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(g)}}).call(this)}).call(this,v("buffer").Buffer)},{"./constants":118,"./packer":128,buffer:11,stream:41,util:61}],127:[function(v,D,u){(function(p){(function(){"use strict";let f=!0,m=v("zlib");m.deflateSync||(f=!1);let h=v("./constants"),b=v("./packer");D.exports=function(t,i){if(!f)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let n=i||{},o=new b(n),w=[];w.push(p.from(h.PNG_SIGNATURE)),w.push(o.packIHDR(t.width,t.height)),t.gamma&&w.push(o.packGAMA(t.gamma));let g=o.filterData(t.data,t.width,t.height),l=m.deflateSync(g,o.getDeflateOptions());if(g=null,!l||!l.length)throw new Error("bad png - invalid compressed data response");return w.push(o.packIDAT(l)),w.push(o.packIEND()),p.concat(w)}}).call(this)}).call(this,v("buffer").Buffer)},{"./constants":118,"./packer":128,buffer:11,zlib:10}],128:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./constants"),m=v("./crc"),h=v("./bitpacker"),b=v("./filter-pack"),t=v("zlib"),i=D.exports=function(n){if(this._options=n,n.deflateChunkSize=n.deflateChunkSize||32*1024,n.deflateLevel=n.deflateLevel!=null?n.deflateLevel:9,n.deflateStrategy=n.deflateStrategy!=null?n.deflateStrategy:3,n.inputHasAlpha=n.inputHasAlpha!=null?n.inputHasAlpha:!0,n.deflateFactory=n.deflateFactory||t.createDeflate,n.bitDepth=n.bitDepth||8,n.colorType=typeof n.colorType=="number"?n.colorType:f.COLORTYPE_COLOR_ALPHA,n.inputColorType=typeof n.inputColorType=="number"?n.inputColorType:f.COLORTYPE_COLOR_ALPHA,[f.COLORTYPE_GRAYSCALE,f.COLORTYPE_COLOR,f.COLORTYPE_COLOR_ALPHA,f.COLORTYPE_ALPHA].indexOf(n.colorType)===-1)throw new Error("option color type:"+n.colorType+" is not supported at present");if([f.COLORTYPE_GRAYSCALE,f.COLORTYPE_COLOR,f.COLORTYPE_COLOR_ALPHA,f.COLORTYPE_ALPHA].indexOf(n.inputColorType)===-1)throw new Error("option input color type:"+n.inputColorType+" is not supported at present");if(n.bitDepth!==8&&n.bitDepth!==16)throw new Error("option bit depth:"+n.bitDepth+" is not supported at present")};i.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},i.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},i.prototype.filterData=function(n,o,w){let g=h(n,o,w,this._options),l=f.COLORTYPE_TO_BPP_MAP[this._options.colorType],e=b(g,o,w,this._options,l);return e},i.prototype._packChunk=function(n,o){let w=o?o.length:0,g=p.alloc(w+12);return g.writeUInt32BE(w,0),g.writeUInt32BE(n,4),o&&o.copy(g,8),g.writeInt32BE(m.crc32(g.slice(4,g.length-4)),g.length-4),g},i.prototype.packGAMA=function(n){let o=p.alloc(4);return o.writeUInt32BE(Math.floor(n*f.GAMMA_DIVISION),0),this._packChunk(f.TYPE_gAMA,o)},i.prototype.packIHDR=function(n,o){let w=p.alloc(13);return w.writeUInt32BE(n,0),w.writeUInt32BE(o,4),w[8]=this._options.bitDepth,w[9]=this._options.colorType,w[10]=0,w[11]=0,w[12]=0,this._packChunk(f.TYPE_IHDR,w)},i.prototype.packIDAT=function(n){return this._packChunk(f.TYPE_IDAT,n)},i.prototype.packIEND=function(){return this._packChunk(f.TYPE_IEND,null)}}).call(this)}).call(this,v("buffer").Buffer)},{"./bitpacker":116,"./constants":118,"./crc":119,"./filter-pack":120,buffer:11,zlib:10}],129:[function(v,D,u){"use strict";D.exports=function(f,m,h){let b=f+m-h,t=Math.abs(b-f),i=Math.abs(b-m),n=Math.abs(b-h);return t<=i&&t<=n?f:i<=n?m:h}},{}],130:[function(v,D,u){"use strict";let p=v("util"),f=v("zlib"),m=v("./chunkstream"),h=v("./filter-parse-async"),b=v("./parser"),t=v("./bitmapper"),i=v("./format-normaliser"),n=D.exports=function(o){m.call(this),this._parser=new b(o,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=o,this.writable=!0,this._parser.start()};p.inherits(n,m),n.prototype._handleError=function(o){this.emit("error",o),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},n.prototype._inflateData=function(o){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=f.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let w=(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3)+1,g=w*this._bitmapInfo.height,l=Math.max(g,f.Z_MIN_CHUNK);this._inflate=f.createInflate({chunkSize:l});let e=g,d=this.emit.bind(this,"error");this._inflate.on("error",function(A){if(!e)return;d(A)}),this._filter.on("complete",this._complete.bind(this));let y=this._filter.write.bind(this._filter);this._inflate.on("data",function(A){if(!e)return;A.length>e&&(A=A.slice(0,e)),e-=A.length,y(A)}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(o)},n.prototype._handleMetaData=function(o){this._metaData=o,this._bitmapInfo=Object.create(o),this._filter=new h(this._bitmapInfo)},n.prototype._handleTransColor=function(o){this._bitmapInfo.transColor=o},n.prototype._handlePalette=function(o){this._bitmapInfo.palette=o},n.prototype._simpleTransparency=function(){this._metaData.alpha=!0},n.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},n.prototype._finished=function(){if(this.errord)return;this._inflate?this._inflate.end():this.emit("error","No Inflate block")},n.prototype._complete=function(o){if(this.errord)return;let w;try{let g=t.dataToBitMap(o,this._bitmapInfo);w=i(g,this._bitmapInfo,this._options.skipRescale),g=null}catch(g){this._handleError(g);return}this.emit("parsed",w)}},{"./bitmapper":115,"./chunkstream":117,"./filter-parse-async":121,"./format-normaliser":124,"./parser":132,util:61,zlib:10}],131:[function(v,D,u){(function(p){(function(){"use strict";let f=!0,m=v("zlib"),h=v("./sync-inflate");m.deflateSync||(f=!1);let b=v("./sync-reader"),t=v("./filter-parse-sync"),i=v("./parser"),n=v("./bitmapper"),o=v("./format-normaliser");D.exports=function(w,g){if(!f)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let l;function e(F){l=F}let d;function y(F){d=F}function A(F){d.transColor=F}function E(F){d.palette=F}function T(){d.alpha=!0}let _;function S(F){_=F}let N=[];function L(F){N.push(F)}let H=new b(w),P=new i(g,{read:H.read.bind(H),error:e,metadata:y,gamma:S,palette:E,transColor:A,inflateData:L,simpleTransparency:T});if(P.start(),H.process(),l)throw l;let K=p.concat(N);N.length=0;let te;if(d.interlace)te=m.inflateSync(K);else{let F=(d.width*d.bpp*d.depth+7>>3)+1,$=F*d.height;te=h(K,{chunkSize:$,maxLength:$})}if(K=null,!te||!te.length)throw new Error("bad png - invalid inflate data response");let se=t.process(te,d);K=null;let B=n.dataToBitMap(se,d);se=null;let k=o(B,d,g.skipRescale);return d.data=k,d.gamma=_||0,d}}).call(this)}).call(this,v("buffer").Buffer)},{"./bitmapper":115,"./filter-parse-sync":122,"./format-normaliser":124,"./parser":132,"./sync-inflate":134,"./sync-reader":135,buffer:11,zlib:10}],132:[function(v,D,u){(function(p){(function(){"use strict";let f=v("./constants"),m=v("./crc"),h=D.exports=function(b,t){this._options=b,b.checkCRC=b.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[f.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[f.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[f.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[f.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[f.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[f.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=t.read,this.error=t.error,this.metadata=t.metadata,this.gamma=t.gamma,this.transColor=t.transColor,this.palette=t.palette,this.parsed=t.parsed,this.inflateData=t.inflateData,this.finished=t.finished,this.simpleTransparency=t.simpleTransparency,this.headersFinished=t.headersFinished||function(){}};h.prototype.start=function(){this.read(f.PNG_SIGNATURE.length,this._parseSignature.bind(this))},h.prototype._parseSignature=function(b){let t=f.PNG_SIGNATURE;for(let i=0;i<t.length;i++)if(b[i]!==t[i]){this.error(new Error("Invalid file signature"));return}this.read(8,this._parseChunkBegin.bind(this))},h.prototype._parseChunkBegin=function(b){let t=b.readUInt32BE(0),i=b.readUInt32BE(4),n="";for(let w=4;w<8;w++)n+=String.fromCharCode(b[w]);let o=Boolean(b[4]&32);if(!this._hasIHDR&&i!==f.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}if(this._crc=new m,this._crc.write(p.from(n)),this._chunks[i])return this._chunks[i](t);if(!o){this.error(new Error("Unsupported critical chunk type "+n));return}this.read(t+4,this._skipChunk.bind(this))},h.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},h.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},h.prototype._parseChunkEnd=function(b){let t=b.readInt32BE(0),i=this._crc.crc32();if(this._options.checkCRC&&i!==t){this.error(new Error("Crc error - "+t+" - "+i));return}this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},h.prototype._handleIHDR=function(b){this.read(b,this._parseIHDR.bind(this))},h.prototype._parseIHDR=function(b){this._crc.write(b);let t=b.readUInt32BE(0),i=b.readUInt32BE(4),n=b[8],o=b[9],w=b[10],g=b[11],l=b[12];if(n!==8&&n!==4&&n!==2&&n!==1&&n!==16){this.error(new Error("Unsupported bit depth "+n));return}if(!(o in f.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(w!==0){this.error(new Error("Unsupported compression method"));return}if(g!==0){this.error(new Error("Unsupported filter method"));return}if(l!==0&&l!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=o;let e=f.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:t,height:i,depth:n,interlace:Boolean(l),palette:Boolean(o&f.COLORTYPE_PALETTE),color:Boolean(o&f.COLORTYPE_COLOR),alpha:Boolean(o&f.COLORTYPE_ALPHA),bpp:e,colorType:o}),this._handleChunkEnd()},h.prototype._handlePLTE=function(b){this.read(b,this._parsePLTE.bind(this))},h.prototype._parsePLTE=function(b){this._crc.write(b);let t=Math.floor(b.length/3);for(let i=0;i<t;i++)this._palette.push([b[i*3],b[i*3+1],b[i*3+2],255]);this.palette(this._palette),this._handleChunkEnd()},h.prototype._handleTRNS=function(b){this.simpleTransparency(),this.read(b,this._parseTRNS.bind(this))},h.prototype._parseTRNS=function(b){if(this._crc.write(b),this._colorType===f.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(b.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(let t=0;t<b.length;t++)this._palette[t][3]=b[t];this.palette(this._palette)}this._colorType===f.COLORTYPE_GRAYSCALE&&this.transColor([b.readUInt16BE(0)]),this._colorType===f.COLORTYPE_COLOR&&this.transColor([b.readUInt16BE(0),b.readUInt16BE(2),b.readUInt16BE(4)]),this._handleChunkEnd()},h.prototype._handleGAMA=function(b){this.read(b,this._parseGAMA.bind(this))},h.prototype._parseGAMA=function(b){this._crc.write(b),this.gamma(b.readUInt32BE(0)/f.GAMMA_DIVISION),this._handleChunkEnd()},h.prototype._handleIDAT=function(b){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-b,this._parseIDAT.bind(this,b))},h.prototype._parseIDAT=function(b,t){if(this._crc.write(t),this._colorType===f.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(t);let i=b-t.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},h.prototype._handleIEND=function(b){this.read(b,this._parseIEND.bind(this))},h.prototype._parseIEND=function(b){this._crc.write(b),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this)}).call(this,v("buffer").Buffer)},{"./constants":118,"./crc":119,buffer:11}],133:[function(v,D,u){"use strict";let p=v("./parser-sync"),f=v("./packer-sync");u.read=function(m,h){return p(m,h||{})},u.write=function(m,h){return f(m,h)}},{"./packer-sync":127,"./parser-sync":131}],134:[function(v,D,u){(function(p,f){(function(){"use strict";let m=v("assert").ok,h=v("zlib"),b=v("util"),t=v("buffer").kMaxLength;function i(l){if(!(this instanceof i))return new i(l);l&&l.chunkSize<h.Z_MIN_CHUNK&&(l.chunkSize=h.Z_MIN_CHUNK),h.Inflate.call(this,l),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,l&&l.maxLength!=null&&(this._maxLength=l.maxLength)}function n(l){return new i(l)}function o(l,e){if(e&&p.nextTick(e),!l._handle)return;l._handle.close(),l._handle=null}i.prototype._processChunk=function(l,e,d){if(typeof d=="function")return h.Inflate._processChunk.call(this,l,e,d);let y=this,A=l&&l.length,E=this._chunkSize-this._offset,T=this._maxLength,_=0,S=[],N=0,L;this.on("error",function(te){L=te});function H(te,se){if(y._hadError)return;let B=E-se;if(m(B>=0,"have should not go down"),B>0){let k=y._buffer.slice(y._offset,y._offset+B);if(y._offset+=B,k.length>T&&(k=k.slice(0,T)),S.push(k),N+=k.length,T-=k.length,T===0)return!1}return(se===0||y._offset>=y._chunkSize)&&(E=y._chunkSize,y._offset=0,y._buffer=f.allocUnsafe(y._chunkSize)),se===0?(_+=A-te,A=te,!0):!1}m(this._handle,"zlib binding closed");let P;do P=this._handle.writeSync(e,l,_,A,this._buffer,this._offset,E),P=P||this._writeState;while(!this._hadError&&H(P[0],P[1]));if(this._hadError)throw L;if(N>=t)throw o(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+t.toString(16)+" bytes");let K=f.concat(S,N);return o(this),K},b.inherits(i,h.Inflate);function w(l,e){if(typeof e=="string"&&(e=f.from(e)),!(e instanceof f))throw new TypeError("Not a string or buffer");let d=l._finishFlushFlag;return d==null&&(d=h.Z_FINISH),l._processChunk(e,d)}function g(l,e){return w(new i(e),l)}D.exports=u=g,u.Inflate=i,u.createInflate=n,u.inflateSync=g}).call(this)}).call(this,v("_process"),v("buffer").Buffer)},{_process:39,assert:2,buffer:11,util:61,zlib:10}],135:[function(v,D,u){"use strict";let p=D.exports=function(f){this._buffer=f,this._reads=[]};p.prototype.read=function(f,m){this._reads.push({length:Math.abs(f),allowLess:f<0,func:m})},p.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let f=this._reads[0];if(this._buffer.length&&(this._buffer.length>=f.length||f.allowLess)){this._reads.shift();let m=this._buffer;this._buffer=m.slice(f.length),f.func.call(this,m.slice(0,f.length))}else break}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")}},{}],136:[function(v,D,u){(function(p){(function(){"use strict";D.exports=typeof p=="function"?p:function(){var m=[].slice.apply(arguments);m.splice(1,0,0),setTimeout.apply(null,m)}}).call(this)}).call(this,v("timers").setImmediate)},{timers:57}],jszip:[function(v,D,u){"use strict";function p(){if(!(this instanceof p))return new p;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var f=new p;for(var m in this)typeof this[m]!="function"&&(f[m]=this[m]);return f}}p.prototype=v("./object"),p.prototype.loadAsync=v("./load"),p.support=v("./support"),p.defaults=v("./defaults"),p.version="3.5.0",p.loadAsync=function(f,m){return new p().loadAsync(f,m)},p.external=v("./external"),D.exports=p},{"./defaults":68,"./external":69,"./load":73,"./object":77,"./support":92}],pngjs:[function(v,D,u){(function(p,f){(function(){"use strict";let m=v("util"),h=v("stream"),b=v("./parser-async"),t=v("./packer-async"),i=v("./png-sync"),n=u.PNG=function(o){h.call(this),o=o||{},this.width=o.width|0,this.height=o.height|0,this.data=this.width>0&&this.height>0?f.alloc(4*this.width*this.height):null,o.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new b(o),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(w){this.data=w,this.emit("parsed",w)}.bind(this)),this._packer=new t(o),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};m.inherits(n,h),n.sync=i,n.prototype.pack=function(){return!this.data||!this.data.length?(this.emit("error","No data provided"),this):(p.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this)},n.prototype.parse=function(o,w){if(w){let g,l;g=function(e){this.removeListener("error",l),this.data=e,w(null,this)}.bind(this),l=function(e){this.removeListener("parsed",g),w(e,null)}.bind(this),this.once("parsed",g),this.once("error",l)}return this.end(o),this},n.prototype.write=function(o){return this._parser.write(o),!0},n.prototype.end=function(o){this._parser.end(o)},n.prototype._metadata=function(o){this.width=o.width,this.height=o.height,this.emit("metadata",o)},n.prototype._gamma=function(o){this.gamma=o},n.prototype._handleClose=function(){!this._parser.writable&&!this._packer.readable&&this.emit("close")},n.bitblt=function(o,w,g,l,e,d,y,A){if(g|=0,l|=0,e|=0,d|=0,y|=0,A|=0,g>o.width||l>o.height||g+e>o.width||l+d>o.height)throw new Error("bitblt reading outside image");if(y>w.width||A>w.height||y+e>w.width||A+d>w.height)throw new Error("bitblt writing outside image");for(let E=0;E<d;E++)o.data.copy(w.data,(A+E)*w.width+y<<2,(l+E)*o.width+g<<2,(l+E)*o.width+g+e<<2)},n.prototype.bitblt=function(o,w,g,l,e,d,y){return n.bitblt(this,o,w,g,l,e,d,y),this},n.adjustGamma=function(o){if(o.gamma){for(let w=0;w<o.height;w++)for(let g=0;g<o.width;g++){let l=o.width*w+g<<2;for(let e=0;e<3;e++){let d=o.data[l+e]/255;d=Math.pow(d,1/2.2/o.gamma),o.data[l+e]=Math.round(d*255)}}o.gamma=0}},n.prototype.adjustGamma=function(){n.adjustGamma(this)}}).call(this)}).call(this,v("_process"),v("buffer").Buffer)},{"./packer-async":126,"./parser-async":130,"./png-sync":133,_process:39,buffer:11,stream:41,util:61}]},{},[]);
var stratum=(()=>{var vi=Object.create,ct=Object.defineProperty,Si=Object.getPrototypeOf,yi=Object.prototype.hasOwnProperty,Ti=Object.getOwnPropertyNames,_i=Object.getOwnPropertyDescriptor,ee=Object.assign,Zt=e=>ct(e,"__esModule",{value:!0}),Ke=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),wi=(e,t)=>{Zt(e);for(var r in t)ct(e,r,{get:t[r],enumerable:!0})},Ei=(e,t)=>{if(Zt(e),typeof t=="object"||typeof t=="function")for(let r of Ti(t))!yi.call(e,r)&&r!=="default"&&ct(e,r,{get:()=>t[r],enumerable:_i(t,r).enumerable});return e},De=e=>e&&e.__esModule?e:Ei(ct(vi(Si(e)),"default",{value:e,enumerable:!0}),e),Se=(e,t,r)=>new Promise((i,n)=>{var o=l=>{try{a(r.next(l))}catch(c){n(c)}},s=l=>{try{a(r.throw(l))}catch(c){n(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,s);a((r=r.apply(e,t)).next())}),Qt=Ke(()=>{}),er=Ke(()=>{}),tr=Ke(()=>{}),Fe=Ke(L=>{var d=d||{version:"4.2.0"};typeof L!="undefined"?L.fabric=d:typeof define=="function"&&define.amd&&define([],function(){return d});if(typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?d.document=document:d.document=document.implementation.createHTMLDocument(""),d.window=window;else{var xi=Qt(),rr=new xi.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;d.document=rr.document,d.jsdomImplForWrapper=er().implForWrapper,d.nodeCanvas=tr().Canvas,d.window=rr,DOMParser=d.window.DOMParser}d.isTouchSupported="ontouchstart"in d.window||"ontouchstart"in d.document||d.window&&d.window.navigator&&d.window.navigator.maxTouchPoints>0;d.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";d.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];d.DPI=96;d.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";d.commaWsp="(?:\\s+,?\\s*|,\\s*)";d.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;d.reNonWord=/[ \n\.,;!\?\-]/;d.fontPaths={};d.iMatrix=[1,0,0,1,0,0];d.svgNS="http://www.w3.org/2000/svg";d.perfLimitSizeTotal=2097152;d.maxCacheSideLimit=4096;d.minCacheSideLimit=256;d.charWidthsCache={};d.textureSize=2048;d.disableStyleCopyPaste=!1;d.enableGLFiltering=!0;d.devicePixelRatio=d.window.devicePixelRatio||d.window.webkitDevicePixelRatio||d.window.mozDevicePixelRatio||1;d.browserShadowBlurConstant=1;d.arcToSegmentsCache={};d.boundsOfCurveCache={};d.cachesBoundsOfCurve=!0;d.forceGLPutImageData=!1;d.initFilterBackend=function(){if(d.enableGLFiltering&&d.isWebglSupported&&d.isWebglSupported(d.textureSize))return console.log("max texture size: "+d.maxTextureSize),new d.WebglFilterBackend({tileSize:d.textureSize});if(d.Canvas2dFilterBackend)return new d.Canvas2dFilterBackend};typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=d);(function(){function e(n,o){if(!this.__eventListeners[n])return;var s=this.__eventListeners[n];o?s[s.indexOf(o)]=!1:d.util.array.fill(s,!1)}function t(n,o){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var s in n)this.on(s,n[s]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(o);return this}function r(n,o){if(!this.__eventListeners)return this;if(arguments.length===0)for(n in this.__eventListeners)e.call(this,n);else if(arguments.length===1&&typeof arguments[0]=="object")for(var s in n)e.call(this,s,n[s]);else e.call(this,n,o);return this}function i(n,o){if(!this.__eventListeners)return this;var s=this.__eventListeners[n];if(!s)return this;for(var a=0,l=s.length;a<l;a++)s[a]&&s[a].call(this,o||{});return this.__eventListeners[n]=s.filter(function(c){return c!==!1}),this}d.Observable={fire:i,on:t,off:r}})();d.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,r){var i=this._objects;return r?i[t]=e:i.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e=this._objects,t,r=!1,i=0,n=arguments.length;i<n;i++)t=e.indexOf(arguments[i]),t!==-1&&(r=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&r&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var r=this.getObjects(),i=0,n=r.length;i<n;i++)e.call(t,r[i],i,r);return this},getObjects:function(e){return typeof e=="undefined"?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(e){return this._objects.indexOf(e)>-1},complexity:function(){return this._objects.reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}};d.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){e&&e.colorStops&&!(e instanceof d.Gradient)&&this.set(t,new d.Gradient(e))},_initPattern:function(e,t,r){e&&e.source&&!(e instanceof d.Pattern)?this.set(t,new d.Pattern(e,r)):r&&r()},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},get:function(e){return this[e]}};(function(e){var t=Math.sqrt,r=Math.atan2,i=Math.pow,n=Math.PI/180,o=Math.PI/2;d.util={cos:function(s){if(s===0)return 1;s<0&&(s=-s);var a=s/o;switch(a){case 1:case 3:return 0;case 2:return-1}return Math.cos(s)},sin:function(s){if(s===0)return 0;var a=s/o,l=1;s<0&&(l=-1);switch(a){case 1:return l;case 2:return 0;case 3:return-l}return Math.sin(s)},removeFromArray:function(s,a){var l=s.indexOf(a);return l!==-1&&s.splice(l,1),s},getRandomInt:function(s,a){return Math.floor(Math.random()*(a-s+1))+s},degreesToRadians:function(s){return s*n},radiansToDegrees:function(s){return s/n},rotatePoint:function(s,a,l){s.subtractEquals(a);var c=d.util.rotateVector(s,l);return new d.Point(c.x,c.y).addEquals(a)},rotateVector:function(s,a){var l=d.util.sin(a),c=d.util.cos(a),h=s.x*c-s.y*l,u=s.x*l+s.y*c;return{x:h,y:u}},transformPoint:function(s,a,l){return l?new d.Point(a[0]*s.x+a[2]*s.y,a[1]*s.x+a[3]*s.y):new d.Point(a[0]*s.x+a[2]*s.y+a[4],a[1]*s.x+a[3]*s.y+a[5])},makeBoundingBoxFromPoints:function(s,a){if(a)for(var l=0;l<s.length;l++)s[l]=d.util.transformPoint(s[l],a);var c=[s[0].x,s[1].x,s[2].x,s[3].x],h=d.util.array.min(c),u=d.util.array.max(c),f=u-h,p=[s[0].y,s[1].y,s[2].y,s[3].y],m=d.util.array.min(p),g=d.util.array.max(p),S=g-m;return{left:h,top:m,width:f,height:S}},invertTransform:function(s){var a=1/(s[0]*s[3]-s[1]*s[2]),l=[a*s[3],-a*s[1],-a*s[2],a*s[0]],c=d.util.transformPoint({x:s[4],y:s[5]},l,!0);return l[4]=-c.x,l[5]=-c.y,l},toFixed:function(s,a){return parseFloat(Number(s).toFixed(a))},parseUnit:function(s,a){var l=/\D{0,2}$/.exec(s),c=parseFloat(s);a||(a=d.Text.DEFAULT_SVG_FONT_SIZE);switch(l[0]){case"mm":return c*d.DPI/25.4;case"cm":return c*d.DPI/2.54;case"in":return c*d.DPI;case"pt":return c*d.DPI/72;case"pc":return c*d.DPI/72*12;case"em":return c*a;default:return c}},falseFunction:function(){return!1},getKlass:function(s,a){return s=d.util.string.camelize(s.charAt(0).toUpperCase()+s.slice(1)),d.util.resolveNamespace(a)[s]},getSvgAttributes:function(s){var a=["instantiated_by_use","style","id","class"];switch(s){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"]);break}return a},resolveNamespace:function(s){if(!s)return d;var a=s.split("."),l=a.length,c,h=e||d.window;for(c=0;c<l;++c)h=h[a[c]];return h},loadImage:function(s,a,l,c){if(!s){a&&a.call(l,s);return}var h=d.util.createImage(),u=function(){a&&a.call(l,h,!1),h=h.onload=h.onerror=null};h.onload=u,h.onerror=function(){d.log("Error loading "+h.src),a&&a.call(l,null,!0),h=h.onload=h.onerror=null},s.indexOf("data")!==0&&c!==void 0&&c!==null&&(h.crossOrigin=c),s.substring(0,14)==="data:image/svg"&&(h.onload=null,d.util.loadImageInDom(h,u)),h.src=s},loadImageInDom:function(s,a){var l=d.document.createElement("div");l.style.width=l.style.height="1px",l.style.left=l.style.top="-100%",l.style.position="absolute",l.appendChild(s),d.document.querySelector("body").appendChild(l),s.onload=function(){a(),l.parentNode.removeChild(l),l=null}},enlivenObjects:function(s,a,l,c){s=s||[];var h=[],u=0,f=s.length;function p(){++u===f&&(a&&a(h.filter(function(m){return m})))}if(!f){a&&a(h);return}s.forEach(function(m,g){if(!m||!m.type){p();return}var S=d.util.getKlass(m.type,l);S.fromObject(m,function(C,k){k||(h[g]=C),c&&c(m,C,k),p()})})},enlivenPatterns:function(s,a){s=s||[];function l(){++h===u&&(a&&a(c))}var c=[],h=0,u=s.length;if(!u){a&&a(c);return}s.forEach(function(f,p){f&&f.source?new d.Pattern(f,function(m){c[p]=m,l()}):(c[p]=f,l())})},groupSVGElements:function(s,a,l){var c;return s&&s.length===1?s[0]:(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),c=new d.Group(s,a),typeof l!="undefined"&&(c.sourcePath=l),c)},populateWithProperties:function(s,a,l){if(l&&Object.prototype.toString.call(l)==="[object Array]")for(var c=0,h=l.length;c<h;c++)l[c]in s&&(a[l[c]]=s[l[c]])},drawDashedLine:function(s,a,l,c,h,u){var f=c-a,p=h-l,m=t(f*f+p*p),g=r(p,f),S=u.length,C=0,k=!0;for(s.save(),s.translate(a,l),s.moveTo(0,0),s.rotate(g),a=0;m>a;)a+=u[C++%S],a>m&&(a=m),s[k?"lineTo":"moveTo"](a,0),k=!k;s.restore()},createCanvasElement:function(){return d.document.createElement("canvas")},copyCanvasElement:function(s){var a=d.util.createCanvasElement();return a.width=s.width,a.height=s.height,a.getContext("2d").drawImage(s,0,0),a},toDataURL:function(s,a,l){return s.toDataURL("image/"+a,l)},createImage:function(){return d.document.createElement("img")},multiplyTransformMatrices:function(s,a,l){return[s[0]*a[0]+s[2]*a[1],s[1]*a[0]+s[3]*a[1],s[0]*a[2]+s[2]*a[3],s[1]*a[2]+s[3]*a[3],l?0:s[0]*a[4]+s[2]*a[5]+s[4],l?0:s[1]*a[4]+s[3]*a[5]+s[5]]},qrDecompose:function(s){var a=r(s[1],s[0]),l=i(s[0],2)+i(s[1],2),c=t(l),h=(s[0]*s[3]-s[2]*s[1])/c,u=r(s[0]*s[2]+s[1]*s[3],l);return{angle:a/n,scaleX:c,scaleY:h,skewX:u/n,skewY:0,translateX:s[4],translateY:s[5]}},calcRotateMatrix:function(s){if(!s.angle)return d.iMatrix.concat();var a=d.util.degreesToRadians(s.angle),l=d.util.cos(a),c=d.util.sin(a);return[l,c,-c,l,0,0]},calcDimensionsMatrix:function(s){var a=typeof s.scaleX=="undefined"?1:s.scaleX,l=typeof s.scaleY=="undefined"?1:s.scaleY,c=[s.flipX?-a:a,0,0,s.flipY?-l:l,0,0],h=d.util.multiplyTransformMatrices,u=d.util.degreesToRadians;return s.skewX&&(c=h(c,[1,0,Math.tan(u(s.skewX)),1],!0)),s.skewY&&(c=h(c,[1,Math.tan(u(s.skewY)),0,1],!0)),c},composeMatrix:function(s){var a=[1,0,0,1,s.translateX||0,s.translateY||0],l=d.util.multiplyTransformMatrices;return s.angle&&(a=l(a,d.util.calcRotateMatrix(s))),(s.scaleX!==1||s.scaleY!==1||s.skewX||s.skewY||s.flipX||s.flipY)&&(a=l(a,d.util.calcDimensionsMatrix(s))),a},resetObjectTransform:function(s){s.scaleX=1,s.scaleY=1,s.skewX=0,s.skewY=0,s.flipX=!1,s.flipY=!1,s.rotate(0)},saveObjectTransform:function(s){return{scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,angle:s.angle,left:s.left,flipX:s.flipX,flipY:s.flipY,top:s.top}},isTransparent:function(s,a,l,c){c>0&&(a>c?a-=c:a=0,l>c?l-=c:l=0);var h=!0,u,f,p=s.getImageData(a,l,c*2||1,c*2||1),m=p.data.length;for(u=3;u<m&&!(f=p.data[u],h=f<=0,h===!1);u+=4);return p=null,h},parsePreserveAspectRatioAttribute:function(s){var a="meet",l="Mid",c="Mid",h=s.split(" "),u;return h&&h.length&&(a=h.pop(),a!=="meet"&&a!=="slice"?(u=a,a="meet"):h.length&&(u=h.pop())),l=u!=="none"?u.slice(1,4):"none",c=u!=="none"?u.slice(5,8):"none",{meetOrSlice:a,alignX:l,alignY:c}},clearFabricFontCache:function(s){s=(s||"").toLowerCase(),s?d.charWidthsCache[s]&&delete d.charWidthsCache[s]:d.charWidthsCache={}},limitDimsByArea:function(s,a){var l=Math.sqrt(a*s),c=Math.floor(a/l);return{x:Math.floor(l),y:c}},capValue:function(s,a,l){return Math.max(s,Math.min(a,l))},findScaleToFit:function(s,a){return Math.min(a.width/s.width,a.height/s.height)},findScaleToCover:function(s,a){return Math.max(a.width/s.width,a.height/s.height)},matrixToSVG:function(s){return"matrix("+s.map(function(a){return d.util.toFixed(a,d.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},sizeAfterTransform:function(s,a,l){var c=s/2,h=a/2,u=[{x:-c,y:-h},{x:c,y:-h},{x:-c,y:h},{x:c,y:h}],f=d.util.calcDimensionsMatrix(l),p=d.util.makeBoundingBoxFromPoints(u,f);return{x:p.width,y:p.height}}}})((typeof L!="undefined",L));(function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r={m:"l",M:"L"};function i(A,N,j,b,E,D,T,U,y,_,x){var O=d.util.cos(A),B=d.util.sin(A),P=d.util.cos(N),G=d.util.sin(N),V=j*E*P-b*D*G+T,R=b*E*P+j*D*G+U,w=_+y*(-j*E*B-b*D*O),I=x+y*(-b*E*B+j*D*O),F=V+y*(j*E*G+b*D*P),M=R+y*(b*E*G-j*D*P);return["C",w,I,F,M,V,R]}function n(A,N,j,b,E,D,T){var U=Math.PI,y=T*U/180,_=d.util.sin(y),x=d.util.cos(y),O=0,B=0;j=Math.abs(j),b=Math.abs(b);var P=-x*A*.5-_*N*.5,G=-x*N*.5+_*A*.5,V=j*j,R=b*b,w=G*G,I=P*P,F=V*R-V*w-R*I,M=0;if(F<0){var H=Math.sqrt(1-F/(V*R));j*=H,b*=H}else M=(E===D?-1:1)*Math.sqrt(F/(V*w+R*I));var X=M*j*G/b,te=-M*b*P/j,re=x*X-_*te+A*.5,z=_*X+x*te+N*.5,Y=o(1,0,(P-X)/j,(G-te)/b),Z=o((P-X)/j,(G-te)/b,(-P-X)/j,(-G-te)/b);D===0&&Z>0?Z-=2*U:D===1&&Z<0&&(Z+=2*U);for(var ie=Math.ceil(Math.abs(Z/U*2)),oe=[],ue=Z/ie,de=8/3*Math.sin(ue/4)*Math.sin(ue/4)/Math.sin(ue/2),ve=Y+ue,he=0;he<ie;he++)oe[he]=i(Y,ve,x,_,j,b,re,z,de,O,B),O=oe[he][5],B=oe[he][6],Y=ve,ve+=ue;return oe}function o(A,N,j,b){var E=Math.atan2(N,A),D=Math.atan2(b,j);return D>=E?D-E:2*Math.PI-(E-D)}function s(A,N,j,b,E,D,T,U){var y;if(d.cachesBoundsOfCurve&&(y=e.call(arguments),d.boundsOfCurveCache[y]))return d.boundsOfCurveCache[y];var _=Math.sqrt,x=Math.min,O=Math.max,B=Math.abs,P=[],G=[[],[]],V,R,w,I,F,M,H,X;R=6*A-12*j+6*E,V=-3*A+9*j-9*E+3*T,w=3*j-3*A;for(var te=0;te<2;++te){if(te>0&&(R=6*N-12*b+6*D,V=-3*N+9*b-9*D+3*U,w=3*b-3*N),B(V)<1e-12){if(B(R)<1e-12)continue;I=-w/R,0<I&&I<1&&P.push(I);continue}if(H=R*R-4*w*V,H<0)continue;X=_(H),F=(-R+X)/(2*V),0<F&&F<1&&P.push(F),M=(-R-X)/(2*V),0<M&&M<1&&P.push(M)}for(var re,z,Y=P.length,Z=Y,ie;Y--;)I=P[Y],ie=1-I,re=ie*ie*ie*A+3*ie*ie*I*j+3*ie*I*I*E+I*I*I*T,G[0][Y]=re,z=ie*ie*ie*N+3*ie*ie*I*b+3*ie*I*I*D+I*I*I*U,G[1][Y]=z;G[0][Z]=A,G[1][Z]=N,G[0][Z+1]=T,G[1][Z+1]=U;var oe=[{x:x.apply(null,G[0]),y:x.apply(null,G[1])},{x:O.apply(null,G[0]),y:O.apply(null,G[1])}];return d.cachesBoundsOfCurve&&(d.boundsOfCurveCache[y]=oe),oe}function a(A,N,j){for(var b=j[1],E=j[2],D=j[3],T=j[4],U=j[5],y=j[6],_=j[7],x=n(y-A,_-N,b,E,T,U,D),O=0,B=x.length;O<B;O++)x[O][1]+=A,x[O][2]+=N,x[O][3]+=A,x[O][4]+=N,x[O][5]+=A,x[O][6]+=N;return x}function l(A){var N=0,j=0,b=A.length,E=0,D=0,T,U,y,_=[],x,O,B;for(U=0;U<b;++U){y=!1,T=A[U].slice(0);switch(T[0]){case"l":T[0]="L",T[1]+=N,T[2]+=j;case"L":N=T[1],j=T[2];break;case"h":T[1]+=N;case"H":T[0]="L",T[2]=j,N=T[1];break;case"v":T[1]+=j;case"V":T[0]="L",j=T[1],T[1]=N,T[2]=j;break;case"m":T[0]="M",T[1]+=N,T[2]+=j;case"M":N=T[1],j=T[2],E=T[1],D=T[2];break;case"c":T[0]="C",T[1]+=N,T[2]+=j,T[3]+=N,T[4]+=j,T[5]+=N,T[6]+=j;case"C":O=T[3],B=T[4],N=T[5],j=T[6];break;case"s":T[0]="S",T[1]+=N,T[2]+=j,T[3]+=N,T[4]+=j;case"S":x==="C"?(O=2*N-O,B=2*j-B):(O=N,B=j),N=T[3],j=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=O,T[2]=B,O=T[3],B=T[4];break;case"q":T[0]="Q",T[1]+=N,T[2]+=j,T[3]+=N,T[4]+=j;case"Q":O=T[1],B=T[2],N=T[3],j=T[4];break;case"t":T[0]="T",T[1]+=N,T[2]+=j;case"T":x==="Q"?(O=2*N-O,B=2*j-B):(O=N,B=j),T[0]="Q",N=T[1],j=T[2],T[1]=O,T[2]=B,T[3]=N,T[4]=j;break;case"a":T[0]="A",T[6]+=N,T[7]+=j;case"A":y=!0,_=_.concat(a(N,j,T)),N=T[6],j=T[7];break;case"z":case"Z":N=E,j=D;break;default:}y||_.push(T),x=T[0]}return _}function c(A,N,j,b){return Math.sqrt((j-A)*(j-A)+(b-N)*(b-N))}function h(A){return A*A*A}function u(A){return 3*A*A*(1-A)}function f(A){return 3*A*(1-A)*(1-A)}function p(A){return(1-A)*(1-A)*(1-A)}function m(A,N,j,b,E,D,T,U){return function(y){var _=h(y),x=u(y),O=f(y),B=p(y);return{x:T*_+E*x+j*O+A*B,y:U*_+D*x+b*O+N*B}}}function g(A){return A*A}function S(A){return 2*A*(1-A)}function C(A){return(1-A)*(1-A)}function k(A,N,j,b,E,D){return function(T){var U=g(T),y=S(T),_=C(T);return{x:E*U+j*y+A*_,y:D*U+b*y+N*_}}}function W(A,N,j){var b={x:N,y:j},E,D=0,T;for(T=.01;T<=1;T+=.01)E=A(T),D+=c(b.x,b.y,E.x,E.y),b=E;return D}function J(A){for(var N=0,j=A.length,b,E=0,D=0,T=0,U=0,y=[],_,x,O=0;O<j;O++){b=A[O],x={x:E,y:D,command:b[0]};switch(b[0]){case"M":x.length=0,T=E=b[1],U=D=b[2];break;case"L":x.length=c(E,D,b[1],b[2]),E=b[1],D=b[2];break;case"C":_=m(E,D,b[1],b[2],b[3],b[4],b[5],b[6]),x.length=W(_,E,D),E=b[5],D=b[6];break;case"Q":_=k(E,D,b[1],b[2],b[3],b[4]),x.length=W(_,E,D),E=b[3],D=b[4];break;case"Z":case"z":x.destX=T,x.destY=U,x.length=c(E,D,T,U),E=T,D=U;break}N+=x.length,y.push(x)}return y.push({length:N,x:E,y:D}),y}function $(A,N,j){j||(j=J(A));for(var b=j[j.length-1]*N,E=0;b-j[E]>0&&E<j.length;)b-=j[E],E++;var D=j[E],T=b/D.length,U=D.length,y=A[E];switch(U){case"Z":case"z":return new d.Point(D.x,D.y).lerp(new d.Point(D.destX,D.destY),T);case"L":return new d.Point(D.x,D.y).lerp(new d.Point(y[1],y[2]),T);case"C":return m(D.x,D.y,y[1],y[2],y[3],y[4],y[5],y[6])(T);case"Q":return k(D.x,D.y,y[1],y[2],y[3],y[4])(T)}}function Q(A){var N=[],j=[],b,E,D=d.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",U="("+T+")"+d.commaWsp,y="([01])"+d.commaWsp+"?",_=U+"?"+U+"?"+U+y+y+U+"?("+T+")",x=new RegExp(_,"g"),O,B,P;if(!A||!A.match)return N;P=A.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var G=0,V,R=P.length;G<R;G++){b=P[G],B=b.slice(1).trim(),j.length=0;var w=b.charAt(0);if(V=[w],w.toLowerCase()==="a")for(var I;I=x.exec(B);)for(var F=1;F<I.length;F++)j.push(I[F]);else for(;O=D.exec(B);)j.push(O[0]);for(var F=0,M=j.length;F<M;F++)E=parseFloat(j[F]),isNaN(E)||V.push(E);var H=t[w.toLowerCase()],X=r[w]||w;if(V.length-1>H)for(var te=1,re=V.length;te<re;te+=H)N.push([w].concat(V.slice(te,te+H))),w=X;else N.push(V)}return N}function q(A,N,j,b,E,D,T,U,y){for(var _=0,x=0,O,B=[],P=n(U-A,y-N,j,b,D,T,E),G=0,V=P.length;G<V;G++)O=s(_,x,P[G][1],P[G][2],P[G][3],P[G][4],P[G][5],P[G][6]),B.push({x:O[0].x+A,y:O[0].y+N}),B.push({x:O[1].x+A,y:O[1].y+N}),_=P[G][5],x=P[G][6];return B}function K(A,N,j,b){b=b.slice(0).unshift("X");var E=a(N,j,b);E.forEach(function(D){A.bezierCurveTo.apply(A,D.slice(1))})}d.util.parsePath=Q,d.util.makePathSimpler=l,d.util.getPathSegmentsInfo=J,d.util.fromArcToBeizers=a,d.util.getBoundsOfCurve=s,d.util.getPointOnPath=$,d.util.getBoundsOfArc=q,d.util.drawArc=K})();(function(){var e=Array.prototype.slice;function t(s,a){for(var l=e.call(arguments,2),c=[],h=0,u=s.length;h<u;h++)c[h]=l.length?s[h][a].apply(s[h],l):s[h][a].call(s[h]);return c}function r(s,a){return o(s,a,function(l,c){return l>=c})}function i(s,a){return o(s,a,function(l,c){return l<c})}function n(s,a){for(var l=s.length;l--;)s[l]=a;return s}function o(s,a,l){if(!s||s.length===0)return;var c=s.length-1,h=a?s[c][a]:s[c];if(a)for(;c--;)l(s[c][a],h)&&(h=s[c][a]);else for(;c--;)l(s[c],h)&&(h=s[c]);return h}d.util.array={fill:n,invoke:t,min:i,max:r}})();(function(){function e(r,i,n){if(n)if(!d.isLikelyNode&&i instanceof Element)r=i;else if(i instanceof Array){r=[];for(var o=0,s=i.length;o<s;o++)r[o]=e({},i[o],n)}else if(i&&typeof i=="object")for(var a in i)a==="canvas"||a==="group"?r[a]=null:i.hasOwnProperty(a)&&(r[a]=e({},i[a],n));else r=i;else for(var a in i)r[a]=i[a];return r}function t(r,i){return e({},r,i)}d.util.object={extend:e,clone:t},d.util.object.extend(d.util,d.Observable)})();(function(){function e(o){return o.replace(/-+(.)?/g,function(s,a){return a?a.toUpperCase():""})}function t(o,s){return o.charAt(0).toUpperCase()+(s?o.slice(1):o.slice(1).toLowerCase())}function r(o){return o.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(o){var s=0,a,l=[];for(s=0,a;s<o.length;s++){if((a=n(o,s))===!1)continue;l.push(a)}return l}function n(o,s){var a=o.charCodeAt(s);if(isNaN(a))return"";if(a<55296||a>57343)return o.charAt(s);if(55296<=a&&a<=56319){if(o.length<=s+1)throw"High surrogate without following low surrogate";var l=o.charCodeAt(s+1);if(56320>l||l>57343)throw"High surrogate without following low surrogate";return o.charAt(s)+o.charAt(s+1)}if(s===0)throw"Low surrogate without preceding high surrogate";var c=o.charCodeAt(s-1);if(55296>c||c>56319)throw"Low surrogate without preceding high surrogate";return!1}d.util.string={camelize:e,capitalize:t,escapeXml:r,graphemeSplit:i}})();(function(){var e=Array.prototype.slice,t=function(){},r=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),i=function(a,l,c){for(var h in l)h in a.prototype&&typeof a.prototype[h]=="function"&&(l[h]+"").indexOf("callSuper")>-1?a.prototype[h]=function(u){return function(){var f=this.constructor.superclass;this.constructor.superclass=c;var p=l[u].apply(this,arguments);if(this.constructor.superclass=f,u!=="initialize")return p}}(h):a.prototype[h]=l[h],r&&(l.toString!==Object.prototype.toString&&(a.prototype.toString=l.toString),l.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=l.valueOf))};function n(){}function o(a){for(var l=null,c=this;c.constructor.superclass;){var h=c.constructor.superclass.prototype[a];if(c[a]!==h){l=h;break}c=c.constructor.superclass.prototype}return l?arguments.length>1?l.apply(this,e.call(arguments,1)):l.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function s(){var a=null,l=e.call(arguments,0);typeof l[0]=="function"&&(a=l.shift());function c(){this.initialize.apply(this,arguments)}c.superclass=a,c.subclasses=[],a&&(n.prototype=a.prototype,c.prototype=new n,a.subclasses.push(c));for(var h=0,u=l.length;h<u;h++)i(c,l[h],a);return c.prototype.initialize||(c.prototype.initialize=t),c.prototype.constructor=c,c.prototype.callSuper=o,c}d.util.createClass=s})();(function(){var e=!!d.document.createElement("div").attachEvent,t=["touchstart","touchmove","touchend"];d.util.addListener=function(i,n,o,s){i&&i.addEventListener(n,o,e?!1:s)},d.util.removeListener=function(i,n,o,s){i&&i.removeEventListener(n,o,e?!1:s)};function r(i){var n=i.changedTouches;return n&&n[0]?n[0]:i}d.util.getPointer=function(i){var n=i.target,o=d.util.getScrollLeftTop(n),s=r(i);return{x:s.clientX+o.left,y:s.clientY+o.top}},d.util.isTouchEvent=function(i){return t.indexOf(i.type)>-1||i.pointerType==="touch"}})();(function(){function e(s,a){var l=s.style;if(!l)return s;if(typeof a=="string")return s.style.cssText+=";"+a,a.indexOf("opacity")>-1?o(s,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):s;for(var c in a)if(c==="opacity")o(s,a[c]);else{var h=c==="float"||c==="cssFloat"?typeof l.styleFloat=="undefined"?"cssFloat":"styleFloat":c;l[h]=a[c]}return s}var t=d.document.createElement("div"),r=typeof t.style.opacity=="string",i=typeof t.style.filter=="string",n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,o=function(s){return s};r?o=function(s,a){return s.style.opacity=a,s}:i&&(o=function(s,a){var l=s.style;return s.currentStyle&&!s.currentStyle.hasLayout&&(l.zoom=1),n.test(l.filter)?(a=a>=.9999?"":"alpha(opacity="+a*100+")",l.filter=l.filter.replace(n,a)):l.filter+=" alpha(opacity="+a*100+")",s}),d.util.setStyle=e})();(function(){var e=Array.prototype.slice;function t(p){return typeof p=="string"?d.document.getElementById(p):p}var r,i=function(p){return e.call(p,0)};try{r=i(d.document.childNodes)instanceof Array}catch(p){}r||(i=function(p){for(var m=new Array(p.length),g=p.length;g--;)m[g]=p[g];return m});function n(p,m){var g=d.document.createElement(p);for(var S in m)S==="class"?g.className=m[S]:S==="for"?g.htmlFor=m[S]:g.setAttribute(S,m[S]);return g}function o(p,m){p&&(" "+p.className+" ").indexOf(" "+m+" ")===-1&&(p.className+=(p.className?" ":"")+m)}function s(p,m,g){return typeof m=="string"&&(m=n(m,g)),p.parentNode&&p.parentNode.replaceChild(m,p),m.appendChild(p),m}function a(p){for(var m=0,g=0,S=d.document.documentElement,C=d.document.body||{scrollLeft:0,scrollTop:0};p&&(p.parentNode||p.host)&&!(p=p.parentNode||p.host,p===d.document?(m=C.scrollLeft||S.scrollLeft||0,g=C.scrollTop||S.scrollTop||0):(m+=p.scrollLeft||0,g+=p.scrollTop||0),p.nodeType===1&&p.style.position==="fixed"););return{left:m,top:g}}function l(p){var m,g=p&&p.ownerDocument,S={left:0,top:0},C={left:0,top:0},k,W={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return C;for(var J in W)C[W[J]]+=parseInt(c(p,J),10)||0;return m=g.documentElement,typeof p.getBoundingClientRect!="undefined"&&(S=p.getBoundingClientRect()),k=a(p),{left:S.left+k.left-(m.clientLeft||0)+C.left,top:S.top+k.top-(m.clientTop||0)+C.top}}var c;d.document.defaultView&&d.document.defaultView.getComputedStyle?c=function(p,m){var g=d.document.defaultView.getComputedStyle(p,null);return g?g[m]:void 0}:c=function(p,m){var g=p.style[m];return!g&&p.currentStyle&&(g=p.currentStyle[m]),g},function(){var p=d.document.documentElement.style,m="userSelect"in p?"userSelect":"MozUserSelect"in p?"MozUserSelect":"WebkitUserSelect"in p?"WebkitUserSelect":"KhtmlUserSelect"in p?"KhtmlUserSelect":"";function g(C){return typeof C.onselectstart!="undefined"&&(C.onselectstart=d.util.falseFunction),m?C.style[m]="none":typeof C.unselectable=="string"&&(C.unselectable="on"),C}function S(C){return typeof C.onselectstart!="undefined"&&(C.onselectstart=null),m?C.style[m]="":typeof C.unselectable=="string"&&(C.unselectable=""),C}d.util.makeElementUnselectable=g,d.util.makeElementSelectable=S}();function h(p){var m=d.jsdomImplForWrapper(p);return m._canvas||m._image}function u(p){if(!d.isLikelyNode)return;var m=d.jsdomImplForWrapper(p);m&&(m._image=null,m._canvas=null,m._currentSrc=null,m._attributes=null,m._classList=null)}function f(p,m){p.imageSmoothingEnabled=p.imageSmoothingEnabled||p.webkitImageSmoothingEnabled||p.mozImageSmoothingEnabled||p.msImageSmoothingEnabled||p.oImageSmoothingEnabled,p.imageSmoothingEnabled=m}d.util.setImageSmoothing=f,d.util.getById=t,d.util.toArray=i,d.util.addClass=o,d.util.makeElement=n,d.util.wrapElement=s,d.util.getScrollLeftTop=a,d.util.getElementOffset=l,d.util.getNodeCanvas=h,d.util.cleanUpJsdomNode=u})();(function(){function e(i,n){return i+(/\?/.test(i)?"&":"?")+n}function t(){}function r(i,n){n||(n={});var o=n.method?n.method.toUpperCase():"GET",s=n.onComplete||function(){},a=new d.window.XMLHttpRequest,l=n.body||n.parameters;return a.onreadystatechange=function(){a.readyState===4&&(s(a),a.onreadystatechange=t)},o==="GET"&&(l=null,typeof n.parameters=="string"&&(i=e(i,n.parameters))),a.open(o,i,!0),(o==="POST"||o==="PUT")&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(l),a}d.util.request=r})();d.log=console.log;d.warn=console.warn;(function(){function e(){return!1}function t(a,l,c,h){return-c*Math.cos(a/h*(Math.PI/2))+c+l}function r(a){o(function(l){a||(a={});var c=l||+new Date,h=a.duration||500,u=c+h,f,p=a.onChange||e,m=a.abort||e,g=a.onComplete||e,S=a.easing||t,C="startValue"in a?a.startValue:0,k="endValue"in a?a.endValue:100,W=a.byValue||k-C;a.onStart&&a.onStart(),function J($){f=$||+new Date;var Q=f>u?h:f-c,q=Q/h,K=S(Q,C,W,h),A=Math.abs((K-C)/W);if(m()){g(k,1,1);return}if(f>u){p(k,1,1),g(k,1,1);return}else p(K,A,q),o(J)}(c)})}var i=d.window.requestAnimationFrame||d.window.webkitRequestAnimationFrame||d.window.mozRequestAnimationFrame||d.window.oRequestAnimationFrame||d.window.msRequestAnimationFrame||function(a){return d.window.setTimeout(a,1e3/60)},n=d.window.cancelAnimationFrame||d.window.clearTimeout;function o(){return i.apply(d.window,arguments)}function s(){return n.apply(d.window,arguments)}d.util.animate=r,d.util.requestAnimFrame=o,d.util.cancelAnimFrame=s})();(function(){function e(r,i,n){var o="rgba("+parseInt(r[0]+n*(i[0]-r[0]),10)+","+parseInt(r[1]+n*(i[1]-r[1]),10)+","+parseInt(r[2]+n*(i[2]-r[2]),10);return o+=","+(r&&i?parseFloat(r[3]+n*(i[3]-r[3])):1),o+=")",o}function t(r,i,n,o){var s=new d.Color(r).getSource(),a=new d.Color(i).getSource(),l=o.onComplete,c=o.onChange;o=o||{},d.util.animate(d.util.object.extend(o,{duration:n||500,startValue:s,endValue:a,byValue:a,easing:function(h,u,f,p){var m=o.colorEasing?o.colorEasing(h,p):1-Math.cos(h/p*(Math.PI/2));return e(u,f,m)},onComplete:function(h,u,f){if(l)return l(e(a,a,0),u,f)},onChange:function(h,u,f){if(c){if(Array.isArray(h))return c(e(h,h,0),u,f);c(h,u,f)}}}))}d.util.animateColor=t})();(function(){function e(b,E,D,T){return b<Math.abs(E)?(b=E,T=D/4):E===0&&b===0?T=D/(2*Math.PI)*Math.asin(1):T=D/(2*Math.PI)*Math.asin(E/b),{a:b,c:E,p:D,s:T}}function t(b,E,D){return b.a*Math.pow(2,10*(E-=1))*Math.sin((E*D-b.s)*(2*Math.PI)/b.p)}function r(b,E,D,T){return D*((b=b/T-1)*b*b+1)+E}function i(b,E,D,T){return b/=T/2,b<1?D/2*b*b*b+E:D/2*((b-=2)*b*b+2)+E}function n(b,E,D,T){return D*(b/=T)*b*b*b+E}function o(b,E,D,T){return-D*((b=b/T-1)*b*b*b-1)+E}function s(b,E,D,T){return b/=T/2,b<1?D/2*b*b*b*b+E:-D/2*((b-=2)*b*b*b-2)+E}function a(b,E,D,T){return D*(b/=T)*b*b*b*b+E}function l(b,E,D,T){return D*((b=b/T-1)*b*b*b*b+1)+E}function c(b,E,D,T){return b/=T/2,b<1?D/2*b*b*b*b*b+E:D/2*((b-=2)*b*b*b*b+2)+E}function h(b,E,D,T){return-D*Math.cos(b/T*(Math.PI/2))+D+E}function u(b,E,D,T){return D*Math.sin(b/T*(Math.PI/2))+E}function f(b,E,D,T){return-D/2*(Math.cos(Math.PI*b/T)-1)+E}function p(b,E,D,T){return b===0?E:D*Math.pow(2,10*(b/T-1))+E}function m(b,E,D,T){return b===T?E+D:D*(-Math.pow(2,-10*b/T)+1)+E}function g(b,E,D,T){return b===0?E:b===T?E+D:(b/=T/2,b<1?D/2*Math.pow(2,10*(b-1))+E:D/2*(-Math.pow(2,-10*--b)+2)+E)}function S(b,E,D,T){return-D*(Math.sqrt(1-(b/=T)*b)-1)+E}function C(b,E,D,T){return D*Math.sqrt(1-(b=b/T-1)*b)+E}function k(b,E,D,T){return b/=T/2,b<1?-D/2*(Math.sqrt(1-b*b)-1)+E:D/2*(Math.sqrt(1-(b-=2)*b)+1)+E}function W(b,E,D,T){var U=1.70158,y=0,_=D;if(b===0)return E;if(b/=T,b===1)return E+D;y||(y=T*.3);var x=e(_,D,y,U);return-t(x,b,T)+E}function J(b,E,D,T){var U=1.70158,y=0,_=D;if(b===0)return E;if(b/=T,b===1)return E+D;y||(y=T*.3);var x=e(_,D,y,U);return x.a*Math.pow(2,-10*b)*Math.sin((b*T-x.s)*(2*Math.PI)/x.p)+x.c+E}function $(b,E,D,T){var U=1.70158,y=0,_=D;if(b===0)return E;if(b/=T/2,b===2)return E+D;y||(y=T*(.3*1.5));var x=e(_,D,y,U);return b<1?-.5*t(x,b,T)+E:x.a*Math.pow(2,-10*(b-=1))*Math.sin((b*T-x.s)*(2*Math.PI)/x.p)*.5+x.c+E}function Q(b,E,D,T,U){return U===void 0&&(U=1.70158),D*(b/=T)*b*((U+1)*b-U)+E}function q(b,E,D,T,U){return U===void 0&&(U=1.70158),D*((b=b/T-1)*b*((U+1)*b+U)+1)+E}function K(b,E,D,T,U){return U===void 0&&(U=1.70158),b/=T/2,b<1?D/2*(b*b*(((U*=1.525)+1)*b-U))+E:D/2*((b-=2)*b*(((U*=1.525)+1)*b+U)+2)+E}function A(b,E,D,T){return D-N(T-b,0,D,T)+E}function N(b,E,D,T){return(b/=T)<1/2.75?D*(7.5625*b*b)+E:b<2/2.75?D*(7.5625*(b-=1.5/2.75)*b+.75)+E:b<2.5/2.75?D*(7.5625*(b-=2.25/2.75)*b+.9375)+E:D*(7.5625*(b-=2.625/2.75)*b+.984375)+E}function j(b,E,D,T){return b<T/2?A(b*2,0,D,T)*.5+E:N(b*2-T,0,D,T)*.5+D*.5+E}d.util.ease={easeInQuad:function(b,E,D,T){return D*(b/=T)*b+E},easeOutQuad:function(b,E,D,T){return-D*(b/=T)*(b-2)+E},easeInOutQuad:function(b,E,D,T){return b/=T/2,b<1?D/2*b*b+E:-D/2*(--b*(b-2)-1)+E},easeInCubic:function(b,E,D,T){return D*(b/=T)*b*b+E},easeOutCubic:r,easeInOutCubic:i,easeInQuart:n,easeOutQuart:o,easeInOutQuart:s,easeInQuint:a,easeOutQuint:l,easeInOutQuint:c,easeInSine:h,easeOutSine:u,easeInOutSine:f,easeInExpo:p,easeOutExpo:m,easeInOutExpo:g,easeInCirc:S,easeOutCirc:C,easeInOutCirc:k,easeInElastic:W,easeOutElastic:J,easeInOutElastic:$,easeInBack:Q,easeOutBack:q,easeInOutBack:K,easeInBounce:A,easeOutBounce:N,easeInOutBounce:j}})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n=t.util.toFixed,o=t.util.parseUnit,s=t.util.multiplyTransformMatrices,a=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],l=["symbol","image","marker","pattern","view","svg"],c=["pattern","defs","symbol","metadata","clipPath","mask","desc"],h=["symbol","g","a","svg","clipPath","defs"],u={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},p="font-size",m="clip-path";t.svgValidTagNamesRegEx=C(a),t.svgViewBoxElementsRegEx=C(l),t.svgInvalidAncestorsRegEx=C(c),t.svgValidParentsRegEx=C(h),t.cssRules={},t.gradientDefs={},t.clipPaths={};function g(y){return y in u?u[y]:y}function S(y,_,x,O){var B=Object.prototype.toString.call(_)==="[object Array]",P;if((y==="fill"||y==="stroke")&&_==="none")_="";else{if(y==="strokeUniform")return _==="non-scaling-stroke";if(y==="strokeDashArray")_==="none"?_=null:_=_.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(y==="transformMatrix")x&&x.transformMatrix?_=s(x.transformMatrix,t.parseTransformAttribute(_)):_=t.parseTransformAttribute(_);else if(y==="visible")_=_!=="none"&&_!=="hidden",x&&x.visible===!1&&(_=!1);else if(y==="opacity")_=parseFloat(_),x&&typeof x.opacity!="undefined"&&(_*=x.opacity);else if(y==="textAnchor")_=_==="start"?"left":_==="end"?"right":"center";else if(y==="charSpacing")P=o(_,O)/O*1e3;else if(y==="paintFirst"){var G=_.indexOf("fill"),V=_.indexOf("stroke"),_="fill";(G>-1&&V>-1&&V<G||G===-1&&V>-1)&&(_="stroke")}else{if(y==="href"||y==="xlink:href"||y==="font")return _;if(y==="imageSmoothing")return _==="optimizeQuality";P=B?_.map(o):o(_,O)}}return!B&&isNaN(P)?_:P}function C(y){return new RegExp("^("+y.join("|")+")\\b","i")}function k(y){for(var _ in f){if(typeof y[f[_]]=="undefined"||y[_]==="")continue;if(typeof y[_]=="undefined"){if(!t.Object.prototype[_])continue;y[_]=t.Object.prototype[_]}if(y[_].indexOf("url(")===0)continue;var x=new t.Color(y[_]);y[_]=x.setAlpha(n(x.getAlpha()*y[f[_]],2)).toRgba()}return y}function W(y,_){var x,O=[],B,P,G;for(P=0,G=_.length;P<G;P++)x=_[P],B=y.getElementsByTagName(x),O=O.concat(Array.prototype.slice.call(B));return O}t.parseTransformAttribute=function(){function y(Y,Z){var ie=t.util.cos(Z[0]),oe=t.util.sin(Z[0]),ue=0,de=0;Z.length===3&&(ue=Z[1],de=Z[2]),Y[0]=ie,Y[1]=oe,Y[2]=-oe,Y[3]=ie,Y[4]=ue-(ie*ue-oe*de),Y[5]=de-(oe*ue+ie*de)}function _(Y,Z){var ie=Z[0],oe=Z.length===2?Z[1]:Z[0];Y[0]=ie,Y[3]=oe}function x(Y,Z,ie){Y[ie]=Math.tan(t.util.degreesToRadians(Z[0]))}function O(Y,Z){Y[4]=Z[0],Z.length===2&&(Y[5]=Z[1])}var B=t.iMatrix,P=t.reNum,G=t.commaWsp,V="(?:(skewX)\\s*\\(\\s*("+P+")\\s*\\))",R="(?:(skewY)\\s*\\(\\s*("+P+")\\s*\\))",w="(?:(rotate)\\s*\\(\\s*("+P+")(?:"+G+"("+P+")"+G+"("+P+"))?\\s*\\))",I="(?:(scale)\\s*\\(\\s*("+P+")(?:"+G+"("+P+"))?\\s*\\))",F="(?:(translate)\\s*\\(\\s*("+P+")(?:"+G+"("+P+"))?\\s*\\))",M="(?:(matrix)\\s*\\(\\s*("+P+")"+G+"("+P+")"+G+"("+P+")"+G+"("+P+")"+G+"("+P+")"+G+"("+P+")\\s*\\))",H="(?:"+M+"|"+F+"|"+I+"|"+w+"|"+V+"|"+R+")",X="(?:"+H+"(?:"+G+"*"+H+")*)",te="^\\s*(?:"+X+"?)\\s*$",re=new RegExp(te),z=new RegExp(H,"g");return function(Y){var Z=B.concat(),ie=[];if(!Y||Y&&!re.test(Y))return Z;Y.replace(z,function(ue){var de=new RegExp(H).exec(ue).filter(function(Ct){return!!Ct}),ve=de[1],he=de.slice(2).map(parseFloat);switch(ve){case"translate":O(Z,he);break;case"rotate":he[0]=t.util.degreesToRadians(he[0]),y(Z,he);break;case"scale":_(Z,he);break;case"skewX":x(Z,he,2);break;case"skewY":x(Z,he,1);break;case"matrix":Z=he;break}ie.push(Z.concat()),Z=B.concat()});for(var oe=ie[0];ie.length>1;)ie.shift(),oe=t.util.multiplyTransformMatrices(oe,ie[0]);return oe}}();function J(y,_){var x,O;y.replace(/;\s*$/,"").split(";").forEach(function(B){var P=B.split(":");x=P[0].trim().toLowerCase(),O=P[1].trim(),_[x]=O})}function $(y,_){var x,O;for(var B in y){if(typeof y[B]=="undefined")continue;x=B.toLowerCase(),O=y[B],_[x]=O}}function Q(y,_){var x={};for(var O in t.cssRules[_])if(q(y,O.split(" ")))for(var B in t.cssRules[_][O])x[B]=t.cssRules[_][O][B];return x}function q(y,_){var x,O=!0;return x=A(y,_.pop()),x&&_.length&&(O=K(y,_)),x&&O&&_.length===0}function K(y,_){for(var x,O=!0;y.parentNode&&y.parentNode.nodeType===1&&_.length;)O&&(x=_.pop()),y=y.parentNode,O=A(y,x);return _.length===0}function A(y,_){var x=y.nodeName,O=y.getAttribute("class"),B=y.getAttribute("id"),P,G;if(P=new RegExp("^"+x,"i"),_=_.replace(P,""),B&&_.length&&(P=new RegExp("#"+B+"(?![a-zA-Z\\-]+)","i"),_=_.replace(P,"")),O&&_.length)for(O=O.split(" "),G=O.length;G--;)P=new RegExp("\\."+O[G]+"(?![a-zA-Z\\-]+)","i"),_=_.replace(P,"");return _.length===0}function N(y,_){var x;if(y.getElementById&&(x=y.getElementById(_)),x)return x;var O,B,P,G=y.getElementsByTagName("*");for(B=0,P=G.length;B<P;B++)if(O=G[B],_===O.getAttribute("id"))return O}function j(y){for(var _=W(y,["use","svg:use"]),x=0;_.length&&x<_.length;){var O=_[x],B=(O.getAttribute("xlink:href")||O.getAttribute("href")).substr(1),P=O.getAttribute("x")||0,G=O.getAttribute("y")||0,V=N(y,B).cloneNode(!0),R=(V.getAttribute("transform")||"")+" translate("+P+", "+G+")",w,I=_.length,F,M,H,X,te=t.svgNS;if(E(V),/^svg$/i.test(V.nodeName)){var re=V.ownerDocument.createElementNS(te,"g");for(M=0,H=V.attributes,X=H.length;M<X;M++)F=H.item(M),re.setAttributeNS(te,F.nodeName,F.nodeValue);for(;V.firstChild;)re.appendChild(V.firstChild);V=re}for(M=0,H=O.attributes,X=H.length;M<X;M++){if(F=H.item(M),F.nodeName==="x"||F.nodeName==="y"||F.nodeName==="xlink:href"||F.nodeName==="href")continue;F.nodeName==="transform"?R=F.nodeValue+" "+R:V.setAttribute(F.nodeName,F.nodeValue)}V.setAttribute("transform",R),V.setAttribute("instantiated_by_use","1"),V.removeAttribute("id"),w=O.parentNode,w.replaceChild(V,O),_.length===I&&x++}}var b=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function E(y){if(!t.svgViewBoxElementsRegEx.test(y.nodeName))return;var _=y.getAttribute("viewBox"),x=1,O=1,B=0,P=0,G,V,R,w,I=y.getAttribute("width"),F=y.getAttribute("height"),M=y.getAttribute("x")||0,H=y.getAttribute("y")||0,X=y.getAttribute("preserveAspectRatio")||"",te=!_||!(_=_.match(b)),re=!I||!F||I==="100%"||F==="100%",z=te&&re,Y={},Z="",ie=0,oe=0;if(Y.width=0,Y.height=0,Y.toBeParsed=z,te&&((M||H)&&y.parentNode.nodeName!=="#document"&&(Z=" translate("+o(M)+" "+o(H)+") ",R=(y.getAttribute("transform")||"")+Z,y.setAttribute("transform",R),y.removeAttribute("x"),y.removeAttribute("y"))),z)return Y;if(te)return Y.width=o(I),Y.height=o(F),Y;if(B=-parseFloat(_[1]),P=-parseFloat(_[2]),G=parseFloat(_[3]),V=parseFloat(_[4]),Y.minX=B,Y.minY=P,Y.viewBoxWidth=G,Y.viewBoxHeight=V,re?(Y.width=G,Y.height=V):(Y.width=o(I),Y.height=o(F),x=Y.width/G,O=Y.height/V),X=t.util.parsePreserveAspectRatioAttribute(X),X.alignX!=="none"&&(X.meetOrSlice==="meet"&&(O=x=x>O?O:x),X.meetOrSlice==="slice"&&(O=x=x>O?x:O),ie=Y.width-G*x,oe=Y.height-V*x,X.alignX==="Mid"&&(ie/=2),X.alignY==="Mid"&&(oe/=2),X.alignX==="Min"&&(ie=0),X.alignY==="Min"&&(oe=0)),x===1&&O===1&&B===0&&P===0&&M===0&&H===0)return Y;if((M||H)&&y.parentNode.nodeName!=="#document"&&(Z=" translate("+o(M)+" "+o(H)+") "),R=Z+" matrix("+x+" 0 0 "+O+" "+(B*x+ie)+" "+(P*O+oe)+") ",y.nodeName==="svg"){for(w=y.ownerDocument.createElementNS(t.svgNS,"g");y.firstChild;)w.appendChild(y.firstChild);y.appendChild(w)}else w=y,w.removeAttribute("x"),w.removeAttribute("y"),R=w.getAttribute("transform")+R;return w.setAttribute("transform",R),Y}function D(y,_){for(;y&&(y=y.parentNode);)if(y.nodeName&&_.test(y.nodeName.replace("svg:",""))&&!y.getAttribute("instantiated_by_use"))return!0;return!1}t.parseSVGDocument=function(y,_,x,O){if(!y)return;j(y);var B=t.Object.__uid++,P,G,V=E(y),R=t.util.toArray(y.getElementsByTagName("*"));if(V.crossOrigin=O&&O.crossOrigin,V.svgUid=B,R.length===0&&t.isLikelyNode){R=y.selectNodes('//*[name(.)!="svg"]');var w=[];for(P=0,G=R.length;P<G;P++)w[P]=R[P];R=w}var I=R.filter(function(M){return E(M),t.svgValidTagNamesRegEx.test(M.nodeName.replace("svg:",""))&&!D(M,t.svgInvalidAncestorsRegEx)});if(!I||I&&!I.length){_&&_([],{});return}var F={};R.filter(function(M){return M.nodeName.replace("svg:","")==="clipPath"}).forEach(function(M){var H=M.getAttribute("id");F[H]=t.util.toArray(M.getElementsByTagName("*")).filter(function(X){return t.svgValidTagNamesRegEx.test(X.nodeName.replace("svg:",""))})}),t.gradientDefs[B]=t.getGradientDefs(y),t.cssRules[B]=t.getCSSRules(y),t.clipPaths[B]=F,t.parseElements(I,function(M,H){_&&(_(M,V,H,R),delete t.gradientDefs[B],delete t.cssRules[B],delete t.clipPaths[B])},i(V),x,O)};function T(y,_){var x=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],O="xlink:href",B=_.getAttribute(O).substr(1),P=N(y,B);if(P&&P.getAttribute(O)&&T(y,P),x.forEach(function(V){P&&!_.hasAttribute(V)&&P.hasAttribute(V)&&_.setAttribute(V,P.getAttribute(V))}),!_.children.length)for(var G=P.cloneNode(!0);G.firstChild;)_.appendChild(G.firstChild);_.removeAttribute(O)}var U=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");r(t,{parseFontDeclaration:function(y,_){var x=y.match(U);if(!x)return;var O=x[1],B=x[3],P=x[4],G=x[5],V=x[6];O&&(_.fontStyle=O),B&&(_.fontWeight=isNaN(parseFloat(B))?B:parseFloat(B)),P&&(_.fontSize=o(P)),V&&(_.fontFamily=V),G&&(_.lineHeight=G==="normal"?1:G)},getGradientDefs:function(y){var _=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],x=W(y,_),O,B=0,P={};for(B=x.length;B--;)O=x[B],O.getAttribute("xlink:href")&&T(y,O),P[O.getAttribute("id")]=O;return P},parseAttributes:function(y,_,x){if(!y)return;var O,B={},P,G;typeof x=="undefined"&&(x=y.getAttribute("svgUid")),y.parentNode&&t.svgValidParentsRegEx.test(y.parentNode.nodeName)&&(B=t.parseAttributes(y.parentNode,_,x));var V=_.reduce(function(X,te){return O=y.getAttribute(te),O&&(X[te]=O),X},{}),R=r(Q(y,x),t.parseStyleAttribute(y));V=r(V,R),R[m]&&y.setAttribute(m,R[m]),P=G=B.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,V[p]&&(V[p]=P=o(V[p],G));var w,I,F={};for(var M in V)w=g(M),I=S(w,V[M],B,P),F[w]=I;F&&F.font&&t.parseFontDeclaration(F.font,F);var H=r(B,F);return t.svgValidParentsRegEx.test(y.nodeName)?H:k(H)},parseElements:function(y,_,x,O,B){new t.ElementsParser(y,_,x,O,B).parse()},parseStyleAttribute:function(y){var _={},x=y.getAttribute("style");return x&&(typeof x=="string"?J(x,_):$(x,_)),_},parsePointsAttribute:function(y){if(!y)return null;y=y.replace(/,/g," ").trim(),y=y.split(/\s+/);var _=[],x,O;for(x=0,O=y.length;x<O;x+=2)_.push({x:parseFloat(y[x]),y:parseFloat(y[x+1])});return _},getCSSRules:function(y){var _=y.getElementsByTagName("style"),x,O,B={},P;for(x=0,O=_.length;x<O;x++){var G=_[x].textContent||"";if(G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()==="")continue;P=G.match(/[^{]*\{[\s\S]*?\}/g),P=P.map(function(V){return V.trim()}),P.forEach(function(V){var R=V.match(/([\s\S]*?)\s*\{([^}]*)\}/),w={},I=R[2].trim(),F=I.replace(/;$/,"").split(/\s*;\s*/);for(x=0,O=F.length;x<O;x++){var M=F[x].split(/\s*:\s*/),H=M[0],X=M[1];w[H]=X}V=R[1],V.split(",").forEach(function(te){if(te=te.replace(/^svg/i,"").trim(),te==="")return;B[te]?t.util.object.extend(B[te],w):B[te]=t.util.object.clone(w)})})}return B},loadSVGFromURL:function(y,_,x,O){y=y.replace(/^\n\s*/,"").trim(),new t.util.request(y,{method:"get",onComplete:B});function B(P){var G=P.responseXML;if(!G||!G.documentElement)return _&&_(null),!1;t.parseSVGDocument(G.documentElement,function(V,R,w,I){_&&_(V,R,w,I)},x,O)}},loadSVGFromString:function(y,_,x,O){var B=new t.window.DOMParser,P=B.parseFromString(y.trim(),"text/xml");t.parseSVGDocument(P.documentElement,function(G,V,R,w){_(G,V,R,w)},x,O)}})})((typeof L!="undefined",L));d.ElementsParser=function(e,t,r,i,n,o){this.elements=e,this.callback=t,this.options=r,this.reviver=i,this.svgUid=r&&r.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o};(function(e){e.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var t=this;this.elements.forEach(function(r,i){r.setAttribute("svgUid",t.svgUid),t.createObject(r,i)})},e.findTag=function(t){return d[d.util.string.capitalize(t.tagName.replace("svg:",""))]},e.createObject=function(t,r){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(r,t),this.options)}catch(n){d.log(n)}else this.checkIfDone()},e.createCallback=function(t,r){var i=this;return function(n){var o;i.resolveGradient(n,r,"fill"),i.resolveGradient(n,r,"stroke"),n instanceof d.Image&&n._originalElement&&(o=n.parsePreserveAspectRatioAttribute(r)),n._removeTransformMatrix(o),i.resolveClipPath(n,r),i.reviver&&i.reviver(r,n),i.instances[t]=n,i.checkIfDone()}},e.extractPropertyDefinition=function(t,r,i){var n=t[r],o=this.regexUrl;if(!o.test(n))return;o.lastIndex=0;var s=o.exec(n)[1];return o.lastIndex=0,d[i][this.svgUid][s]},e.resolveGradient=function(t,r,i){var n=this.extractPropertyDefinition(t,i,"gradientDefs");if(n){var o=r.getAttribute(i+"-opacity"),s=d.Gradient.fromElement(n,t,o,this.options);t.set(i,s)}},e.createClipPathCallback=function(t,r){return function(i){i._removeTransformMatrix(),i.fillRule=i.clipRule,r.push(i)}},e.resolveClipPath=function(t,r){var i=this.extractPropertyDefinition(t,"clipPath","clipPaths"),n,o,s,a,l,c;if(i){a=[],s=d.util.invertTransform(t.calcTransformMatrix());for(var h=i[0].parentNode,u=r;u.parentNode&&u.getAttribute("clip-path")!==t.clipPath;)u=u.parentNode;u.parentNode.appendChild(h);for(var f=0;f<i.length;f++)n=i[f],o=this.findTag(n),o.fromElement(n,this.createClipPathCallback(t,a),this.options);a.length===1?i=a[0]:i=new d.Group(a),l=d.util.multiplyTransformMatrices(s,i.calcTransformMatrix()),i.clipPath&&this.resolveClipPath(i,u);var c=d.util.qrDecompose(l);i.flipX=!1,i.flipY=!1,i.set("scaleX",c.scaleX),i.set("scaleY",c.scaleY),i.angle=c.angle,i.skewX=c.skewX,i.skewY=0,i.setPositionByOrigin({x:c.translateX,y:c.translateY},"center","center"),t.clipPath=i}else delete t.clipPath},e.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(t){return t!=null}),this.callback(this.instances,this.elements))}})(d.ElementsParser.prototype);(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=r;function r(i,n){this.x=i,this.y=n}r.prototype={type:"point",constructor:r,add:function(i){return new r(this.x+i.x,this.y+i.y)},addEquals:function(i){return this.x+=i.x,this.y+=i.y,this},scalarAdd:function(i){return new r(this.x+i,this.y+i)},scalarAddEquals:function(i){return this.x+=i,this.y+=i,this},subtract:function(i){return new r(this.x-i.x,this.y-i.y)},subtractEquals:function(i){return this.x-=i.x,this.y-=i.y,this},scalarSubtract:function(i){return new r(this.x-i,this.y-i)},scalarSubtractEquals:function(i){return this.x-=i,this.y-=i,this},multiply:function(i){return new r(this.x*i,this.y*i)},multiplyEquals:function(i){return this.x*=i,this.y*=i,this},divide:function(i){return new r(this.x/i,this.y/i)},divideEquals:function(i){return this.x/=i,this.y/=i,this},eq:function(i){return this.x===i.x&&this.y===i.y},lt:function(i){return this.x<i.x&&this.y<i.y},lte:function(i){return this.x<=i.x&&this.y<=i.y},gt:function(i){return this.x>i.x&&this.y>i.y},gte:function(i){return this.x>=i.x&&this.y>=i.y},lerp:function(i,n){return typeof n=="undefined"&&(n=.5),n=Math.max(Math.min(1,n),0),new r(this.x+(i.x-this.x)*n,this.y+(i.y-this.y)*n)},distanceFrom:function(i){var n=this.x-i.x,o=this.y-i.y;return Math.sqrt(n*n+o*o)},midPointFrom:function(i){return this.lerp(i)},min:function(i){return new r(Math.min(this.x,i.x),Math.min(this.y,i.y))},max:function(i){return new r(Math.max(this.x,i.x),Math.max(this.y,i.y))},toString:function(){return this.x+","+this.y},setXY:function(i,n){return this.x=i,this.y=n,this},setX:function(i){return this.x=i,this},setY:function(i){return this.y=i,this},setFromPoint:function(i){return this.x=i.x,this.y=i.y,this},swap:function(i){var n=this.x,o=this.y;this.x=i.x,this.y=i.y,i.x=n,i.y=o},clone:function(){return new r(this.x,this.y)}}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}function r(i){this.status=i,this.points=[]}t.Intersection=r,t.Intersection.prototype={constructor:r,appendPoint:function(i){return this.points.push(i),this},appendPoints:function(i){return this.points=this.points.concat(i),this}},t.Intersection.intersectLineLine=function(i,n,o,s){var a,l=(s.x-o.x)*(i.y-o.y)-(s.y-o.y)*(i.x-o.x),c=(n.x-i.x)*(i.y-o.y)-(n.y-i.y)*(i.x-o.x),h=(s.y-o.y)*(n.x-i.x)-(s.x-o.x)*(n.y-i.y);if(h!==0){var u=l/h,f=c/h;0<=u&&u<=1&&0<=f&&f<=1?(a=new r("Intersection"),a.appendPoint(new t.Point(i.x+u*(n.x-i.x),i.y+u*(n.y-i.y)))):a=new r}else l===0||c===0?a=new r("Coincident"):a=new r("Parallel");return a},t.Intersection.intersectLinePolygon=function(i,n,o){var s=new r,a=o.length,l,c,h,u;for(u=0;u<a;u++)l=o[u],c=o[(u+1)%a],h=r.intersectLineLine(i,n,l,c),s.appendPoints(h.points);return s.points.length>0&&(s.status="Intersection"),s},t.Intersection.intersectPolygonPolygon=function(i,n){var o=new r,s=i.length,a;for(a=0;a<s;a++){var l=i[a],c=i[(a+1)%s],h=r.intersectLinePolygon(l,c,n);o.appendPoints(h.points)}return o.points.length>0&&(o.status="Intersection"),o},t.Intersection.intersectPolygonRectangle=function(i,n,o){var s=n.min(o),a=n.max(o),l=new t.Point(a.x,s.y),c=new t.Point(s.x,a.y),h=r.intersectLinePolygon(s,l,i),u=r.intersectLinePolygon(l,a,i),f=r.intersectLinePolygon(a,c,i),p=r.intersectLinePolygon(c,s,i),m=new r;return m.appendPoints(h.points),m.appendPoints(u.points),m.appendPoints(f.points),m.appendPoints(p.points),m.points.length>0&&(m.status="Intersection"),m}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}function r(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}t.Color=r,t.Color.prototype={_tryParsingColor:function(n){var o;n in r.colorNameMap&&(n=r.colorNameMap[n]),n==="transparent"&&(o=[255,255,255,0]),o||(o=r.sourceFromHex(n)),o||(o=r.sourceFromRgb(n)),o||(o=r.sourceFromHsl(n)),o||(o=[0,0,0,1]),o&&this.setSource(o)},_rgbToHsl:function(n,o,s){n/=255,o/=255,s/=255;var a,l,c,h=t.util.array.max([n,o,s]),u=t.util.array.min([n,o,s]);if(c=(h+u)/2,h===u)a=l=0;else{var f=h-u;l=c>.5?f/(2-h-u):f/(h+u);switch(h){case n:a=(o-s)/f+(o<s?6:0);break;case o:a=(s-n)/f+2;break;case s:a=(n-o)/f+4;break}a/=6}return[Math.round(a*360),Math.round(l*100),Math.round(c*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),o=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+o[0]+","+o[1]+"%,"+o[2]+"%)"},toHsla:function(){var n=this.getSource(),o=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+o[0]+","+o[1]+"%,"+o[2]+"%,"+n[3]+")"},toHex:function(){var n=this.getSource(),o,s,a;return o=n[0].toString(16),o=o.length===1?"0"+o:o,s=n[1].toString(16),s=s.length===1?"0"+s:s,a=n[2].toString(16),a=a.length===1?"0"+a:a,o.toUpperCase()+s.toUpperCase()+a.toUpperCase()},toHexa:function(){var n=this.getSource(),o;return o=Math.round(n[3]*255),o=o.toString(16),o=o.length===1?"0"+o:o,this.toHex()+o.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var o=this.getSource();return o[3]=n,this.setSource(o),this},toGrayscale:function(){var n=this.getSource(),o=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),s=n[3];return this.setSource([o,o,o,s]),this},toBlackWhite:function(n){var o=this.getSource(),s=(o[0]*.3+o[1]*.59+o[2]*.11).toFixed(0),a=o[3];return n=n||127,s=Number(s)<Number(n)?0:255,this.setSource([s,s,s,a]),this},overlayWith:function(n){n instanceof r||(n=new r(n));var o=[],s=this.getAlpha(),a=.5,l=this.getSource(),c=n.getSource(),h;for(h=0;h<3;h++)o.push(Math.round(l[h]*(1-a)+c[h]*a));return o[3]=s,this.setSource(o),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(n,o,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(o-n)*6*s:s<1/2?o:s<2/3?n+(o-n)*(2/3-s)*6:n}t.Color.fromRgb=function(n){return r.fromSource(r.sourceFromRgb(n))},t.Color.sourceFromRgb=function(n){var o=n.match(r.reRGBa);if(o){var s=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),a=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),l=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(s,10),parseInt(a,10),parseInt(l,10),o[4]?parseFloat(o[4]):1]}},t.Color.fromRgba=r.fromRgb,t.Color.fromHsl=function(n){return r.fromSource(r.sourceFromHsl(n))},t.Color.sourceFromHsl=function(n){var o=n.match(r.reHSLa);if(!o)return;var s=(parseFloat(o[1])%360+360)%360/360,a=parseFloat(o[2])/(/%$/.test(o[2])?100:1),l=parseFloat(o[3])/(/%$/.test(o[3])?100:1),c,h,u;if(a===0)c=h=u=l;else{var f=l<=.5?l*(a+1):l+a-l*a,p=l*2-f;c=i(p,f,s+1/3),h=i(p,f,s),u=i(p,f,s-1/3)}return[Math.round(c*255),Math.round(h*255),Math.round(u*255),o[4]?parseFloat(o[4]):1]},t.Color.fromHsla=r.fromHsl,t.Color.fromHex=function(n){return r.fromSource(r.sourceFromHex(n))},t.Color.sourceFromHex=function(n){if(n.match(r.reHex)){var o=n.slice(n.indexOf("#")+1),s=o.length===3||o.length===4,a=o.length===8||o.length===4,l=s?o.charAt(0)+o.charAt(0):o.substring(0,2),c=s?o.charAt(1)+o.charAt(1):o.substring(2,4),h=s?o.charAt(2)+o.charAt(2):o.substring(4,6),u=a?s?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(l,16),parseInt(c,16),parseInt(h,16),parseFloat((parseInt(u,16)/255).toFixed(2))]}},t.Color.fromSource=function(n){var o=new r;return o.setSource(n),o}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=["e","se","s","sw","w","nw","n","ne","e"],i=["ns","nesw","ew","nwse"],n={},o="left",s="top",a="right",l="bottom",c="center",h={top:l,bottom:s,left:a,right:o,center:c},u=t.util.radiansToDegrees,f=Math.sign||function(R){return(R>0)-(R<0)||+R};function p(R,w){var I=R.angle+u(Math.atan2(w.y,w.x))+360;return Math.round(I%360/45)}function m(R,w){var I=w.transform.target,F=I.canvas,M=t.util.object.clone(w);M.target=I,F&&F.fire("object:"+R,M),I.fire(R,w)}function g(R,w){var I=w.canvas,F=I.uniScaleKey,M=R[F];return I.uniformScaling&&!M||!I.uniformScaling&&M}function S(R){return R.originX===c&&R.originY===c}function C(R,w,I){var F=R.lockScalingX,M=R.lockScalingY;return F&&M||(!w&&(F||M)&&I||F&&w==="x")?!0:!!(M&&w==="y")}function k(R,w,I){var F="not-allowed",M=g(R,I),H="";if(w.x!==0&&w.y===0?H="x":w.x===0&&w.y!==0&&(H="y"),C(I,H,M))return F;var X=p(I,w);return r[X]+"-resize"}function W(R,w,I){var F="not-allowed";if(w.x!==0&&I.lockSkewingY)return F;if(w.y!==0&&I.lockSkewingX)return F;var M=p(I,w)%4;return i[M]+"-resize"}function J(R,w,I){return R[I.canvas.altActionKey]?n.skewCursorStyleHandler(R,w,I):n.scaleCursorStyleHandler(R,w,I)}function $(R,w,I){var F=R[I.canvas.altActionKey];if(w.x===0)return F?"skewX":"scaleY";if(w.y===0)return F?"skewY":"scaleX"}function Q(R,w,I){return I.lockRotation?"not-allowed":w.cursorStyle}function q(R,w,I,F){return{e:R,transform:w,pointer:{x:I,y:F}}}function K(R){return function(w,I,F,M){var H=I.target,X=H.getCenterPoint(),te=H.translateToOriginPoint(X,I.originX,I.originY),re=R(w,I,F,M);return H.setPositionByOrigin(te,I.originX,I.originY),re}}function A(R,w,I,F,M){var H=R.target,X=H.controls[R.corner],te=H.canvas.getZoom(),re=H.padding/te,z=H.toLocalPoint(new t.Point(F,M),w,I);return z.x>=re&&(z.x-=re),z.x<=-re&&(z.x+=re),z.y>=re&&(z.y-=re),z.y<=re&&(z.y+=re),z.x-=X.offsetX,z.y-=X.offsetY,z}function N(R){return R.flipX&&!R.flipY||!R.flipX&&R.flipY}function j(R,w,I,F,M){if(R[w]!==0){var H=R._getTransformedDimensions()[F],X=M/H*R[I];R.set(I,X)}}function b(R,w,I,F){var M=w.target,H=M._getTransformedDimensions(0,M.skewY),X=A(w,w.originX,w.originY,I,F),te=Math.abs(X.x*2)-H.x,re=M.skewX,z;te<2?z=0:(z=u(Math.atan2(te/M.scaleX,H.y/M.scaleY)),w.originX===o&&w.originY===l&&(z=-z),w.originX===a&&w.originY===s&&(z=-z),N(M)&&(z=-z));var Y=re!==z;if(Y){var Z=M._getTransformedDimensions().y;M.set("skewX",z),j(M,"skewY","scaleY","y",Z),m("skewing",q(R,w,I,F))}return Y}function E(R,w,I,F){var M=w.target,H=M._getTransformedDimensions(M.skewX,0),X=A(w,w.originX,w.originY,I,F),te=Math.abs(X.y*2)-H.y,re=M.skewY,z;te<2?z=0:(z=u(Math.atan2(te/M.scaleY,H.x/M.scaleX)),w.originX===o&&w.originY===l&&(z=-z),w.originX===a&&w.originY===s&&(z=-z),N(M)&&(z=-z));var Y=re!==z;if(Y){var Z=M._getTransformedDimensions().x;M.set("skewY",z),j(M,"skewX","scaleX","x",Z),m("skewing",q(R,w,I,F))}return Y}function D(R,w,I,F){var M=w.target,H=M.skewX,X,te=w.originY;if(M.lockSkewingX)return!1;if(H===0){var re=A(w,c,c,I,F);re.x>0?X=o:X=a}else H>0&&(X=te===s?o:a),H<0&&(X=te===s?a:o),N(M)&&(X=X===o?a:o);w.originX=X;var z=K(b);return z(R,w,I,F)}function T(R,w,I,F){var M=w.target,H=M.skewY,X,te=w.originX;if(M.lockSkewingY)return!1;if(H===0){var re=A(w,c,c,I,F);re.y>0?X=s:X=l}else H>0&&(X=te===o?s:l),H<0&&(X=te===o?l:s),N(M)&&(X=X===s?l:s);w.originY=X;var z=K(E);return z(R,w,I,F)}function U(R,w,I,F){var M=w,H=M.target,X=H.translateToOriginPoint(H.getCenterPoint(),M.originX,M.originY);if(H.lockRotation)return!1;var te=Math.atan2(M.ey-X.y,M.ex-X.x),re=Math.atan2(F-X.y,I-X.x),z=u(re-te+M.theta),Y=!0;if(H.snapAngle>0){var Z=H.snapAngle,ie=H.snapThreshold||Z,oe=Math.ceil(z/Z)*Z,ue=Math.floor(z/Z)*Z;Math.abs(z-ue)<ie?z=ue:Math.abs(z-oe)<ie&&(z=oe)}return z<0&&(z=360+z),z%=360,Y=H.angle!==z,H.angle=z,Y&&m("rotating",q(R,w,I,F)),Y}function y(R,w,I,F,M){M=M||{};var H=w.target,X=H.lockScalingX,te=H.lockScalingY,re=M.by,z,Y,Z,ie,oe=g(R,H),ue=C(H,re,oe),de,ve,he=w.gestureScale;if(ue)return!1;if(he)Y=w.scaleX*he,Z=w.scaleY*he;else{if(z=A(w,w.originX,w.originY,I,F),de=re!=="y"?f(z.x):1,ve=re!=="x"?f(z.y):1,w.signX||(w.signX=de),w.signY||(w.signY=ve),H.lockScalingFlip&&(w.signX!==de||w.signY!==ve))return!1;if(ie=H._getTransformedDimensions(),oe&&!re){var Ct=Math.abs(z.x)+Math.abs(z.y),st=w.original,mi=Math.abs(ie.x*st.scaleX/H.scaleX)+Math.abs(ie.y*st.scaleY/H.scaleY),$t=Ct/mi,Dt;Y=st.scaleX*$t,Z=st.scaleY*$t}else Y=Math.abs(z.x*H.scaleX/ie.x),Z=Math.abs(z.y*H.scaleY/ie.y);S(w)&&(Y*=2,Z*=2),w.signX!==de&&re!=="y"&&(w.originX=h[w.originX],Y*=-1,w.signX=de),w.signY!==ve&&re!=="x"&&(w.originY=h[w.originY],Z*=-1,w.signY=ve)}var gi=H.scaleX,bi=H.scaleY;return re?(re==="x"&&H.set("scaleX",Y),re==="y"&&H.set("scaleY",Z)):(!X&&H.set("scaleX",Y),!te&&H.set("scaleY",Z)),Dt=gi!==H.scaleX||bi!==H.scaleY,Dt&&m("scaling",q(R,w,I,F)),Dt}function _(R,w,I,F){return y(R,w,I,F)}function x(R,w,I,F){return y(R,w,I,F,{by:"x"})}function O(R,w,I,F){return y(R,w,I,F,{by:"y"})}function B(R,w,I,F){return R[w.target.canvas.altActionKey]?n.skewHandlerX(R,w,I,F):n.scalingY(R,w,I,F)}function P(R,w,I,F){return R[w.target.canvas.altActionKey]?n.skewHandlerY(R,w,I,F):n.scalingX(R,w,I,F)}function G(R,w,I,F){var M=w.target,H=A(w,w.originX,w.originY,I,F),X=M.strokeWidth/(M.strokeUniform?M.scaleX:1),te=S(w)?2:1,re=M.width,z,Y=Math.abs(H.x*te/M.scaleX)-X;return M.set("width",Math.max(Y,0)),z=re!==Y,z&&m("resizing",q(R,w,I,F)),z}function V(R,w,I,F){var M=w.target,H=I-w.offsetX,X=F-w.offsetY,te=!M.get("lockMovementX")&&M.left!==H,re=!M.get("lockMovementY")&&M.top!==X;return te&&M.set("left",H),re&&M.set("top",X),(te||re)&&m("moving",q(R,w,I,F)),te||re}n.scaleCursorStyleHandler=k,n.skewCursorStyleHandler=W,n.scaleSkewCursorStyleHandler=J,n.rotationWithSnapping=K(U),n.scalingEqually=K(_),n.scalingX=K(x),n.scalingY=K(O),n.scalingYOrSkewingX=B,n.scalingXOrSkewingY=P,n.changeWidth=K(G),n.skewHandlerX=D,n.skewHandlerY=T,n.dragHandler=V,n.scaleOrSkewActionName=$,n.rotationStyleHandler=Q,n.fireEvent=m,n.wrapWithFixedAnchor=K,n.getLocalPoint=A,t.controlsUtils=n})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.degreesToRadians,i=t.controlsUtils;function n(s,a,l,c,h){c=c||{};var u=c.cornerSize||h.cornerSize,f=typeof c.transparentCorners!="undefined"?c.transparentCorners:this.transparentCorners,p=f?"stroke":"fill",m=!f&&(c.cornerStrokeColor||h.cornerStrokeColor);s.save(),s.fillStyle=c.cornerColor||h.cornerColor,s.strokeStyle=c.cornerStrokeColor||h.cornerStrokeColor,s.lineWidth=1,s.beginPath(),s.arc(a,l,u/2,0,2*Math.PI,!1),s[p](),m&&s.stroke(),s.restore()}function o(s,a,l,c,h){c=c||{};var u=c.cornerSize||h.cornerSize,f=typeof c.transparentCorners!="undefined"?c.transparentCorners:h.transparentCorners,p=f?"stroke":"fill",m=!f&&(c.cornerStrokeColor||h.cornerStrokeColor),g=u/2;s.save(),s.fillStyle=c.cornerColor||h.cornerColor,s.strokeStyle=c.strokeCornerColor||h.strokeCornerColor,s.lineWidth=1,s.translate(a,l),s.rotate(r(h.angle)),s[p+"Rect"](-g,-g,u,u),m&&s.strokeRect(-g,-g,u,u),s.restore()}i.renderCircleControl=n,i.renderSquareControl=o})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});function r(i){for(var n in i)this[n]=i[n]}t.Control=r,t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(i,n){return n.cursorStyle},getActionName:function(i,n){return n.actionName},getVisibility:function(i,n){var o=i._controlsVisibility;return o&&typeof o[n]!="undefined"?o[n]:this.visible},setVisibility:function(i){this.visible=i},positionHandler:function(i,n){var o=t.util.transformPoint({x:this.x*i.x+this.offsetX,y:this.y*i.y+this.offsetY},n);return o},render:function(i,n,o,s,a){s=s||{};switch(s.cornerStyle||a.cornerStyle){case"circle":t.controlsUtils.renderCircleControl.call(this,i,n,o,s,a);break;default:t.controlsUtils.renderSquareControl.call(this,i,n,o,s,a)}}}})((typeof L!="undefined",L));(function(){function e(o,s){var a=o.getAttribute("style"),l=o.getAttribute("offset")||0,c,h,u,f;if(l=parseFloat(l)/(/%$/.test(l)?100:1),l=l<0?0:l>1?1:l,a){var p=a.split(/\s*;\s*/);for(p[p.length-1]===""&&p.pop(),f=p.length;f--;){var m=p[f].split(/\s*:\s*/),g=m[0].trim(),S=m[1].trim();g==="stop-color"?c=S:g==="stop-opacity"&&(u=S)}}return c||(c=o.getAttribute("stop-color")||"rgb(0,0,0)"),u||(u=o.getAttribute("stop-opacity")),c=new d.Color(c),h=c.getAlpha(),u=isNaN(parseFloat(u))?1:parseFloat(u),u*=h*s,{offset:l,color:c.toRgb(),opacity:u}}function t(o){return{x1:o.getAttribute("x1")||0,y1:o.getAttribute("y1")||0,x2:o.getAttribute("x2")||"100%",y2:o.getAttribute("y2")||0}}function r(o){return{x1:o.getAttribute("fx")||o.getAttribute("cx")||"50%",y1:o.getAttribute("fy")||o.getAttribute("cy")||"50%",r1:0,x2:o.getAttribute("cx")||"50%",y2:o.getAttribute("cy")||"50%",r2:o.getAttribute("r")||"50%"}}var i=d.util.object.clone;d.Gradient=d.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(o){o||(o={}),o.coords||(o.coords={});var s,a=this;Object.keys(o).forEach(function(l){a[l]=o[l]}),this.id?this.id+="_"+d.Object.__uid++:this.id=d.Object.__uid++,s={x1:o.coords.x1||0,y1:o.coords.y1||0,x2:o.coords.x2||0,y2:o.coords.y2||0},this.type==="radial"&&(s.r1=o.coords.r1||0,s.r2=o.coords.r2||0),this.coords=s,this.colorStops=o.colorStops.slice()},addColorStop:function(o){for(var s in o){var a=new d.Color(o[s]);this.colorStops.push({offset:parseFloat(s),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(o){var s={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return d.util.populateWithProperties(this,s,o),s},toSVG:function(o,s){var a=i(this.coords,!0),l,c,s=s||{},h,u,f=i(this.colorStops,!0),p=a.r1>a.r2,m=this.gradientTransform?this.gradientTransform.concat():d.iMatrix.concat(),g=-this.offsetX,S=-this.offsetY,C=!!s.additionalTransform,k=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(f.sort(function(q,K){return q.offset-K.offset}),k==="objectBoundingBox"?(g/=o.width,S/=o.height):(g+=o.width/2,S+=o.height/2),o.type==="path"&&(g-=o.pathOffset.x,S-=o.pathOffset.y),m[4]-=g,m[5]-=S,u='id="SVGID_'+this.id+'" gradientUnits="'+k+'"',u+=' gradientTransform="'+(C?s.additionalTransform+" ":"")+d.util.matrixToSVG(m)+'" ',this.type==="linear"?h=["<linearGradient ",u,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",u,' cx="',p?a.x1:a.x2,'" cy="',p?a.y1:a.y2,'" r="',p?a.r1:a.r2,'" fx="',p?a.x2:a.x1,'" fy="',p?a.y2:a.y1,`">
`]),this.type==="radial"){if(p)for(f=f.concat(),f.reverse(),l=0,c=f.length;l<c;l++)f[l].offset=1-f[l].offset;var W=Math.min(a.r1,a.r2);if(W>0){var J=Math.max(a.r1,a.r2),$=W/J;for(l=0,c=f.length;l<c;l++)f[l].offset+=$*(1-f[l].offset)}}for(l=0,c=f.length;l<c;l++){var Q=f[l];h.push("<stop ",'offset="',Q.offset*100+"%",'" style="stop-color:',Q.color,typeof Q.opacity!="undefined"?";stop-opacity: "+Q.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(o){var s,a=d.util.object.clone(this.coords),l,c;if(!this.type)return;for(this.type==="linear"?s=o.createLinearGradient(a.x1,a.y1,a.x2,a.y2):this.type==="radial"&&(s=o.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),l=0,c=this.colorStops.length;l<c;l++){var h=this.colorStops[l].color,u=this.colorStops[l].opacity,f=this.colorStops[l].offset;typeof u!="undefined"&&(h=new d.Color(h).setAlpha(u).toRgba()),s.addColorStop(f,h)}return s}}),d.util.object.extend(d.Gradient,{fromElement:function(o,s,a,l){var c=parseFloat(a)/(/%$/.test(a)?100:1);c=c<0?0:c>1?1:c,isNaN(c)&&(c=1);var h=o.getElementsByTagName("stop"),u,f=o.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",p=o.getAttribute("gradientTransform")||"",m=[],g,S,C=0,k=0,W;for(o.nodeName==="linearGradient"||o.nodeName==="LINEARGRADIENT"?(u="linear",g=t(o)):(u="radial",g=r(o)),S=h.length;S--;)m.push(e(h[S],c));W=d.parseTransformAttribute(p),n(s,g,l,f),f==="pixels"&&(C=-s.left,k=-s.top);var J=new d.Gradient({id:o.getAttribute("id"),type:u,coords:g,colorStops:m,gradientUnits:f,gradientTransform:W,offsetX:C,offsetY:k});return J}});function n(o,s,a,l){var c,h;Object.keys(s).forEach(function(u){c=s[u],c==="Infinity"?h=1:c==="-Infinity"?h=0:(h=parseFloat(s[u],10),typeof c=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(c)&&(h*=.01,l==="pixels"&&((u==="x1"||u==="x2"||u==="r2")&&(h*=a.viewBoxWidth||a.width),(u==="y1"||u==="y2")&&(h*=a.viewBoxHeight||a.height)))),s[u]=h})}})();(function(){"use strict";var e=d.util.toFixed;d.Pattern=d.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,r){if(t||(t={}),this.id=d.Object.__uid++,this.setOptions(t),!t.source||t.source&&typeof t.source!="string"){r&&r(this);return}else{var i=this;this.source=d.util.createImage(),d.util.loadImage(t.source,function(n,o){i.source=n,r&&r(i,o)},null,this.crossOrigin)}},toObject:function(t){var r=d.Object.NUM_FRACTION_DIGITS,i,n;return typeof this.source.src=="string"?i=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(i=this.source.toDataURL()),n={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:e(this.offsetX,r),offsetY:e(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},d.util.populateWithProperties(this,n,t),n},toSVG:function(t){var r=typeof this.source=="function"?this.source():this.source,i=r.width/t.width,n=r.height/t.height,o=this.offsetX/t.width,s=this.offsetY/t.height,a="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(n=1,s&&(n+=Math.abs(s))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(i=1,o&&(i+=Math.abs(o))),r.src?a=r.src:r.toDataURL&&(a=r.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+o+'" y="'+s+'" width="'+i+'" height="'+n+`">
<image x="0" y="0" width="`+r.width+'" height="'+r.height+'" xlink:href="'+a+`"></image>
</pattern>
`},setOptions:function(t){for(var r in t)this[r]=t[r]},toLive:function(t){var r=this.source;if(!r)return"";if(typeof r.src!="undefined"){if(!r.complete)return"";if(r.naturalWidth===0||r.naturalHeight===0)return""}return t.createPattern(r,this.repeat)}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.toFixed;if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(i){typeof i=="string"&&(i=this._parseShadow(i));for(var n in i)this[n]=i[n];this.id=t.Object.__uid++},_parseShadow:function(i){var n=i.trim(),o=t.Shadow.reOffsetsAndBlur.exec(n)||[],s=n.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:s.trim(),offsetX:parseInt(o[1],10)||0,offsetY:parseInt(o[2],10)||0,blur:parseInt(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(i){var n=40,o=40,s=t.Object.NUM_FRACTION_DIGITS,a=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-i.angle)),l=20,c=new t.Color(this.color);return i.width&&i.height&&(n=r((Math.abs(a.x)+this.blur)/i.width,s)*100+l,o=r((Math.abs(a.y)+this.blur)/i.height,s)*100+l),i.flipX&&(a.x*=-1),i.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+o+'%" height="'+(100+2*o)+'%" x="-'+n+'%" width="'+(100+2*n)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+r(this.blur?this.blur/2:0,s)+`"></feGaussianBlur>
	<feOffset dx="`+r(a.x,s)+'" dy="'+r(a.y,s)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+c.toRgb()+'" flood-opacity="'+c.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var i={},n=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(o){this[o]!==n[o]&&(i[o]=this[o])},this),i}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})((typeof L!="undefined",L));(function(){"use strict";if(d.StaticCanvas){d.warn("fabric.StaticCanvas is already defined.");return}var e=d.util.object.extend,t=d.util.getElementOffset,r=d.util.removeFromArray,i=d.util.toFixed,n=d.util.transformPoint,o=d.util.invertTransform,s=d.util.getNodeCanvas,a=d.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");d.StaticCanvas=d.util.createClass(d.CommonMethods,{initialize:function(c,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(c,h)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:d.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(c,h){var u=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(c),this._initOptions(h),this.interactive||this._initRetinaScaling(),h.overlayImage&&this.setOverlayImage(h.overlayImage,u),h.backgroundImage&&this.setBackgroundImage(h.backgroundImage,u),h.backgroundColor&&this.setBackgroundColor(h.backgroundColor,u),h.overlayColor&&this.setOverlayColor(h.overlayColor,u),this.calcOffset()},_isRetinaScaling:function(){return d.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?d.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling())return;var c=d.devicePixelRatio;this.__initRetinaScaling(c,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(c,this.upperCanvasEl,this.contextTop)},__initRetinaScaling:function(c,h,u){h.setAttribute("width",this.width*c),h.setAttribute("height",this.height*c),u.scale(c,c)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(c,h,u){return this.__setBgOverlayImage("overlayImage",c,h,u)},setBackgroundImage:function(c,h,u){return this.__setBgOverlayImage("backgroundImage",c,h,u)},setOverlayColor:function(c,h){return this.__setBgOverlayColor("overlayColor",c,h)},setBackgroundColor:function(c,h){return this.__setBgOverlayColor("backgroundColor",c,h)},__setBgOverlayImage:function(c,h,u,f){return typeof h=="string"?d.util.loadImage(h,function(p,m){if(p){var g=new d.Image(p,f);this[c]=g,g.canvas=this}u&&u(p,m)},this,f&&f.crossOrigin):(f&&h.setOptions(f),this[c]=h,h&&(h.canvas=this),u&&u(h,!1)),this},__setBgOverlayColor:function(c,h,u){return this[c]=h,this._initGradient(h,c),this._initPattern(h,c,u),this},_createCanvasElement:function(){var c=a();if(!c)throw l;if(c.style||(c.style={}),typeof c.getContext=="undefined")throw l;return c},_initOptions:function(c){var h=this.lowerCanvasEl;if(this._setOptions(c),this.width=this.width||parseInt(h.width,10)||0,this.height=this.height||parseInt(h.height,10)||0,!this.lowerCanvasEl.style)return;h.width=this.width,h.height=this.height,h.style.width=this.width+"px",h.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(c){c&&c.getContext?this.lowerCanvasEl=c:this.lowerCanvasEl=d.util.getById(c)||this._createCanvasElement(),d.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(c,h){return this.setDimensions({width:c},h)},setHeight:function(c,h){return this.setDimensions({height:c},h)},setDimensions:function(c,h){var u;h=h||{};for(var f in c)u=c[f],h.cssOnly||(this._setBackstoreDimension(f,c[f]),u+="px",this.hasLostContext=!0),h.backstoreOnly||this._setCssDimension(f,u);return this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles()),this._initRetinaScaling(),this.calcOffset(),h.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(c,h){return this.lowerCanvasEl[c]=h,this.upperCanvasEl&&(this.upperCanvasEl[c]=h),this.cacheCanvasEl&&(this.cacheCanvasEl[c]=h),this[c]=h,this},_setCssDimension:function(c,h){return this.lowerCanvasEl.style[c]=h,this.upperCanvasEl&&(this.upperCanvasEl.style[c]=h),this.wrapperEl&&(this.wrapperEl.style[c]=h),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(c){var h=this._activeObject,u,f,p;for(this.viewportTransform=c,f=0,p=this._objects.length;f<p;f++)u=this._objects[f],u.group||u.setCoords(!0);return h&&h.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(c,h){var u=c,f=this.viewportTransform.slice(0);c=n(c,o(this.viewportTransform)),f[0]=h,f[3]=h;var p=n(c,f);return f[4]+=u.x-p.x,f[5]+=u.y-p.y,this.setViewportTransform(f)},setZoom:function(c){return this.zoomToPoint(new d.Point(0,0),c),this},absolutePan:function(c){var h=this.viewportTransform.slice(0);return h[4]=-c.x,h[5]=-c.y,this.setViewportTransform(h)},relativePan:function(c){return this.absolutePan(new d.Point(-c.x-this.viewportTransform[4],-c.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(c){this.stateful&&c.setupState(),c._set("canvas",this),c.setCoords(),this.fire("object:added",{target:c}),c.fire("added")},_onObjectRemoved:function(c){this.fire("object:removed",{target:c}),c.fire("removed"),delete c.canvas},clearContext:function(c){return c.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var c=this.contextContainer;return this.renderCanvas(c,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=d.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var c={},h=this.width,u=this.height,f=o(this.viewportTransform);return c.tl=n({x:0,y:0},f),c.br=n({x:h,y:u},f),c.tr=new d.Point(c.br.x,c.tl.y),c.bl=new d.Point(c.tl.x,c.br.y),this.vptCoords=c,c},cancelRequestedRender:function(){this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(c,h){var u=this.viewportTransform,f=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(c),d.util.setImageSmoothing(c,this.imageSmoothingEnabled),this.fire("before:render",{ctx:c}),this._renderBackground(c),c.save(),c.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._renderObjects(c,h),c.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),f&&(f.canvas=this,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(c)),this._renderOverlay(c),this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),this.fire("after:render",{ctx:c})},drawClipPathOnCanvas:function(c){var h=this.viewportTransform,u=this.clipPath;c.save(),c.transform(h[0],h[1],h[2],h[3],h[4],h[5]),c.globalCompositeOperation="destination-in",u.transform(c),c.scale(1/u.zoomX,1/u.zoomY),c.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),c.restore()},_renderObjects:function(c,h){var u,f;for(u=0,f=h.length;u<f;++u)h[u]&&h[u].render(c)},_renderBackgroundOrOverlay:function(c,h){var u=this[h+"Color"],f=this[h+"Image"],p=this.viewportTransform,m=this[h+"Vpt"];if(!u&&!f)return;if(u){c.save(),c.beginPath(),c.moveTo(0,0),c.lineTo(this.width,0),c.lineTo(this.width,this.height),c.lineTo(0,this.height),c.closePath(),c.fillStyle=u.toLive?u.toLive(c,this):u,m&&c.transform(p[0],p[1],p[2],p[3],p[4],p[5]),c.transform(1,0,0,1,u.offsetX||0,u.offsetY||0);var g=u.gradientTransform||u.patternTransform;g&&c.transform(g[0],g[1],g[2],g[3],g[4],g[5]),c.fill(),c.restore()}f&&(c.save(),m&&c.transform(p[0],p[1],p[2],p[3],p[4],p[5]),f.render(c),c.restore())},_renderBackground:function(c){this._renderBackgroundOrOverlay(c,"background")},_renderOverlay:function(c){this._renderBackgroundOrOverlay(c,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(c){return this._centerObject(c,new d.Point(this.getCenter().left,c.getCenterPoint().y))},centerObjectV:function(c){return this._centerObject(c,new d.Point(c.getCenterPoint().x,this.getCenter().top))},centerObject:function(c){var h=this.getCenter();return this._centerObject(c,new d.Point(h.left,h.top))},viewportCenterObject:function(c){var h=this.getVpCenter();return this._centerObject(c,h)},viewportCenterObjectH:function(c){var h=this.getVpCenter();return this._centerObject(c,new d.Point(h.x,c.getCenterPoint().y)),this},viewportCenterObjectV:function(c){var h=this.getVpCenter();return this._centerObject(c,new d.Point(c.getCenterPoint().x,h.y))},getVpCenter:function(){var c=this.getCenter(),h=o(this.viewportTransform);return n({x:c.left,y:c.top},h)},_centerObject:function(c,h){return c.setPositionByOrigin(h,"center","center"),c.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(c){return this.toDatalessObject(c)},toObject:function(c){return this._toObjectMethod("toObject",c)},toDatalessObject:function(c){return this._toObjectMethod("toDatalessObject",c)},_toObjectMethod:function(c,h){var u=this.clipPath,f={version:d.version,objects:this._toObjects(c,h)};return u&&(f.clipPath=this._toObject(this.clipPath,c,h)),e(f,this.__serializeBgOverlay(c,h)),d.util.populateWithProperties(this,f,h),f},_toObjects:function(c,h){return this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){return this._toObject(u,c,h)},this)},_toObject:function(c,h,u){var f;this.includeDefaultValues||(f=c.includeDefaultValues,c.includeDefaultValues=!1);var p=c[h](u);return this.includeDefaultValues||(c.includeDefaultValues=f),p},__serializeBgOverlay:function(c,h){var u={},f=this.backgroundImage,p=this.overlayImage;return this.backgroundColor&&(u.background=this.backgroundColor.toObject?this.backgroundColor.toObject(h):this.backgroundColor),this.overlayColor&&(u.overlay=this.overlayColor.toObject?this.overlayColor.toObject(h):this.overlayColor),f&&!f.excludeFromExport&&(u.backgroundImage=this._toObject(f,c,h)),p&&!p.excludeFromExport&&(u.overlayImage=this._toObject(p,c,h)),u},svgViewportTransformation:!0,toSVG:function(c,h){c||(c={}),c.reviver=h;var u=[];return this._setSVGPreamble(u,c),this._setSVGHeader(u,c),this.clipPath&&u.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(u,"background"),this._setSVGBgOverlayImage(u,"backgroundImage",h),this._setSVGObjects(u,h),this.clipPath&&u.push(`</g>
`),this._setSVGBgOverlayColor(u,"overlay"),this._setSVGBgOverlayImage(u,"overlayImage",h),u.push("</svg>"),u.join("")},_setSVGPreamble:function(c,h){if(h.suppressPreamble)return;c.push('<?xml version="1.0" encoding="',h.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(c,h){var u=h.width||this.width,f=h.height||this.height,p,m='viewBox="0 0 '+this.width+" "+this.height+'" ',g=d.Object.NUM_FRACTION_DIGITS;h.viewBox?m='viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" ':this.svgViewportTransformation&&(p=this.viewportTransform,m='viewBox="'+i(-p[4]/p[0],g)+" "+i(-p[5]/p[3],g)+" "+i(this.width/p[0],g)+" "+i(this.height/p[3],g)+'" '),c.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',u,'" ','height="',f,'" ',m,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",d.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(h),`</defs>
`)},createSVGClipPathMarkup:function(c){var h=this.clipPath;return h?(h.clipPathId="CLIPPATH_"+d.Object.__uid++,'<clipPath id="'+h.clipPathId+`" >
`+this.clipPath.toClipPathSVG(c.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var c=this,h=["background","overlay"].map(function(u){var f=c[u+"Color"];if(f&&f.toLive){var p=c[u+"Vpt"],m=c.viewportTransform,g={width:c.width/(p?m[0]:1),height:c.height/(p?m[3]:1)};return f.toSVG(g,{additionalTransform:p?d.util.matrixToSVG(m):""})}});return h.join("")},createSVGFontFacesMarkup:function(){var c="",h={},u,f,p,m,g,S,C,k,W,J=d.fontPaths,$=[];for(this._objects.forEach(function q(K){$.push(K),K._objects&&K._objects.forEach(q)}),k=0,W=$.length;k<W;k++){if(u=$[k],f=u.fontFamily,u.type.indexOf("text")===-1||h[f]||!J[f])continue;if(h[f]=!0,!u.styles)continue;p=u.styles;for(g in p){m=p[g];for(C in m)S=m[C],f=S.fontFamily,!h[f]&&J[f]&&(h[f]=!0)}}for(var Q in h)c+=[`		@font-face {
`,"			font-family: '",Q,`';
`,"			src: url('",J[Q],`');
`,`		}
`].join("");return c&&(c=['	<style type="text/css">',`<![CDATA[
`,c,"]]>",`</style>
`].join("")),c},_setSVGObjects:function(c,h){var u,f,p,m=this._objects;for(f=0,p=m.length;f<p;f++){if(u=m[f],u.excludeFromExport)continue;this._setSVGObject(c,u,h)}},_setSVGObject:function(c,h,u){c.push(h.toSVG(u))},_setSVGBgOverlayImage:function(c,h,u){this[h]&&!this[h].excludeFromExport&&this[h].toSVG&&c.push(this[h].toSVG(u))},_setSVGBgOverlayColor:function(c,h){var u=this[h+"Color"],f=this.viewportTransform,p=this.width,m=this.height;if(!u)return;if(u.toLive){var g=u.repeat,S=d.util.invertTransform(f),C=this[h+"Vpt"],k=C?d.util.matrixToSVG(S):"";c.push('<rect transform="'+k+" translate(",p/2,",",m/2,')"',' x="',u.offsetX-p/2,'" y="',u.offsetY-m/2,'" ','width="',g==="repeat-y"||g==="no-repeat"?u.source.width:p,'" height="',g==="repeat-x"||g==="no-repeat"?u.source.height:m,'" fill="url(#SVGID_'+u.id+')"',`></rect>
`)}else c.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',u,'"',`></rect>
`)},sendToBack:function(c){if(!c)return this;var h=this._activeObject,u,f,p;if(c===h&&c.type==="activeSelection")for(p=h._objects,u=p.length;u--;)f=p[u],r(this._objects,f),this._objects.unshift(f);else r(this._objects,c),this._objects.unshift(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(c){if(!c)return this;var h=this._activeObject,u,f,p;if(c===h&&c.type==="activeSelection")for(p=h._objects,u=0;u<p.length;u++)f=p[u],r(this._objects,f),this._objects.push(f);else r(this._objects,c),this._objects.push(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(c,h){if(!c)return this;var u=this._activeObject,f,p,m,g,S,C=0;if(c===u&&c.type==="activeSelection")for(S=u._objects,f=0;f<S.length;f++)p=S[f],m=this._objects.indexOf(p),m>0+C&&(g=m-1,r(this._objects,p),this._objects.splice(g,0,p)),C++;else m=this._objects.indexOf(c),m!==0&&(g=this._findNewLowerIndex(c,m,h),r(this._objects,c),this._objects.splice(g,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(c,h,u){var f,p;if(u)for(f=h,p=h-1;p>=0;--p){var m=c.intersectsWithObject(this._objects[p])||c.isContainedWithinObject(this._objects[p])||this._objects[p].isContainedWithinObject(c);if(m){f=p;break}}else f=h-1;return f},bringForward:function(c,h){if(!c)return this;var u=this._activeObject,f,p,m,g,S,C=0;if(c===u&&c.type==="activeSelection")for(S=u._objects,f=S.length;f--;)p=S[f],m=this._objects.indexOf(p),m<this._objects.length-1-C&&(g=m+1,r(this._objects,p),this._objects.splice(g,0,p)),C++;else m=this._objects.indexOf(c),m!==this._objects.length-1&&(g=this._findNewUpperIndex(c,m,h),r(this._objects,c),this._objects.splice(g,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(c,h,u){var f,p,m;if(u)for(f=h,p=h+1,m=this._objects.length;p<m;++p){var g=c.intersectsWithObject(this._objects[p])||c.isContainedWithinObject(this._objects[p])||this._objects[p].isContainedWithinObject(c);if(g){f=p;break}}else f=h+1;return f},moveTo:function(c,h){return r(this._objects,c),this._objects.splice(h,0,c),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(c){c.dispose&&c.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,d.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(d.StaticCanvas.prototype,d.Observable),e(d.StaticCanvas.prototype,d.Collection),e(d.StaticCanvas.prototype,d.DataURLExporter),e(d.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(c){var h=a();if(!h||!h.getContext)return null;var u=h.getContext("2d");if(!u)return null;switch(c){case"setLineDash":return typeof u.setLineDash!="undefined";default:return null}}}),d.StaticCanvas.prototype.toJSON=d.StaticCanvas.prototype.toObject,d.isLikelyNode&&(d.StaticCanvas.prototype.createPNGStream=function(){var c=s(this.lowerCanvasEl);return c&&c.createPNGStream()},d.StaticCanvas.prototype.createJPEGStream=function(c){var h=s(this.lowerCanvasEl);return h&&h.createJPEGStream(c)})})();d.BaseBrush=d.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,d.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(!this.shadow)return;var e=this.canvas,t=this.shadow,r=e.contextTop,i=e.getZoom();e&&e._isRetinaScaling()&&(i*=d.devicePixelRatio),r.shadowColor=t.color,r.shadowBlur=t.blur*i,r.shadowOffsetX=t.offsetX*i,r.shadowOffsetY=t.offsetY*i},needsFullRender:function(){var e=new d.Color(this.color);return e.getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});(function(){d.PencilBrush=d.util.createClass(d.BaseBrush,{decimate:.4,initialize:function(e){this.canvas=e,this._points=[]},_drawSegment:function(e,t,r){var i=t.midPointFrom(r);return e.quadraticCurveTo(t.x,t.y,i.x,i.y),i},onMouseDown:function(e,t){if(!this.canvas._isMainEvent(t.e))return;this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e,t){if(!this.canvas._isMainEvent(t.e))return;if(this._captureDrawingPath(e)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var r=this._points,i=r.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,r[i-2],r[i-1],!0),n.stroke(),n.restore()}},onMouseUp:function(e){return this.canvas._isMainEvent(e.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(e){var t=new d.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return this._points.length>1&&e.eq(this._points[this._points.length-1])?!1:(this._points.push(e),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new d.Point(e.x,e.y);return this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t,r,i=this._points[0],n=this._points[1];if(this._saveAndTransform(e),e.beginPath(),this._points.length===2&&i.x===n.x&&i.y===n.y){var o=this.width/1e3;i=new d.Point(i.x,i.y),n=new d.Point(n.x,n.y),i.x-=o,n.x+=o}for(e.moveTo(i.x,i.y),t=1,r=this._points.length;t<r;t++)this._drawSegment(e,i,n),i=this._points[t],n=this._points[t+1];e.lineTo(i.x,i.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=[],r,i=this.width/1e3,n=new d.Point(e[0].x,e[0].y),o=new d.Point(e[1].x,e[1].y),s=e.length,a=1,l=0,c=s>2;for(c&&(a=e[2].x<o.x?-1:e[2].x===o.x?0:1,l=e[2].y<o.y?-1:e[2].y===o.y?0:1),t.push("M ",n.x-a*i," ",n.y-l*i," "),r=1;r<s;r++){if(!n.eq(o)){var h=n.midPointFrom(o);t.push("Q ",n.x," ",n.y," ",h.x," ",h.y," ")}n=e[r],r+1<e.length&&(o=e[r+1])}return c&&(a=n.x>e[r-2].x?1:n.x===e[r-2].x?0:-1,l=n.y>e[r-2].y?1:n.y===e[r-2].y?0:-1),t.push("L ",n.x+a*i," ",n.y+l*i),t},createPath:function(e){var t=new d.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new d.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var r=this.canvas.getZoom(),i=Math.pow(t/r,2),n,o=e.length-1,s=e[0],a=[s],l;for(n=1;n<o;n++)l=Math.pow(s.x-e[n].x,2)+Math.pow(s.y-e[n].y,2),l>=i&&(s=e[n],a.push(s));return a.length===1&&a.push(new d.Point(a[0].x,a[0].y)),a},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var r=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}})})();d.CircleBrush=d.util.createClass(d.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),r=this.canvas.contextTop;this._saveAndTransform(r),this.dot(r,t),r.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e=this.canvas.contextTop,t,r,i=this.points;for(this._saveAndTransform(e),t=0,r=i.length;t<r;t++)this.dot(e,i[t]);e.restore()},onMouseMove:function(e){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,t,r;this.canvas.renderOnAddRemove=!1;var i=[];for(t=0,r=this.points.length;t<r;t++){var n=this.points[t],o=new d.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(o.shadow=new d.Shadow(this.shadow)),i.push(o)}var s=new d.Group(i);s.canvas=this.canvas,this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},addPoint:function(e){var t=new d.Point(e.x,e.y),r=d.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,i=new d.Color(this.color).setAlpha(d.util.getRandomInt(0,100)/100).toRgba();return t.radius=r,t.fill=i,this.points.push(t),t}});d.SprayBrush=d.util.createClass(d.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],r=0,i=this.sprayChunks.length;r<i;r++)for(var n=this.sprayChunks[r],o=0,s=n.length;o<s;o++){var a=new d.Rect({width:n[o].width,height:n[o].width,left:n[o].x+1,top:n[o].y+1,originX:"center",originY:"center",fill:this.color});t.push(a)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var l=new d.Group(t);this.shadow&&l.set("shadow",new d.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t={},r,i,n;for(i=0,n=e.length;i<n;i++)r=e[i].left+""+e[i].top,t[r]||(t[r]=e[i]);var o=[];for(r in t)o.push(t[r]);return o},render:function(e){var t=this.canvas.contextTop,r,i;for(t.fillStyle=this.color,this._saveAndTransform(t),r=0,i=e.length;r<i;r++){var n=e[r];typeof n.opacity!="undefined"&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},_render:function(){var e=this.canvas.contextTop,t,r;for(e.fillStyle=this.color,this._saveAndTransform(e),t=0,r=this.sprayChunks.length;t<r;t++)this.render(this.sprayChunks[t]);e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,r,i,n=this.width/2,o;for(o=0;o<this.density;o++){t=d.util.getRandomInt(e.x-n,e.x+n),r=d.util.getRandomInt(e.y-n,e.y+n),this.dotWidthVariance?i=d.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):i=this.dotWidth;var s=new d.Point(t,r);s.width=i,this.randomOpacity&&(s.opacity=d.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}});d.PatternBrush=d.util.createClass(d.PencilBrush,{getPatternSrc:function(){var e=20,t=5,r=d.util.createCanvasElement(),i=r.getContext("2d");return r.width=r.height=e+t,i.fillStyle=this.color,i.beginPath(),i.arc(e/2,e/2,e/2,0,Math.PI*2,!1),i.closePath(),i.fill(),r},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),r=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new d.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-r.x,offsetY:-r.y}),t}});(function(){var e=d.util.getPointer,t=d.util.degreesToRadians,r=Math.abs,i=d.StaticCanvas.supports("setLineDash"),n=d.util.isTouchEvent,o=.5;d.Canvas=d.util.createClass(d.StaticCanvas,{initialize:function(a,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=d.PencilBrush&&new d.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a=this.getActiveObjects(),l,c,h;if(a.length>0&&!this.preserveObjectStacking){c=[],h=[];for(var u=0,f=this._objects.length;u<f;u++)l=this._objects[u],a.indexOf(l)===-1?c.push(l):h.push(l);a.length>1&&(this._activeObject._objects=h),c.push.apply(c,h)}else c=this._objects;return c},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTopLayer:function(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.renderTopLayer(a),this.fire("after:render"),this},_normalizePointer:function(a,l){var c=a.calcTransformMatrix(),h=d.util.invertTransform(c),u=this.restorePointerVpt(l);return d.util.transformPoint(u,h)},isTargetTransparent:function(a,l,c){if(a.shouldCache()&&a._cacheCanvas&&a!==this._activeObject){var h=this._normalizePointer(a,{x:l,y:c}),u=Math.max(a.cacheTranslationX+h.x*a.zoomX,0),f=Math.max(a.cacheTranslationY+h.y*a.zoomY,0),S=d.util.isTransparent(a._cacheContext,Math.round(u),Math.round(f),this.targetFindTolerance);return S}var p=this.contextCache,m=a.selectionBackgroundColor,g=this.viewportTransform;a.selectionBackgroundColor="",this.clearContext(p),p.save(),p.transform(g[0],g[1],g[2],g[3],g[4],g[5]),a.render(p),p.restore(),a===this._activeObject&&a._renderControls(p,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),a.selectionBackgroundColor=m;var S=d.util.isTransparent(p,l,c,this.targetFindTolerance);return S},_isSelectionKeyPressed:function(a){var l=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?l=!!this.selectionKey.find(function(c){return a[c]===!0}):l=a[this.selectionKey],l},_shouldClearSelection:function(a,l){var c=this.getActiveObjects(),h=this._activeObject;return!l||l&&h&&c.length>1&&c.indexOf(l)===-1&&h!==l&&!this._isSelectionKeyPressed(a)||l&&!l.evented||l&&!l.selectable&&h&&h!==l},_shouldCenterTransform:function(a,l,c){if(!a)return;var h;return l==="scale"||l==="scaleX"||l==="scaleY"||l==="resizing"?h=this.centeredScaling||a.centeredScaling:l==="rotate"&&(h=this.centeredRotation||a.centeredRotation),h?!c:c},_getOriginFromCorner:function(a,l){var c={x:a.originX,y:a.originY};return l==="ml"||l==="tl"||l==="bl"?c.x="right":(l==="mr"||l==="tr"||l==="br")&&(c.x="left"),l==="tl"||l==="mt"||l==="tr"?c.y="bottom":l==="bl"||l==="mb"||l==="br"?c.y="top":l==="mtr"&&(c.x="center",c.y="center"),c},_getActionFromCorner:function(a,l,c,h){if(!l||!a)return"drag";var u=h.controls[l];return u.getActionName(c,u,h)},_setupCurrentTransform:function(a,l,c){if(!l)return;var h=this.getPointer(a),u=l.__corner,f=c&&u?l.controls[u].getActionHandler():d.controlsUtils.dragHandler,p=this._getActionFromCorner(c,u,a,l),m=this._getOriginFromCorner(l,u),g=a[this.centeredKey],S={target:l,action:p,actionHandler:f,corner:u,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:h.x-l.left,offsetY:h.y-l.top,originX:m.x,originY:m.y,ex:h.x,ey:h.y,lastX:h.x,lastY:h.y,theta:t(l.angle),width:l.width*l.scaleX,shiftKey:a.shiftKey,altKey:g,original:d.util.saveObjectTransform(l)};this._shouldCenterTransform(l,p,g)&&(S.originX="center",S.originY="center"),S.original.originX=m.x,S.original.originY=m.y,this._currentTransform=S,this._beforeTransform(a)},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(a){var l=this._groupSelector,c=l.left,h=l.top,u=r(c),f=r(h);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(l.ex-(c>0?0:-c),l.ey-(h>0?0:-h),u,f)),!this.selectionLineWidth||!this.selectionBorderColor)return;if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!i){var p=l.ex+o-(c>0?0:u),m=l.ey+o-(h>0?0:f);a.beginPath(),d.util.drawDashedLine(a,p,m,p+u,m,this.selectionDashArray),d.util.drawDashedLine(a,p,m+f-1,p+u,m+f-1,this.selectionDashArray),d.util.drawDashedLine(a,p,m,p,m+f,this.selectionDashArray),d.util.drawDashedLine(a,p+u-1,m,p+u-1,m+f,this.selectionDashArray),a.closePath(),a.stroke()}else d.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(l.ex+o-(c>0?0:u),l.ey+o-(h>0?0:f),u,f)},findTarget:function(a,l){if(this.skipTargetFind)return;var c=!0,h=this.getPointer(a,c),u=this._activeObject,f=this.getActiveObjects(),p,m,g=n(a);if(this.targets=[],f.length>1&&!l&&u===this._searchPossibleTargets([u],h))return u;if(f.length===1&&u._findTargetCorner(h,g))return u;if(f.length===1&&u===this._searchPossibleTargets([u],h))if(this.preserveObjectStacking)p=u,m=this.targets,this.targets=[];else return u;var S=this._searchPossibleTargets(this._objects,h);return a[this.altSelectionKey]&&S&&p&&S!==p&&(S=p,this.targets=m),S},_checkTarget:function(a,l,c){if(l&&l.visible&&l.evented&&(l.containsPoint(a)||!!l._findTargetCorner(a)))if((this.perPixelTargetFind||l.perPixelTargetFind)&&!l.isEditing){var h=this.isTargetTransparent(l,c.x,c.y);if(!h)return!0}else return!0},_searchPossibleTargets:function(a,l){for(var c,h=a.length,u;h--;){var f=a[h],p=f.group?this._normalizePointer(f.group,l):l;if(this._checkTarget(p,f,l)){c=a[h],c.subTargetCheck&&c instanceof d.Group&&(u=this._searchPossibleTargets(c._objects,l),u&&this.targets.push(u));break}}return c},restorePointerVpt:function(a){return d.util.transformPoint(a,d.util.invertTransform(this.viewportTransform))},getPointer:function(a,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var c=e(a),h=this.upperCanvasEl,u=h.getBoundingClientRect(),f=u.width||0,p=u.height||0,m;(!f||!p)&&("top"in u&&"bottom"in u&&(p=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(f=Math.abs(u.right-u.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,l||(c=this.restorePointerVpt(c));var g=this.getRetinaScaling();return g!==1&&(c.x/=g,c.y/=g),f===0||p===0?m={width:1,height:1}:m={width:h.width/f,height:h.height/p},{x:c.x*m.width,y:c.y*m.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),d.util.addClass(c,"upper-canvas "+a),this.wrapperEl.appendChild(c),this._copyCanvasStyle(l,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=d.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),d.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),d.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var l=this.width||a.width,c=this.height||a.height;d.util.setStyle(a,{position:"absolute",width:l+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),a.width=l,a.height=c,d.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,l){l.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?a.type==="activeSelection"&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),a===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,l){var c=!1,h=this.getActiveObjects(),u=[],f=[],p={e:l};a.forEach(function(m){h.indexOf(m)===-1&&(c=!0,m.fire("deselected",p),f.push(m))}),h.forEach(function(m){a.indexOf(m)===-1&&(c=!0,m.fire("selected",p),u.push(m))}),a.length>0&&h.length>0?(p.selected=u,p.deselected=f,p.updated=u[0]||f[0],p.target=this._activeObject,c&&this.fire("selection:updated",p)):h.length>0?(p.selected=u,p.target=this._activeObject,this.fire("selection:created",p)):a.length>0&&(p.deselected=f,this.fire("selection:cleared",p))},setActiveObject:function(a,l){var c=this.getActiveObjects();return this._setActiveObject(a,l),this._fireSelectionEvents(c,l),this},_setActiveObject:function(a,l){return this._activeObject===a?!1:this._discardActiveObject(l,a)?a.onSelect({e:l})?!1:(this._activeObject=a,!0):!1},_discardActiveObject:function(a,l){var c=this._activeObject;if(c){if(c.onDeselect({e:a,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var l=this.getActiveObjects(),c=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:c,e:a}),this._discardActiveObject(a),this._fireSelectionEvents(l,a),this},dispose:function(){var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(l){d.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this)),a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,d.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var l=this._activeObject;l&&l._renderControls(a)},_toObject:function(a,l,c){var h=this._realizeGroupTransformOnObject(a),u=this.callSuper("_toObject",a,l,c);return this._unwindGroupTransformOnObject(a,h),u},_realizeGroupTransformOnObject:function(a){if(a.group&&a.group.type==="activeSelection"&&this._activeObject===a.group){var l=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return l.forEach(function(h){c[h]=a[h]}),this._activeObject.realizeTransform(a),c}else return null},_unwindGroupTransformOnObject:function(a,l){l&&a.set(l)},_setSVGObject:function(a,l,c){var h=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",a,l,c),this._unwindGroupTransformOnObject(l,h)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),d.StaticCanvas.prototype.setViewportTransform.call(this,a)}});for(var s in d.StaticCanvas)s!=="prototype"&&(d.Canvas[s]=d.StaticCanvas[s])})();(function(){var e=d.util.addListener,t=d.util.removeListener,r=3,i=2,n=1,o={passive:!1};function s(a,l){return a.button&&a.button===l-1}d.util.object.extend(d.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,l){var c=this.upperCanvasEl,h=this._getEventPrefix();a(d.window,"resize",this._onResize),a(c,h+"down",this._onMouseDown),a(c,h+"move",this._onMouseMove,o),a(c,h+"out",this._onMouseOut),a(c,h+"enter",this._onMouseEnter),a(c,"wheel",this._onMouseWheel),a(c,"contextmenu",this._onContextMenu),a(c,"dblclick",this._onDoubleClick),a(c,"dragover",this._onDragOver),a(c,"dragenter",this._onDragEnter),a(c,"dragleave",this._onDragLeave),a(c,"drop",this._onDrop),this.enablePointerEvents||a(c,"touchstart",this._onTouchStart,o),typeof eventjs!="undefined"&&l in eventjs&&(eventjs[l](c,"gesture",this._onGesture),eventjs[l](c,"drag",this._onDrag),eventjs[l](c,"orientation",this._onOrientationChange),eventjs[l](c,"shake",this._onShake),eventjs[l](c,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var a=this._getEventPrefix();t(d.document,a+"up",this._onMouseUp),t(d.document,"touchend",this._onTouchEnd,o),t(d.document,a+"move",this._onMouseMove,o),t(d.document,"touchmove",this._onMouseMove,o)},_bindEvents:function(){if(this.eventsBound)return;this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0},_onGesture:function(a,l){this.__onTransformGesture&&this.__onTransformGesture(a,l)},_onDrag:function(a,l){this.__onDrag&&this.__onDrag(a,l)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var l=this._hoveredTarget;this.fire("mouse:out",{target:l,e:a}),this._hoveredTarget=null,l&&l.fire("mouseout",{e:a});var c=this;this._hoveredTargets.forEach(function(h){c.fire("mouse:out",{target:l,e:a}),h&&l.fire("mouseout",{e:a})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(h){h.isEditing&&h.hiddenTextarea.focus()})},_onMouseEnter:function(a){!this._currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,l){this.__onOrientationChange&&this.__onOrientationChange(a,l)},_onShake:function(a,l){this.__onShake&&this.__onShake(a,l)},_onLongPress:function(a,l){this.__onLongPress&&this.__onLongPress(a,l)},_onDragOver:function(a){a.preventDefault();var l=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(l,a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var l=a.changedTouches;return l?l[0]&&l[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var l=this.upperCanvasEl,c=this._getEventPrefix();e(d.document,"touchend",this._onTouchEnd,o),e(d.document,"touchmove",this._onMouseMove,o),t(l,c+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var l=this.upperCanvasEl,c=this._getEventPrefix();t(l,c+"move",this._onMouseMove,o),e(d.document,c+"up",this._onMouseUp),e(d.document,c+"move",this._onMouseMove,o)},_onTouchEnd:function(a){if(a.touches.length>0)return;this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var l=this._getEventPrefix();t(d.document,"touchend",this._onTouchEnd,o),t(d.document,"touchmove",this._onMouseMove,o);var c=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(c.upperCanvasEl,l+"down",c._onMouseDown),c._willAddMouseDown=0},400)},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var l=this.upperCanvasEl,c=this._getEventPrefix();this._isMainEvent(a)&&(t(d.document,c+"up",this._onMouseUp),t(d.document,c+"move",this._onMouseMove,o),e(l,c+"move",this._onMouseMove,o))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var l=this._activeObject;return!!l!==!!a||l&&a&&l!==a?!0:(l&&l.isEditing,!1)},__onMouseUp:function(a){var l,c=this._currentTransform,h=this._groupSelector,u=!1,f=!h||h.left===0&&h.top===0;if(this._cacheTransformEventData(a),l=this._target,this._handleEvent(a,"up:before"),s(a,r)){this.fireRightClick&&this._handleEvent(a,"up",r,f);return}if(s(a,i)){this.fireMiddleClick&&this._handleEvent(a,"up",i,f),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}if(!this._isMainEvent(a))return;if(c&&(this._finalizeCurrentTransform(a),u=c.actionPerformed),!f){var p=l===this._activeObject;this._maybeGroupObjects(a),u||(u=this._shouldRender(l)||!p&&l===this._activeObject)}if(l){var m=l._findTargetCorner(this.getPointer(a,!0),d.util.isTouchEvent(a)),g=l.controls[m],S=g&&g.getMouseUpHandler(a,l,g);S&&S(a,l,g),l.isMoving=!1}this._setCursorFromEvent(a,l),this._handleEvent(a,"up",n,f),this._groupSelector=null,this._currentTransform=null,l&&(l.__corner=0),u?this.requestRenderAll():f||this.renderTop()},_simpleEventHandler:function(a,l){var c=this.findTarget(l),h=this.targets,u={e:l,target:c,subTargets:h};if(this.fire(a,u),c&&c.fire(a,u),!h)return c;for(var f=0;f<h.length;f++)h[f].fire(a,u);return c},_handleEvent:function(a,l,c,h){var u=this._target,f=this.targets||[],p={e:a,target:u,subTargets:f,button:c||n,isClick:h||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};l==="up"&&(p.currentTarget=this.findTarget(a),p.currentSubTargets=this.targets),this.fire("mouse:"+l,p),u&&u.fire("mouse"+l,p);for(var m=0;m<f.length;m++)f[m].fire("mouse"+l,p)},_finalizeCurrentTransform:function(a){var l=this._currentTransform,c=l.target,h,u={e:a,target:c,transform:l,action:l.action};c._scaling&&(c._scaling=!1),c.setCoords(),(l.actionPerformed||this.stateful&&c.hasStateChanged())&&(l.actionPerformed&&(h=this._addEventOptions(u,l),this._fire(h,u)),this._fire("modified",u))},_addEventOptions:function(a,l){var c,h;switch(l.action){case"scaleX":c="scaled",h="x";break;case"scaleY":c="scaled",h="y";break;case"skewX":c="skewed",h="x";break;case"skewY":c="skewed",h="y";break;case"scale":c="scaled",h="equally";break;case"rotate":c="rotated";break;case"drag":c="moved";break}return a.by=h,c},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var l=this.getPointer(a);this.freeDrawingBrush.onMouseDown(l,{e:a,pointer:l}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var l=this.getPointer(a);this.freeDrawingBrush.onMouseMove(l,{e:a,pointer:l})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var l=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:l}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var l=this._target;if(s(a,r)){this.fireRightClick&&this._handleEvent(a,"down",r);return}if(s(a,i)){this.fireMiddleClick&&this._handleEvent(a,"down",i);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(!this._isMainEvent(a))return;if(this._currentTransform)return;var c=this._pointer;this._previousPointer=c;var h=this._shouldRender(l),u=this._shouldGroup(a,l);if(this._shouldClearSelection(a,l)?this.discardActiveObject(a):u&&(this._handleGrouping(a,l),l=this._activeObject),this.selection&&(!l||!l.selectable&&!l.isEditing&&l!==this._activeObject)&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0}),l){var f=l===this._activeObject;l.selectable&&this.setActiveObject(l,a);var p=l._findTargetCorner(this.getPointer(a,!0),d.util.isTouchEvent(a));if(l.__corner=p,l===this._activeObject&&(p||!u)){var m=l.controls[p],g=m&&m.getMouseDownHandler(a,l,m);g&&g(a,l,m),this._setupCurrentTransform(a,l,f)}}this._handleEvent(a,"down"),(h||u)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var l=this._currentTransform;this.stateful&&l.target.saveState(),this.fire("before:transform",{e:a,transform:l})},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var l,c;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(!this._isMainEvent(a))return;var h=this._groupSelector;h?(c=this._pointer,h.left=c.x-h.ex,h.top=c.y-h.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(l=this.findTarget(a)||null,this._setCursorFromEvent(a,l),this._fireOverOutEvents(l,a)),this._handleEvent(a,"move"),this._resetTransformEventData()},_fireOverOutEvents:function(a,l){var c=this._hoveredTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(a,l,{oldTarget:c,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var p=0;p<f;p++)this.fireSyntheticInOutEvents(u[p],l,{oldTarget:h[p],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,l){var c=this._draggedoverTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(a,l,{oldTarget:c,evtOut:"dragleave",evtIn:"dragenter"});for(var p=0;p<f;p++)this.fireSyntheticInOutEvents(u[p],l,{oldTarget:h[p],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,l,c){var h,u,f=c.oldTarget,p,m,g=f!==a,S=c.canvasEvtIn,C=c.canvasEvtOut;g&&(h={e:l,target:a,previousTarget:f},u={e:l,target:f,nextTarget:a}),m=a&&g,p=f&&g,p&&(C&&this.fire(C,u),f.fire(c.evtOut,u)),m&&(S&&this.fire(S,h),a.fire(c.evtIn,h))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var l=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,c.shiftKey=a.shiftKey,c.altKey=a[this.centeredKey],this._performTransformAction(a,c,l),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,l,c){var h=c.x,u=c.y,f=l.action,p=!1,m=l.actionHandler;m&&(p=m(a,l,h,u)),f==="drag"&&p&&this.setCursor(l.target.moveCursor||this.moveCursor),l.actionPerformed=l.actionPerformed||p},_fire:d.controlsUtils.fireEvent,_setCursorFromEvent:function(a,l){if(!l)return this.setCursor(this.defaultCursor),!1;var c=l.hoverCursor||this.hoverCursor,h=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,u=(!h||!h.contains(l))&&l._findTargetCorner(this.getPointer(a,!0));u?this.setCursor(this.getCornerCursor(u,l,a)):(l.subTargetCheck&&this.targets.concat().reverse().map(function(f){c=f.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(a,l,c){var h=l.controls[a];return h.cursorStyleHandler(c,h,l)}})})();(function(){var e=Math.min,t=Math.max;d.util.object.extend(d.Canvas.prototype,{_shouldGroup:function(r,i){var n=this._activeObject;return n&&this._isSelectionKeyPressed(r)&&i&&i.selectable&&this.selection&&(n!==i||n.type==="activeSelection")&&!i.onSelect({e:r})},_handleGrouping:function(r,i){var n=this._activeObject;if(n.__corner)return;if(i===n&&(i=this.findTarget(r,!0),!i||!i.selectable))return;n&&n.type==="activeSelection"?this._updateActiveSelection(i,r):this._createActiveSelection(i,r)},_updateActiveSelection:function(r,i){var n=this._activeObject,o=n._objects.slice(0);n.contains(r)?(n.removeWithUpdate(r),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),i)):(n.addWithUpdate(r),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(o,i)},_createActiveSelection:function(r,i){var n=this.getActiveObjects(),o=this._createGroup(r);this._hoveredTarget=o,this._setActiveObject(o,i),this._fireSelectionEvents(n,i)},_createGroup:function(r){var i=this._objects,n=i.indexOf(this._activeObject)<i.indexOf(r),o=n?[this._activeObject,r]:[r,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new d.ActiveSelection(o,{canvas:this})},_groupSelectedObjects:function(r){var i=this._collectObjects(r),n;i.length===1?this.setActiveObject(i[0],r):i.length>1&&(n=new d.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(n,r))},_collectObjects:function(r){for(var i=[],n,o=this._groupSelector.ex,s=this._groupSelector.ey,a=o+this._groupSelector.left,l=s+this._groupSelector.top,c=new d.Point(e(o,a),e(s,l)),h=new d.Point(t(o,a),t(s,l)),u=!this.selectionFullyContained,f=o===a&&s===l,p=this._objects.length;p--;){if(n=this._objects[p],!n||!n.selectable||!n.visible)continue;if((u&&n.intersectsWithRect(c,h)||n.isContainedWithinRect(c,h)||u&&n.containsPoint(c)||u&&n.containsPoint(h))&&(i.push(n),f))break}return i.length>1&&(i=i.filter(function(m){return!m.onSelect({e:r})})),i},_maybeGroupObjects:function(r){this.selection&&this._groupSelector&&this._groupSelectedObjects(r),this.setCursor(this.defaultCursor),this._groupSelector=null}})})();(function(){d.util.object.extend(d.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",r=e.quality||1,i=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(i,e);return d.util.toDataURL(n,t,r)},toCanvasElement:function(e,t){e=e||1,t=t||{};var r=(t.width||this.width)*e,i=(t.height||this.height)*e,n=this.getZoom(),o=this.width,s=this.height,a=n*e,l=this.viewportTransform,c=(l[4]-(t.left||0))*e,h=(l[5]-(t.top||0))*e,u=this.interactive,f=[a,0,0,a,c,h],p=this.enableRetinaScaling,m=d.util.createCanvasElement(),g=this.contextTop;return m.width=r,m.height=i,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=r,this.height=i,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),this._objects),this.viewportTransform=l,this.width=o,this.height=s,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=p,this.contextTop=g,m}})})();d.util.object.extend(d.StaticCanvas.prototype,{loadFromJSON:function(e,t,r){if(!e)return;var i=typeof e=="string"?JSON.parse(e):d.util.object.clone(e),n=this,o=i.clipPath,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete i.clipPath,this._enlivenObjects(i.objects,function(a){n.clear(),n._setBgOverlay(i,function(){o?n._enlivenObjects([o],function(l){n.clipPath=l[0],n.__setupCanvas.call(n,i,a,s,t)}):n.__setupCanvas.call(n,i,a,s,t)})},r),this},__setupCanvas:function(e,t,r,i){var n=this;t.forEach(function(o,s){n.insertAt(o,s)}),this.renderOnAddRemove=r,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),i&&i()},_setBgOverlay:function(e,t){var r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var i=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(t&&t())};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,i),this.__setBgOverlay("overlayImage",e.overlayImage,r,i),this.__setBgOverlay("backgroundColor",e.background,r,i),this.__setBgOverlay("overlayColor",e.overlay,r,i)},__setBgOverlay:function(e,t,r,i){var n=this;if(!t){r[e]=!0,i&&i();return}e==="backgroundImage"||e==="overlayImage"?d.util.enlivenObjects([t],function(o){n[e]=o[0],r[e]=!0,i&&i()}):this["set"+d.util.string.capitalize(e,!0)](t,function(){r[e]=!0,i&&i()})},_enlivenObjects:function(e,t,r){if(!e||e.length===0){t&&t([]);return}d.util.enlivenObjects(e,function(i){t&&t(i)},null,r)},_toDataURL:function(e,t){this.clone(function(r){t(r.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,r){this.clone(function(i){r(i.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var r=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(i){i.loadFromJSON(r,function(){e&&e(i)})})},cloneWithoutData:function(e){var t=d.util.createCanvasElement();t.width=this.width,t.height=this.height;var r=new d.Canvas(t);this.backgroundImage?(r.setBackgroundImage(this.backgroundImage.src,function(){r.renderAll(),e&&e(r)}),r.backgroundImageOpacity=this.backgroundImageOpacity,r.backgroundImageStretch=this.backgroundImageStretch):e&&e(r)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n=t.util.toFixed,o=t.util.string.capitalize,s=t.util.degreesToRadians,a=t.StaticCanvas.supports("setLineDash"),l=!t.isLikelyNode,c=2;if(t.Object)return;t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:l,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(h){h&&this.setOptions(h)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(h){var u=t.perfLimitSizeTotal,f=h.width,p=h.height,m=t.maxCacheSideLimit,g=t.minCacheSideLimit;if(f<=m&&p<=m&&f*p<=u)return f<g&&(h.width=g),p<g&&(h.height=g),h;var S=f/p,C=t.util.limitDimsByArea(S,u),k=t.util.capValue,W=k(g,C.x,m),J=k(g,C.y,m);return f>W&&(h.zoomX/=f/W,h.width=W,h.capped=!0),p>J&&(h.zoomY/=p/J,h.height=J,h.capped=!0),h},_getCacheCanvasDimensions:function(){var h=this.getTotalObjectScaling(),u=this._getTransformedDimensions(0,0),f=u.x*h.scaleX/this.scaleX,p=u.y*h.scaleY/this.scaleY;return{width:f+c,height:p+c,zoomX:h.scaleX,zoomY:h.scaleY,x:f,y:p}},_updateCacheCanvas:function(){var h=this.canvas;if(this.noScaleCache&&h&&h._currentTransform){var u=h._currentTransform.target,f=h._currentTransform.action;if(this===u&&f.slice&&f.slice(0,5)==="scale")return!1}var p=this._cacheCanvas,m=this._limitCacheSize(this._getCacheCanvasDimensions()),g=t.minCacheSideLimit,S=m.width,C=m.height,k,W,J=m.zoomX,$=m.zoomY,Q=S!==this.cacheWidth||C!==this.cacheHeight,q=this.zoomX!==J||this.zoomY!==$,K=Q||q,A=0,N=0,j=!1;if(Q){var b=this._cacheCanvas.width,E=this._cacheCanvas.height,D=S>b||C>E,T=(S<b*.9||C<E*.9)&&b>g&&E>g;j=D||T,D&&!m.capped&&(S>g||C>g)&&(A=S*.1,N=C*.1)}return K?(j?(p.width=Math.ceil(S+A),p.height=Math.ceil(C+N)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,p.width,p.height)),k=m.x/2,W=m.y/2,this.cacheTranslationX=Math.round(p.width/2-k)+k,this.cacheTranslationY=Math.round(p.height/2-W)+W,this.cacheWidth=S,this.cacheHeight=C,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(J,$),this.zoomX=J,this.zoomY=$,!0):!1},setOptions:function(h){this._setOptions(h),this._initGradient(h.fill,"fill"),this._initGradient(h.stroke,"stroke"),this._initPattern(h.fill,"fill"),this._initPattern(h.stroke,"stroke")},transform:function(h){var u=this.group&&!this.group._transformDone||this.group&&this.canvas&&h===this.canvas.contextTop,f=this.calcTransformMatrix(!u);h.transform(f[0],f[1],f[2],f[3],f[4],f[5])},toObject:function(h){var u=t.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:n(this.left,u),top:n(this.top,u),width:n(this.width,u),height:n(this.height,u),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,u),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,u),scaleX:n(this.scaleX,u),scaleY:n(this.scaleY,u),angle:n(this.angle,u),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,u),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,u),skewY:n(this.skewY,u)};return this.clipPath&&(f.clipPath=this.clipPath.toObject(h),f.clipPath.inverted=this.clipPath.inverted,f.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,f,h),this.includeDefaultValues||(f=this._removeDefaultValues(f)),f},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(h){var u=t.util.getKlass(h.type).prototype,f=u.stateProperties;return f.forEach(function(p){if(p==="left"||p==="top")return;h[p]===u[p]&&delete h[p];var m=Object.prototype.toString.call(h[p])==="[object Array]"&&Object.prototype.toString.call(u[p])==="[object Array]";m&&h[p].length===0&&u[p].length===0&&delete h[p]}),h},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){var h=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(h.scaleX),scaleY:Math.abs(h.scaleY)}},getTotalObjectScaling:function(){var h=this.getObjectScaling(),u=h.scaleX,f=h.scaleY;if(this.canvas){var p=this.canvas.getZoom(),m=this.canvas.getRetinaScaling();u*=p*m,f*=p*m}return{scaleX:u,scaleY:f}},getObjectOpacity:function(){var h=this.opacity;return this.group&&(h*=this.group.getObjectOpacity()),h},_set:function(h,u){var f=h==="scaleX"||h==="scaleY",p=this[h]!==u,m=!1;return f&&(u=this._constrainScale(u)),h==="scaleX"&&u<0?(this.flipX=!this.flipX,u*=-1):h==="scaleY"&&u<0?(this.flipY=!this.flipY,u*=-1):h==="shadow"&&u&&!(u instanceof t.Shadow)?u=new t.Shadow(u):h==="dirty"&&this.group&&this.group.set("dirty",u),this[h]=u,p&&(m=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(h)>-1?(this.dirty=!0,m&&this.group.set("dirty",!0)):m&&this.stateProperties.indexOf(h)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(h){if(this.isNotVisible())return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;h.save(),this._setupCompositeOperation(h),this.drawSelectionBackground(h),this.transform(h),this._setOpacity(h),this._setShadow(h,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(h)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(h),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),h.restore()},renderCache:function(h){h=h||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,h.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"?!0:!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(h){var u=this.clipPath;if(h.save(),u.inverted?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="destination-in",u.absolutePositioned){var f=t.util.invertTransform(this.calcTransformMatrix());h.transform(f[0],f[1],f[2],f[3],f[4],f[5])}u.transform(h),h.scale(1/u.zoomX,1/u.zoomY),h.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),h.restore()},drawObject:function(h,u){var f=this.fill,p=this.stroke;u?(this.fill="black",this.stroke="",this._setClippingProperties(h)):(this._renderBackground(h),this._setStrokeStyles(h,this),this._setFillStyles(h,this)),this._render(h),this._drawClipPath(h),this.fill=f,this.stroke=p},_drawClipPath:function(h){var u=this.clipPath;if(!u)return;u.canvas=this.canvas,u.shouldCache(),u._transformDone=!0,u.renderCache({forClipping:!0}),this.drawClipPathOnCache(h)},drawCacheOnCanvas:function(h){h.scale(1/this.zoomX,1/this.zoomY),h.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(h){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!h&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!h){var u=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-u/2,-f/2,u,f)}return!0}return!1},_renderBackground:function(h){if(!this.backgroundColor)return;var u=this._getNonTransformedDimensions();h.fillStyle=this.backgroundColor,h.fillRect(-u.x/2,-u.y/2,u.x,u.y),this._removeShadow(h)},_setOpacity:function(h){this.group&&!this.group._transformDone?h.globalAlpha=this.getObjectOpacity():h.globalAlpha*=this.opacity},_setStrokeStyles:function(h,u){u.stroke&&(h.lineWidth=u.strokeWidth,h.lineCap=u.strokeLineCap,h.lineDashOffset=u.strokeDashOffset,h.lineJoin=u.strokeLineJoin,h.miterLimit=u.strokeMiterLimit,h.strokeStyle=u.stroke.toLive?u.stroke.toLive(h,this):u.stroke)},_setFillStyles:function(h,u){u.fill&&(h.fillStyle=u.fill.toLive?u.fill.toLive(h,this):u.fill)},_setClippingProperties:function(h){h.globalAlpha=1,h.strokeStyle="transparent",h.fillStyle="#000000"},_setLineDash:function(h,u,f){if(!u||u.length===0)return;1&u.length&&u.push.apply(u,u),a?h.setLineDash(u):f&&f(h)},_renderControls:function(h,u){var f=this.getViewportTransform(),p=this.calcTransformMatrix(),m,g,S;u=u||{},g=typeof u.hasBorders!="undefined"?u.hasBorders:this.hasBorders,S=typeof u.hasControls!="undefined"?u.hasControls:this.hasControls,p=t.util.multiplyTransformMatrices(f,p),m=t.util.qrDecompose(p),h.save(),h.translate(m.translateX,m.translateY),h.lineWidth=1*this.borderScaleFactor,this.group||(h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),u.forActiveSelection?(h.rotate(s(m.angle)),g&&this.drawBordersInGroup(h,m,u)):(h.rotate(s(this.angle)),g&&this.drawBorders(h,u)),S&&this.drawControls(h,u),h.restore()},_setShadow:function(h){if(!this.shadow)return;var u=this.shadow,f=this.canvas,p,m=f&&f.viewportTransform[0]||1,g=f&&f.viewportTransform[3]||1;u.nonScaling?p={scaleX:1,scaleY:1}:p=this.getObjectScaling(),f&&f._isRetinaScaling()&&(m*=t.devicePixelRatio,g*=t.devicePixelRatio),h.shadowColor=u.color,h.shadowBlur=u.blur*t.browserShadowBlurConstant*(m+g)*(p.scaleX+p.scaleY)/4,h.shadowOffsetX=u.offsetX*m*p.scaleX,h.shadowOffsetY=u.offsetY*g*p.scaleY},_removeShadow:function(h){if(!this.shadow)return;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_applyPatternGradientTransform:function(h,u){if(!u||!u.toLive)return{offsetX:0,offsetY:0};var f=u.gradientTransform||u.patternTransform,p=-this.width/2+u.offsetX||0,m=-this.height/2+u.offsetY||0;return u.gradientUnits==="percentage"?h.transform(this.width,0,0,this.height,p,m):h.transform(1,0,0,1,p,m),f&&h.transform(f[0],f[1],f[2],f[3],f[4],f[5]),{offsetX:p,offsetY:m}},_renderPaintInOrder:function(h){this.paintFirst==="stroke"?(this._renderStroke(h),this._renderFill(h)):(this._renderFill(h),this._renderStroke(h))},_render:function(){},_renderFill:function(h){if(!this.fill)return;h.save(),this._applyPatternGradientTransform(h,this.fill),this.fillRule==="evenodd"?h.fill("evenodd"):h.fill(),h.restore()},_renderStroke:function(h){if(!this.stroke||this.strokeWidth===0)return;if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeUniform&&this.group){var u=this.getObjectScaling();h.scale(1/u.scaleX,1/u.scaleY)}else this.strokeUniform&&h.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(h,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(h,this.stroke):this._applyPatternGradientTransform(h,this.stroke),h.stroke(),h.restore()},_applyPatternForTransformedGradient:function(h,u){var f=this._limitCacheSize(this._getCacheCanvasDimensions()),p=t.util.createCanvasElement(),m,g=this.canvas.getRetinaScaling(),S=f.x/this.scaleX/g,C=f.y/this.scaleY/g;p.width=S,p.height=C,m=p.getContext("2d"),m.beginPath(),m.moveTo(0,0),m.lineTo(S,0),m.lineTo(S,C),m.lineTo(0,C),m.closePath(),m.translate(S/2,C/2),m.scale(f.zoomX/this.scaleX/g,f.zoomY/this.scaleY/g),this._applyPatternGradientTransform(m,u),m.fillStyle=u.toLive(h),m.fill(),h.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),h.scale(g*this.scaleX/f.zoomX,g*this.scaleY/f.zoomY),h.strokeStyle=m.createPattern(p,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var h=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",h.scaleX),this.set("scaleY",h.scaleY),this.angle=h.angle,this.skewX=h.skewX,this.skewY=0}},_removeTransformMatrix:function(h){var u=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),u=t.util.transformPoint(u,this.transformMatrix)),this.transformMatrix=null,h&&(this.scaleX*=h.scaleX,this.scaleY*=h.scaleY,this.cropX=h.cropX,this.cropY=h.cropY,u.x+=h.offsetLeft,u.y+=h.offsetTop,this.width=h.width,this.height=h.height),this.setPositionByOrigin(u,"center","center")},clone:function(h,u){var f=this.toObject(u);this.constructor.fromObject?this.constructor.fromObject(f,h):t.Object._fromObject("Object",f,h)},cloneAsImage:function(h,u){var f=this.toCanvasElement(u);return h&&h(new t.Image(f)),this},toCanvasElement:function(h){h||(h={});var u=t.util,f=u.saveObjectTransform(this),p=this.group,m=this.shadow,g=Math.abs,S=(h.multiplier||1)*(h.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,h.withoutTransform&&u.resetObjectTransform(this),h.withoutShadow&&(this.shadow=null);var C=t.util.createCanvasElement(),k=this.getBoundingRect(!0,!0),W=this.shadow,J,$={x:0,y:0},Q,q,K;W&&(Q=W.blur,W.nonScaling?J={scaleX:1,scaleY:1}:J=this.getObjectScaling(),$.x=2*Math.round(g(W.offsetX)+Q)*g(J.scaleX),$.y=2*Math.round(g(W.offsetY)+Q)*g(J.scaleY)),q=k.width+$.x,K=k.height+$.y,C.width=Math.ceil(q),C.height=Math.ceil(K);var A=new t.StaticCanvas(C,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});h.format==="jpeg"&&(A.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(A.width/2,A.height/2),"center","center");var N=this.canvas;A.add(this);var j=A.toCanvasElement(S||1,h);return this.shadow=m,this.set("canvas",N),p&&(this.group=p),this.set(f).setCoords(),A._objects=[],A.dispose(),A=null,j},toDataURL:function(h){return h||(h={}),t.util.toDataURL(this.toCanvasElement(h),h.format||"png",h.quality||1)},isType:function(h){return this.type===h},complexity:function(){return 1},toJSON:function(h){return this.toObject(h)},rotate:function(h){var u=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return u&&this._setOriginToCenter(),this.set("angle",h),u&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(h,u){u=u||this.canvas.getPointer(h);var f=new t.Point(u.x,u.y),p=this._getLeftTopCoords();return this.angle&&(f=t.util.rotatePoint(f,p,s(-this.angle))),{x:f.x-p.x,y:f.y-p.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),r(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(h,u,f,p){var m=t[h];u=i(u,!0),t.util.enlivenPatterns([u.fill,u.stroke],function(g){typeof g[0]!="undefined"&&(u.fill=g[0]),typeof g[1]!="undefined"&&(u.stroke=g[1]),t.util.enlivenObjects([u.clipPath],function(S){u.clipPath=S[0];var C=p?new m(u[p],u):new m(u);f&&f(C)})})},t.Object.__uid=0})((typeof L!="undefined",L));(function(){var e=d.util.degreesToRadians,t={left:-.5,center:0,right:.5},r={top:-.5,center:0,bottom:.5};d.util.object.extend(d.Object.prototype,{translateToGivenOrigin:function(i,n,o,s,a){var l=i.x,c=i.y,h,u,f;return typeof n=="string"?n=t[n]:n-=.5,typeof s=="string"?s=t[s]:s-=.5,h=s-n,typeof o=="string"?o=r[o]:o-=.5,typeof a=="string"?a=r[a]:a-=.5,u=a-o,(h||u)&&(f=this._getTransformedDimensions(),l=i.x+h*f.x,c=i.y+u*f.y),new d.Point(l,c)},translateToCenterPoint:function(i,n,o){var s=this.translateToGivenOrigin(i,n,o,"center","center");return this.angle?d.util.rotatePoint(s,i,e(this.angle)):s},translateToOriginPoint:function(i,n,o){var s=this.translateToGivenOrigin(i,"center","center",n,o);return this.angle?d.util.rotatePoint(s,i,e(this.angle)):s},getCenterPoint:function(){var i=new d.Point(this.left,this.top);return this.translateToCenterPoint(i,this.originX,this.originY)},getPointByOrigin:function(i,n){var o=this.getCenterPoint();return this.translateToOriginPoint(o,i,n)},toLocalPoint:function(i,n,o){var s=this.getCenterPoint(),a,l;return typeof n!="undefined"&&typeof o!="undefined"?a=this.translateToGivenOrigin(s,"center","center",n,o):a=new d.Point(this.left,this.top),l=new d.Point(i.x,i.y),this.angle&&(l=d.util.rotatePoint(l,s,-e(this.angle))),l.subtractEquals(a)},setPositionByOrigin:function(i,n,o){var s=this.translateToCenterPoint(i,n,o),a=this.translateToOriginPoint(s,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(i){var n=e(this.angle),o=this.getScaledWidth(),s=d.util.cos(n)*o,a=d.util.sin(n)*o,l,c;typeof this.originX=="string"?l=t[this.originX]:l=this.originX-.5,typeof i=="string"?c=t[i]:c=i-.5,this.left+=s*(c-l),this.top+=a*(c-l),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var i=this.getCenterPoint();this.originX="center",this.originY="center",this.left=i.x,this.top=i.y},_resetOrigin:function(){var i=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=i.x,this.top=i.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function e(o){return[new d.Point(o.tl.x,o.tl.y),new d.Point(o.tr.x,o.tr.y),new d.Point(o.br.x,o.br.y),new d.Point(o.bl.x,o.bl.y)]}var t=d.util,r=t.degreesToRadians,i=t.multiplyTransformMatrices,n=t.transformPoint;t.object.extend(d.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(o,s){return s?o?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),o?this.aCoords:this.lineCoords)},getCoords:function(o,s){return e(this._getCoords(o,s))},intersectsWithRect:function(o,s,a,l){var c=this.getCoords(a,l),h=d.Intersection.intersectPolygonRectangle(c,o,s);return h.status==="Intersection"},intersectsWithObject:function(o,s,a){var l=d.Intersection.intersectPolygonPolygon(this.getCoords(s,a),o.getCoords(s,a));return l.status==="Intersection"||o.isContainedWithinObject(this,s,a)||this.isContainedWithinObject(o,s,a)},isContainedWithinObject:function(o,s,a){for(var l=this.getCoords(s,a),c=s?o.aCoords:o.lineCoords,h=0,u=o._getImageLines(c);h<4;h++)if(!o.containsPoint(l[h],u))return!1;return!0},isContainedWithinRect:function(o,s,a,l){var c=this.getBoundingRect(a,l);return c.left>=o.x&&c.left+c.width<=s.x&&c.top>=o.y&&c.top+c.height<=s.y},containsPoint:function(o,s,a,l){var c=this._getCoords(a,l),s=s||this._getImageLines(c),h=this._findCrossPoints(o,s);return h!==0&&h%2===1},isOnScreen:function(o){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br,l=this.getCoords(!0,o);return l.some(function(c){return c.x<=a.x&&c.x>=s.x&&c.y<=a.y&&c.y>=s.y})||this.intersectsWithRect(s,a,!0,o)?!0:this._containsCenterOfCanvas(s,a,o)},_containsCenterOfCanvas:function(o,s,a){var l={x:(o.x+s.x)/2,y:(o.y+s.y)/2};return!!this.containsPoint(l,null,!0,a)},isPartiallyOnScreen:function(o){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;if(this.intersectsWithRect(s,a,!0,o))return!0;var l=this.getCoords(!0,o).every(function(c){return(c.x>=a.x||c.x<=s.x)&&(c.y>=a.y||c.y<=s.y)});return l&&this._containsCenterOfCanvas(s,a,o)},_getImageLines:function(o){var s={topline:{o:o.tl,d:o.tr},rightline:{o:o.tr,d:o.br},bottomline:{o:o.br,d:o.bl},leftline:{o:o.bl,d:o.tl}};return s},_findCrossPoints:function(o,s){var a,l,c,h,u,f=0,p;for(var m in s){if(p=s[m],p.o.y<o.y&&p.d.y<o.y)continue;if(p.o.y>=o.y&&p.d.y>=o.y)continue;if(p.o.x===p.d.x&&p.o.x>=o.x?u=p.o.x:(a=0,l=(p.d.y-p.o.y)/(p.d.x-p.o.x),c=o.y-a*o.x,h=p.o.y-l*p.o.x,u=-(c-h)/(a-l)),u>=o.x&&(f+=1),f===2)break}return f},getBoundingRect:function(o,s){var a=this.getCoords(o,s);return t.makeBoundingBoxFromPoints(a)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(o){return Math.abs(o)<this.minScaleLimit?o<0?-this.minScaleLimit:this.minScaleLimit:o===0?1e-4:o},scale:function(o){return this._set("scaleX",o),this._set("scaleY",o),this.setCoords()},scaleToWidth:function(o,s){var a=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(o/this.width/a)},scaleToHeight:function(o,s){var a=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(o/this.height/a)},calcCoords:function(o){return o?this.calcACoords():this.calcOCoords()},calcLineCoords:function(){var o=this.getViewportTransform(),s=this.padding,a=r(this.angle),l=t.cos(a),c=t.sin(a),h=l*s,u=c*s,f=h+u,p=h-u,m=this.calcACoords(),g={tl:n(m.tl,o),tr:n(m.tr,o),bl:n(m.bl,o),br:n(m.br,o)};return s&&(g.tl.x-=p,g.tl.y-=f,g.tr.x+=f,g.tr.y-=p,g.bl.x-=f,g.bl.y+=p,g.br.x+=p,g.br.y+=f),g},calcOCoords:function(){var o=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),a=this.getViewportTransform(),l=i(a,s),c=i(l,o),c=i(c,[1/a[0],0,0,1/a[3],0,0]),h=this._calculateCurrentDimensions(),u={};return this.forEachControl(function(f,p,m){u[p]=f.positionHandler(h,c,m)}),u},calcACoords:function(){var o=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),a=i(s,o),l=this._getTransformedDimensions(),c=l.x/2,h=l.y/2;return{tl:n({x:-c,y:-h},a),tr:n({x:c,y:-h},a),bl:n({x:-c,y:h},a),br:n({x:c,y:h},a)}},setCoords:function(o){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),o?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return t.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var o=this.getCenterPoint();return[1,0,0,1,o.x,o.y]},transformMatrixKey:function(o){var s="_",a="";return!o&&this.group&&(a=this.group.transformMatrixKey(o)+s),a+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(o){var s=this.calcOwnMatrix();if(o||!this.group)return s;var a=this.transformMatrixKey(o),l=this.matrixCache||(this.matrixCache={});return l.key===a?l.value:(this.group&&(s=i(this.group.calcTransformMatrix(!1),s)),l.key=a,l.value=s,s)},calcOwnMatrix:function(){var o=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===o)return s.value;var a=this._calcTranslateMatrix(),l={angle:this.angle,translateX:a[4],translateY:a[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=o,s.value=t.composeMatrix(l),s.value},_calcDimensionsTransformMatrix:function(o,s,a){return t.calcDimensionsMatrix({skewX:o,skewY:s,scaleX:this.scaleX*(a&&this.flipX?-1:1),scaleY:this.scaleY*(a&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var o=this.strokeWidth,s=this.width+o,a=this.height+o;return{x:s,y:a}},_getTransformedDimensions:function(o,s){typeof o=="undefined"&&(o=this.skewX),typeof s=="undefined"&&(s=this.skewY);var a=this._getNonTransformedDimensions(),l,c,h=o===0&&s===0;if(this.strokeUniform?(l=this.width,c=this.height):(l=a.x,c=a.y),h)return this._finalizeDimensions(l*this.scaleX,c*this.scaleY);var u=t.sizeAfterTransform(l,c,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:o,skewY:s});return this._finalizeDimensions(u.x,u.y)},_finalizeDimensions:function(o,s){return this.strokeUniform?{x:o+this.strokeWidth,y:s+this.strokeWidth}:{x:o,y:s}},_calculateCurrentDimensions:function(){var o=this.getViewportTransform(),s=this._getTransformedDimensions(),a=n(s,o,!0);return a.scalarAdd(2*this.padding)}})})();d.util.object.extend(d.Object.prototype,{sendToBack:function(){return this.group?d.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?d.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?d.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?d.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&this.group.type!=="activeSelection"?d.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}});(function(){function e(r,i){if(i){if(i.toLive)return r+": url(#SVGID_"+i.id+"); ";var n=new d.Color(i),o=r+": "+n.toRgb()+"; ",s=n.getAlpha();return s!==1&&(o+=r+"-opacity: "+s.toString()+"; "),o}else return r+": none; "}var t=d.util.toFixed;d.util.object.extend(d.Object.prototype,{getSvgStyles:function(r){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",l=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=typeof this.opacity!="undefined"?this.opacity:"1",u=this.visible?"":" visibility: hidden;",f=r?"":this.getSvgFilter(),p=e("fill",this.fill),m=e("stroke",this.stroke);return[m,"stroke-width: ",n,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",l,"; ","stroke-miterlimit: ",c,"; ",p,"fill-rule: ",i,"; ","opacity: ",h,";",f,u].join("")},getSvgSpanStyles:function(r,i){var n="; ",o=r.fontFamily?"font-family: "+(r.fontFamily.indexOf("'")===-1&&r.fontFamily.indexOf('"')===-1?"'"+r.fontFamily+"'":r.fontFamily)+n:"",s=r.strokeWidth?"stroke-width: "+r.strokeWidth+n:"",o=o,a=r.fontSize?"font-size: "+r.fontSize+"px"+n:"",l=r.fontStyle?"font-style: "+r.fontStyle+n:"",c=r.fontWeight?"font-weight: "+r.fontWeight+n:"",h=r.fill?e("fill",r.fill):"",u=r.stroke?e("stroke",r.stroke):"",f=this.getSvgTextDecoration(r),p=r.deltaY?"baseline-shift: "+-r.deltaY+"; ":"";return f&&(f="text-decoration: "+f+n),[u,s,o,a,l,c,f,h,p,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(r){return["overline","underline","line-through"].filter(function(i){return r[i.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(r,i){var n=r?this.calcTransformMatrix():this.calcOwnMatrix(),o='transform="'+d.util.matrixToSVG(n);return o+(i||"")+'" '},_setSVGBg:function(r){if(this.backgroundColor){var i=d.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),`"></rect>
`)}},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(r),{reviver:r})},toClipPathSVG:function(r){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(r),{reviver:r})},_createBaseClipPathSVGMarkup:function(r,i){i=i||{};var n=i.reviver,o=i.additionalTransform||"",s=[this.getSvgTransform(!0,o),this.getSvgCommons()].join(""),a=r.indexOf("COMMON_PARTS");return r[a]=s,n?n(r.join("")):r.join("")},_createBaseSVGMarkup:function(r,i){i=i||{};var n=i.noStyle,o=i.reviver,s=n?"":'style="'+this.getSvgStyles()+'" ',a=i.withShadow?'style="'+this.getSvgFilter()+'" ':"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,u=this.stroke,f=this.fill,p=this.shadow,m,g=[],S,C=r.indexOf("COMMON_PARTS"),k=i.additionalTransform;return l&&(l.clipPathId="CLIPPATH_"+d.Object.__uid++,S='<clipPath id="'+l.clipPathId+`" >
`+l.toClipPathSVG(o)+`</clipPath>
`),h&&g.push("<g ",a,this.getSvgCommons(),` >
`),g.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons(),` >
`),m=[s,c,n?"":this.addPaintOrder()," ",k?'transform="'+k+'" ':""].join(""),r[C]=m,f&&f.toLive&&g.push(f.toSVG(this)),u&&u.toLive&&g.push(u.toSVG(this)),p&&g.push(p.toSVG(this)),l&&g.push(S),g.push(r.join("")),g.push(`</g>
`),h&&g.push(`</g>
`),o?o(g.join("")):g.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})})();(function(){var e=d.util.object.extend,t="stateProperties";function r(n,o,s){var a={},l=!0;s.forEach(function(c){a[c]=n[c]}),e(n[o],a,l)}function i(n,o,s){if(n===o)return!0;if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(var a=0,l=n.length;a<l;a++)if(!i(n[a],o[a]))return!1;return!0}else if(n&&typeof n=="object"){var c=Object.keys(n),h;if(!o||typeof o!="object"||!s&&c.length!==Object.keys(o).length)return!1;for(var a=0,l=c.length;a<l;a++){if(h=c[a],h==="canvas"||h==="group")continue;if(!i(n[h],o[h]))return!1}return!0}}d.util.object.extend(d.Object.prototype,{hasStateChanged:function(n){n=n||t;var o="_"+n;return Object.keys(this[o]).length<this[n].length?!0:!i(this[o],this,!0)},saveState:function(n){var o=n&&n.propertySet||t,s="_"+o;return this[s]?(r(this,s,this[o]),n&&n.stateProperties&&r(this,s,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var o=n.propertySet||t;return n.propertySet=o,this["_"+o]={},this.saveState(n),this}})})();(function(){var e=d.util.degreesToRadians;d.util.object.extend(d.Object.prototype,{_findTargetCorner:function(t,r){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i=t.x,n=t.y,o,s,a=Object.keys(this.oCoords),l=a.length-1,c;for(this.__corner=0;l>=0;l--){if(c=a[l],!this.isControlVisible(c))continue;if(s=this._getImageLines(r?this.oCoords[c].touchCorner:this.oCoords[c].corner),o=this._findCrossPoints({x:i,y:n},s),o!==0&&o%2===1)return this.__corner=c,c}return!1},forEachControl:function(t){for(var r in this.controls)t(this.controls[r],r,this)},_setCornerCoords:function(){var t=this.oCoords,r=e(45-this.angle),i=d.util.cos(r),n=d.util.sin(r),o=this.cornerSize*.707106,s=this.touchCornerSize*.707106,a=o*i,l=o*n,c=s*i,h=s*n,u,f;for(var p in t)u=t[p].x,f=t[p].y,t[p].corner={tl:{x:u-l,y:f-a},tr:{x:u+a,y:f-l},bl:{x:u-a,y:f+l},br:{x:u+l,y:f+a}},t[p].touchCorner={tl:{x:u-h,y:f-c},tr:{x:u+c,y:f-h},bl:{x:u-c,y:f+h},br:{x:u+h,y:f+c}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var r=this.getCenterPoint(),i=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return t.translate(r.x,r.y),t.scale(1/n[0],1/n[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(t,r){r=r||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,o=i.x+n,s=i.y+n,a=typeof r.hasControls!="undefined"?r.hasControls:this.hasControls,l=!1;return t.save(),t.strokeStyle=r.borderColor||this.borderColor,this._setLineDash(t,r.borderDashArray||this.borderDashArray,null),t.strokeRect(-o/2,-s/2,o,s),a&&(t.beginPath(),this.forEachControl(function(c,h,u){c.withConnection&&c.getVisibility(u,h)&&(l=!0,t.moveTo(c.x*o,c.y*s),t.lineTo(c.x*o+c.offsetX,c.y*s+c.offsetY))}),l&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,r,i){i=i||{};var n=d.util.sizeAfterTransform(this.width,this.height,r),o=this.strokeWidth,s=this.strokeUniform,a=this.borderScaleFactor,l=n.x+o*(s?this.canvas.getZoom():r.scaleX)+a,c=n.y+o*(s?this.canvas.getZoom():r.scaleY)+a;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-l/2,-c/2,l,c),t.restore(),this},drawControls:function(t,r){return r=r||{},t.save(),t.setTransform(this.canvas.getRetinaScaling(),0,0,this.canvas.getRetinaScaling(),0,0),t.strokeStyle=t.fillStyle=r.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=r.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,r.cornerDashArray||this.cornerDashArray,null),this.setCoords(),this.forEachControl(function(i,n,o){i.getVisibility(o,n)&&i.render(t,o.oCoords[n].x,o.oCoords[n].y,r,o)}),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,r){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=r,this},setControlsVisibility:function(t){t||(t={});for(var r in t)this.setControlVisible(r,t[r]);return this},onDeselect:function(){},onSelect:function(){}})})();d.util.object.extend(d.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,o=this;return d.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(s){e.set("left",s),o.requestRenderAll(),n()},onComplete:function(){e.setCoords(),i()}}),this},fxCenterObjectV:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,o=this;return d.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(s){e.set("top",s),o.requestRenderAll(),n()},onComplete:function(){e.setCoords(),i()}}),this},fxRemove:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,o=this;return d.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(s){e.set("opacity",s),o.requestRenderAll(),n()},onComplete:function(){o.remove(e),i()}}),this}});d.util.object.extend(d.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,r;for(t in arguments[0])e.push(t);for(var i=0,n=e.length;i<n;i++)t=e[i],r=i!==n-1,this._animate(t,arguments[0][t],arguments[1],r)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,r,i){var n=this,o;t=t.toString(),r?r=d.util.object.clone(r):r={},~e.indexOf(".")&&(o=e.split("."));var s=n.colorProperties.indexOf(e)>-1||o&&n.colorProperties.indexOf(o[1])>-1,a=o?this.get(o[0])[o[1]]:this.get(e);"from"in r||(r.from=a),s||(~t.indexOf("=")?t=a+parseFloat(t.replace("=","")):t=parseFloat(t));var l={startValue:r.from,endValue:t,byValue:r.by,easing:r.easing,duration:r.duration,abort:r.abort&&function(){return r.abort.call(n)},onChange:function(c,h,u){if(o?n[o[0]][o[1]]=c:n.set(e,c),i)return;r.onChange&&r.onChange(c,h,u)},onComplete:function(c,h,u){if(i)return;n.setCoords(),r.onComplete&&r.onComplete(c,h,u)}};s?d.util.animateColor(l.startValue,l.endValue,l.duration,l):d.util.animate(l)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n={x1:1,x2:1,y1:1,y2:1},o=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,l){a||(a=[0,0,0,0]),this.callSuper("initialize",l),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(l)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,l){return this.callSuper("_set",a,l),typeof n[a]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){if(a.beginPath(),!this.strokeDashArray||this.strokeDashArray&&o){var l=this.calcLinePoints();a.moveTo(l.x1,l.y1),a.lineTo(l.x2,l.y2)}a.lineWidth=this.strokeWidth;var c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=c},_renderDashedStroke:function(a){var l=this.calcLinePoints();a.beginPath(),t.util.drawDashedLine(a,l.x1,l.y1,l.x2,l.y2,this.strokeDashArray),a.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return r(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(a.y-=this.strokeWidth),this.height===0&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,l=this.y1<=this.y2?-1:1,c=a*this.width*.5,h=l*this.height*.5,u=a*this.width*-.5,f=l*this.height*-.5;return{x1:c,x2:u,y1:h,y2:f}},_toSVG:function(){var a=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`" />
`]}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(a,l,c){c=c||{};var h=t.parseAttributes(a,t.Line.ATTRIBUTE_NAMES),u=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];l(new t.Line(u,r(h,c)))},t.Line.fromObject=function(a,l){function c(u){delete u.points,l&&l(u)}var h=i(a,!0);h.points=[a.x1,a.y1,a.x2,a.y2],t.Object._fromObject("Line",h,c,"points")};function s(a,l){var c=a.origin,h=a.axis1,u=a.axis2,f=a.dimension,p=l.nearest,m=l.center,g=l.farthest;return function(){switch(this.get(c)){case p:return Math.min(this.get(h),this.get(u));case m:return Math.min(this.get(h),this.get(u))+.5*this.get(f);case g:return Math.max(this.get(h),this.get(u))}}}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:r*2,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,o){return this.callSuper("_set",n,o),n==="radius"&&this.setRadius(o),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,o=0,s=0,a=(this.endAngle-this.startAngle)%(2*r);if(a===0)n=["<circle ","COMMON_PARTS",'cx="'+o+'" cy="'+s+'" ','r="',this.radius,`" />
`];else{var l=t.util.cos(this.startAngle)*this.radius,c=t.util.sin(this.startAngle)*this.radius,h=t.util.cos(this.endAngle)*this.radius,u=t.util.sin(this.endAngle)*this.radius,f=a>r?"1":"0";n=['<path d="M '+l+" "+c," A "+this.radius+" "+this.radius," 0 ",+f+" 1"," "+h+" "+u,'" ',"COMMON_PARTS",` />
`]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",n*2).set("height",n*2)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(n,o){var s=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES);if(!i(s))throw new Error("value of `r` attribute is required and can not be negative");s.left=(s.left||0)-s.radius,s.top=(s.top||0)-s.radius,o(new t.Circle(s))};function i(n){return"radius"in n&&n.radius>=0}t.Circle.fromObject=function(n,o){return t.Object._fromObject("Circle",n,o)}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(r){var i=this.width/2,n=this.height/2;r.beginPath(),r.moveTo(-i,n),r.lineTo(0,-n),r.lineTo(i,n),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){var i=this.width/2,n=this.height/2;r.beginPath(),t.util.drawDashedLine(r,-i,n,0,-n,this.strokeDashArray),t.util.drawDashedLine(r,0,-n,i,n,this.strokeDashArray),t.util.drawDashedLine(r,i,n,-i,n,this.strokeDashArray),r.closePath()},_toSVG:function(){var r=this.width/2,i=this.height/2,n=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return["<polygon ","COMMON_PARTS",'points="',n,'" />']}}),t.Triangle.fromObject=function(r,i){return t.Object._fromObject("Triangle",r,i)}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI*2;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this.set("rx",i&&i.rx||0),this.set("ry",i&&i.ry||0)},_set:function(i,n){this.callSuper("_set",i,n);switch(i){case"rx":this.rx=n,this.set("width",n*2);break;case"ry":this.ry=n,this.set("height",n*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(i){i.beginPath(),i.save(),i.transform(1,0,0,this.ry/this.rx,0,0),i.arc(0,0,this.rx,0,r,!1),i.restore(),this._renderPaintInOrder(i)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(i,n){var o=t.parseAttributes(i,t.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,n(new t.Ellipse(o))},t.Ellipse.fromObject=function(i,n){return t.Object._fromObject("Ellipse",i,n)}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend;if(t.Rect){t.warn("fabric.Rect is already defined");return}t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(i){var n=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,s=this.width,a=this.height,l=-this.width/2,c=-this.height/2,h=n!==0||o!==0,u=1-.5522847498;i.beginPath(),i.moveTo(l+n,c),i.lineTo(l+s-n,c),h&&i.bezierCurveTo(l+s-u*n,c,l+s,c+u*o,l+s,c+o),i.lineTo(l+s,c+a-o),h&&i.bezierCurveTo(l+s,c+a-u*o,l+s-u*n,c+a,l+s-n,c+a),i.lineTo(l+n,c+a),h&&i.bezierCurveTo(l+u*n,c+a,l,c+a-u*o,l,c+a-o),i.lineTo(l,c+o),h&&i.bezierCurveTo(l,c+u*o,l+u*n,c,l+n,c),i.closePath(),this._renderPaintInOrder(i)},_renderDashedStroke:function(i){var n=-this.width/2,o=-this.height/2,s=this.width,a=this.height;i.beginPath(),t.util.drawDashedLine(i,n,o,n+s,o,this.strokeDashArray),t.util.drawDashedLine(i,n+s,o,n+s,o+a,this.strokeDashArray),t.util.drawDashedLine(i,n+s,o+a,n,o+a,this.strokeDashArray),t.util.drawDashedLine(i,n,o+a,n,o,this.strokeDashArray),i.closePath()},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){var i=-this.width/2,n=-this.height/2;return["<rect ","COMMON_PARTS",'x="',i,'" y="',n,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(i,n,o){if(!i)return n(null);o=o||{};var s=t.parseAttributes(i,t.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0,s.height=s.height||0,s.width=s.width||0;var a=new t.Rect(r(o?t.util.object.clone(o):{},s));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},t.Rect.fromObject=function(i,n){return t.Object._fromObject("Rect",i,n)}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.array.min,n=t.util.array.max,o=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(s,a){a=a||{},this.points=s||[],this.callSuper("initialize",a),this._setPositionDimensions(a)},_setPositionDimensions:function(s){var a=this._calcDimensions(s),l;this.width=a.width,this.height=a.height,s.fromSVG||(l=this.translateToGivenOrigin({x:a.left-this.strokeWidth/2,y:a.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof s.left=="undefined"&&(this.left=s.fromSVG?a.left:l.x),typeof s.top=="undefined"&&(this.top=s.fromSVG?a.top:l.y),this.pathOffset={x:a.left+this.width/2,y:a.top+this.height/2}},_calcDimensions:function(){var s=this.points,a=i(s,"x")||0,l=i(s,"y")||0,c=n(s,"x")||0,h=n(s,"y")||0,u=c-a,f=h-l;return{left:a,top:l,width:u,height:f}},toObject:function(s){return r(this.callSuper("toObject",s),{points:this.points.concat()})},_toSVG:function(){for(var s=[],a=this.pathOffset.x,l=this.pathOffset.y,c=t.Object.NUM_FRACTION_DIGITS,h=0,u=this.points.length;h<u;h++)s.push(o(this.points[h].x-a,c),",",o(this.points[h].y-l,c)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',s.join(""),`" />
`]},commonRender:function(s){var a,l=this.points.length,c=this.pathOffset.x,h=this.pathOffset.y;if(!l||isNaN(this.points[l-1].y))return!1;s.beginPath(),s.moveTo(this.points[0].x-c,this.points[0].y-h);for(var u=0;u<l;u++)a=this.points[u],s.lineTo(a.x-c,a.y-h);return!0},_render:function(s){if(!this.commonRender(s))return;this._renderPaintInOrder(s)},_renderDashedStroke:function(s){var a,l;s.beginPath();for(var c=0,h=this.points.length;c<h;c++)a=this.points[c],l=this.points[c+1]||a,t.util.drawDashedLine(s,a.x,a.y,l.x,l.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(s){return function(a,l,c){if(!a)return l(null);c||(c={});var h=t.parsePointsAttribute(a.getAttribute("points")),u=t.parseAttributes(a,t[s].ATTRIBUTE_NAMES);u.fromSVG=!0,l(new t[s](h,r(u,c)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(s,a){return t.Object._fromObject("Polyline",s,a,"points")}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_render:function(r){if(!this.commonRender(r))return;r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){this.callSuper("_renderDashedStroke",r),r.closePath()}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(r,i){return t.Object._fromObject("Polygon",r,i,"points")}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max,n=t.util.object.extend,o=Object.prototype.toString,s=t.util.toFixed;if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(a,l){l=l||{},this.callSuper("initialize",l),a||(a=[]);var c=o.call(a)==="[object Array]";if(this.path=c?t.util.makePathSimpler(a):t.util.makePathSimpler(t.util.parsePath(a)),!this.path)return;t.Polyline.prototype._setPositionDimensions.call(this,l)},_renderPathCommands:function(a){var l,c=0,h=0,u=0,f=0,p=0,m=0,g=-this.pathOffset.x,S=-this.pathOffset.y;a.beginPath();for(var C=0,k=this.path.length;C<k;++C){l=this.path[C];switch(l[0]){case"L":u=l[1],f=l[2],a.lineTo(u+g,f+S);break;case"M":u=l[1],f=l[2],c=u,h=f,a.moveTo(u+g,f+S);break;case"C":u=l[5],f=l[6],p=l[3],m=l[4],a.bezierCurveTo(l[1]+g,l[2]+S,p+g,m+S,u+g,f+S);break;case"Q":a.quadraticCurveTo(l[1]+g,l[2]+S,l[3]+g,l[4]+S),u=l[3],f=l[4],p=l[1],m=l[2];break;case"z":case"Z":u=c,f=h,a.closePath();break}}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){return n(this.callSuper("toObject",a),{path:this.path.map(function(l){return l.slice()})})},toDatalessObject:function(a){var l=this.toObject(["sourcePath"].concat(a));return l.sourcePath&&delete l.path,l},_toSVG:function(){var a=this.path.map(function(l){return l.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',a,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var a=t.Object.NUM_FRACTION_DIGITS;return" translate("+s(-this.pathOffset.x,a)+", "+s(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var l=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:l})},toSVG:function(a){var l=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:l})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var a=[],l=[],c,h=0,u=0,f=0,p=0,m,g=0,S=this.path.length;g<S;++g){c=this.path[g];switch(c[0]){case"L":f=c[1],p=c[2],m=[];break;case"M":f=c[1],p=c[2],h=f,u=p,m=[];break;case"C":m=t.util.getBoundsOfCurve(f,p,c[1],c[2],c[3],c[4],c[5],c[6]),f=c[5],p=c[6];break;case"Q":m=t.util.getBoundsOfCurve(f,p,c[1],c[2],c[1],c[2],c[3],c[4]),f=c[3],p=c[4];break;case"z":case"Z":f=h,p=u;break}m.forEach(function(q){a.push(q.x),l.push(q.y)}),a.push(f),l.push(p)}var C=r(a)||0,k=r(l)||0,W=i(a)||0,J=i(l)||0,$=W-C,Q=J-k;return{left:C,top:k,width:$,height:Q}}}),t.Path.fromObject=function(a,l){if(typeof a.sourcePath=="string"){var c=a.sourcePath;t.loadSVGFromURL(c,function(h){var u=h[0];u.setOptions(a),l&&l(u)})}else t.Object._fromObject("Path",a,l,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(a,l,c){var h=t.parseAttributes(a,t.Path.ATTRIBUTE_NAMES);h.fromSVG=!0,l(new t.Path(h.d,n(h,c)))}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max;if(t.Group)return;t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,o,s){o=o||{},this._objects=[],s&&this.callSuper("initialize",o),this._objects=n||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;if(s)this._updateObjectsACoords();else{var l=o&&o.centerPoint;o.originX!==void 0&&(this.originX=o.originX),o.originY!==void 0&&(this.originY=o.originY),l||this._calcBounds(),this._updateObjectsCoords(l),delete o.centerPoint,this.callSuper("initialize",o)}this.setCoords()},_updateObjectsACoords:function(){for(var n=!0,o=this._objects.length;o--;)this._objects[o].setCoords(n)},_updateObjectsCoords:function(n){for(var n=n||this.getCenterPoint(),o=this._objects.length;o--;)this._updateObjectCoords(this._objects[o],n)},_updateObjectCoords:function(n,o){var s=n.left,a=n.top,l=!0;n.set({left:s-o.x,top:a-o.y}),n.group=this,n.setCoords(l)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),n&&(this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,o){var s=this._objects.length;if(this.useSetOnGroup)for(;s--;)this._objects[s].setOnGroup(n,o);if(n==="canvas")for(;s--;)this._objects[s]._set(n,o);t.Object.prototype._set.call(this,n,o)},toObject:function(n){var o=this.includeDefaultValues,s=this._objects.map(function(l){var c=l.includeDefaultValues;l.includeDefaultValues=o;var h=l.toObject(n);return l.includeDefaultValues=c,h}),a=t.Object.prototype.toObject.call(this,n);return a.objects=s,a},toDatalessObject:function(n){var o,s=this.sourcePath;if(s)o=s;else{var a=this.includeDefaultValues;o=this._objects.map(function(c){var h=c.includeDefaultValues;c.includeDefaultValues=a;var u=c.toDatalessObject(n);return c.includeDefaultValues=h,u})}var l=t.Object.prototype.toDatalessObject.call(this,n);return l.objects=o,l},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=t.Object.prototype.shouldCache.call(this);if(n){for(var o=0,s=this._objects.length;o<s;o++)if(this._objects[o].willDrawShadow())return this.ownCaching=!1,!1}return n},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,o=this._objects.length;n<o;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var o=0,s=this._objects.length;o<s;o++)this._objects[o].render(n);this._drawClipPath(n)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var o=0,s=this._objects.length;o<s;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var a=this.cacheWidth/this.zoomX,l=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-l/2,a,l)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(n){var o=n.calcTransformMatrix(),s=t.util.qrDecompose(o),a=new t.Point(s.translateX,s.translateY);return n.flipX=!1,n.flipY=!1,n.set("scaleX",s.scaleX),n.set("scaleY",s.scaleY),n.skewX=s.skewX,n.skewY=s.skewY,n.angle=s.angle,n.setPositionByOrigin(a,"center","center"),n},_restoreObjectState:function(n){return this.realizeTransform(n),delete n.group,n.setCoords(),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(!this.canvas)return;var n=this._objects,o=this.canvas;this._objects=[];var s=this.toObject();delete s.objects;var a=new t.ActiveSelection([]);return a.set(s),a.type="activeSelection",o.remove(this),n.forEach(function(l){l.group=a,l.dirty=!0,o.add(l)}),a.canvas=o,a._objects=n,o._activeObject=a,a.setCoords(),a},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0;return this.forEachObject(function(o){o.setCoords(n)}),this},_calcBounds:function(n){for(var o=[],s=[],a,l,c=["tr","br","bl","tl"],h=0,u=this._objects.length,f,p=c.length;h<u;++h)for(a=this._objects[h],a.aCoords=a.calcACoords(),f=0;f<p;f++)l=c[f],o.push(a.aCoords[l].x),s.push(a.aCoords[l].y);this._getBounds(o,s,n)},_getBounds:function(n,o,s){var a=new t.Point(r(n),r(o)),l=new t.Point(i(n),i(o)),c=a.y||0,h=a.x||0,u=l.x-a.x||0,f=l.y-a.y||0;this.width=u,this.height=f,s||this.setPositionByOrigin({x:h,y:c},"left","top")},_toSVG:function(n){for(var o=["<g ","COMMON_PARTS",` >
`],s=0,a=this._objects.length;s<a;s++)o.push("		",this._objects[s].toSVG(n));return o.push(`</g>
`),o},getSvgStyles:function(){var n=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",o=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),o].join("")},toClipPathSVG:function(n){for(var o=[],s=0,a=this._objects.length;s<a;s++)o.push("	",this._objects[s].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(o,{reviver:n})}}),t.Group.fromObject=function(n,o){var s=n.objects,a=t.util.object.clone(n,!0);if(delete a.objects,typeof s=="string"){t.loadSVGFromURL(s,function(l){var c=t.util.groupSVGElements(l,n,s);c.set(a),o&&o(c)});return}t.util.enlivenObjects(s,function(l){t.util.enlivenObjects([n.clipPath],function(c){var h=t.util.object.clone(n,!0);h.clipPath=c[0],delete h.objects,o&&o(new t.Group(l,h,!0))})})}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.ActiveSelection)return;t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(r,i){i=i||{},this._objects=r||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var r=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete i.type,n.set(i),r.forEach(function(s){s.canvas.remove(s),s.group=n}),n._objects=r,!this.canvas)return n;var o=this.canvas;return o.add(n),o._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(r,i,n){r.save(),r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",r,i),n=n||{},typeof n.hasControls=="undefined"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var o=0,s=this._objects.length;o<s;o++)this._objects[o]._renderControls(r,n);r.restore()}}),t.ActiveSelection.fromObject=function(r,i){t.util.enlivenObjects(r.objects,function(n){delete r.objects,i&&i(new t.ActiveSelection(n,r,!0))})}})((typeof L!="undefined",L));(function(e){"use strict";var t=d.util.object.extend;if(e.fabric||(e.fabric={}),e.fabric.Image){d.warn("fabric.Image is already defined.");return}d.Image=d.util.createClass(d.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:d.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(r,i){i||(i={}),this.filters=[],this.cacheKey="texture"+d.Object.__uid++,this.callSuper("initialize",i),this._initElement(r,i)},getElement:function(){return this._element||{}},setElement:function(r,i){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=r,this._originalElement=r,this._initConfig(i),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(r){var i=d.filterBackend;i&&i.evictCachesForKey&&i.evictCachesForKey(r)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(r){d.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var r=this.getElement();return{width:r.naturalWidth||r.width,height:r.naturalHeight||r.height}},_stroke:function(r){if(!this.stroke||this.strokeWidth===0)return;var i=this.width/2,n=this.height/2;r.beginPath(),r.moveTo(-i,-n),r.lineTo(i,-n),r.lineTo(i,n),r.lineTo(-i,n),r.lineTo(-i,-n),r.closePath()},_renderDashedStroke:function(r){var i=-this.width/2,n=-this.height/2,o=this.width,s=this.height;r.save(),this._setStrokeStyles(r,this),r.beginPath(),d.util.drawDashedLine(r,i,n,i+o,n,this.strokeDashArray),d.util.drawDashedLine(r,i+o,n,i+o,n+s,this.strokeDashArray),d.util.drawDashedLine(r,i+o,n+s,i,n+s,this.strokeDashArray),d.util.drawDashedLine(r,i,n+s,i,n,this.strokeDashArray),r.closePath(),r.restore()},toObject:function(r){var i=[];this.filters.forEach(function(o){o&&i.push(o.toObject())});var n=t(this.callSuper("toObject",["cropX","cropY"].concat(r)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var r=[],i=[],n,o=this._element,s=-this.width/2,a=-this.height/2,l="",c="";if(!o)return[];if(this.hasCrop()){var h=d.Object.__uid++;r.push('<clipPath id="imageCrop_'+h+`">
`,'	<rect x="'+s+'" y="'+a+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),l=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(c='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',a-this.cropY,'" width="',o.width||o.naturalWidth,'" height="',o.height||o.height,c,'"',l,`></image>
`),this.stroke||this.strokeDashArray){var u=this.fill;this.fill=null,n=["	<rect ",'x="',s,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=u}return this.paintFirst!=="fill"?r=r.concat(n,i):r=r.concat(i,n),r},getSrc:function(r){var i=r?this._element:this._originalElement;return i?i.toDataURL?i.toDataURL():this.srcFromAttribute?i.getAttribute("src"):i.src:this.src||""},setSrc:function(r,i,n){return d.util.loadImage(r,function(o,s){this.setElement(o,n),this._setWidthHeight(),i&&i(this,s)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var r=this.resizeFilter,i=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),o=n.scaleX,s=n.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!r||o>i&&s>i){this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,this._lastScaleY=s;return}d.filterBackend||(d.filterBackend=d.initFilterBackend());var l=d.util.createCanvasElement(),c=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,h=a.width,u=a.height;l.width=h,l.height=u,this._element=l,this._lastScaleX=r.scaleX=o,this._lastScaleY=r.scaleY=s,d.filterBackend.applyFilters([r],a,h,u,this._element,c),this._filterScalingX=l.width/this._originalElement.width,this._filterScalingY=l.height/this._originalElement.height},applyFilters:function(r){if(r=r||this.filters||[],r=r.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),r.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var i=this._originalElement,n=i.naturalWidth||i.width,o=i.naturalHeight||i.height;if(this._element===this._originalElement){var s=d.util.createCanvasElement();s.width=n,s.height=o,this._element=s,this._filteredEl=s}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,o),this._lastScaleX=1,this._lastScaleY=1;return d.filterBackend||(d.filterBackend=d.initFilterBackend()),d.filterBackend.applyFilters(r,this._originalElement,n,o,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(r){d.util.setImageSmoothing(r,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(r),this._renderPaintInOrder(r)},drawCacheOnCanvas:function(r){d.util.setImageSmoothing(r,this.imageSmoothing),d.Object.prototype.drawCacheOnCanvas.call(this,r)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(r){var i=this._element;if(!i)return;var n=this._filterScalingX,o=this._filterScalingY,s=this.width,a=this.height,l=Math.min,c=Math.max,h=c(this.cropX,0),u=c(this.cropY,0),f=i.naturalWidth||i.width,p=i.naturalHeight||i.height,m=h*n,g=u*o,S=l(s*n,f-m),C=l(a*o,p-g),k=-s/2,W=-a/2,J=l(s,f/n-h),$=l(a,p/n-u);i&&r.drawImage(i,m,g,S,C,k,W,J,$)},_needsResize:function(){var r=this.getTotalObjectScaling();return r.scaleX!==this._lastScaleX||r.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(r,i){this.setElement(d.util.getById(r),i),d.util.addClass(this.getElement(),d.Image.CSS_CANVAS)},_initConfig:function(r){r||(r={}),this.setOptions(r),this._setWidthHeight(r)},_initFilters:function(r,i){r&&r.length?d.util.enlivenObjects(r,function(n){i&&i(n)},"fabric.Image.filters"):i&&i()},_setWidthHeight:function(r){r||(r={});var i=this.getElement();this.width=r.width||i.naturalWidth||i.width||0,this.height=r.height||i.naturalHeight||i.height||0},parsePreserveAspectRatioAttribute:function(){var r=d.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,o=1,s=1,a=0,l=0,c=0,h=0,u,f=this.width,p=this.height,m={width:f,height:p};return r&&(r.alignX!=="none"||r.alignY!=="none")?(r.meetOrSlice==="meet"&&(o=s=d.util.findScaleToFit(this._element,m),u=(f-i*o)/2,r.alignX==="Min"&&(a=-u),r.alignX==="Max"&&(a=u),u=(p-n*s)/2,r.alignY==="Min"&&(l=-u),r.alignY==="Max"&&(l=u)),r.meetOrSlice==="slice"&&(o=s=d.util.findScaleToCover(this._element,m),u=i-f/o,r.alignX==="Mid"&&(c=u/2),r.alignX==="Max"&&(c=u),u=n-p/s,r.alignY==="Mid"&&(h=u/2),r.alignY==="Max"&&(h=u),i=f/o,n=p/s)):(o=f/i,s=p/n),{width:i,height:n,scaleX:o,scaleY:s,offsetLeft:a,offsetTop:l,cropX:c,cropY:h}}}),d.Image.CSS_CANVAS="canvas-img",d.Image.prototype.getSvgSrc=d.Image.prototype.getSrc,d.Image.fromObject=function(r,i){var n=d.util.object.clone(r);d.util.loadImage(n.src,function(o,s){if(s){i&&i(null,!0);return}d.Image.prototype._initFilters.call(n,n.filters,function(a){n.filters=a||[],d.Image.prototype._initFilters.call(n,[n.resizeFilter],function(l){n.resizeFilter=l[0],d.util.enlivenObjects([n.clipPath],function(c){n.clipPath=c[0];var h=new d.Image(o,n);i(h,!1)})})})},null,n.crossOrigin)},d.Image.fromURL=function(r,i,n){d.util.loadImage(r,function(o,s){i&&i(new d.Image(o,n),s)},null,n&&n.crossOrigin)},d.Image.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),d.Image.fromElement=function(r,i,n){var o=d.parseAttributes(r,d.Image.ATTRIBUTE_NAMES);d.Image.fromURL(o["xlink:href"],i,t(n?d.util.object.clone(n):{},o))}})((typeof L!="undefined",L));d.util.object.extend(d.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?Math.round((e-1)/90)*90:Math.round(e/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},r=e.onComplete||t,i=e.onChange||t,n=this;return d.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){n.rotate(o),i()},onComplete:function(){n.setCoords(),r()}}),this}});d.util.object.extend(d.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}});(function(){"use strict";function e(r,i){var n="precision "+i+` float;
void main(){}`,o=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(o,n),r.compileShader(o),!!r.getShaderParameter(o,r.COMPILE_STATUS)}d.isWebglSupported=function(r){if(d.isLikelyNode)return!1;r=r||d.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),o=!1;if(n){d.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),o=d.maxTextureSize>=r;for(var s=["highp","mediump","lowp"],a=0;a<3;a++)if(e(n,s[a])){d.webGlPrecision=s[a];break}}return this.isSupported=o,o},d.WebglFilterBackend=t;function t(r){r&&r.tileSize&&(this.tileSize=r.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}t.prototype={tileSize:2048,resources:{},setupGLContext:function(r,i){this.dispose(),this.createWebGLCanvas(r,i),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(r,i)},chooseFastestCopyGLTo2DMethod:function(r,i){var n=typeof window.performance!="undefined",o;try{new ImageData(1,1),o=!0}catch(m){o=!1}var s=typeof ArrayBuffer!="undefined",a=typeof Uint8ClampedArray!="undefined";if(!(n&&o&&s&&a))return;var l=d.util.createCanvasElement(),c=new ArrayBuffer(r*i*4);if(d.forceGLPutImageData){this.imageBuffer=c,this.copyGLTo2D=Rt;return}var h={imageBuffer:c,destinationWidth:r,destinationHeight:i,targetCanvas:l},u,f,p;l.width=r,l.height=i,u=window.performance.now(),Ot.call(h,this.gl,h),f=window.performance.now()-u,u=window.performance.now(),Rt.call(h,this.gl,h),p=window.performance.now()-u,f>p?(this.imageBuffer=c,this.copyGLTo2D=Rt):this.copyGLTo2D=Ot},createWebGLCanvas:function(r,i){var n=d.util.createCanvasElement();n.width=r,n.height=i;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},s=n.getContext("webgl",o);if(s||(s=n.getContext("experimental-webgl",o)),!s)return;s.clearColor(0,0,0,0),this.canvas=n,this.gl=s},applyFilters:function(r,i,n,o,s,a){var l=this.gl,c;a&&(c=this.getCachedTexture(a,i));var h={originalWidth:i.width||i.originalWidth,originalHeight:i.height||i.originalHeight,sourceWidth:n,sourceHeight:o,destinationWidth:n,destinationHeight:o,context:l,sourceTexture:this.createTexture(l,n,o,!c&&i),targetTexture:this.createTexture(l,n,o),originalTexture:c||this.createTexture(l,n,o,!c&&i),passes:r.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},u=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,u),r.forEach(function(f){f&&f.applyTo(h)}),Ci(h),this.copyGLTo2D(l,h),l.bindTexture(l.TEXTURE_2D,null),l.deleteTexture(h.sourceTexture),l.deleteTexture(h.targetTexture),l.deleteFramebuffer(u),s.getContext("2d").setTransform(1,0,0,1,0,0),h},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(r,i,n,o){var s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i,n,0,r.RGBA,r.UNSIGNED_BYTE,null),s},getCachedTexture:function(r,i){if(this.textureCache[r])return this.textureCache[r];var n=this.createTexture(this.gl,i.width,i.height,i);return this.textureCache[r]=n,n},evictCachesForKey:function(r){this.textureCache[r]&&(this.gl.deleteTexture(this.textureCache[r]),delete this.textureCache[r])},copyGLTo2D:Ot,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var r=this.gl,i={renderer:"",vendor:""};if(!r)return i;var n=r.getExtension("WEBGL_debug_renderer_info");if(n){var o=r.getParameter(n.UNMASKED_RENDERER_WEBGL),s=r.getParameter(n.UNMASKED_VENDOR_WEBGL);o&&(i.renderer=o.toLowerCase()),s&&(i.vendor=s.toLowerCase())}return this.gpuInfo=i,i}}})();function Ci(e){var t=e.targetCanvas,r=t.width,i=t.height,n=e.destinationWidth,o=e.destinationHeight;(r!==n||i!==o)&&(t.width=n,t.height=o)}function Ot(e,t){var r=e.canvas,i=t.targetCanvas,n=i.getContext("2d");n.translate(0,i.height),n.scale(1,-1);var o=r.height-i.height;n.drawImage(r,0,o,i.width,i.height,0,0,i.width,i.height)}function Rt(e,t){var r=t.targetCanvas,i=r.getContext("2d"),n=t.destinationWidth,o=t.destinationHeight,s=n*o*4,a=new Uint8Array(this.imageBuffer,0,s),l=new Uint8ClampedArray(this.imageBuffer,0,s);e.readPixels(0,0,n,o,e.RGBA,e.UNSIGNED_BYTE,a);var c=new ImageData(l,n,o);i.putImageData(c,0,0)}(function(){"use strict";var e=function(){};d.Canvas2dFilterBackend=t;function t(){}t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(r,i,n,o,s){var a=s.getContext("2d");a.drawImage(i,0,0,n,o);var l=a.getImageData(0,0,n,o),c=a.getImageData(0,0,n,o),h={sourceWidth:n,sourceHeight:o,imageData:l,originalEl:i,originalImageData:c,canvasEl:s,ctx:a,filterBackend:this};return r.forEach(function(u){u.applyTo(h)}),(h.imageData.width!==n||h.imageData.height!==o)&&(s.width=h.imageData.width,s.height=h.imageData.height),a.putImageData(h.imageData,0,0),h}}})();d.Image=d.Image||{};d.Image.filters=d.Image.filters||{};d.Image.filters.BaseFilter=d.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,r){t=t||this.fragmentSource,r=r||this.vertexSource,d.webGlPrecision!=="highp"&&(t=t.replace(/precision highp float/g,"precision "+d.webGlPrecision+" float"));var i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(i));var n=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var o=e.createProgram();if(e.attachShader(o,i),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(o));var s=this.getAttributeLocations(e,o),a=this.getUniformLocations(e,o)||{};return a.uStepW=e.getUniformLocation(o,"uStepW"),a.uStepH=e.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:s,uniformLocations:a}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,r){var i=t.aPosition,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t=e.context,r,i;e.passes>1?(r=e.destinationWidth,i=e.destinationHeight,(e.sourceWidth!==r||e.sourceHeight!==i)&&(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,r,i)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=d.Image.filters[this.type].prototype;if(e)if(Array.isArray(t[e])){for(var r=t[e].length;r--;)if(this[e][r]!==t[e][r])return!1;return!0}else return t[e]===this[e];else return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,r=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(r.program),this.sendAttributeData(t,r.attributeLocations,e.aPosition),t.uniform1f(r.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(r.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,r.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,r){e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}});d.Image.filters.BaseFilter.fromObject=function(e,t){var r=new d.Image.filters[e.type](e);return t&&t(r),r};(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.ColorMatrix=i(r.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var o=n.imageData,s=o.data,a=s.length,l=this.matrix,c,h,u,f,p,m=this.colorsOnly;for(p=0;p<a;p+=4)c=s[p],h=s[p+1],u=s[p+2],m?(s[p]=c*l[0]+h*l[1]+u*l[2]+l[4]*255,s[p+1]=c*l[5]+h*l[6]+u*l[7]+l[9]*255,s[p+2]=c*l[10]+h*l[11]+u*l[12]+l[14]*255):(f=s[p+3],s[p]=c*l[0]+h*l[1]+u*l[2]+f*l[3]+l[4]*255,s[p+1]=c*l[5]+h*l[6]+u*l[7]+f*l[8]+l[9]*255,s[p+2]=c*l[10]+h*l[11]+u*l[12]+f*l[13]+l[14]*255,s[p+3]=c*l[15]+h*l[16]+u*l[17]+f*l[18]+l[19]*255)},getUniformLocations:function(n,o){return{uColorMatrix:n.getUniformLocation(o,"uColorMatrix"),uConstants:n.getUniformLocation(o,"uConstants")}},sendUniformData:function(n,o){var s=this.matrix,a=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],l=[s[4],s[9],s[14],s[19]];n.uniformMatrix4fv(o.uColorMatrix,!1,a),n.uniform4fv(o.uConstants,l)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Brightness=i(r.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(this.brightness===0)return;var o=n.imageData,s=o.data,a,l=s.length,c=Math.round(this.brightness*255);for(a=0;a<l;a+=4)s[a]=s[a]+c,s[a+1]=s[a+1]+c,s[a+2]=s[a+2]+c},getUniformLocations:function(n,o){return{uBrightness:n.getUniformLocation(o,"uBrightness")}},sendUniformData:function(n,o){n.uniform1f(o.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.Convolute=n(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(o){var s=Math.sqrt(this.matrix.length),a=this.type+"_"+s+"_"+(this.opaque?1:0),l=this.fragmentSource[a];return o.programCache.hasOwnProperty(a)||(o.programCache[a]=this.createProgram(o.context,l)),o.programCache[a]},applyTo2d:function(o){var s=o.imageData,a=s.data,l=this.matrix,c=Math.round(Math.sqrt(l.length)),h=Math.floor(c/2),u=s.width,f=s.height,p=o.ctx.createImageData(u,f),m=p.data,g=this.opaque?1:0,S,C,k,W,J,$,Q,q,K,A,N,j,b;for(N=0;N<f;N++)for(A=0;A<u;A++){for(J=(N*u+A)*4,S=0,C=0,k=0,W=0,b=0;b<c;b++)for(j=0;j<c;j++){if(Q=N+b-h,$=A+j-h,Q<0||Q>=f||$<0||$>=u)continue;q=(Q*u+$)*4,K=l[b*c+j],S+=a[q]*K,C+=a[q+1]*K,k+=a[q+2]*K,g||(W+=a[q+3]*K)}m[J]=S,m[J+1]=C,m[J+2]=k,g?m[J+3]=a[J+3]:m[J+3]=W}o.imageData=p},getUniformLocations:function(o,s){return{uMatrix:o.getUniformLocation(s,"uMatrix"),uOpaque:o.getUniformLocation(s,"uOpaque"),uHalfSize:o.getUniformLocation(s,"uHalfSize"),uSize:o.getUniformLocation(s,"uSize")}},sendUniformData:function(o,s){o.uniform1fv(s.uMatrix,this.matrix)},toObject:function(){return r(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Grayscale=i(r.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(n){var o=n.imageData,s=o.data,a,l=s.length,c,h=this.mode;for(a=0;a<l;a+=4)h==="average"?c=(s[a]+s[a+1]+s[a+2])/3:h==="lightness"?c=(Math.min(s[a],s[a+1],s[a+2])+Math.max(s[a],s[a+1],s[a+2]))/2:h==="luminosity"&&(c=.21*s[a]+.72*s[a+1]+.07*s[a+2]),s[a]=c,s[a+1]=c,s[a+2]=c},retrieveShader:function(n){var o=this.type+"_"+this.mode;if(!n.programCache.hasOwnProperty(o)){var s=this.fragmentSource[this.mode];n.programCache[o]=this.createProgram(n.context,s)}return n.programCache[o]},getUniformLocations:function(n,o){return{uMode:n.getUniformLocation(o,"uMode")}},sendUniformData:function(n,o){var s=1;n.uniform1i(o.uMode,s)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Invert=i(r.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(n){var o=n.imageData,s=o.data,a,l=s.length;for(a=0;a<l;a+=4)s[a]=255-s[a],s[a+1]=255-s[a+1],s[a+2]=255-s[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,o){return{uInvert:n.getUniformLocation(o,"uInvert")}},sendUniformData:function(n,o){n.uniform1i(o.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.Noise=n(i.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(o){if(this.noise===0)return;var s=o.imageData,a=s.data,l,c=a.length,h=this.noise,u;for(l=0,c=a.length;l<c;l+=4)u=(.5-Math.random())*h,a[l]+=u,a[l+1]+=u,a[l+2]+=u},getUniformLocations:function(o,s){return{uNoise:o.getUniformLocation(s,"uNoise"),uSeed:o.getUniformLocation(s,"uSeed")}},sendUniformData:function(o,s){o.uniform1f(s.uNoise,this.noise/255),o.uniform1f(s.uSeed,Math.random())},toObject:function(){return r(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Pixelate=i(r.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(n){var o=n.imageData,s=o.data,a=o.height,l=o.width,c,h,u,f,p,m,g,S,C,k,W;for(h=0;h<a;h+=this.blocksize)for(u=0;u<l;u+=this.blocksize)for(c=h*4*l+u*4,f=s[c],p=s[c+1],m=s[c+2],g=s[c+3],k=Math.min(h+this.blocksize,a),W=Math.min(u+this.blocksize,l),S=h;S<k;S++)for(C=u;C<W;C++)c=S*4*l+C*4,s[c]=f,s[c+1]=p,s[c+2]=m,s[c+3]=g},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(n,o){return{uBlocksize:n.getUniformLocation(o,"uBlocksize"),uStepW:n.getUniformLocation(o,"uStepW"),uStepH:n.getUniformLocation(o,"uStepH")}},sendUniformData:function(n,o){n.uniform1f(o.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.RemoveColor=n(i.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(o){var s=o.imageData,a=s.data,l,c=this.distance*255,h,u,f,p=new t.Color(this.color).getSource(),m=[p[0]-c,p[1]-c,p[2]-c],g=[p[0]+c,p[1]+c,p[2]+c];for(l=0;l<a.length;l+=4)h=a[l],u=a[l+1],f=a[l+2],h>m[0]&&u>m[1]&&f>m[2]&&h<g[0]&&u<g[1]&&f<g[2]&&(a[l+3]=0)},getUniformLocations:function(o,s){return{uLow:o.getUniformLocation(s,"uLow"),uHigh:o.getUniformLocation(s,"uHigh")}},sendUniformData:function(o,s){var a=new t.Color(this.color).getSource(),l=parseFloat(this.distance),c=[0+a[0]/255-l,0+a[1]/255-l,0+a[2]/255-l,1],h=[a[0]/255+l,a[1]/255+l,a[2]/255+l,1];o.uniform4fv(s.uLow,c),o.uniform4fv(s.uHigh,h)},toObject:function(){return r(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in n)r[o]=i(r.ColorMatrix,{type:o,matrix:n[o],mainParameter:!1,colorsOnly:!0}),t.Image.filters[o].fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendColor=i(r.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(n){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[n]+`}
}`},retrieveShader:function(n){var o=this.type+"_"+this.mode,s;return n.programCache.hasOwnProperty(o)||(s=this.buildSource(this.mode),n.programCache[o]=this.createProgram(n.context,s)),n.programCache[o]},applyTo2d:function(n){var o=n.imageData,s=o.data,a=s.length,l,c,h,u,f,p,m,g=1-this.alpha;m=new t.Color(this.color).getSource(),l=m[0]*this.alpha,c=m[1]*this.alpha,h=m[2]*this.alpha;for(var S=0;S<a;S+=4){u=s[S],f=s[S+1],p=s[S+2];switch(this.mode){case"multiply":s[S]=u*l/255,s[S+1]=f*c/255,s[S+2]=p*h/255;break;case"screen":s[S]=255-(255-u)*(255-l)/255,s[S+1]=255-(255-f)*(255-c)/255,s[S+2]=255-(255-p)*(255-h)/255;break;case"add":s[S]=u+l,s[S+1]=f+c,s[S+2]=p+h;break;case"diff":case"difference":s[S]=Math.abs(u-l),s[S+1]=Math.abs(f-c),s[S+2]=Math.abs(p-h);break;case"subtract":s[S]=u-l,s[S+1]=f-c,s[S+2]=p-h;break;case"darken":s[S]=Math.min(u,l),s[S+1]=Math.min(f,c),s[S+2]=Math.min(p,h);break;case"lighten":s[S]=Math.max(u,l),s[S+1]=Math.max(f,c),s[S+2]=Math.max(p,h);break;case"overlay":s[S]=l<128?2*u*l/255:255-2*(255-u)*(255-l)/255,s[S+1]=c<128?2*f*c/255:255-2*(255-f)*(255-c)/255,s[S+2]=h<128?2*p*h/255:255-2*(255-p)*(255-h)/255;break;case"exclusion":s[S]=l+u-2*l*u/255,s[S+1]=c+f-2*c*f/255,s[S+2]=h+p-2*h*p/255;break;case"tint":s[S]=l+u*g,s[S+1]=c+f*g,s[S+2]=h+p*g}}},getUniformLocations:function(n,o){return{uColor:n.getUniformLocation(o,"uColor")}},sendUniformData:function(n,o){var s=new t.Color(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,n.uniform4fv(o.uColor,s)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendImage=i(r.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(n){var o=this.type+"_"+this.mode,s=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(o)||(n.programCache[o]=this.createProgram(n.context,s)),n.programCache[o]},applyToWebGL:function(n){var o=n.context,s=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(o,s,o.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(o,o.TEXTURE1)},createTexture:function(n,o){return n.getCachedTexture(o.cacheKey,o._element)},calculateMatrix:function(){var n=this.image,o=n._element.width,s=n._element.height;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/o,-n.top/s,1]},applyTo2d:function(n){var o=n.imageData,s=n.filterBackend.resources,a=o.data,l=a.length,c=o.width,h=o.height,u,f,p,m,g,S,C,k,W,J,$=this.image,Q;s.blendImage||(s.blendImage=t.util.createCanvasElement()),W=s.blendImage,J=W.getContext("2d"),W.width!==c||W.height!==h?(W.width=c,W.height=h):J.clearRect(0,0,c,h),J.setTransform($.scaleX,0,0,$.scaleY,$.left,$.top),J.drawImage($._element,0,0,c,h),Q=J.getImageData(0,0,c,h).data;for(var q=0;q<l;q+=4){g=a[q],S=a[q+1],C=a[q+2],k=a[q+3],u=Q[q],f=Q[q+1],p=Q[q+2],m=Q[q+3];switch(this.mode){case"multiply":a[q]=g*u/255,a[q+1]=S*f/255,a[q+2]=C*p/255,a[q+3]=k*m/255;break;case"mask":a[q+3]=m;break}}},getUniformLocations:function(n,o){return{uTransformMatrix:n.getUniformLocation(o,"uTransformMatrix"),uImage:n.getUniformLocation(o,"uImage")}},sendUniformData:function(n,o){var s=this.calculateMatrix();n.uniform1i(o.uImage,1),n.uniformMatrix3fv(o.uTransformMatrix,!1,s)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(n,o){t.Image.fromObject(n.image,function(s){var a=t.util.object.clone(n);a.image=s,o(new t.Image.filters.BlendImage(a))})}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.pow,i=Math.floor,n=Math.sqrt,o=Math.abs,s=Math.round,a=Math.sin,l=Math.ceil,c=t.Image.filters,h=t.util.createClass;c.Resize=h(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(u,f){return{uDelta:u.getUniformLocation(f,"uDelta"),uTaps:u.getUniformLocation(f,"uTaps")}},sendUniformData:function(u,f){u.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),u.uniform1fv(f.uTaps,this.taps)},retrieveShader:function(u){var f=this.getFilterWindow(),p=this.type+"_"+f;if(!u.programCache.hasOwnProperty(p)){var m=this.generateShader(f);u.programCache[p]=this.createProgram(u.context,m)}return u.programCache[p]},getFilterWindow:function(){var u=this.tempScale;return Math.ceil(this.lanczosLobes/u)},getTaps:function(){for(var u=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,p=this.getFilterWindow(),m=new Array(p),g=1;g<=p;g++)m[g-1]=u(g*f);return m},generateShader:function(u){for(var f=new Array(u),p=this.fragmentSourceTOP,u,m=1;m<=u;m++)f[m-1]=m+".0 * uDelta";return p+="uniform float uTaps["+u+`];
`,p+=`void main() {
`,p+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,p+=`  float sum = 1.0;
`,f.forEach(function(g,S){p+="  color += texture2D(uTexture, vTexCoord + "+g+") * uTaps["+S+`];
`,p+="  color += texture2D(uTexture, vTexCoord - "+g+") * uTaps["+S+`];
`,p+="  sum += 2.0 * uTaps["+S+`];
`}),p+=`  gl_FragColor = color / sum;
`,p+="}",p},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(u){u.webgl?(u.passes++,this.width=u.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=u.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),u.destinationWidth=this.dW,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceWidth=u.destinationWidth,this.height=u.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),u.destinationHeight=this.dH,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceHeight=u.destinationHeight):this.applyTo2d(u)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(u){return function(f){if(f>=u||f<=-u)return 0;if(f<11920929e-14&&f>-11920929e-14)return 1;f*=Math.PI;var p=f/u;return a(f)/f*a(p)/p}},applyTo2d:function(u){var f=u.imageData,p=this.scaleX,m=this.scaleY;this.rcpScaleX=1/p,this.rcpScaleY=1/m;var g=f.width,S=f.height,C=s(g*p),k=s(S*m),W;this.resizeType==="sliceHack"?W=this.sliceByTwo(u,g,S,C,k):this.resizeType==="hermite"?W=this.hermiteFastResize(u,g,S,C,k):this.resizeType==="bilinear"?W=this.bilinearFiltering(u,g,S,C,k):this.resizeType==="lanczos"&&(W=this.lanczosResize(u,g,S,C,k)),u.imageData=W},sliceByTwo:function(u,f,p,m,g){var S=u.imageData,C=.5,k=!1,W=!1,J=f*C,$=p*C,Q=t.filterBackend.resources,q,K,A=0,N=0,j=f,b=0;for(Q.sliceByTwo||(Q.sliceByTwo=document.createElement("canvas")),q=Q.sliceByTwo,(q.width<f*1.5||q.height<p)&&(q.width=f*1.5,q.height=p),K=q.getContext("2d"),K.clearRect(0,0,f*1.5,p),K.putImageData(S,0,0),m=i(m),g=i(g);!k||!W;)f=J,p=$,m<i(J*C)?J=i(J*C):(J=m,k=!0),g<i($*C)?$=i($*C):($=g,W=!0),K.drawImage(q,A,N,f,p,j,b,J,$),A=j,N=b,b+=$;return K.getImageData(A,N,m,g)},lanczosResize:function(u,f,p,m,g){function S(D){var T,U,y,_,x,O,B,P,G,V,R;for(b.x=(D+.5)*$,E.x=i(b.x),T=0;T<g;T++){for(b.y=(T+.5)*Q,E.y=i(b.y),x=0,O=0,B=0,P=0,G=0,U=E.x-A;U<=E.x+A;U++){if(U<0||U>=f)continue;V=i(1e3*o(U-b.x)),j[V]||(j[V]={});for(var w=E.y-N;w<=E.y+N;w++){if(w<0||w>=p)continue;R=i(1e3*o(w-b.y)),j[V][R]||(j[V][R]=J(n(r(V*q,2)+r(R*K,2))/1e3)),y=j[V][R],y>0&&(_=(w*f+U)*4,x+=y,O+=y*C[_],B+=y*C[_+1],P+=y*C[_+2],G+=y*C[_+3])}}_=(T*m+D)*4,W[_]=O/x,W[_+1]=B/x,W[_+2]=P/x,W[_+3]=G/x}return++D<m?S(D):k}var C=u.imageData.data,k=u.ctx.createImageData(m,g),W=k.data,J=this.lanczosCreate(this.lanczosLobes),$=this.rcpScaleX,Q=this.rcpScaleY,q=2/this.rcpScaleX,K=2/this.rcpScaleY,A=l($*this.lanczosLobes/2),N=l(Q*this.lanczosLobes/2),j={},b={},E={};return S(0)},bilinearFiltering:function(u,f,p,m,g){var S,C,k,W,J,$,Q,q,K,A,N,j,b=0,E,D=this.rcpScaleX,T=this.rcpScaleY,U=4*(f-1),y=u.imageData,_=y.data,x=u.ctx.createImageData(m,g),O=x.data;for(Q=0;Q<g;Q++)for(q=0;q<m;q++)for(J=i(D*q),$=i(T*Q),K=D*q-J,A=T*Q-$,E=4*($*f+J),N=0;N<4;N++)S=_[E+N],C=_[E+4+N],k=_[E+U+N],W=_[E+U+4+N],j=S*(1-K)*(1-A)+C*K*(1-A)+k*A*(1-K)+W*K*A,O[b++]=j;return x},hermiteFastResize:function(u,f,p,m,g){for(var S=this.rcpScaleX,C=this.rcpScaleY,k=l(S/2),W=l(C/2),J=u.imageData,$=J.data,Q=u.ctx.createImageData(m,g),q=Q.data,K=0;K<g;K++)for(var A=0;A<m;A++){for(var N=(A+K*m)*4,j=0,b=0,E=0,D=0,T=0,U=0,y=0,_=(K+.5)*C,x=i(K*C);x<(K+1)*C;x++)for(var O=o(_-(x+.5))/W,B=(A+.5)*S,P=O*O,G=i(A*S);G<(A+1)*S;G++){var V=o(B-(G+.5))/k,R=n(P+V*V);if(R>1&&R<-1)continue;j=2*R*R*R-3*R*R+1,j>0&&(V=4*(G+x*f),y+=j*$[V+3],E+=j,$[V+3]<255&&(j=j*$[V+3]/250),D+=j*$[V],T+=j*$[V+1],U+=j*$[V+2],b+=j)}q[N]=D/b,q[N+1]=T/b,q[N+2]=U/b,q[N+3]=y/E}return Q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Contrast=i(r.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(this.contrast===0)return;var o=n.imageData,s,a,l=o.data,a=l.length,c=Math.floor(this.contrast*255),h=259*(c+255)/(255*(259-c));for(s=0;s<a;s+=4)l[s]=h*(l[s]-128)+128,l[s+1]=h*(l[s+1]-128)+128,l[s+2]=h*(l[s+2]-128)+128},getUniformLocations:function(n,o){return{uContrast:n.getUniformLocation(o,"uContrast")}},sendUniformData:function(n,o){n.uniform1f(o.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Saturation=i(r.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(this.saturation===0)return;var o=n.imageData,s=o.data,a=s.length,l=-this.saturation,c,h;for(c=0;c<a;c+=4)h=Math.max(s[c],s[c+1],s[c+2]),s[c]+=h!==s[c]?(h-s[c])*l:0,s[c+1]+=h!==s[c+1]?(h-s[c+1])*l:0,s[c+2]+=h!==s[c+2]?(h-s[c+2])*l:0},getUniformLocations:function(n,o){return{uSaturation:n.getUniformLocation(o,"uSaturation")}},sendUniformData:function(n,o){n.uniform1f(o.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Blur=i(r.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var o=n.filterBackend.resources,s,a,l=n.imageData.width,c=n.imageData.height;o.blurLayer1||(o.blurLayer1=t.util.createCanvasElement(),o.blurLayer2=t.util.createCanvasElement()),s=o.blurLayer1,a=o.blurLayer2,(s.width!==l||s.height!==c)&&(a.width=s.width=l,a.height=s.height=c);var h=s.getContext("2d"),u=a.getContext("2d"),f=15,p,m,g,S,C=this.blur*.06*.5;for(h.putImageData(n.imageData,0,0),u.clearRect(0,0,l,c),S=-f;S<=f;S++)p=(Math.random()-.5)/4,m=S/f,g=C*m*l+p,u.globalAlpha=1-Math.abs(m),u.drawImage(s,g,p),h.drawImage(a,0,0),u.globalAlpha=1,u.clearRect(0,0,a.width,a.height);for(S=-f;S<=f;S++)p=(Math.random()-.5)/4,m=S/f,g=C*m*c+p,u.globalAlpha=1-Math.abs(m),u.drawImage(s,p,g),h.drawImage(a,0,0),u.globalAlpha=1,u.clearRect(0,0,a.width,a.height);n.ctx.drawImage(s,0,0);var k=n.ctx.getImageData(0,0,s.width,s.height);return h.globalAlpha=1,h.clearRect(0,0,s.width,s.height),k},getUniformLocations:function(n,o){return{delta:n.getUniformLocation(o,"uDelta")}},sendUniformData:function(n,o){var s=this.chooseRightDelta();n.uniform2fv(o.delta,s)},chooseRightDelta:function(){var n=1,o=[0,0],s;return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),s=n*this.blur*.12,this.horizontal?o[0]=s:o[1]=s,o}}),r.Blur.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Gamma=i(r.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],r.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var o=n.imageData,s=o.data,a=this.gamma,l=s.length,c=1/a[0],h=1/a[1],u=1/a[2],f;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),f=0,l=256;f<l;f++)this.rVals[f]=Math.pow(f/255,c)*255,this.gVals[f]=Math.pow(f/255,h)*255,this.bVals[f]=Math.pow(f/255,u)*255;for(f=0,l=s.length;f<l;f+=4)s[f]=this.rVals[s[f]],s[f+1]=this.gVals[s[f+1]],s[f+2]=this.bVals[s[f+2]]},getUniformLocations:function(n,o){return{uGamma:n.getUniformLocation(o,"uGamma")}},sendUniformData:function(n,o){n.uniform3fv(o.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Composed=i(r.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(o){o.applyTo(n)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(n,o){var s=n.subFilters||[],a=s.map(function(c){return new t.Image.filters[c.type](c)}),l=new t.Image.filters.Composed({subFilters:a});return o&&o(l),l}})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.HueRotation=i(r.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,o=t.util.cos(n),s=t.util.sin(n),a=1/3,l=Math.sqrt(a)*s,c=1-o;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=o+c/3,this.matrix[1]=a*c-l,this.matrix[2]=a*c+l,this.matrix[5]=a*c+l,this.matrix[6]=o+a*c,this.matrix[7]=a*c-l,this.matrix[10]=a*c-l,this.matrix[11]=a*c+l,this.matrix[12]=o+a*c},isNeutralState:function(n){return this.calculateMatrix(),r.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),r.BaseFilter.prototype.applyTo.call(this,n)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof L!="undefined",L));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.clone;if(t.Text){t.warn("fabric.Text is already defined");return}t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,n){this.styles=n?n.styles||{}:{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",n),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){if(this.__skipDimension)return;this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},enlargeSpaces:function(){for(var i,n,o,s,a,l,c,h=0,u=this._textLines.length;h<u;h++){if(this.textAlign!=="justify"&&(h===u-1||this.isEndOfWrapping(h)))continue;if(s=0,a=this._textLines[h],n=this.getLineWidth(h),n<this.width&&(c=this.textLines[h].match(this._reSpacesAndTabs))){o=c.length,i=(this.width-n)/o;for(var f=0,p=a.length;f<=p;f++)l=this.__charBounds[h][f],this._reSpaceAndTab.test(a[f])?(l.width+=i,l.kernedWidth+=i,l.left+=s,s+=i):l.left+=s}}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return i.width+=n*i.zoomX,i.height+=n*i.zoomY,i},_render:function(i){this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,n,o){i.textBaseline="alphabetic",i.font=this._getFontDeclaration(n,o)},calcTextWidth:function(){for(var i=this.getLineWidth(0),n=1,o=this._textLines.length;n<o;n++){var s=this.getLineWidth(n);s>i&&(i=s)}return i},_renderTextLine:function(i,n,o,s,a,l){this._renderChars(i,n,o,s,a,l)},_renderTextLinesBackground:function(i){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;for(var n=0,o,s,a=i.fillStyle,l,c,h=this._getLeftOffset(),u=this._getTopOffset(),f=0,p=0,m,g,S=0,C=this._textLines.length;S<C;S++){if(o=this.getHeightOfLine(S),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",S)){n+=o;continue}l=this._textLines[S],s=this._getLineLeftOffset(S),p=0,f=0,c=this.getValueOfPropertyAt(S,0,"textBackgroundColor");for(var k=0,W=l.length;k<W;k++)m=this.__charBounds[S][k],g=this.getValueOfPropertyAt(S,k,"textBackgroundColor"),g!==c?(i.fillStyle=c,c&&i.fillRect(h+s+f,u+n,p,o/this.lineHeight),f=m.left,p=m.width,c=g):p+=m.kernedWidth;g&&(i.fillStyle=g,i.fillRect(h+s+f,u+n,p,o/this.lineHeight)),n+=o}i.fillStyle=a,this._removeShadow(i)},getFontCache:function(i){var n=i.fontFamily.toLowerCase();t.charWidthsCache[n]||(t.charWidthsCache[n]={});var o=t.charWidthsCache[n],s=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return o[s]||(o[s]={}),o[s]},_applyCharStyles:function(i,n,o,s,a){this._setFillStyles(n,a),this._setStrokeStyles(n,a),n.font=this._getFontDeclaration(a)},_measureChar:function(i,n,o,s){var a=this.getFontCache(n),l=this._getFontDeclaration(n),c=this._getFontDeclaration(s),h=o+i,u=l===c,f,p,m,g=n.fontSize/this.CACHE_FONT_SIZE,S;if(o&&a[o]!==void 0&&(m=a[o]),a[i]!==void 0&&(S=f=a[i]),u&&a[h]!==void 0&&(p=a[h],S=p-m),f===void 0||m===void 0||p===void 0){var C=this.getMeasuringContext();this._setTextStyles(C,n,!0)}return f===void 0&&(S=f=C.measureText(i).width,a[i]=f),m===void 0&&u&&o&&(m=C.measureText(o).width,a[o]=m),u&&p===void 0&&(p=C.measureText(h).width,a[h]=p,S=p-m),{width:f*g,kernedWidth:S*g}},getHeightOfChar:function(i,n){return this.getValueOfPropertyAt(i,n,"fontSize")},measureLine:function(i){var n=this._measureLine(i);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(i){var n=0,o,s,a=this._textLines[i],l,c,h=0,u=new Array(a.length);for(this.__charBounds[i]=u,o=0;o<a.length;o++)s=a[o],c=this._getGraphemeBox(s,i,o,l),u[o]=c,n+=c.kernedWidth,l=s;return u[o]={left:c?c.left+c.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:n,numOfSpaces:h}},_getGraphemeBox:function(i,n,o,s,a){var l=this.getCompleteStyleDeclaration(n,o),c=s?this.getCompleteStyleDeclaration(n,o-1):{},h=this._measureChar(i,l,s,c),u=h.kernedWidth,f=h.width,p;this.charSpacing!==0&&(p=this._getWidthOfCharSpacing(),f+=p,u+=p);var m={width:f,left:0,height:l.fontSize,kernedWidth:u,deltaY:l.deltaY};if(o>0&&!a){var g=this.__charBounds[n][o-1];m.left=g.left+g.width+h.kernedWidth-h.width}return m},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var n=this._textLines[i],o=this.getHeightOfChar(i,0),s=1,a=n.length;s<a;s++)o=Math.max(this.getHeightOfChar(i,s),o);return this.__lineHeights[i]=o*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,n=0,o=0,s=this._textLines.length;o<s;o++)i=this.getHeightOfLine(o),n+=o===s-1?i/this.lineHeight:i;return n},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,n){i.save();for(var o=0,s=this._getLeftOffset(),a=this._getTopOffset(),l=this._applyPatternGradientTransform(i,n==="fillText"?this.fill:this.stroke),c=0,h=this._textLines.length;c<h;c++){var u=this.getHeightOfLine(c),f=u/this.lineHeight,p=this._getLineLeftOffset(c);this._renderTextLine(n,i,this._textLines[c],s+p-l.offsetX,a+o+f-l.offsetY,c),o+=u}i.restore()},_renderTextFill:function(i){if(!this.fill&&!this.styleHas("fill"))return;this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles())return;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore()},_renderChars:function(i,n,o,s,a,l){var c=this.getHeightOfLine(l),h=this.textAlign.indexOf("justify")!==-1,u,f,p="",m,g=0,S,C=!h&&this.charSpacing===0&&this.isEmptyStyles(l);if(n.save(),a-=c*this._fontSizeFraction/this.lineHeight,C){this._renderChar(i,n,l,0,o.join(""),s,a,c),n.restore();return}for(var k=0,W=o.length-1;k<=W;k++)S=k===W||this.charSpacing,p+=o[k],m=this.__charBounds[l][k],g===0?(s+=m.kernedWidth-m.width,g+=m.width):g+=m.kernedWidth,h&&!S&&(this._reSpaceAndTab.test(o[k])&&(S=!0)),S||(u=u||this.getCompleteStyleDeclaration(l,k),f=this.getCompleteStyleDeclaration(l,k+1),S=this._hasStyleChanged(u,f)),S&&(this._renderChar(i,n,l,k,p,s,a,c),p="",u=f,s+=g,g=0);n.restore()},_renderChar:function(i,n,o,s,a,l,c){var h=this._getStyleDeclaration(o,s),u=this.getCompleteStyleDeclaration(o,s),f=i==="fillText"&&u.fill,p=i==="strokeText"&&u.stroke&&u.strokeWidth;if(!p&&!f)return;h&&n.save(),this._applyCharStyles(i,n,o,s,u),h&&h.textBackgroundColor&&this._removeShadow(n),h&&h.deltaY&&(c+=h.deltaY),f&&n.fillText(a,l,c),p&&n.strokeText(a,l,c),h&&n.restore()},setSuperscript:function(i,n){return this._setScript(i,n,this.superscript)},setSubscript:function(i,n){return this._setScript(i,n,this.subscript)},_setScript:function(i,n,o){var s=this.get2DCursorLocation(i,!0),a=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),l=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),c={fontSize:a*o.size,deltaY:l+a*o.baseline};return this.setSelectionStyles(c,i,n),this},_hasStyleChanged:function(i,n){return i.fill!==n.fill||i.stroke!==n.stroke||i.strokeWidth!==n.strokeWidth||i.fontSize!==n.fontSize||i.fontFamily!==n.fontFamily||i.fontWeight!==n.fontWeight||i.fontStyle!==n.fontStyle||i.deltaY!==n.deltaY},_hasStyleChangedForSvg:function(i,n){return this._hasStyleChanged(i,n)||i.overline!==n.overline||i.underline!==n.underline||i.linethrough!==n.linethrough},_getLineLeftOffset:function(i){var n=this.getLineWidth(i);return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:this.textAlign==="justify-center"&&this.isEndOfWrapping(i)?(this.width-n)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(i)?this.width-n:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i])return this.__lineWidths[i];var n,o=this._textLines[i],s;return o===""?n=0:(s=this.measureLine(i),n=s.width),this.__lineWidths[i]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,n,o){var s=this._getStyleDeclaration(i,n);return s&&typeof s[o]!="undefined"?s[o]:this[o]},_renderTextDecoration:function(i,n){if(!this[n]&&!this.styleHas(n))return;for(var o,s,a,l,c,h,u,f,p=this._getLeftOffset(),m=this._getTopOffset(),g,S,C,k,W,J,$,Q,q=this._getWidthOfCharSpacing(),K=0,A=this._textLines.length;K<A;K++){if(o=this.getHeightOfLine(K),!this[n]&&!this.styleHas(n,K)){m+=o;continue}u=this._textLines[K],J=o/this.lineHeight,l=this._getLineLeftOffset(K),S=0,C=0,f=this.getValueOfPropertyAt(K,0,n),Q=this.getValueOfPropertyAt(K,0,"fill"),g=m+J*(1-this._fontSizeFraction),s=this.getHeightOfChar(K,0),c=this.getValueOfPropertyAt(K,0,"deltaY");for(var N=0,j=u.length;N<j;N++)k=this.__charBounds[K][N],W=this.getValueOfPropertyAt(K,N,n),$=this.getValueOfPropertyAt(K,N,"fill"),a=this.getHeightOfChar(K,N),h=this.getValueOfPropertyAt(K,N,"deltaY"),(W!==f||$!==Q||a!==s||h!==c)&&C>0?(i.fillStyle=Q,f&&Q&&i.fillRect(p+l+S,g+this.offsets[n]*s+c,C,this.fontSize/15),S=k.left,C=k.width,f=W,Q=$,s=a,c=h):C+=k.kernedWidth;i.fillStyle=$,W&&$&&i.fillRect(p+l+S,g+this.offsets[n]*s+c,C-q,this.fontSize/15),m+=o}this._removeShadow(i)},_getFontDeclaration:function(i,n){var o=i||this,s=this.fontFamily,a=t.Text.genericFonts.indexOf(s.toLowerCase())>-1,l=s===void 0||s.indexOf("'")>-1||s.indexOf(",")>-1||s.indexOf('"')>-1||a?o.fontFamily:'"'+o.fontFamily+'"';return[t.isLikelyNode?o.fontWeight:o.fontStyle,t.isLikelyNode?o.fontStyle:o.fontWeight,n?this.CACHE_FONT_SIZE+"px":o.fontSize+"px",l].join(" ")},render:function(i){if(!this.visible)return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)},_splitTextIntoLines:function(i){for(var n=i.split(this._reNewline),o=new Array(n.length),s=[`
`],a=[],l=0;l<n.length;l++)o[l]=t.util.string.graphemeSplit(n[l]),a=a.concat(o[l],s);return a.pop(),{_unwrappedLines:o,lines:n,graphemeText:a,graphemeLines:o}},toObject:function(i){var n=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(i),o=this.callSuper("toObject",n);return o.styles=r(this.styles,!0),o},set:function(i,n){this.callSuper("set",i,n);var o=!1;if(typeof i=="object")for(var s in i)o=o||this._dimensionAffectingProps.indexOf(s)!==-1;else o=this._dimensionAffectingProps.indexOf(i)!==-1;return o&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(i,n,o){if(!i)return n(null);var s=t.parseAttributes(i,t.Text.ATTRIBUTE_NAMES),a=s.textAnchor||"left";if(o=t.util.object.extend(o?r(o):{},s),o.top=o.top||0,o.left=o.left||0,s.textDecoration){var l=s.textDecoration;l.indexOf("underline")!==-1&&(o.underline=!0),l.indexOf("overline")!==-1&&(o.overline=!0),l.indexOf("line-through")!==-1&&(o.linethrough=!0),delete o.textDecoration}"dx"in s&&(o.left+=s.dx),"dy"in s&&(o.top+=s.dy),"fontSize"in o||(o.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var c="";"textContent"in i?c=i.textContent:"firstChild"in i&&i.firstChild!==null&&("data"in i.firstChild&&i.firstChild.data!==null&&(c=i.firstChild.data)),c=c.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var h=o.strokeWidth;o.strokeWidth=0;var u=new t.Text(c,o),f=u.getScaledHeight()/u.height,p=(u.height+u.strokeWidth)*u.lineHeight-u.height,m=p*f,g=u.getScaledHeight()+m,S=0;a==="center"&&(S=u.getScaledWidth()/2),a==="right"&&(S=u.getScaledWidth()),u.set({left:u.left-S,top:u.top-(g-u.fontSize*(.07+u._fontSizeFraction))/u.lineHeight,strokeWidth:typeof h!="undefined"?h:1}),n(u)},t.Text.fromObject=function(i,n){return t.Object._fromObject("Text",i,n,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)})((typeof L!="undefined",L));(function(){d.util.object.extend(d.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(typeof e!="undefined"&&!this.styles[e])return!0;var t=typeof e=="undefined"?this.styles:{line:this.styles[e]};for(var r in t)for(var i in t[r])for(var n in t[r][i])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||e==="")return!1;if(typeof t!="undefined"&&!this.styles[t])return!1;var r=typeof t=="undefined"?this.styles:{0:this.styles[t]};for(var i in r)for(var n in r[i])if(typeof r[i][n][e]!="undefined")return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||e==="")return!1;var t=this.styles,r=0,i,n,o=!0,s=0,a;for(var l in t){i=0;for(var c in t[l]){var a=t[l][c],h=a.hasOwnProperty(e);r++,h?(n?a[e]!==n&&(o=!1):n=a[e],a[e]===this[e]&&delete a[e]):o=!1,Object.keys(a).length!==0?i++:delete t[l][c]}i===0&&delete t[l]}for(var u=0;u<this._textLines.length;u++)s+=this._textLines[u].length;o&&r===s&&(this[e]=n,this.removeStyle(e))},removeStyle:function(e){if(!this.styles||!e||e==="")return;var t=this.styles,r,i,n;for(i in t){r=t[i];for(n in r)delete r[n][e],Object.keys(r[n]).length===0&&delete r[n];Object.keys(r).length===0&&delete t[i]}},_extendStyles:function(e,t){var r=this.get2DCursorLocation(e);this._getLineStyle(r.lineIndex)||this._setLineStyle(r.lineIndex),this._getStyleDeclaration(r.lineIndex,r.charIndex)||this._setStyleDeclaration(r.lineIndex,r.charIndex,{}),d.util.object.extend(this._getStyleDeclaration(r.lineIndex,r.charIndex),t)},get2DCursorLocation:function(e,t){typeof e=="undefined"&&(e=this.selectionStart);for(var r=t?this._unwrappedTextLines:this._textLines,i=r.length,n=0;n<i;n++){if(e<=r[n].length)return{lineIndex:n,charIndex:e};e-=r[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:r[n-1].length<e?r[n-1].length:e}},getSelectionStyles:function(e,t,r){typeof e=="undefined"&&(e=this.selectionStart||0),typeof t=="undefined"&&(t=this.selectionEnd||e);for(var i=[],n=e;n<t;n++)i.push(this.getStyleAtPosition(n,r));return i},getStyleAtPosition:function(e,t){var r=this.get2DCursorLocation(e),i=t?this.getCompleteStyleDeclaration(r.lineIndex,r.charIndex):this._getStyleDeclaration(r.lineIndex,r.charIndex);return i||{}},setSelectionStyles:function(e,t,r){typeof t=="undefined"&&(t=this.selectionStart||0),typeof r=="undefined"&&(r=this.selectionEnd||t);for(var i=t;i<r;i++)this._extendStyles(i,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var r=this.styles&&this.styles[e];return r?r[t]:null},getCompleteStyleDeclaration:function(e,t){for(var r=this._getStyleDeclaration(e,t)||{},i={},n,o=0;o<this._styleProperties.length;o++)n=this._styleProperties[o],i[n]=typeof r[n]=="undefined"?this[n]:r[n];return i},_setStyleDeclaration:function(e,t,r){this.styles[e][t]=r},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}})})();(function(){function e(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}d.IText=d.util.createClass(d.Text,d.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,r){this.callSuper("initialize",t,r),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,r){this[t]!==r&&(this._fireSelectionChanged(),this[t]=r),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var r=this.canvas.contextTop,i=this.canvas.viewportTransform;r.save(),r.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(r),this._clearTextArea(r),t||r.restore()},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var t=this._getCursorBoundaries(),r=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,r):this.renderSelection(t,r),r.restore()},_clearTextArea:function(t){var r=this.width+4,i=this.height+4;t.clearRect(-r/2,-i/2,r,i)},_getCursorBoundaries:function(t){typeof t=="undefined"&&(t=this.selectionStart);var r=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:r,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var r,i,n,o=0,s=0,a,l=this.get2DCursorLocation(t);n=l.charIndex,i=l.lineIndex;for(var c=0;c<i;c++)o+=this.getHeightOfLine(c);r=this._getLineLeftOffset(i);var h=this.__charBounds[i][n];return h&&(s=h.left),this.charSpacing!==0&&n===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing()),a={top:o,left:r+(s>0?s:0)},this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(t,r){var i=this.get2DCursorLocation(),n=i.lineIndex,o=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(n,o,"fontSize"),a=this.scaleX*this.canvas.getZoom(),l=this.cursorWidth/a,c=t.topOffset,h=this.getValueOfPropertyAt(n,o,"deltaY");c+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,r),r.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,o,"fill"),r.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,r.fillRect(t.left+t.leftOffset-l/2,c+t.top+h,l,s)},renderSelection:function(t,r){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,o=this.textAlign.indexOf("justify")!==-1,s=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),l=s.lineIndex,c=a.lineIndex,h=s.charIndex<0?0:s.charIndex,u=a.charIndex<0?0:a.charIndex,f=l;f<=c;f++){var p=this._getLineLeftOffset(f)||0,m=this.getHeightOfLine(f),g=0,S=0,C=0;if(f===l&&(S=this.__charBounds[l][h].left),f>=l&&f<c)C=o&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===c)if(u===0)C=this.__charBounds[c][u].left;else{var k=this._getWidthOfCharSpacing();C=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-k}g=m,(this.lineHeight<1||f===c&&this.lineHeight>1)&&(m/=this.lineHeight),this.inCompositionMode?(r.fillStyle=this.compositionColor||"black",r.fillRect(t.left+p+S,t.top+t.topOffset+m,C-S,1)):(r.fillStyle=this.selectionColor,r.fillRect(t.left+p+S,t.top+t.topOffset,C-S,m)),t.topOffset+=g}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),r=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:r}}}),d.IText.fromObject=function(t,r){if(e(t),t.styles)for(var i in t.styles)for(var n in t.styles[i])e(t.styles[i][n]);d.Object._fromObject("IText",t,r,"text")}})();(function(){var e=d.util.object.clone;d.util.object.extend(d.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var r=t.canvas;r&&(r._hasITextHandlers||(r._hasITextHandlers=!0,t._initCanvasHandlers(r)),r._iTextInstances=r._iTextInstances||[],r._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var r=t.canvas;r&&(r._iTextInstances=r._iTextInstances||[],d.util.removeFromArray(r._iTextInstances,t),r._iTextInstances.length===0&&(r._hasITextHandlers=!1,t._removeCanvasHandlers(r)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,r,i,n){var o;return o={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",r,{duration:i,onComplete:function(){o.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return o.isAborted}}),o},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var r=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){r._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,r=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&r&&r.clearContext(r.contextTop||r.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var r=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i--;for(;/\S/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findWordBoundaryRight:function(t){var r=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},findLineBoundaryLeft:function(t){for(var r=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findLineBoundaryRight:function(t){for(var r=0,i=t;!/\n/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},searchWordBoundary:function(t,r){for(var i=this._text,n=this._reSpace.test(i[t])?t-1:t,o=i[n],s=d.reNonWord;!s.test(o)&&n>0&&n<i.length;)n+=r,o=i[n];return s.test(o)&&(n+=r===1?0:1),n},selectWord:function(t){t=t||this.selectionStart;var r=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var r=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){return this.isEditing||!this.editable?void 0:(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this)},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.selected=!1,r.isEditing&&r.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(!this.__isMousedown||!this.isEditing)return;var r=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;if((r!==this.__selectionStartOnMouseDown||i===n)&&(i===r||n===r))return;r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==i||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection())},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,r,i){var n=i.slice(0,t),o=d.util.string.graphemeSplit(n).length;if(t===r)return{selectionStart:o,selectionEnd:o};var s=i.slice(t,r),a=d.util.string.graphemeSplit(s).length;return{selectionStart:o,selectionEnd:o+a}},fromGraphemeToStringSelection:function(t,r,i){var n=i.slice(0,t),o=n.join("").length;if(t===r)return{selectionStart:o,selectionEnd:o};var s=i.slice(t,r),a=s.join("").length;return{selectionStart:o,selectionEnd:o+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!this.hiddenTextarea)return;if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()},updateFromTextArea:function(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,o=i.charIndex,s=this.getValueOfPropertyAt(n,o,"fontSize")*this.lineHeight,a=r.leftOffset,l=this.calcTransformMatrix(),c={x:r.left+a,y:r.top+r.topOffset+s},h=this.canvas.getRetinaScaling(),u=this.canvas.upperCanvasEl,f=u.width/h,p=u.height/h,m=f-s,g=p-s,S=u.clientWidth/f,C=u.clientHeight/p;return c=d.util.transformPoint(c,l),c=d.util.transformPoint(c,this.canvas.viewportTransform),c.x*=S,c.y*=C,c.x<0&&(c.x=0),c.x>m&&(c.x=m),c.y<0&&(c.y=0),c.y>g&&(c.y=g),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps)return;this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){var t=this._textBeforeEdit!==this.text,r=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,r&&(r.blur&&r.blur(),r.parentNode&&r.parentNode.removeChild(r)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,r){var i=this.get2DCursorLocation(t,!0),n=this.get2DCursorLocation(r,!0),o=i.lineIndex,s=i.charIndex,a=n.lineIndex,l=n.charIndex,c,h;if(o!==a){if(this.styles[o])for(c=s;c<this._unwrappedTextLines[o].length;c++)delete this.styles[o][c];if(this.styles[a])for(c=l;c<this._unwrappedTextLines[a].length;c++)h=this.styles[a][c],h&&(this.styles[o]||(this.styles[o]={}),this.styles[o][s+c-l]=h);for(c=o+1;c<=a;c++)delete this.styles[c];this.shiftLineStyles(a,o-a)}else if(this.styles[o]){h=this.styles[o];var u=l-s,f,p;for(c=s;c<l;c++)delete h[c];for(p in this.styles[o])f=parseInt(p,10),f>=l&&(h[f-u]=h[p],delete h[p])}},shiftLineStyles:function(t,r){var i=e(this.styles);for(var n in this.styles){var o=parseInt(n,10);o>t&&(this.styles[o+r]=i[o],i[o-r]||delete this.styles[o])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,r,i,n){var o,s={},a=!1,l=this._unwrappedTextLines[t].length===r;i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(o=this.styles[t][r===0?r:r-1]);for(var c in this.styles[t]){var h=parseInt(c,10);h>=r&&(a=!0,s[h-r]=this.styles[t][c],l&&r===0||delete this.styles[t][c])}var u=!1;for(a&&!l&&(this.styles[t+i]=s,u=!0),u&&i--;i>0;)n&&n[i-1]?this.styles[t+i]={0:e(n[i-1])}:o?this.styles[t+i]={0:e(o)}:delete this.styles[t+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(t,r,i,n){this.styles||(this.styles={});var o=this.styles[t],s=o?e(o):{};i||(i=1);for(var a in s){var l=parseInt(a,10);l>=r&&(o[l+i]=s[l],s[l-i]||delete o[l])}if(this._forceClearCache=!0,n){for(;i--;){if(!Object.keys(n[i]).length)continue;this.styles[t]||(this.styles[t]={}),this.styles[t][r+i]=e(n[i])}return}if(!o)return;for(var c=o[r?r-1:1];c&&i--;)this.styles[t][r+i]=e(c)},insertNewStyleBlock:function(t,r,i){for(var n=this.get2DCursorLocation(r,!0),o=[0],s=0,a=0;a<t.length;a++)t[a]===`
`?(s++,o[s]=0):o[s]++;o[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,o[0],i),i=i&&i.slice(o[0]+1)),s&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+o[0],s);for(var a=1;a<s;a++)o[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,o[a],i):i&&(this.styles[n.lineIndex+a][0]=i[0]),i=i&&i.slice(o[a]+1);o[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,o[a],i)},setSelectionStartEndWithShift:function(t,r,i){i<=t?(r===t?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<r?this._selectionDirection==="right"?this.selectionEnd=i:this.selectionStart=i:(r===t?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=r),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})})();d.util.object.extend(d.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(!this.canvas)return;this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){if(!this.isEditing)return;this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){if(!this.isEditing)return;this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())},_mouseDownHandlerBefore:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.selected=this===this.canvas._activeObject},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&e.e.button!==1)return;if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),r=this.selectionStart,i=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(r,i,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t=this.getLocalPointer(e),r=0,i=0,n=0,o=0,s=0,a,l,c=0,h=this._textLines.length;c<h&&n<=t.y;c++)n+=this.getHeightOfLine(c)*this.scaleY,s=c,c>0&&(o+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));a=this._getLineLeftOffset(s),i=a*this.scaleX,l=this._textLines[s];for(var u=0,f=l.length;u<f&&(r=i,i+=this.__charBounds[s][u].kernedWidth*this.scaleX,i<=t.x);u++)o++;return this._getNewSelectionStartFromOffset(t,r,i,o,f)},_getNewSelectionStartFromOffset:function(e,t,r,i,n){var o=e.x-t,s=r-e.x,a=s>o||s<0?0:1,l=i+a;return this.flipX&&(l=n-l),l>this._text.length&&(l=this._text.length),l}});d.util.object.extend(d.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=d.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+e.fontSize+";",d.document.body.appendChild(this.hiddenTextarea),d.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),d.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),d.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),d.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(d.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing)return;if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else if(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapDown[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()},onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapUp[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;var r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,i=this._text.length,n=r.length,o,s,a=n-i,l=this.selectionStart,c=this.selectionEnd,h=l!==c,u,f,p;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var m=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),g=l>m.selectionStart;h?(o=this._text.slice(l,c),a+=c-l):n<i&&(g?o=this._text.slice(c+a,c):o=this._text.slice(l,l-a)),s=r.slice(m.selectionEnd-a,m.selectionEnd),o&&o.length&&(s.length&&(u=this.getSelectionStyles(l,l+1,!1),u=s.map(function(){return u[0]})),h?(f=l,p=c):g?(f=c-o.length,p=c):(f=c,p=c+o.length),this.removeStyleFromTo(f,p)),s.length&&(t&&s.join("")===d.copiedText&&!d.disableStyleCopyPaste&&(u=d.copiedTextStyle),this.insertNewStyleBlock(s,l,u)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){if(this.selectionStart===this.selectionEnd)return;d.copiedText=this.getSelectedText(),d.disableStyleCopyPaste?d.copiedTextStyle=null:d.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||d.window.clipboardData},_getWidthBeforeCursor:function(e,t){var r=this._getLineLeftOffset(e),i;return t>0&&(i=this.__charBounds[e][t-1],r+=i.left+i.width),r},getDownCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),n=i.lineIndex;if(n===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-r;var o=i.charIndex,s=this._getWidthBeforeCursor(n,o),a=this._getIndexOnLine(n+1,s),l=this._textLines[n].slice(o);return l.length+a+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),n=i.lineIndex;if(n===0||e.metaKey||e.keyCode===33)return-r;var o=i.charIndex,s=this._getWidthBeforeCursor(n,o),a=this._getIndexOnLine(n-1,s),l=this._textLines[n].slice(0,o),c=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-l.length+(1-c)},_getIndexOnLine:function(e,t){for(var r=this._textLines[e],i=this._getLineLeftOffset(e),n=i,o=0,s,a,l=0,c=r.length;l<c;l++)if(s=this.__charBounds[e][l].width,n+=s,n>t){a=!0;var h=n-s,u=n,f=Math.abs(h-t),p=Math.abs(u-t);o=p<f?l:l-1;break}return a||(o=r.length-1),o},moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var r="get"+e+"CursorOffset",i=this[r](t,this._selectionDirection==="right");t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),i!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t=this._selectionDirection==="left"?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,r){var i;if(e.altKey)i=this["findWordBoundary"+r](this[t]);else if(e.metaKey||e.keyCode===35||e.keyCode===36)i=this["findLineBoundary"+r](this[t]);else return this[t]+=r==="Left"?-1:1,!0;if(typeof i!==void 0&&this[t]!==i)return this[t]=i,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(e,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(e,"selectionStart")},moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var r="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?r+="Shift":r+="outShift",this[r](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(e,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(e,"selectionEnd")},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){typeof t=="undefined"&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,r,i){typeof i=="undefined"&&(i=r),i>r&&this.removeStyleFromTo(r,i);var n=d.util.string.graphemeSplit(e);this.insertNewStyleBlock(n,r,t),this._text=[].concat(this._text.slice(0,r),n,this._text.slice(i)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}});(function(){var e=d.util.toFixed,t=/  +/g;d.util.object.extend(d.Text.prototype,{_toSVG:function(){var r=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(),{reviver:r,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(r){var i=!0,n=this.getSvgTextDecoration(this);return[r.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",r.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(r,i){var n=[],o=[],s=r,a;this._setSVGBg(o);for(var l=0,c=this._textLines.length;l<c;l++)a=this._getLineLeftOffset(l),(this.textBackgroundColor||this.styleHas("textBackgroundColor",l))&&this._setSVGTextLineBg(o,l,i+a,s),this._setSVGTextLineText(n,l,i+a,s),s+=this.getHeightOfLine(l);return{textSpans:n,textBgRects:o}},_createTextCharSpan:function(r,i,n,o){var s=r!==r.trim()||r.match(t),a=this.getSvgSpanStyles(i,s),l=a?'style="'+a+'"':"",c=i.deltaY,h="",u=d.Object.NUM_FRACTION_DIGITS;return c&&(h=' dy="'+e(c,u)+'" '),['<tspan x="',e(n,u),'" y="',e(o,u),'" ',h,l,">",d.util.string.escapeXml(r),"</tspan>"].join("")},_setSVGTextLineText:function(r,i,n,o){var s=this.getHeightOfLine(i),a=this.textAlign.indexOf("justify")!==-1,l,c,h="",u,f,p=0,m=this._textLines[i],g;o+=s*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,C=m.length-1;S<=C;S++)g=S===C||this.charSpacing,h+=m[S],u=this.__charBounds[i][S],p===0?(n+=u.kernedWidth-u.width,p+=u.width):p+=u.kernedWidth,a&&!g&&(this._reSpaceAndTab.test(m[S])&&(g=!0)),g||(l=l||this.getCompleteStyleDeclaration(i,S),c=this.getCompleteStyleDeclaration(i,S+1),g=this._hasStyleChangedForSvg(l,c)),g&&(f=this._getStyleDeclaration(i,S)||{},r.push(this._createTextCharSpan(h,f,n,o)),h="",l=c,n+=p,p=0)},_pushTextBgRect:function(r,i,n,o,s,a){var l=d.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(i),' x="',e(n,l),'" y="',e(o,l),'" width="',e(s,l),'" height="',e(a,l),`"></rect>
`)},_setSVGTextLineBg:function(r,i,n,o){for(var s=this._textLines[i],a=this.getHeightOfLine(i)/this.lineHeight,l=0,c=0,h,u,f=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),p=0,m=s.length;p<m;p++)h=this.__charBounds[i][p],u=this.getValueOfPropertyAt(i,p,"textBackgroundColor"),u!==f?(f&&this._pushTextBgRect(r,f,n+c,o,l,a),c=h.left,l=h.width,f=u):l+=h.kernedWidth;u&&this._pushTextBgRect(r,u,n+c,o,l,a)},_getFillAttributes:function(r){var i=r&&typeof r=="string"?new d.Color(r):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+r+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(r){for(var i=0,n=0,o=0;o<r;o++)i+=this.getHeightOfLine(o);return n=this.getHeightOfLine(o),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(r){var i=d.Object.prototype.getSvgStyles.call(this,r);return i+" white-space: pre;"}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){if(this.__skipDimension)return;this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},_generateStyleMap:function(r){for(var i=0,n=0,o=0,s={},a=0;a<r.graphemeLines.length;a++)r.graphemeText[o]===`
`&&a>0?(n=0,o++,i++):!this.splitByGrapheme&&this._reSpaceAndTab.test(r.graphemeText[o])&&a>0&&(n++,o++),s[a]={line:i,offset:n},o+=r.graphemeLines[a].length,n+=r.graphemeLines[a].length;return s},styleHas:function(r,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return t.Text.prototype.styleHas.call(this,r,i)},isEmptyStyles:function(r){if(!this.styles)return!0;var i=0,n=r+1,o,s,a=!1,l=this._styleMap[r],c=this._styleMap[r+1];l&&(r=l.line,i=l.offset),c&&(n=c.line,a=n===r,o=c.offset),s=typeof r=="undefined"?this.styles:{line:this.styles[r]};for(var h in s)for(var u in s[h])if(u>=i&&(!a||u<o))for(var f in s[h][u])return!1;return!0},_getStyleDeclaration:function(r,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[r];if(!n)return null;r=n.line,i=n.offset+i}return this.callSuper("_getStyleDeclaration",r,i)},_setStyleDeclaration:function(r,i,n){var o=this._styleMap[r];r=o.line,i=o.offset+i,this.styles[r][i]=n},_deleteStyleDeclaration:function(r,i){var n=this._styleMap[r];r=n.line,i=n.offset+i,delete this.styles[r][i]},_getLineStyle:function(r){var i=this._styleMap[r];return!!this.styles[i.line]},_setLineStyle:function(r){var i=this._styleMap[r];this.styles[i.line]={}},_wrapText:function(r,i){var n=[],o;for(this.isWrapping=!0,o=0;o<r.length;o++)n=n.concat(this._wrapLine(r[o],o,i));return this.isWrapping=!1,n},_measureWord:function(r,i,n){var o=0,s,a=!0;n=n||0;for(var l=0,c=r.length;l<c;l++){var h=this._getGraphemeBox(r[l],i,l+n,s,a);o+=h.kernedWidth,s=r[l]}return o},_wrapLine:function(r,i,n,o){var s=0,a=this.splitByGrapheme,l=[],c=[],h=a?t.util.string.graphemeSplit(r):r.split(this._wordJoiners),u="",f=0,p=a?"":" ",m=0,g=0,S=0,C=!0,k=this._getWidthOfCharSpacing(),o=o||0;h.length===0&&h.push([]),n-=o;for(var W=0;W<h.length;W++)u=a?h[W]:t.util.string.graphemeSplit(h[W]),m=this._measureWord(u,i,f),f+=u.length,s+=g+m-k,s>=n&&!C?(l.push(c),c=[],s=m,C=!0):s+=k,!C&&!a&&c.push(p),c=c.concat(u),g=a?0:this._measureWord([p],i,f),f++,C=!1,m>S&&(S=m);return W&&l.push(c),S+o>this.dynamicMinWidth&&(this.dynamicMinWidth=S-k+o),l},isEndOfWrapping:function(r){return this._styleMap[r+1]?this._styleMap[r+1].line!==this._styleMap[r].line:!0},missingNewlineOffset:function(r){return this.splitByGrapheme?this.isEndOfWrapping(r)?1:0:1},_splitTextIntoLines:function(r){for(var i=t.Text.prototype._splitTextIntoLines.call(this,r),n=this._wrapText(i.lines,this.width),o=new Array(n.length),s=0;s<n.length;s++)o[s]=n[s].join("");return i.lines=o,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var r={};for(var i in this._styleMap)this._textLines[i]&&(r[this._styleMap[i].line]=1);for(var i in this.styles)r[i]||delete this.styles[i]},toObject:function(r){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(r))}}),t.Textbox.fromObject=function(r,i){return t.Object._fromObject("Textbox",r,i,"text")}})((typeof L!="undefined",L));(function(){var e=d.controlsUtils,t=e.scaleSkewCursorStyleHandler,r=e.scaleCursorStyleHandler,i=e.scalingEqually,n=e.scalingYOrSkewingX,o=e.scalingXOrSkewingY,s=e.scaleOrSkewActionName,a=d.Object.prototype.controls;if(a.ml=new d.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:o,getActionName:s}),a.mr=new d.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:o,getActionName:s}),a.mb=new d.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:n,getActionName:s}),a.mt=new d.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:n,getActionName:s}),a.tl=new d.Control({x:-.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),a.tr=new d.Control({x:.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),a.bl=new d.Control({x:-.5,y:.5,cursorStyleHandler:r,actionHandler:i}),a.br=new d.Control({x:.5,y:.5,cursorStyleHandler:r,actionHandler:i}),a.mtr=new d.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),d.Textbox){var l=d.Textbox.prototype.controls={};l.mtr=a.mtr,l.tr=a.tr,l.br=a.br,l.tl=a.tl,l.bl=a.bl,l.mt=a.mt,l.mb=a.mb,l.mr=new d.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),l.ml=new d.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}})()}),Ht=Ke(Bc=>{wi(Bc,{options:()=>di,unzip:()=>ui,version:()=>pi,ws:()=>fi});const ui=hi,fi=pr,di={iconsLocation:"/data/icons"},pi="0.2.0"});class lt extends Error{constructor(e){super("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E: "+e)}}class we extends Error{constructor(e){super(e)}}class ht extends we{constructor(e){super(`\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043E\u043F\u0446\u0438\u044F ${e}.`)}}class le extends Error{constructor(e){super(e)}}class ye extends le{constructor(e,t){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.meta.filepathDos||""}:
${t}`)}}class Oe extends ye{constructor(e,t,r){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${t.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}}const It=De(Fe()),Di=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],ir=1<<24,nr=2<<24;function ar(e){const t=e.toLowerCase().trim();if(t.startsWith("transparent"))return ir;if(t.startsWith("syscolor"))return nr|parseInt(t.split("(")[1].split(")")[0]);if(t.startsWith("rgb")){const r=t.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw new le(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0446\u0432\u0435\u0442: ${e}`)}function Te(e){if(e&ir)return"transparent";const t=e&255;if(e&nr)return Di[t]||"black";const r=e>>8&255,i=e>>16&255;return`rgb(${t},${r},${i})`}class ne extends Map{static create(e){return new Map(e)}static getFreeHandle(e,t){let r=t||0;for(;e.has(++r););return r}}var fe;(function(e){e[e.WM_DESTROY=2]="WM_DESTROY",e[e.WM_MOVE=3]="WM_MOVE",e[e.WM_SIZE=5]="WM_SIZE",e[e.WM_CLOSE=16]="WM_CLOSE",e[e.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",e[e.WM_COMMAND=273]="WM_COMMAND",e[e.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",e[e.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",e[e.WM_LBUTTONUP=514]="WM_LBUTTONUP",e[e.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",e[e.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",e[e.WM_RBUTTONUP=517]="WM_RBUTTONUP",e[e.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",e[e.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",e[e.WM_MBUTTONUP=520]="WM_MBUTTONUP",e[e.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",e[e.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",e[e.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",e[e.WM_KEYDOWN=256]="WM_KEYDOWN",e[e.WM_KEYUP=257]="WM_KEYUP",e[e.WM_CANCLOSE=1538]="WM_CANCLOSE",e[e.WM_SPACEDONE=1539]="WM_SPACEDONE",e[e.WM_SPACEINIT=1540]="WM_SPACEINIT",e[e.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",e[e.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(fe||(fe={}));var v;(function(e){e[e.V_END=0]="V_END",e[e.PUSH_FLOAT=1]="PUSH_FLOAT",e[e._PUSH_FLOAT=2]="_PUSH_FLOAT",e[e.vmPUSH_LONG=3]="vmPUSH_LONG",e[e.vm_PUSH_LONG=4]="vm_PUSH_LONG",e[e.vmPUSH_LONG_const=5]="vmPUSH_LONG_const",e[e.PUSH_FLOAT_const=6]="PUSH_FLOAT_const",e[e.PUSH_DATA=7]="PUSH_DATA",e[e.PUSH_DATA_=8]="PUSH_DATA_",e[e.PUSH_DATA_const=9]="PUSH_DATA_const",e[e._POP_FLOAT_OLD=10]="_POP_FLOAT_OLD",e[e._POP_FLOAT=11]="_POP_FLOAT",e[e.vm_POP_LONG_OLD=12]="vm_POP_LONG_OLD",e[e.vm_POP_LONG=13]="vm_POP_LONG",e[e.POP_DATA=14]="POP_DATA",e[e._POP_DATA=15]="_POP_DATA",e[e.FLOAT_TO_LONG=16]="FLOAT_TO_LONG",e[e.LONG_TO_FLOAT=17]="LONG_TO_FLOAT",e[e.V_ADD_F=18]="V_ADD_F",e[e.V_SUB_F=19]="V_SUB_F",e[e.V_DIV_F=20]="V_DIV_F",e[e.V_MUL_F=21]="V_MUL_F",e[e.V_MOD=22]="V_MOD",e[e.V_TAN=23]="V_TAN",e[e.V_ATAN=24]="V_ATAN",e[e.V_SIN=25]="V_SIN",e[e.V_ASIN=26]="V_ASIN",e[e.V_COS=27]="V_COS",e[e.V_ACOS=28]="V_ACOS",e[e.V_LN=29]="V_LN",e[e.V_LG=30]="V_LG",e[e.V_LOG=31]="V_LOG",e[e.V_STEPEN=32]="V_STEPEN",e[e.V_EXP=33]="V_EXP",e[e.V_SQRT=34]="V_SQRT",e[e.V_SQR=35]="V_SQR",e[e.V_ED=36]="V_ED",e[e.V_DELTA=37]="V_DELTA",e[e.V_MAX=38]="V_MAX",e[e.V_MIN=39]="V_MIN",e[e.V_AVERAGE=40]="V_AVERAGE",e[e.V_ROUND=41]="V_ROUND",e[e.V_RANDOM=42]="V_RANDOM",e[e.V_AND=43]="V_AND",e[e.V_OR=44]="V_OR",e[e.V_NOT=45]="V_NOT",e[e.V_ABS=46]="V_ABS",e[e.V_SGN=47]="V_SGN",e[e.V_RAD=48]="V_RAD",e[e.V_DEG=49]="V_DEG",e[e.V_STOP=50]="V_STOP",e[e.V_JMP=51]="V_JMP",e[e.V_JNZ=52]="V_JNZ",e[e.V_JZ=53]="V_JZ",e[e.V_EQUAL=54]="V_EQUAL",e[e.V_NOTEQUAL=55]="V_NOTEQUAL",e[e.V_MORE=56]="V_MORE",e[e.V_MOREorEQUAL=57]="V_MOREorEQUAL",e[e.V_LOW=58]="V_LOW",e[e.V_LOWorEQUAL=59]="V_LOWorEQUAL",e[e.V_MCREATE=60]="V_MCREATE",e[e.V_MDELETE=61]="V_MDELETE",e[e.V_MFILL=62]="V_MFILL",e[e.V_MGET=63]="V_MGET",e[e.V_MPUT=64]="V_MPUT",e[e.V_MEDITOR=65]="V_MEDITOR",e[e.V_MDIAG=66]="V_MDIAG",e[e.V_MADDX=67]="V_MADDX",e[e.V_MSUBX=68]="V_MSUBX",e[e.V_MDIVX=69]="V_MDIVX",e[e.V_MMULX=70]="V_MMULX",e[e.V_MDET=71]="V_MDET",e[e.V_MDELTA=72]="V_MDELTA",e[e.V_MED=73]="V_MED",e[e.V_TRANSP=74]="V_TRANSP",e[e.V_MADDC=75]="V_MADDC",e[e.V_MNOT=76]="V_MNOT",e[e.V_MSUM=77]="V_MSUM",e[e.V_MSUBC=78]="V_MSUBC",e[e.V_MMULC=79]="V_MMULC",e[e.V_TRUNC=80]="V_TRUNC",e[e.V_CLOSEALL=81]="V_CLOSEALL",e[e.V_EQUALI=82]="V_EQUALI",e[e.V_NOTEQUALI=83]="V_NOTEQUALI",e[e.V_EDI=84]="V_EDI",e[e.V_ANDI=85]="V_ANDI",e[e.V_ORI=86]="V_ORI",e[e.V_NOTI=87]="V_NOTI",e[e.V_NOTbin=88]="V_NOTbin",e[e.VM_SETCRDSYSTEM=89]="VM_SETCRDSYSTEM",e[e.V_MDIVC=90]="V_MDIVC",e[e.V_MMUL=91]="V_MMUL",e[e.V_MGLUE=92]="V_MGLUE",e[e.V_MCUT=93]="V_MCUT",e[e.V_MMOVE=94]="V_MMOVE",e[e.V_MOBR=95]="V_MOBR",e[e.V_MDIM=96]="V_MDIM",e[e.V_XOR=97]="V_XOR",e[e.V_XORBIN=98]="V_XORBIN",e[e.V_FOLDERDIALOG=99]="V_FOLDERDIALOG",e[e.V_MSAVEAS=100]="V_MSAVEAS",e[e.V_MLOAD=101]="V_MLOAD",e[e.V_SAVEDIALOG=102]="V_SAVEDIALOG",e[e.V_LOADDIALOG=103]="V_LOADDIALOG",e[e.V_CREATEOBJECTFROMFILE=104]="V_CREATEOBJECTFROMFILE",e[e.V_AND_BINARY=105]="V_AND_BINARY",e[e.V_OR_BINARY=106]="V_OR_BINARY",e[e.V_QUITSC=107]="V_QUITSC",e[e.POP_FLOAT_PTR=108]="POP_FLOAT_PTR",e[e.PUSH_FLOAT_PTR=109]="PUSH_FLOAT_PTR",e[e.V_JNZ_HANDLE=110]="V_JNZ_HANDLE",e[e.V_JZ_HANDLE=111]="V_JZ_HANDLE",e[e.SETSTATUSTEXT=112]="SETSTATUSTEXT",e[e.V_UN_MINUS=113]="V_UN_MINUS",e[e.V_STRINGEX=114]="V_STRINGEX",e[e.GETTICKCOUNT=115]="GETTICKCOUNT",e[e.V_SHR=116]="V_SHR",e[e.V_SHL=117]="V_SHL",e[e.SCHANGE=119]="SCHANGE",e[e.PUSH_STRING=120]="PUSH_STRING",e[e._PUSH_STRING=121]="_PUSH_STRING",e[e.PUSH_STRING_CONST=122]="PUSH_STRING_CONST",e[e._POP_STRING=123]="_POP_STRING",e[e.PLUS_STRING=124]="PLUS_STRING",e[e.LEFT_STRING=125]="LEFT_STRING",e[e.RIGHT_STRING=126]="RIGHT_STRING",e[e.SUBSTR_STRING=127]="SUBSTR_STRING",e[e.POS_STRING=128]="POS_STRING",e[e.REPLICATE_STRING=129]="REPLICATE_STRING",e[e.LOWER_STRING=130]="LOWER_STRING",e[e.UPPER_STRING=131]="UPPER_STRING",e[e.ANSI_TO_OEM_STRING=132]="ANSI_TO_OEM_STRING",e[e.OEM_TO_ANSI_STRING=133]="OEM_TO_ANSI_STRING",e[e.COMPARE_STRING=134]="COMPARE_STRING",e[e.COMPAREI_STRING=135]="COMPAREI_STRING",e[e.LENGTH_STRING=136]="LENGTH_STRING",e[e.LTRIM_STRING=137]="LTRIM_STRING",e[e.RTRIM_STRING=138]="RTRIM_STRING",e[e.ALLTRIM_STRING=139]="ALLTRIM_STRING",e[e.ASCII_STRING=140]="ASCII_STRING",e[e.CHR_STRING=141]="CHR_STRING",e[e.FLOAT_TO_STRING=142]="FLOAT_TO_STRING",e[e.STRING_TO_FLOAT=143]="STRING_TO_FLOAT",e[e.S_EQUAL=144]="S_EQUAL",e[e.S_NOTEQUAL=145]="S_NOTEQUAL",e[e.S_MORE=146]="S_MORE",e[e.S_MOREorEQUAL=147]="S_MOREorEQUAL",e[e.S_LOW=148]="S_LOW",e[e.S_LOWorEQUAL=149]="S_LOWorEQUAL",e[e.RGB_COLOR=150]="RGB_COLOR",e[e.V_SYSTEM=151]="V_SYSTEM",e[e.V_SYSTEMSTR=152]="V_SYSTEMSTR",e[e.V_REGISTEROBJECT=153]="V_REGISTEROBJECT",e[e.V_UNREGISTEROBJECT=154]="V_UNREGISTEROBJECT",e[e.V_SETCAPTURE=155]="V_SETCAPTURE",e[e.V_RELEASECAPTURE=156]="V_RELEASECAPTURE",e[e._POP_STRING_OLD=157]="_POP_STRING_OLD",e[e.VM_GETMOUSEPOS=158]="VM_GETMOUSEPOS",e[e.vm_INPUT_BOX=159]="vm_INPUT_BOX",e[e.MESSAGE_BOX=160]="MESSAGE_BOX",e[e.V_CREATESTREAM=161]="V_CREATESTREAM",e[e.V_CLOSESTREAM=162]="V_CLOSESTREAM",e[e.V_SEEK=163]="V_SEEK",e[e.V_STREAMSTATUS=164]="V_STREAMSTATUS",e[e.V_EOF=165]="V_EOF",e[e.V_GETPOS=167]="V_GETPOS",e[e.V_GETSIZE=168]="V_GETSIZE",e[e.V_SETWIDTH=169]="V_SETWIDTH",e[e.V_FREAD=170]="V_FREAD",e[e.V_SREAD=171]="V_SREAD",e[e.V_FWRITE=172]="V_FWRITE",e[e.V_SWRITE=173]="V_SWRITE",e[e.V_GETLINE=174]="V_GETLINE",e[e.V_COPYBLOCK=175]="V_COPYBLOCK",e[e.V_TRUNCATE=176]="V_TRUNCATE",e[e.V_RANDOMIZE=177]="V_RANDOMIZE",e[e.V_CREATEFROMFILE3D=197]="V_CREATEFROMFILE3D",e[e.WINSHELL=198]="WINSHELL",e[e.RGB_COLORex=199]="RGB_COLORex",e[e.LOADSPACEWINDOW=200]="LOADSPACEWINDOW",e[e.OPENSCHEMEWINDOW=201]="OPENSCHEMEWINDOW",e[e.CLOSEWINDOW=202]="CLOSEWINDOW",e[e.V_GETNAMEBYHSP=203]="V_GETNAMEBYHSP",e[e.V_GETHSPBYNAME=204]="V_GETHSPBYNAME",e[e.V_SETCLIENTSIZE=205]="V_SETCLIENTSIZE",e[e.SETWINDOWTITLE=206]="SETWINDOWTITLE",e[e.GETWINDOWTITLE=207]="GETWINDOWTITLE",e[e.SHOWWINDOW=208]="SHOWWINDOW",e[e.SETWINDOWPOS=209]="SETWINDOWPOS",e[e.SETWINDOWORG=210]="SETWINDOWORG",e[e.SETWINDOWSIZE=211]="SETWINDOWSIZE",e[e.ISWINDOWVISIBLE=212]="ISWINDOWVISIBLE",e[e.ISICONIC=213]="ISICONIC",e[e.ISWINDOWEXIST=214]="ISWINDOWEXIST",e[e.BRINGWINDOWTOTOP=215]="BRINGWINDOWTOTOP",e[e.CASCADEWINDOWS=216]="CASCADEWINDOWS",e[e.TILE=217]="TILE",e[e.ARRANGEICONS=218]="ARRANGEICONS",e[e.WIN_ORGX=219]="WIN_ORGX",e[e.WIN_ORGY=220]="WIN_ORGY",e[e.WIN_SIZEX=221]="WIN_SIZEX",e[e.WIN_SIZEY=222]="WIN_SIZEY",e[e.GETOBJECTHANDLE=223]="GETOBJECTHANDLE",e[e.GETOBJECTBYNAME=224]="GETOBJECTBYNAME",e[e.GETCLIENTWIDTH=225]="GETCLIENTWIDTH",e[e.GETCLIENTHEIGHT=226]="GETCLIENTHEIGHT",e[e.CHOSECOLORDIALOG=227]="CHOSECOLORDIALOG",e[e.JGETX=228]="JGETX",e[e.JGETY=229]="JGETY",e[e.JGETZ=230]="JGETZ",e[e.JGETBTN=231]="JGETBTN",e[e.GETAKEYSTATE=232]="GETAKEYSTATE",e[e.GETCLASSDIR=233]="GETCLASSDIR",e[e.GETPROJECTDIR=234]="GETPROJECTDIR",e[e.GETWINDOWSDIR=235]="GETWINDOWSDIR",e[e.GETSYSTEMDIR=236]="GETSYSTEMDIR",e[e.GETDIRFROMFILE=237]="GETDIRFROMFILE",e[e.ADDSLASH=238]="ADDSLASH",e[e.GETSTRATUMDIR=239]="GETSTRATUMDIR",e[e.WINEXECUTE=240]="WINEXECUTE",e[e.SETSCROLLRANGE=241]="SETSCROLLRANGE",e[e.VM_GETACTUALWIDTH=242]="VM_GETACTUALWIDTH",e[e.VM_GETACTUALHEIGHT=243]="VM_GETACTUALHEIGHT",e[e.VM_SAVEIMAGE=244]="VM_SAVEIMAGE",e[e.V_LOCK2D=245]="V_LOCK2D",e[e.VM_LOADMENU=246]="VM_LOADMENU",e[e.VM_DELETEMENU=247]="VM_DELETEMENU",e[e.REGISTEROBJECTS=248]="REGISTEROBJECTS",e[e.UNREGISTEROBJECTS=249]="UNREGISTEROBJECTS",e[e.MCISENDSTRING=250]="MCISENDSTRING",e[e.MCISENDSTRING_INT=251]="MCISENDSTRING_INT",e[e.MCISENDSTRINGEX=252]="MCISENDSTRINGEX",e[e.GETLASTMCIERROR=253]="GETLASTMCIERROR",e[e.GETMCIERROR=254]="GETMCIERROR",e[e.VM_SETCALCORDER=255]="VM_SETCALCORDER",e[e.VM_GETCALCORDER=256]="VM_GETCALCORDER",e[e.VM_GETOBJECT3DFROMPOINT2D=296]="VM_GETOBJECT3DFROMPOINT2D",e[e.VM_SWEEPEXTRUDE=297]="VM_SWEEPEXTRUDE",e[e.V_ISINTERSECT2D=298]="V_ISINTERSECT2D",e[e.SETARROW2D=299]="SETARROW2D",e[e.CREATELINE2D=300]="CREATELINE2D",e[e.ADDPOINT2D=301]="ADDPOINT2D",e[e.DELPOINT2D=302]="DELPOINT2D",e[e.GETBRUSHOBJECT2D=303]="GETBRUSHOBJECT2D",e[e.GETPENOBJECT2D=304]="GETPENOBJECT2D",e[e.GETRGNCREATEMODE=305]="GETRGNCREATEMODE",e[e.GETVECTORNUMPOINTS2D=306]="GETVECTORNUMPOINTS2D",e[e.GETVECTORPOINT2DX=307]="GETVECTORPOINT2DX",e[e.GETVECTORPOINT2DY=308]="GETVECTORPOINT2DY",e[e.SETBRUSHOBJECT2D=309]="SETBRUSHOBJECT2D",e[e.SETPENOBJECT2D=310]="SETPENOBJECT2D",e[e.SETRGNCREATEMODE=311]="SETRGNCREATEMODE",e[e.SETVECTORPOINT2D=312]="SETVECTORPOINT2D",e[e.CREATEPEN2D=313]="CREATEPEN2D",e[e.GETPENCOLOR2D=314]="GETPENCOLOR2D",e[e.GETPENROP2D=315]="GETPENROP2D",e[e.GETPENSTYLE2D=316]="GETPENSTYLE2D",e[e.GETPENWIDTH2D=317]="GETPENWIDTH2D",e[e.SETPENCOLOR2D=318]="SETPENCOLOR2D",e[e.SETPENROP2D=319]="SETPENROP2D",e[e.SETPENSTYLE2D=320]="SETPENSTYLE2D",e[e.SETPENWIDTH2D=321]="SETPENWIDTH2D",e[e.DELETETOOL2D=322]="DELETETOOL2D",e[e.DELETEOBJECT2D=323]="DELETEOBJECT2D",e[e.GETOBJECTORG2DX=324]="GETOBJECTORG2DX",e[e.GETOBJECTORG2DY=325]="GETOBJECTORG2DY",e[e.GETOBJECTPARENT2D=326]="GETOBJECTPARENT2D",e[e.GETOBJECTANGLE2D=327]="GETOBJECTANGLE2D",e[e.GETOBJECTSIZE2DX=328]="GETOBJECTSIZE2DX",e[e.GETOBJECTSIZE2DY=329]="GETOBJECTSIZE2DY",e[e.GETOBJECTTYPE=330]="GETOBJECTTYPE",e[e.SETOBJECTORG2D=331]="SETOBJECTORG2D",e[e.SETOBJECTSIZE2D=332]="SETOBJECTSIZE2D",e[e.CREATEBRUSH2D=333]="CREATEBRUSH2D",e[e.SETPOINTS2D=334]="SETPOINTS2D",e[e.CREATEDID2D=335]="CREATEDID2D",e[e.CREATEDOUBLEDID2D=336]="CREATEDOUBLEDID2D",e[e.CREATERDID2D=337]="CREATERDID2D",e[e.CREATERDOUBLEDID2D=338]="CREATERDOUBLEDID2D",e[e.CREATEBITMAP2D=339]="CREATEBITMAP2D",e[e.CREATEDOUBLEBITMAP2D=340]="CREATEDOUBLEBITMAP2D",e[e.GETSPACEORGY=341]="GETSPACEORGY",e[e.GETSPACEORGX=342]="GETSPACEORGX",e[e.SETSPACEORG2D=343]="SETSPACEORG2D",e[e.SETSCALESPACE2D=344]="SETSCALESPACE2D",e[e.GETSCALESPACE2D=345]="GETSCALESPACE2D",e[e.SNDPLAYSOUND=346]="SNDPLAYSOUND",e[e.GETBOTTOMOBJECT2D=347]="GETBOTTOMOBJECT2D",e[e.GETUPPEROBJECT2D=348]="GETUPPEROBJECT2D",e[e.GETOBJECTFROMZORDER2D=349]="GETOBJECTFROMZORDER2D",e[e.GETLOWEROBJECT2D=350]="GETLOWEROBJECT2D",e[e.GETTOPOBJECT2D=351]="GETTOPOBJECT2D",e[e.GETZORDER2D=352]="GETZORDER2D",e[e.OBJECTTOBOTTOM2D=353]="OBJECTTOBOTTOM2D",e[e.OBJECTTOTOP2D=354]="OBJECTTOTOP2D",e[e.SETZORDER2D=355]="SETZORDER2D",e[e.SWAPOBJECT2D=356]="SWAPOBJECT2D",e[e.SETBITMAPSRCRECT=357]="SETBITMAPSRCRECT",e[e.SETOBJECTATTRIBUTE2D=358]="SETOBJECTATTRIBUTE2D",e[e.GETOBJECTATTRIBUTE2D=359]="GETOBJECTATTRIBUTE2D",e[e.CREATEFONT2D=360]="CREATEFONT2D",e[e.CREATESTRING2D=361]="CREATESTRING2D",e[e.CREATETEXT2D=362]="CREATETEXT2D",e[e.CREATERASTERTEXT2D=363]="CREATERASTERTEXT2D",e[e.SETSHOWOBJECT2D=364]="SETSHOWOBJECT2D",e[e.SETLOGSTRING2D=365]="SETLOGSTRING2D",e[e.ADDGROUPITEM2D=366]="ADDGROUPITEM2D",e[e.CREATEGROUP2D=367]="CREATEGROUP2D",e[e.DELETEGROUP2D=368]="DELETEGROUP2D",e[e.DELGROUPITEM2D=369]="DELGROUPITEM2D",e[e.GETGROUPITEM2D=370]="GETGROUPITEM2D",e[e.GETGROUPITEMS2D=371]="GETGROUPITEMS2D",e[e.GETGROUPITEMSNUM2D=372]="GETGROUPITEMSNUM2D",e[e.ISGROUPCONTAINOBJECT2D=373]="ISGROUPCONTAINOBJECT2D",e[e.SETGROUPITEM2D=374]="SETGROUPITEM2D",e[e.SETGROUPITEMS2D=375]="SETGROUPITEMS2D",e[e.COPYTOCLIPBOARD2D=376]="COPYTOCLIPBOARD2D",e[e.PASTEFROMCLIPBOARD2D=377]="PASTEFROMCLIPBOARD2D",e[e.GETOBJECTNAME2D=378]="GETOBJECTNAME2D",e[e.SETOBJECTNAME2D=379]="SETOBJECTNAME2D",e[e.GETOBJECTFROMPOINT2D=380]="GETOBJECTFROMPOINT2D",e[e.GETLASTPRIMARY=381]="GETLASTPRIMARY",e[e.ROTATEOBJECT2D=382]="ROTATEOBJECT2D",e[e.SHOWOBJECT2D=383]="SHOWOBJECT2D",e[e.HIDEOBJECT2D=384]="HIDEOBJECT2D",e[e.STDHYPERJUMP=385]="STDHYPERJUMP",e[e.GETCHILDCOUNT=386]="GETCHILDCOUNT",e[e.GETCHILDIDBYNUM=387]="GETCHILDIDBYNUM",e[e.GETCHILDCLASS=389]="GETCHILDCLASS",e[e.VM_CREATECONTROL2D=390]="VM_CREATECONTROL2D",e[e.VM_GETCONTROLTEXT=391]="VM_GETCONTROLTEXT",e[e.VM_SETCONTROLTEXT=392]="VM_SETCONTROLTEXT",e[e.VM_CHECKDLGBUTTON=393]="VM_CHECKDLGBUTTON",e[e.VM_ISDLGBUTTONCHECKED=394]="VM_ISDLGBUTTONCHECKED",e[e.VM_ENABLECONTROL=395]="VM_ENABLECONTROL",e[e.SETBRUSHHATCH2D=396]="SETBRUSHHATCH2D",e[e.GETLOGSTRING2D=397]="GETLOGSTRING2D",e[e.V_GETCLASS=398]="V_GETCLASS",e[e.MESSAGE=400]="MESSAGE",e[e.GETBRUSHCOLOR2D=401]="GETBRUSHCOLOR2D",e[e.GETBRUSHROP2D=402]="GETBRUSHROP2D",e[e.GETBRUSHDIB2D=403]="GETBRUSHDIB2D",e[e.GETBRUSHSTYLE2D=404]="GETBRUSHSTYLE2D",e[e.GETBRUSHHATCH2D=405]="GETBRUSHHATCH2D",e[e.SETBRUSHCOLOR2D=406]="SETBRUSHCOLOR2D",e[e.SETBRUSHROP2D=407]="SETBRUSHROP2D",e[e.SETBRUSHDIB2D=408]="SETBRUSHDIB2D",e[e.SETBRUSHSTYLE2D=409]="SETBRUSHSTYLE2D",e[e.VM_ADDCHILDREN=410]="VM_ADDCHILDREN",e[e.VM_REMOVECHILDREN=411]="VM_REMOVECHILDREN",e[e.VM_CREATECLASS=412]="VM_CREATECLASS",e[e.VM_DELETECLASS=413]="VM_DELETECLASS",e[e.VM_OPENCLASSSCHEME=414]="VM_OPENCLASSSCHEME",e[e.VM_CLOSECLASSSCHEME=415]="VM_CLOSECLASSSCHEME",e[e.VM_CREATELINK=416]="VM_CREATELINK",e[e.VM_SETLINKVARS=417]="VM_SETLINKVARS",e[e.VM_REMOVELINK=418]="VM_REMOVELINK",e[e.VM_GETUNIQUCLASSNAME=419]="VM_GETUNIQUCLASSNAME",e[e.V_GETSCHEMEOBJECT=420]="V_GETSCHEMEOBJECT",e[e.V_CREATEWINDOWEX=421]="V_CREATEWINDOWEX",e[e.V_GETVARF=430]="V_GETVARF",e[e.V_GETVARS=431]="V_GETVARS",e[e.V_GETVARH=432]="V_GETVARH",e[e.V_SETVARF=433]="V_SETVARF",e[e.V_SETVARS=434]="V_SETVARS",e[e.V_SETVARH=435]="V_SETVARH",e[e.VM_CREATELINK2=436]="VM_CREATELINK2",e[e.VM_SETMODELTEXT=437]="VM_SETMODELTEXT",e[e.VM_GETMODELTEXT=438]="VM_GETMODELTEXT",e[e.VM_GETANGLEBYXY=439]="VM_GETANGLEBYXY",e[e.GETOBJECTFROMPOINT2DEX=440]="GETOBJECTFROMPOINT2DEX",e[e.VM_OPENVIDEO=441]="VM_OPENVIDEO",e[e.VM_CLOSEVIDEO=442]="VM_CLOSEVIDEO",e[e.VM_CREATEVIDEOFRAME2D=446]="VM_CREATEVIDEOFRAME2D",e[e.VM_VIDEOSETPOS=447]="VM_VIDEOSETPOS",e[e.VM_FRAMESETPOS2D=448]="VM_FRAMESETPOS2D",e[e.VM_VIDEOPLAY2D=449]="VM_VIDEOPLAY2D",e[e.VM_VIDEOPAUSE2D=450]="VM_VIDEOPAUSE2D",e[e.VM_VIDEORESUME2D=451]="VM_VIDEORESUME2D",e[e.VM_VIDEOSTOP2D=452]="VM_VIDEOSTOP2D",e[e.VM_SETVIDEOSRC2D=453]="VM_SETVIDEOSRC2D",e[e.VM_VIDEOGETPOS=454]="VM_VIDEOGETPOS",e[e.VM_FRAMEGETPOS=455]="VM_FRAMEGETPOS",e[e.VM_FRAMEGETHVIDEO=456]="VM_FRAMEGETHVIDEO",e[e.VM_BEGINWRITEVIDEO=457]="VM_BEGINWRITEVIDEO",e[e.VM_VIDEOCOMPRESSDIALOG=458]="VM_VIDEOCOMPRESSDIALOG",e[e.VM_WRITEFRAME=459]="VM_WRITEFRAME",e[e.SETCONTROLSTYLE2D=460]="SETCONTROLSTYLE2D",e[e.GETCONTROLSTYLE2D=461]="GETCONTROLSTYLE2D",e[e.LBADDSTRING=462]="LBADDSTRING",e[e.LBINSERTSTRING=463]="LBINSERTSTRING",e[e.LBGETSTRING=464]="LBGETSTRING",e[e.LBCLEARLIST=465]="LBCLEARLIST",e[e.LBDELETESTRING=466]="LBDELETESTRING",e[e.LBGETCOUNT=467]="LBGETCOUNT",e[e.LBGETSELINDEX=468]="LBGETSELINDEX",e[e.LBSETSELINDEX=469]="LBSETSELINDEX",e[e.LBGETCARETINDEX=470]="LBGETCARETINDEX",e[e.LBSETCARETINDEX=471]="LBSETCARETINDEX",e[e.LBFINDSTRING=472]="LBFINDSTRING",e[e.LBFINDSTRINGEXACT=473]="LBFINDSTRINGEXACT",e[e.GETPIXEL2D=474]="GETPIXEL2D",e[e.VM_GETTIME=475]="VM_GETTIME",e[e.PUSHPTR=476]="PUSHPTR",e[e.PUSHPTRNEW=477]="PUSHPTRNEW",e[e.VFUNCTION=478]="VFUNCTION",e[e.DLLFUNCTION=479]="DLLFUNCTION",e[e.GETELEMENT=480]="GETELEMENT",e[e.SETELEMENT=481]="SETELEMENT",e[e.EMPTYSPACE2D=482]="EMPTYSPACE2D",e[e.CREATEPOLYLINE2D=485]="CREATEPOLYLINE2D",e[e.VM_GETNAMEBYHANDLE=486]="VM_GETNAMEBYHANDLE",e[e.V_SETSPACELAYERS=487]="V_SETSPACELAYERS",e[e.V_GETSPACELAYERS=488]="V_GETSPACELAYERS",e[e.V_GETOBJECTLAYER2D=489]="V_GETOBJECTLAYER2D",e[e.V_SETOBJECTLAYER2D=490]="V_SETOBJECTLAYER2D",e[e.VM_SCMESSAGE=491]="VM_SCMESSAGE",e[e.VM_SETVARTODEF=492]="VM_SETVARTODEF",e[e.GETTEXTOBJECT2D=493]="GETTEXTOBJECT2D",e[e.GETTEXTSTRING2D=494]="GETTEXTSTRING2D",e[e.GETTEXTFONT2D=495]="GETTEXTFONT2D",e[e.VM_LOADOBJECTSTATE=496]="VM_LOADOBJECTSTATE",e[e.VM_SAVEOBJECTSTATE=497]="VM_SAVEOBJECTSTATE",e[e.VM_GETWINDOWPROP=498]="VM_GETWINDOWPROP",e[e.VM_CAMERAPROC=499]="VM_CAMERAPROC",e[e.DB_OPENBASE=500]="DB_OPENBASE",e[e.DB_OPENTABLE=501]="DB_OPENTABLE",e[e.DB_CLOSEBASE=502]="DB_CLOSEBASE",e[e.DB_CLOSETABLE=503]="DB_CLOSETABLE",e[e.DB_GETERROR=504]="DB_GETERROR",e[e.DB_GETERRORSTR=505]="DB_GETERRORSTR",e[e.DB_SETDIR=506]="DB_SETDIR",e[e.DB_CLOSEALLBASES=507]="DB_CLOSEALLBASES",e[e.DB_GOTOP=508]="DB_GOTOP",e[e.DB_GOBOTTOM=509]="DB_GOBOTTOM",e[e.DB_SKIP=510]="DB_SKIP",e[e.DB_GETFID=511]="DB_GETFID",e[e.DB_GETFSTR=512]="DB_GETFSTR",e[e.DB_SELECT=513]="DB_SELECT",e[e.DB_GETCOUNT=514]="DB_GETCOUNT",e[e.DB_BROWSE=515]="DB_BROWSE",e[e.DB_GETDOUBLE=516]="DB_GETDOUBLE",e[e.DB_GETFNAME=517]="DB_GETFNAME",e[e.DB_GETFTYPE=518]="DB_GETFTYPE",e[e.DB_INSERTRECORD=519]="DB_INSERTRECORD",e[e.DB_APPENDRECORD=520]="DB_APPENDRECORD",e[e.DB_DELETERECORD=521]="DB_DELETERECORD",e[e.DB_SETFIELD=522]="DB_SETFIELD",e[e.DB_SETFIELDNUM=523]="DB_SETFIELDNUM",e[e.DB_SSETFIELD=524]="DB_SSETFIELD",e[e.DB_SSETFIELDNUM=525]="DB_SSETFIELDNUM",e[e.DB_SGETDOUBLE=526]="DB_SGETDOUBLE",e[e.DB_SGETFSTR=527]="DB_SGETFSTR",e[e.DB_CREATETABLE=528]="DB_CREATETABLE",e[e.DB_ZAP=529]="DB_ZAP",e[e.DB_ADDINDEX=530]="DB_ADDINDEX",e[e.DB_DELETEINDEX=531]="DB_DELETEINDEX",e[e.DB_OPENINDEX=532]="DB_OPENINDEX",e[e.DB_SWITCHTOINDEX=533]="DB_SWITCHTOINDEX",e[e.DB_CLOSEINDEX=534]="DB_CLOSEINDEX",e[e.DB_REGENINDEX=535]="DB_REGENINDEX",e[e.DB_READBLOB=536]="DB_READBLOB",e[e.DB_WRITEBLOB=537]="DB_WRITEBLOB",e[e.DB_FREEBLOB=538]="DB_FREEBLOB",e[e.DB_PACKTABLE=539]="DB_PACKTABLE",e[e.DB_SORTTABLE=540]="DB_SORTTABLE",e[e.DB_GETDELMODE=541]="DB_GETDELMODE",e[e.DB_SETDELMODE=542]="DB_SETDELMODE",e[e.DB_SETCODEPAGE=543]="DB_SETCODEPAGE",e[e.DB_GETCODEPAGE=544]="DB_GETCODEPAGE",e[e.DB_LOCK=545]="DB_LOCK",e[e.DB_UNLOCK=546]="DB_UNLOCK",e[e.DB_UNDELETE=547]="DB_UNDELETE",e[e.DB_COPYTO=548]="DB_COPYTO",e[e.DB_SETTOKEY=549]="DB_SETTOKEY",e[e.DB_GETFCOUNT=550]="DB_GETFCOUNT",e[e.DB_SETWINTABLE=580]="DB_SETWINTABLE",e[e.DB_SETCONTROLTABLE=581]="DB_SETCONTROLTABLE",e[e.DB_RECNO=582]="DB_RECNO",e[e.VM_BDEMIN=500]="VM_BDEMIN",e[e.VM_BDEMAX=599]="VM_BDEMAX",e[e.VM_SENDMESSAGE=600]="VM_SENDMESSAGE",e[e.VM_SETIMAGENAME=601]="VM_SETIMAGENAME",e[e.VM_SETLOGTEXT2D=602]="VM_SETLOGTEXT2D",e[e.GETTEXTFG2D=603]="GETTEXTFG2D",e[e.GETTEXTBK2D=604]="GETTEXTBK2D",e[e.VM_DIALOG=605]="VM_DIALOG",e[e.VM_DIALOGEX=606]="VM_DIALOGEX",e[e.VM_GETLINK=607]="VM_GETLINK",e[e.VM_DIALOGEX2=608]="VM_DIALOGEX2",e[e.VM_GETRVALUE=609]="VM_GETRVALUE",e[e.VM_GETGVALUE=610]="VM_GETGVALUE",e[e.VM_GETBVALUE=611]="VM_GETBVALUE",e[e.VM_GETTOOLREF2D=612]="VM_GETTOOLREF2D",e[e.VM_GETNEXTTOOL2D=613]="VM_GETNEXTTOOL2D",e[e.VM_GETNEXTOBJECT=614]="VM_GETNEXTOBJECT",e[e.VM_GETOBJECTPOINT3D=635]="VM_GETOBJECTPOINT3D",e[e.VM_SETOBJECTPOINT3D=636]="VM_SETOBJECTPOINT3D",e[e.VM_SETPRIMITIVE3D=637]="VM_SETPRIMITIVE3D",e[e.VM_CREATEOBJECT3D=638]="VM_CREATEOBJECT3D",e[e.VM_DELPRIMITIVE3D=639]="VM_DELPRIMITIVE3D",e[e.VM_GETNUMPRIMITIVES3D=640]="VM_GETNUMPRIMITIVES3D",e[e.VM_ADDPRIMITIVE3D=641]="VM_ADDPRIMITIVE3D",e[e.VM_DELPOINT3D=642]="VM_DELPOINT3D",e[e.VM_GETNUMPOINTS3D=643]="VM_GETNUMPOINTS3D",e[e.VM_ADDOBJECTPOINT3D=644]="VM_ADDOBJECTPOINT3D",e[e.VM_SETMATRIX3D=645]="VM_SETMATRIX3D",e[e.VM_GETMATRIX3D=646]="VM_GETMATRIX3D",e[e.VM_TRANSFORMPOINTS3D=647]="VM_TRANSFORMPOINTS3D",e[e.VM_ROTATEPOINTS3D=648]="VM_ROTATEPOINTS3D",e[e.VM_GETOBJECTBASE3D=649]="VM_GETOBJECTBASE3D",e[e.VM_SETOBJECTBASE3D=650]="VM_SETOBJECTBASE3D",e[e.VM_GETBASE3D_2=651]="VM_GETBASE3D_2",e[e.VM_GETSPACE3D=652]="VM_GETSPACE3D",e[e.VM_GETDIM3D=653]="VM_GETDIM3D",e[e.VM_TRANSFORM3D=654]="VM_TRANSFORM3D",e[e.VM_ROTATE3D=655]="VM_ROTATE3D",e[e.VM_SETCOLOR3D=656]="VM_SETCOLOR3D",e[e.VM_CREATEDEFCAMERA3D=657]="VM_CREATEDEFCAMERA3D",e[e.VM_SWITCHTOCAMERA3D=658]="VM_SWITCHTOCAMERA3D",e[e.VM_GETACTIVECAMERA3D=659]="VM_GETACTIVECAMERA3D",e[e.VM_CREATESPACE3D=660]="VM_CREATESPACE3D",e[e.VM_DELETESPACE3D=661]="VM_DELETESPACE3D",e[e.VM_CREATEPROJECTION=662]="VM_CREATEPROJECTION",e[e.VM_GETPOINTS3D=663]="VM_GETPOINTS3D",e[e.VM_SETPOINTS3D=664]="VM_SETPOINTS3D",e[e.VM_GETCOLOR3D=665]="VM_GETCOLOR3D",e[e.VM_SETCURRENTOBJ2D=666]="VM_SETCURRENTOBJ2D",e[e.VM_GETCURRENTOBJ2D=667]="VM_GETCURRENTOBJ2D",e[e.VM_MAKEFACE3D=668]="VM_MAKEFACE3D",e[e.VM_FITTOCAMERA3D=669]="VM_FITTOCAMERA3D",e[e.VM_CREATEMATERIAL=670]="VM_CREATEMATERIAL",e[e.PUSHCRDSYSTEM3D=671]="PUSHCRDSYSTEM3D",e[e.POPCRDSYSTEM3D=672]="POPCRDSYSTEM3D",e[e.SELECTLOCALCRD3D=673]="SELECTLOCALCRD3D",e[e.SELECTWORLDCRD3D=674]="SELECTWORLDCRD3D",e[e.SELECTVIEWCRD3D=675]="SELECTVIEWCRD3D",e[e.VM_TRCAMERA3D=676]="VM_TRCAMERA3D",e[e.VM_SETCOLORS3D=677]="VM_SETCOLORS3D",e[e.VM_GETCOLORS3D=678]="VM_GETCOLORS3D",e[e.VM_GETMATERIALs=679]="VM_GETMATERIALs",e[e.VM_new=700]="VM_new",e[e.VM_delete=701]="VM_delete",e[e.VM_VCLEARALL=702]="VM_VCLEARALL",e[e.VM_VINSERT=703]="VM_VINSERT",e[e.VM_VDELETE=704]="VM_VDELETE",e[e.VM_VGETCOUNT=705]="VM_VGETCOUNT",e[e.VM_VGETTYPE=706]="VM_VGETTYPE",e[e.VM_VGETf=707]="VM_VGETf",e[e.VM_VGETs=708]="VM_VGETs",e[e.VM_VGETh=709]="VM_VGETh",e[e.VM_VSETf=710]="VM_VSETf",e[e.VM_VSETs=711]="VM_VSETs",e[e.VM_VSETh=712]="VM_VSETh",e[e.VM_GETCONTROLTEXTH=713]="VM_GETCONTROLTEXTH",e[e.VM_SETCONTROLTEXTH=714]="VM_SETCONTROLTEXTH",e[e.VM_LOADPROJECT=720]="VM_LOADPROJECT",e[e.VM_UNLOADPROJECT=721]="VM_UNLOADPROJECT",e[e.VM_SETACTIVEPROJECT=722]="VM_SETACTIVEPROJECT",e[e.VM_ISPROJECTEXIST=723]="VM_ISPROJECTEXIST",e[e.VM_EXECUTEPROJECT=724]="VM_EXECUTEPROJECT",e[e.VM_SETPROJECTPROP=725]="VM_SETPROJECTPROP",e[e.VM_GETPROJECTPROP=726]="VM_GETPROJECTPROP",e[e.VM_GETPROJECTPROPS=727]="VM_GETPROJECTPROPS",e[e.VM_APPLYTEXTUTRE=728]="VM_APPLYTEXTUTRE",e[e.VM_REMOVETEXTURE=729]="VM_REMOVETEXTURE",e[e.VM_CREATEDIR=730]="VM_CREATEDIR",e[e.VM_DELETEDIR=731]="VM_DELETEDIR",e[e.VM_FILERENAME=732]="VM_FILERENAME",e[e.VM_FILECOPY=733]="VM_FILECOPY",e[e.VM_FILEEXIST=734]="VM_FILEEXIST",e[e.VM_FILEDELETE=735]="VM_FILEDELETE",e[e.VM_GETFILELIST=736]="VM_GETFILELIST",e[e.VM_GETACTUALSIZE=737]="VM_GETACTUALSIZE",e[e.VM_SETBKBRUSH=738]="VM_SETBKBRUSH",e[e.VM_GETBKBRUSH=739]="VM_GETBKBRUSH",e[e.VM_DIFF1=740]="VM_DIFF1",e[e.VM_EQUATION=741]="VM_EQUATION",e[e.VM_DIFF2=742]="VM_DIFF2",e[e.VM_DEQUATION=743]="VM_DEQUATION",e[e.VM_GETDIBOBJECT2D=744]="VM_GETDIBOBJECT2D",e[e.VM_SETDIBOBJECT2D=745]="VM_SETDIBOBJECT2D",e[e.VM_GETDDIBOBJECT2D=746]="VM_GETDDIBOBJECT2D",e[e.VM_SETDDIBOBJECT2D=747]="VM_SETDDIBOBJECT2D",e[e.VM_GETDATE=748]="VM_GETDATE",e[e.VM_VIDEOGETMARKER=749]="VM_VIDEOGETMARKER",e[e.VM_GETVARINFO=750]="VM_GETVARINFO",e[e.VM_GETVARCOUNT=751]="VM_GETVARCOUNT",e[e.VM_VSTORE=752]="VM_VSTORE",e[e.VM_VLOAD=753]="VM_VLOAD",e[e.GETBITMAPSRCRECT=754]="GETBITMAPSRCRECT",e[e.VM_SETHYPERJUMP=755]="VM_SETHYPERJUMP",e[e.SETRDIB2D=756]="SETRDIB2D",e[e.SSETRDDIB2D=757]="SSETRDDIB2D",e[e.GETRDIB2D=758]="GETRDIB2D",e[e.GETRDDIB2D=759]="GETRDDIB2D",e[e.V_MSORT=760]="V_MSORT",e[e.VM_DUPLICATEOBJECT3D=761]="VM_DUPLICATEOBJECT3D",e[e.VM_CHECKMENU=762]="VM_CHECKMENU",e[e.VM_ENABLEMENU=763]="VM_ENABLEMENU",e[e.PLUS_STRING_FLOAT=770]="PLUS_STRING_FLOAT",e[e.PLUS_FLOAT_STRING=771]="PLUS_FLOAT_STRING",e[e.VM_GETSCREENWIDTH=772]="VM_GETSCREENWIDTH",e[e.VM_GETSCREENHEIGHT=773]="VM_GETSCREENHEIGHT",e[e.VM_GETWORKAREAX=774]="VM_GETWORKAREAX",e[e.VM_GETWORKAREAY=775]="VM_GETWORKAREAY",e[e.VM_GETWORKAREAWIDTH=776]="VM_GETWORKAREAWIDTH",e[e.VM_GETWORKAREAHEIGHT=777]="VM_GETWORKAREAHEIGHT",e[e.VM_GETKEYBOARDLAYOUT=778]="VM_GETKEYBOARDLAYOUT",e[e.VM_SUBSTR1_STRING=779]="VM_SUBSTR1_STRING",e[e.VM_SETBRUSHOBJECT2D_HANDLE=780]="VM_SETBRUSHOBJECT2D_HANDLE",e[e.VM_SETPENOBJECT2D_HANDLE=781]="VM_SETPENOBJECT2D_HANDLE",e[e.VM_SETWINDOWTRANSPARENT=782]="VM_SETWINDOWTRANSPARENT",e[e.VM_SETWINDOWTRANSPARENT_H=793]="VM_SETWINDOWTRANSPARENT_H",e[e.VM_SETWINDOWTRANSPARENTCOLOR=783]="VM_SETWINDOWTRANSPARENTCOLOR",e[e.VM_SETWINDOWTRANSPARENTCOLOR_H=794]="VM_SETWINDOWTRANSPARENTCOLOR_H",e[e.VM_SETWINDOWREGION=784]="VM_SETWINDOWREGION",e[e.VM_SETWINDOWREGION_H=795]="VM_SETWINDOWREGION_H",e[e.VM_GETTITLEHEIGHT=785]="VM_GETTITLEHEIGHT",e[e.VM_GETSMALLTITLEHEIGHT=786]="VM_GETSMALLTITLEHEIGHT",e[e.VM_GETFIXEDFRAMEHEIGHT=787]="VM_GETFIXEDFRAMEHEIGHT",e[e.VM_GETFIXEDFRAMEWIDTH=788]="VM_GETFIXEDFRAMEWIDTH",e[e.VM_GETSIZEFRAMEHEIGHT=789]="VM_GETSIZEFRAMEHEIGHT",e[e.VM_GETSIZEFRAMEWIDTH=790]="VM_GETSIZEFRAMEWIDTH",e[e.VM_WINDOWINTASKBAR_H=791]="VM_WINDOWINTASKBAR_H",e[e.VM_WINDOWINTASKBAR_S=792]="VM_WINDOWINTASKBAR_S",e[e.VM_SHOWCURSOR=796]="VM_SHOWCURSOR",e[e.VM_SCREENSHOT=797]="VM_SCREENSHOT",e[e.VM_SCREENSHOT_FULL=842]="VM_SCREENSHOT_FULL",e[e.VM_SCREENSHOT_DESKTOP=844]="VM_SCREENSHOT_DESKTOP",e[e.VM_SCREENSHOT_DESKTOP_FULL=845]="VM_SCREENSHOT_DESKTOP_FULL",e[e.VM_LOCKOBJECT2D=798]="VM_LOCKOBJECT2D",e[e.VM_GETVARINFOFULL=799]="VM_GETVARINFOFULL",e[e.VM_INCREMENT_AFTER=800]="VM_INCREMENT_AFTER",e[e.VM_SENDSMS=841]="VM_SENDSMS",e[e.VM_SENDMAIL=843]="VM_SENDMAIL",e[e.VM_GETFONTNAME2D=846]="VM_GETFONTNAME2D",e[e.VM_GETFONTSIZE2D=847]="VM_GETFONTSIZE2D",e[e.VM_GETTEXTCOUNT2D=848]="VM_GETTEXTCOUNT2D",e[e.VM_GETFONTSTYLE2D=849]="VM_GETFONTSTYLE2D",e[e.VM_SETFONTSIZE2D=850]="VM_SETFONTSIZE2D",e[e.VM_SETFONTSTYLE2D=851]="VM_SETFONTSTYLE2D",e[e.VM_SETFONTNAME2D=852]="VM_SETFONTNAME2D",e[e.VM_GETTEXTSTRING2D_I=853]="VM_GETTEXTSTRING2D_I",e[e.VM_GETTEXTFONT2D_I=854]="VM_GETTEXTFONT2D_I",e[e.VM_GETTEXTFG2D_I=855]="VM_GETTEXTFG2D_I",e[e.VM_GETTEXTBG2D_I=856]="VM_GETTEXTBG2D_I",e[e.VM_SETTEXTSTRING2D_I=857]="VM_SETTEXTSTRING2D_I",e[e.VM_SETTEXTFONT2D_I=858]="VM_SETTEXTFONT2D_I",e[e.VM_SETTEXTFG2D_I=859]="VM_SETTEXTFG2D_I",e[e.VM_SETTEXTBG2D_I=860]="VM_SETTEXTBG2D_I",e[e.VM_SETTEXT2D_I=861]="VM_SETTEXT2D_I",e[e.VM_CREATEFONT2DPT=862]="VM_CREATEFONT2DPT",e[e.VM_SETSTANDARTCURSOR=863]="VM_SETSTANDARTCURSOR",e[e.VM_SETSTANDARTCURSOR_S=864]="VM_SETSTANDARTCURSOR_S",e[e.VM_LOADCURSOR=865]="VM_LOADCURSOR",e[e.VM_LOADCURSOR_S=866]="VM_LOADCURSOR_S",e[e.VM_INC=867]="VM_INC",e[e.VM_INC_STEP=868]="VM_INC_STEP",e[e.VM_DEC=869]="VM_DEC",e[e.VM_DEC_STEP=870]="VM_DEC_STEP",e[e.VM_LIMIT=871]="VM_LIMIT",e[e.VM_GETFONTLIST=872]="VM_GETFONTLIST",e[e.VM_VSORT=873]="VM_VSORT",e[e.VM_VSORT_ASC=874]="VM_VSORT_ASC",e[e.VM_VSORT_DIFFERENT=875]="VM_VSORT_DIFFERENT",e[e.VM_GETUSERKEYVALUE=876]="VM_GETUSERKEYVALUE",e[e.VM_GETUSERKEYFULLVALUE=877]="VM_GETUSERKEYFULLVALUE",e[e.VM_SENDUSERRESULT=879]="VM_SENDUSERRESULT",e[e.VM_COPYUSERRESULT=880]="VM_COPYUSERRESULT",e[e.VM_USERKEYISAUTORIZED=889]="VM_USERKEYISAUTORIZED",e[e.VM_USERKEYISAUTORIZED_UK=890]="VM_USERKEYISAUTORIZED_UK",e[e.VM_READUSERKEY=883]="VM_READUSERKEY",e[e.VM_READPROJECTKEY=888]="VM_READPROJECTKEY",e[e.VM_GETUSERKEYVALUE_UK=884]="VM_GETUSERKEYVALUE_UK",e[e.VM_GETUSERKEYFULLVALUE_UK=885]="VM_GETUSERKEYFULLVALUE_UK",e[e.VM_SENDUSERRESULT_UK=886]="VM_SENDUSERRESULT_UK",e[e.VM_COPYUSERRESULT_UK=887]="VM_COPYUSERRESULT_UK",e[e.VM_GETTEMPDIRECTORY=878]="VM_GETTEMPDIRECTORY",e[e.VM_GETROMDRIVENAMES=881]="VM_GETROMDRIVENAMES",e[e.VM_SHELLWAIT=882]="VM_SHELLWAIT",e[e.VM_SETCONTROLFONT=1101]="VM_SETCONTROLFONT",e[e.VM_SETCONTROLTEXTCOLOR=1102]="VM_SETCONTROLTEXTCOLOR",e[e.VM_GETCONTROLTEXTLENGTH=1103]="VM_GETCONTROLTEXTLENGTH",e[e.VM_GETCONTROLTEXTPART=1104]="VM_GETCONTROLTEXTPART",e[e.VM_ADDCONTROLTEXT=1105]="VM_ADDCONTROLTEXT",e[e.VM_INSERTCONTROLTEXT=1106]="VM_INSERTCONTROLTEXT",e[e.VM_SETWINDOWOWNER=1107]="VM_SETWINDOWOWNER",e[e.VM_SETWINDOWPARENT=1108]="VM_SETWINDOWPARENT",e[e.VM_GETPROJECTCLASSES=1109]="VM_GETPROJECTCLASSES",e[e.VM_GETCLASSFILE=1110]="VM_GETCLASSFILE",e[e.VM_INSERTTEXT2D=1111]="VM_INSERTTEXT2D",e[e.VM_REMOVETEXT2D=1112]="VM_REMOVETEXT2D",e[e.VM_ADDTEXT2D=1113]="VM_ADDTEXT2D",e[e.VM_LBGETSELINDEXS=1114]="VM_LBGETSELINDEXS",e[e.VM_SETSTRINGBUFFERMODE=1115]="VM_SETSTRINGBUFFERMODE",e[e.VM_SETMODELTEXTWITHOUTERROR=1116]="VM_SETMODELTEXTWITHOUTERROR",e[e.VM_SENDSMSWAIT=1117]="VM_SENDSMSWAIT",e[e.VM_SENDMAILWAIT=1118]="VM_SENDMAILWAIT",e[e.VM_SETCONTROLFOCUS=1119]="VM_SETCONTROLFOCUS",e[e.VM_DBSQLH=1120]="VM_DBSQLH",e[e.VM_SETOBJECTALPHA2D=1121]="VM_SETOBJECTALPHA2D",e[e.VM_GETOBJECTALPHA2D=1122]="VM_GETOBJECTALPHA2D",e[e.VM_SETBRUSHPOINTS2D=1123]="VM_SETBRUSHPOINTS2D",e[e.VM_SETBRUSHCOLORS2D=1124]="VM_SETBRUSHCOLORS2D",e[e.VM_SETPIXEL2D=1125]="VM_SETPIXEL2D",e[e.VM_ENCRYPTSTREAM=1126]="VM_ENCRYPTSTREAM",e[e.VM_SENDDATA=1127]="VM_SENDDATA",e[e.VM_DECRYPTSTREAM=1128]="VM_DECRYPTSTREAM",e[e.VM_ROUNDT=1129]="VM_ROUNDT",e[e.VM_SETSPACERENDERERENGINE2D=1130]="VM_SETSPACERENDERERENGINE2D",e[e.VM_AUDIOOPENDEVICE=801]="VM_AUDIOOPENDEVICE",e[e.VM_AUDIOOPENSOUND=802]="VM_AUDIOOPENSOUND",e[e.VM_AUDIOPLAY=803]="VM_AUDIOPLAY",e[e.VM_AUDIOSTOP=804]="VM_AUDIOSTOP",e[e.VM_AUDIOISPLAYING=805]="VM_AUDIOISPLAYING",e[e.VM_AUDIORESET=806]="VM_AUDIORESET",e[e.VM_AUDIOSETREPEAT=807]="VM_AUDIOSETREPEAT",e[e.VM_AUDIOGETREPEAT=808]="VM_AUDIOGETREPEAT",e[e.VM_AUDIOSETVOLUME=809]="VM_AUDIOSETVOLUME",e[e.VM_AUDIOGETVOLUME=810]="VM_AUDIOGETVOLUME",e[e.VM_AUDIOSETBALANCE=811]="VM_AUDIOSETBALANCE",e[e.VM_AUDIOGETBALANCE=812]="VM_AUDIOGETBALANCE",e[e.VM_AUDIOSETTONE=813]="VM_AUDIOSETTONE",e[e.VM_AUDIOGETTONE=814]="VM_AUDIOGETTONE",e[e.VM_AUDIOISSEEKABLE=815]="VM_AUDIOISSEEKABLE",e[e.VM_AUDIOSETPOSITION=816]="VM_AUDIOSETPOSITION",e[e.VM_AUDIOGETPOSITION=817]="VM_AUDIOGETPOSITION",e[e.VM_AUDIOGETLENGTH=818]="VM_AUDIOGETLENGTH",e[e.VM_AUDIODELETESOUND=819]="VM_AUDIODELETESOUND",e[e.VM_AUDIODELETEDEVICE=820]="VM_AUDIODELETEDEVICE",e[e.VM_MAXIMUM_code=1600]="VM_MAXIMUM_code"})(v||(v={}));const Je=new Array(v.VM_MAXIMUM_code);(function(){function e(t,r){if(Je[t])throw"Operand already set: "+t;Je[t]=r}e(v.PUSH_FLOAT_const,"double"),e(v.vmPUSH_LONG_const,"long"),e(v.PUSH_STRING_CONST,"string"),e(v.V_JMP,"codepoint"),e(v.V_JNZ,"codepoint"),e(v.V_JZ,"codepoint"),e(v.V_JNZ_HANDLE,"codepoint"),e(v.V_JZ_HANDLE,"codepoint"),e(v.PUSH_FLOAT,"varId"),e(v._PUSH_FLOAT,"varId"),e(v._POP_FLOAT,"varId"),e(v._POP_FLOAT_OLD,"varId"),e(v.vmPUSH_LONG,"varId"),e(v.vm_PUSH_LONG,"varId"),e(v.vm_POP_LONG,"varId"),e(v.vm_POP_LONG_OLD,"varId"),e(v.PUSH_STRING,"varId"),e(v._PUSH_STRING,"varId"),e(v._POP_STRING,"varId"),e(v._POP_STRING_OLD,"varId"),e(v.PUSHPTR,"varId"),e(v.PUSHPTRNEW,"varId"),e(v.V_SYSTEM,"argCount"),e(v.CREATEGROUP2D,"argCount"),e(v.VM_SENDMESSAGE,"argCount"),e(v.SETGROUPITEMS2D,"argCount"),e(v.CREATEPOLYLINE2D,"argCount"),e(v.VM_ADDPRIMITIVE3D,"argCount"),e(v.VFUNCTION,"funcSignature"),e(v.DLLFUNCTION,"dllFuncSignature")})();const ut=new Uint8Array(2);function Oi(e){const t=e.popDouble();e.pushDouble(ut[t])}function Ri(e){e.executionStopped=!0}const ji={1:"AboutDialog",2:"\u0412\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043D\u043E\u043C\u0435\u0440 \u0432\u0435\u0440\u0441\u0438\u0438 \u043F\u043E\u0441\u0442\u0440\u043E\u0439\u043A\u0438",3:"\u0414\u0438\u0430\u043B\u043E\u0433 \u0441 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0435\u0439 \u043E \u0441\u0438\u0441\u0442\u0435\u043C\u0435",4:"\u0427\u0438\u0441\u043B\u043E \u0448\u0430\u0433\u043E\u0432 \u0441 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0433\u043E \u0437\u0430\u043F\u0443\u0441\u043A\u0430",6:"\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0432\u0441\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430\u043B\u044C\u043D\u044B\u0435 \u043F\u0430\u043D\u0435\u043B\u0438 (0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)",8:`\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0441\u0442\u0440\u043E\u043A\u0443 \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F( 0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C
        1 - \u0441\u0432\u0435\u0440\u0445\u0443
        2 - \u0441\u043D\u0438\u0437\u0443)`,10:"\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0435 \u043C\u0435\u043D\u044E ( 0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)",20:`\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0432\u0441\u0435 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B (\u0441\u0442\u0440\u043E\u043A\u0430
        \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F, \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430\u043B\u044C\u043D\u044B\u0435 \u043F\u0430\u043D\u0435\u043B\u0438 , \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0435 \u043C\u0435\u043D\u044E).
        \u0421\u0442\u0440\u043E\u043A\u0430 \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u0441\u043D\u0438\u0437\u0443.
        (0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)`,21:`Float(Hspace),
        Float(Hobject)
        \u0412\u044B\u0437\u043E\u0432 \u0434\u0438\u0430\u043B\u043E\u0433\u0430 \u0441\u043E \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430\u043C\u0438 \u0434\u0432\u0443\u0445\u043C\u0435\u0440\u043D\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430`,22:`Float(Hspace),
        Float(Hobject)
        \u0412\u044B\u0437\u043E\u0432 \u0434\u0438\u0430\u043B\u043E\u0433\u0430 \u0441\u043E \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430\u043C\u0438 \u0442\u0440\u0435\u0445\u043C\u0435\u0440\u043D\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430`};function Ai(e,t){const r=new Array(t);for(let n=t-1;n>=0;n--)r[n]=e.popDouble();const i=e.popDouble();console.warn(`\u0412\u044B\u0437\u043E\u0432 System(${i}, ${r})
${ji[i]}`),e.pushDouble(1)}function Ii(e){e.pushString(e.project.getClassDirectory(e.popString()))}function Li(e){e.pushDouble(e.project.isFileExist(e.popString()))}function Ni(e){const t=e.popString();e.pushString(t[t.length-1]==="\\"?t:t+"\\")}function Le(e,t,r){e.memoryManager.newDoubleValues[e.classVars.globalIds[t]]=r}function Ne(e,t,r){e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]]=r}function Mi(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.popLong(),s=e.popLong(),a=new Date;t?Le(e,r,a.getDate()):Ne(e,r,a.getDate()),i?Le(e,n,a.getMonth()):Ne(e,n,a.getMonth()),o?Le(e,s,a.getFullYear()):Ne(e,s,a.getFullYear())}function Pi(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.popLong(),s=e.popLong(),a=e.popLong(),l=e.popLong(),c=new Date;t?Le(e,r,c.getMilliseconds()):Ne(e,r,c.getMilliseconds()),i?Le(e,n,c.getSeconds()):Ne(e,n,c.getSeconds()),o?Le(e,s,c.getMinutes()):Ne(e,s,c.getMinutes()),a?Le(e,l,c.getHours()):Ne(e,l,c.getHours())}function ki(e){e.pushDouble(e.windows.screenWidth)}function Fi(e){e.pushDouble(e.windows.screenHeight)}function Bi(e){e.pushDouble(e.windows.areaOriginX)}function Gi(e){e.pushDouble(e.windows.areaOriginY)}function Vi(e){e.pushDouble(e.windows.areaWidth)}function Hi(e){e.pushDouble(e.windows.areaHeight)}const Wi=new Date().getTime();function Ui(e){e.pushDouble(new Date().getTime()-Wi)}function Xi(e){const t=e.popDouble(),r=e.popLong(),i=e.popDouble(),n=e.popDouble(),o=e.popLong(),s=e.windows.getSpace(o);if(!s)return;const a=s.getObject(r);if(!a)return;console.warn(`\u0412\u044B\u0437\u043E\u0432 StdHyperJump(${o}, ${n}, ${i}, ${r}, ${t})`)}function or(e){e(v.GETAKEYSTATE,Oi),e(v.V_CLOSEALL,Ri),e(v.V_SYSTEM,Ai),e(v.VM_GETSCREENWIDTH,ki),e(v.VM_GETSCREENHEIGHT,Fi),e(v.VM_GETWORKAREAX,Bi),e(v.VM_GETWORKAREAY,Gi),e(v.VM_GETWORKAREAWIDTH,Vi),e(v.VM_GETWORKAREAHEIGHT,Hi),e(v.GETCLASSDIR,Ii),e(v.VM_FILEEXIST,Li),e(v.ADDSLASH,Ni),e(v.VM_GETDATE,Mi),e(v.VM_GETTIME,Pi),e(v.GETTICKCOUNT,Ui),e(v.STDHYPERJUMP,Xi)}const cr=De(Fe()),sr={selection:!1,preserveObjectStacking:!0,renderOnAddRemove:!1},Be={selectable:!1,hoverCursor:"pointer"};class jt{constructor({handle:e,isVisible:t,selectable:r,position:i,scale:n,bmpOrigin:o,bmpSize:s,bmpTool:a},l,c){this.viewRef=l;this.requestRedraw=c;this.type="bitmap";this.handle=e,this.posX=i.x,this.posY=i.y,this.visible=t,this.imageLoaded=!!a.image;const h=ee(ee({},Be),{left:i.x-l.x,top:i.y-l.y,cropX:o&&o.x,cropY:o&&o.y,width:s.x,height:s.y,scaleX:n?n.x:1,scaleY:n?n.y:1,visible:t&&this.imageLoaded});this.selectable=r,this.obj=new cr.fabric.Image(a.image,h),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){const e=this.imageLoaded;this.obj.set({visible:e}),this.visible=e,this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.visible=!1,this.requestRedraw()}updateBitmap(e){this.imageLoaded=!!e.image;const{cropX:t,cropY:r,width:i,height:n,scaleX:o,scaleY:s}=this.obj,a=this.visible&&this.imageLoaded;this.obj.setElement(e.image).set({cropX:t,cropY:r,width:i,height:n,scaleX:o,scaleY:s,visible:a}).setCoords(),this.requestRedraw()}setRect(e,t,r,i){this.obj.set({cropX:e,cropY:t,width:r,height:i}),this.requestRedraw()}}const Ge=De(Fe());function lr(e){if(!e)return;switch(e.fillType){case"SOLID":return Te(e.color);case"PATTERN":const t=e.bmpTool;return t&&t.image?new Ge.fabric.Pattern({source:t.image}):"white";default:return}}class Ve{constructor({handle:e,points:t,position:r,isVisible:i,selectable:n,brush:o,pen:s},a,l){this.viewRef=a;this.requestRedraw=l;this.type="line";this.handle=e,this.posX=r.x,this.posY=r.y;const c=ee(ee({},Be),{left:r.x-a.x,top:r.y-a.y,fill:lr(o),stroke:s&&s.style!=="NULL"?Te(s.color):void 0,strokeWidth:s?s.width||.5:0,visible:i});this.selectable=o?n:!1,this.obj=new Ge.fabric.Polyline(t,c),this.visibleArea=Ve.calcSize(t).size}static calcSize(e){const t=e.length>0?e.reduce((r,i)=>({minX:Math.min(r.minX,i.x),maxX:Math.max(r.maxX,i.x),minY:Math.min(r.minY,i.y),maxY:Math.max(r.maxY,i.y)}),{minX:e[0].x,maxX:e[0].x,minY:e[0].y,maxY:e[0].y}):{minX:0,maxX:0,minY:0,maxY:0};return{position:{x:t.minX,y:t.minY},size:{x:t.maxX-t.minX,y:t.maxY-t.minY}}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updatePen(e){this.obj.set({strokeWidth:e.width,stroke:Te(e.color)}),this.requestRedraw()}updateBrush(e){this.obj.set({fill:lr(e)}),this.requestRedraw()}setPointPosition(e,t,r){this.obj.points[e]=new Ge.fabric.Point(t,r),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:n}=Ve.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}addPoint(e,t,r){e<0?this.obj.points.push(new Ge.fabric.Point(t,r)):this.obj.points.splice(e,0,new Ge.fabric.Point(t,r)),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:n}=Ve.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}}const hr=De(Fe());class At{constructor({handle:e,isVisible:t,selectable:r,position:i,angle:n,textTool:o},s,a){this.viewRef=s;this.requestRedraw=a;this.type="text";this.handle=e,this.posX=i.x,this.posY=i.y;const{text:l,size:c}=o.assembledText,h=o.getFragment(0),u=ee(ee({},Be),{left:i.x-s.x,top:i.y-s.y,angle:-(n||0)*.1,backgroundColor:Te(h.backgroundColor),fill:Te(h.foregroundColor),fontWeight:h.font.bold?"bold":"normal",fontFamily:h.font.name,visible:t,fontSize:c});this.selectable=r,this.obj=new hr.fabric.Text(l,u),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updateTextTool(e){const{text:t,size:r}=e.assembledText,i=e.getFragment(0);this.obj.set({text:t,fontSize:r,backgroundColor:Te(i.backgroundColor),fill:Te(i.foregroundColor),fontWeight:i.font.bold?"bold":"normal",fontFamily:i.font.name}),this.requestRedraw()}}class ur{constructor({handle:e,isVisible:t,position:r,classname:i,controlSize:n,text:o},s,a){this.viewRef=s;this.type="control";if(i!=="Edit")throw new lt(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0432\u0432\u043E\u0434\u0430 \u0442\u0438\u043F\u0430 ${i} \u043F\u043E\u043A\u0430 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F`);this.handle=e,this.posX=r.x,this.posY=r.y,this.selectable=!1,this.visibleArea=ee({},n),this.inp=a.createTextInput({x:r.x-s.x,y:r.y-s.y,width:n.x,height:n.y,hidden:!t,text:o})}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.inp.set({x:e-r.x,y:t-r.y})}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.inp.set({x:e-r,y:t-i}),this.posX=e,this.posY=t}scaleTo(e,t){}setAngle(e){}testIntersect(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.inp.set({hidden:!1})}hide(){this.inp.set({hidden:!0})}onChange(e){this.inp.onChange(e)}setText(e){this.inp.set({text:e})}getText(){return this.inp.text}destroyHtml(){this.inp.destroy()}}const zi=[fe.WM_LBUTTONDOWN,fe.WM_MBUTTONDOWN,fe.WM_RBUTTONDOWN],Yi=[fe.WM_LBUTTONUP,fe.WM_MBUTTONUP,fe.WM_RBUTTONUP];class ft{constructor({canvas:e,htmlFactory:t}){this.objects=ne.create();this.objectsByZReversed=[];this.view={x:0,y:0};this.shouldRedraw=!1;this.mouseSubs=new Set;this.controlsubs=new Set;this.htmlFactory=t,this.canvas=e}static createCanvas(e){return new It.fabric.StaticCanvas(e,sr)}setSize(e,t){this.canvas.setWidth(e).setHeight(t).calcOffset()}getSize(){return{x:this.canvas.getWidth(),y:this.canvas.getHeight()}}requestRedraw(){this.shouldRedraw=!0}assertNoObject(e){if(this.objects.has(e))throw new le(`\u041E\u0431\u044A\u0435\u043A\u0442 #${e} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`)}createLine(e){this.assertNoObject(e.handle);const t=new Ve(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createText(e){this.assertNoObject(e.handle);const t=new At(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createBitmap(e){this.assertNoObject(e.handle);const t=new jt(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createControl(e){if(!this.htmlFactory)throw new ht("inputFactory");this.assertNoObject(e.handle);const t=new ur(e,this.view,this.htmlFactory);return t.onChange(()=>{this.controlsubs.forEach(r=>r(fe.WM_CONTROLNOTIFY,e.handle)),this.requestRedraw()}),this.objects.set(e.handle,t),t}updateBrush(e){const{bmpTool:t,color:r}=e;t&&t.image?this.canvas.backgroundImage=new It.fabric.Image(t.image):this.canvas.backgroundColor=Te(r),this.requestRedraw()}placeObjects(e){const t=[];for(const r of e){const i=this.objects.get(r);if(!i)throw new le(`\u041E\u0431\u044A\u0435\u043A\u0442 #${r} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`);i.type!=="control"&&this.canvas.add(i.obj),t.push(i)}this.objectsByZReversed=t.reverse().concat(this.objectsByZReversed),this.requestRedraw()}appendObjectToEnd(e){e.type!=="control"&&this.canvas.add(e.obj),this.objectsByZReversed=[e].concat(this.objectsByZReversed),this.requestRedraw()}moveObjectToTop(e){e.type!=="control"&&e.obj.bringToFront();const t=this.objectsByZReversed;this.objectsByZReversed=[e].concat(t.filter(r=>r!==e)),this.requestRedraw()}moveObjectRangeToTop(e){const t=[];for(const i of this.objectsByZReversed.reverse())e.includes(i)&&(i.type!=="control"&&i.obj.bringToFront(),t.push(i));const r=this.objectsByZReversed;this.objectsByZReversed=t.reverse().concat(r.filter(i=>!t.includes(i))),this.requestRedraw()}removeObject(e){e.type==="control"?e.destroyHtml():this.canvas.remove(e.obj),this.objects.delete(e.handle),this.objectsByZReversed=this.objectsByZReversed.filter(t=>t!==e),this.requestRedraw()}clear(){this.canvas.clear();for(const e of this.objects.values())e.type==="control"&&e.destroyHtml()}setView(e,t){this.view.x=e,this.view.y=t;for(const r of this.objects.values())r.updateAfterViewTranslate();this.requestRedraw()}testVisualIntersection(e,t,r){const i=this.objects.get(e);return i?i.testIntersect(t,r):!1}getVisualHandleFromPoint(e,t){for(const r of this.objectsByZReversed)if(r.selectable&&r.testIntersect(e,t)){const i=r.type!=="control"?r.handle:0;return i}return 0}render(){return this.shouldRedraw?(this.shouldRedraw=!1,this.canvas.renderAll(),!0):!1}handleEvent({x:e,y:t,buttons:r,button:i},n){const o=e+this.view.x,s=t+this.view.y;switch(n){case"down":ut[1]=1,this.mouseSubs.forEach(a=>a(zi[i]||fe.WM_LBUTTONDOWN,r,o,s));break;case"up":ut[1]=0,this.mouseSubs.forEach(a=>a(Yi[i]||fe.WM_LBUTTONUP,0,o,s));break;case"move":this.mouseSubs.forEach(a=>a(fe.WM_MOUSEMOVE,r,o,s));break}}subscribeToMouseEvents(e){this.mouseSubs.add(e)}subscribeToControlEvents(e){this.controlsubs.add(e)}}class qi{constructor(e,t){this.x=0;this.y=0;this.width=0;this.height=0;this.hidden=!1;this.element=document.createElement("input"),this.element.setAttribute("type","text"),this.element.setAttribute("style","position:absolute;"),this.set(t),e.appendChild(this.element)}updateValues(){this.element.style.setProperty("left",this.x.toString()),this.element.style.setProperty("top",this.y.toString()),this.element.style.setProperty("width",(this.width+1).toString()),this.element.style.setProperty("height",(this.height+1).toString()),this.element.hidden=this.hidden,this.element.value=this.text}set(e){return Object.assign(this,e),this.updateValues(),this}get text(){return this.element.value}set text(e){this.element.value=e}destroy(){this.element.remove()}onChange(e){this.element.addEventListener("input",e)}}class fr{constructor(e){this.root=e}createTextInput(e){return new qi(this.root,e)}}function $e(e,t){return{buttons:1,button:0,x:e.clientX-t.left,y:e.clientY-t.top}}function dt(e){const{offsetX:t,offsetY:r,buttons:i,button:n}=e,o=i&1?1:0,s=i&2?2:0,a=i&4?16:0;return{buttons:o|s|a,button:n,x:t,y:r}}class Lt{static createListeners(e,t){let r=!1,i;const n=[{type:"touchstart",listener:o=>{if(r=!0,o.touches.length>1&&i){e.handleEvent($e(i,t.getBoundingClientRect()),"up"),i=void 0;return}if(i!==void 0)return;const s=o.changedTouches[0];i=s,e.handleEvent($e(s,t.getBoundingClientRect()),"down")}},{type:"touchend",listener:o=>{if(r=!0,i===void 0)return;const s=o.changedTouches[i.identifier];if(!s)return;i=void 0,e.handleEvent($e(s,t.getBoundingClientRect()),"up")}},{type:"touchmove",listener:o=>{if(r=!0,o.touches.length<2&&o.preventDefault(),i===void 0)return;const s=o.changedTouches[i.identifier];if(!s)return;const a=t.getBoundingClientRect(),l=$e(s,a);l.x<0||l.y<0||l.x>a.width||l.y>a.height?e.handleEvent($e(i,a),"up"):e.handleEvent(l,"move"),i=s}},{type:"mousedown",listener:o=>{if(r){r=!1;return}e.handleEvent(dt(o),"down")}},{type:"mouseup",listener:o=>{if(r){r=!1;return}e.handleEvent(dt(o),"up")}},{type:"mouseleave",listener:o=>{e.handleEvent(dt(o),"up")}},{type:"mousemove",listener:o=>{e.handleEvent(dt(o),"move")}},{type:"contextmenu",listener:o=>o.preventDefault()}];return n}setCanvas(e){return this.canvas===e?!1:(this.removeListeners(),this.canvas=e,!0)}setReceiver(e){const t=this.canvas;if(!t)return!1;this.removeListeners();const r=Lt.createListeners(e,t);for(const i of r)t.addEventListener(i.type,i.listener);return this.evts=r,!0}removeListeners(){if(!this.evts||!this.canvas)return;for(const e of this.evts)this.canvas.removeEventListener(e.type,e.listener);this.evts=void 0}}class Ki{constructor(e,t,r){this.evtHandler=new Lt;this.ws=t,this.name=e,this.evtHandler.setCanvas(r.canvas.getElement()),this.renderer=new ft(r),this.evtHandler.setReceiver(this.renderer),this.originX=0,this.originY=0,this.width=r.canvas.getWidth(),this.height=r.canvas.getHeight(),document.title=e}setOrigin(e,t){this.originX=e,this.originY=t,this.originChanged&&this.originChanged(e,t)}setSize(e,t){this.width=e,this.height=t,this.ws.disableSceneResize||this.renderer.setSize(e,t),this.sizeChanged&&this.sizeChanged(e,t)}redraw(){return this.renderer.render()}close(){this.renderer.clear(),this.evtHandler.removeListeners(),this.ws.releaseWindow()}}class dr{constructor(e){this.screenWidth=0;this.screenHeight=0;this.areaOriginX=0;this.areaOriginY=0;this.areaWidth=0;this.areaHeight=0;this.disableSceneResize=!1;this.set(e||{})}set(e){return e.htmlRoot&&(this.htmlFactory=new fr(e.htmlRoot)),e.globalCanvas&&(!this.fabricCanvas||this.fabricCanvas.getElement()!==e.globalCanvas)&&(this.fabricCanvas=ft.createCanvas(e.globalCanvas)),Object.assign(this,e),this}createWindow(e){if(this.window)throw new Error("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u0431\u043E\u043B\u0435\u0435 \u043E\u0434\u043D\u043E\u0433\u043E \u043E\u043A\u043D\u0430");const{fabricCanvas:t,htmlFactory:r}=this;if(!t)throw new ht("globalCanvas");return this.window=new Ki(e,this,{canvas:t,htmlFactory:r}),this.window}redraw(){return this.window?this.window.redraw():!1}closeAll(){this.window&&this.window.close()}releaseWindow(){this.window=void 0}}function pr(e){return new dr(e)}const ni=De(require("jszip")),pt=/[/\\]/;function Nt(e){return e.split(pt).map(t=>t.trim()).filter(t=>t)}function Mt(e,t){const r=e.split(":");if(r.length>2)throw Error("\u0414\u0432\u043E\u0435\u0442\u043E\u0447\u0438\u0435 \u043F\u043E\u0441\u043B\u0435 \u043F\u0440\u0435\u0444\u0438\u043A\u0441\u0430 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u043D\u043E \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044C\u0441\u044F \u0442\u043E\u043B\u044C\u043A\u043E \u0435\u0434\u0438\u043D\u043E\u0436\u0434\u044B.");let i=t,n=r[0];if(r.length!==1){n=r[1];const s=r[0].trim().toUpperCase();if(s.length!==1||!/[A-Z]/.test(s))throw Error("\u041F\u0440\u0435\u0444\u0438\u043A\u0441 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u0435\u043D \u0441\u043E\u0441\u0442\u043E\u044F\u0442\u044C \u0438\u0437 \u043E\u0434\u043D\u043E\u0439 \u043B\u0430\u0442\u0438\u043D\u0441\u043A\u043E\u0439 \u0431\u0443\u043A\u0432\u044B");i=s}let o=n.split(pt).map(s=>s.trim()).filter(s=>s);return[i,o]}function mr(e){return e.substring(0,e.lastIndexOf("\\"))}const gr=["brushTools","penTools","bitmapTools","doubleBitmapTools","fontTools","stringTools","textTools"];function Me(e){return e?e.map(t=>ee({},t)):void 0}function br(e){const t=ee({},e);return t.brushTools=Me(e.brushTools),t.penTools=Me(e.penTools),t.bitmapTools=Me(e.bitmapTools),t.doubleBitmapTools=Me(e.doubleBitmapTools),t.fontTools=Me(e.fontTools),t.stringTools=Me(e.stringTools),t.textTools=e.textTools&&e.textTools.map(r=>ee(ee({},r),{textCollection:r.textCollection.map(i=>ee({},i))})),t.elements=Me(e.elements),t.elementOrder=e.elementOrder&&e.elementOrder.slice(),t}function vr(e,t){const r=e.find(i=>i.handle===t);if(!r||r.type!=="otGROUP2D")throw new le(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${t}`);return r}function Sr(e,t){const r=t.childHandles[0],i=e.find(n=>n.handle===r);return!i||i.type!=="otDOUBLEBITMAP2D"?void 0:i}function Ji(e,t){const r=new Map;let i=1;for(const n of t){for(;e.some(o=>o.handle===i);)i++;r.set(n.handle,i),n.handle=i,e.push(n)}return r}function $i(e,t){const r={};for(const i of gr){const n=t[i];if(!n)continue;const o=e[i];if(!o){e[i]=n;continue}r[i]=Ji(o,n)}return r}function Re(e,t,r){if(!e)return;for(const i of e){const n=i[t];i[t]=r.get(n)||n}}function Zi(e,t,r){switch(t){case"fontTools":{const{textTools:i}=e;i&&i.forEach(n=>Re(n.textCollection,"fontHandle",r));break}case"stringTools":{const{textTools:i}=e;i&&i.forEach(n=>Re(n.textCollection,"stringHandle",r));break}case"bitmapTools":{Re(e.brushTools,"dibHandle",r);break}}}function Qi(e,t,r){switch(t){case"brushTools":const i=e.filter(l=>l.type==="otLINE2D");Re(i,"brushHandle",r);break;case"penTools":const n=e.filter(l=>l.type==="otLINE2D");Re(n,"penHandle",r);break;case"bitmapTools":const o=e.filter(l=>l.type==="otBITMAP2D");Re(o,"bmpHandle",r);break;case"doubleBitmapTools":const s=e.filter(l=>l.type==="otDOUBLEBITMAP2D");Re(s,"bmpHandle",r);break;case"textTools":const a=e.filter(l=>l.type==="otTEXT2D");Re(a,"textToolHandle",r);break}}function en(e,t){for(const r of gr){const i=t[r];if(!i)continue;Zi(e,r,i),e.elements&&Qi(e.elements,r,i)}}function tn(e){let t,r;for(const i of e){if(i.type==="otGROUP2D")continue;(t===void 0||i.position.x<t)&&(t=i.position.x),(r===void 0||i.position.y<r)&&(r=i.position.y)}return{x:t||0,y:r||0}}function rn(e,t){return e.some(r=>r.type==="otGROUP2D"&&r.childHandles.includes(t.handle))}function nn(e,t,r){const i=new Map;if(t.length===0)return{map:i,rootHandle:0};let n=1;const o=[];for(const a of t){for(a.type!=="otGROUP2D"&&(a.position={x:a.position.x+r.x,y:a.position.y+r.y});e.some(l=>l.handle===n);)n++;rn(t,a)||o.push(n),i.set(a.handle,n),a.handle=n,e.push(a)}if(t.length===1)return{map:i,rootHandle:t[0].handle};for(;e.some(a=>a.handle===n);)n++;const s={type:"otGROUP2D",handle:n,childHandles:o,options:0,name:""};return e.push(s),{map:i,rootHandle:s.handle}}function an(e,t){for(const r of e){if(r.type!=="otGROUP2D")continue;r.childHandles=r.childHandles.map(i=>t.get(i)||i)}}function on(e,t){return e.map(r=>t.get(r)||r)}function sn(e){return e.elements!==void 0&&e.elements.length>0}class yr{constructor(e){const t=br(e);if(!sn(t))throw new le("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=t}get result(){return this.scheme}insertChildImage(e,t,r){const{scheme:i}=this,n=br(t),o=$i(i,n);if(en(n,o),!n.elements)return;const s=vr(i.elements,e),a=Sr(i.elements,s);a&&(a.options=1);const l=tn(n.elements),c={x:r.x-l.x,y:r.y-l.y},{map:h,rootHandle:u}=nn(i.elements,n.elements,c);if(an(n.elements,h),s.childHandles.push(u),!n.elementOrder)return;const f=on(n.elementOrder,h),p=i.elementOrder;i.elementOrder=p?p.concat(f):f}replaceIcon(e,t){const{scheme:r}=this,i=vr(r.elements,e),n=Sr(r.elements,i);if(!n)return;const o={type:"ttREFTODOUBLEDIB2D",handle:0,filename:t};let s=1;if(r.doubleBitmapTools){for(;r.doubleBitmapTools.some(a=>a.handle===s);)s++;r.doubleBitmapTools.push(o)}else r.doubleBitmapTools=[o];n.bmpHandle=o.handle=s}}function Tr(e,t,r){const i=new yr(e);for(const n of t){const o=r.get(n.classname.toUpperCase());if(!o)throw new le(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${n.classname} #${n.schemeInfo.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const{handle:s,position:a}=n.schemeInfo;o.iconFile&&i.replaceIcon(s,o.iconFile),o.image&&i.insertChildImage(s,o.image,a)}return i.result}var se;(function(e){e[e.CR_MATH=1]="CR_MATH",e[e.CR_MATHDATA=2]="CR_MATHDATA",e[e.CR_FLAGS=4]="CR_FLAGS",e[e.CR_VARS=5]="CR_VARS",e[e.CR_CHILDS=6]="CR_CHILDS",e[e.CR_LINKS=7]="CR_LINKS",e[e.CR_ICON=8]="CR_ICON",e[e.CR_SCHEME=9]="CR_SCHEME",e[e.CR_TEXT=10]="CR_TEXT",e[e.CR_VARSIZE=11]="CR_VARSIZE",e[e.CR_IMAGE=12]="CR_IMAGE",e[e.CR_CODE=13]="CR_CODE",e[e.CR_INFO=14]="CR_INFO",e[e.CR_VARS1=15]="CR_VARS1",e[e.CR_CHILDSname=16]="CR_CHILDSname",e[e.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",e[e.CR_DEFICON=20]="CR_DEFICON",e[e.CR_CLASSTIME=21]="CR_CLASSTIME",e[e.CR_ICONFILE=22]="CR_ICONFILE",e[e.CR_HELPFILE=25]="CR_HELPFILE",e[e.CR_EQU=30]="CR_EQU",e[e.CR_MOVEINFO=31]="CR_MOVEINFO",e[e.RR_VERSION=40]="RR_VERSION",e[e.PR_MAINCLASS=100]="PR_MAINCLASS",e[e.PR_PASSWORD=101]="PR_PASSWORD",e[e.PR_VARS=102]="PR_VARS",e[e.PR_WATCH=103]="PR_WATCH",e[e.VR_CLASSES=1e3]="VR_CLASSES",e[e.VR_VARS=1001]="VR_VARS",e[e.VR_SETVAR=1002]="VR_SETVAR",e[e.CR_CLASSINFO=8e3]="CR_CLASSINFO",e[e.PPR_FIELDS=2048]="PPR_FIELDS",e[e.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",e[e.PPR_SCALEMODE=2050]="PPR_SCALEMODE",e[e.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",e[e.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",e[e.PPR_USEADDF=2053]="PPR_USEADDF",e[e.PPR_SRCRECT=2054]="PPR_SRCRECT",e[e.PPR_USESRC=2055]="PPR_USESRC",e[e.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",e[e.CLF_LOADED=1]="CLF_LOADED",e[e.CLF_PROJECT=2]="CLF_PROJECT",e[e.CLF_MODIFY=4]="CLF_MODIFY",e[e.CLF_READONLY=8]="CLF_READONLY",e[e.CLF_NORECURSE=16]="CLF_NORECURSE",e[e.CLF_ADDLIB=32]="CLF_ADDLIB",e[e.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",e[e.CLF_LIBRARY=256]="CLF_LIBRARY",e[e.CLF_PACKFILE=512]="CLF_PACKFILE",e[e.CF_PROTECTED=1]="CF_PROTECTED",e[e.CF_ONEFASE=2]="CF_ONEFASE",e[e.CF_COMPILED=4]="CF_COMPILED",e[e.CF_VIRTUAL=8]="CF_VIRTUAL",e[e.CF_SCHEME=16]="CF_SCHEME",e[e.CF_MODIFY=32]="CF_MODIFY",e[e.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",e[e.CF_BUILDIN=256]="CF_BUILDIN",e[e.CF_ICON=512]="CF_ICON",e[e.CF_PROCEDURE=1024]="CF_PROCEDURE",e[e.CF_STRUCTURE=2048]="CF_STRUCTURE",e[e.CF_USEDEFICON=4096]="CF_USEDEFICON",e[e.CF_SIZEABLE=8192]="CF_SIZEABLE",e[e.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",e[e.TCF_WASSAVE=1]="TCF_WASSAVE",e[e.TCF_NEWCLASS=2]="TCF_NEWCLASS",e[e.OF_DISABLED=1]="OF_DISABLED",e[e.OF_ONEFASE=2]="OF_ONEFASE",e[e.OF_ERROR=4]="OF_ERROR",e[e.LF_DISABLED=1]="LF_DISABLED",e[e.LF_AUTOLINK=2]="LF_AUTOLINK",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_NOREAD=4]="VF_NOREAD",e[e.VF_NOWRITE=8]="VF_NOWRITE",e[e.VF_STATIC=16]="VF_STATIC",e[e.VF_ONSCHEME=32]="VF_ONSCHEME",e[e.VF_PARAMETER=64]="VF_PARAMETER",e[e.VF_LEFT=128]="VF_LEFT",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.VF_NOSAVE=2048]="VF_NOSAVE",e[e.VF_GLOBAL=4096]="VF_GLOBAL",e[e.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",e[e.SF_EXTERNAL=1]="SF_EXTERNAL",e[e.SF_EDITING=2]="SF_EDITING",e[e.STATE_FAST=0]="STATE_FAST",e[e.STATE_VARS=1]="STATE_VARS",e[e.STATE_DEBUG=2]="STATE_DEBUG",e[e.STATE_SET=3]="STATE_SET",e[e.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",e[e.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",e[e.CHF_WASSIZED=4]="CHF_WASSIZED",e[e.CHF_PREPROCESS=8]="CHF_PREPROCESS",e[e.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",e[e.IF_CORRECTED=1]="IF_CORRECTED",e[e.EF_RUNNING=1]="EF_RUNNING",e[e.EF_MUSTSTOP=2]="EF_MUSTSTOP",e[e.EF_STEPACTIVE=4]="EF_STEPACTIVE",e[e.EF_EQUACTIVE=8]="EF_EQUACTIVE",e[e.EF_MSGACTIVE=16]="EF_MSGACTIVE",e[e.EF_BYTIMER=32]="EF_BYTIMER"})(se||(se={}));function _r(e){const t=e.int32(),r=e.uint16(),i=e.string(),n=e.int32(),o=Array.from({length:e.uint16()},()=>({name:e.string(),value:e.string()})),s=[];for(;e.position<t;)s.push(_r(e));return{handle:r,classname:i,classId:n,values:o,childSets:s}}function mt(e){const t=e.uint16();if(t!==19)throw new Oe(e,t,19);e.seek(21),e.string(),e.uint16(),e.uint16();switch(e.uint16()){case se.VR_CLASSES:throw new ye(e,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case se.VR_SETVAR:return _r(e)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}function wr(e){e.bytes(1)}function cn(e){wr(e),e.uint16()}function ln(e){return e.uint16()}function hn(e){const t=e.uint16(),r=e.uint16(),i=e.bytes(r);return{id:t,size:r,data:i}}function un(e){return{foregroundColor:e.int32(),backgroundColor:e.int32(),fontHandle:e.uint16(),stringHandle:e.uint16()}}function je(e){cn(e)}function fn(){return ln}function dn(e){return wr(e),hn}function pn(){return un}function Er(e){e.otPRIMARYCOLLECTION=fn,e.otDATAITEMS=dn,e.otOBJECTCOLLECTION=je,e.otPENCOLLECTION=je,e.otBRUSHCOLLECTION=je,e.otDOUBLEDIBCOLLECTION=je,e.otFONTCOLLECTION=je,e.otSTRINGCOLLECTION=je,e.otTEXTCOLLECTION=je,e.otDIBCOLLECTION=je,e.otLOGTEXTCOLLECTION=pn}var pe;(function(e){e[e.otGROUP=1]="otGROUP",e[e.otCOLLECTION=1e3]="otCOLLECTION",e[e.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",e[e.otPENCOLLECTION=1004]="otPENCOLLECTION",e[e.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",e[e.otDIBCOLLECTION=1006]="otDIBCOLLECTION",e[e.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",e[e.otFONTCOLLECTION=1008]="otFONTCOLLECTION",e[e.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",e[e.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",e[e.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",e[e.ot3DCOLLECTION=1012]="ot3DCOLLECTION",e[e.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",e[e.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",e[e.otDATAITEMS=1022]="otDATAITEMS",e[e.otMATERIALS3D=1024]="otMATERIALS3D",e[e.otSPACE2D=17458]="otSPACE2D",e[e.otSPACE3D=17459]="otSPACE3D",e[e.otSPACE3Df=25668]="otSPACE3Df",e[e.otGROUP2D=3]="otGROUP2D",e[e.otRGROUP2D=4]="otRGROUP2D",e[e.otGROUP3D=5]="otGROUP3D",e[e.otOBJECT3D=10]="otOBJECT3D",e[e.otCAMERA3D=11]="otCAMERA3D",e[e.otLIGHT3D=12]="otLIGHT3D",e[e.otLINE2D=20]="otLINE2D",e[e.otBITMAP2D=21]="otBITMAP2D",e[e.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",e[e.otTEXT2D=23]="otTEXT2D",e[e.otVIEW3D2D=24]="otVIEW3D2D",e[e.otUSEROBJECT2D=25]="otUSEROBJECT2D",e[e.otCONTROL2D=26]="otCONTROL2D",e[e.otEDITFRAME2D=50]="otEDITFRAME2D",e[e.otROTATECENTER2D=51]="otROTATECENTER2D",e[e.otFRAME3D=52]="otFRAME3D",e[e.otAXIS3D=53]="otAXIS3D",e[e.ttPEN2D=101]="ttPEN2D",e[e.ttBRUSH2D=102]="ttBRUSH2D",e[e.ttDIB2D=103]="ttDIB2D",e[e.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",e[e.ttFONT2D=105]="ttFONT2D",e[e.ttSTRING2D=106]="ttSTRING2D",e[e.ttTEXT2D=107]="ttTEXT2D",e[e.ttREFTODIB2D=110]="ttREFTODIB2D",e[e.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",e[e.ctINFONAME=200]="ctINFONAME",e[e.ctINFOAUTOR=201]="ctINFOAUTOR",e[e.ctINFOINFO=202]="ctINFOINFO",e[e.ctCRDSYSTEM=203]="ctCRDSYSTEM",e[e.stSPACEDATA=204]="stSPACEDATA",e[e.stOBJNAME=205]="stOBJNAME"})(pe||(pe={}));function xr(e){return{handle:e.uint16(),options:e.uint16(),name:e.meta.fileversion>=258&&e.meta.fileversion<768?e.string():""}}function Ze(e){return ee(ee({},xr(e)),{position:e.meta.fileversion<512?e.point2dInt():e.point2d(),size:e.meta.fileversion<512?e.point2dInt():e.point2d()})}function Cr(e){return ee(ee({},xr(e)),{childHandles:ge(e,!0,pe.otPRIMARYCOLLECTION).data})}function mn(e){return Cr(e)}function gn(e){let t=ee(ee({},Ze(e)),{penHandle:e.uint16(),brushHandle:e.uint16()});const r=e.uint16();t.points=new Array(r);for(let n=0;n<r;n++)t.points[n]=e.meta.fileversion<512?e.point2dInt():e.point2d();if(e.meta.fileversion<=512)return t;const i=e.bytes(1)[0];return i&&(t.arrows=e.bytes(i)),t}function Dr(e){return ee(ee({},Ze(e)),{bmpOrigin:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpSize:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpAngle:e.int16(),bmpHandle:e.uint16()})}function bn(e){return ee(ee({},Ze(e)),{textToolHandle:e.uint16(),delta:e.meta.fileversion<512?e.point2dInt():e.point2d(),angle:e.int16()})}function vn(e){const t=ee(ee({},Ze(e)),{classname:e.string(),text:e.string(),dwStyle:e.int32(),exStyle:e.int32(),id:e.uint16(),controlSize:e.point2dInt()});if(!["Edit","Button","ComboBox"].includes(t.classname))throw new Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u0430: ${t.classname}`);return e.uint16(),t}function Sn(e){return Ze(e)}function Or(e){e.otGROUP=Cr,e.otGROUP2D=mn,e.otLINE2D=gn,e.otBITMAP2D=Dr,e.otDOUBLEBITMAP2D=Dr,e.otTEXT2D=bn,e.otCONTROL2D=vn,e.otSPACE2D=Sn}const Ft=De(require("pngjs")),xe=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function Pt(e){let t="",r,i=e.length;for(r=2;r<i;r+=3)t+=xe[e[r-2]>>2],t+=xe[(e[r-2]&3)<<4|e[r-1]>>4],t+=xe[(e[r-1]&15)<<2|e[r]>>6],t+=xe[e[r]&63];return r===i+1&&(t+=xe[e[r-2]>>2],t+=xe[(e[r-2]&3)<<4],t+="=="),r===i&&(t+=xe[e[r-2]>>2],t+=xe[(e[r-2]&3)<<4|e[r-1]>>4],t+=xe[(e[r-1]&15)<<2],t+="="),t}class yn{constructor(e,t=!1,r=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.pos=r,this.view=e,this.is_with_alpha=!!t,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){const e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let t=0;t<e;t++){const r=this.view.getUint8(this.pos++),i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.palette[t]={red:n,green:i,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){const e="bit"+this.bitPP,t=this.width*this.height*4;if(this.data=new Uint8Array(t),e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){const e=Math.ceil(this.width/8),t=e%4;let r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<e;n++){const o=this.view.getUint8(this.pos++),s=i*this.width*4+n*8*4;for(let a=0;a<8&&n*8+a<this.width;a++){const l=this.palette[o>>7-a&1];this.data[s+a*4]=l.red,this.data[s+a*4+1]=l.green,this.data[s+a*4+2]=l.blue,this.data[s+a*4+3]=0}}t!==0&&(this.pos+=4-t)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0,r=!1;const i=n=>{const o=this.palette[n];this.data[e]=o.red,this.data[e+1]=o.green,this.data[e+2]=o.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);if(n===0)if(o===0){this.bottom_up?t--:t++,e=t*this.width*4,r=!1;continue}else{if(o===1)break;if(o===2){const s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.bottom_up?t-=a:t+=a,e+=a*this.width*4+s*4}else{let s=this.view.getUint8(this.pos++);for(let a=0;a<o;a++)r?i.call(this,s&15):i.call(this,(s&240)>>4),a&1&&a+1<o&&(s=this.view.getUint8(this.pos++)),r=!r;(o+1>>1&1)===1&&this.pos++}}else for(let s=0;s<n;s++)r?i.call(this,o&15):i.call(this,(o&240)>>4),r=!r}}else{const e=Math.ceil(this.width/2),t=e%4;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<e;n++){const o=this.view.getUint8(this.pos++),s=i*this.width*4+n*2*4,a=o>>4,l=o&15;let c=this.palette[a];if(this.data[s]=c.red,this.data[s+1]=c.green,this.data[s+2]=c.blue,this.data[s+3]=255,n*2+1>=this.width)break;c=this.palette[l],this.data[s+4]=c.red,this.data[s+4+1]=c.green,this.data[s+4+2]=c.blue,this.data[s+4+3]=0}t!==0&&(this.pos+=4-t)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0;const r=i=>{const n=this.palette[i];this.data[e]=n.red,this.data[e+1]=n.green,this.data[e+2]=n.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);if(i===0)if(n===0){this.bottom_up?t--:t++,e=t*this.width*4;continue}else{if(n===1)break;if(n===2){const o=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);this.bottom_up?t-=s:t+=s,e+=s*this.width*4+o*4}else{for(let o=0;o<n;o++){const s=this.view.getUint8(this.pos++);r.call(this,s)}(n&1)===1&&this.pos++}}else for(let o=0;o<i;o++)r.call(this,n)}}else{const e=this.width%4;for(let t=this.height-1;t>=0;t--){const r=this.bottom_up?t:this.height-1-t;for(let i=0;i<this.width;i++){const n=this.view.getUint8(this.pos++),o=r*this.width*4+i*4;if(n<this.palette.length){const s=this.palette[n];this.data[o]=s.red,this.data[o+1]=s.green,this.data[o+2]=s.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){const e=this.width%3,t=parseInt("11111",2),r=t;for(let i=this.height-1;i>=0;i--){const n=this.bottom_up?i:this.height-1-i;for(let o=0;o<this.width;o++){const s=this.view.getUint16(this.pos,!0);this.pos+=2;const a=(s&r)/r*255|0,l=(s>>5&r)/r*255|0,c=(s>>10&r)/r*255|0,h=n*this.width*4+o*4;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=a,this.data[h+3]=255}this.pos+=e}}bit16(){const e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);const t=[0,0,0];for(let r=0;r<16;r++)this.maskRed>>r&1&&t[0]++,this.maskGreen>>r&1&&t[1]++,this.maskBlue>>r&1&&t[2]++;t[1]+=t[0],t[2]+=t[1],t[0]=8-t[0],t[1]-=8,t[2]-=8;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<this.width;n++){const o=this.view.getUint16(this.pos,!0);this.pos+=2;const s=(o&this.maskBlue)<<t[0],a=(o&this.maskGreen)>>t[1],l=(o&this.maskRed)>>t[2],c=i*this.width*4+n*4;this.data[c]=l,this.data[c+1]=a,this.data[c+2]=s,this.data[c+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){this.view.getUint8(this.pos++);const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}}}else for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);const s=t*this.width*4+r*4;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}}}getData(){return this.data}}function kt(e){return new yn(e)}function Rr(e){return{width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}function Tn(e,t,r,i){for(let o=3;o<e.length&&o<t.length;o+=4)e[o]=255-t[o-1];const n=new Ft.PNG({width:r,height:i,inputHasAlpha:!0});return n.data=e,Ft.PNG.sync.write(n)}function Bt(e){const t=e.position;if(e.uint16()!==19778)throw new Error("BMP \u0444\u0430\u0439\u043B \u043F\u043E\u0432\u0440\u0435\u0436\u0434\u0435\u043D");const r=e.int32();return e.seek(t),r}function Gt(e){return new DataView(e.buffer,e.byteOffset)}function gt(e){const t=Bt(e),r=e.bytes(t),{width:i,height:n}=Rr(Gt(r)),o="data:image/bmp;base64,"+Pt(r);return{base64Image:o,width:i,height:n}}function Qe(e){const t=e.bytes(Bt(e)),{data:r,width:i,height:n}=kt(Gt(t)),o=e.bytes(Bt(e)),{data:s}=kt(Gt(o)),a="data:image/png;base64,"+Pt(Tn(r,s,i,n));return{base64Image:a,width:i,height:n}}function Ae(e){return{refCount:e.uint16(),handle:e.uint16()}}function _n(e){return ee(ee({},Ae(e)),{color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()})}function wn(e){return ee(ee({},Ae(e)),{color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()})}function En(e){return ee(ee({},Ae(e)),gt(e))}function xn(e){return ee(ee({},Ae(e)),Qe(e))}function Cn(e){const t=Ae(e),r=e.position,i=ee(ee({},t),{height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),fontName:e.nulltString(32)});return e.seek(r+50),e.meta.fileversion>=515?(i.size=e.int32(),i.style=e.int32()):(i.size=22,i.style=0),i}function Dn(e){return ee(ee({},Ae(e)),{text:e.string()})}function On(e){return ee(ee({},Ae(e)),{textCollection:ge(e,!0,pe.otLOGTEXTCOLLECTION).data})}function jr(e){return ee(ee({},Ae(e)),{filename:e.string()})}function Rn(e){return jr(e)}function Ar(e){e.ttPEN2D=_n,e.ttBRUSH2D=wn,e.ttDIB2D=En,e.ttDOUBLEDIB2D=xn,e.ttFONT2D=Cn,e.ttSTRING2D=Dn,e.ttTEXT2D=On,e.ttREFTODIB2D=jr,e.ttREFTODOUBLEDIB2D=Rn}const Vt={},bt={};(function(){Er(Vt),Or(bt),Ar(bt)})();class He{constructor(e){if(this.stream=e,this.start=e.position,this.code=e.int16(),e.meta.fileversion>=768&&(this.size=e.int32()),this.size<0)throw Error("chunk size < 0")}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.stream.position-this.start}readNextSubChunk(){return this.start+this.size<=this.stream.position?0:new He(this.stream)}goEnd(){this.stream.seek(this.start+this.size)}checkReaded(){const e=this.readedBytes();if(e>this.size)throw Error(`Chunk data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk not readed: ${e} instead of ${this.size}`)}}function ge(e,t,r){const i=new He(e);if(i.code===-1)return;if(i.code===0)throw Error("Chunk not an object or collection");if(r!==void 0&&r!==i.code)throw Error(`Chunk code is ${i.code} instead of ${r}`);const n=i.code>999&&i.code<1200;if(t&&!n)throw Error("not a collection: "+i.code);const o=Object.keys(pe).find(a=>pe[a]===i.code);if(o===void 0)throw Error(`Unknown ${n?"collection":"object"}: ${i.code}`);const s=(n?Ir:jn)(e,o);if(e.meta.fileversion<768)return Array.isArray(s)?{type:o,data:s}:ee({type:o},s);for(;i.hasData();){const a=new He(e);switch(a.code){case pe.otDATAITEMS:Ir(e,"otDATAITEMS");break;case pe.stOBJNAME:s.name=e.fixedString(a.size-a.readedBytes());break;default:throw Error("Unknown postchunk: "+a.code)}}return i.checkReaded(),Array.isArray(s)?{type:o,data:s}:ee({type:o},s)}function Ir(e,t){const r=e.uint16();e.uint16(),e.uint16();const i=Vt[t];if(!i)throw Error("No get item function for "+t);const n=i(e)||ge,o=new Array(r);for(let s=0;s<r;s++)o[s]=n(e);return o}function jn(e,t){const r=bt[t];if(!r)throw Error("No item function for "+t);return r(e)}function An(e,t){const r=new He(e);if(r.code!==pe.stSPACEDATA)throw"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x";for(t.origin=e.point2d(),t.scale_div=e.point2d(),t.scale_mul=e.point2d(),t.state=e.uint16(),t.brushHandle=e.uint16(),t.layers=e.uint32(),t.defaultFlags=e.uint16();r.hasData();){const{type:i,data:n}=ge(e,!0);t[i]=n}r.checkReaded()}function In(e,t,r){const i=e.int32()+r,n=e.int32()+r,o=()=>e.meta.fileversion<512?e.point2dInt():e.point2d();t.origin=o(),t.scale_div=o(),t.scale_mul=o(),e.string(),t.state=e.uint16(),e.string(),e.string(),e.string(),ge(e,!1),ge(e,!1),t.brushHandle=e.uint16(),e.seek(i),t.otPRIMARYCOLLECTION=ge(e,!0,pe.otPRIMARYCOLLECTION).data,t.otOBJECTCOLLECTION=ge(e,!0,pe.otOBJECTCOLLECTION).data,e.seek(n);const s=e.uint16();for(let a=0;a<s;a++){const{type:l,data:c}=ge(e,!0);t[l]=c}if(e.meta.fileversion>258){t.layers=e.uint32(),t.defaultFlags=e.uint16();let a=e.uint16();for(;a;){switch(a){case 0:break;default:return}a=e.uint16()}}else t.layers=0,t.defaultFlags=0;e.string()}function Ln(e){const t=e.uint16();if(t!==17458)throw new Oe(t,17458);const r=e.position,i={fileversion:e.uint16(),minVersion:e.uint16()};return e.meta.fileversion=i.fileversion,i.fileversion>=768?An(e,i):In(e,i,r),i}const Nn={otBRUSHCOLLECTION:"brushTools",otPENCOLLECTION:"penTools",otDIBCOLLECTION:"bitmapTools",otDOUBLEDIBCOLLECTION:"doubleBitmapTools",otSTRINGCOLLECTION:"stringTools",otFONTCOLLECTION:"fontTools",otTEXTCOLLECTION:"textTools",otOBJECTCOLLECTION:"elements",otPRIMARYCOLLECTION:"elementOrder"};function Mn(e){for(const t of Object.keys(e)){const r=Nn[t];if(!r)continue;const i=e[t];delete e[t],e[r]=i}return e}function vt(e,t){const r=Mn(Ln(e));return r.source=t,r}const Lr=De(Ht());class me{constructor(e,t){this.p=0;this.meta=ee({},t),this.v=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength)}get position(){return this.p}seek(e){this.p=e}skip(e){return this.p+=e,this}get size(){return this.v.byteLength}fork(e){return new me(new DataView(this.v.buffer,this.v.byteOffset+this.p,e))}eof(){return this.p>=this.size}bytes(e){const t=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,t}byte(){const e=this.v.getUint8(this.p);return this.p+=1,e}int16(){const e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){const e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){const e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){const e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){const e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?me.d.decode(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){const t=this.p;let r=0;for(;r<e-1&&this.v.getUint8(t+ ++r)!==0;);const i=this.fixedString(r);return this.p+=1,i}vmString(){const e=this.uint16()*2,t=this.v.getUint8(this.p+e-2)===0?2:1,r=this.fixedString(e-t);return this.p+=t,r}point2d(){return{x:this.float64(),y:this.float64()}}point2dInt(){return{x:this.int16(),y:this.int16()}}}me.d=new TextDecoder("windows-1251");class be{constructor(e){this.subs=new Map;this.handle=e.handle}subscribe(e,t){this.subs.set(e,t)}unsubscribe(e){this.subs.delete(e)}get subCount(){return this.subs.size}dispatchChanges(){this.subs.forEach(e=>e())}}class et extends be{constructor(e){super(e);this.size=e.width&&e.height?{x:e.width,y:e.height}:void 0,this._image=e.image,this.asyncLoaded=!e.image}get image(){return this._image}setImage(e){this._image=e,this.dispatchChanges()}setPixel(e,t,r){throw this.asyncLoaded?new le(`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${this.handle} \u0431\u044B\u043B\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0430\u0441\u0438\u043D\u0445\u0440\u043E\u043D\u043D\u043E`):new Error("Method not implemented.")}getPixel(e,t){throw new Error("Method not implemented.")}}class Ce{static loadImage(e){return new Promise((t,r)=>Se(this,null,function*(){const i=new Image;i.onload=()=>t(i),i.onerror=()=>r("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F "+e),i.src=e}))}static loadFromParams(e){if(e.type==="ttDIB2D"||e.type==="ttDOUBLEDIB2D"){const n=new et(e),o=this.loadImage(e.base64Image);return this.promises.add(o.then(s=>n.setImage(s))),o.catch(()=>console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F ${e.type} #${e.handle}`)),n}const t=e.filename.toUpperCase();let r=this.cachedIcons.get(t);if(!r){const n=`${Lr.options.iconsLocation}/${t}`;e.type==="ttREFTODIB2D"?r=this.loadImage(n):r=fetch(n).then(o=>o.arrayBuffer()).then(o=>this.loadImage(Qe(new me(o)).base64Image)),this.cachedIcons.set(t,r)}const i=new et(e);return this.promises.add(r.then(n=>i.setImage(n))),r.catch(n=>console.error(n)),i}static loadFromStream(e,t,r){const{base64Image:i,width:n,height:o}=r?Qe(e):gt(e),s=new et({handle:t,width:n,height:o}),a=this.loadImage(i);return a.then(l=>s.setImage(l)),a.catch(()=>console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F ${e.meta.filepathDos} #${t}`)),s}static get allImagesLoaded(){return Promise.all(this.promises).then(()=>{this.promises.clear()})}}Ce.cachedIcons=new Map,Ce.promises=new Set;const yt=De(Fe());class St{constructor({handle:e,name:t,options:r}){this._layer=0;this._isVisible=1;this._selectable=1;if(e===0)throw new Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${t} \u0438\u043C\u0435\u0435\u0442 \u043D\u0443\u043B\u0435\u0432\u043E\u0439 \u0434\u0435\u0441\u043A\u0440\u0438\u043F\u0442\u043E\u0440.`);this.handle=e,this._name=t||"",this.options=r||0,r&&(this._isVisible=r&1?0:1,this._selectable=r&8?0:1,this._layer=(r&7936)>>8)}get parent(){return this._parent}get name(){return this._name}setName(e){return this._name=e,1}}const Pn=180/Math.PI;class Ie extends St{constructor(e){super(e);this.positionX=0;this.positionY=0;this._angle=0;this.width=0;this.height=0;this._layerVisible=!0;this._hiddenLayers=0;const{position:t,size:r}=e;this.positionX=t.x,this.positionY=t.y,r&&(this.width=r.x,this.height=r.y),this.wasShowed=!!this._isVisible}setPosition(e,t){return this.positionX===e&&this.positionY===t||(this.positionX=e,this.positionY=t,this._isVisible&&this._layerVisible&&this.renderable.setPosition(e,t),this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height)),1}setSize(e,t){return this.width=e,this.height=t,this._isVisible&&this._layerVisible&&this.renderable.scaleTo(e,t),1}get angle(){return this.type==="otTEXT2D"?this._angle:0}rotate(e,t,r){const{positionX:i,positionY:n}=this,o=yt.fabric.util.rotatePoint(new yt.fabric.Point(i,n),new yt.fabric.Point(e,t),r),s=this._angle+r*Pn;return this._angle=s,this._isVisible&&this._layerVisible&&(this.renderable.setAngle(s),this.setPosition(o.x,o.y)),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return this._isVisible}setVisibility(e){return e===this._isVisible||(this._isVisible=e,e&&this._layerVisible?this.showVisual():this.hideVisual()),1}showVisual(){if(this.renderable.show(),this.wasShowed)return;this.renderable.setPosition(this.positionX,this.positionY),this.renderable.setAngle(this.angle),this.renderable.scaleTo(this.width,this.height),this.wasShowed=!0}hideVisual(){this.renderable.hide(),this.wasShowed=!1}get isSelectable(){return this._selectable}updateLayerVisibility(e){if(this._layerVisible===e)return;this._layerVisible=e,e?this.showVisual():this.hideVisual()}setHiddenLayers(e){if(this._hiddenLayers===e)return;this._hiddenLayers=e,this.updateLayerVisibility(!(e>>this._layer&1))}get layer(){return this._layer}setLayer(e){if(this._layer===e)return;this._layer=e,this.updateLayerVisibility(!(this._hiddenLayers>>e&1))}}class We extends Ie{static create(e,t,r){const i=e.bmpHandle,n=e.type==="otBITMAP2D"?r.bitmaps.get(i):r.doubleBitmaps.get(i);return n?new We(e,t,n):void 0}constructor(e,t,r){super(e);this.type=e.type;const i=e.bmpSize||e.size||r.size;if(!i){const o=`${e.type==="otBITMAP2D"?"\u0411":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431"}\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430`;throw new le(`${o} #${e.handle}: \u0443 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435\u0442 \u0440\u0430\u0437\u043C\u0435\u0440\u043E\u0432 (\u043E\u0431\u044A\u0435\u043A\u0442: ${this.handle}).`)}const n={x:e.size&&e.bmpSize?e.size.x/e.bmpSize.x:1,y:e.size&&e.bmpSize?e.size.y/e.bmpSize.y:1};if(this.renderable=t.createBitmap({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,scale:n,bmpSize:i,bmpOrigin:e.bmpOrigin,bmpTool:r}),!e.size){const o=this.renderable.getVisibleAreaSize();this.width=o.x,this.height=o.y}this._bmpTool=r,r.subscribe(this,()=>this.renderable.updateBitmap(r))}get bmpTool(){return this._bmpTool}setRect(e,t,r,i){return this.renderable.setRect(e,t,r,i),1}changeBmpTool(e){return this.bmpTool.unsubscribe(this),e.subscribe(this,()=>this.renderable.updateBitmap(e)),this._bmpTool=e,1}unsubFromTools(){this.bmpTool.unsubscribe(this)}}class Wt extends Ie{constructor(e,t){super(e);this.type="otCONTROL2D";if(this.renderable=t.createControl({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,classname:e.classname,text:e.text,controlSize:e.controlSize}),!e.size){const r=this.renderable.getVisibleAreaSize();this.width=r.x,this.height=r.y}}get text(){return this.renderable.getText()}setText(e){return this.renderable.setText(e),1}}class Ue extends Ie{constructor(e,t,r){super(e);this.type="otLINE2D";if(this.points=e.points.slice(),e.penHandle){const i=r&&r.pens.get(e.penHandle);this.changePen(i)}if(e.brushHandle){const i=r&&r.brushes.get(e.brushHandle);this.changeBrush(i)}if(this.renderable=t.createLine({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,points:this.points,pen:this.pen,brush:this.brush}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}}static calculatePosition(e){let t=e[0].x,r=e[0].y;for(const i of e)i.x<t&&(t=i.x),i.y<r&&(r=i.y);return{x:t,y:r}}static create(e,t,r){const i=e.position||this.calculatePosition(e.points);return new Ue(ee(ee({},e),{position:i}),t,r)}get pen(){return this._pen}get brush(){return this._brush}getPoint(e){return this.points[e]}setPointPosition(e,t,r){const i=this.points[e];return i?(i.x===t&&i.y===r||(i.x=t,i.y=r,this.renderable.setPointPosition(e,t,r)),1):0}addPoint(e,t,r){return e===-1?this.points.push({x:t,y:r}):this.points.splice(e,0,{x:t,y:r}),this.renderable.addPoint(e,t,r),1}changePen(e){return this.pen&&this.pen.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updatePen(e)),this._pen=e,1}changeBrush(e){return this.brush&&this.brush.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updateBrush(e)),this._brush=e,1}unsubFromTools(){this.pen&&this.pen.unsubscribe(this),this.brush&&this.brush.unsubscribe(this)}}class Xe extends Ie{constructor(e,t,r){super(e);this.type="otTEXT2D";if(this._angle=e.angle||0,this.renderable=t.createText({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,angle:e.angle,textTool:r}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}this._text=r,r.subscribe(this,()=>this.renderable.updateTextTool(r))}static create(e,t,r){const i=r.texts.get(e.textToolHandle);return i?new Xe(e,t,i):void 0}get textTool(){return this._text}changeTextTool(e){return this._text.unsubscribe(this),this._text=e,e.subscribe(this,()=>this.renderable.updateTextTool(e)),1}unsubFromTools(){this.textTool.unsubscribe(this)}}class ze extends St{constructor(e){super(e);this.type="otGROUP2D";this.angle=0;this.positionX=0;this.positionY=0;this.width=0;this.height=0;this.items=[];this.handleChildChanges=!0;e.items&&e.items.length!==0&&this.addItems(e.items)}recalcCoords(){let e,t,r,i;for(const n of this.items){if(!n.isVisible)continue;(e===void 0||n.positionX<e)&&(e=n.positionX),(r===void 0||n.positionY<r)&&(r=n.positionY),(t===void 0||n.positionX+n.width>t)&&(t=n.positionX+n.width),(i===void 0||n.positionY+n.height>i)&&(i=n.positionY+n.height)}this.positionX=e||0,this.positionY=r||0,this.width=t-e||0,this.height=i-r||0,this.parent&&this.parent.recalcCoords()}getItem(e){return this.items[e]}hasItem(e){return e.parent===this?1:0}addItemFast(e){return e.parent===this?0:(this.items.includes(e)||this.items.push(e),e._parent=this,1)}addItem(e){return this.addItemFast(e)&&this.recalcCoords(),1}addItems(e){for(const t of e)this.addItemFast(t);return this.recalcCoords(),1}removeItem(e){if(e.parent!==this)return 0;e._parent=void 0;const t=this.items.indexOf(e);return t<0?0:(this.items.splice(t,1),this.recalcCoords(),1)}getItemsRecursive(e){e||(e=[]);for(const t of this.items)t.type==="otGROUP2D"?t.getItemsRecursive(e):e.push(t);return e}handleChildTransform(e,t,r,i){if(!this.handleChildChanges)return;e<this.positionX&&(this.positionX=e),t<this.positionY&&(this.positionY=t),e+r>this.positionX+this.width&&(this.width=e+r-this.positionX),t+i>this.positionY+this.height&&(this.height=t+i-this.positionY),this.parent&&this.parent.handleChildTransform(e,t,r,i)}setPosition(e,t){if(this.positionX===e&&this.positionY===t)return 1;const r=e-this.positionX,i=t-this.positionY;this.handleChildChanges=!1;for(const n of this.items)n.setPosition(n.positionX+r,n.positionY+i);return this.handleChildChanges=!0,this.positionX=e,this.positionY=t,this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height),1}setSize(e,t){if(this.width===e&&this.height===t)return 1;const r=e/this.width,i=t/this.height;this.handleChildChanges=!1;for(const n of this.items)n.setSize(n.width*r,n.height*i);return this.handleChildChanges=!0,this.width=e,this.height=t,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,e,t),1}rotate(e,t,r){this.handleChildChanges=!1;for(const i of this.items)i.rotate(e,t,r);return this.handleChildChanges=!0,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,this.width,this.height),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return 1}setVisibility(e){if(e)return 1;throw new lt("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0441\u043A\u0440\u044B\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442-\u0433\u0440\u0443\u043F\u043F\u0443.")}removeAllItems(){this.items.forEach(e=>e._parent=void 0),this.items=[]}}const kn={0:"SOLID",1:"NULL",2:"HATCED",3:"PATTERN"};class tt extends be{constructor(e,t){super(e);if(this._color=e.color,this._fillType=kn[e.style],this._fillType==="HATCED"?console.warn("\u0421\u0442\u0438\u043B\u044C \u0437\u0430\u043B\u0438\u0432\u043A\u0438 HATCED \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D"):this._fillType||console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0437\u0430\u043B\u0438\u0432\u043A\u0438: ${e.style}`),e.dibHandle){const r=t&&t.get(e.dibHandle);this.changeBmpTool(r)}}get color(){return this._color}get fillType(){return this._fillType}get bmpTool(){return this._bmpTool}setColor(e){return this._color=e,this.dispatchChanges(),1}setFillType(e){return this._fillType=e,this.dispatchChanges(),1}changeBmpTool(e){return this._bmpTool&&this._bmpTool.unsubscribe(this),e&&e.subscribe(this,()=>this.dispatchChanges()),this._bmpTool=e,this.dispatchChanges(),1}unsubFromBmpTool(){this.bmpTool&&this.bmpTool.unsubscribe(this)}}class rt extends be{constructor(e){super(e);this._name=e.fontName.toLowerCase().startsWith("arial")?"Arial":e.fontName,this._size=-(e.height||0)||e.size,this._bold=!!e.weight}get name(){return this._name}get size(){return this._size}get bold(){return this._bold}}class it extends be{constructor(e){super(e);this._color=e.color,this._width=e.width,this._style=e.style===5?"NULL":"SOLID"}get color(){return this._color}get width(){return this._width}get style(){return this._style}setColor(e){return this._color=e,this.dispatchChanges(),1}setWidth(e){return this._width=e,this.dispatchChanges(),1}}class nt extends be{constructor(e){super(e);this._text=e.text}get text(){return this._text}setText(e){return this._text=e,this.dispatchChanges(),1}}class Ye extends be{static create(e,t,r){const i=e.textCollection.length,n=new Array;for(let o=0;o<i;o++){const{fontHandle:s,stringHandle:a,foregroundColor:l,backgroundColor:c}=e.textCollection[o],h=t.get(s);if(!h)return;const u=r.get(a);if(!u)return;n[o]={font:h,stringFragment:u,foregroundColor:l,backgroundColor:c}}return new Ye({handle:e.handle,fragments:n})}constructor(e){super(e);e.fragments.forEach(t=>{t.font.subscribe(this,()=>this.update()),t.stringFragment.subscribe(this,()=>this.update())}),this.fragments=e.fragments}get textCount(){return this.fragments.length}get assembledText(){if(!this.cachedString){const e=this.fragments.reduce((r,i)=>r+i.stringFragment.text,""),t=this.fragments.reduce((r,i)=>r+i.font.size,0)/this.fragments.length;this.cachedString={text:e,size:t}}return this.cachedString}getFragment(e){return this.fragments[e]}updateString(e,t){const r=this.fragments[t].stringFragment;r!==e&&(this.fragments[t].stringFragment=e,r&&r.unsubscribe(this),e.subscribe(this,()=>this.dispatchChanges())),this.update()}updateFont(e,t){const r=this.fragments[t].font;r!==e&&(this.fragments[t].font=e,r&&r.unsubscribe(this),e.subscribe(this,()=>this.dispatchChanges())),this.update()}updateFgColor(e,t){this.fragments[t].foregroundColor=e,this.update()}updateBgColor(e,t){this.fragments[t].backgroundColor=e,this.update()}update(){this.cachedString=void 0,this.dispatchChanges()}unsubFromTools(){this.fragments.forEach(({font:e,stringFragment:t})=>{e.unsubscribe(this),t.unsubscribe(this)})}}class Tt{constructor(e={}){this.bitmaps=e.bitmaps||ne.create(),this.brushes=e.brushes||ne.create(),this.doubleBitmaps=e.doubleBitmaps||ne.create(),this.fonts=e.fonts||ne.create(),this.pens=e.pens||ne.create(),this.strings=e.strings||ne.create(),this.texts=e.texts||ne.create()}createBitmap(e){const t=ne.getFreeHandle(this.bitmaps),r=Ce.loadFromStream(e,t,!1);return r?(this.bitmaps.set(t,r),r):void 0}createBrush(e,t,r){const i=ne.getFreeHandle(this.brushes),n=new tt({handle:i,color:e,style:t,dibHandle:r},this.bitmaps);return this.brushes.set(i,n),n}createDoubleBitmap(e){const t=ne.getFreeHandle(this.doubleBitmaps),r=Ce.loadFromStream(e,t,!1);return r?(this.doubleBitmaps.set(t,r),r):void 0}createFont(e,t,r){const i=ne.getFreeHandle(this.fonts),n=new rt({handle:i,fontName:e,size:t,weight:+r});return this.fonts.set(i,n),n}createPen(e,t,r){const i=ne.getFreeHandle(this.pens),n=new it({handle:i,width:e,color:t,style:r});return this.pens.set(i,n),n}createString(e){const t=ne.getFreeHandle(this.strings),r=new nt({handle:t,text:e});return this.strings.set(t,r),r}createText(e,t,r,i){const n=ne.getFreeHandle(this.texts),o=[{fontHandle:e,stringHandle:t,foregroundColor:r,backgroundColor:i}],s=Ye.create({handle:n,textCollection:o},this.fonts,this.strings);return s?(this.texts.set(n,s),s):void 0}deleteTool(e,t){switch(e){case"ttDIB2D":return this.bitmaps.delete(t)?1:0;case"ttBRUSH2D":const r=this.brushes.get(t);return r?(r.unsubFromBmpTool(),this.brushes.delete(t),1):0;case"ttDOUBLEDIB2D":return this.doubleBitmaps.delete(t)?1:0;case"ttFONT2D":return this.fonts.delete(t)?1:0;case"ttPEN2D":return this.pens.delete(t)?1:0;case"ttSTRING2D":return this.strings.delete(t)?1:0;case"ttTEXT2D":const i=this.texts.get(t);return i?(i.unsubFromTools(),this.texts.delete(t),1):0}}merge(e){e.bitmaps.forEach(t=>{const r=ne.getFreeHandle(this.bitmaps);t.handle=r,this.bitmaps.set(r,t)}),e.brushes.forEach(t=>{const r=ne.getFreeHandle(this.brushes);t.handle=r,this.brushes.set(r,t)}),e.doubleBitmaps.forEach(t=>{const r=ne.getFreeHandle(this.doubleBitmaps);t.handle=r,this.doubleBitmaps.set(r,t)}),e.fonts.forEach(t=>{const r=ne.getFreeHandle(this.fonts);t.handle=r,this.fonts.set(r,t)}),e.pens.forEach(t=>{const r=ne.getFreeHandle(this.pens);t.handle=r,this.pens.set(r,t)}),e.strings.forEach(t=>{const r=ne.getFreeHandle(this.strings);t.handle=r,this.strings.set(r,t)}),e.texts.forEach(t=>{const r=ne.getFreeHandle(this.texts);t.handle=r,this.texts.set(r,t)})}}function Ut(e){const{bitmapTools:t,brushTools:r,doubleBitmapTools:i,fontTools:n,penTools:o,stringTools:s,textTools:a}=e,l=t&&ne.create(t.map(g=>[g.handle,Ce.loadFromParams(g)])),c=r&&ne.create(r.map(g=>[g.handle,new tt(g,l)])),h=i&&ne.create(i.map(g=>[g.handle,Ce.loadFromParams(g)])),u=n&&ne.create(n.map(g=>[g.handle,new rt(g)])),f=o&&ne.create(o.map(g=>[g.handle,new it(g)])),p=s&&ne.create(s.map(g=>[g.handle,new nt(g)])),m=a&&ne.create(a.map(g=>{const S=Ye.create(g,u,p);if(!S)throw new le(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0422\u0435\u043A\u0441\u0442 #${g.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);return[g.handle,S]}));return new Tt({bitmaps:l,brushes:c,doubleBitmaps:h,fonts:u,pens:f,strings:p,texts:m})}function Fn(e,t,r){switch(e.type){case"otLINE2D":return new Ue(e,t,r);case"otBITMAP2D":case"otDOUBLEBITMAP2D":return We.create(e,t,r);case"otTEXT2D":return Xe.create(e,t,r);case"otCONTROL2D":return new Wt(e,t)}}function Xt(e,t,r,i){const n=ne.create(),o=[];for(const s of e){let a;if(s.type==="otGROUP2D")a=new ze(s),o.push({obj:a,data:s});else{if(a=Fn(s,t,r),!a)throw new le(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C ${s.type} #${s.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);a.setHiddenLayers(i)}n.set(s.handle,a)}for(const{obj:s,data:a}of o){const l=a.childHandles.map(c=>{const h=n.get(c);if(!h)throw new le(`\u0413\u0440\u0443\u043F\u043F\u0430 #${a.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043D\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 #${c}`);if(h.parent)throw new le(`\u0413\u0440\u0443\u043F\u043F\u0430 #${a.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043E\u0431\u044A\u0435\u043A\u0442 #${c}, \u0441\u043E\u0441\u0442\u043E\u044F\u0449\u0438\u0439 \u0432 \u0434\u0440\u0443\u0433\u043E\u0439 \u0433\u0440\u0443\u043F\u043F\u0435`);return h});s.addItems(l)}return n}class _e{constructor({handle:e,vdr:t,window:r}){this._originX=0;this._originY=0;this.subs=new Array;this.layers=0;this.handle=e,this.window=r;const{renderer:i}=r;if(this.renderer=i,t){const{origin:n,layers:o,brushHandle:s,elements:a,elementOrder:l}=t;if(this.setOrigin(n.x,n.y),this.layers=o,this.tools=Ut(t),s){const c=this.tools.brushes.get(s);c&&(c.subscribe(this,()=>this.renderer.updateBrush(c)),r.renderer.updateBrush(c))}this.objects=a?Xt(a,i,this.tools,o):ne.create(),l&&i.placeObjects(l)}else this.tools=new Tt,this.objects=ne.create();i.subscribeToControlEvents((...n)=>this.dispatchControlEvent(...n)),i.subscribeToMouseEvents((...n)=>this.dispatchMouseEvent(...n))}insertVectorDrawing(e,t,r){const i=Ut(e),n=[],o=new Map;if(e.elements){let a=0;const l=e.elements.map(c=>{const h=a=ne.getFreeHandle(this.objects,a);return o.set(c.handle,h),ee(ee({},c),{handle:h})});l.forEach(c=>{c.type==="otGROUP2D"&&(c.childHandles=c.childHandles.map(h=>o.get(h)))});for(const c of Xt(l,this.renderer,i,e.layers).values())this.objects.set(c.handle,c),c.parent||n.push(c)}if(this.tools.merge(i),n.length===0)return;let s;if(n.length>1){const a=ne.getFreeHandle(this.objects);s=new ze({handle:a,items:n}),this.objects.set(a,s)}else s=n[0];return s.setPosition(t,r),e.elementOrder&&this.renderer.placeObjects(e.elementOrder.map(a=>o.get(a))),s}get originX(){return this._originX}get originY(){return this._originY}setOrigin(e,t){return e===this._originX&&t===this.originY||(this._originX=e,this._originY=t,this.renderer.setView(e,t)),1}setLayers(e){if(this.layers!==e)for(const t of this.objects.values())t.type!=="otGROUP2D"&&t.setHiddenLayers(e)}createLine(e,t,r){const i=ne.getFreeHandle(this.objects),n=Ue.create({handle:i,brushHandle:r,penHandle:t,points:e},this.renderer,this.tools);return this.objects.set(i,n),this.renderer.appendObjectToEnd(n.renderable),n}createBitmap(e,t,r,i){const n=ne.getFreeHandle(this.objects),o=We.create({handle:n,bmpHandle:r,position:{x:e,y:t},type:i?"otDOUBLEBITMAP2D":"otBITMAP2D"},this.renderer,this.tools);return o?(this.objects.set(n,o),this.renderer.appendObjectToEnd(o.renderable),o):void 0}createText(e,t,r,i){const n=ne.getFreeHandle(this.objects),o=Xe.create({handle:n,angle:r,position:{x:e,y:t},textToolHandle:i},this.renderer,this.tools);return o?(this.objects.set(n,o),this.renderer.appendObjectToEnd(o.renderable),o):void 0}createGroup(e){const t=new Array(e.length);for(let n=0;n<e.length;n++){const o=e[n],s=this.objects.get(o);s?t[n]=s:console.warn(`\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443 \u0441 \u043D\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u043C \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u043C ${o}`)}const r=ne.getFreeHandle(this.objects),i=new ze({handle:r,items:t});return this.objects.set(r,i),i}getObject(e){return this.objects.get(e)}deleteObject(e){const t=this.objects.get(e);if(!t)return 0;if(t.parent&&t.parent.removeItem(t),t.type!=="otGROUP2D")t.type!=="otCONTROL2D"&&t.unsubFromTools(),this.renderer.removeObject(t.renderable);else{const r=t.items;t.removeAllItems();for(const i of r)this.deleteObject(i.handle)}return this.objects.delete(e),1}deleteGroup(e){const t=this.objects.get(e);return!t||t.type!=="otGROUP2D"?0:(t.removeAllItems(),this.objects.delete(e),1)}moveObjectToTop(e){const t=this.objects.get(e);return t?(t.type==="otGROUP2D"?this.renderer.moveObjectRangeToTop(t.getItemsRecursive().map(r=>r.renderable)):this.renderer.moveObjectToTop(t.renderable),1):0}findObjectInGroup(e,t){for(const r of t.items){if(r.name===e)return r;if(r.type==="otGROUP2D")return this.findObjectInGroup(e,r)}return}findObjectByName(e,t){if(t===0){for(const i of this.objects.values())if(i.name===e)return i;return}const r=this.objects.get(t);return r!==void 0&&r.type==="otGROUP2D"?this.findObjectInGroup(e,r):void 0}getObjectFromPoint(e,t){const r=this.renderer.getVisualHandleFromPoint(e,t);if(!r)return;let i=this.objects.get(r);if(!i)return;for(;i.parent;)i=i.parent;return i}isIntersect(e,t){const r=this.objects.get(e);if(!r)return 0;const i=this.objects.get(t);if(!i)return 0;const n=r.positionX,o=n+r.width,s=r.positionY,a=s+r.height,l=i.positionX,c=l+i.width,h=i.positionY,u=h+i.height;return o>=l&&c>=n&&a>=h&&u>=s?1:0}subscribeToEvent(e,t,r,i){const n=i.currentClass;if(this.subs.some(o=>o.receiver===n&&o.eventCode===e)){console.warn(`\u041F\u043E\u0432\u0442\u043E\u0440\u043D\u044B\u0439 RegisterObject(${n.protoName}, ${fe[e]}, #${t})`);return}this.subs.push({ctx:i,receiver:n,objectHandle:t,eventCode:e})}static setDoubleValue(e,t,r){const i=e.receiver.vars.nameToIdMap.get(t);if(i!==void 0){const n=e.receiver.vars.globalIds[i];e.ctx.memoryManager.newDoubleValues[n]=r,e.ctx.memoryManager.oldDoubleValues[n]=r}}static setLongValue(e,t,r){const i=e.receiver.vars.nameToIdMap.get(t);if(i!==void 0){const n=e.receiver.vars.globalIds[i];e.ctx.memoryManager.newLongValues[n]=r,e.ctx.memoryManager.oldLongValues[n]=r}}dispatchControlEvent(e,t){this.subs.forEach(r=>{const i=r.eventCode===e&&((r.objectHandle?t===r.objectHandle:!0)||r.receiver.isCapturingEvents(this.handle));if(!i||!r.receiver.canReceiveEvents)return;_e.setDoubleValue(r,"msg",e),_e.setLongValue(r,"_hobject",t),_e.setDoubleValue(r,"iditem",-1),_e.setDoubleValue(r,"wnotifycode",768),r.receiver.compute(r.ctx,!0)})}dispatchMouseEvent(e,t,r,i){this.subs.forEach(n=>{if(!n.receiver.canReceiveEvents)return;const o=n.eventCode===e||n.eventCode===fe.WM_ALLMOUSEMESSAGE;if(!o)return;if(!n.receiver.isCapturingEvents(this.handle)&&n.objectHandle){const s=this.getObjectFromPoint(r,i),a=s?s.handle===n.objectHandle:!1;if(!a&&!this.renderer.testVisualIntersection(n.objectHandle,r,i))return}_e.setDoubleValue(n,"msg",e),_e.setDoubleValue(n,"xpos",r),_e.setDoubleValue(n,"ypos",i),_e.setDoubleValue(n,"fwkeys",t),n.receiver.compute(n.ctx,!0)})}}class Nr{constructor({source:e,window:t}){this.classname="";this.filename="";if(e){const{name:r,origin:i}=e;i==="class"?this.classname=r:i==="file"&&(this.filename=r)}this.window=t}get name(){return this.window.name}get renderer(){return this.window.renderer}get originX(){return this.window.originX}get originY(){return this.window.originY}setOrigin(e,t){return this.window.setOrigin(e,t),1}get width(){return this.window.width}get height(){return this.window.height}setSize(e,t){return this.window.setSize(e,t),1}close(){this.window.close()}}class Mr{constructor(e){this.scenes=ne.create();this.scenesByWinName=new Map;this.windows=new Map;this.ws=e}get screenWidth(){return this.ws.screenWidth}get screenHeight(){return this.ws.screenHeight}get areaOriginX(){return this.ws.areaOriginX}get areaOriginY(){return this.ws.areaOriginY}get areaWidth(){return this.ws.areaWidth}get areaHeight(){return this.ws.areaHeight}openSchemeWindow(e,t,r){if(t!==""&&console.warn(`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u044B \u043E\u043A\u043D\u0430 "${e}" \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F:
"${t}"`),this.hasWindow(e))throw new we(`\u041E\u043A\u043D\u043E ${e} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);const i=this.ws.createWindow(e),n=new Nr({source:r&&r.source,window:i});this.windows.set(e,n);const o=ne.getFreeHandle(this.scenes),s=new _e({handle:o,vdr:r,window:n});return this.scenes.set(o,s),this.scenesByWinName.set(e,s),o}hasWindow(e){return this.windows.get(e)?1:0}getWindow(e){return this.windows.get(e)}closeWindow(e){const t=this.windows.get(e);return t?(this.windows.delete(e),1):0}getSpace(e){return this.scenes.get(e)}getSpaceByWinName(e){return this.scenesByWinName.get(e)}closeAllWindows(){this.windows.forEach(e=>e.close()),this.windows=new Map,this.scenesByWinName=new Map,this.scenes=new Map}}var ae;(function(e){e[e.Float=0]="Float",e[e.Handle=1]="Handle",e[e.String=2]="String",e[e.ColorRef=3]="ColorRef"})(ae||(ae={}));function Pr(e){switch(e){case"FLOAT":return ae.Float;case"HANDLE":return ae.Handle;case"STRING":return ae.String;case"COLORREF":return ae.ColorRef}}function _t(e,t){switch(e){case ae.String:return t;case ae.Float:return parseFloat(t)||0;case ae.Handle:return(t.startsWith("#")?parseInt(t.substring(1,t.length)):parseInt(t))||0;case ae.ColorRef:return ar(t)}}const Ee=2047,Pe=2048,wt=8192,Et=16384;function Bn(e,t){const r=new Array(t);let i=0;for(let f=t-1;f>=0;f--)r[f]=e.popString().toLowerCase();const n=e.popString(),o=e.popString();if(o!==""){e.setError(`\u0412\u044B\u0437\u043E\u0432 SendMessage \u0441 path=${o} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);return}if(!e.canExecuteClass)return;const s=e.classManager.getClassesByProtoName(n);if(s.length===0)return;const a=s[0].vars;if(!a)return;const l=e.classVars,c=new Uint16Array(t),h=new Array(t),u=e.memoryManager;for(let f=0;f<t;f+=2){const p=l.nameToIdMap.get(r[f]);if(p===void 0)continue;const m=a.nameToIdMap.get(r[f+1]);if(m===void 0)continue;const g=l.typeCodes[p],S=a.typeCodes[m];if(g!==S)throw new Error("\u0418\u043D\u043A\u043E\u043D\u0441\u0438\u0441\u0442\u0435\u043D\u0442\u043D\u044B\u0435 \u0442\u0438\u043F\u044B");c[i]=l.globalIds[p],c[i+1]=m,h[i]=u.getOldValues(g),h[i+1]=u.getNewValues(g),i+=2}for(let f=0;f<s.length;f++){const p=s[f],m=p.vars;if(m===l)continue;for(let g=0;g<i;g+=2){const S=c[g],C=m.globalIds[c[g+1]],k=h[g+1],W=h[g];W[C]=k[C]=k[S]}p.compute(e,!0);for(let g=0;g<t;g+=2){const S=c[g],C=m.globalIds[c[g+1]],k=h[g+1];k[S]=k[C]}}}function Gn(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),o=e.popLong();if(i!==""){e.setError(`\u0412\u044B\u0437\u043E\u0432 RegisterObject \u0441 path=${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);return}const s=e.windows.getSpace(o);s&&s.subscribeToEvent(r,n,t,e)}function Vn(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),o=e.popString();console.warn(`\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E: RegisterObjectByWinname(${o}, ${n}, "${i}", ${r}, ${t})`)}function Hn(e){const t=e.currentClass.getClassByPath(e.popString().toLowerCase());e.pushString(t?t.protoName:"")}function Wn(e,t){t&&console.log(t),e.setError("\u0412\u044B\u0437\u043E\u0432 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0445 \u0444\u0443\u043D\u043A\u0446\u0438\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}function Un(e){const t=e.popDouble(),r=e.popString(),i=e.popLong(),n=e.currentClass.getClassByPath(r.toLowerCase());if(!n)return;n.startCaptureEvents(i)}function Xn(e){e.currentClass.stopCaptureEvents()}function zn(e){const t=e.popDouble(),r=e.popString(),i=e.popString(),n=e.currentClass.getClassByPath(i.toLowerCase());if(n===void 0||n.vars===void 0)return;const o=n.vars.nameToIdMap.get(r.toLowerCase());if(o===void 0)return;const s=n.vars.globalIds[o];e.memoryManager.oldDoubleValues[s]=t,e.memoryManager.newDoubleValues[s]=t}function Yn(e){const t=e.popString(),r=e.popString(),i=e.currentClass.getClassByPath(r.toLowerCase());if(i===void 0||i.vars===void 0)return;const n=i.vars.nameToIdMap.get(t.toLowerCase());if(n===void 0)return;const o=i.vars.globalIds[n];e.pushLong(e.memoryManager.newLongValues[o])}function kr(e){e(v.VM_SENDMESSAGE,Bn),e(v.V_REGISTEROBJECT,Gn),e(v.REGISTEROBJECTS,Vn),e(v.V_GETCLASS,Hn),e(v.V_SETCAPTURE,Un),e(v.V_RELEASECAPTURE,Xn),e(v.V_SETVARF,zn),e(v.V_GETVARH,Yn),e(v.VFUNCTION,Wn)}function qn(e,t){e.pushDouble(e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]])}function Kn(e,t){e.pushDouble(e.memoryManager.newDoubleValues[e.classVars.globalIds[t]])}function Jn(e){throw"PUSH_FLOAT_PTR: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function $n(e,t){e.memoryManager.newDoubleValues[e.classVars.globalIds[t]]=e.popDouble()}function Zn(e,t){e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]]=e.popDouble()}function Qn(e){throw"POP_FLOAT_PTR: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function ea(e,t){e.pushLong(e.memoryManager.oldLongValues[e.classVars.globalIds[t]])}function ta(e,t){e.pushLong(e.memoryManager.newLongValues[e.classVars.globalIds[t]])}function ra(e,t){e.memoryManager.newLongValues[e.classVars.globalIds[t]]=e.popLong()}function ia(e){throw"vm_POP_LONG_OLD: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function na(e,t){e.pushString(e.memoryManager.oldStringValues[e.classVars.globalIds[t]])}function aa(e,t){e.pushString(e.memoryManager.newStringValues[e.classVars.globalIds[t]])}function oa(e,t){e.memoryManager.newStringValues[e.classVars.globalIds[t]]=e.popString()}function sa(e){throw"_POP_STRING_OLD: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function ca(e,t){e.pushLong(t),e.pushLong(1)}function la(e,t){e.pushLong(t),e.pushLong(0)}function ha(e,t){e.pushDouble(t)}function ua(e,t){e.pushLong(t)}function fa(e,t){e.pushString(t)}function da(e,t){e.nextOpPointer=t}function pa(e,t){e.popDouble()!==0&&(e.nextOpPointer=t)}function ma(e,t){e.popDouble()===0&&(e.nextOpPointer=t)}function ga(e,t){e.popLong()!==0&&(e.nextOpPointer=t)}function ba(e,t){e.popLong()===0&&(e.nextOpPointer=t)}function va(e){e.pushLong(e.popDouble())}function Sa(e){e.pushDouble(e.popLong())}function ya(e){e.pushDouble(Math.sin(e.popDouble()))}function Ta(e){e.pushDouble(Math.cos(e.popDouble()))}function _a(e){throw"V_ASIN: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function wa(e){throw"V_ACOS: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ea(e){throw"V_ATAN: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function xa(e){throw"V_TAN: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ca(e){throw"V_EXP: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Da(e){const t=e.popDouble();e.pushDouble(Math.sqrt(t)||0)}function Oa(e){const t=e.popDouble();e.pushDouble(t*t)}function Ra(e){throw"V_ED: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function ja(e){throw"V_DELTA: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Aa(e){e.pushDouble(e.popDouble()*e.popDouble())}function Ia(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(t===0?0:r/t)}function La(e){e.pushDouble(e.popDouble()+e.popDouble())}function Na(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(r-t)}function Ma(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(r%t)}function Pa(e){e.pushDouble(Math.log(e.popDouble()))}function ka(e){e.pushDouble(Math.log10(e.popDouble()))}function Fa(e){throw"V_LOG: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ba(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(Math.pow(r,t))}function Ga(e){e.pushDouble(Math.max(e.popDouble(),e.popDouble()))}function Va(e){e.pushDouble(Math.min(e.popDouble(),e.popDouble()))}function Ha(e){e.pushDouble((e.popDouble()+e.popDouble())/2)}function Wa(e){const t=Math.pow(10,Math.floor(e.popDouble())),r=e.popDouble();e.pushDouble(Math.round(r*t)/t)}function Ua(e){e.pushDouble(Math.trunc(e.popDouble()))}function Xa(e){e.pushDouble(e.popDouble()*Math.random())}function za(e){e.pushDouble(Math.abs(e.popDouble()))}function Ya(e){throw"V_SGN: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function qa(e){throw"V_RAD: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ka(e){throw"V_DEG: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ja(e){const t=e.popDouble()&&1,r=e.popDouble()&&1;e.pushDouble(t&&r)}function $a(e){const t=e.popDouble()&&1,r=e.popDouble()&&1;e.pushDouble(t||r)}function Za(e){e.pushDouble(Number(e.popDouble()===0))}function Qa(e){throw"V_STOP: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function eo(e){e.pushDouble(-e.popDouble())}function to(e){e.pushDouble(e.popDouble()&e.popDouble())}function ro(e){e.pushDouble(e.popDouble()|e.popDouble())}function io(e){throw"V_SHR: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function no(e){throw"V_SHL: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function ao(e){e.pushDouble(Number(e.popDouble()===e.popDouble()))}function oo(e){e.pushDouble(Number(e.popDouble()!==e.popDouble()))}function so(e){e.pushDouble(Number(e.popDouble()<e.popDouble()))}function co(e){e.pushDouble(Number(e.popDouble()<=e.popDouble()))}function lo(e){e.pushDouble(Number(e.popDouble()>e.popDouble()))}function ho(e){e.pushDouble(Number(e.popDouble()>=e.popDouble()))}function uo(e){e.pushDouble(Number(e.popString()===e.popString()))}function fo(e){e.pushDouble(Number(e.popString()!==e.popString()))}function po(e){e.pushDouble(Number(e.popString()<e.popString()))}function mo(e){e.pushDouble(Number(e.popString()<=e.popString()))}function go(e){e.pushDouble(Number(e.popString()>e.popString()))}function bo(e){e.pushDouble(Number(e.popString()>=e.popString()))}function vo(e){e.pushDouble(Number(e.popLong()===e.popLong()))}function So(e){e.pushDouble(Number(e.popLong()!==e.popLong()))}function yo(e){e.pushDouble(Number(e.popLong()>0))}function To(e){throw"V_ANDI: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function _o(e){throw"V_ORI: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function wo(e){e.pushDouble(Number(e.popLong()===0))}function Eo(e){throw"V_NOTbin: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function xo(e){const t=e.popString(),r=e.popString(),i=e.popString();e.pushString(i.replace(new RegExp(r,"g"),t))}function Co(e){const t=e.popString(),r=e.popString();e.pushString(r+t)}function Do(e){const t=e.popDouble(),r=e.popString();e.pushString(r.substr(0,t))}function Oo(e){const t=e.popDouble(),r=e.popString();e.pushString(r.substr(r.length-t,t))}function Ro(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString();e.pushString(i.substr(r,t))}function jo(e){throw"POS_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ao(e){throw"REPLICATE_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Io(e){throw"LOWER_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Lo(e){throw"UPPER_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function No(e){throw"ANSI_TO_OEM_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Mo(e){throw"OEM_TO_ANSI_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Po(e){throw"COMPARE_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function ko(e){throw"COMPAREI_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Fo(e){e.pushDouble(e.popString().length)}function Bo(e){throw"LTRIM_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Go(e){throw"RTRIM_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Vo(e){throw"ALLTRIM_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Ho(e){throw"ASCII_STRING: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"}function Wo(e){e.pushString(String.fromCharCode(e.popDouble()))}function Uo(e){e.pushDouble(parseFloat(e.popString())||0)}function zt(e){return(Math.round(e*1e5)/1e5).toString()}function Xo(e){e.pushString(zt(e.popDouble()))}function zo(e){const t=zt(e.popDouble()),r=e.popString();e.pushString(r+t)}function Yo(e){const t=e.popString(),r=zt(e.popDouble());e.pushString(r+t)}function Fr(e){e(v.PUSH_FLOAT,qn),e(v._PUSH_FLOAT,Kn),e(v.PUSH_FLOAT_const,ha),e(v.PUSH_FLOAT_PTR,Jn),e(v._POP_FLOAT,$n),e(v._POP_FLOAT_OLD,Zn),e(v.POP_FLOAT_PTR,Qn),e(v.vmPUSH_LONG,ea),e(v.vmPUSH_LONG_const,ua),e(v.vm_PUSH_LONG,ta),e(v.vm_POP_LONG,ra),e(v.vm_POP_LONG_OLD,ia),e(v.PUSH_STRING,na),e(v._PUSH_STRING,aa),e(v.PUSH_STRING_CONST,fa),e(v._POP_STRING,oa),e(v.V_JMP,da),e(v.V_JNZ,pa),e(v.V_JZ,ma),e(v.V_JNZ_HANDLE,ga),e(v.V_JZ_HANDLE,ba),e(v.PUSHPTRNEW,ca),e(v.PUSHPTR,la),e(v.FLOAT_TO_LONG,va),e(v.LONG_TO_FLOAT,Sa),e(v._POP_STRING_OLD,sa),e(v.V_SIN,ya),e(v.V_COS,Ta),e(v.V_ASIN,_a),e(v.V_ACOS,wa),e(v.V_ATAN,Ea),e(v.V_TAN,xa),e(v.V_EXP,Ca),e(v.V_SQRT,Da),e(v.V_SQR,Oa),e(v.V_ED,Ra),e(v.V_DELTA,ja),e(v.V_MUL_F,Aa),e(v.V_DIV_F,Ia),e(v.V_ADD_F,La),e(v.V_SUB_F,Na),e(v.V_MOD,Ma),e(v.V_LN,Pa),e(v.V_LG,ka),e(v.V_LOG,Fa),e(v.V_STEPEN,Ba),e(v.V_MAX,Ga),e(v.V_MIN,Va),e(v.V_AVERAGE,Ha),e(v.V_ROUND,Wa),e(v.V_TRUNC,Ua),e(v.V_RANDOM,Xa),e(v.V_ABS,za),e(v.V_SGN,Ya),e(v.V_RAD,qa),e(v.V_DEG,Ka),e(v.V_AND,Ja),e(v.V_OR,$a),e(v.V_NOT,Za),e(v.V_STOP,Qa),e(v.V_UN_MINUS,eo),e(v.V_AND_BINARY,to),e(v.V_OR_BINARY,ro),e(v.V_SHR,io),e(v.V_SHL,no),e(v.V_EQUAL,ao),e(v.V_NOTEQUAL,oo),e(v.V_MORE,so),e(v.V_MOREorEQUAL,co),e(v.V_LOW,lo),e(v.V_LOWorEQUAL,ho),e(v.S_EQUAL,uo),e(v.S_NOTEQUAL,fo),e(v.S_MORE,po),e(v.S_MOREorEQUAL,mo),e(v.S_LOW,go),e(v.S_LOWorEQUAL,bo),e(v.V_EQUALI,vo),e(v.V_NOTEQUALI,So),e(v.V_EDI,yo),e(v.V_ANDI,To),e(v.V_ORI,_o),e(v.V_NOTI,wo),e(v.V_NOTbin,Eo),e(v.SCHANGE,xo),e(v.PLUS_STRING,Co),e(v.LEFT_STRING,Do),e(v.RIGHT_STRING,Oo),e(v.SUBSTR_STRING,Ro),e(v.POS_STRING,jo),e(v.REPLICATE_STRING,Ao),e(v.LOWER_STRING,Io),e(v.UPPER_STRING,Lo),e(v.ANSI_TO_OEM_STRING,No),e(v.OEM_TO_ANSI_STRING,Mo),e(v.COMPARE_STRING,Po),e(v.COMPAREI_STRING,ko),e(v.LENGTH_STRING,Fo),e(v.LTRIM_STRING,Bo),e(v.RTRIM_STRING,Go),e(v.ALLTRIM_STRING,Vo),e(v.ASCII_STRING,Ho),e(v.CHR_STRING,Wo),e(v.STRING_TO_FLOAT,Uo),e(v.FLOAT_TO_STRING,Xo),e(v.PLUS_STRING_FLOAT,zo),e(v.PLUS_FLOAT_STRING,Yo)}function ce(e,t,r){const i=e.windows.getSpace(t);return i&&i.getObject(r)}function qo(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n?n.setVisibility(t&&1):0)}function Ko(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);i&&i.setVisibility(1)}function Jo(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);i&&i.setVisibility(0)}function $o(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushLong(i&&i.parent?i.parent.handle:0)}function Zo(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.zOrder:0)}function Qo(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n?n.setZorder(t):0)}function es(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),o=e.popLong(),s=ce(e,o,n);e.pushDouble(s?s.rotate(i,r,t):0)}function ts(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),o=ce(e,n,i);e.pushDouble(o?o.setPosition(r,t):0)}function rs(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),o=ce(e,n,i);e.pushDouble(o?o.setSize(r,t):0)}function is(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.positionX:0)}function ns(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.positionY:0)}function as(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.width:0)}function os(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.height:0)}function ss(e){const t=e.popString(),r=e.popLong(),i=e.popLong();if(t===""){e.pushLong(0);return}const n=e.windows.getSpace(i);if(!n){e.pushLong(0);return}const o=n.findObjectByName(t,r);e.pushLong(o?o.handle:0)}function cs(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushLong(0);return}const o=n.getObjectFromPoint(r,t);e.pushLong(o?o.handle:0)}function ls(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?t.originX:0)}function hs(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?t.originY:0)}function us(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.windows.getSpace(i);e.pushDouble(n?n.setOrigin(r,t):0)}function fs(e){const t=e.popDouble(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?1:0)}function ds(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?1:0)}function ps(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.width:0)}function ms(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushDouble(i?i.height:0)}function gs(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=ce(e,i,t);e.pushDouble(n&&n.parent?n.parent.removeItem(n):0)}function bs(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n&&n.type==="otCONTROL2D"?n.setText(t):0)}function vs(e){const t=e.popLong(),r=e.popLong(),i=ce(e,r,t);e.pushString(i&&i.type==="otCONTROL2D"?i.text:"")}function Ss(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popDouble(),o=e.popLong(),s=e.popLong(),a=ce(e,s,o);e.pushDouble(a&&a.type==="otBITMAP2D"?a.setRect(n,i,r,t):0)}function ys(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n&&n.type==="otLINE2D"?n.getPoint(t).x:0)}function Ts(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n&&n.type==="otLINE2D"?n.getPoint(t).y:0)}function _s(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),o=e.popLong(),s=ce(e,o,n);e.pushDouble(s&&s.type==="otLINE2D"?s.setPointPosition(i,r,t):0)}function ws(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),o=e.popLong(),s=ce(e,o,n);e.pushDouble(s&&s.type==="otLINE2D"?s.addPoint(i,r,t):0)}function Es(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.windows.getSpace(n);e.pushDouble(o?o.isIntersect(i,r):0)}function xs(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);e.pushDouble(n?n.setName(t):0)}function Cs(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.moveObjectToTop(t):0)}function Ds(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.popLong(),s=e.popLong(),a=ce(e,s,o);if(!a){e.pushDouble(0);return}const l=a.width,c=a.height,h=e.classVars;i?e.memoryManager.newDoubleValues[h.globalIds[n]]=l:e.memoryManager.oldDoubleValues[h.globalIds[n]]=l,t?e.memoryManager.newDoubleValues[h.globalIds[r]]=c:e.memoryManager.oldDoubleValues[h.globalIds[r]]=c,e.pushDouble(1)}function Os(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=ce(e,i,r);if(!n||n.type!=="otGROUP2D"){e.pushLong(0);return}const o=n.getItem(t);e.pushLong(o?o.handle:0)}function Rs(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.deleteGroup(t):0)}function Br(e){e(v.GETOBJECTBYNAME,ss),e(v.SETOBJECTORG2D,ts),e(v.GETOBJECTFROMPOINT2D,cs),e(v.GETOBJECTORG2DX,is),e(v.GETOBJECTORG2DY,ns),e(v.GETOBJECTSIZE2DX,as),e(v.GETOBJECTSIZE2DY,os),e(v.GETSPACEORGY,hs),e(v.GETSPACEORGX,ls),e(v.SETSPACEORG2D,us),e(v.SETSCALESPACE2D,fs),e(v.GETSCALESPACE2D,ds),e(v.GETOBJECTPARENT2D,$o),e(v.ROTATEOBJECT2D,es),e(v.SETOBJECTSIZE2D,rs),e(v.SETSHOWOBJECT2D,qo),e(v.SHOWOBJECT2D,Ko),e(v.HIDEOBJECT2D,Jo),e(v.SETZORDER2D,Qo),e(v.GETZORDER2D,Zo),e(v.VM_GETACTUALWIDTH,ps),e(v.VM_GETACTUALHEIGHT,ms),e(v.DELGROUPITEM2D,gs),e(v.VM_SETCONTROLTEXT,bs),e(v.VM_GETCONTROLTEXT,vs),e(v.SETBITMAPSRCRECT,Ss),e(v.GETVECTORPOINT2DX,ys),e(v.GETVECTORPOINT2DY,Ts),e(v.SETVECTORPOINT2D,_s),e(v.ADDPOINT2D,ws),e(v.V_ISINTERSECT2D,Es),e(v.SETOBJECTNAME2D,xs),e(v.OBJECTTOTOP2D,Cs),e(v.VM_GETACTUALSIZE,Ds),e(v.GETGROUPITEM2D,Os),e(v.DELETEGROUP2D,Rs)}function js(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popString(),o=e.popLong(),s=e.windows.getSpace(o);if(!s){e.pushLong(0);return}const a=e.project.openVdrFile(n),l=a&&s.insertVectorDrawing(a,i,r);e.pushLong(l?l.handle:0)}function Gr(e,t){const r=t/2,i=new Array(r);for(let l=r-1;l>=0;l--)i[l]={y:e.popDouble(),x:e.popDouble()};const n=e.popLong(),o=e.popLong(),s=e.popLong(),a=e.windows.getSpace(s);e.pushLong(a?a.createLine(i,o,n).handle:0)}function As(e){Gr(e,2)}function Is(e,t){const r=new Array(t);for(let o=t-1;o>=0;o--)r[o]=e.popLong();const i=e.popLong(),n=e.windows.getSpace(i);if(n){const o=n.createGroup(r);if(o){e.pushLong(o.handle);return}}e.pushLong(0)}function Ls(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),o=e.windows.getSpace(n);if(o){const s=o.createBitmap(r,t,i,!1);if(s){e.pushLong(s.handle);return}}e.pushLong(0)}function Ns(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),o=e.popLong(),s=e.windows.getSpace(o);if(s){const a=s.createText(i,r,t,n);if(a){e.pushLong(a.handle);return}}e.pushLong(0)}function Ms(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.deleteObject(t):0)}function Vr(e){e(v.V_CREATEOBJECTFROMFILE,js),e(v.CREATEPOLYLINE2D,Gr),e(v.CREATELINE2D,As),e(v.CREATEGROUP2D,Is),e(v.CREATEBITMAP2D,Ls),e(v.CREATERASTERTEXT2D,Ns),e(v.DELETEOBJECT2D,Ms)}function at(e,t,r){const i=e.windows.getSpace(t);return i&&i.tools.texts.get(r)}function Ps(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushLong(0);return}const n=i.getObject(t);e.pushLong(n&&n.type==="otTEXT2D"?n.textTool.handle:0)}function ks(e){const t=e.popLong(),r=e.popLong(),i=at(e,r,t);e.pushDouble(i?i.textCount:0)}function Fs(e){const t=e.popLong(),r=e.popLong(),i=at(e,r,t);e.pushLong(i?i.getFragment(0).stringFragment.handle:0)}function Bs(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushString("");return}const n=i.tools.strings.get(t);e.pushString(n?n.text:"")}function Gs(e){const t=e.popLong(),r=e.popLong(),i=at(e,r,t);e.pushLong(i?i.getFragment(0).font.handle:0)}function Vs(e){const t=e.popLong(),r=e.popLong(),i=at(e,r,t);e.pushLong(i?i.getFragment(0).foregroundColor:0)}function Hs(e){const t=e.popLong(),r=e.popLong(),i=at(e,r,t);e.pushLong(i?i.getFragment(0).backgroundColor:0)}function Ws(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),o=e.windows.getSpace(n),s=!!(t&1),a=!!(t&2),l=!!(t&4),c=!!(t&8);e.pushLong(o?o.tools.createFont(i,r,c).handle:0)}function Us(e){const t=e.popString(),r=e.popLong(),i=e.windows.getSpace(r);e.pushLong(i?i.tools.createString(t).handle:0)}function Xs(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.popLong(),s=e.windows.getSpace(o);if(s){const a=s.tools.createText(n,i,r,t);if(a){e.pushLong(a.handle);return}}e.pushLong(0)}function zs(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),o=e.popLong(),s=e.popLong(),a=e.windows.getSpace(s);if(!a){e.pushDouble(0);return}const l=a.tools.texts.get(o);if(!l){e.pushDouble(0);return}const c=a.tools.fonts.get(n);c&&l.updateFont(c,0);const h=a.tools.strings.get(i);h&&l.updateString(h,0),l.updateFgColor(r,0),l.updateBgColor(t,0),e.pushDouble(1)}function Ys(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const o=n.tools.strings.get(r);e.pushDouble(o?o.setText(t):0)}function qs(e){const t=e.popDouble(),r=e.popLong(),i=e.popDouble(),n=e.popDouble(),o=e.popLong(),s=e.windows.getSpace(o);e.pushLong(s?s.tools.createPen(i,r,n).handle:0)}function Ks(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const o=n.tools.pens.get(r);e.pushDouble(o?1:0)}function Js(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.popDouble(),o=e.popDouble(),s=e.popLong(),a=e.windows.getSpace(s);e.pushLong(a?a.tools.createBrush(i,o,r).handle:0)}function $s(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const o=n.tools.brushes.get(r);e.pushDouble(o?o.setColor(t):0)}function Zs(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const o=n.tools.brushes.get(r);e.pushDouble(o?1:0)}function Qs(e){const t=e.popString(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushLong(0);return}const n=e.project.openFileStream(t);if(!n){e.pushLong(0);return}const o=i.tools.createBitmap(n);e.pushLong(o?o.handle:0)}function Hr(e){e(v.GETTEXTOBJECT2D,Ps),e(v.VM_GETTEXTCOUNT2D,ks),e(v.GETTEXTSTRING2D,Fs),e(v.GETLOGSTRING2D,Bs),e(v.GETTEXTFONT2D,Gs),e(v.GETTEXTFG2D,Vs),e(v.GETTEXTBK2D,Hs),e(v.CREATEFONT2D,Ws),e(v.CREATESTRING2D,Us),e(v.CREATETEXT2D,Xs),e(v.VM_SETLOGTEXT2D,zs),e(v.SETLOGSTRING2D,Ys),e(v.CREATEPEN2D,qs),e(v.SETPENROP2D,Ks),e(v.CREATEBRUSH2D,Js),e(v.SETBRUSHCOLOR2D,$s),e(v.SETBRUSHROP2D,Zs),e(v.CREATEDID2D,Qs)}function ec(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popDouble();console.warn(`\u0412\u044B\u0437\u043E\u0432 MGet(${n}, ${i}, ${r}, ${t})`),e.pushDouble(0)}function Wr(e){e(v.V_MGET,ec)}function tc(e){const t=e.popString();e.pushDouble(-1)}function Ur(e){e(v.MCISENDSTRING_INT,tc)}function rc(e){const t=e.popString(),r=e.popString(),i=e.popString(),n=e.windows.getSpaceByWinName(i);if(n){e.pushLong(n.handle);return}const o=e.project.getClassScheme(r);e.pushLong(o?e.windows.openSchemeWindow(i,t,o):0)}function ic(e){const t=e.popString(),r=e.popString(),i=e.popString(),n=e.windows.getSpaceByWinName(i);if(n){e.pushLong(n.handle);return}if(r!==""){e.setError(`\u0412\u044B\u0437\u043E\u0432 LoadSpaceWindow \u0441 fileName=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);return}e.pushLong(e.windows.openSchemeWindow(i,t))}function nc(e){e.pushDouble(e.windows.hasWindow(e.popString()))}function ac(e){const t=e.popString();e.pushDouble(1)}function oc(e){const t=e.windows.getSpaceByWinName(e.popString());e.pushLong(t?t.handle:0)}function sc(e){const t=e.popDouble(),r=e.popString();e.pushDouble(1)}function cc(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.windows.getWindow(i);e.pushDouble(n?n.setOrigin(r,t):0)}function lc(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.windows.getWindow(i);e.pushDouble(n?n.setSize(r,t):0)}function hc(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.width:0)}function uc(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.height:0)}function fc(e){const t=e.popString();e.pushDouble(1)}function dc(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.originX:0)}function pc(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.originY:0)}function mc(e){const t=e.popDouble(),r=e.popString();e.pushDouble(1)}function gc(e){const t=e.popLong(),r=e.popString();e.pushDouble(1)}function bc(e){const t=e.popLong(),r=e.popLong();e.pushDouble(1)}function vc(e){const t=e.popLong(),r=e.windows.getSpace(t);e.pushString(r?r.window.name:"")}function Sc(e){const t=e.popString().toLowerCase(),r=e.popString(),i=e.windows.getWindow(r);let n="";i&&(t==="classname"?n=i.classname:t==="filename"&&(n=i.filename)),e.pushString(n)}function yc(e){const t=e.popString();e.pushDouble(1)}function Xr(e){e(v.OPENSCHEMEWINDOW,rc),e(v.LOADSPACEWINDOW,ic),e(v.ISWINDOWEXIST,nc),e(v.CLOSEWINDOW,ac),e(v.V_GETHSPBYNAME,oc),e(v.SHOWWINDOW,sc),e(v.SETWINDOWORG,cc),e(v.V_SETCLIENTSIZE,lc),e(v.GETCLIENTWIDTH,hc),e(v.GETCLIENTHEIGHT,uc),e(v.BRINGWINDOWTOTOP,fc),e(v.WIN_ORGX,dc),e(v.WIN_ORGY,pc),e(v.VM_SETWINDOWTRANSPARENT,mc),e(v.VM_SETWINDOWTRANSPARENTCOLOR,gc),e(v.VM_SETWINDOWOWNER,bc),e(v.V_GETNAMEBYHSP,vc),e(v.VM_GETWINDOWPROP,Sc),e(v.ISWINDOWVISIBLE,yc)}const ke=new Array(v.VM_MAXIMUM_code);(function(){function e(t,r){if(ke[t])throw"Operation already set: "+t;ke[t]=r}kr(e),Fr(e),Br(e),Vr(e),Hr(e),Wr(e),Ur(e),or(e),Xr(e)})();function zr(e,t){e.code.forEach((r,i)=>{const n=v[r&Ee].toString(),o=r&Pe?r&4096?(/push/i.test(n)?"<- ":"-> ")+t[e.numberOperands[i]]:e.numberOperands[i]:e.stringOperands[i]!==void 0?`"${e.stringOperands[i]}"`:"";console.log(`${i}: ${n} ${o}`)})}var ot=["","push","push_new","push","push_new","push_cst","push_cst","","","",":=_old",":=",":=_old",":=","","","RGBf","FLOAT","+","-","/","*","%","tan","arctan","sin","arcsin","cos","arccos","ln","lg","log","^","exp","sqrt","sqr","ed","delta","max","min","average","round","rnd","and","or","not","abs","sgn","rad","deg","Stop","jmp","jnz","jz","==","!=",">",">=","<","<=","MCreate","MDelete","MFill","MGet","MPut","MEditor","MDiag","MAddX","MSubX","MDivX","MMulX","MDet","MDelta","MEd","MTransp","MAddC","MNot","MSum","MSubC","MMulC","trunc","CloseAll","==","!=","ed","&&","||","not","NotBin","SetCrdSystem2d","MDivC","MMul","MGlue","MCut","MMove","MObr","MDim","Xor","XorBin","ChooseFolderDialog","MSaveAs","MLoad","FileSaveDialog","FileLoadDialog","CreateObjectFromFile2d","&","|","Quit","","","jnz","jz","SetStatusText","un_minus","","gettickcount","<<",">>","","Change","push","push_new","push_cst",":=","+","Left","Right","Substr","Pos","Replicate","Lower","Upper","Ansi_To_Oem","Oem_To_Ansi","Compare","Comparei","Length","Ltrim","Rtrim","Alltrim","ASCII","Chr","String","Float","==","!=",">",">=","<","<=","RGB","system","systemstr","RegisterObject","UnregisterObject","SetCapture","ReleaseCapture",":=_old","GetMousePos","InputBox","MessageBox","CreateStream","CloseStream","Seek","StreamStatus","Eof","","Getpos","GetSize","SetWidth","Read","ReadLn","Write","WriteLn","GetLine","CopyBlock","Truncate","randomize","","","","","","","","","","","","","","","","","","","","CreateObjectFromFile3d","Shell","RGBEx","LoadSpacewindow","OpenSchemeWindow","CloseWindow","GetWindowName","GetWindowSpace","SetClientSize","SetWindowTitle","GetWindowTitle","ShowWindow","SetWindowPos","SetWindowOrg","SetWindowSize","IswindowVisible","IsIconic","IsWindowExist","BringWindowToTop","CascadeWindows","Tile","ArrangeIcons","GetWindowOrgX","GetWindowOrgY","GetWindowWidth","GetWindowHeight","GethObject","GetObject2dByName","GetClientWidth","GetClientHeight","ChoseColorDialog","joygetx","joygety","joygetz","joygetbuttons","GetAsyncKeyState","GetClassDirectory","GetProjectDirectory","GetWindowsDirectory","GetSystemDirectory","GetPathFromFile","AddSlash","GetStratumDirectory","WinExecute","SetScrollRange","GetActualWidth2d","GetActualHeight2d","SaveRectArea2d","LockSpace2d","LoadMenu","DeleteMenu","RegisterObject","UnregisterObject","MCISENDSTRINGstr","MCISENDSTRING","MCISENDSTRINGEX","GETLASTMCIERROR","GETMCIERRORSTR","SetCalcOrder","GetCalcOrder","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","GetObject3dFromPoint2d","SweepAndExtrude3d","IsObjectsIntersect2d","SetLineArrows2d","CreateLine2d","AddPoint2d","DelPoint2d","GetBrushObject2d","GetPenObject2d","GetRGNCreateMode","GetVectorNumPoints2d","GetVectorPoint2dx","GetVectorPoint2dy","SetBrushObject2d","SetPenObject2d","SetRGNCreateMode","SetVectorPoint2d","CreatePen2d","GetPenColor2d","GetPenRop2d","GetPenStyle2d","GetPenWidth2d","SetPenColor2d","SetPenROP2d","SetPenStyle2d","SetPenWidth2d","DeleteTool2d","DeleteObject2d","GetObjectOrg2dx","GetObjectOrg2dy","GetObjectParent2d","GetObjectAngle2d","GetObjectWidth2d","GetObjectHeight2d","GetObjectType2d","SetObjectOrg2d","SetObjectSize2d","CreateBrush2d","SetPoints2d","CreateDIB2d","CreateDoubleDIB2d","CreateRDIB2d","CreateRDoubleDIB2d","CreateBitmap2d","CreateDoubleBitmap2d","GetSpaceOrg2dy","GetSpaceOrg2dx","SetSpaceOrg2d","SetScaleSpace2d","GetScaleSpace2d","SndPlaySound","GetBottomObject2d","GetUpperObject2d","GetObjectFromZOrder2d","GetLowerObject2d","GetTopObject2d","GetZOrder2d","ObjectToBottom2d","ObjectToTop2d","SetZOrder2d","SwapObject2d","SetBitmapSrcRect2d","SetObjectAttribute2d","GetObjectAttribute2d","CreateFont2d","CreateString2d","CreateText2d","CreateRasterText2d","SetShowObject2d","SetString2d","AddGroupItem2d","CreateGroup2d","DeleteGroup2d","DelGroupItem2d","GetGroupItem2d","","GetGroupItemsNum2d","IsGroupContainObject2d","SetGroupItem2d","SetGroupItems2d","CopyToClipboard2d","PasteFromClipboard2d","GetObjectName2d","SetObjectName2d","GetObjectFromPoint2d","GetLastPrimary2d","RotateObject2d","ShowObject2d","HideObject2d","StdHyperJump","GetObjectCount","GetHObjectByNum","","GetObjectClass","FLOAT","GetControlText2d","SetControlText2d","CheckDlgButton2d","IsDlgButtonChecked2d","EnableControl2d","SetBrushHatch2d","GetString2d","GetClassName","","","GetBrushColor2d","GetBrushRop2d","GetBrushDib2d","GetBrushStyle2d","GetBrushHatch2d","SetBrushColor2d","SetBrushRop2d","SetBrushDib2d","SetBrushStyle2d","CreateObject","DeleteObject","CreateClass","DeleteClass","OpenClassScheme","CloseClassScheme","CreateLink","SetLinkVars","RemoveLink","GetUniqueClassName","GethObjectByName","CreateWindowEx","","","","","","","","","GetVarF","GetVarS","GetVarC","SetVar","SetVar","SetVar","CreateLink","SetModelText","GetModelText","GetAngleByXY","GetObjectFromPoint2dEx","OpenVideo","CloseVideo","","","","CreateVideoFrame2d","VideoSetPos2d","FrameSetPos2d","VideoPlay2d","VideoPause2d","VideoResume2d","VideoStop2d","FrameSetSrcRect2d","VideoGetPos2d","FrameGetPos2d","FrameGetVideo2d","BeginWriteVideo2d","VideoDialog","WriteVideoFrame2d","SetControlStyle2d","GetControlStyle2d","LBAddString","LBInsertString","LBGetString","LBClearList","LBDeleteString","LBGetCount","LBGetSelIndex","LBSetSelIndex","LBGetCaretIndex","LBSetCaretIndex","LBFindString","LBFindStringExact","GetDibPixel2d","GetTime","","","VFunction","DLLFunction","GetElement","SetElement","EmptySpace2d","","","CreatePolyLine2d","GetNameByHandle","SetSpaceLayers2d","GetSpaceLayers2d","","","LogMessage","SetVarsToDefault","GetTextObject2d","GetTextString2d","GetTextFont2d","LoadObjectState","SaveObjectState","GetWindowProp","_CameraProc3d","DbOpenBase","DbOpenTable","DbCloseBase","DbCloseTable","DbGetError","DbGetErrorStr","DbSetDir","DbCloseAll","DbGoTop","DbGoBottom","DbSkip","DbFieldId","DbGetField","DbSQL","DbGetCount","DbBrowse","DBGetFieldN","DBGetFieldName","DBGetFieldType","DbInsertRecord","DbAppendRecord","DbDeleteRecord","DbSetField","DbSetField","DbSetField","DbSetField","DbGetFieldN","DbGetField","DbCreateTable","DbZap","DbAddIndex","DbDeleteIndex","DbOpenIndex","DbSwitchToIndex","DbCloseIndex","DbRegenIndex","DbGetBlob","DbPutBlob","DbFreeBlob","DbPackFile","DbSortTable","DbGetDelMode","DbSetDelMode","DbSetCodePage","DbGetCodePage","DbLock","DbUnlock","DbUndeleteRecord","DbCopyTo","DbSetToKey","DbGetFieldCount","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","DbSetTable","DbSetControlTable","DbGetPos","","","","","","","","","","","","","","","","","","SendMessage","SetObjectName","SetText2d","GetTextFgColor2d","GetTextBkColor2d","Dialog","DialogEx","GetLink","DialogBox","GetRValue","GetGValue","GetBValue","GetToolRef2d","GetNextTool2d","GetNextObject2d","","","","","","","","","","","","","","","","","","","","","GetPoint3d","SetPoint3d","SetPrimitive3d","CreateObject3d","DelPrimitive3d","GetNumPrimitives3d","AddPrimitive3d","DelPoint3d","GetNumPoints3d","AddPoint3d","SetObjectMatrix3d","GetObjectMatrix3d","TransformObjectPoints3d","RotateObjectPoints3d","GetObjectBase3dM","SetObjectBase3d","GetObjectBase3d","GetSpace3d","GetObjectDimension3d","TransformObject3d","RotateObject3d","SetObjectColor3d","CreateDefCamera3d","SwitchToCamera3d","GetActiveCamera","CreateSpace3d","DeleteSpace3d","Create3dView","GetObjectPoints3d","SetObjectPoints3d","GetObjectColor3d","SetCurrentObject2d","GetCurrentObject2d","CreateSurface3d","FitToCamera3d","SetCameraPoint3d","PushCrdSystem3d","PopCrdSystem3d","SelectLocalCrd3d","SelectWorldCrd3d","SelectViewCrd3d","TransformCamera3d","SetColors3d","GetColors3d","GetMaterialByName3d","","","","","","","","","","","","","","","","","","","","","new","delete","vClearAll","vInsert","vDelete","vGetCount","vGetType","vGetF","vGetS","vGetH","vSet","vSet","vSet","GetControlText2ds","SetControlText2ds","","","","","","LoadProject","UnloadProject","SetActiveProject","IsProjectExist","","SetProjectProp","GetProjectProp","SetProjectProp","ApplyTexture3d","RemoveTexture3d","CreateDir","DeleteDir","FileRename","FileCopy","FileExist","FileDelete","GetFileList","GetActualSize2d","SetBkBrush2d","GetBkBrush2d","diff1","equation","diff2","dequation","GetDibObject2d","SetDibObject2d","GetDDibObject2d","SetDDibObject2d","GetDate","GetVideoMarker","GetVarInfo","GetVarCount","vSave","vLoad","GetBitmapSrcRect2d","SetHyperJump2d","SetRDib2d","SetRDoubleDib2d","GetRDib2d","GetRDoubleDib2d","MSort","DuplicateObject3d","CheckMenuItem","EnableMenuItem","","","","","","","+","+","GetScreenWidth","GetScreenHeight","GetWorkAreaX","GetWorkAreaY","GetWorkAreaWidth","GetWorkAreaHeight","GetKeyboardLayout","Substr","","","SetWindowTransparent","SetWindowTransparentColor","SetWindowRegion","GetTitleHeight","GetSmallTitleHeight","GetFixedFrameWidth","GetFixedFrameHeight","GetSizeFrameWidth","GetSizeFrameHeight","WindowInTaskBar","","SetWindowTransparent","SetWindowTransparentColor","SetWindowRegion","ShowCursor","ScreenShot","LockObject2d","GetVarInfo","++","","AudioOpenSound","AudioPlay","AudioStop","AudioIsPlaying","AudioReset","AudioSetRepeat","AudioGetRepeat","AudioSetVolume","AudioGetVolume","AudioSetBalance","AudioGetBalance","AudioSetTone","AudioGetTone","AudioIsSeekable","AudioSetPosition","AudioGetPosition","AudioGetLength","","","","","","","","","","","","","GetWordInfo","GetAnswer","GetSentanceTree","GetWordProperty","GetWordPropertyInSent","GetWordInSentByRole","GetWordFormCount","GetWordForm","SearchWords","GetWordInfo","SendSMS","ScreenShot","SendMail","ScreenShot","ScreenShot","GetFontName2d","GetFontSize2d","GetTextCount2d","GetFontStyle2d","SetFontSize2d","SetFontStyle2d","SetFontName2d","GetTextString2d","GetTextFont2d","GetTextFgColor2d","GetTextBkColor2d","SetTextString2d","SetTextFont2d","SetTextFgColor2d","SetTextBkColor2d","SetText2d","CreateFont2dpt","SetStandartCursor","SetStandartCursor","LoadCursor","LoadCursor","inc","inc","dec","dec","limit","GetFontList","vSort","vSort","vSort","GetUserKeyValue","GetUserKeyFullValue","GetTempDirectory","SendUserResult","CopyUserResult","GetROMDriveNames","ShellWait","ReadUserKey","GetUserKeyValue","GetUserKeyFullValue","SendUserResult","CopyUserResult","ReadProjectKey","UserKeyIsAutorized","UserKeyIsAutorized","SearchWords","SearchWords","FindNextWord","FindPrevWord","AnalyseWord","InitAnalyzer","MorphDivide","SetMorphDivide","WordDivide","AnimationState_GetTimePosition","AnimationState_SetTimePosition","AnimationState_GetLength","AnimationState_SetLength","AnimationState_GetWeight","AnimationState_SetWeight","AnimationState_AddTime","AnimationState_GetEnabled","AnimationState_SetEnabled","AnimationState_SetLoop","AnimationState_GetLoop","Bone_SetManuallyControlled","Bone_GetManuallyControlled","Bone_Reset","Camera_Create","Camera_Destroy","Camera_SetFOV","Camera_GetFOV","Camera_SetAspectRatio","Camera_GetAspectRatio","Camera_SetNearClipDistance","Camera_GetNearClipDistance","Camera_SetFarClipDistance","Camera_GetFarClipDistance","Camera_SetProjectionType","Camera_GetProjectionType","Camera_SetPolygonMode","Camera_GetPolygonMode","Camera_SetFrustumOffset","Camera_SetFocalLength","Collision_RayCast","Collision_Sort","Collision_GetResultCount","Collision_GetDistance","Collision_GetObject","Entity_Create","Entity_Destroy","Entity_SetMaterial","Entity_GetAnimationState","Entity_GetBone","Light_Create","Light_Destroy","Light_SetAttenuation","Light_SetSpotlightRange","Light_SetDiffuseColour","Light_SetSpecularColour","Light_SetType","Light_SetPowerScale","Light_GetPowerScale","ManualObject_Create","ManualObject_Destroy","ManualObject_Clear","ManualObject_EstimateVertexCount","ManualObject_EstimateIndexCount","ManualObject_SetDynamic","ManualObject_GetDynamic","ManualObject_Begin","ManualObject_End","ManualObject_Position","ManualObject_Normal","ManualObject_Colour","ManualObject_TextureCoord","ManualObject_Index","ManualObject_ConvertToMesh","Material_Create","Material_Get","Material_GetBestTechnique","Material_GetTechniqueByName","Material_GetTechniqueByIndex","Movable_SetParent","Movable_GetParent","Movable_SetCastShadows","Movable_GetCastShadows","Movable_SetVisible","Movable_GetVisible","Node_SetPosition","Node_SetRotationEulerXYZ","Node_SetRotationEulerXZY","Node_SetRotationEulerYXZ","Node_SetRotationEulerYZX","Node_SetRotationEulerZXY","Node_SetRotationEulerZYX","Node_SetRotationAxis","Node_SetRotationQuaternion","Node_SetScale","Node_SetParent","Node_GetParent","Node_AddChild","Node_RemoveChild","Overlay_Get","Overlay_SetVisible","Overlay_GetVisible","OverlayElement_Get","OverlayElement_SetVisible","OverlayElement_GetVisible","OverlayElement_SetPosition","OverlayElement_SetSize","OverlayElement_SetColour","OverlayElement_SetCaption","OverlayElement_SetMaterialName","ParticleSystem_Create","ParticleSystem_Destroy","Pass_Create","Pass_SetAmbient","Pass_SetDiffuse","Pass_SetSpecular","Pass_SetShininess","Pass_SetSelfIllumination","Pass_SetSceneBlending","Pass_SetDepthCheckEnabled","Pass_SetDepthWriteEnabled","Pass_SetDepthFunction","Pass_SetColourWriteEnabled","Pass_SetCullingMode","Pass_SetLightingEnabled","Pass_SetShadingMode","Pass_SetPolygonMode","Pass_SetAlphaRejectSettings","Pass_GetTextureUnitStateByName","Pass_GetTextureUnitStateByIndex","RenderTexture_Create","RenderTexture_Destroy","RenderWindow_Create","RenderWindow_GetPrimary","RenderWindow_Destroy","RenderWindow_SetPosition","RenderWindow_SetSize","Root_Create","Root_Destroy","Root_Initialise","Root_IsInitialised","Root_RestoreConfig","Root_SaveConfig","Root_ShowConfigDialog","Root_RenderOneFrame","Root_AddResourceLocationFromConfigFile","Root_AddResourceLocation","Root_InitialiseAllResourceGroups","Root_GetTime","Scene_Create","Scene_Destroy","Scene_SetWorldGeometry","Scene_GetRootSceneNode","Scene_SetShadowTechnique","Scene_GetShadowTechnique","Scene_SetFog","Scene_SetAmbientLight","Scene_SetSkyBox","Scene_GetCamera","Scene_GetEntity","Scene_GetLight","Scene_GetParticleSystem","Scene_GetSceneNode","Scene_Clear","Scene_Load","SceneNode_Create","SceneNode_Destroy","SceneNode_SetAutoTracking","SceneNode_AttachObject","SceneNode_DetachObject","Technique_Create","Technique_GetPassByName","Technique_GetPassByIndex","TextureUnitState_Create","TextureUnitState_SetTexture","TextureUnitState_GetTexture","Viewport_Create","Viewport_Destroy","Viewport_SetCamera","Viewport_GetCamera","Viewport_SetBackgroundColour","Viewport_SetDimensions","Viewport_SetOverlaysEnabled","Viewport_GetOverlaysEnabled","Viewport_GetRay","RenderWindow_CreateEx","RenderWindow_ToggleFullscreen","BillboardSet_Create","BillboardSet_Destroy","BillboardSet_CreateBillboard","BillboardSet_GetNumBillboards","BillboardSet_GetBillboard","BillboardSet_RemoveBillboard","BillboardSet_SetBillboardType","BillboardSet_GetBillboardType","BillboardSet_SetCommonDirection","BillboardSet_GetCommonDirection","BillboardSet_SetCommonUpVector","BillboardSet_GetCommonUpVector","BillboardSet_SetDefaultDimensions","BillboardSet_GetDefaultDimensions","BillboardSet_SetMaterialName","BillboardSet_GetMaterialName","Billboard_SetRotation","Billboard_GetRotation","Billboard_SetPosition","Billboard_GetPosition","Billboard_SetColour","Billboard_GetColour","","","SetControlFont2d","SetControlTextColor2d","GetControlTextLength2d","GetControlText2d","AddControlText2d","AddControlText2d","SetWindowOwner","SetWindowParent","GetProjectClasses","GetClassFile","AddText2d","RemoveText2d","AddText2d","LBGetSelIndexs","SetStringBufferMode","SetModelText","SendSMS","SendMail","SetControlFocus2d","DbSQL","SetObjectAlpha2d","GetObjectAlpha2d","SetBrushPoints2d","SetBrushColors2d","SetDibPixel2d","EncryptStream","SendData","DecryptStream","roundt","SetSpaceRenderEngine2d","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","Viewport_AddCompositor","Viewport_RemoveCompositor","Viewport_GetNumCompositors","Viewport_GetCompositor","Compositor_SetEnabled","Compositor_GetEnabled","Node_GetName","Node_GetPosition","Node_GetScale","Node_GetRotationQuaternion","Node_GetNumChildren","Node_GetChild","Movable_GetName","Movable_GetBoundingBox","SceneNode_GetNumObjects","SceneNode_GetObject","SceneNode_SetVisible","SceneNode_GetScene","ParticleSystem_CreateEx","Material_GetName","MovableText_Create","MovableText_Destroy","MovableText_SetFontName","MovableText_GetFontName","MovableText_SetCaption","MovableText_GetCaption","MovableText_SetColor","MovableText_GetColor","MovableText_SetCharacterHeight","MovableText_GetCharacterHeight","MovableText_SetSpaceWidth","MovableText_GetSpaceWidth","MovableText_SetTextAlignment","MovableText_GetTextAlignment","MovableText_SetGlobalTranslation","MovableText_GetGlobalTranslation","MovableText_SetLocalTranslation","MovableText_GetLocalTranslation","Overlay_Create","Overlay_GetName","Overlay_FindElementAt","Overlay_SetZOrder","Overlay_GetZOrder","Overlay_SetScale","Overlay_GetScale","Overlay_SetScroll","Overlay_GetScroll","Overlay_SetRotate","Overlay_GetRotate","Overlay_AddChild","Overlay_RemoveChild","OverlayContainer_AddChild","OverlayContainer_RemoveChild","OverlayContainer_GetChild","OverlayContainer_GetChildCount","OverlayElement_Create","OverlayElement_GetPosition","OverlayElement_GetSize","OverlayElement_GetColour","OverlayElement_GetCaption","OverlayElement_GetMaterialName","OverlayElement_SetMetricsMode","OverlayElement_GetMetricsMode","OverlayElement_SetAlignment","OverlayElement_GetAlignment","OverlayElement_IsContainer","OverlayElement_GetParent","Entity_GetMaterial","Entity_GetSubEntityCount","Pass_GetAmbient","Pass_GetDiffuse","Pass_GetSpecular","Pass_GetShininess","Pass_GetSelfIllumination","Pass_GetSceneBlending","Pass_GetDepthCheckEnabled","Pass_GetDepthWriteEnabled","Pass_GetDepthFunction","Pass_GetColourWriteEnabled","Pass_GetCullingMode","Pass_GetLightingEnabled","Pass_GetShadingMode","Pass_GetPolygonMode","Pass_GetAlphaRejectSettings","Node_GetDerivedPosition","Node_GetDerivedScale","Node_GetDerivedRotationQuaternion","StringInterface_SetParameter","StringInterface_GetParameter","StringInterface_GetParameterCount","StringInterface_GetParameterType","StringInterface_GetParameterName","StringInterface_GetParameterDescription","Entity_GetVertexCount","Entity_GetIndexCount","RenderWindow_GetCursorPosition","RenderWindow_GetCursorHovered","RenderWindow_GetMouseButtonPressed","RenderWindow_GetKeyboardButtonPressed","RenderWindow_GetViewportCount","RenderWindow_GetViewport","RenderWindow_GetCount","RenderWindow_Get","RenderWindow_GetWheelPosition","RenderWindow_Create2","ParticleSystem_SetVisible","ParticleSystem_GetVisible","ParticleSystem_SetParent","ParticleSystem_GetParent","ParticleSystem_GetName","Viewport_GetBackgroundColour","Viewport_GetDimensions","RenderWindow_GetPosition","RenderWindow_GetSize","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","NUI_Init","NUI_GetDeviceCount","NUI_CreateInstance","NUI_DestroyInstance","NUI_GetDeviceName","NUI_InitInstance","NUI_GetSkeletonPositions"];function Yr(e,{code:t,numberOperands:r,stringOperands:i,otherOperands:n}){let o,s,a=0;e.nextOpPointer=0,e.lastOpPointer=t.length-1;try{for(;((o=t[s=e.nextOpPointer++])&Ee)!==0;){if(++a>1e4){e.setError("\u0421\u0440\u0430\u0431\u043E\u0442\u0430\u043B\u0430 \u0437\u0430\u0449\u0438\u0442\u0430 \u043E\u0442 \u0431\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u043E\u0433\u043E \u0446\u0438\u043A\u043B\u0430.");return}const l=ke[o&Ee];o<Pe?l(e):o<wt?l(e,r[s]):o<Et?l(e,i[s]):l(e,n[s])}}catch(l){console.error(l),ke[o&Ee]||console.warn("\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.");const c=`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438: ${ot[o&Ee]} (${v[o&Ee]}).
\u0418\u043C\u0438\u0434\u0436: ${e.currentClass.protoName}. \u0418\u043D\u0434\u0435\u043A\u0441 \u043E\u043F\u043A\u043E\u0434\u0430: ${e.nextOpPointer-1}.
`;console.warn(c),zr(e.currentClass.proto.code,e.currentClass.proto.vars.names),e.setError("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0438\u0440\u0442\u0443\u0430\u043B\u044C\u043D\u043E\u0439 \u043C\u0430\u0448\u0438\u043D\u044B")}}class qr{constructor(e){this.defaultDoubleValues=new Float64Array(0);this.oldDoubleValues=new Float64Array(0);this.newDoubleValues=new Float64Array(0);this.defaultLongValues=new Int32Array(0);this.oldLongValues=new Int32Array(0);this.newLongValues=new Int32Array(0);this.defaultStringValues=new Array;this.oldStringValues=new Array;this.newStringValues=new Array;e&&this.createBuffers(e)}createBuffers({floatsCount:e,longsCount:t,stringsCount:r}){return this.defaultDoubleValues=new Float64Array(e),this.oldDoubleValues=new Float64Array(e),this.newDoubleValues=new Float64Array(e),this.defaultLongValues=new Int32Array(t),this.oldLongValues=new Int32Array(t),this.newLongValues=new Int32Array(t),this.defaultStringValues=new Array(r).fill(""),this.oldStringValues=new Array(r).fill(""),this.newStringValues=new Array(r).fill(""),this}init(){this.newDoubleValues.set(this.defaultDoubleValues),this.newLongValues.set(this.defaultLongValues);for(let e=0;e<this.defaultStringValues.length;e++)this.newStringValues[e]=this.defaultStringValues[e];return this.sync()}sync(){this.oldDoubleValues.set(this.newDoubleValues),this.oldLongValues.set(this.newLongValues);for(let e=0;e<this.newStringValues.length;e++)this.oldStringValues[e]=this.newStringValues[e];return this}assertZeroIndexEmpty(){if(this.oldDoubleValues[0]!==0||this.newDoubleValues[0]!==0||this.oldLongValues[0]!==0||this.newLongValues[0]!==0||this.oldStringValues[0]!==""||this.newStringValues[0]!=="")throw new we("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}getOldValues(e){switch(e){case ae.Float:return this.oldDoubleValues;case ae.Handle:case ae.ColorRef:return this.oldLongValues;case ae.String:return this.oldStringValues}}getNewValues(e){switch(e){case ae.Float:return this.newDoubleValues;case ae.Handle:case ae.ColorRef:return this.newLongValues;case ae.String:return this.newStringValues}}getDefaultValues(e){switch(e){case ae.Float:return this.defaultDoubleValues;case ae.Handle:case ae.ColorRef:return this.defaultLongValues;case ae.String:return this.defaultStringValues}}}class Yt{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,t){if(e.type!==t.type)return!1;if(e.indexWasSet||t.indexWasSet)throw new we("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(t),t.connectedNodes.add(e),!0}shareIndex(e){if(this.indexWasSet)return;this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(t=>t.shareIndex(e))}getIndex(e){if(!this.indexWasSet)switch(this.type){case ae.Float:this.shareIndex(e.floatsCount++);break;case ae.Handle:case ae.ColorRef:this.shareIndex(e.longsCount++);break;case ae.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}}const Tc=()=>!1;class qt{constructor({proto:e,placement:t}){this.captureEventsFromSpace=0;this.isDisabled=Tc;this._canReceiveEvents=!1;this.variablesCreated=!1;this.proto=e,this.protoName=e.name,this.protoNameLowCase=e.name.toLowerCase(),this.placement=t,this.varGraphNodes=e.vars?e.vars.typeCodes.map(n=>new Yt(n)):[];let r=this;for(;r.placement&&r.placement.parent!==r;)r=r.placement.parent;this.root=r,this.neighbourMap=new Map([["",this],["\\",this.root]]);const i=t&&t.parent;i&&this.neighbourMap.set("..",i)}setChildren(e){if(this.children)throw new we("\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");this.children=e,e.forEach(t=>{const r=t.placement&&t.placement.name;r&&this.neighbourMap.set(r.toLowerCase(),t)})}getChild(e){return this.children&&this.children.find(t=>t.placement.handle===e)}static connectVar(e,t,r,i){return Yt.connect(e.varGraphNodes[t],r.varGraphNodes[i])}createVarsRecursive(e,t){if(this.variablesCreated=!0,this.children&&this.children.forEach(s=>s.createVarsRecursive(e,t)),!this.proto.vars)return;const r={nameToIdMap:this.proto.vars.varNameToId,typeCodes:this.proto.vars.typeCodes,names:this.proto.vars.names,globalIds:new Uint16Array(this.varGraphNodes.map(s=>s.getIndex(e))),mmanager:t},i=r.nameToIdMap.get("_enable"),n=r.nameToIdMap.get("_disable"),o=r.nameToIdMap.get("msg");if(i!==void 0&&r.typeCodes[i]===ae.Float&&(n===void 0||r.typeCodes[n]!==ae.Float||i<n)){const s=r.globalIds[i];this.isDisabled=()=>t.newDoubleValues[s]<1}if(n!==void 0&&r.typeCodes[n]===ae.Float&&(i===void 0||r.typeCodes[i]!==ae.Float||n<i)){const s=r.globalIds[n];this.isDisabled=()=>t.newDoubleValues[s]>0}this._canReceiveEvents=o!==void 0&&r.typeCodes[o]===ae.Float,this.vars=r}applyDefaultValuesRecursive(){if(this.children&&this.children.forEach(t=>t.applyDefaultValuesRecursive()),!this.proto.vars||!this.vars)return;const e=this.vars.globalIds.length;for(let t=0;t<e;t++){const r=this.proto.vars.defaultValues[t],i=this.vars.typeCodes[t],n=this.vars.names[t].toLowerCase();let o;r!==void 0?o=r:i===ae.Float?n==="orgx"?o=this.placement&&this.placement.position.x:n==="orgy"&&(o=this.placement&&this.placement.position.y):i===ae.String?n==="_objname"?o=this.placement&&this.placement.name:n==="_classname"&&(o=this.proto.name):i===ae.Handle&&n==="_hobject"&&(o=this.placement&&this.placement.handle),o!==void 0&&(this.vars.mmanager.getDefaultValues(this.vars.typeCodes[t])[this.vars.globalIds[t]]=o)}}createMemoryManager(){if(this.vars&&this.vars.mmanager)return this.vars.mmanager;const e={floatsCount:1,longsCount:1,stringsCount:1},t=new qr;return this.createVarsRecursive(e,t),t.createBuffers(e),this.applyDefaultValuesRecursive(),t}applyVarSet(e){if(!this.variablesCreated)throw new we("\u041F\u0430\u043C\u044F\u0442\u044C \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u0430 (\u0441\u043F\u0435\u0440\u0432\u0430 \u0432\u044B\u0437\u043E\u0432\u0438 createMemoryManager)");if(this.vars&&this.protoNameLowCase===e.classname.toLowerCase())for(const{name:t,value:r}of e.values){const i=this.vars.nameToIdMap.get(t.toLowerCase());if(i===void 0)continue;const n=this.vars.typeCodes[i],o=this.vars.globalIds[i];this.vars.mmanager.getDefaultValues(n)[o]=_t(n,r)}if(this.children)for(const t of e.childSets){const r=this.children.find(i=>i.placement&&i.placement.handle===t.handle);r&&r.applyVarSet(t)}}getClassByPath(e){if(e==="")return this;const t=e.split("\\");let r=e[0]==="\\"?this.root:this;for(let i=0;i<t.length;i++){const n=r.neighbourMap.get(t[i]);if(n===void 0)return;r=n}return r}getAllChildren(){const e=(r,i)=>{r.children&&r.children.forEach(n=>e(n,i)),i.push(r)},t=new Array;return e(this,t),t}startCaptureEvents(e){this.captureEventsFromSpace=e}get canReceiveEvents(){return this._canReceiveEvents}stopCaptureEvents(){this.captureEventsFromSpace=0}isCapturingEvents(e){return this.captureEventsFromSpace===e}toCompactString(){return`${this.placement?"#"+this.placement.handle+" ":""}${this.proto.name}`}compute(e,t=!1){if(e.hasError===!0||t===!1&&this.isDisabled()===!0)return;const r=this.children;if(r!==void 0)for(let s=0;s<r.length;s++)r[s].compute(e);const i=this.proto.code;if(i===void 0)return;const n=e.nextOpPointer,o=e.currentClass;e.pushClass(this),Yr(e,i),e.popClass(o),e.nextOpPointer=n}}function _c(e,t){const r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${e.protoName}: ${i}`);for(const{handle1:i,handle2:n,connectedVars:o}of t){const s=i===0?e:e.getChild(i),a=n===0?e:e.getChild(n);if(s?s.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),a?a.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),!s||!s.proto.vars||!a||!a.proto.vars)continue;const l=s.proto.vars,c=a.proto.vars,h=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${s.protoName} #${i}`,u=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${a.protoName} #${n}`;for(const{name1:f,name2:p}of o){const m=l.varNameToId.get(f.toLowerCase()),g=c.varNameToId.get(p.toLowerCase());if(m===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${f} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${h}`),g===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${p} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${u}`),m===void 0||g===void 0)continue;if(!qt.connectVar(s,m,a,g)){const S=ae[s.proto.vars.typeCodes[m]],C=ae[a.proto.vars.typeCodes[g]];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${f} (${S}) \u0432 ${h} \u0438 ${p} (${C}) \u0432 ${u}`)}}}}function Kr(e,t,r){const i=t.get(e.toUpperCase());if(!i)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${e}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const n=new qt({proto:i,placement:r});if(i.children){const o=i.children.map(s=>Kr(s.classname,t,ee({parent:n},s.schemeInfo)));n.setChildren(o)}return i.links&&_c(n,i.links),n}function Jr(e,t){return Kr(e,t)}class $r{constructor({tree:e}){this.classNodeCache=new Map;this.tree=e,this.classNodes=this.tree.getAllChildren()}getClassesByProtoName(e){const t=e.toLowerCase(),r=this.classNodeCache.get(t);if(r!==void 0)return r;const i=this.classNodes.filter(n=>n.protoNameLowCase===t);return this.classNodeCache.set(e,i),i}}class Zr{constructor({windows:e,projectManager:t,classManager:r,memoryManager:i}){this.floatStack=new Float64Array(2e3);this.floatStackPointer=-1;this.intStack=new Int32Array(2e3);this.intStackPointer=-1;this.stringStack=new Array(2e3);this.stringStackPointer=-1;this.ctxDepth=0;this._error="";this.nextOpPointer=0;this.lastOpPointer=0;this.hasError=!1;this.executionStopped=!1;this.windows=e,this.project=t,this.classManager=r,this.memoryManager=i}get canExecuteClass(){return this.ctxDepth<60}pushClass(e){this.currentClass=e,this.classVars=e.vars,++this.ctxDepth}popClass(e){--this.ctxDepth===0?(this.floatStackPointer=-1,this.intStackPointer=-1,this.stringStackPointer=-1):(this.currentClass=e,this.classVars=e.vars)}get error(){return this._error}setError(e){this._error=e,this.hasError=!0,this.executionStopped=!0,this.pausedOpPointer=this.nextOpPointer,this.pausedClass=this.currentClass,this.nextOpPointer=this.lastOpPointer}addErrorInfo(e){this._error+=e}pushDouble(e){this.floatStack[++this.floatStackPointer]=e}popDouble(){if(this.floatStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.floatStack[this.floatStackPointer--]}pushLong(e){this.intStack[++this.intStackPointer]=e}popLong(){if(this.intStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.intStack[this.intStackPointer--]}pushString(e){this.stringStack[++this.stringStackPointer]=e}popString(){if(this.stringStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.stringStack[this.stringStackPointer--]}}function wc(e){try{e()}catch(t){if(typeof t=="string")return!0}return!1}function Ec({code:e},t){const r=new Set;for(let i=0;i<e.length;i++){const n=e[i]&Ee;if(n===0)continue;if(!v[n]&&(n>=900&&n<=1100||n>=1200&&n<=1500))return{error:!0,message:"\u0444\u0443\u043D\u043A\u0446\u0438\u0438 3D \u0434\u0432\u0438\u0436\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B"};if(!v[n])return{error:!0,message:`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u043A\u043E\u0434: ${n}`};(!t[n]||wc(t[n]))&&r.add(n)}return r.size>0?{error:!0,ops:r}:{error:!1}}function Qr(e){return`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438 (\u0432\u0441\u0435\u0433\u043E ${e.length})
`+e.map(({name:t,classNames:r})=>`${t} \u0432 ${r}`).join(`;
`)}function xc(e){const t=new Map,r=[];for(const[n,o]of e){if(!o.code)continue;const s=Ec(o.code,ke);if(!s.error)continue;if(!s.ops)r.push(`${n} : ${s.message}`);else for(const a of s.ops){const l=t.get(a);l?l.add(n):t.set(a,new Set([n]))}}const i=[];for(const[n,o]of t)i.push({name:(ot[n]?ot[n]:n)+` (${v[n]})`,classNames:[...o.values()]});return{missingOperations:i,errors:r}}function ei(e,t){const r=new Map;return function i(n){const o=n.toUpperCase(),s=t.get(o);if(!s)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${n}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);r.set(o,s),s.children&&s.children.forEach(a=>i(a.classname))}(e),xc(r)}class ti{constructor(){this.frameId=0;this._running=!1}_loop(e){this.frameId=requestAnimationFrame(()=>{this._loop(e),e()})}_unloop(){cancelAnimationFrame(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._loop(e),this._running=!0}stop(){if(!this._running)return;this._unloop(),this._running=!1}}class Kt{constructor(e){this._computer=new ti;this._state="closed";this.handlers={closed:new Set,error:new Set};this.fs=e.fs,this.workDir=e.workDir,this.prjInfo=e.prjInfo,this.classes=e.classes,this.stt=e.stt;const t=ei(e.prjInfo.rootClassName,e.classes);t.errors.length>0&&console.warn("\u041E\u0448\u0438\u0431\u043A\u0438:",t.errors),t.missingOperations.length>0&&console.warn(Qr(t.missingOperations)),this._diag={iterations:0,missingCommands:t.missingOperations}}get state(){return this._state}get computer(){return this._computer}get diag(){return this._diag}set computer(e){if(e==this._computer)return;this._computer.running&&(this._computer.stop(),this.loop&&e.run(this.loop)),this._computer=e}play(e){if(this.loop)return this;this.prevWs=e||this.prevWs;const{classes:t,prjInfo:r,stt:i}=this,n=Jr(r.rootClassName,t),o=n.createMemoryManager();i&&n.applyVarSet(i);const s=new Zr({classManager:new $r({tree:n}),memoryManager:o,projectManager:this,windows:new Mr(this.prevWs)});return this._diag.iterations=0,this.loop=()=>{++this._diag.iterations,n.compute(s),s.executionStopped&&(s.hasError?this.handlers.error.forEach(a=>a(s.error)):this.handlers.closed.forEach(a=>a()),this.close(!s.hasError)),o.sync().assertZeroIndexEmpty()},o.init(),this.computer.run(this.loop),this._state="playing",this}close(e=!0){return this.computer.stop(),this.loop=void 0,e&&this.prevWs&&this.prevWs.closeAll(),this._state="closed",this}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,t){return this.handlers[e].add(t),this}off(e,t){return t?this.handlers[e].delete(t):this.handlers[e].clear(),this}get rootClassName(){return this.prjInfo.rootClassName}getClassScheme(e){const t=this.classes.get(e.toUpperCase());if(!t||!t.scheme)return;const{children:r,scheme:i}=t;return r?Tr(i,r,this.classes):i}hasClass(e){return this.classes.has(e.toUpperCase())?1:0}getClassDirectory(e){const t=this.classes.get(e.toUpperCase());return t&&t.directoryDos||""}openFileStream(e){const t=this.fs.resolveFile(e,this.workDir);return t&&!t.dir?t.streamSync():void 0}openVdrFile(e){const t=this.openFileStream(e);return t&&vt(t,{origin:"file",name:t.meta.filepathDos||""})}openSttFile(e){const t=this.openFileStream(e);return t&&mt(t)}isFileExist(e){return this.fs.resolveFile(e)?1:0}}function Cc(e){const t=e.uint16()*2,r=e.position,i=e.nulltString(t);e.seek(r+t);const n=e.uint16(),o=new Array(n);for(let a=n-1;a>=0;a--){const l=e.int16();if(l>0)throw new Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${i}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u0430 ${a}.`);o[a]=l}const s=e.int16();if(s>0)throw new Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${i}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043C\u044B\u0439 \u0442\u0438\u043F.`);return{funcName:i,argCount:n,argTypes:o,returnType:s}}function Dc(e){const t=e.uint16()*2,r=e.position,i=e.nulltString(t);return e.seek(r+t),i}function Oc(e,t){switch(t){case"double":return{type:t,value:e.float64()};case"varId":case"codepoint":case"argCount":return{type:t,value:e.uint16()};case"long":return{type:t,value:e.int32()};case"string":return{type:t,value:e.vmString()};case"funcSignature":return{type:t,value:Cc(e)};case"dllFuncSignature":return{type:t,value:Dc(e)};default:throw new Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043E\u043F\u0435\u0440\u0430\u043D\u0434\u0430: ${t}`)}}function Rc(e,t){const r=new Array,i=new Array,n=new Array,o=e.position,s=o+t;for(;e.position<s;){const a=e.position-o,l=e.uint16(),c=Je[l],h=c&&Oc(e,c);r.push(a),i.push(l),n.push(h)}return{codepoints:r,opcodes:i,operands:n}}function jc(e,t){for(let r=0;r<e.length;r++){const i=t[r];if(i===void 0||i.type!=="codepoint")continue;const n=i.value*2,o=e.indexOf(n);if(o===-1)return!1;i.value=o}return!0}function Ac(e,t){const r=new Uint16Array(e),i=new Float64Array(r.length),n=new Array(r.length),o=new Array(r.length);for(let s=0;s<r.length;s++){const a=t[s];if(a===void 0)continue;switch(a.type){case"varId":r[s]|=4096,i[s]=a.value,r[s]|=Pe;break;case"argCount":case"codepoint":case"long":case"double":i[s]=a.value,r[s]|=Pe;break;case"string":n[s]=a.value,r[s]|=wt;break;case"funcSignature":o[s]=a.value,r[s]|=Et;break}}return{code:r,numberOperands:i,stringOperands:n,otherOperands:o}}function ri(e){const t=new me(e),{codepoints:r,opcodes:i,operands:n}=Rc(t,e.byteLength);if(!jc(r,n))throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u0438\u0438 \u0442\u043E\u0447\u0435\u043A \u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430.");const{code:o,numberOperands:s,stringOperands:a,otherOperands:l}=Ac(i,n);if(o.length===0)throw new Error("\u041D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043E\u043F\u043A\u043E\u0434\u0430.");if(o[o.length-1]!==0)throw new Error("\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u043E\u043F\u043A\u043E\u0434 - \u043D\u0435 0.");return{code:o,numberOperands:s,stringOperands:a,otherOperands:l}}class ii{constructor(e){this.src=e}open(){return Se(this,null,function*(){return this.src instanceof ArrayBuffer||(this.src=yield this.src.async("arraybuffer")),this.src})}openSync(){return this.src instanceof ArrayBuffer?this.src:void 0}}class Jt{constructor(){this.disks=new Map}static fromZip(r){return Se(this,arguments,function*(e,t={}){const i=new TextDecoder(t.encoding||"cp866");let n;try{n=yield ni.loadAsync(e,{decodeFileName:c=>i.decode(c),createFolders:!1})}catch(c){const h=e instanceof File?`\u0424\u0430\u0439\u043B ${e.name}`:e instanceof Blob?`Blob { size: ${e.size}, type: ${e.type} }`:`ArrayBuffer(${e.byteLength})`;throw Error(`${h} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F ZIP-\u0430\u0440\u0445\u0438\u0432\u043E\u043C`)}const[o,s]=Mt(t.directory||"","Z");let a=new qe(o+":");const l=new Jt;l.diskNew(o,a);for(const c of s)a=a.folderNew(c);return n.forEach((c,h)=>{const u=c.split(pt);let f=a;for(let p=0;p<u.length-1;p++)f=f.folder(u[p]);h.dir||f.fileNew(u[u.length-1],new ii(h))}),l})}diskNew(e,t){const{disks:r}=this,i=r.size;if(this.disks.set(e,t),r.size===i)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0434\u0438\u0441\u043A\u043E\u0432: ${e}`)}merge({disks:e}){const{disks:t}=this;for(const[r,i]of e){const n=t.get(r);n?n.merge(i):t.set(r,i)}return this}*search(e){for(const t of this.disks.values())for(const r of t.search(e))yield r}resolveFile(e,t){const r=Nt(e),i=r[0].length===2&&r[0][1]===":";let n=i?this.disks.get(r[0][0].toUpperCase()):t;if(!n)return;for(let s=i?1:0;s<r.length-1;s++)if(r[s]==="..")n=n.parent;else{const a=n.folderGet(r[s]);if(!a)return;n=a}const o=r[r.length-1];return o===".."?n.parent:n.get(o)}project(){return Se(this,arguments,function*(e={}){let t,r;{let s;const a=new Array,l=e.tailPath?new RegExp(Nt(e.tailPath).join("\\\\")+"$","i"):/.+\.(prj)|(spj)$/i;for(const c of this.search(l))if(s=c,a.push(c.pathDos),e.firstMatch)break;if(!s)throw Error("\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432");if(a.length>1)throw Error(`\u041D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043F\u043E\u0434\u0445\u043E\u0434\u044F\u0449\u0438\u0445 \u0444\u0430\u0439\u043B\u043E\u0432:
${a.join(`
`)}`);t=s.parent,r=yield s.readAs("prj")}const i=new Set([t]);{const s=r.settings&&r.settings.classSearchPaths;if(s&&s.split(",").map(a=>a.trim()).filter(a=>a).forEach(a=>{const l=this.resolveFile(a,t);l&&l.dir&&i.add(l)}),e.additionalClassPaths)for(const a of e.additionalClassPaths){const[l,c]=Mt(a,"Z");let h=this.disks.get(l);for(let u=0;u<c.length&&h;u++)h=h.folderGet(c[u]);h&&i.add(h)}}const n=new Map;{const s=[...i.values()].map(c=>[...c.search(/.+\.cls$/i)]),a=new Array().concat(...s),l=yield Promise.all(a.map(c=>c.readAs("cls",ri)));for(const c of l){const h=c.name.toUpperCase(),u=n.size;if(n.set(h,c),n.size===u){const f=l.filter(p=>p.name.toUpperCase()===h).map(p=>p.filepathDos);throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: "${c.name}" \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445:
${f.join(`;
`)}.`)}}}let o;{const s=t.fileGet("_preload.stt");if(s)try{o=yield s.readAs("stt")}catch(a){console.warn(a.message)}}return new Kt({fs:this,workDir:t,prjInfo:r,classes:n,stt:o})})}}class qe{constructor(e,t){this.name=e;this.nodes=new Map;this.dir=!0;this.pathDos=t?t.pathDos+"\\"+e:e,this.parent=t||this}insert(e,t){const{nodes:r}=this,i=r.size;if(r.set(e.toUpperCase(),t),r.size===i)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${t.pathDos}`)}get(e){return this.nodes.get(e.toUpperCase())}fileGet(e){const t=this.get(e);return t&&!t.dir?t:void 0}fileNew(e,t){const r=new xt(e,t,this);return this.insert(e,r),r}folderNew(e){const t=new qe(e,this);return this.insert(e,t),t}folderGet(e){const t=this.get(e);return t&&t.dir?t:void 0}folder(e){const{nodes:t}=this,r=e.toUpperCase(),i=t.get(r);if(i){if(!i.dir)throw Error(`\u0424\u0430\u0439\u043B ${i.pathDos} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);return i}const n=new qe(e,this);return t.set(r,n),n}merge({nodes:e}){const{nodes:t}=this;for(const[r,i]of e){let n=t.get(r);if(n&&!n.dir)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${n.pathDos}`);if(i.dir){n||(n=new qe(i.name,this),t.set(r,n)),n.merge(i);continue}if(n)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${n.pathDos}`);t.set(r,i.makeCopyAt(this))}}*files(){for(const e of this.nodes.values()){if(!e.dir){yield e;continue}for(const t of e.files())yield t}}*search(e){for(const t of this.files())e.test(t.pathDos)&&(yield t)}}function Ic(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.string(),o=e.string(),s=e.string(),a=e.string();if(a!=="FLOAT"&&a!=="HANDLE"&&a!=="STRING"&&a!=="COLORREF")throw new ye(e,`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${a}.`);const l=e.int32();r[i]={name:n,description:o,defaultValue:s,type:a,flags:l}}return r}function Lc(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.uint16(),o=e.uint16(),s=e.uint16(),a=e.int32(),l=e.uint16(),c=e.uint16(),h=new Array(l);for(let u=0;u<l;u++){const f=e.string(),p=e.string();h[u]={name1:f,name2:p}}r[i]={handle1:n,handle2:o,linkHandle:s,flags:a,connectedVars:h,contactPadHandle:c}}return r}function Nc(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.string(),o=e.uint16(),s=e.string();if(!e.meta.fileversion)throw Error("filversion?");const a=e.meta.fileversion<12290?e.point2dInt():e.point2d(),l=e.byte();r[i]={classname:n,schemeInfo:{handle:o,name:s,position:a},flags:l}}return r}function ai(e,t,r,i){const n=e.position,o=e.int32();if(!i){e.seek(n+o);return}const s=e.int32();if(s&se.SF_EXTERNAL){const h=e.string();throw new ye(e,`\u0427\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F;
\u0424\u0430\u0439\u043B VDR: ${h}.`)}const a=e.int32(),l=e.fork(a);e.skip(a);let c;try{c=vt(l,{origin:"class",name:t})}catch(h){console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F VDR ${t} (${r})`,h),e.seek(n+o);return}if(l.position!==a){const h=l.position,u=a-h,f=`${r}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${h} \u0431\u0430\u0439\u0442, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${u}. v0x${l.meta.fileversion&&l.meta.fileversion.toString(16)}.`;console.warn(e.meta.filepathDos+`:
`+f)}return c}function oi(e){const t=e.uint16();if(t!==16979)throw new Oe(e,t,16979);const r=e.int32();e.int32(),e.int32();const i=e.string();return{name:i,version:r}}function si(e,t,r){const i={};let n=e.uint16();if(n===se.CR_VARS1&&(i.vars=Ic(e),n=e.uint16()),n===se.CR_LINKS&&(i.links=Lc(e),n=e.uint16()),(n===se.CR_CHILDSnameXY||n===se.CR_CHILDSname||n===se.CR_CHILDS)&&(i.children=Nc(e),n=e.uint16()),n===se.CR_ICON){const o=e.int32();e.skip(o-4),n=e.uint16()}if(n===se.CR_SCHEME&&(i.scheme=ai(e,t,"\u0421\u0445\u0435\u043C\u0430",r.readScheme),n=e.uint16()),n===se.CR_IMAGE&&(i.image=ai(e,t,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435",r.readImage),n=e.uint16()),n===se.CR_TEXT&&(i.sourceCode=e.string(),n=e.uint16()),n===se.CR_INFO&&(i.description=e.string(),n=e.uint16()),n===se.CR_VARSIZE&&(i.varsize=e.uint16(),n=e.uint16()),n===se.CR_FLAGS&&(i.flags=e.int32(),n=e.uint16()),n===se.CR_DEFICON&&(i.iconIndex=e.uint16(),n=e.uint16()),n===se.CR_ICONFILE&&(i.iconFile=e.string(),n=e.uint16()),n===se.CR_CODE){const o=e.int32()*2;if(r.parseBytecode!==void 0)try{i.code=r.parseBytecode(e.bytes(o))}catch(s){throw new ye(e,s.message+" (\u0431\u0430\u0439\u0442\u043A\u043E\u0434)")}else e.skip(o);n=e.uint16()}if(n===se.CR_EQU)return console.warn(e.meta.filepathDos+`:
\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F.`),i;if(n!==se.CR_CLASSTIME&&e.meta.fileversion===12291)throw new ye(e,"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0445\u043E\u0434\u0435 \u0447\u0442\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u043C\u0438\u0434\u0436\u0430.");return i}function Mc(e){const t=e.map(r=>Pr(r.type));return{varNameToId:new Map(e.map((r,i)=>[r.name.toLowerCase(),i])),names:e.map(r=>r.name),typeCodes:t,defaultValues:e.map((r,i)=>r.defaultValue===""?void 0:_t(t[i],r.defaultValue))}}class ci{get body(){const{__body:e}=this;if(e.loaded)return e.body;const t=si(e.stream,this.name,this.blocks);return this.__body={loaded:!0,body:t},t}constructor(e,t={}){this.filepathDos=e instanceof me?e.meta.filepathDos:t.filepathDos,this.directoryDos=mr(this.filepathDos||""),this.blocks={readScheme:!0,readImage:!0,parseBytecode:t.bytecodeParser};const r=e instanceof me?e:new me(e,{filepathDos:t.filepathDos});this.header=oi(r),r.meta.fileversion=this.header.version,this.__body={loaded:!1,stream:r}}get name(){return this.header.name}get children(){return this.body.children}get vars(){if(this._vars)return this._vars;const e=this.body.vars;if(!e)return;const t=Mc(e);return this._vars=t,t}get links(){return this.body.links}get image(){return this.body.image}get iconFile(){return this.body.iconFile}get scheme(){return this.body.scheme}get code(){return this.body.code}}const Pc={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone"};function kc(e){const t={},r=e.uint16();for(let i=0;i<r;i++){const n=e.uint16(),o=e.byte(),s=e.byte(),a=e.fixedString(s-1);e.byte();let l;switch(o){case 0:l=e.int32();break;case 1:l=e.float64();break;case 2:l=e.fixedString(n-s-3),e.byte();break;default:throw new ye(e,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${o}`)}const c=Pc[a];c?t[c]=l:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${a} (${l})`)}return t}function Fc(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=Array.from({length:e.uint16()},()=>e.uint16()),o=e.string(),s=e.string();r[i]={path:n,name:o,info:s}}return r}function li(e){const t=e.uint16();if(t!==26697)throw new Oe(e,t,26697);const r={rootClassName:""};let i=0;for(;(i=e.uint16())!==0;)switch(i){case se.PR_PASSWORD:e.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case se.PR_MAINCLASS:r.rootClassName=e.string();break;case se.PR_VARS:r.settings=kc(e);break;case se.PR_WATCH:r.watchedVariables=Fc(e);break}if(!r.rootClassName)throw new ye(e,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}class xt{constructor(e,t,r){this.name=e;this.dir=!1;this.src=t,this.parent=r,this.pathDos=r.pathDos+"\\"+e}get directoryDos(){return this.parent.pathDos}makeCopyAt(e){return new xt(this.name,this.src,e)}arraybuffer(){return this.src.open()}makeSync(){return Se(this,null,function*(){yield this.src.open()})}stream(){return Se(this,null,function*(){const e=yield this.arraybuffer();return new me(e,{filepathDos:this.pathDos})})}streamSync(){const e=this.src.openSync();if(!e)throw Error(`\u0421\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435 \u0444\u0430\u0439\u043B\u0430 ${this.pathDos} \u043D\u0435 \u0431\u044B\u043B\u043E \u043F\u0440\u0435\u0434\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E.`);return new me(e,{filepathDos:this.pathDos})}readAs(e,t){return Se(this,null,function*(){const r=yield this.stream();switch(e){case"prj":return li(r);case"cls":return new ci(r,{bytecodeParser:t});case"stt":return mt(r)}})}}function hi(e,t){return Jt.fromZip(e,t)}return Ht();})();
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
