(()=>{var jo=Object.create,mt=Object.defineProperty,Co=Object.getPrototypeOf,Pr=Object.prototype.hasOwnProperty,Xo=Object.getOwnPropertyNames,Yo=Object.getOwnPropertyDescriptor,Nr=Object.getOwnPropertySymbols,Go=Object.prototype.propertyIsEnumerable;var Ar=(t,e,r)=>e in t?mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,L=(t,e)=>{for(var r in e||(e={}))Pr.call(e,r)&&Ar(t,r,e[r]);if(Nr)for(var r of Nr(e))Go.call(e,r)&&Ar(t,r,e[r]);return t},zo=t=>mt(t,"__esModule",{value:!0});var Zo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ko=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Xo(e))!Pr.call(t,i)&&i!=="default"&&mt(t,i,{get:()=>e[i],enumerable:!(r=Yo(e,i))||r.enumerable});return t},Qo=t=>Ko(zo(mt(t!=null?jo(Co(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var C=(t,e,r)=>new Promise((i,n)=>{var s=c=>{try{l(r.next(c))}catch(p){n(p)}},a=c=>{try{l(r.throw(c))}catch(p){n(p)}},l=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);l((r=r.apply(t,e)).next())});var ti=Zo((su,ei)=>{ei.exports=function(){"use strict";function t(i,n){function s(){this.constructor=i}s.prototype=n.prototype,i.prototype=new s}function e(i,n,s,a){this.message=i,this.expected=n,this.found=s,this.location=a,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}t(e,Error),e.buildMessage=function(i,n){var s={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var y="",_;for(_=0;_<g.parts.length;_++)y+=g.parts[_]instanceof Array?c(g.parts[_][0])+"-"+c(g.parts[_][1]):c(g.parts[_]);return"["+(g.inverted?"^":"")+y+"]"},any:function(g){return"any character"},end:function(g){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function p(g){return s[g.type](g)}function d(g){var y=new Array(g.length),_,I;for(_=0;_<g.length;_++)y[_]=p(g[_]);if(y.sort(),y.length>0){for(_=1,I=1;_<y.length;_++)y[_-1]!==y[_]&&(y[I]=y[_],I++);y.length=I}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function S(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+d(i)+" but "+S(n)+" found."};function r(i,n){n=n!==void 0?n:{};var s={},a={Code:vr},l=vr,c=function(o){return o},p=function(o){return o.filter(u=>u)},d=V("variable name"),S=function(o){return{type:"var",name:o}},g=",",y=N(",",!1),_=function(o){return o},I=V("function call"),O="(",P=N("(",!1),M=")",j=N(")",!1),A=function(o,u){return{type:"call",name:o,args:u}},Q="-",$e=N("-",!1),tt="!",rt=N("!",!1),it=V("!<operand> or -<operand>"),v=function(o,u){return{type:o,op:u}},U=V("(<expression>)"),Ai=function(o){return{type:"subexpr",expr:o}},Mi=V("operand"),Fi="~",Li=N("~",!1),$i=function(o,u){return L(L({},u),{isNew:!!o})},Ui="^",ki=N("^",!1),Wi=function(){return"**"},Hi="*",Vi=N("*",!1),ji="/",Ci=N("/",!1),Xi="%",Yi=N("%",!1),Gi="+",zi=N("+",!1),Jt=">=",Zi=N(">=",!1),Ki=">",Qi=N(">",!1),qt="<=",Ji=N("<=",!1),qi="<",es=N("<",!1),er="==",ts=N("==",!1),tr="!=",rs=N("!=",!1),rr="&&",is=N("&&",!1),ss="&",ns=N("&",!1),ir="||",os=N("||",!1),as="|",us=N("|",!1),ls=V("expression"),sr=function(o,u,b){return{action:u,operand:b}},hs=function(o,u){return{first:o,rest:u}},nr=function(o,u){return u},cs=function(o,u){return[o].concat(u)},or=function(o,u){return u},ms=function(o,u,b){return{type:"varsDec",datatype:o,modifiers:u,names:b}},bs=V("assigment operator"),ar=":=",ps=N(":=",!1),ur="::=",ds=N("::=",!1),fs=function(o,u,b){return{type:u,to:o,expr:b}},gs=V("equality operator"),_s="=",Ts=N("=",!1),ws=function(o,u,b){return{type:u,first:o,second:b}},Ss=V("function call chain"),lr=function(o,u){return u},ys=function(o,u){return{type:"callChain",functions:[o].concat(u)}},hr=V("( <expression> )"),cr=function(o){return o},Es=V("if(<condition>)"),Is="if",Rs=N("if",!0),vs=function(o){return{type:"if",expr:o}},Ds=V("while(<condition>)"),Os="while",xs=N("while",!0),Bs=function(o){return{type:"while",expr:o}},Ps=V("until(<condition>)"),Ns="until",As=N("until",!0),Ms=function(o){return{type:"until",expr:o}},Fs=V("case(<condition>)"),Ls="case",$s=N("case",!0),Us=function(o,u){return{type:"case",expr:o,then:u}},ks="else",Ws=N("else",!0),Hs=function(o){return{type:"else",then:o}},Vs="endif",js=N("endif",!0),Cs=function(o){return{type:"endif",then:o}},Xs="break",Ys=N("break",!0),Gs=function(){return{type:"break"}},zs="endwhile",Zs=N("endwhile",!0),Ks=function(){return{type:"endwhile"}},Qs="do",Js=N("do",!0),qs=function(){return{type:"do"}},en="endswitch",tn=N("endswitch",!0),rn=function(){return{type:"endswitch"}},sn="switch",nn=N("switch",!0),on=function(){return{type:"switch"}},an="default",un=N("default",!0),ln=function(o){return{type:"default",then:o}},hn="function",cn=N("function",!0),mn=function(){return{type:"function"}},bn=V("return <var name>"),pn="return",dn=N("return",!0),fn=function(o){return{type:"return",to:o}},gn="handle",_n=N("HANDLE",!0),Tn=function(){return"HANDLE"},wn="string",Sn=N("STRING",!0),yn=function(){return"STRING"},En="float",In=N("FLOAT",!0),Rn=function(){return"FLOAT"},vn="colorref",Dn=N("COLORREF",!0),On=function(){return"COLORREF"},xn="integer",Bn=N("INTEGER",!0),Pn=function(){return"INTEGER"},Nn="local",An=N("LOCAL",!0),Mn=function(){return"LOCAL"},Fn="nosave",Ln=N("NOSAVE",!0),$n=function(){return"NOSAVE"},Un="parameter",kn=N("PARAMETER",!0),Wn=function(){return"PARAMETER"},mr=/^[_a-z\u0430-\u044F0-9]/i,br=ae(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),Hn=V("function name"),st=/^[0-9]/,nt=ae([["0","9"]],!1,!1),Vn=".",jn=N(".",!1),Cn=/^[eE]/,Xn=ae(["e","E"],!1,!1),Yn=/^[+\-]/,Gn=ae(["+","-"],!1,!1),zn=V("float"),Zn=function(o){return{type:"float",value:parseFloat(o)}},Kn=V("handle"),Qn="#",Jn=N("#",!1),qn=function(o){return{type:"handle",value:o.length>0?parseInt(o):0}},pr="'",dr=N("'",!1),fr=/^[^']/,gr=ae(["'"],!0,!1),_r='"',Tr=N('"',!1),wr=/^[^"]/,Sr=ae(['"'],!0,!1),eo=function(o){return{type:"string",value:o[1]}},to=V("space or tab"),ro=/^[ \t]/,io=ae([" ","	"],!1,!1),so=V("new line"),no=`
`,oo=N(`
`,!1),ao=V("whitespace"),yr=/^[ \t\n\r]/,Er=ae([" ","	",`
`,"\r"],!1,!1),h=0,B=0,ot=[{line:1,column:1}],q=0,Nt=[],f=0,at;if("startRule"in n){if(!(n.startRule in a))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');l=a[n.startRule]}function Pa(){return i.substring(B,h)}function Na(){return Ue(B,h)}function Aa(o,u){throw u=u!==void 0?u:Ue(B,h),Rr([V(o)],i.substring(B,h),u)}function Ma(o,u){throw u=u!==void 0?u:Ue(B,h),lo(o,u)}function N(o,u){return{type:"literal",text:o,ignoreCase:u}}function ae(o,u,b){return{type:"class",parts:o,inverted:u,ignoreCase:b}}function Fa(){return{type:"any"}}function uo(){return{type:"end"}}function V(o){return{type:"other",description:o}}function Ir(o){var u=ot[o],b;if(u)return u;for(b=o-1;!ot[b];)b--;for(u=ot[b],u={line:u.line,column:u.column};b<o;)i.charCodeAt(b)===10?(u.line++,u.column=1):u.column++,b++;return ot[o]=u,u}function Ue(o,u){var b=Ir(o),m=Ir(u);return{start:{offset:o,line:b.line,column:b.column},end:{offset:u,line:m.line,column:m.column}}}function E(o){h<q||(h>q&&(q=h,Nt=[]),Nt.push(o))}function lo(o,u){return new e(o,null,null,u)}function Rr(o,u,b){return new e(e.buildMessage(o,u),o,u,b)}function vr(){var o,u,b,m,T,w,F;for(o=h,u=[],b=h,m=[],T=x();T!==s;)m.push(T),T=x();if(m!==s)if(T=At(),T===s&&(T=null),T!==s){for(w=[],F=x();F!==s;)w.push(F),F=x();w!==s?(F=Br(),F!==s?(B=b,m=c(T),b=m):(h=b,b=s)):(h=b,b=s)}else h=b,b=s;else h=b,b=s;for(;b!==s;){for(u.push(b),b=h,m=[],T=x();T!==s;)m.push(T),T=x();if(m!==s)if(T=At(),T===s&&(T=null),T!==s){for(w=[],F=x();F!==s;)w.push(F),F=x();w!==s?(F=Br(),F!==s?(B=b,m=c(T),b=m):(h=b,b=s)):(h=b,b=s)}else h=b,b=s;else h=b,b=s}return u!==s&&(B=o,u=p(u)),o=u,o}function ho(){var o,u;return f++,o=h,u=fe(),u!==s&&(B=o,u=S(u)),o=u,f--,o===s&&(u=s,f===0&&E(d)),o}function Dr(){var o,u,b,m,T;for(o=h,u=[],b=x();b!==s;)u.push(b),b=x();if(u!==s)if(b=de(),b!==s){for(m=[],T=x();T!==s;)m.push(T),T=x();m!==s?(i.charCodeAt(h)===44?(T=g,h++):(T=s,f===0&&E(y)),T===s&&(T=null),T!==s?(B=o,u=_(b),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;return o}function ut(){var o,u,b,m,T,w,F,$;if(f++,o=h,u=$o(),u!==s){for(b=[],m=x();m!==s;)b.push(m),m=x();if(b!==s)if(i.charCodeAt(h)===40?(m=O,h++):(m=s,f===0&&E(P)),m!==s){for(T=[],w=x();w!==s;)T.push(w),w=x();if(T!==s){for(w=[],F=Dr();F!==s;)w.push(F),F=Dr();if(w!==s){for(F=[],$=x();$!==s;)F.push($),$=x();F!==s?(i.charCodeAt(h)===41?($=M,h++):($=s,f===0&&E(j)),$!==s?(B=o,u=A(u,w),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s}else h=o,o=s}else h=o,o=s;else h=o,o=s}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(I)),o}function co(){var o;return i.charCodeAt(h)===45?(o=Q,h++):(o=s,f===0&&E($e)),o===s&&(i.charCodeAt(h)===33?(o=tt,h++):(o=s,f===0&&E(rt))),o}function mo(){var o,u,b,m;if(f++,o=h,u=co(),u!==s){for(b=[],m=x();m!==s;)b.push(m),m=x();b!==s?(m=lt(),m!==s?(B=o,u=v(u,m),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(it)),o}function bo(){var o,u,b,m,T,w;if(f++,o=h,i.charCodeAt(h)===40?(u=O,h++):(u=s,f===0&&E(P)),u!==s){for(b=[],m=x();m!==s;)b.push(m),m=x();if(b!==s)if(m=de(),m!==s){for(T=[],w=x();w!==s;)T.push(w),w=x();T!==s?(i.charCodeAt(h)===41?(w=M,h++):(w=s,f===0&&E(j)),w!==s?(B=o,u=Ai(m),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(U)),o}function lt(){var o,u,b,m;if(f++,o=h,i.charCodeAt(h)===126?(u=Fi,h++):(u=s,f===0&&E(Li)),u===s&&(u=null),u!==s){for(b=[],m=x();m!==s;)b.push(m),m=x();b!==s?(m=mo(),m===s&&(m=Wo(),m===s&&(m=Ho(),m===s&&(m=Vo(),m===s&&(m=ut(),m===s&&(m=ho(),m===s&&(m=bo())))))),m!==s?(B=o,u=$i(u,m),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(Mi)),o}function Or(){var o,u;return o=h,i.charCodeAt(h)===94?(u=Ui,h++):(u=s,f===0&&E(ki)),u!==s&&(B=o,u=Wi()),o=u,o===s&&(i.charCodeAt(h)===42?(o=Hi,h++):(o=s,f===0&&E(Vi)),o===s&&(i.charCodeAt(h)===47?(o=ji,h++):(o=s,f===0&&E(Ci)),o===s&&(i.charCodeAt(h)===37?(o=Xi,h++):(o=s,f===0&&E(Yi)),o===s&&(i.charCodeAt(h)===43?(o=Gi,h++):(o=s,f===0&&E(zi)),o===s&&(i.charCodeAt(h)===45?(o=Q,h++):(o=s,f===0&&E($e)),o===s&&(i.substr(h,2)===Jt?(o=Jt,h+=2):(o=s,f===0&&E(Zi)),o===s&&(i.charCodeAt(h)===62?(o=Ki,h++):(o=s,f===0&&E(Qi)),o===s&&(i.substr(h,2)===qt?(o=qt,h+=2):(o=s,f===0&&E(Ji)),o===s&&(i.charCodeAt(h)===60?(o=qi,h++):(o=s,f===0&&E(es)),o===s&&(i.substr(h,2)===er?(o=er,h+=2):(o=s,f===0&&E(ts)),o===s&&(i.substr(h,2)===tr?(o=tr,h+=2):(o=s,f===0&&E(rs)),o===s&&(i.substr(h,2)===rr?(o=rr,h+=2):(o=s,f===0&&E(is)),o===s&&(i.charCodeAt(h)===38?(o=ss,h++):(o=s,f===0&&E(ns)),o===s&&(i.substr(h,2)===ir?(o=ir,h+=2):(o=s,f===0&&E(os)),o===s&&(i.charCodeAt(h)===124?(o=as,h++):(o=s,f===0&&E(us))))))))))))))))),o}function de(){var o,u,b,m,T,w,F,$;if(f++,o=h,u=lt(),u!==s){for(b=[],m=h,T=[],w=x();w!==s;)T.push(w),w=x();if(T!==s)if(w=Or(),w!==s){for(F=[],$=x();$!==s;)F.push($),$=x();F!==s?($=lt(),$!==s?(B=m,T=sr(u,w,$),m=T):(h=m,m=s)):(h=m,m=s)}else h=m,m=s;else h=m,m=s;for(;m!==s;){for(b.push(m),m=h,T=[],w=x();w!==s;)T.push(w),w=x();if(T!==s)if(w=Or(),w!==s){for(F=[],$=x();$!==s;)F.push($),$=x();F!==s?($=lt(),$!==s?(B=m,T=sr(u,w,$),m=T):(h=m,m=s)):(h=m,m=s)}else h=m,m=s;else h=m,m=s}b!==s?(B=o,u=hs(u,b),o=u):(h=o,o=s)}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(ls)),o}function po(){var o,u,b,m,T,w,F,$;if(o=h,u=fe(),u!==s){for(b=[],m=h,T=J(),T!==s?(i.charCodeAt(h)===44?(w=g,h++):(w=s,f===0&&E(y)),w!==s?(F=J(),F!==s?($=fe(),$!==s?(B=m,T=nr(u,$),m=T):(h=m,m=s)):(h=m,m=s)):(h=m,m=s)):(h=m,m=s);m!==s;)b.push(m),m=h,T=J(),T!==s?(i.charCodeAt(h)===44?(w=g,h++):(w=s,f===0&&E(y)),w!==s?(F=J(),F!==s?($=fe(),$!==s?(B=m,T=nr(u,$),m=T):(h=m,m=s)):(h=m,m=s)):(h=m,m=s)):(h=m,m=s);b!==s?(B=o,u=cs(u,b),o=u):(h=o,o=s)}else h=o,o=s;return o}function fo(){var o,u,b,m,T,w,F,$,ee;if(o=h,u=Lo(),u!==s){if(b=[],m=x(),m!==s)for(;m!==s;)b.push(m),m=x();else b=s;if(b!==s)if(m=J(),m!==s){if(T=[],w=h,F=xr(),F!==s){if($=[],ee=x(),ee!==s)for(;ee!==s;)$.push(ee),ee=x();else $=s;$!==s?(B=w,F=or(u,F),w=F):(h=w,w=s)}else h=w,w=s;for(;w!==s;)if(T.push(w),w=h,F=xr(),F!==s){if($=[],ee=x(),ee!==s)for(;ee!==s;)$.push(ee),ee=x();else $=s;$!==s?(B=w,F=or(u,F),w=F):(h=w,w=s)}else h=w,w=s;T!==s?(w=po(),w!==s?(B=o,u=ms(u,T,w),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return o}function go(){var o,u,b,m,T,w;if(f++,o=h,u=fe(),u!==s)if(b=J(),b!==s)if(i.substr(h,2)===ar?(m=ar,h+=2):(m=s,f===0&&E(ps)),m===s&&(i.substr(h,3)===ur?(m=ur,h+=3):(m=s,f===0&&E(ds))),m!==s){for(T=[],w=x();w!==s;)T.push(w),w=x();T!==s?(w=de(),w!==s?(B=o,u=fs(u,m,w),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(bs)),o}function _o(){var o,u,b,m,T,w;if(f++,o=h,u=de(),u!==s)if(b=J(),b!==s)if(i.charCodeAt(h)===61?(m=_s,h++):(m=s,f===0&&E(Ts)),m!==s){for(T=[],w=x();w!==s;)T.push(w),w=x();T!==s?(w=de(),w!==s?(B=o,u=ws(u,m,w),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(gs)),o}function To(){var o,u,b,m,T,w;if(f++,o=h,u=ut(),u!==s){if(b=[],m=h,T=[],w=x(),w!==s)for(;w!==s;)T.push(w),w=x();else T=s;for(T!==s?(w=ut(),w!==s?(B=m,T=lr(u,w),m=T):(h=m,m=s)):(h=m,m=s);m!==s;){if(b.push(m),m=h,T=[],w=x(),w!==s)for(;w!==s;)T.push(w),w=x();else T=s;T!==s?(w=ut(),w!==s?(B=m,T=lr(u,w),m=T):(h=m,m=s)):(h=m,m=s)}b!==s?(B=o,u=ys(u,b),o=u):(h=o,o=s)}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(Ss)),o}function wo(){var o,u,b,m,T,w;if(f++,o=h,i.charCodeAt(h)===40?(u=O,h++):(u=s,f===0&&E(P)),u!==s){for(b=[],m=x();m!==s;)b.push(m),m=x();if(b!==s)if(m=de(),m!==s){for(T=[],w=x();w!==s;)T.push(w),w=x();T!==s?(i.charCodeAt(h)===41?(w=M,h++):(w=s,f===0&&E(j)),w!==s?(B=o,u=cr(m),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(hr)),o}function So(){var o,u,b,m,T;for(f++,o=h,u=[],b=x();b!==s;)u.push(b),b=x();if(u!==s)if(b=de(),b!==s){for(m=[],T=x();T!==s;)m.push(T),T=x();m!==s?(i.charCodeAt(h)===41?(T=M,h++):(T=s,f===0&&E(j)),T!==s?(B=o,u=cr(b),o=u):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(hr)),o}function ht(){var o;return o=wo(),o===s&&(o=So()),o}function ct(){var o,u,b;if(o=h,u=[],b=x(),b!==s)for(;b!==s;)u.push(b),b=x();else u=s;return u!==s?(b=At(),b!==s?(B=o,u=_(b),o=u):(h=o,o=s)):(h=o,o=s),o}function yo(){var o,u,b,m;return f++,o=h,i.substr(h,2).toLowerCase()===Is?(u=i.substr(h,2),h+=2):(u=s,f===0&&E(Rs)),u!==s?(b=J(),b!==s?(m=ht(),m!==s?(B=o,u=vs(m),o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),f--,o===s&&(u=s,f===0&&E(Es)),o}function Eo(){var o,u,b,m;return f++,o=h,i.substr(h,5).toLowerCase()===Os?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(xs)),u!==s?(b=J(),b!==s?(m=ht(),m!==s?(B=o,u=Bs(m),o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),f--,o===s&&(u=s,f===0&&E(Ds)),o}function Io(){var o,u,b,m;return f++,o=h,i.substr(h,5).toLowerCase()===Ns?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(As)),u!==s?(b=J(),b!==s?(m=ht(),m!==s?(B=o,u=Ms(m),o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),f--,o===s&&(u=s,f===0&&E(Ps)),o}function Ro(){var o,u,b,m,T;return f++,o=h,i.substr(h,4).toLowerCase()===Ls?(u=i.substr(h,4),h+=4):(u=s,f===0&&E($s)),u!==s?(b=J(),b!==s?(m=ht(),m!==s?(T=ct(),T===s&&(T=null),T!==s?(B=o,u=Us(m,T),o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),f--,o===s&&(u=s,f===0&&E(Fs)),o}function vo(){var o,u,b;return o=h,i.substr(h,4).toLowerCase()===ks?(u=i.substr(h,4),h+=4):(u=s,f===0&&E(Ws)),u!==s?(b=ct(),b===s&&(b=null),b!==s?(B=o,u=Hs(b),o=u):(h=o,o=s)):(h=o,o=s),o}function Do(){var o,u,b;return o=h,i.substr(h,5).toLowerCase()===Vs?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(js)),u!==s?(b=ct(),b===s&&(b=null),b!==s?(B=o,u=Cs(b),o=u):(h=o,o=s)):(h=o,o=s),o}function Oo(){var o,u;return o=h,i.substr(h,5).toLowerCase()===Xs?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(Ys)),u!==s&&(B=o,u=Gs()),o=u,o}function xo(){var o,u;return o=h,i.substr(h,8).toLowerCase()===zs?(u=i.substr(h,8),h+=8):(u=s,f===0&&E(Zs)),u!==s&&(B=o,u=Ks()),o=u,o}function Bo(){var o,u;return o=h,i.substr(h,2).toLowerCase()===Qs?(u=i.substr(h,2),h+=2):(u=s,f===0&&E(Js)),u!==s&&(B=o,u=qs()),o=u,o}function Po(){var o,u;return o=h,i.substr(h,9).toLowerCase()===en?(u=i.substr(h,9),h+=9):(u=s,f===0&&E(tn)),u!==s&&(B=o,u=rn()),o=u,o}function No(){var o,u;return o=h,i.substr(h,6).toLowerCase()===sn?(u=i.substr(h,6),h+=6):(u=s,f===0&&E(nn)),u!==s&&(B=o,u=on()),o=u,o}function Ao(){var o,u,b;return o=h,i.substr(h,7).toLowerCase()===an?(u=i.substr(h,7),h+=7):(u=s,f===0&&E(un)),u!==s?(b=ct(),b===s&&(b=null),b!==s?(B=o,u=ln(b),o=u):(h=o,o=s)):(h=o,o=s),o}function Mo(){var o,u;return o=h,i.substr(h,8).toLowerCase()===hn?(u=i.substr(h,8),h+=8):(u=s,f===0&&E(cn)),u!==s&&(B=o,u=mn()),o=u,o}function Fo(){var o,u,b,m;return f++,o=h,i.substr(h,6).toLowerCase()===pn?(u=i.substr(h,6),h+=6):(u=s,f===0&&E(dn)),u!==s?(b=J(),b!==s?(m=fe(),m!==s?(B=o,u=fn(m),o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),f--,o===s&&(u=s,f===0&&E(bn)),o}function At(){var o;return o=fo(),o===s&&(o=go(),o===s&&(o=_o(),o===s&&(o=yo(),o===s&&(o=vo(),o===s&&(o=Do(),o===s&&(o=Oo(),o===s&&(o=Eo(),o===s&&(o=xo(),o===s&&(o=Bo(),o===s&&(o=Io(),o===s&&(o=Po(),o===s&&(o=No(),o===s&&(o=Ro(),o===s&&(o=Ao(),o===s&&(o=To(),o===s&&(o=Mo(),o===s&&(o=Fo()))))))))))))))))),o}function Lo(){var o,u;return o=h,i.substr(h,6).toLowerCase()===gn?(u=i.substr(h,6),h+=6):(u=s,f===0&&E(_n)),u!==s&&(B=o,u=Tn()),o=u,o===s&&(o=h,i.substr(h,6).toLowerCase()===wn?(u=i.substr(h,6),h+=6):(u=s,f===0&&E(Sn)),u!==s&&(B=o,u=yn()),o=u,o===s&&(o=h,i.substr(h,5).toLowerCase()===En?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(In)),u!==s&&(B=o,u=Rn()),o=u,o===s&&(o=h,i.substr(h,8).toLowerCase()===vn?(u=i.substr(h,8),h+=8):(u=s,f===0&&E(Dn)),u!==s&&(B=o,u=On()),o=u,o===s&&(o=h,i.substr(h,7).toLowerCase()===xn?(u=i.substr(h,7),h+=7):(u=s,f===0&&E(Bn)),u!==s&&(B=o,u=Pn()),o=u)))),o}function xr(){var o,u;return o=h,i.substr(h,5).toLowerCase()===Nn?(u=i.substr(h,5),h+=5):(u=s,f===0&&E(An)),u!==s&&(B=o,u=Mn()),o=u,o===s&&(o=h,i.substr(h,6).toLowerCase()===Fn?(u=i.substr(h,6),h+=6):(u=s,f===0&&E(Ln)),u!==s&&(B=o,u=$n()),o=u,o===s&&(o=h,i.substr(h,9).toLowerCase()===Un?(u=i.substr(h,9),h+=9):(u=s,f===0&&E(kn)),u!==s&&(B=o,u=Wn()),o=u)),o}function fe(){var o,u,b;if(f++,o=h,u=[],mr.test(i.charAt(h))?(b=i.charAt(h),h++):(b=s,f===0&&E(br)),b!==s)for(;b!==s;)u.push(b),mr.test(i.charAt(h))?(b=i.charAt(h),h++):(b=s,f===0&&E(br));else u=s;return u!==s?o=i.substring(o,h):o=u,f--,o===s&&(u=s,f===0&&E(d)),o}function $o(){var o,u;return f++,o=fe(),f--,o===s&&(u=s,f===0&&E(Hn)),o}function Mt(){var o,u;if(o=[],st.test(i.charAt(h))?(u=i.charAt(h),h++):(u=s,f===0&&E(nt)),u!==s)for(;u!==s;)o.push(u),st.test(i.charAt(h))?(u=i.charAt(h),h++):(u=s,f===0&&E(nt));else o=s;return o}function Uo(){var o,u,b;return o=h,i.charCodeAt(h)===46?(u=Vn,h++):(u=s,f===0&&E(jn)),u!==s?(b=Mt(),b!==s?(u=[u,b],o=u):(h=o,o=s)):(h=o,o=s),o}function ko(){var o,u,b,m;return o=h,Cn.test(i.charAt(h))?(u=i.charAt(h),h++):(u=s,f===0&&E(Xn)),u!==s?(Yn.test(i.charAt(h))?(b=i.charAt(h),h++):(b=s,f===0&&E(Gn)),b===s&&(b=null),b!==s?(m=Mt(),m!==s?(u=[u,b,m],o=u):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),o}function Wo(){var o,u,b,m,T,w;return f++,o=h,u=h,b=h,m=Mt(),m!==s?(T=Uo(),T===s&&(T=null),T!==s?(w=ko(),w===s&&(w=null),w!==s?(m=[m,T,w],b=m):(h=b,b=s)):(h=b,b=s)):(h=b,b=s),b!==s?u=i.substring(u,h):u=b,u!==s&&(B=o,u=Zn(u)),o=u,f--,o===s&&(u=s,f===0&&E(zn)),o}function Ho(){var o,u,b,m,T;if(f++,o=h,i.charCodeAt(h)===35?(u=Qn,h++):(u=s,f===0&&E(Jn)),u!==s){for(b=h,m=[],st.test(i.charAt(h))?(T=i.charAt(h),h++):(T=s,f===0&&E(nt));T!==s;)m.push(T),st.test(i.charAt(h))?(T=i.charAt(h),h++):(T=s,f===0&&E(nt));m!==s?b=i.substring(b,h):b=m,b!==s?(B=o,u=qn(b),o=u):(h=o,o=s)}else h=o,o=s;return f--,o===s&&(u=s,f===0&&E(Kn)),o}function Vo(){var o,u,b,m,T,w;if(o=h,u=h,i.charCodeAt(h)===39?(b=pr,h++):(b=s,f===0&&E(dr)),b!==s){for(m=h,T=[],fr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,f===0&&E(gr));w!==s;)T.push(w),fr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,f===0&&E(gr));T!==s?m=i.substring(m,h):m=T,m!==s?(i.charCodeAt(h)===39?(T=pr,h++):(T=s,f===0&&E(dr)),T!==s?(b=[b,m,T],u=b):(h=u,u=s)):(h=u,u=s)}else h=u,u=s;if(u===s)if(u=h,i.charCodeAt(h)===34?(b=_r,h++):(b=s,f===0&&E(Tr)),b!==s){for(m=h,T=[],wr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,f===0&&E(Sr));w!==s;)T.push(w),wr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,f===0&&E(Sr));T!==s?m=i.substring(m,h):m=T,m!==s?(i.charCodeAt(h)===34?(T=_r,h++):(T=s,f===0&&E(Tr)),T!==s?(b=[b,m,T],u=b):(h=u,u=s)):(h=u,u=s)}else h=u,u=s;return u!==s&&(B=o,u=eo(u)),o=u,o}function x(){var o,u;return f++,ro.test(i.charAt(h))?(o=i.charAt(h),h++):(o=s,f===0&&E(io)),f--,o===s&&(u=s,f===0&&E(to)),o}function Br(){var o,u;return f++,i.charCodeAt(h)===10?(o=no,h++):(o=s,f===0&&E(oo)),f--,o===s&&(u=s,f===0&&E(so)),o}function J(){var o,u;for(f++,o=[],yr.test(i.charAt(h))?(u=i.charAt(h),h++):(u=s,f===0&&E(Er));u!==s;)o.push(u),yr.test(i.charAt(h))?(u=i.charAt(h),h++):(u=s,f===0&&E(Er));return f--,o===s&&(u=s,f===0&&E(ao)),o}if(at=l(),at!==s&&h===i.length)return at;throw at!==s&&h<i.length&&E(uo()),Rr(Nt,q<i.length?i.charAt(q):null,q<i.length?Ue(q,q+1):Ue(q,q))}return{SyntaxError:e,parse:r}}()});var G={log:console.log};var ve=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let r=()=>{this.frameId=e()?requestAnimationFrame(r):0};this.frameId=requestAnimationFrame(r)}stop(){!this.running||(cancelAnimationFrame(this.frameId),this.frameId=0)}},Ft=class{constructor(e=1){this.cycles=e;this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let r=()=>{for(let i=0;i<this.cycles;++i)if(!e()){this.frameId=0;return}this.frameId=setTimeout(r,0)};this.frameId=setTimeout(r)}stop(){!this.running||(clearTimeout(this.frameId),this.frameId=0)}};var Jo=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],Lt=1<<24,$t=2<<24;function Mr(t){let e=t.toLowerCase().trim();if(e.startsWith("transparent"))return Lt;if(e.startsWith("syscolor"))return $t|parseInt(e.split("(")[1].split(")")[0]);if(e.startsWith("rgb")){let r=e.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: ${t}`)}function re(t){if(t&Lt)return"transparent";let e=t&255;if(t&$t)return Jo[e]||"black";let r=t>>8&255,i=t>>16&255;return`rgb(${e},${r},${i})`}function ke(t,e,r,i){let n=i===1?Lt:i===2?$t:0;return t&255|(e&255)<<8|(r&255)<<16|n}function bt(t){return t&255}function pt(t){return t>>8&255}function dt(t){return t>>16&255}var D;(function(t){t[t.PI=Math.PI]="PI",t[t.WORD8=0]="WORD8",t[t.INT8=1]="INT8",t[t.WORD16=2]="WORD16",t[t.INT16=3]="INT16",t[t.WORD32=4]="WORD32",t[t.INT32=5]="INT32",t[t.FLOAT32=6]="FLOAT32",t[t.FLOAT40=7]="FLOAT40",t[t.FLOAT64=8]="FLOAT64",t[t.FLOAT80=9]="FLOAT80",t[t.PEN2D=1]="PEN2D",t[t.BRUSH2D=2]="BRUSH2D",t[t.DIB2D=3]="DIB2D",t[t.DOUBLEDIB2D=4]="DOUBLEDIB2D",t[t.FONT2D=5]="FONT2D",t[t.STRING2D=6]="STRING2D",t[t.TEXT2D=7]="TEXT2D",t[t.SPACE3D=8]="SPACE3D",t[t.TEXTURE3D=9]="TEXTURE3D",t[t.SIZE_RESTORED=0]="SIZE_RESTORED",t[t.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",t[t.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",t[t.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",t[t.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",t[t.OTGROUP2D=3]="OTGROUP2D",t[t.OTRGROUP2D=4]="OTRGROUP2D",t[t.OTGROUP3D=5]="OTGROUP3D",t[t.OTOBJECT3D=10]="OTOBJECT3D",t[t.OTLINE_2D=20]="OTLINE_2D",t[t.OTBITMAP_2D=21]="OTBITMAP_2D",t[t.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",t[t.OTTEXT_2D=23]="OTTEXT_2D",t[t.OTVIEW3D_2D=24]="OTVIEW3D_2D",t[t.OTEDITFRAME=50]="OTEDITFRAME",t[t.OTROTATECENTER=51]="OTROTATECENTER",t[t.OTFRAME3D=52]="OTFRAME3D",t[t.OTAXIS3D=53]="OTAXIS3D",t[t.OTPEN2D=101]="OTPEN2D",t[t.OTBRUSH2D=102]="OTBRUSH2D",t[t.OTDIB2D=103]="OTDIB2D",t[t.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",t[t.OTFONT2D=105]="OTFONT2D",t[t.OTSTRING2D=106]="OTSTRING2D",t[t.OTTEXT2D=107]="OTTEXT2D",t[t.OTREFTODIB2D=110]="OTREFTODIB2D",t[t.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",t[t.ATTRSET=1]="ATTRSET",t[t.ATTRRESET=2]="ATTRRESET",t[t.ATTRPUT=3]="ATTRPUT",t[t.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",t[t.PFC_SETCURRENT=16384]="PFC_SETCURRENT",t[t.PFC_SETFRAME=8192]="PFC_SETFRAME",t[t.PFC_PENS=1]="PFC_PENS",t[t.PFC_BRUHS=2]="PFC_BRUHS",t[t.PFC_DIBS=4]="PFC_DIBS",t[t.PFC_DDIBS=8]="PFC_DDIBS",t[t.PFC_STRINGS=16]="PFC_STRINGS",t[t.PFC_FONTS=32]="PFC_FONTS",t[t.PFC_TEXTS=64]="PFC_TEXTS",t[t.PFC_3D=128]="PFC_3D",t[t.PFC_ALL=255]="PFC_ALL",t[t.OID_RESERVED=32e3]="OID_RESERVED",t[t.OID_RCENTER=32001]="OID_RCENTER",t[t.OID_FRAME2D1=32002]="OID_FRAME2D1",t[t.OID_FRAME2D2=32003]="OID_FRAME2D2",t[t.OID_FRAME2D3=32004]="OID_FRAME2D3",t[t.OID_FRAME2D4=32005]="OID_FRAME2D4",t[t.OID_FRAME2D5=32006]="OID_FRAME2D5",t[t.OID_FRAME2D6=32007]="OID_FRAME2D6",t[t.OID_FRAME2D7=32008]="OID_FRAME2D7",t[t.OID_FRAME2D8=32009]="OID_FRAME2D8",t[t.OID_FRAME2D=32010]="OID_FRAME2D",t[t.OID_AXIS3D=32100]="OID_AXIS3D",t[t.OID_FRAME3D1=32102]="OID_FRAME3D1",t[t.OID_FRAME3D2=32103]="OID_FRAME3D2",t[t.OID_FRAME3D3=32104]="OID_FRAME3D3",t[t.OID_FRAME3D4=32105]="OID_FRAME3D4",t[t.OID_FRAME3D5=32106]="OID_FRAME3D5",t[t.OID_FRAME3D6=32107]="OID_FRAME3D6",t[t.OID_FRAME3D7=32108]="OID_FRAME3D7",t[t.OID_FRAME3D8=32109]="OID_FRAME3D8",t[t.OID_FRAME3D=32110]="OID_FRAME3D",t[t.MB_OK=0]="MB_OK",t[t.MB_OKCANCEL=1]="MB_OKCANCEL",t[t.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",t[t.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",t[t.MB_YESNO=4]="MB_YESNO",t[t.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",t[t.MB_TYPEMASK=15]="MB_TYPEMASK",t[t.MB_ICONHAND=16]="MB_ICONHAND",t[t.MB_ICONQUESTION=32]="MB_ICONQUESTION",t[t.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",t[t.MB_ICONASTERISK=64]="MB_ICONASTERISK",t[t.MB_ICONMASK=240]="MB_ICONMASK",t[t.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",t[t.MB_ICONSTOP=16]="MB_ICONSTOP",t[t.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",t[t.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",t[t.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",t[t.MB_DEFMASK=3840]="MB_DEFMASK",t[t.MB_APPLMODAL=0]="MB_APPLMODAL",t[t.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",t[t.MB_TASKMODAL=8192]="MB_TASKMODAL",t[t.MB_NOFOCUS=32768]="MB_NOFOCUS",t[t.SW_HIDE=0]="SW_HIDE",t[t.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",t[t.SW_NORMAL=1]="SW_NORMAL",t[t.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",t[t.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",t[t.SW_MAXIMIZE=3]="SW_MAXIMIZE",t[t.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",t[t.SW_SHOW=5]="SW_SHOW",t[t.SW_MINIMIZE=6]="SW_MINIMIZE",t[t.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",t[t.SW_SHOWNA=8]="SW_SHOWNA",t[t.SW_RESTORE=9]="SW_RESTORE",t[t.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",t[t.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",t[t.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",t[t.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",t[t.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",t[t.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",t[t.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",t[t.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",t[t.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",t[t.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",t[t.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",t[t.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",t[t.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",t[t.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",t[t.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",t[t.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",t[t.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",t[t.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",t[t.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",t[t.MCIERR_DRIVER=278]="MCIERR_DRIVER",t[t.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",t[t.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",t[t.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",t[t.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",t[t.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",t[t.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",t[t.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",t[t.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",t[t.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",t[t.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",t[t.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",t[t.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",t[t.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",t[t.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",t[t.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",t[t.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",t[t.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",t[t.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",t[t.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",t[t.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",t[t.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",t[t.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",t[t.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",t[t.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",t[t.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",t[t.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",t[t.MCIERR_GET_CD=307]="MCIERR_GET_CD",t[t.MCIERR_SET_CD=308]="MCIERR_SET_CD",t[t.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",t[t.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",t[t.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",t[t.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",t[t.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",t[t.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",t[t.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",t[t.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",t[t.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",t[t.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",t[t.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",t[t.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",t[t.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",t[t.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",t[t.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",t[t.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",t[t.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",t[t.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",t[t.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",t[t.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",t[t.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",t[t.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",t[t.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",t[t.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",t[t.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",t[t.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",t[t.WS_VISIBLE=268435456]="WS_VISIBLE",t[t.WS_DISABLED=134217728]="WS_DISABLED",t[t.WS_CAPTION=12582912]="WS_CAPTION",t[t.WS_BORDER=8388608]="WS_BORDER",t[t.WS_DLGFRAME=4194304]="WS_DLGFRAME",t[t.WS_VSCROLL=2097152]="WS_VSCROLL",t[t.WS_HSCROLL=1048576]="WS_HSCROLL",t[t.WS_SYSMENU=524288]="WS_SYSMENU",t[t.WS_THICKFRAME=262144]="WS_THICKFRAME",t[t.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",t[t.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",t[t.WS_GROUP=131072]="WS_GROUP",t[t.WS_TABSTOP=65536]="WS_TABSTOP",t[t.WS_OVERLAPPED=0]="WS_OVERLAPPED",t[t.WS_POPUP=2147483648]="WS_POPUP",t[t.WS_CHILD=1073741824]="WS_CHILD",t[t.IDX_PRIMARY=1]="IDX_PRIMARY",t[t.IDX_UNIQUE=2]="IDX_UNIQUE",t[t.IDX_DESCENDING=4]="IDX_DESCENDING",t[t.IDX_MAINTAINED=8]="IDX_MAINTAINED",t[t.IDX_SUBSET=16]="IDX_SUBSET",t[t.IDX_EXPR=32]="IDX_EXPR",t[t.IDX_IDXOOD=64]="IDX_IDXOOD",t[t.IDX_CASEINSENS=128]="IDX_CASEINSENS",t[t.FLDDBCHAR=513]="FLDDBCHAR",t[t.FLDDBNUM=514]="FLDDBNUM",t[t.FLDDBMEMO=515]="FLDDBMEMO",t[t.FLDDBBOOL=516]="FLDDBBOOL",t[t.FLDDBDATE=517]="FLDDBDATE",t[t.FLDDBFLOAT=518]="FLDDBFLOAT",t[t.FLDDBLOCK=519]="FLDDBLOCK",t[t.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",t[t.FLDDBBINARY=521]="FLDDBBINARY",t[t.FLDDBBYTES=522]="FLDDBBYTES",t[t.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",t[t.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",t[t.BS_CHECKBOX=2]="BS_CHECKBOX",t[t.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",t[t.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",t[t.BS_3STATE=5]="BS_3STATE",t[t.BS_AUTO3STATE=6]="BS_AUTO3STATE",t[t.BS_GROUPBOX=7]="BS_GROUPBOX",t[t.BS_USERBUTTON=8]="BS_USERBUTTON",t[t.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",t[t.BS_OWNERDRAW=11]="BS_OWNERDRAW",t[t.BS_LEFTTEXT=32]="BS_LEFTTEXT",t[t.ES_LEFT=0]="ES_LEFT",t[t.ES_CENTER=1]="ES_CENTER",t[t.ES_RIGHT=2]="ES_RIGHT",t[t.ES_MULTILINE=4]="ES_MULTILINE",t[t.ES_UPPERCASE=8]="ES_UPPERCASE",t[t.ES_LOWERCASE=16]="ES_LOWERCASE",t[t.ES_PASSWORD=32]="ES_PASSWORD",t[t.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",t[t.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",t[t.ES_NOHIDESEL=256]="ES_NOHIDESEL",t[t.SBS_HORZ=0]="SBS_HORZ",t[t.SBS_VERT=1]="SBS_VERT",t[t.SBS_TOPALIGN=2]="SBS_TOPALIGN",t[t.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",t[t.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",t[t.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",t[t.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",t[t.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",t[t.SBS_SIZEBOX=8]="SBS_SIZEBOX",t[t.LBS_NOTIFY=1]="LBS_NOTIFY",t[t.LBS_SORT=2]="LBS_SORT",t[t.LBS_NOREDRAW=4]="LBS_NOREDRAW",t[t.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",t[t.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",t[t.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",t[t.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",t[t.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",t[t.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",t[t.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",t[t.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",t[t.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",t[t.CBS_SIMPLE=1]="CBS_SIMPLE",t[t.CBS_DROPDOWN=2]="CBS_DROPDOWN",t[t.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",t[t.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",t[t.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",t[t.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",t[t.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",t[t.CBS_SORT=256]="CBS_SORT",t[t.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",t[t.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",t[t.BS_SOLID=0]="BS_SOLID",t[t.BS_NULL=1]="BS_NULL",t[t.BS_HATCHED=2]="BS_HATCHED",t[t.BS_PATTERN=3]="BS_PATTERN",t[t.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",t[t.HS_HORIZONTAL=0]="HS_HORIZONTAL",t[t.HS_VERTICAL=1]="HS_VERTICAL",t[t.HS_FDIAGONAL=2]="HS_FDIAGONAL",t[t.HS_BDIAGONAL=3]="HS_BDIAGONAL",t[t.HS_CROSS=4]="HS_CROSS",t[t.HS_DIAGCROSS=5]="HS_DIAGCROSS",t[t.PS_SOLID=0]="PS_SOLID",t[t.PS_DASH=1]="PS_DASH",t[t.PS_DOT=2]="PS_DOT",t[t.PS_DASHDOT=3]="PS_DASHDOT",t[t.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",t[t.PS_NULL=5]="PS_NULL",t[t.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",t[t.R2_BLACK=1]="R2_BLACK",t[t.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",t[t.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",t[t.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",t[t.R2_MASKPENNOT=5]="R2_MASKPENNOT",t[t.R2_NOT=6]="R2_NOT",t[t.R2_XORPEN=7]="R2_XORPEN",t[t.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",t[t.R2_MASKPEN=9]="R2_MASKPEN",t[t.R2_NOTXORPEN=10]="R2_NOTXORPEN",t[t.R2_NOP=11]="R2_NOP",t[t.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",t[t.R2_COPYPEN=13]="R2_COPYPEN",t[t.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",t[t.R2_MERGEPEN=15]="R2_MERGEPEN",t[t.R2_WHITE=16]="R2_WHITE",t[t.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",t[t.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",t[t.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",t[t.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",t[t.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",t[t.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",t[t.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",t[t.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",t[t.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",t[t.VF_LOCAL=2]="VF_LOCAL",t[t.VF_EQVAR=256]="VF_EQVAR",t[t.VF_ARGUMENT=512]="VF_ARGUMENT",t[t.VF_RETURN=1024]="VF_RETURN",t[t.CUR_ARROW=0]="CUR_ARROW",t[t.CUR_CROSS=1]="CUR_CROSS",t[t.CUR_TEXT=2]="CUR_TEXT",t[t.CUR_NO=3]="CUR_NO",t[t.CUR_SIZE=4]="CUR_SIZE",t[t.CUR_SIZENESW=5]="CUR_SIZENESW",t[t.CUR_SIZENS=6]="CUR_SIZENS",t[t.CUR_SIZENWSE=7]="CUR_SIZENWSE",t[t.CUR_SIZEWE=8]="CUR_SIZEWE",t[t.CUR_UPARROW=9]="CUR_UPARROW",t[t.CUR_WAIT=10]="CUR_WAIT",t[t.CUR_LINK=11]="CUR_LINK",t[t.CUR_HELP=12]="CUR_HELP",t[t.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",t[t.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",t[t.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",t[t.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",t[t.FOG_NONE=0]="FOG_NONE",t[t.FOG_EXP=1]="FOG_EXP",t[t.FOG_EXP2=2]="FOG_EXP2",t[t.FOG_LINEAR=3]="FOG_LINEAR",t[t.TEX_TYPE_1D=1]="TEX_TYPE_1D",t[t.TEX_TYPE_2D=2]="TEX_TYPE_2D",t[t.TEX_TYPE_3D=3]="TEX_TYPE_3D",t[t.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",t[t.SBF_ONE=0]="SBF_ONE",t[t.SBF_ZERO=1]="SBF_ZERO",t[t.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",t[t.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",t[t.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",t[t.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",t[t.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",t[t.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",t[t.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",t[t.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",t[t.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",t[t.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",t[t.CMPF_LESS=2]="CMPF_LESS",t[t.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",t[t.CMPF_EQUAL=4]="CMPF_EQUAL",t[t.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",t[t.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",t[t.CMPF_GREATER=7]="CMPF_GREATER",t[t.CULL_NONE=1]="CULL_NONE",t[t.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",t[t.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",t[t.SO_FLAT=0]="SO_FLAT",t[t.SO_GOURAUD=1]="SO_GOURAUD",t[t.SO_PHONG=2]="SO_PHONG",t[t.PM_POINTS=1]="PM_POINTS",t[t.PM_WIREFRAME=2]="PM_WIREFRAME",t[t.PM_SOLID=3]="PM_SOLID",t[t.LT_POINT=0]="LT_POINT",t[t.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",t[t.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",t[t.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",t[t.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",t[t.OT_POINT_LIST=1]="OT_POINT_LIST",t[t.OT_LINE_LIST=2]="OT_LINE_LIST",t[t.OT_LINE_STRIP=3]="OT_LINE_STRIP",t[t.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",t[t.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",t[t.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",t[t.BBT_POINT=0]="BBT_POINT",t[t.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",t[t.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",t[t.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",t[t.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",t[t.GMM_RELATIVE=0]="GMM_RELATIVE",t[t.GMM_PIXELS=1]="GMM_PIXELS",t[t.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",t[t.GHA_LEFT=0]="GHA_LEFT",t[t.GHA_CENTER=1]="GHA_CENTER",t[t.GHA_RIGHT=2]="GHA_RIGHT",t[t.GVA_TOP=0]="GVA_TOP",t[t.GVA_CENTER=1]="GVA_CENTER",t[t.GVA_BOTTOM=2]="GVA_BOTTOM",t[t.MTHA_LEFT=0]="MTHA_LEFT",t[t.MTHA_CENTER=1]="MTHA_CENTER",t[t.MTVA_BELOW=0]="MTVA_BELOW",t[t.MTVA_ABOVE=1]="MTVA_ABOVE",t[t.MTVA_CENTER=2]="MTVA_CENTER",t[t.PT_BOOL=0]="PT_BOOL",t[t.PT_REAL=1]="PT_REAL",t[t.PT_INT=2]="PT_INT",t[t.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",t[t.PT_SHORT=4]="PT_SHORT",t[t.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",t[t.PT_LONG=6]="PT_LONG",t[t.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",t[t.PT_STRING=8]="PT_STRING",t[t.PT_VECTOR3=9]="PT_VECTOR3",t[t.PT_MATRIX3=10]="PT_MATRIX3",t[t.PT_MATRIX4=11]="PT_MATRIX4",t[t.PT_QUATERNION=12]="PT_QUATERNION",t[t.PT_COLOURVALUE=13]="PT_COLOURVALUE",t[t.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",t[t.NUI_SP_SPINE=1]="NUI_SP_SPINE",t[t.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",t[t.NUI_SP_HEAD=3]="NUI_SP_HEAD",t[t.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",t[t.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",t[t.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",t[t.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",t[t.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",t[t.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",t[t.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",t[t.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",t[t.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",t[t.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",t[t.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",t[t.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",t[t.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",t[t.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",t[t.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",t[t.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",t[t.NUI_SP_COUNT=20]="NUI_SP_COUNT",t[t.WM_DESTROY=2]="WM_DESTROY",t[t.WM_MOVE=3]="WM_MOVE",t[t.WM_SIZE=5]="WM_SIZE",t[t.WM_CLOSE=16]="WM_CLOSE",t[t.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",t[t.WM_COMMAND=273]="WM_COMMAND",t[t.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",t[t.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",t[t.WM_LBUTTONUP=514]="WM_LBUTTONUP",t[t.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",t[t.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",t[t.WM_RBUTTONUP=517]="WM_RBUTTONUP",t[t.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",t[t.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",t[t.WM_MBUTTONUP=520]="WM_MBUTTONUP",t[t.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",t[t.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",t[t.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",t[t.WM_KEYDOWN=256]="WM_KEYDOWN",t[t.WM_KEYUP=257]="WM_KEYUP",t[t.WM_CANCLOSE=1538]="WM_CANCLOSE",t[t.WM_SPACEDONE=1539]="WM_SPACEDONE",t[t.WM_SPACEINIT=1540]="WM_SPACEINIT",t[t.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",t[t.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(D||(D={}));var ft="retCode",ue="model",We="TLB",z="mem",De="schema",ge=0,_e="prj",le="env",gt="oldFloats",Fr="newFloats",_t="oldInts",Lr="newInts",Tt="oldStrings",$r="newStrings",Ur="call",kr="waitFor",Wr="getWaitResult",Hr="saveContext",Vr="loadContext",jr="getTime",Cr="getDate",Xr="getActualSize2d";var He=new Map([["EXIT",{f:`return ${ge}`,tmpl:!0}],["FLOAT",{f:"parseFloat(#0)||0",tmpl:!0}],["HANDLE",{f:"parseInt(#0)||0",tmpl:!0}],["STRING",{f:"(Math.round((#0)*100000)/100000).toString()",tmpl:!0}],["ABS",{f:"Math.abs(#0)||0",tmpl:!0}],["AVERAGE",{f:"(#0)/2+(#1)/2",tmpl:!0}],["EXP",{f:"Math.exp(#0)||0",tmpl:!0}],["LG",{f:"lg",inner:!0}],["LN",{f:"ln",inner:!0}],["LOG",{f:"log",inner:!0}],["MAX",{f:"Math.max(#0, #1)||0",tmpl:!0}],["MIN",{f:"Math.min(#0, #1)||0",tmpl:!0}],["LIMIT",{f:"Math.max(#1, Math.min(#2, #0))||0",tmpl:!0}],["ROUND",{f:"round",inner:!0}],["SQR",{f:"(#0)**2",tmpl:!0}],["SQRT",{f:"Math.sqrt(#0)||0",tmpl:!0}],["TRUNC",{f:"Math.trunc(#0)||0",tmpl:!0}],["RND",{f:"(#0)*Math.random()",tmpl:!0}],["ARCCOS",{f:"arccos",inner:!0}],["ARCSIN",{f:"arcsin",inner:!0}],["ARCTAN",{f:"Math.atan(#0)||0",tmpl:!0}],["COS",{f:"Math.cos(#0)||0",tmpl:!0}],["SIN",{f:"Math.sin(#0)||0",tmpl:!0}],["TAN",{f:"Math.tan(#0)||0",tmpl:!0}],["DEG",{f:"180*(#0)/Math.PI||0",tmpl:!0}],["RAD",{f:"Math.PI*(#0)/180||0",tmpl:!0}],["GETANGLEBYXY",{f:"getAngleByXY",inner:!0}],["AND",{f:"(#0)&&(#1)",tmpl:!0}],["DELTA",{f:"(#0)?0:1",tmpl:!0}],["ED",{f:"(#0)>0?1:0",tmpl:!0}],["NOT",{f:"!(#0)",tmpl:!0}],["NOTBIN",{f:"#0",tmpl:!0}],["OR",{f:"(#0)||(#1)",tmpl:!0}],["SGN",{f:"Math.sign(#0)||0",tmpl:!0}],["XOR",{f:"(#0)!==0^(#1)!==0",tmpl:!0}],["XORBIN",{f:"(#0)^(#1)",tmpl:!0}],["ALLTRIM",{f:"(#0).trim()",tmpl:!0}],["CHANGE",{f:'(#0).replace(new RegExp(#1, "g"), #2)',tmpl:!0}],["COMPARE",{f:"(#0)===(#1)",tmpl:!0}],["COMPAREI",{f:"compareI",inner:!0}],["LEFT",{f:"(#0).substring(0,#1)",tmpl:!0}],["LENGTH",{f:"(#0).length",tmpl:!0}],["LOWER",{f:"(#0).toLowerCase()",tmpl:!0}],["LTRIM",{f:'(#0).replace(/^\\s+/,"")',tmpl:!0}],["POS",{f:"pos",inner:!0}],["REPLICATE",{f:"(#0).repeat(#1)",tmpl:!0}],["SUBSTR",{f:"(#0).substr(#1,#2)",tmpl:!0}],["RIGHT",{f:"right",inner:!0}],["RTRIM",{f:'(#0).replace(/\\s+$/,"")',tmpl:!0}],["UPPER",{f:"(#0).toUpperCase()",tmpl:!0}]]);function Te(t,e){let r="stratum_",i=r.length,n="async_",s=n.length;Object.getOwnPropertyNames(t.prototype).forEach(a=>{let l=t.prototype[a];if(typeof l!="function"||!l.name.startsWith(r))return;let c=a.toString().substring(i),p=c.startsWith(n);p&&(c=c.substring(s));let d=c.toUpperCase(),S={f:`${e}.${a}`,blocking:p},g=He.size;if(He.set(d,S),g===He.size)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0444\u0443\u043D\u043A\u0446\u0438\u0439: ${c}`)})}var R;(function(t){t[t.Float=1]="Float",t[t.Handle=2]="Handle",t[t.String=3]="String",t[t.ColorRef=4]="ColorRef"})(R||(R={}));var Oe=class{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,r){if(e.type!==r.type)return!1;if(e.indexWasSet||r.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(r),r.connectedNodes.add(e),!0}shareIndex(e){this.indexWasSet||(this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(r=>r.shareIndex(e)))}getIndex(e){if(!this.indexWasSet)switch(this.type){case R.Float:this.shareIndex(e.floatsCount++);break;case R.Handle:case R.ColorRef:this.shareIndex(e.intsCount++);break;case R.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}};var he="n",ce="o",X=[];X[R.Float]="F";X[R.Handle]="I";X[R.ColorRef]="I";X[R.String]="S";var Yr=`
var ${_e} = ${De}.${_e};
var ${le} = ${_e}.${le};
var ${ce}${X[R.Float]} = ${z}.${gt};
var ${he}${X[R.Float]} = ${z}.${Fr};
var ${ce}${X[R.Handle]} = ${z}.${_t};
var ${he}${X[R.Handle]} = ${z}.${Lr};
var ${ce}${X[R.String]} = ${z}.${Tt};
var ${he}${X[R.String]} = ${z}.${$r};
`,Gr=`
var ${_e} = ${De}.${_e};
var ${le} = ${_e}.${le};
var ${ce}${X[R.Float]} = ${z}.${gt};
var ${he}${X[R.Float]} = ${z}.${gt};
var ${ce}${X[R.Handle]} = ${z}.${_t};
var ${he}${X[R.Handle]} = ${z}.${_t};
var ${ce}${X[R.String]} = ${z}.${Tt};
var ${he}${X[R.String]} = ${z}.${Tt};
`;function zr(t,e,r){let i=t.length,n=`${ue}.${Wr}();`;t.push(`${ue}.${kr}(${e});`,`return -${i};`,`case -${i}:`,r?`var ${e} = ${n}`:n)}var Zr=class{get(e){return this.v.get(e.toUpperCase())}constructor(e){this.v=new Map(e==null?void 0:e.map((r,i)=>[r.name.toUpperCase(),[r,i]]))}result(){return[...this.v.values()].map(e=>e[0])}},Kr=class{constructor(e,r,i,n,s){this.res=e;this.vars=r;this.lib=i;this.missingFuncs=n;this.innerFuncs=s;this.varCount=0;this._hasBug=!1}reset(){return this.varCount=0,this}hasBug(){return this._hasBug}arr(e,r){let i=this.vars.get(r);if(!i)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);let n=X[i[0].type];return`${e?he:ce}${n}[${We}[${i[1]}]]`}derefer(e){if(e.first.type!=="var"||e.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let r=e.first.name,i=this.vars.get(r);if(!i)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);if(i[0].type!==R.Float)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u0430\u0441\u044C \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0442\u0438\u043F\u0430 Float");return[`${e.first.isNew?he:ce}${X[R.Float]}`,`${We}[${i[1]}]`]}parseOperand(e){var r,i;switch(e.isNew&&e.type!=="var"&&(this._hasBug=!0),e.type){case"float":case"handle":return e.value.toString();case"string":return"`"+e.value.split("\\").join("\\\\").split("`").join("\\`")+"`";case"var":{let n=e.name.toUpperCase();return(i=(r=D[n])==null?void 0:r.toString())!=null?i:this.arr(e.isNew,n)}case"call":{let n=this.parseCall(e),s=this.put(n.f);if(n.blocking){let a=Array.from({length:this.varCount-1},(l,c)=>`t${c}`);if(a.length>0&&this.res.push(`${ue}.${Hr}([${a.join(",")}]);`),zr(this.res,s,!0),a.length>0){let l=`var ctx = ${ue}.${Vr}();`,c=a.map((p,d)=>`var ${p}=ctx[${d}];`).join("");this.res.push(l,c)}}return s}case"-":return`(-${this.parseOperand(e.op)})`;case"!":return`(!${this.parseOperand(e.op)})`;case"subexpr":return`(${this.parseExpr(e.expr)})`}}put(e){let r=`t${this.varCount++}`;return this.res.push(`var ${r}=${e};`),r}parseCall(e){let r=e.name.toUpperCase(),i=e.args.map(a=>this.parseExpr(a)),n=He.get(r);if(n){if(n.inner&&this.innerFuncs.add(n.f),!n.tmpl)return L(L({},n),{f:`${n.f}(${i})`});let a=n.f,l=0;for(;l<i.length;){let p=a.replace(`#${l}`,i[l]);if(a===p)throw Error(`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e.name}: ${i.length}, \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C - ${l})`);a=p,++l}let c=a;for(;(c=a.replace(`#${l}`,"undefined"))!==a;)a=c,++l;return L(L({},n),{f:a})}if(r==="INC"||r==="DEC"){let a=this.derefer(e.args[0]),l=e.args.length<2?1:this.parseExpr(e.args[1]);return{f:`${a[0]}[${a[1]}]${r==="INC"?"+":"-"}=${l}`}}if(r==="GETTIME"){let a=e.args.map(l=>this.derefer(l));return{f:`${le}.${jr}(${a})`}}if(r==="GETDATE"){let a=e.args.map(l=>this.derefer(l));return{f:`${le}.${Cr}(${a})`}}if(r==="GETACTUALSIZE2D"){let a=e.args.slice(0,2).map(c=>this.parseExpr(c)),l=e.args.slice(2,4).map(c=>this.derefer(c));return{f:`${le}.${Xr}(${a},${l})`}}let s=this.lib.getModel(e.name);return s?!s.isFunction:this.missingFuncs.set(r,e.name),{f:`${ue}.${Ur}(${De}, "${e.name}"${i.length>0?","+i:""})`,blocking:!0}}parseExpr(e){let r=this.parseOperand(e.first),i=e.rest.map(n=>n.action==="/"?`/(${this.parseOperand(n.operand)} || Infinity)`:n.action+this.parseOperand(n.operand));return r+i.join("")}},Qr=class{constructor(){this.bblocks=[]}pushBlock(e){return this.bblocks.push(e),e}popBlock(e){let r=this.bblocks.pop();if(!r||r.expect!==e)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${e}`);return r}lastBlock(){return this.bblocks.length>0?this.bblocks[this.bblocks.length-1]:null}getBreakID(){for(let e=this.bblocks.length-1;e>=0;--e){let r=this.bblocks[e];if(r.canBreak)return r.end}return ge}},Ut=class{constructor(e,r,i){this.lib=r;this._hasEquals=!1;this._hasBug=!1;this._hasFuncDecl=!1;this.labelCnt=0;this.missingFuncs=new Map;this.res=[];this.b=new Qr;this.innerFuncs=new Set;this._vars=new Zr(i),this.res=[`var code = ${ft};`,"while(true) {","switch(code) {","case 0:"];let n=new Kr(this.res,this._vars,this.lib,this.missingFuncs,this.innerFuncs);for(let a=0;a<e.length;++a)try{let l=e[a];this.parseCodeline(l,n.reset());let c=l.then;for(;c;)this.parseCodeline(c,n.reset()),c=c.then}catch(l){throw Error(l.message+" \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 "+(a+1))}this._hasBug=n.hasBug();let s=this.b.lastBlock();if(s)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${s.expect}`);this.res.push("}",`return ${ge};`,"}")}comment(e){this.res.push("//"+e)}makeJump(e){return`{ code = ${e}; continue; }`}parseCodeline(e,r){switch(e.type){case":=":{this.res.push(`${r.arr(!0,e.to)} = ${r.parseExpr(e.expr)};`);break}case"callChain":{for(let n=0;n<e.functions.length;++n){let s=e.functions[n],a=r.reset().parseCall(s);a.blocking?zr(this.res,a.f,!1):this.res.push(`${a.f};`)}break}case"if":{this.comment("if");let n=this.b.pushBlock({canBreak:!1,end:++this.labelCnt,expect:"endif",haveElse:!1});this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.end)}`);break}case"else":{let n=this.b.lastBlock();if(!n||n.expect!=="endif"||n.haveElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");n.haveElse=!0;let s=n.end;n.end=++this.labelCnt,this.res.push(this.makeJump(n.end)),this.comment("else"),this.res.push(`case ${s}:`);break}case"endif":{this.comment("endif"),this.res.push(`case ${this.b.popBlock("endif").end}:`);break}case"while":{this.comment("while");let n=this.b.pushBlock({expect:"endwhile",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${n.start}:`),this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.end)}`);break}case"endwhile":{let n=this.b.popBlock("endwhile");this.res.push(this.makeJump(n.start)),this.comment("endwhile"),this.res.push(`case ${n.end}:`);break}case"do":{this.comment("do");let n=this.b.pushBlock({expect:"until",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${n.start}:`);break}case"until":{let n=this.b.popBlock("until");this.res.push(`if(${r.parseExpr(e.expr)}) ${this.makeJump(n.start)}`),this.comment("until"),this.res.push(`case ${n.end}:`);break}case"switch":{this.comment("switch"),this.b.pushBlock({expect:"endswitch",end:++this.labelCnt,next:null,canBreak:!0,hasCase:!1});break}case"endswitch":{this.comment("endswitch");let n=this.b.popBlock("endswitch");n.next!==null&&this.res.push(`case ${n.next}:`),this.res.push(`case ${n.end}:`);break}case"case":{let n=this.b.lastBlock();if(!n||n.expect!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");n.hasCase=!0,n.next!==null?(this.res.push(this.makeJump(n.end)),this.comment("case"),this.res.push(`case ${n.next}:`)):this.comment("case"),n.next=++this.labelCnt,this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.next)}`);break}case"default":{let n=this.b.lastBlock();if(!n||n.expect!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");if(!n.hasCase)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");n.next!==null?(this.res.push(this.makeJump(n.end)),this.comment("default"),this.res.push(`case ${n.next}:`)):this.comment("default"),n.next=null;break}case"break":this.comment("break");let i=this.b.getBreakID();this.res.push(i===ge?`return ${ge};`:this.makeJump(i));break;case"varsDec":break;case"function":this._hasFuncDecl=!0;break;case"return":break;case"=":this._hasEquals=!0;break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: ${e.type}`)}}result(){return this.res}vars(){return this._vars.result()}innerFunctions(){return[...this.innerFuncs]}hasEquations(){return this._hasEquals}hasFunctionDecl(){return this._hasFuncDecl}hasBug(){return this._hasBug}};var qo=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,ea=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,ta=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,ra=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,ia=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,sa=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,na=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,oa=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var srch = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, srch);
        if (idx < 0) return -1;
        srch = idx + s2.length;
    }
    return idx;
}`,aa=`function right(a, n) {
    return a.substring(a.length - n);
}`,ua=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw + Number.EPSILON) / pw || 0;
}`,Jr=new Map([["arccos",qo],["arcsin",ea],["compareI",ta],["getAngleByXY",ra],["lg",ia],["ln",sa],["log",na],["pos",oa],["right",aa],["round",ua]]);var kt="'",Wt='"';function qr(t){let e="",r=null;for(let i=0;i<t.length;++i){let n=t[i];if(n===kt&&r!==Wt?r=r?null:kt:n===Wt&&r!==kt&&(r=r?null:Wt),r){e+=n;continue}if(n==="/"){let s=t[i+1];if(s==="*"){for(i+=2;i<t.length&&(t[i]!=="*"||t[i+1]!=="/");)++i;++i;continue}if(s==="/"){for(++i;i<t.length&&t[++i]!==`
`;);e[e.length-1]!==`
`&&(e+=`
`);continue}}if(n===";"||n===`
`){e[e.length-1]!==`
`&&(e+=`
`);continue}if(n==="\r"){t[i+1]===`
`&&++i,e[e.length-1]!==`
`&&(e+=`
`);continue}e+=n}return e[e.length-1]===`
`?e:e+`
`}var ri=Qo(ti());var we=new Map;var la=[ft,ue,We,z,De],Ve=class{constructor(e,r,i,n){this.contextVars=null;this.target=null;this.lib=r;let s=qr(e),a;try{a=(0,ri.parse)(s)}catch(_){console.dir(_),console.log(s);let I=_.location.start;throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${i}, \u0441\u0442\u0440\u043E\u043A\u0430 ${I.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${I.column}: ${_.message}`)}if(a.length===0){this._func=Ve.noModel,this.isFunction=!1,this.vars=[];return}let l;try{l=new Ut(a,r,n)}catch(_){throw console.log(s.split(`
`).filter(I=>I.trim()).map((I,O)=>`${O+1}: ${I}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0442\u0440\u0430\u043D\u0441\u043B\u044F\u0446\u0438\u0438 ${i}: ${_.message}`)}l.hasEquations()&&console.warn(`\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u0432 ${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B`),l.hasBug()&&console.warn(`${i}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),this.isFunction=l.hasFunctionDecl(),this.vars=l.vars();let c=l.result();if(c.length===0){this._func=Ve.noModel;return}let d=l.innerFunctions().map(_=>Jr.get(_)).join(`
`),S=l.missingFuncs;S.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...S.values()].join(", ")} \u0432 ${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),S.forEach((_,I)=>we.set(I,_));let g=c.join(`
`),y=d+(this.isFunction?Gr:Yr)+g+`//# sourceURL=${i}`;G.log("\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0442\u043E\u0440:",`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${i}${this.isFunction?" \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u044E ":""}`);try{this._func=new Function(...la,y)}catch(_){throw console.log(s.split(`
`).filter(I=>I.trim()).map((I,O)=>`${O+1}: ${I}`).join(`
`)),console.log(g),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${i}: ${_.message}`)}}static noModel(){return 0}*compute(e,r,i){let n=this._func,s=0;for(;;){if((s=n(s,this,e,r,i))===0)return;let a=this.getWaitResult();typeof a!="object"?this.setWaitResult(a):a instanceof Promise?yield a.then(l=>this.setWaitResult(l)):this.setWaitResult(yield*a)}}saveContext(e){if(this.contextVars!==null)throw Error("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u043F\u0435\u0440\u0435\u0437\u0430\u043F\u0438\u0441\u0438 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");this.contextVars=e}loadContext(){let e=this.contextVars;if(e===null)throw Error("\u041D\u0435\u0442 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");return this.contextVars=null,e}setWaitResult(e){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=e}waitFor(e){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=e}getWaitResult(){let e=this.target;if(e===null)throw Error("\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u0430 \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F");return this.target=null,e}*call(e,r,...i){let n=this.lib.getModel(r);if(n||e.stubCall(r,i),!n.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${r} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);let s={floatsCount:0,intsCount:0,stringsCount:0},a=n.vars,l=a.map(_=>new Oe(_.type).getIndex(s)),c=new Float64Array(s.floatsCount),p=new Int32Array(s.intsCount),d=new Array(s.stringsCount).fill("");if(i.length>a.length)throw Error("\u041A\u043E\u043B-\u0432\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0431\u043E\u043B\u044C\u0448\u0435 \u043A\u043E\u043B-\u0432\u0430 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");for(let _=0;_<i.length;++_){let I=i[_];switch(a[_].type){case R.Float:if(typeof I=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");c[l[_]]=I;break;case R.Handle:case R.ColorRef:if(typeof I=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");p[l[_]]=I;break;case R.String:if(typeof I=="number")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");d[l[_]]=I;break}}let S={oldFloats:c,oldInts:p,oldStrings:d};yield*n.compute(l,S,e);let g=a.findIndex(_=>_.isReturnValue);if(g<0)return;switch(a[g].type){case R.String:return d[l[g]];case R.Float:return c[l[g]];default:return p[l[g]]}}};function Ht(t,e,r,i){return new Ve(t,e,r,i)}var je=[String.fromCharCode(0),String.fromCharCode(1),String.fromCharCode(2),String.fromCharCode(3),String.fromCharCode(4),String.fromCharCode(5),String.fromCharCode(6),String.fromCharCode(7),String.fromCharCode(8),String.fromCharCode(9),String.fromCharCode(10),String.fromCharCode(11),String.fromCharCode(12),String.fromCharCode(13),String.fromCharCode(14),String.fromCharCode(15),String.fromCharCode(16),String.fromCharCode(17),String.fromCharCode(18),String.fromCharCode(19),String.fromCharCode(20),String.fromCharCode(21),String.fromCharCode(22),String.fromCharCode(23),String.fromCharCode(24),String.fromCharCode(25),String.fromCharCode(26),String.fromCharCode(27),String.fromCharCode(28),String.fromCharCode(29),String.fromCharCode(30),String.fromCharCode(31),String.fromCharCode(32),String.fromCharCode(33),String.fromCharCode(34),String.fromCharCode(35),String.fromCharCode(36),String.fromCharCode(37),String.fromCharCode(38),String.fromCharCode(39),String.fromCharCode(40),String.fromCharCode(41),String.fromCharCode(42),String.fromCharCode(43),String.fromCharCode(44),String.fromCharCode(45),String.fromCharCode(46),String.fromCharCode(47),String.fromCharCode(48),String.fromCharCode(49),String.fromCharCode(50),String.fromCharCode(51),String.fromCharCode(52),String.fromCharCode(53),String.fromCharCode(54),String.fromCharCode(55),String.fromCharCode(56),String.fromCharCode(57),String.fromCharCode(58),String.fromCharCode(59),String.fromCharCode(60),String.fromCharCode(61),String.fromCharCode(62),String.fromCharCode(63),String.fromCharCode(64),String.fromCharCode(65),String.fromCharCode(66),String.fromCharCode(67),String.fromCharCode(68),String.fromCharCode(69),String.fromCharCode(70),String.fromCharCode(71),String.fromCharCode(72),String.fromCharCode(73),String.fromCharCode(74),String.fromCharCode(75),String.fromCharCode(76),String.fromCharCode(77),String.fromCharCode(78),String.fromCharCode(79),String.fromCharCode(80),String.fromCharCode(81),String.fromCharCode(82),String.fromCharCode(83),String.fromCharCode(84),String.fromCharCode(85),String.fromCharCode(86),String.fromCharCode(87),String.fromCharCode(88),String.fromCharCode(89),String.fromCharCode(90),String.fromCharCode(91),String.fromCharCode(92),String.fromCharCode(93),String.fromCharCode(94),String.fromCharCode(95),String.fromCharCode(96),String.fromCharCode(97),String.fromCharCode(98),String.fromCharCode(99),String.fromCharCode(100),String.fromCharCode(101),String.fromCharCode(102),String.fromCharCode(103),String.fromCharCode(104),String.fromCharCode(105),String.fromCharCode(106),String.fromCharCode(107),String.fromCharCode(108),String.fromCharCode(109),String.fromCharCode(110),String.fromCharCode(111),String.fromCharCode(112),String.fromCharCode(113),String.fromCharCode(114),String.fromCharCode(115),String.fromCharCode(116),String.fromCharCode(117),String.fromCharCode(118),String.fromCharCode(119),String.fromCharCode(120),String.fromCharCode(121),String.fromCharCode(122),String.fromCharCode(123),String.fromCharCode(124),String.fromCharCode(125),String.fromCharCode(126),String.fromCharCode(127),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function wt(t){return Array.from(t).map(e=>je[e]).join("")}var ha=" ".charCodeAt(0);function ii(t){return new Uint8Array([...t].map(e=>{let r=je.indexOf(e);return r>-1?r:ha}))}var Z=class{constructor(e,r){e instanceof ArrayBuffer?this.v=new DataView(e):this.v=new DataView(e.buffer,e.byteOffset,e.byteLength),this.p=0,this.name=r!=null?r:""}pos(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}size(){return this.v.byteLength}eof(){return this.p>=this.size()}bytes(e){let r=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,r}byte(){let e=this.v.getUint8(this.p);return this.p+=1,e}int16(){let e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){let e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){let e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){let e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){let e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?wt(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){let r=e!=null?e:this.size()-this.p,i=this.p,n=0;for(;n<r-1&&this.v.getUint8(i+ ++n)!==0;);let s=this.fixedString(n);return this.p+=1,s}vmString(){let e=this.uint16()*2,r=this.v.getUint8(this.p+e-2)===0?2:1,i=this.fixedString(e-r);return this.p+=r,i}point2d(e){return{x:e?this.int16():this.float64(),y:e?this.int16():this.float64()}}},ie=class extends Error{constructor(e,r){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.name||""}:
${r}`)}},K=class extends ie{constructor(e,r,i){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${r.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${i.toString(16)}.`)}};var W;(function(t){t[t.CR_MATH=1]="CR_MATH",t[t.CR_MATHDATA=2]="CR_MATHDATA",t[t.CR_FLAGS=4]="CR_FLAGS",t[t.CR_VARS=5]="CR_VARS",t[t.CR_CHILDS=6]="CR_CHILDS",t[t.CR_LINKS=7]="CR_LINKS",t[t.CR_ICON=8]="CR_ICON",t[t.CR_SCHEME=9]="CR_SCHEME",t[t.CR_TEXT=10]="CR_TEXT",t[t.CR_VARSIZE=11]="CR_VARSIZE",t[t.CR_IMAGE=12]="CR_IMAGE",t[t.CR_CODE=13]="CR_CODE",t[t.CR_INFO=14]="CR_INFO",t[t.CR_VARS1=15]="CR_VARS1",t[t.CR_CHILDSname=16]="CR_CHILDSname",t[t.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",t[t.CR_DEFICON=20]="CR_DEFICON",t[t.CR_CLASSTIME=21]="CR_CLASSTIME",t[t.CR_ICONFILE=22]="CR_ICONFILE",t[t.CR_HELPFILE=25]="CR_HELPFILE",t[t.CR_EQU=30]="CR_EQU",t[t.CR_MOVEINFO=31]="CR_MOVEINFO",t[t.RR_VERSION=40]="RR_VERSION",t[t.PR_MAINCLASS=100]="PR_MAINCLASS",t[t.PR_PASSWORD=101]="PR_PASSWORD",t[t.PR_VARS=102]="PR_VARS",t[t.PR_WATCH=103]="PR_WATCH",t[t.VR_CLASSES=1e3]="VR_CLASSES",t[t.VR_VARS=1001]="VR_VARS",t[t.VR_SETVAR=1002]="VR_SETVAR",t[t.CR_CLASSINFO=8e3]="CR_CLASSINFO",t[t.PPR_FIELDS=2048]="PPR_FIELDS",t[t.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",t[t.PPR_SCALEMODE=2050]="PPR_SCALEMODE",t[t.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",t[t.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",t[t.PPR_USEADDF=2053]="PPR_USEADDF",t[t.PPR_SRCRECT=2054]="PPR_SRCRECT",t[t.PPR_USESRC=2055]="PPR_USESRC",t[t.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",t[t.CLF_LOADED=1]="CLF_LOADED",t[t.CLF_PROJECT=2]="CLF_PROJECT",t[t.CLF_MODIFY=4]="CLF_MODIFY",t[t.CLF_READONLY=8]="CLF_READONLY",t[t.CLF_NORECURSE=16]="CLF_NORECURSE",t[t.CLF_ADDLIB=32]="CLF_ADDLIB",t[t.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",t[t.CLF_LIBRARY=256]="CLF_LIBRARY",t[t.CLF_PACKFILE=512]="CLF_PACKFILE",t[t.CF_PROTECTED=1]="CF_PROTECTED",t[t.CF_ONEFASE=2]="CF_ONEFASE",t[t.CF_COMPILED=4]="CF_COMPILED",t[t.CF_VIRTUAL=8]="CF_VIRTUAL",t[t.CF_SCHEME=16]="CF_SCHEME",t[t.CF_MODIFY=32]="CF_MODIFY",t[t.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",t[t.CF_BUILDIN=256]="CF_BUILDIN",t[t.CF_ICON=512]="CF_ICON",t[t.CF_PROCEDURE=1024]="CF_PROCEDURE",t[t.CF_STRUCTURE=2048]="CF_STRUCTURE",t[t.CF_USEDEFICON=4096]="CF_USEDEFICON",t[t.CF_SIZEABLE=8192]="CF_SIZEABLE",t[t.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",t[t.TCF_WASSAVE=1]="TCF_WASSAVE",t[t.TCF_NEWCLASS=2]="TCF_NEWCLASS",t[t.OF_DISABLED=1]="OF_DISABLED",t[t.OF_ONEFASE=2]="OF_ONEFASE",t[t.OF_ERROR=4]="OF_ERROR",t[t.LF_DISABLED=1]="LF_DISABLED",t[t.LF_AUTOLINK=2]="LF_AUTOLINK",t[t.VF_LOCAL=2]="VF_LOCAL",t[t.VF_NOREAD=4]="VF_NOREAD",t[t.VF_NOWRITE=8]="VF_NOWRITE",t[t.VF_STATIC=16]="VF_STATIC",t[t.VF_ONSCHEME=32]="VF_ONSCHEME",t[t.VF_PARAMETER=64]="VF_PARAMETER",t[t.VF_LEFT=128]="VF_LEFT",t[t.VF_EQVAR=256]="VF_EQVAR",t[t.VF_ARGUMENT=512]="VF_ARGUMENT",t[t.VF_RETURN=1024]="VF_RETURN",t[t.VF_NOSAVE=2048]="VF_NOSAVE",t[t.VF_GLOBAL=4096]="VF_GLOBAL",t[t.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",t[t.SF_EXTERNAL=1]="SF_EXTERNAL",t[t.SF_EDITING=2]="SF_EDITING",t[t.STATE_FAST=0]="STATE_FAST",t[t.STATE_VARS=1]="STATE_VARS",t[t.STATE_DEBUG=2]="STATE_DEBUG",t[t.STATE_SET=3]="STATE_SET",t[t.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",t[t.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",t[t.CHF_WASSIZED=4]="CHF_WASSIZED",t[t.CHF_PREPROCESS=8]="CHF_PREPROCESS",t[t.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",t[t.IF_CORRECTED=1]="IF_CORRECTED",t[t.EF_RUNNING=1]="EF_RUNNING",t[t.EF_MUSTSTOP=2]="EF_MUSTSTOP",t[t.EF_STEPACTIVE=4]="EF_STEPACTIVE",t[t.EF_EQUACTIVE=8]="EF_EQUACTIVE",t[t.EF_MSGACTIVE=16]="EF_MSGACTIVE",t[t.EF_BYTIMER=32]="EF_BYTIMER"})(W||(W={}));var ca={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone"};function ma(t){let e={},r=t.uint16();for(let i=0;i<r;++i){let n=t.uint16(),s=t.byte(),a=t.byte(),l=t.fixedString(a-1);t.byte();let c;switch(s){case 0:c=t.int32();break;case 1:c=t.float64();break;case 2:c=t.fixedString(n-a-3),t.byte();break;default:throw new ie(t,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${s}`)}let p=ca[l];p?e[p]=c:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${l} (${c})`)}return e}function ba(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=Array.from({length:t.uint16()},()=>t.uint16()),s=t.string(),a=t.string();r[i]={path:n,name:s,info:a}}return r}function St(t){let e=t.uint16();if(e!==26697)throw new K(t,e,26697);let r={rootClassName:""},i=0;for(;(i=t.uint16())!==0;)switch(i){case W.PR_PASSWORD:t.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case W.PR_MAINCLASS:r.rootClassName=t.string();break;case W.PR_VARS:r.settings=ma(t);break;case W.PR_WATCH:r.watchedVariables=ba(t);break}if(!r.rootClassName)throw new ie(t,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}function si(t){let e=t.int32(),r=t.uint16(),i=t.string(),n=t.int32(),s=Array.from({length:t.uint16()},()=>({name:t.string(),value:t.string()})),a=[];for(;t.pos()<e;)a.push(si(t));return{handle:r,classname:i,classId:n,values:s,childSets:a}}function yt(t){let e=t.uint16();if(e!==19)throw new K(t,e,19);switch(t.seek(21),t.string(),t.uint16(),t.uint16(),t.uint16()){case W.VR_CLASSES:throw new ie(t,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case W.VR_SETVAR:return si(t)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}var se;(function(t){t[t.SWF_AUTOSCROLL=1]="SWF_AUTOSCROLL",t[t.SWF_HSCROLL=2]="SWF_HSCROLL",t[t.SWF_VSCROLL=4]="SWF_VSCROLL",t[t.SWF_SPACESIZE=8]="SWF_SPACESIZE",t[t.SWF_NORESIZE=16]="SWF_NORESIZE",t[t.SWF_DIALOG=32]="SWF_DIALOG",t[t.SWF_POPUP=64]="SWF_POPUP",t[t.SWF_MDI=128]="SWF_MDI",t[t.SWF_WINTYPE=224]="SWF_WINTYPE",t[t.SWF_MODAL=256]="SWF_MODAL",t[t.SWF_AUTOORG=512]="SWF_AUTOORG",t[t.SWF_MAXIMIZE=1024]="SWF_MAXIMIZE",t[t.SWF_MINIMIZE=2048]="SWF_MINIMIZE"})(se||(se={}));var ni;(function(t){t[t.DISABLE_SUBWINDOW=1]="DISABLE_SUBWINDOW",t[t.CAN_SELECT_UNSELECTABLE=8]="CAN_SELECT_UNSELECTABLE"})(ni||(ni={}));var oi=class{constructor(e,r,i=!1,n=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.data=r,this.pos=n,this.view=e,this.is_with_alpha=!!i,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){let e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let r=0;r<e;r++){let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.palette[r]={red:s,green:n,blue:i,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){let e="bit"+this.bitPP,r=this.width*this.height*4;if(this.data.length!==r)throw Error("Error reading BMP file");if(e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){let e=Math.ceil(this.width/8),r=e%4,i=this.height>=0?this.height-1:-this.height;for(i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<e;s++){let a=this.view.getUint8(this.pos++),l=n*this.width*4+s*8*4;for(let c=0;c<8&&s*8+c<this.width;c++){let p=this.palette[a>>7-c&1];this.data[l+c*4]=p.red,this.data[l+c*4+1]=p.green,this.data[l+c*4+2]=p.blue,this.data[l+c*4+3]=255}}r!==0&&(this.pos+=4-r)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,r=this.bottom_up?this.height-1:0,i=!1,n=s=>{let a=this.palette[s];this.data[e]=a.red,this.data[e+1]=a.green,this.data[e+2]=a.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){let s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);if(s===0)if(a===0){this.bottom_up?r--:r++,e=r*this.width*4,i=!1;continue}else{if(a===1)break;if(a===2){let l=this.view.getUint8(this.pos++),c=this.view.getUint8(this.pos++);this.bottom_up?r-=c:r+=c,e+=c*this.width*4+l*4}else{let l=this.view.getUint8(this.pos++);for(let c=0;c<a;c++)i?n.call(this,l&15):n.call(this,(l&240)>>4),c&1&&c+1<a&&(l=this.view.getUint8(this.pos++)),i=!i;(a+1>>1&1)==1&&this.pos++}}else for(let l=0;l<s;l++)i?n.call(this,a&15):n.call(this,(a&240)>>4),i=!i}}else{let e=Math.ceil(this.width/2),r=e%4;for(let i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<e;s++){let a=this.view.getUint8(this.pos++),l=n*this.width*4+s*2*4,c=a>>4,p=a&15,d=this.palette[c];if(this.data[l]=d.red,this.data[l+1]=d.green,this.data[l+2]=d.blue,this.data[l+3]=255,s*2+1>=this.width)break;d=this.palette[p],this.data[l+4]=d.red,this.data[l+4+1]=d.green,this.data[l+4+2]=d.blue,this.data[l+4+3]=255}r!==0&&(this.pos+=4-r)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,r=this.bottom_up?this.height-1:0,i=n=>{let s=this.palette[n];this.data[e]=s.red,this.data[e+1]=s.green,this.data[e+2]=s.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);if(n===0)if(s===0){this.bottom_up?r--:r++,e=r*this.width*4;continue}else{if(s===1)break;if(s===2){let a=this.view.getUint8(this.pos++),l=this.view.getUint8(this.pos++);this.bottom_up?r-=l:r+=l,e+=l*this.width*4+a*4}else{for(let a=0;a<s;a++){let l=this.view.getUint8(this.pos++);i.call(this,l)}(s&1)==1&&this.pos++}}else for(let a=0;a<n;a++)i.call(this,s)}}else{let e=this.width%4;for(let r=this.height-1;r>=0;r--){let i=this.bottom_up?r:this.height-1-r;for(let n=0;n<this.width;n++){let s=this.view.getUint8(this.pos++),a=i*this.width*4+n*4;if(s<this.palette.length){let l=this.palette[s];this.data[a]=l.red,this.data[a+1]=l.green,this.data[a+2]=l.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){let e=this.width%3,r=parseInt("11111",2),i=r;for(let n=this.height-1;n>=0;n--){let s=this.bottom_up?n:this.height-1-n;for(let a=0;a<this.width;a++){let l=this.view.getUint16(this.pos,!0);this.pos+=2;let c=(l&i)/i*255|0,p=(l>>5&i)/i*255|0,d=(l>>10&i)/i*255|0,S=s*this.width*4+a*4;this.data[S]=d,this.data[S+1]=p,this.data[S+2]=c,this.data[S+3]=255}this.pos+=e}}bit16(){let e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);let r=[0,0,0];for(let i=0;i<16;i++)this.maskRed>>i&1&&r[0]++,this.maskGreen>>i&1&&r[1]++,this.maskBlue>>i&1&&r[2]++;r[1]+=r[0],r[2]+=r[1],r[0]=8-r[0],r[1]-=8,r[2]-=8;for(let i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<this.width;s++){let a=this.view.getUint16(this.pos,!0);this.pos+=2;let l=(a&this.maskBlue)<<r[0],c=(a&this.maskGreen)>>r[1],p=(a&this.maskRed)>>r[2],d=n*this.width*4+s*4;this.data[d]=p,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),l=r*this.width*4+i*4;this.data[l]=a,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){this.view.getUint8(this.pos++);let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),l=r*this.width*4+i*4;this.data[l]=a,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=255}}}else for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);let l=r*this.width*4+i*4;this.data[l]=a,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=255}}}};function Et(t,e){new oi(t,e)}function Vt(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}function jt(t){let e=t.pos(),r=t.uint16();if(r!==19778)throw new K(t,r,19778);let i=t.int32();return t.seek(e),i}function Ct(t){return new DataView(t.buffer,t.byteOffset)}function It(t){let e=t.bytes(jt(t)),r=Ct(e),{width:i,height:n}=Vt(r);if(i===0||n===0)return null;let s=document.createElement("canvas");s.width=i,s.height=n;let a=s.getContext("2d",{alpha:!1});if(!a)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${t.name}`);let l=a.createImageData(i,n);return Et(r,l.data),a.putImageData(l,0,0),a}function xe(t){let e=t.bytes(jt(t)),r=t.bytes(jt(t)),i=Ct(e),{width:n,height:s}=Vt(i);if(n===0||s===0)return null;let a=document.createElement("canvas");a.width=n,a.height=s;let l=a.getContext("2d",{alpha:!0});if(!l)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${t.name}`);let c=l.createImageData(n,s),p=c.data,d=new Uint8ClampedArray(n*s*4);Et(i,p),Et(Ct(r),d);for(let S=3;S<p.length&&S<d.length;S+=4)p[S]=255^d[S-1];return l.putImageData(c,0,0),l}var k;(function(t){t[t.otGROUP=1]="otGROUP",t[t.otCOLLECTION=1e3]="otCOLLECTION",t[t.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",t[t.otPENCOLLECTION=1004]="otPENCOLLECTION",t[t.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",t[t.otDIBCOLLECTION=1006]="otDIBCOLLECTION",t[t.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",t[t.otFONTCOLLECTION=1008]="otFONTCOLLECTION",t[t.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",t[t.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",t[t.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",t[t.ot3DCOLLECTION=1012]="ot3DCOLLECTION",t[t.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",t[t.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",t[t.otDATAITEMS=1022]="otDATAITEMS",t[t.otMATERIALS3D=1024]="otMATERIALS3D",t[t.otSPACE2D=17458]="otSPACE2D",t[t.otSPACE3D=17459]="otSPACE3D",t[t.otSPACE3Df=25668]="otSPACE3Df",t[t.otGROUP2D=3]="otGROUP2D",t[t.otRGROUP2D=4]="otRGROUP2D",t[t.otGROUP3D=5]="otGROUP3D",t[t.otOBJECT3D=10]="otOBJECT3D",t[t.otCAMERA3D=11]="otCAMERA3D",t[t.otLIGHT3D=12]="otLIGHT3D",t[t.otLINE2D=20]="otLINE2D",t[t.otBITMAP2D=21]="otBITMAP2D",t[t.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",t[t.otTEXT2D=23]="otTEXT2D",t[t.otVIEW3D2D=24]="otVIEW3D2D",t[t.otUSEROBJECT2D=25]="otUSEROBJECT2D",t[t.otCONTROL2D=26]="otCONTROL2D",t[t.otEDITFRAME2D=50]="otEDITFRAME2D",t[t.otROTATECENTER2D=51]="otROTATECENTER2D",t[t.otFRAME3D=52]="otFRAME3D",t[t.otAXIS3D=53]="otAXIS3D",t[t.ttPEN2D=101]="ttPEN2D",t[t.ttBRUSH2D=102]="ttBRUSH2D",t[t.ttDIB2D=103]="ttDIB2D",t[t.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",t[t.ttFONT2D=105]="ttFONT2D",t[t.ttSTRING2D=106]="ttSTRING2D",t[t.ttTEXT2D=107]="ttTEXT2D",t[t.ttREFTODIB2D=110]="ttREFTODIB2D",t[t.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",t[t.ctINFONAME=200]="ctINFONAME",t[t.ctINFOAUTOR=201]="ctINFOAUTOR",t[t.ctINFOINFO=202]="ctINFOINFO",t[t.ctCRDSYSTEM=203]="ctCRDSYSTEM",t[t.stSPACEDATA=204]="stSPACEDATA",t[t.stOBJNAME=205]="stOBJNAME"})(k||(k={}));function ai(t,e){if(t!==k.ttPEN2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Pen");return{handle:e.uint16(),color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()}}function ui(t,e){if(t!==k.ttBRUSH2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Brush");return{handle:e.uint16(),color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()}}function li(t,e){switch(t){case k.ttDIB2D:return{type:"image",handle:e.uint16(),img:It(e)};case k.ttREFTODIB2D:return{type:"BMPReference",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Dib")}}function hi(t,e){switch(t){case k.ttDOUBLEDIB2D:return{type:"image",handle:e.uint16(),img:xe(e)};case k.ttREFTODOUBLEDIB2D:return{type:"DBMReference",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 DoubleDib")}}function ci(t,e,r){if(t!==k.ttFONT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Font");let i=e.pos(),n={handle:e.uint16(),height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),fontName:e.nulltString(32)};return e.seek(i+52),r>=515&&(n.size=e.int32(),n.style=e.int32()),n}function mi(t,e){if(t!==k.ttSTRING2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 String");return{handle:e.uint16(),text:e.string()}}function pa(t){return{fgColor:t.int32(),bgColor:t.int32(),fontHandle:t.uint16(),stringHandle:t.uint16()}}function bi(t,e,r){if(t!==k.ttTEXT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Text");let i=e.uint16(),n=new Y(e,r,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u044B\u0445 \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\u043E\u0432"),s=n.readCollection(pa);return n.checkReaded(),{handle:i,textCollection:s}}function Xt(t){return t.uint16()}function Yt(t,e){let r={handle:t.uint16(),options:t.uint16()};return e>=258&&e<768&&(r.name=t.string()),r}function Be(t,e){return e<512?L(L({},Yt(t,e)),{originX:t.int16(),originY:t.int16(),width:t.int16(),height:t.int16()}):L(L({},Yt(t,e)),{originX:t.float64(),originY:t.float64(),width:t.float64(),height:t.float64()})}function pi(t,e){let r=Yt(t,e),i=new Y(t,e,"\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0433\u0440\u0443\u043F\u043F\u044B"),n=i.readCollection(Xt);return i.checkReaded(),L(L({type:"group"},r),{childHandles:n})}function di(t,e){let r=Be(t,e),i=t.uint16(),n=t.uint16(),s=t.uint16()*2,a=new Array(s);for(let c=0;c<s;c+=2)e<512?(a[c+0]=t.int16(),a[c+1]=t.int16()):(a[c+0]=t.float64(),a[c+1]=t.float64());let l=L(L({type:"line"},r),{penHandle:i,brushHandle:n,coords:a});if(e>512){let c=t.byte();c>0&&(l.arrows=t.bytes(c))}return l}function Gt(t,e,r){return L(L({type:r},Be(t,e)),{cropX:e<512?t.int16():t.float64(),cropY:e<512?t.int16():t.float64(),cropW:e<512?t.int16():t.float64(),cropH:e<512?t.int16():t.float64(),angle:t.int16(),dibHandle:t.uint16()})}function fi(t,e){return L(L({type:"text"},Be(t,e)),{textToolHandle:t.uint16(),delta:t.point2d(e<512),angle:t.int16()})}function gi(t,e){let r=Be(t,e),i=t.string(),n=i.toUpperCase();if(n!=="EDIT"&&n!=="BUTTON"&&n!=="COMBOBOX")throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430 Control #${r.handle}: ${i}`);let s=L(L({type:"control"},r),{inputType:n,text:t.string(),dwStyle:t.int32(),exStyle:t.int32(),id:t.uint16(),controlSize:t.point2d(!0)});return t.uint16(),s}function _i(t,e){return L(L({type:"view3D"},Be(t,e)),{spaceHandle:t.uint16(),cameraHandle:t.uint16()})}function Ti(t,e){return L(L({type:"editFrame"},Be(t,e)),{objectHandle:t.uint16(),size:t.point2d(e<512)})}function wi(t,e){let r={},i=0,n=t.pos()+e;for(;t.pos()<n&&(i=t.uint16())!==0;)switch(i){case 1:r.target=t.string();break;case 2:r.windowName=t.string();break;case 3:r.objectName=t.string();break;case 4:r.openMode=t.uint16();break;case 5:r.effect=t.string();break;case 6:r.time=t.uint16();break;case 7:r.disabled=!0;break;case 8:r.params=t.string();break}return r}function zt(t,e){let r=t.uint16();return t.skip(5),Array.from({length:r},()=>{let i=t.uint16(),n=t.uint16();return e(i,n,t)})}function Si(t,e){return{type:t.uint16(),objectHandle:t.int16(),center:t.point2d(e<512),matrix:Array.from({length:9},()=>t.float64())}}var Y=class{constructor(e,r,i){this.name=i;this.reader=e,this.version=r,this.start=e.pos(),this.code=e.int16(),this.size=r>=768?e.int32():0}goEnd(){this.reader.seek(this.start+this.size)}readToolCollection(e){let r=this.reader.uint16();return this.reader.skip(7),Array.from({length:r},()=>{let i=new Y(this.reader,this.version,"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442");this.reader.skip(2);let n=e(i.code,this.reader,this.version);return i.checkReaded(),n})}readElementCollection(){let e=this.reader.uint16();return this.reader.skip(7),Array.from({length:e},()=>{let{reader:r,version:i}=this,n=new Y(r,i,"\u0413\u0440\u0430\u0444. \u043E\u0431\u044A\u0435\u043A\u0442"),s;switch(n.code){case k.otGROUP2D:s=pi(r,i);break;case k.otLINE2D:s=di(r,i);break;case k.otBITMAP2D:s=Gt(r,i,"bitmap");break;case k.otDOUBLEBITMAP2D:s=Gt(r,i,"doubleBitmap");break;case k.otTEXT2D:s=fi(r,i);break;case k.otCONTROL2D:s=gi(r,i);break;case k.otVIEW3D2D:s=_i(r,this.version);break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442: ${k[n.code]}`)}if(i<768)return s;for(;n.hasData();){let a=new Y(this.reader,this.version,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435");a.readElementData(s),a.checkReaded()}return n.checkReaded(),s})}readElementData(e){switch(this.code){case k.otDATAITEMS:zt(this.reader,function(r,i,n){switch(r){case 10:e.hyperbase=wi(n,i);break;case 13:n.nulltString(i);break;case 14:n.nulltString(i);break;default:console.warn(`${n.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 ${e.type} #${e.handle}: id ${r}, ${i} \u0431\u0430\u0439\u0442\u043E\u0432`),n.skip(i)}});break;case k.stOBJNAME:e.name=this.reader.fixedString(this.size-6);break}}readCollection(e){let r=this.reader.uint16();return this.reader.skip(4),Array.from({length:r},()=>e(this.reader))}readObject(e){switch(this.code){case 1004:e.penTools=this.readToolCollection(ai);break;case 1005:e.brushTools=this.readToolCollection(ui);break;case 1006:e.dibTools=this.readToolCollection(li);break;case 1007:e.doubleDibTools=this.readToolCollection(hi);break;case 1008:e.fontTools=this.readToolCollection(ci);break;case 1009:e.stringTools=this.readToolCollection(mi);break;case 1010:e.textTools=this.readToolCollection(bi);break;case 1012:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 3D-\u0444\u0440\u0435\u0439\u043C\u043E\u0432 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");case k.otPRIMARYCOLLECTION:e.elementOrder=this.readCollection(Xt);break;case k.otOBJECTCOLLECTION:e.elements=this.readElementCollection();break;case k.otDATAITEMS:zt(this.reader,(i,n,s)=>{switch(i){case 1:e.grid={offsetX:s.float64(),offsetY:s.float64(),stepX:s.float64(),stepY:s.float64(),visible:!!s.byte(),use:!!s.byte()};break;case 11:e.settings={style:s.uint32(),x:s.uint16(),y:s.uint16()};break;case 13:s.skip(n);break;default:console.warn(`${s.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0441\u0442\u0440\u0430\u043D\u0441\u0442\u0432\u0430: id ${i}, ${n} \u0431\u0430\u0439\u0442\u043E\u0432`),s.skip(n);break}});break;case k.ctINFONAME:this.reader.skip(this.reader.uint16());break;case k.ctINFOAUTOR:this.reader.skip(this.reader.uint16());break;case k.ctINFOINFO:this.reader.skip(this.reader.uint16());break;case k.ctCRDSYSTEM:e.crdSystem=Si(this.reader,this.version);break;case k.otEDITFRAME2D:let r=Ti(this.reader,this.version);console.warn(`${this.reader.name}: \u0444\u0440\u0435\u0439\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F #${r.objectHandle} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`);break;default:console.warn(`${this.reader.name}: ${k[this.code]} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.goEnd()}}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.reader.pos()-this.start}checkReaded(){if(this.version<768)return;let e=this.readedBytes();if(e>this.size)throw Error(`Chunk ${this.name} data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk ${this.name} not readed: ${e} instead of ${this.size}`)}};function da(t,e){let r=new Y(t,e,"VDR");if(r.code!==k.stSPACEDATA)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x");let i={version:e,origin:t.point2d(),scaleDiv:t.point2d(),scaleMul:t.point2d(),state:t.uint16(),brushHandle:t.uint16(),layers:t.uint32(),flags:t.uint16()};for(;r.hasData();){let n=new Y(t,e,"");n.readObject(i),n.checkReaded()}return r.checkReaded(),i}function fa(t,e,r){var g;let i=t.int32()+r,n=t.int32()+r,s=t.point2d(e<512),a=t.point2d(e<512),l=t.point2d(e<512);t.string();let c=t.uint16();t.string(),t.string(),t.string(),new Y(t,e,"RCenter").goEnd(),new Y(t,e,"Frame").goEnd();let p=t.uint16(),d={version:e,origin:s,scaleDiv:a,scaleMul:l,state:c,flags:0,brushHandle:p,layers:0};t.seek(i),new Y(t,e,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(d),new Y(t,e,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(d),t.seek(n);let S=t.uint16();for(let y=0;y<S;++y)new Y(t,e,"").readObject(d);if(e>258){d.layers=t.uint32(),d.flags=t.uint16();let y;for(;(y=t.uint16())!==0;)switch(y){case 1:let _=t.uint16(),I=(g=d.elements)==null?void 0:g.find(O=>O.handle===_);if(!I)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${_} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435`);new Y(t,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readElementData(I);break;case 2:new Y(t,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readObject(d);break;default:return d}}return t.string(),d}function Pe(t,e,r=!0){let i=t.uint16();if(i!==17458)throw new K(t,i,17458);let n=t.pos(),s=t.uint16();t.skip(2);let a=s<768?fa(t,s,n):da(t,s);if(a.source=e,!r)return a;let l=t.size()-t.pos();if(l!==0){let c=`${t.name}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${t.pos()} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${l}. v0x${a.version.toString(16)}.`;console.warn(c)}return a}var H=class extends Map{static create(e){return new Map(e)}static getFreeHandle(e,r){let i=r||0;for(;e.has(++i););return i}static getFreeNegativeHandle(e){let r=0;for(;e.has(--r););return r}};var Ce=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,originX:a,originY:l,type:c,dibHandle:p,width:d,height:S,cropX:g,cropY:y,cropW:_,cropH:I}){this.type="bitmap";this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.markDeleted=!1,e.dirty=!0,this.isDouble=c==="doubleBitmap";let O=(this.isDouble?e.doubleDibs:e.dibs).get(p);O==null||O.subscribe(this),this.dib=O||null,this._originX=a,this._originY=l;let P=(O==null?void 0:O.width())||0,M=(O==null?void 0:O.height())||0;this.hardHidden=s?!!(s&1):!1,this._width=this.hardHidden?1:d||P,this._height=this.hardHidden?1:S||M,this.cropX=g||0,this.cropY=y||0,this.cropW=_||P,this.cropH=I||M;let j=s||0;this._visible=!0,this._selectable=j&8?0:1;let A=j>>8&31;this._layer=1<<A,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var l;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(l=this._parent)==null||l.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){var e;return((e=this.dib)==null?void 0:e.width())||0}height(){return this._height}actualHeight(){var e;return((e=this.dib)==null?void 0:e.height())||0}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}setBitmapRect(e,r,i,n){return e<0||r<0||i<0||n<0?0:(this.cropX=e,this.cropY=r,this.cropW=i,this.cropH=n,this.scene.dirty=!0,1)}dibHandle(){return!this.isDouble&&this.dib?this.dib.handle:0}doubleDIBHandle(){return this.isDouble&&this.dib?this.dib.handle:0}delete(){var e,r;(e=this.dib)==null||e.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,l=this._originY-r,c=a*s-l*n,p=a*n+l*s;this._originX=c+e,this._originY=p+r,this.scene.dirty=!0}render(e,r,i,n){if(this.hardHidden||!this.dib||!this._visible||(this._layer&n)!=0)return;let s=this._originX-r,a=this._originY-i;this.dib.render(e,this.cropX,this.cropY,this.cropW,this.cropH,s,a,this._width,this._height)}tryClick(e,r,i){if(this.hardHidden||!this.dib||!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=e-this._originX,s=r-this._originY;if(n<0||s<0||n>this._width||s>this._height)return;let a=n*(this.cropW/this._width)+this.cropX,l=s*(this.cropH/this._height)+this.cropY;if(!!this.dib.tryClick(a,l))return this._parent?this._parent.root():this}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}};var Xe=class{constructor(e,{hyperbase:r,handle:i,options:n,name:s,originX:a,originY:l,width:c,height:p,inputType:d,text:S}){this.type="control";if(d!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${d} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);this.hyperbase=r!=null?r:null,this.handle=i,this.name=s||"",this.scene=e,this.markDeleted=!1,this._originX=a,this._originY=l,this._width=c,this._height=p;let g=n||0;this._visible=!0,this._selectable=g&8?0:1;let y=g>>8&31;this._layer=1<<y,this._parent=null,e.dirty=!0,this.lastX=a-e.originX(),this.lastY=l-e.originY(),this.lastWidth=c,this.lastHeight=p,this.lastHidden=!this._visible;let _=this.element=document.createElement("input");_.setAttribute("type","text"),_.setAttribute("class","stratum-textbox"),_.style.setProperty("position","absolute"),_.style.setProperty("left",this.lastX+"px"),_.style.setProperty("top",this.lastY+"px"),_.style.setProperty("width",c+"px"),_.style.setProperty("height",p+"px"),_.value=S,_.hidden=this.lastHidden,_.addEventListener("input",this),e.view.appendChild(_)}handleEvent(e){this.scene.dispatchControlNotifyEvent(this.handle,e)}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var l;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(l=this._parent)==null||l.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}controlText(){return this.element.value}setControlText(e){return this.element.value=e,1}delete(){var e;this.element.remove(),(e=this._parent)==null||e.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,l=this._originY-r,c=a*s-l*n,p=a*n+l*s;this._originX=c+e,this._originY=p+r,this.scene.dirty=!0}render(e,r,i,n){let s=!this._visible||(this._layer&n)!=0;s!==this.lastHidden&&(this.lastHidden=s,this.element.hidden=s);let a=this._originX-r,l=this._originY-i;(a!==this.lastX||l!==this.lastY)&&(this.lastX=a,this.lastY=l,this.element.style.setProperty("left",a+"px"),this.element.style.setProperty("top",l+"px"));let c=this._width,p=this._height;(c!==this.lastWidth||p!==this.lastHeight)&&(this.lastWidth=c,this.lastHeight=p,this.element.style.setProperty("width",c+"px"),this.element.style.setProperty("height",p+"px"))}tryClick(e,r,i){if(!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=e-this._originX,s=r-this._originY;if(!(n<0||s<0||n>this._width||s>this._height))return this._parent?this._parent.root():this}textToolHandle(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}};var Ne=class{constructor(e,{hyperbase:r,handle:i,name:n}){this.type="group";this._minX=0;this._maxX=0;this._minY=0;this._maxY=0;this._parent=null;this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.children=[],this.markDeleted=!1}addChildren(e){var r;return e.length===0?this:(this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity,e.forEach(i=>{let n=this.scene.objects.get(i);!n||(this._minX=Math.min(this._minX,n.minX()),this._minY=Math.min(this._minY,n.minY()),this._maxX=Math.max(this._maxX,n.maxX()),this._maxY=Math.max(this._maxY,n.maxY()),n.onParentChanged(this),this.children.push(n))}),(r=this._parent)==null||r.updateBorders(),this)}root(){let e=this;for(;e._parent;)e=e._parent;return e}ungroup(){this.markDeleted=!0;for(let e of this.children.values())e.onParentChanged(null);this.onParentChanged(null)}removeChild(e){this.markDeleted||(this.children=this.children.filter(r=>r.handle!==e.handle),this.children.length===0&&(this._minX=0,this._maxX=0,this._minY=0,this._maxY=0),this.updateBorders())}updateBorders(){var e;if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let r of this.children.values())this._minX=Math.min(this._minX,r.minX()),this._minY=Math.min(this._minY,r.minY()),this._maxX=Math.max(this._maxX,r.maxX()),this._maxY=Math.max(this._maxY,r.maxY());(e=this._parent)==null||e.updateBorders()}}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._minX,i=this._minY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._minX,i=this._minY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var l;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this.onParentMoved(s-this._minX,a-this._minY),(l=this._parent)==null||l.updateBorders(),1}width(){return this._maxX-this._minX}actualWidth(){return this._maxX-this._minX}height(){return this._maxY-this._minY}actualHeight(){return this._maxY-this._minY}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this.width(),n=this.height();return i===0||n===0||(this.onParentResized(this._minX,this._minY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){for(let r of this.children.values())r.setVisibility(e);return 1}itemHandle(e){return e<0||e>=this.children.length?0:this.children[e].handle}addItem(e){let r=this.scene.objects.get(e);return!r||this.children.some(i=>i.handle===e)?0:(r.onParentChanged(this),this.children.push(r),this.updateBorders(),1)}deleteItem(e){let r=this.children.find(i=>i.handle===e);return r?(r.onParentChanged(null),1):0}delete(){this.markDeleted=!0;for(let e of this.children.values())e.delete();this.onParentChanged(null)}getChildByName(e){if(this.name===e)return this.handle;for(let r of this.children.values()){let i=r.getChildByName(e);if(i!==0)return i}return 0}minX(){return this._minX}minY(){return this._minY}maxX(){return this._maxX}maxY(){return this._maxY}onParentChanged(e){var r;if(e!==this._parent){{let i=e;for(;i;){if(i===this)return;i=i._parent}}(r=this._parent)==null||r.removeChild(this),this._parent=e}}onParentMoved(e,r){if(this.children.length!==0){for(let i of this.children.values())i.onParentMoved(e,r);this._minX+=e,this._minY+=r,this._maxX+=e,this._maxY+=r}}onParentResized(e,r,i,n){if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let s of this.children.values())s.onParentResized(e,r,i,n),this._minX=Math.min(this._minX,s.minX()),this._minY=Math.min(this._minY,s.minY()),this._maxX=Math.max(this._maxX,s.maxX()),this._maxY=Math.max(this._maxY,s.maxY())}}onParentRotated(e,r,i){if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let n of this.children.values())n.onParentRotated(e,r,i),this._minX=Math.min(this._minX,n.minX()),this._minY=Math.min(this._minY,n.minY()),this._maxX=Math.max(this._maxX,n.maxX()),this._maxY=Math.max(this._maxY,n.maxY())}}addPoint(){return 0}deletePoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}};var me=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,coords:a,penHandle:l,brushHandle:c}){this.type="line";var O,P;if(a.length<2)throw Error("\u041B\u0438\u043D\u0438\u044F \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u043E\u0447\u0435\u043A");this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.cnv=document.createElement("canvas");let p=this.cnv.getContext("2d",{alpha:!0});if(!p)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=p,this.markDeleted=!1,this.needRedraw=!0,e.dirty=!0;let d=a[0],S=a[1],g=d,y=S;for(let M=2;M<a.length;M+=2){let j=a[M+0],A=a[M+1];j<d&&(d=j),j>g&&(g=j),A<S&&(S=A),A>y&&(y=A)}this.coords=a.slice();for(let M=0;M<a.length;M+=2)this.coords[M+0]-=d,this.coords[M+1]-=S;this._originX=d,this._originY=S,this._width=g-d,this._height=y-S;let _=s||0;this._visible=!0,this._selectable=_&8?0:1;let I=_>>8&31;this._layer=1<<I,this._parent=null,this.pen=e.pens.get(l)||null,this.brush=e.brushes.get(c)||null,(O=this.pen)==null||O.subscribe(this),(P=this.brush)==null||P.subscribe(this)}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var l;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(l=this._parent)==null||l.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}pointOriginX(e){let r=e*2;if(r<0||r>=this.coords.length)return 0;let i=this.scene.invMatrix,n=this.coords[r+0]+this._originX,s=this.coords[r+1]+this._originY,a=n*i[2]+s*i[5]+i[8];return(n*i[0]+s*i[3]+i[6])/a}pointOriginY(e){let r=e*2;if(r<0||r>=this.coords.length)return 0;let i=this.scene.invMatrix,n=this.coords[r+0]+this._originX,s=this.coords[r+1]+this._originY,a=n*i[2]+s*i[5]+i[8];return(n*i[1]+s*i[4]+i[7])/a}updateSize(){var s;let e=Infinity,r=-Infinity,i=Infinity,n=-Infinity;for(let a=0;a<this.coords.length;a+=2){let l=this.coords[a+0],c=this.coords[a+1];l<e&&(e=l),l>r&&(r=l),c<i&&(i=c),c>n&&(n=c)}if(e!==0||i!==0){for(let a=0;a<this.coords.length;a+=2)this.coords[a+0]-=e,this.coords[a+1]-=i;this._originX+=e,this._originY+=i}this._width=r-e,this._height=n-i,(s=this._parent)==null||s.updateBorders(),this.scene.dirty=!0,this.needRedraw=!0}setPointOrigin(e,r,i){let n=e*2;if(n<0||n>=this.coords.length)return 0;let s=this.scene.matrix,a=r*s[2]+i*s[5]+s[8],l=(r*s[0]+i*s[3]+s[6])/a,c=(r*s[1]+i*s[4]+s[7])/a,p=l-this._originX,d=c-this._originY;return this.coords[n+0]=p,this.coords[n+1]=d,this.updateSize(),1}addPoint(e,r,i){if(Math.floor(e)===0)return 0;let n=this.scene.matrix,s=r*n[2]+i*n[5]+n[8],a=(r*n[0]+i*n[3]+n[6])/s,l=(r*n[1]+i*n[4]+n[7])/s,c=a-this._originX,p=l-this._originY,d=e*2;return d<0||d>=this.coords.length?this.coords.push(c,p):this.coords.splice(d,0,c,p),this.updateSize(),1}deletePoint(e){let r=e*2;return e<0||r>this.coords.length?0:(this.coords.splice(r,2),this.updateSize(),1)}pointCount(){return this.coords.length/2}penHandle(){return this.pen?this.pen.handle:0}brushHandle(){return this.brush?this.brush.handle:0}delete(){var e,r,i;(e=this.pen)==null||e.unsubscribe(this),(r=this.brush)==null||r.unsubscribe(this),(i=this._parent)==null||i.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n;for(let s=0;s<this.coords.length;s+=2)this.coords[s+0]*=i,this.coords[s+1]*=n;this._width*=i,this._height*=n,this.needRedraw=!0,this.scene.dirty=!0}onParentRotated(e,r,i){let n=e-this._originX,s=r-this._originY,a=Infinity,l=-Infinity,c=Infinity,p=-Infinity,d=Math.sin(i),S=Math.cos(i);for(let g=0;g<this.coords.length;g+=2){let y=this.coords[g+0]-n,_=this.coords[g+1]-s,I=y*S-_*d+n,O=y*d+_*S+s;this.coords[g+0]=I,this.coords[g+1]=O,I<a&&(a=I),I>l&&(l=I),O<c&&(c=O),O>p&&(p=O)}for(let g=0;g<this.coords.length;g+=2)this.coords[g+0]-=a,this.coords[g+1]-=c;this._originX+=a,this._originY+=c,this._width=l-a,this._height=p-c,this.scene.dirty=!0,this.needRedraw=!0}static drawFigure(e,r,i,n,s,a,l){e.beginPath(),e.moveTo(n[0]+r+l,n[1]+i+l);for(let c=2;c<n.length;c+=2)e.lineTo(n[c]+r+l,n[c+1]+i+l);s&&(e.closePath(),e.fillStyle=s,e.fill("evenodd")),a&&(e.lineWidth=l,e.strokeStyle=a,e.stroke())}render(e,r,i,n){var d,S;if(!this._visible||(this._layer&n)!=0)return;let s=this.pen?this.pen.width()||1:0,a=this._originX-r-s,l=this._originY-i-s,c=this.coords.length>4&&((d=this.brush)==null?void 0:d.fillStyle(e))||null,p=((S=this.pen)==null?void 0:S.strokeStyle())||null;if(!(!c&&!p)){if(this._width*this._height>4194304){this._selectable=0,me.drawFigure(e,a,l,this.coords,c,p,s);return}this.needRedraw&&(this.cnv.width=Math.max(this._width+s*2,1),this.cnv.height=Math.max(this._height+s*2,1),me.drawFigure(this.ctx2,0,0,this.coords,c,p,s),this.needRedraw=!1),e.drawImage(this.cnv,a,l)}}tryClick(e,r,i){if(!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=this.pen?this.pen.width()||1:0,s=e-this._originX,a=r-this._originY;if(!(s<-n||a<-n||s>this._width+n||a>this._height+n)&&this.ctx2.getImageData(s,a,1,1).data[3]!==0)return this._parent?this._parent.root():this}toolChanged(){this.needRedraw=!0,this.scene.dirty=!0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}};var Zt=class{constructor(e,r,i){this.view=e;this.scene=r;this.lastX=i.x-r.originX(),this.lastY=i.y-r.originY(),e.style.setProperty("position","absolute"),e.style.setProperty("left",this.lastX+"px"),e.style.setProperty("top",this.lastY+"px"),e.style.setProperty("width",i.w+"px"),e.style.setProperty("height",i.h+"px"),r.view.appendChild(e)}close(){this.view.remove()}moveTo(e,r){let i=e-this.scene.originX(),n=r-this.scene.originY();(i!==this.lastX||n!==this.lastY)&&(this.lastX=i,this.lastY=n,this.view.style.setProperty("left",i+"px"),this.view.style.setProperty("top",n+"px"))}};var Ye=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,originX:a,originY:l,width:c,height:p,angle:d,textToolHandle:S}){this.type="text";var _;this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.markDeleted=!1,e.dirty=!0,this.textTool=e.texts.get(S)||null,(_=this.textTool)==null||_.subscribe(this),this._originX=a,this._originY=l,this._angle=d/-10*Math.PI/180,this._width=c||this.actualWidth(),this._height=p||this.actualHeight();let g=s||0;this._visible=!0,this._selectable=g&8?0:1;let y=g>>8&31;this._layer=1<<y,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var l;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(l=this._parent)==null||l.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}height(){return this._height}actualWidth(){var e;return((e=this.textTool)==null?void 0:e.width())||0}actualHeight(){var e;return((e=this.textTool)==null?void 0:e.height())||0}setSize(e,r){var i;return e<0||r<0?0:(this._width=e,this._height=r,(i=this._parent)==null||i.updateBorders(),this.scene.dirty=!0,1)}angle(){return this._angle}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}textToolHandle(){return this.textTool?this.textTool.handle:0}delete(){var e,r;(e=this.textTool)==null||e.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,l=this._originY-r,c=a*s-l*n,p=a*n+l*s;this._originX=c+e,this._originY=p+r,this._angle+=i,this.scene.dirty=!0}render(e,r,i,n){if(!this.textTool||!this._visible||(this._layer&n)!=0)return;let s=this._originX-r,a=this._originY-i;this.textTool.render(e,s,a,this._width,this._height,this._angle)}tryClick(e,r,i){if(!this.textTool||!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=Math.sin(-this._angle),s=Math.cos(-this._angle),a=e-this._originX,l=r-this._originY,c=a*s-l*n,p=a*n+l*s;if(!(c<0||p<0||c>this._width||p>this._height))return this._parent?this._parent.root():this}addPoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}};var Ge=class{constructor(e,{handle:r,color:i,hatch:n,rop2:s,style:a,dibHandle:l}){var c;this.handle=r,this.subs=new Set,this._color=i,this._cssColor=re(i),this._style=a,this._hatch=n,this._rop=s,this._dibTool=l&&e.dibs.get(l)||null,(c=this._dibTool)==null||c.subscribe(this),this.scene=e}toolChanged(){this.subs.forEach(e=>e.toolChanged())}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}dibTool(){return this._dibTool}setDIB(e){var r,i;return(r=this._dibTool)==null||r.unsubscribe(this),this._dibTool=this.scene.dibs.get(e)||null,(i=this._dibTool)==null||i.subscribe(this),this.subs.forEach(n=>n.toolChanged()),1}dibHandle(){var e;return((e=this._dibTool)==null?void 0:e.handle)||0}color(){return this._color}setColor(e){return this._color=e,this._cssColor=re(e),this.subs.forEach(r=>r.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged()),1}hatch(){return this._hatch}setHatch(e){return this._hatch=e,1}rop(){return this._rop}setRop(e){return this._rop=e,1}fillStyle(e){var r,i;switch(this._style){case D.BS_SOLID:return this._cssColor;case D.BS_NULL:return null;case D.BS_PATTERN:return(i=(r=this.dibTool())==null?void 0:r.pattern(e))!=null?i:"white";default:return"white"}}};var Se=class{static loadBitmap(e){let r=Se.promises.get(e);if(r)return r;let i=new Promise(n=>{let s=new Image;s.addEventListener("load",()=>{let a=document.createElement("canvas"),l=a.getContext("2d",{alpha:!1});if(!l||s.width===0||s.height===0){n(null);return}a.width=s.width,a.height=s.height,l.drawImage(s,0,0),n(l)}),s.addEventListener("error",()=>n(null)),s.src=e});return this.promises.set(e,i),i}static loadDBM(e){let r=Se.promises.get(e);if(r)return r;let i=new Promise(n=>C(this,null,function*(){let a=yield(yield fetch(e,{cache:"force-cache"})).arrayBuffer(),l=xe(new Z(a,e));n(l)}));return Se.promises.set(e,i),i}constructor(e){if(this.handle=e.handle,this._pattern=null,this.subs=new Set,e.type==="image")this.img=e.img;else{this.img=null;let r=G.iconsLocation;if(!r)return;let i=`${r.endsWith("/")?r:r+"/"}${e.filename.toUpperCase()}`;(e.type==="BMPReference"?Se.loadBitmap:Se.loadDBM)(i).then(s=>{this.img=s,this.subs.forEach(a=>a.toolChanged())})}}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}getPixel(e,r){if(!this.img)return 0;let i=this.img.getImageData(e,r,1,1).data;return ke(i[0],i[1],i[2],0)}setPixel(e,r,i){if(!this.img)return 1;let n=this.img.createImageData(1,1),s=n.data;return s[0]=bt(i),s[1]=pt(i),s[2]=dt(i),s[3]=255,this.img.putImageData(n,e,r),this.subs.forEach(a=>a.toolChanged()),1}pattern(e){return this.img?this._pattern?this._pattern:this._pattern=e.createPattern(this.img.canvas,"repeat"):null}render(e,r,i,n,s,a,l,c,p){this.img&&e.drawImage(this.img.canvas,r,i,n,s,a,l,c,p)}tryClick(e,r){return this.img?this.img.getImageData(e,r,1,1).data[3]!==0:!1}width(){var e,r;return(r=(e=this.img)==null?void 0:e.canvas.width)!=null?r:0}height(){var e,r;return(r=(e=this.img)==null?void 0:e.canvas.height)!=null?r:0}},ne=Se;ne.promises=new Map;var ze=class{constructor({handle:e,fontName:r,height:i,italic:n,underline:s,strikeOut:a,weight:l}){this.handle=e,this.subs=new Set,this._name=r,this._size=i||0,this._size*=this._size<0?-1:1,this._style=(n?1:0)|(s?2:0)|(a?4:0)|(l?8:0),this._cssName=r.toUpperCase().endsWith(" CYR")?r.slice(0,r.length-4):r}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}name(){return this._name}setName(e){return this._name=e,this._cssName=e.endsWith(" CYR")?e.slice(0,e.length-4):e,this.subs.forEach(r=>r.toolChanged()),1}size(){return this._size}setSize(e){return this._size=e,this.subs.forEach(r=>r.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged()),1}underline(){return!!(this._style&2)}strikeOut(){return!!(this._style&4)}toCSSString(){return`${this._style&8?"bold":""} ${this._style&1?"italic":""} ${this._size}px ${this._cssName}`}};var Ze=class{constructor({handle:e,color:r,rop2:i,style:n,width:s}){this.handle=e,this.subs=new Set,this._color=r,this._cssColor=re(r),this._width=s,this._style=n,this._rop=i}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}color(){return this._color}setColor(e){return this._color=e,this._cssColor=re(e),this.subs.forEach(r=>r.toolChanged()),1}width(){return this._width}setWidth(e){return this._width=e,this.subs.forEach(r=>r.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged()),1}rop(){return this._rop}setRop(e){return this._rop=e,1}strokeStyle(){return this._style===D.PS_NULL?null:this._cssColor}};var Ke=class{constructor({handle:e,text:r}){this.handle=e,this.subs=new Set,this._text=r}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}text(){return this._text}setText(e){return this._text=e,this.subs.forEach(r=>r.toolChanged()),1}};var Qe=class{constructor(e,{handle:r,textCollection:i}){this.handle=r,this.subs=new Set,this.scene=e,this.cnv=document.createElement("canvas");let n=this.cnv.getContext("2d",{alpha:!0});if(!n)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=n,this.needUpdatePrepared=!0,this.needRedraw=!0,this.textCollection=i.map(s=>{let a=e.fonts.get(s.fontHandle)||null;a==null||a.subscribe(this);let l=e.strings.get(s.stringHandle)||null;return l==null||l.subscribe(this),{font:a,string:l,fgColor:s.fgColor,bgColor:s.bgColor}}),this.prepared=[],this._width=0,this._height=0}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}toolChanged(){this.needRedraw=!0,this.needUpdatePrepared=!0,this.subs.forEach(e=>e.toolChanged())}textCount(){return this.textCollection.length}fontHandle(e){if(e<0||e>=this.textCollection.length)return 0;let r=this.textCollection[e].font;return r?r.handle:0}stringHandle(e){if(e<0||e>=this.textCollection.length)return 0;let r=this.textCollection[e].string;return r?r.handle:0}fgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].fgColor}bgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].bgColor}updatePrepared(){if(!this.needUpdatePrepared)return;let e=this.ctx2,r=[],i=0,n=0,s=0,a=0,l=[];for(let c of this.textCollection){let p=c.font,d=c.string;if(!p||!d)continue;let S=re(c.fgColor),g=re(c.bgColor),y=p.toCSSString(),_=p.size(),I=d.text().split(`
`);e.font=y;let O=!1;for(let P of I){O&&(r.push({row:l,height:a}),n=Math.max(n,s),i+=a,l=[],s=0,a=0);let M=e.measureText(P).width;l.push({elem:P,font:y,width:M,height:_,fgColor:S,bgColor:g,underline:p.underline(),strikeout:p.strikeOut()}),s+=M,O=!0,a=Math.max(a,_)}}r.push({row:l,height:a}),n=Math.max(n,s),i+=a,this._width=n*1.01,this._height=i*1.01,this.prepared=r,this.needUpdatePrepared=!1}redraw(){if(!this.needRedraw)return;this.updatePrepared(),this.cnv.width=Math.max(this._width,1),this.cnv.height=Math.max(this._height,1);let e=this.ctx2,r=0,i=0;for(let{row:n,height:s}of this.prepared){r=0,i+=s;for(let{elem:a,font:l,width:c,height:p,bgColor:d,fgColor:S,underline:g,strikeout:y}of n){e.font=l,e.textAlign="left",e.textBaseline="ideographic";let _=p,I=(s-_)/4;e.fillStyle=d,e.fillRect(r,i-_-I,c,_),e.fillStyle=S;let O=i-I+_/15;e.fillText(a,r,O);let P=_/20;y&&e.fillRect(r,i-_/2.5,c,P),g&&e.fillRect(r,i-P,c,P),r+=c}}this.needRedraw=!1}render(e,r,i,n,s,a){this.redraw(),!(this.cnv.width===0||this.cnv.height===0)&&(e.save(),e.translate(r,i),e.rotate(a),e.drawImage(this.cnv,0,0,n*1.02,s*1.02,0,0,n*1.02,s*1.02),e.restore())}width(){return this.updatePrepared(),this._width}height(){return this.updatePrepared(),this._height}setValues(e,r,i,n,s){var l,c,p,d;if(e<0||e>=this.textCollection.length)return 0;let a=this.textCollection[e];if(r>0&&((l=a.font)==null?void 0:l.handle)!==r){(c=a.font)==null||c.unsubscribe(this);let S=this.scene.fonts.get(r)||null;S==null||S.subscribe(this),a.font=S}if(i>0&&((p=a.string)==null?void 0:p.handle)!==i){(d=a.string)==null||d.unsubscribe(this);let S=this.scene.strings.get(i)||null;S==null||S.subscribe(this),a.string=S}return a.fgColor=n,a.bgColor=s,this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(S=>S.toolChanged()),1}};var Ae=class{constructor({wnd:e,vdr:r,sizeInfo:i}){this.lastViewW=0;this.lastViewH=0;this.capture=null;this.sizeSubs=new Set;this.controlNotifySubs=new Map;this.moveSubs=new Map;this.leftButtonUpSubs=new Map;this.leftButtonDownSubs=new Map;this.rightButtonUpSubs=new Map;this.rightButtonDownSubs=new Map;this.middleButtonUpSubs=new Map;this.middleButtonDownSubs=new Map;this._unsub=new Set;this._unsubS=0;this.blocked=!1;var p,d,S,g,y,_,I,O,P,M,j;this.wnd=e,this.sizeInfo=i,this.dirty=!0,this.hyperHandler=null;let n=this.view=document.createElement("div");n.style.setProperty("overflow","hidden"),n.style.setProperty("position","relative"),i.resizable?(n.style.setProperty("width","100%"),n.style.setProperty("height","100%")):(n.style.setProperty("width",i.width+"px"),n.style.setProperty("height",i.height+"px"));let s=document.createElement("canvas");s.style.setProperty("touch-action","pinch-zoom"),s.addEventListener("pointerdown",this),s.addEventListener("pointerup",this),s.addEventListener("pointerleave",this),s.addEventListener("pointermove",this),s.addEventListener("selectstart",this),n.appendChild(s);let a=s.getContext("2d");if(!a)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");if(this.ctx=a,!r){this._originX=0,this._originY=0,this._scale=1,this.layers=0,this.objects=new Map,this.primaryObjects=[],this.pens=new Map,this.brushes=new Map,this.dibs=new Map,this.doubleDibs=new Map,this.strings=new Map,this.fonts=new Map,this.texts=new Map,this.matrix=[1,0,0,0,1,0,0,0,1],this.invMatrix=[1,0,0,0,1,0,0,0,1],this.brush=null;return}this.pens=new Map((p=r.penTools)==null?void 0:p.map(A=>[A.handle,new Ze(A)])),this.dibs=new Map((d=r.dibTools)==null?void 0:d.map(A=>[A.handle,new ne(A)])),this.brushes=new Map((S=r.brushTools)==null?void 0:S.map(A=>[A.handle,new Ge(this,A)])),this.doubleDibs=new Map((g=r.doubleDibTools)==null?void 0:g.map(A=>[A.handle,new ne(A)])),this.strings=new Map((y=r.stringTools)==null?void 0:y.map(A=>[A.handle,new Ke(A)])),this.fonts=new Map((_=r.fontTools)==null?void 0:_.map(A=>[A.handle,new ze(A)])),this.texts=new Map((I=r.textTools)==null?void 0:I.map(A=>[A.handle,new Qe(this,A)])),this.brush=r.brushHandle>0&&this.brushes.get(r.brushHandle)||null,(O=this.brush)==null||O.subscribe(this),this.matrix=((P=r.crdSystem)==null?void 0:P.matrix.slice())||[1,0,0,0,1,0,0,0,1],this.invMatrix=r.crdSystem?Ae.getInversedMatrix(this.matrix):[1,0,0,0,1,0,0,0,1],this._originX=r.origin.x,this._originY=r.origin.y,this.layers=r.layers,this._scale=1;let l=new Set,c=A=>{switch(A.type){case"group":let Q=new Ne(this,A);return l.add({g:Q,h:A.childHandles}),[A.handle,Q];case"line":return[A.handle,new me(this,A)];case"text":return[A.handle,new Ye(this,A)];case"control":return[A.handle,new Xe(this,A)];case"bitmap":case"doubleBitmap":return[A.handle,new Ce(this,A)];case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}};this.objects=new Map((M=r.elements)==null?void 0:M.map(c)),l.forEach(A=>A.g.addChildren(A.h)),this.primaryObjects=[],(j=r.elementOrder)==null||j.forEach(A=>{let Q=this.objects.get(A);!Q||Q.type==="group"||this.primaryObjects.push(Q)})}static getInversedMatrix(e){let r=e[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]);return[(e[4]*e[8]-e[7]*e[5])/r,(e[2]*e[7]-e[1]*e[8])/r,(e[1]*e[5]-e[2]*e[4])/r,(e[5]*e[6]-e[3]*e[8])/r,(e[0]*e[8]-e[2]*e[6])/r,(e[3]*e[2]-e[0]*e[5])/r,(e[3]*e[7]-e[6]*e[4])/r,(e[6]*e[1]-e[0]*e[7])/r,(e[0]*e[4]-e[3]*e[1])/r]}setHyper(e,r){let i=this.objects.get(e);return i?(i.hyperbase=r,1):0}tryHyper(e,r,i){var d;if(!this.hyperHandler)return;let n=i||this.getObjectFromPoint2d(e,r),s=(d=this.objects.get(n))==null?void 0:d.hyperbase;if(!s)return;let a=this.matrix,l=e*a[2]+r*a[5]+a[8],c=(e*a[0]+r*a[3]+a[6])/l-this._originX,p=(e*a[1]+r*a[4]+a[7])/l-this._originY;this.hyperHandler.click(s,{x:c,y:p})}setBrush(e){var r,i;return(r=this.brush)==null||r.unsubscribe(this),this.brush=this.brushes.get(e)||null,(i=this.brush)==null||i.subscribe(this),this.dirty=!0,1}brushHandle(){var e;return((e=this.brush)==null?void 0:e.handle)||0}clear(){throw new Error("Method not implemented.")}toolChanged(){this.dirty=!0}render(){var n;let e=this.view.clientWidth,r=this.view.clientHeight,i=this.ctx;if(e!==this.lastViewW||r!==this.lastViewH){this.lastViewW=e,this.lastViewH=r;let s=i.canvas;s.style.setProperty("width",e+"px"),s.style.setProperty("height",r+"px"),s.width=e,s.height=r,this.dirty=!0,this.sizeInfo.resizable&&this.sizeSubs.forEach(a=>a.receive(D.WM_SIZE,e,r))}!this.dirty||e<1||r<1||(this.dirty=!1,i.fillStyle=((n=this.brush)==null?void 0:n.fillStyle(i))||"white",i.fillRect(0,0,e,r),this.primaryObjects.forEach(s=>s.render(i,this._originX,this._originY,this.layers)))}width(){let e=this.sizeInfo;return e.resizable?this.lastViewW:e.width}height(){let e=this.sizeInfo;return e.resizable?this.lastViewH:e.height}setSize(e,r){this.sizeInfo.resizable||(this.sizeInfo.width=e,this.sizeInfo.height=r,this.view.style.setProperty("width",e+"px"),this.view.style.setProperty("height",r+"px"),this.sizeSubs.forEach(i=>i.receive(D.WM_SIZE,e,r)))}originX(){return this._originX}originY(){return this._originY}setOrigin(e,r){return this._originX=e,this._originY=r,this.dirty=!0,1}scale(){return this._scale}setScale(e){return this._scale=e,1}createLine(e,r,i){let n=H.getFreeHandle(this.objects),s=this.matrix,a=new Array(e.length);for(let c=0;c<e.length;c+=2){let p=e[c],d=e[c+1],S=p*s[2]+d*s[5]+s[8];a[c]=(p*s[0]+d*s[3]+s[6])/S,a[c+1]=(p*s[1]+d*s[4]+s[7])/S}let l=new me(this,{handle:n,penHandle:r,brushHandle:i,coords:a});return this.objects.set(n,l),this.primaryObjects.push(l),n}createBitmap(e,r,i,n){let s=this.matrix,a=e*s[2]+r*s[5]+s[8],l=(e*s[0]+r*s[3]+s[6])/a,c=(e*s[1]+r*s[4]+s[7])/a,p=H.getFreeHandle(this.objects),d=new Ce(this,{handle:p,originX:l,originY:c,type:n?"doubleBitmap":"bitmap",dibHandle:i});return this.objects.set(p,d),this.primaryObjects.push(d),p}createText(e,r,i,n){let s=this.matrix,a=e*s[2]+r*s[5]+s[8],l=(e*s[0]+r*s[3]+s[6])/a,c=(e*s[1]+r*s[4]+s[7])/a,p=H.getFreeHandle(this.objects),d=new Ye(this,{handle:p,originX:l,originY:c,angle:i,textToolHandle:n});return this.objects.set(p,d),this.primaryObjects.push(d),p}createControl(e,r,i,n,s,a,l){let c=s.toUpperCase();if(c!=="EDIT"&&c!=="BUTTON"&&c!=="COMBOBOX")return 0;let p=this.matrix,d=e*p[2]+r*p[5]+p[8],S=(e*p[0]+r*p[3]+p[6])/d,g=(e*p[1]+r*p[4]+p[7])/d,y=H.getFreeHandle(this.objects),_=new Xe(this,{handle:y,originX:S,originY:g,width:i,height:n,inputType:c,text:a});return this.objects.set(y,_),this.primaryObjects.push(_),y}createGroup(e){let r=H.getFreeHandle(this.objects),i=new Ne(this,{handle:r}).addChildren(e);return this.objects.set(r,i),r}insertVectorDrawing(e,r,i,n){var M,j,A,Q,$e,tt,rt,it;if(!n.elements)return 0;let s=this.pens,a=this.dibs,l=this.brushes,c=this.doubleDibs,p=this.strings,d=this.fonts,S=this.texts,g=this.objects;this.pens=new Map((M=n.penTools)==null?void 0:M.map(v=>[v.handle,new Ze(v)])),this.dibs=new Map((j=n.dibTools)==null?void 0:j.map(v=>[v.handle,new ne(v)])),this.brushes=new Map((A=n.brushTools)==null?void 0:A.map(v=>[v.handle,new Ge(this,v)])),this.doubleDibs=new Map((Q=n.doubleDibTools)==null?void 0:Q.map(v=>[v.handle,new ne(v)])),this.strings=new Map(($e=n.stringTools)==null?void 0:$e.map(v=>[v.handle,new Ke(v)])),this.fonts=new Map((tt=n.fontTools)==null?void 0:tt.map(v=>[v.handle,new ze(v)])),this.texts=new Map((rt=n.textTools)==null?void 0:rt.map(v=>[v.handle,new Qe(this,v)]));let y=new Set,_=v=>{switch(v.type){case"group":let U=new Ne(this,v);return y.add({g:U,h:v.childHandles}),[v.handle,U];case"line":return[v.handle,new me(this,v)];case"text":return[v.handle,new Ye(this,v)];case"control":return[v.handle,new Xe(this,v)];case"bitmap":case"doubleBitmap":return[v.handle,new Ce(this,v)];case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}},I=n.elements.map(_);this.objects=new Map(I),y.forEach(v=>v.g.addChildren(v.h)),(it=n.elementOrder)==null||it.forEach(v=>{let U=this.objects.get(v);!U||U.type==="group"||this.primaryObjects.push(U)});let O=I.filter(v=>v[1].parentHandle()===0).map(v=>v[1].handle);if(O.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");let P;if(O.length>1){let v=H.getFreeHandle(this.objects),U=new Ne(this,{handle:v}).addChildren(O);this.objects.set(v,U),P=U}else P=this.objects.values().next().value;return P.setOrigin(e,r),this.pens.forEach(v=>{let U=H.getFreeHandle(s);v.handle=U,s.set(U,v)}),this.dibs.forEach(v=>{let U=H.getFreeHandle(a);v.handle=U,a.set(U,v)}),this.brushes.forEach(v=>{let U=H.getFreeHandle(l);v.handle=U,l.set(U,v)}),this.doubleDibs.forEach(v=>{let U=H.getFreeHandle(c);v.handle=U,c.set(U,v)}),this.strings.forEach(v=>{let U=H.getFreeHandle(p);v.handle=U,p.set(U,v)}),this.fonts.forEach(v=>{let U=H.getFreeHandle(d);v.handle=U,d.set(U,v)}),this.texts.forEach(v=>{let U=H.getFreeHandle(S);v.handle=U,S.set(U,v)}),this.objects.forEach(v=>{let U=H.getFreeHandle(g);v.handle=U,g.set(U,v)}),this.pens=s,this.dibs=a,this.brushes=l,this.doubleDibs=c,this.strings=p,this.fonts=d,this.texts=S,this.objects=g,P.handle}frame(e,r){return new Zt(e,this,r)}deleteObject(e){let r=this.objects.get(e);return r?(r.delete(),this.objects=new Map([...this.objects].filter(i=>!i[1].markDeleted)),this.primaryObjects=this.primaryObjects.filter(i=>!i.markDeleted),1):0}deleteGroup2d(e){let r=this.objects.get(e);return!r||r.type!=="group"?0:(r.ungroup(),this.objects.delete(e),1)}topObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[0].handle:0}bottomObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[this.primaryObjects.length-1].handle:0}objectFromZOrder(e){let r=e-1;return r<0||r>=this.primaryObjects.length?0:this.primaryObjects[r].handle}objectZOrder(e){for(let r=0;r<this.primaryObjects.length;++r)if(this.primaryObjects[r].handle===e)return r+1;return 0}lowerObjectHandle(e){let r=this.primaryObjects.findIndex(i=>i.handle===e);return r<1?0:this.primaryObjects[r-1].handle}upperObjectHandle(e){let r=this.primaryObjects.findIndex(i=>i.handle===e);return r<0||r>=this.primaryObjects.length-1?0:this.primaryObjects[r+1].handle}objectToTop(e){let r=this.primaryObjects.find(i=>i.handle===e);return r?(this.primaryObjects=[...this.primaryObjects.filter(i=>i!==r),r],this.dirty=!0,1):0}objectToBottom(e){let r=this.primaryObjects.find(i=>i.handle===e);return r?(this.primaryObjects=[r,...this.primaryObjects.filter(i=>i!==r)],this.dirty=!0,1):0}swapObjects(e,r){let i=this.primaryObjects.findIndex(a=>a.handle===e);if(i<0)return 0;let n=this.primaryObjects.findIndex(a=>a.handle===r);if(n<0)return 0;let s=this.primaryObjects[i];return this.primaryObjects[i]=this.primaryObjects[n],this.primaryObjects[n]=s,this.dirty=!0,1}setObjectZOrder(e,r){let i=r-1;if(i<0)return 0;let n=this.primaryObjects.find(a=>a.handle===e);if(!n)return 0;let s=[];for(let a=0;a<this.primaryObjects.length;++a){a===i&&s.push(n);let l=this.primaryObjects[a];l!==n&&s.push(l)}return i>=this.primaryObjects.length&&s.push(n),this.primaryObjects=s,this.dirty=!0,1}objectName(e){var r;return((r=this.objects.get(e))==null?void 0:r.name)||""}setObjectName(e,r){let i=this.objects.get(e);return i?(i.name=r,1):0}getObject2dByName(e,r){if(r==="")return 0;if(e){let i=this.objects.get(e);return i?i.getChildByName(r):0}for(let i of this.objects.values())if(i.name===r)return i.handle;return 0}getObjectInRealCoords(e,r){for(let i=this.primaryObjects.length-1;i>=0;--i){let n=this.primaryObjects[i].tryClick(e,r,this.layers);if(n)return n}return null}getObjectFromPoint2d(e,r){var l,c;let i=this.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return(c=(l=this.getObjectInRealCoords(s,a))==null?void 0:l.handle)!=null?c:0}isIntersect(e,r){let i=this.objects.get(e);if(!i)return 0;let n=this.objects.get(r);return n&&i.maxX()>=n.minX()&&n.maxX()>=i.minX()&&i.maxY()>=n.minY()&&n.maxY()>=i.minY()?1:0}createPenTool(e,r,i,n){let s=H.getFreeHandle(this.pens);return this.pens.set(s,new Ze({handle:s,color:i,width:r,rop2:n,style:e})),s}createBrushTool(e,r,i,n,s){let a=H.getFreeHandle(this.brushes);return this.brushes.set(a,new Ge(this,{handle:a,color:i,hatch:r,dibHandle:n,style:e,rop2:s})),a}createDIBTool(e){let r=H.getFreeHandle(this.dibs);return this.dibs.set(r,new ne({handle:r,type:"image",img:e})),r}createDoubleDIBTool(e){let r=H.getFreeHandle(this.doubleDibs);return this.doubleDibs.set(r,new ne({handle:r,type:"image",img:e})),r}createStringTool(e){let r=H.getFreeHandle(this.strings);return this.strings.set(r,new Ke({handle:r,text:e})),r}createFontTool(e,r,i){let n=H.getFreeHandle(this.fonts),s=i&1,a=i&2,l=i&4,c=i&8;return this.fonts.set(n,new ze({handle:n,fontName:e,height:-r,italic:s,underline:a,strikeOut:l,weight:c})),n}createTextTool(e,r,i,n){let s=H.getFreeHandle(this.texts);return this.texts.set(s,new Qe(this,{handle:s,textCollection:[{fgColor:i,bgColor:n,fontHandle:e,stringHandle:r}]})),s}setCapture(e){this.capture=e}releaseCapture(){this.capture=null}on(e,r,i){switch(r){case D.WM_SIZE:this.sizeSubs.add(e);break;case D.WM_CONTROLNOTIFY:this.controlNotifySubs.set(e,i);break;case D.WM_MOUSEMOVE:this.moveSubs.set(e,i);break;case D.WM_LBUTTONDOWN:this.leftButtonDownSubs.set(e,i);break;case D.WM_LBUTTONUP:this.leftButtonUpSubs.set(e,i);break;case D.WM_RBUTTONDOWN:this.rightButtonDownSubs.set(e,i);break;case D.WM_RBUTTONUP:this.rightButtonUpSubs.set(e,i);break;case D.WM_MBUTTONDOWN:this.middleButtonDownSubs.set(e,i);break;case D.WM_MBUTTONUP:this.middleButtonUpSubs.set(e,i);break;case D.WM_ALLMOUSEMESSAGE:this.moveSubs.set(e,i),this.leftButtonDownSubs.set(e,i),this.leftButtonUpSubs.set(e,i),this.rightButtonDownSubs.set(e,i),this.rightButtonUpSubs.set(e,i),this.middleButtonDownSubs.set(e,i),this.middleButtonUpSubs.set(e,i);break;default:this._unsub.add(D[r]),this._unsub.size>this._unsubS&&(this._unsubS=this._unsub.size,console.warn(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${D[r]} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`));break}}off(e,r){switch(r){case D.WM_SIZE:this.sizeSubs.delete(e);break;case D.WM_CONTROLNOTIFY:this.controlNotifySubs.delete(e);break;case D.WM_MOUSEMOVE:this.moveSubs.delete(e);break;case D.WM_LBUTTONDOWN:this.leftButtonDownSubs.delete(e);break;case D.WM_LBUTTONUP:this.leftButtonUpSubs.delete(e);break;case D.WM_RBUTTONDOWN:this.rightButtonDownSubs.delete(e);break;case D.WM_RBUTTONUP:this.rightButtonUpSubs.delete(e);break;case D.WM_MBUTTONDOWN:this.middleButtonDownSubs.delete(e);break;case D.WM_MBUTTONUP:this.middleButtonUpSubs.delete(e);break;case D.WM_ALLMOUSEMESSAGE:this.moveSubs.delete(e),this.leftButtonDownSubs.delete(e),this.leftButtonUpSubs.delete(e),this.rightButtonDownSubs.delete(e),this.rightButtonUpSubs.delete(e),this.middleButtonDownSubs.delete(e),this.middleButtonUpSubs.delete(e);break}}handleEvent(e){var _,I;if(e.type==="selectstart"){e.preventDefault();return}let r=e.currentTarget.getBoundingClientRect(),i=e.clientX-r.left,n=e.clientY-r.top,s=i+this._originX,a=n+this._originY,l=e.buttons&1?1:0,c=e.buttons&2?2:0,p=e.buttons&4?16:0,d=l|c|p;Ae.keyState[1]=l,Ae.keyState[2]=c,Ae.keyState[4]=p;let S=this.getObjectInRealCoords(s,a),g=(_=S==null?void 0:S.handle)!=null?_:0,y=S==null?void 0:S.hyperbase;switch(this.ctx.canvas.style.cursor=y?"pointer":"default",e.type){case"pointerdown":{switch(this.blocked=!0,e.button){case 0:(I=this.hyperHandler)==null||I.click(y!=null?y:null,{x:i,y:n}),this.dispatchMouseEvent(this.leftButtonDownSubs,g,D.WM_LBUTTONDOWN,s,a,d);return;case 1:this.dispatchMouseEvent(this.middleButtonDownSubs,g,D.WM_MBUTTONDOWN,s,a,d);return;case 2:this.dispatchMouseEvent(this.rightButtonDownSubs,g,D.WM_RBUTTONDOWN,s,a,d);return}return}case"pointerup":{switch(e.button){case 0:this.dispatchMouseEvent(this.leftButtonUpSubs,g,D.WM_LBUTTONUP,s,a,d);return;case 1:this.dispatchMouseEvent(this.middleButtonUpSubs,g,D.WM_MBUTTONUP,s,a,d);return;case 2:this.dispatchMouseEvent(this.rightButtonUpSubs,g,D.WM_RBUTTONUP,s,a,d);return}return}case"pointerleave":{this.dispatchMouseEvent(this.leftButtonUpSubs,g,D.WM_LBUTTONUP,s,a,0);return}case"pointermove":if(this.blocked){this.blocked=!1;return}this.dispatchMouseEvent(this.moveSubs,g,D.WM_MOUSEMOVE,s,a,d);return}}dispatchMouseEvent(e,r,i,n,s,a){let l=this.invMatrix,c=n*l[2]+s*l[5]+l[8],p=(n*l[0]+s*l[3]+l[6])/c,d=(n*l[1]+s*l[4]+l[7])/c;if(this.capture){this.capture.receive(i,p,d,a);return}for(let[S,g]of e)(g===0||g===r)&&S.receive(i,p,d,a)}dispatchControlNotifyEvent(e,r){let i=0;switch(r.type){case"input":i=768;break;default:return}for(let[n,s]of this.controlNotifySubs)(s===0||s===e)&&n.receive(D.WM_CONTROLNOTIFY,e,0,i)}},ye=Ae;ye.keyState=new Uint8Array(256);var yi=["brushTools","penTools","dibTools","doubleDibTools","fontTools","stringTools","textTools"];function Me(t){if(!!t)return t.map(e=>L({},e))}function Ei(t){var r,i;let e=L({},t);return e.brushTools=Me(t.brushTools),e.penTools=Me(t.penTools),e.dibTools=Me(t.dibTools),e.doubleDibTools=Me(t.doubleDibTools),e.fontTools=Me(t.fontTools),e.stringTools=Me(t.stringTools),e.textTools=(r=t.textTools)==null?void 0:r.map(n=>L(L({},n),{textCollection:n.textCollection.map(s=>L({},s))})),e.elements=(i=t.elements)==null?void 0:i.map(n=>n.type==="group"?L(L({},n),{childHandles:n.childHandles.slice()}):L({},n)),e.elementOrder=t.elementOrder&&t.elementOrder.slice(),e}function Ii(t,e){let r=t.find(i=>i.handle===e);if(!r||r.type!=="group")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${e}`);return r}function Ri(t,e){let r=e.childHandles[0],i=t.find(n=>n.handle===r);if(!i||i.type!=="doubleBitmap")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0438\u043A\u043E\u043D\u043A\u0438 \u0438\u043C\u0438\u0434\u0436\u0430 #${e.handle}`);return i}function ga(t,e){let r=new Map,i=1;for(let n of e){for(;t.some(s=>s.handle===i);)++i;r.set(n.handle,i),n.handle=i,t.push(n)}return r}function _a(t,e){let r={};for(let i of yi){let n=e[i];if(!n)continue;let s=t[i];if(!s){t[i]=n;continue}r[i]=ga(s,n)}return r}function be(t,e,r){if(!!t)for(let i of t){let n=i[e];i[e]=r.get(n)||n}}function Ta(t,e,r){switch(e){case"fontTools":{let{textTools:i}=t;i&&i.forEach(n=>be(n.textCollection,"fontHandle",r));break}case"stringTools":{let{textTools:i}=t;i&&i.forEach(n=>be(n.textCollection,"stringHandle",r));break}case"dibTools":{be(t.brushTools,"dibHandle",r);break}}}function wa(t,e,r){switch(e){case"brushTools":let i=t.filter(c=>c.type==="line");be(i,"brushHandle",r);break;case"penTools":let n=t.filter(c=>c.type==="line");be(n,"penHandle",r);break;case"dibTools":let s=t.filter(c=>c.type==="bitmap");be(s,"dibHandle",r);break;case"doubleDibTools":let a=t.filter(c=>c.type==="doubleBitmap");be(a,"dibHandle",r);break;case"textTools":let l=t.filter(c=>c.type==="text");be(l,"textToolHandle",r);break}}function Sa(t,e){for(let r of yi){let i=e[r];!i||(Ta(t,r,i),t.elements&&wa(t.elements,r,i))}}function ya(t){let e,r;for(let i of t)i.type!=="group"&&((e===void 0||i.originX<e)&&(e=i.originX),(r===void 0||i.originY<r)&&(r=i.originY));return{x:e||0,y:r||0}}function Ea(t,e){return t.some(r=>r.type==="group"&&r.childHandles.includes(e.handle))}function Ia(t,e,r){let i=new Map;if(e.length===0)return{map:i,rootHandle:0};let n=1,s=[];for(let l of e){for(;t.some(c=>c.handle===n);)++n;if(Ea(e,l)||s.push(n),i.set(l.handle,n),l.handle=n,t.push(l),l.type!=="group"&&(l.originX+=r.x,l.originY+=r.y,l.type==="line")){l.coords=l.coords.slice();for(let c=0;c<l.coords.length;c+=2)l.coords[c+0]+=r.x,l.coords[c+1]+=r.y}}if(s.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u044A\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F \u0438\u043C\u0438\u0434\u0436\u0435\u0439");if(s.length===1)return{map:i,rootHandle:s[0]};for(;t.some(l=>l.handle===n);)++n;let a={type:"group",handle:n,childHandles:s,options:0};return t.push(a),{map:i,rootHandle:a.handle}}function Ra(t,e){for(let r of t)r.type==="group"&&(r.childHandles=r.childHandles.map(i=>e.get(i)||i))}function va(t,e){return t.map(r=>e.get(r)||r)}function Da(t){return t.elements!==void 0&&t.elements.length>0}var Je=class{static calcRect(e){if(e.length===0)return{x:0,y:0,w:0,h:0};let r=Infinity,i=-Infinity,n=Infinity,s=-Infinity;return e.forEach(a=>{a.type!=="group"&&(a.originX<r&&(r=a.originX),a.originX+a.width>i&&(i=a.originX+a.width),a.originY<n&&(n=a.originY),a.originY+a.height>s&&(s=a.originY+a.height))}),{x:r,y:n,w:i-r,h:s-n}}constructor(e){let r=Ei(e);if(!Da(r))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=r}result(){return this.scheme}insertChildImage(e,r){let{scheme:i}=this,n=Ei(r),s=_a(i,n);if(Sa(n,s),!n.elements)return;let a=Ii(i.elements,e),l=Ri(i.elements,a);l.options|=1;let c=ya(n.elements),p={x:l.originX-c.x,y:l.originY-c.y},{map:d,rootHandle:S}=Ia(i.elements,n.elements,p);if(Ra(n.elements,d),a.childHandles.push(S),!n.elementOrder)return;let g=va(n.elementOrder,d),y=i.elementOrder;i.elementOrder=y?y.concat(g):g}replaceIcon(e,r,i){let{scheme:n}=this,s=Ii(n.elements,e),a=Ri(n.elements,s),l={type:"DBMReference",handle:0,filename:r},c=1;if(n.doubleDibTools){for(;n.doubleDibTools.some(d=>d.handle===c);)++c;n.doubleDibTools.push(l)}else n.doubleDibTools=[l];a.dibHandle=l.handle=c;let p=0;switch(r.toUpperCase()){case"SYSTEM.DBM":p=2;break;default:return}a.cropX=i%p*32,a.cropY=Math.floor(i/p)*32}};var oe=class{constructor(e,r){this.parent=null;this.childWindows=new Set;this._originX=0;this._originY=0;this.spaceDoneSubs=new Set;this.moveSubs=new Set;var S,g,y,_,I,O;this.sceneHandle=e.handle,this.name=this._title=e.wname,this.source=(g=(S=e.vdr)==null?void 0:S.source)!=null?g:null,this.projectID=null;let i=e.attribs,n=300,s=200,a=!1,l=!1,c=!1,p=!1;if(i.useVdrSettings&&((y=e.vdr)==null?void 0:y.settings)){let P=e.vdr.settings,M=P.style;P.x&&(n=P.x),P.y&&(s=P.y),M&se.SWF_POPUP&&(a=!0),M&se.SWF_AUTOORG&&(l=!0),M&se.SWF_SPACESIZE&&(c=!0),M&se.SWF_NORESIZE&&(p=!0)}if(i.popup&&(a=!0),i.autoOrg&&(l=!0),i.bySpaceSize&&(c=!0),(a||i.noResize)&&(p=!0),((_=e.vdr)==null?void 0:_.elements)&&(l||c)){let P=Je.calcRect(e.vdr.elements);l&&(e.vdr.origin.x=P.x,e.vdr.origin.y=P.y),c&&(n=P.w,s=P.h)}((I=e.rect)==null?void 0:I.w)&&(n=e.rect.w),((O=e.rect)==null?void 0:O.h)&&(s=e.rect.h);let d=p?{resizable:!1,width:n,height:s}:{resizable:!0};this.scene=new ye({wnd:this,vdr:e.vdr,sizeInfo:d}),this.host=r(this.scene.view,{popup:a,title:e.wname,noCaption:i==null?void 0:i.noCaption,noShadow:i==null?void 0:i.noShadow,position:e.rect}),this.closeCallback=()=>{var P;(P=this.parent)==null||P.childWindows.delete(this),oe.wins.delete(this),this.childWindows.forEach(M=>M.close()),e.onClosed&&e.onClosed(),this.spaceDoneSubs.forEach(M=>M.receive(D.WM_SPACEDONE))},this.host.on&&this.host.on("closed",this.closeCallback),oe.wins.add(this),oe.updater.run(oe.redrawAll),this.redraw()}static redrawAll(){return oe.wins.forEach(e=>e.redraw()),oe.wins.size>0}subwindow(e){let r=L(L({},e),{attribs:{noResize:!0}}),i=new oe(r,n=>this.scene.frame(n,e.rect));return i.parent=this,this.childWindows.add(i),i}close(){return this.host.off&&this.host.off("closed",this.closeCallback),this.host.close&&this.host.close(),this.closeCallback(),1}redraw(){this.scene.render()}width(){return this.scene.width()}clientWidth(){return this.scene.width()}height(){return this.scene.height()}clientHeight(){return this.scene.height()}setClientSize(e,r){return this.scene.setSize(e,r),this.host.resizeTo&&this.host.resizeTo(e,r),1}originX(){return this._originX}originY(){return this._originY}setOrigin(e,r){return this._originX=e,this._originY=r,this.host.moveTo&&this.host.moveTo(e,r),1}toTop(){return this.host.toTop&&this.host.toTop(),1}setAttrib(e){switch(e){case D.SW_HIDE:this.host.setVisibility&&this.host.setVisibility(!1);break;case D.SW_SHOW:case D.SW_NORMAL:this.host.setVisibility&&this.host.setVisibility(!0);break}return 1}title(){return this._title}setTitle(e){return this._title=e,this.host.setTitle&&this.host.setTitle(e),1}setTransparent(e){return 1}setTransparentColor(e){return 1}on(e,r,i){switch(r){case D.WM_MOVE:this.moveSubs.add(e);break;case D.WM_SPACEDONE:this.spaceDoneSubs.add(e);break;default:this.scene.on(e,r,i)}}off(e,r){switch(r){case D.WM_MOVE:this.moveSubs.delete(e);break;case D.WM_SPACEDONE:this.spaceDoneSubs.delete(e);break;default:this.scene.off(e,r);break}}},qe=oe;qe.updater=new ve,qe.wins=new Set;function Rt(t){let e=t.toUpperCase();return{useVdrSettings:e.includes("WS_BYSPACE"),child:e.includes("WS_CHILD"),popup:e.includes("WS_POPUP"),noResize:e.includes("WS_NORESIZE"),autoOrg:e.includes("WS_AUTOORG"),bySpaceSize:e.includes("WS_SPACESIZE"),noCaption:e.includes("WS_NOCAPTION"),noShadow:e.includes("WS_NOSHADOW")}}function vi(t){return t.substring(0,t.lastIndexOf("\\")+1)}function vt(t,e){switch(t){case R.String:return e;case R.Float:return parseFloat(e)||0;case R.Handle:return(e.startsWith("#")?parseInt(e.substring(1,e.length)):parseInt(e))||0;case R.ColorRef:return Mr(e)}}function Di(t,e){let r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${t.proto.name}: ${i}`);for(let{handle1:i,handle2:n,flags:s,connectedVars:a}of e){let l=s&1,c=i===0?t:t.child(i);if(!c){r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let p=n===0?t:t.child(n);if(!p){r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let d=c.proto.vars(),S=p.proto.vars(),g=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${c.proto.name} #${i}`,y=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${p.proto.name} #${n}`;for(let{name1:_,name2:I}of a){let O=d.id(_),P=S.id(I);if(typeof O!="number"){r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${_} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${g}`);continue}if(typeof P!="number"){r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${I} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${y}`);continue}if(!c.connectVar(O,p,P,l)){let M=R[d.data(O).type],j=R[S.data(O).type];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${_} (${M}) \u0432 ${g} \u0438 ${I} (${j}) \u0432 ${y}`)}}}}var te=class{constructor(e,r,i,n,s){this.children=[];this.isDisabled=te.alwaysEnabled;this.disOrEnVarId=-1;this.varGraphNodes=[];this.classNodeCache=new Map;r.model(),this.proto=r,this.prj=e;{let a=r.vars();this.varGraphNodes=a.toArray().map(p=>new Oe(p.type)),this.TLB=new Uint16Array(a.count());let l=a._enableVarId,c=a._disableVarId;l>0&&(c<0||l<c)&&(this.isDisabled=te.disabledByEnable,this.disOrEnVarId=l),c>0&&(l<0||c<l)&&(this.isDisabled=te.disabledByDisable,this.disOrEnVarId=c)}this.children=i,Di(this,n),this.neighMapUC=new Map([["",this]]),this.parent=null,i.forEach(a=>a.setParent(this)),s?(this.handle=s.handle,this.schemeName=s.schemeName,this.position=s.position):(this.handle=0,this.schemeName="",this.position={x:0,y:0})}static alwaysEnabled(){return!1}static disabledByEnable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]<=0}static disabledByDisable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]>0}setParent(e){if(e===this||this.parent!==null)throw Error("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0440\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0439 \u0438\u043C\u0438\u0434\u0436");this.parent=e,this.neighMapUC.set("..",e)}resolve(e){if(e==="")return this;let r=e.split("\\"),i=e[0]==="\\"?this.prj.root:this;for(let n=0;n<r.length;++n){let s=i.neighMapUC.get(r[n]);if(typeof s=="undefined")return;i=s}return i}findClasses(e){let{root:r}=this.prj,i=r.classNodeCache.get(e);if(typeof i!="undefined")return i;let n=new Array;return function s(a){a.children.forEach(s),a.proto.name.toUpperCase()===e&&n.push(a)}(r),r.classNodeCache.set(e,n),n}setVarValue(e,r,i){if(e<0)return!1;let n=this.TLB[e];return this.prj.setOldValue(n,r,i),this.prj.setNewValue(n,r,i),!0}*computeSchema(){for(let r=0;r<this.children.length;++r){let i=this.children[r];i.isDisabled(i)||(yield*i.computeSchema())}let e=this.proto.model();!e||(yield*e.compute(this.TLB,this.prj,this))}child(e){var r;return(r=this.children.find(i=>i.handle===e))!=null?r:null}connectVar(e,r,i,n){return n?!0:Oe.connect(this.varGraphNodes[e],r.varGraphNodes[i])}receive(e,...r){if(this.prj.env.isWaiting())return Promise.resolve();let n=this.proto.vars();if(this.setVarValue(n.msgVarId,R.Float,e)===!1)return Promise.resolve();switch(e){case D.WM_CONTROLNOTIFY:this.setVarValue(n._hobjectVarId,R.Handle,r[0]),this.setVarValue(n.iditemVarId,R.Float,r[1]),this.setVarValue(n.wnotifycodeVarId,R.Float,r[2]);break;case D.WM_SIZE:this.setVarValue(n.nwidthVarId,R.Float,r[0]),this.setVarValue(n.nheightVarId,R.Float,r[1]);break;case D.WM_MOUSEMOVE:case D.WM_LBUTTONDOWN:case D.WM_LBUTTONUP:case D.WM_LBUTTONDBLCLK:case D.WM_RBUTTONDOWN:case D.WM_RBUTTONUP:case D.WM_RBUTTONDBLCLK:case D.WM_MBUTTONDOWN:case D.WM_MBUTTONUP:case D.WM_MBUTTONDBLCLK:this.setVarValue(n.xposVarId,R.Float,r[0]),this.setVarValue(n.yposVarId,R.Float,r[1]),this.setVarValue(n.fwkeysVarId,R.Float,r[2]);break}return this.compute(!0)}compute(e=!1){return C(this,null,function*(){if(!e&&this.isDisabled(this))return;let r=this.computeSchema();for(;;){let s=r.next();if(s.done)break;this.prj.env.setWaiting(),yield s.value,this.prj.env.resetWaiting()}let i=this.prj;i.oldFloats.set(i.newFloats),i.oldInts.set(i.newInts);let n=i.newStrings;for(let s=0;s<n.length;++s)i.oldStrings[s]=n[s];te.assertZeroIndexEmpty(i)})}createTLB(){let e={floatsCount:1,intsCount:1,stringsCount:1};return function r({children:i,TLB:n,varGraphNodes:s}){i.forEach(r),n.set(s.map(a=>a.getIndex(e)))}(this),e}applyDefaults(){this.children.forEach(i=>i.applyDefaults());let e=this.proto.vars(),r=e.count();for(let i=0;i<r;++i){let n=e.data(i),s=n.type,a=n.defaultValue;if(a!==null){this.setVarValue(i,s,a);continue}switch(i){case e.orgxVarId:this.setVarValue(i,s,this.position.x);break;case e.orgyVarId:this.setVarValue(i,s,this.position.y);break;case e._hobjectVarId:this.setVarValue(i,s,this.handle);break;case e._objnameVarId:this.setVarValue(i,s,this.schemeName);break;case e._classnameVarId:this.setVarValue(i,s,this.proto.name);break}}return this}applyVarSet(e){if(this.proto.name.toUpperCase()===e.classname.toUpperCase()){let r=this.proto.vars(),{values:i}=e;for(let n=0;n<i.length;++n){let s=i[n],a=r.id(s.name);if(a===null)continue;let l=r.data(a).type;this.setVarValue(a,l,vt(l,s.value))}}return e.childSets.forEach(r=>{var i;return(i=this.child(r.handle))==null?void 0:i.applyVarSet(r)}),this}stubCall(e,r){let i=this,n="";for(;i.parent;)n=` -> ${i.proto.name} #${i.handle}${n}`,i=i.parent;throw n=this.prj.root.proto.name+n,Error(`\u0412\u044B\u0437\u043E\u0432 \u043D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e}(${r.map(s=>typeof s).join(",")})
\u0432 ${n}`)}copyNewValuesToOld(){let e=this.TLB,{newFloats:r,oldFloats:i,newInts:n,oldInts:s,newStrings:a,oldStrings:l}=this.prj;for(let c of e)i[c]=r[c],s[c]=n[c],l[c]=a[c]}static assertZeroIndexEmpty(e){if(e.oldFloats[0]!==0||"undefined"in e.oldFloats||e.newFloats[0]!==0||"undefined"in e.newFloats||e.oldInts[0]!==0||"undefined"in e.oldInts||e.newInts[0]!==0||"undefined"in e.newInts||e.oldStrings[0]!==""||"undefined"in e.oldStrings||e.newStrings[0]!==""||"undefined"in e.newStrings)throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}stratum_async_test_sleep_8210460217466098(e){return e===0?"":new Promise(r=>setTimeout(r,e)).then(()=>"wait"+e)}stratum_getHObject(){return this.handle}stratum_getClassName(e){let r=this.resolve(e);return typeof r=="undefined"?"":r.proto.name}stratum_setVar(e,r,i){let n=this.resolve(e);if(!n)return;let s=n.proto.vars(),a=s.id(r);a!==null&&n.setVarValue(a,s.data(a).type,i)}*stratum_async_sendMessage(e,r,...i){var S;let{prj:n,TLB:s}=this;if(n.canExecute()===!1)return;let a=null;if(e!==""){let g=this.resolve(e);g&&(a=[g])}if(r!==""){let g=r.toUpperCase();a=(S=a==null?void 0:a.filter(y=>y.proto.name.toUpperCase()===g))!=null?S:this.findClasses(g)}if(!a||a.length===0)return;let l=this.proto.vars(),c=a[0].proto.vars(),p=new Array(i.length*1.5),d=0;for(let g=0;g<i.length;g+=2){let y=l.id(i[g]);if(y===null)continue;let _=c.id(i[g+1]);if(_===null)continue;let I=l.data(g).type,O=c.data(g).type;I===O&&(p[d+0]=I,p[d+1]=y,p[d+2]=_,d+=3)}for(let g=0;g<a.length;++g){let y=a[g];if(y!==this){for(let _=0;_<p.length;_+=3){let I=p[_+0];if(typeof I=="undefined")continue;let O=s[p[_+1]],P=y.TLB[p[_+2]],M=n.getNewValue(O,I);n.setNewValue(P,I,M),n.setOldValue(P,I,M)}n.inc(),yield*y.computeSchema(),y.copyNewValuesToOld(),n.dec();for(let _=0;_<p.length;_+=3){let I=p[_+0];if(typeof I=="undefined")continue;let O=s[p[_+1]],P=y.TLB[p[_+2]],M=n.getNewValue(P,I);n.setNewValue(O,I,M)}}}}stratum_setCapture(e,r,i){if(r!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 setCapture \u0441 path=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);let n=this;typeof n=="undefined"||n.proto.vars().msgVarId<0||this.prj.env.setCapture(n,e,i)}stratum_registerObject(e,r,i,n,s){if(i!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 RegisterObject \u0441 path=${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);let a=this;typeof a=="undefined"||a.proto.vars().msgVarId<0||this.prj.env.subscribe(a,e,r,n,s)}stratum_unregisterObject(e,r,i){if(r!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 UnRegisterObject \u0441 path=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);let n=this;typeof n=="undefined"||n.proto.vars().msgVarId<0||this.prj.env.unsubscribe(n,e,i)}};Te(te,"schema");var Fe=class{constructor(e,r){this.level=0,this._shouldClose=!1,this.env=e,this.dir=r.dir;let i=r.classes.get(r.prjInfo.rootClassName);if(!i)throw Error(`\u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${r.prjInfo.rootClassName} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);we.clear();let n=i.schema((...a)=>new te(this,...a));we.size>0&&console.warn(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 (${we.size}):
${[...we.values()].join(`
`)}`);let s=n.createTLB();this.oldFloats=new Float64Array(s.floatsCount),this.newFloats=new Float64Array(s.floatsCount),this.oldInts=new Int32Array(s.intsCount),this.newInts=new Int32Array(s.intsCount),this.oldStrings=new Array(s.stringsCount).fill(""),this.newStrings=new Array(s.stringsCount).fill(""),this.olds=[],this.olds[R.Float]=this.oldFloats,this.olds[R.Handle]=this.oldInts,this.olds[R.ColorRef]=this.oldInts,this.olds[R.String]=this.oldStrings,this.news=[],this.news[R.Float]=this.newFloats,this.news[R.Handle]=this.newInts,this.news[R.ColorRef]=this.newInts,this.news[R.String]=this.newStrings,n.applyDefaults(),r.stt&&n.applyVarSet(r.stt),this.root=n}canExecute(){return this.level<59}inc(){++this.level}dec(){--this.level}setOldValue(e,r,i){this.olds[r][e]=i}setNewValue(e,r,i){this.news[r][e]=i}getNewValue(e,r){return this.news[r][e]}shouldClose(){return this._shouldClose}click(e,r){return this.env.hyperCall(this,e,r)}stratum_closeAll(){this._shouldClose=!0}stratum_openSchemeWindow(e,r,i){return this.env.openSchemeWindow(this,e,r,i)}stratum_async_loadSpaceWindow(e,r,i){return this.env.loadSpaceWindow(this,e,r,i)}stratum_async_createWindowEx(e,r,i,n,s,a,l,c){return this.env.createWindowEx(this,e,r,i,n,s,a,l,c)}stratum_async_createDIB2d(e,r){return this.env.createDIB2d(this.dir,e,r)}stratum_async_createDoubleDib2D(e,r){return this.env.createDoubleDib2D(this.dir,e,r)}stratum_async_createObjectFromFile2D(e,r,i,n,s){return this.env.createObjectFromFile2D(this.dir,e,r,i,n,s)}stratum_async_createStream(e,r,i){return this.env.createStream(this.dir,e,r,i)}stratum_async_mSaveAs(e,r,i){return this.env.mSaveAs(this.dir,e,r,i)}stratum_async_mLoad(e,r,i){return this.env.mLoad(this.dir,e,r,i)}stratum_async_createDir(e){return C(this,null,function*(){let r=this.dir.resolve(e);return(yield r.fs.createDir(r))?1:0})}stratum_async_fileExist(e){return C(this,null,function*(){let r=this.dir.resolve(e);return(yield r.fs.fileExist(r))?1:0})}stratum_getProjectDirectory(){return this.dir.toString()}};Te(Fe,"prj");var Ee=class{static widthToSize(e){return e<0||e>9?0:Ee.widthTable[e]}constructor(e={}){var i;let r=e.data;r?r instanceof ArrayBuffer?this.v=new DataView(r.slice(0)):this.v=new DataView(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):this.v=new DataView(new ArrayBuffer(0)),this.p=0,this.width=8,this.onflush=(i=e.file)!=null?i:null}seek(e){return this.p=e}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(e){return this.width=e,1}widthNumber(){let e=Ee.widthToSize(this.width);if(e===0)return 0;let r=this.p,i=r+e;if(i>this.size())return 0;switch(this.p=i,this.width){case 0:return this.v.getUint8(r);case 1:return this.v.getInt8(r);case 2:return this.v.getUint16(r,!0);case 3:return this.v.getInt16(r,!0);case 4:return this.v.getUint32(r,!0);case 5:return this.v.getInt32(r,!0);case 6:return this.v.getFloat32(r,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(r,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(e){let r=new Uint8Array(new ArrayBuffer(e));r.set(new Uint8Array(this.v.buffer)),this.v=new DataView(r.buffer)}writeWidthNumber(e){let r=Ee.widthToSize(this.width);if(r===0)return 0;let i=this.p,n=i+r;switch(n>this.size()&&this.resize(n),this.p=n,this.width){case 0:return this.v.setUint8(i,e),1;case 1:return this.v.setInt8(i,e),1;case 2:return this.v.setUint16(i,e,!0),2;case 3:return this.v.setInt16(i,e,!0),2;case 4:return this.v.setUint32(i,e,!0),4;case 5:return this.v.setInt32(i,e,!0),4;case 6:return this.v.setFloat32(i,e,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(i,e,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}line(){let e=this.p,r=this.size()-e;if(r<=0)return"";let i=0,n=0;for(;i<r;){let a=this.v.getUint8(e+i);if(a===0){n=1;break}if(a===Ee.slashR&&i+1<r&&this.v.getInt8(e+i+1)===Ee.slashN){n=2;break}i+=1}let s=wt(new Uint8Array(this.v.buffer,e,i));return this.p=e+i+n,s}writeLine(e){let r=e+`\r
`,i=this.p,n=i+r.length;n>this.size()&&this.resize(n),this.p=n;let s=ii(r);for(let a=0;a<s.length;++a)this.v.setUint8(i,s[a]),i+=1;return r.length}close(){return this.onflush?this.onflush.write(this.v.buffer):!0}},pe=Ee;pe.slashR="\r".charCodeAt(0),pe.slashN=`
`.charCodeAt(0),pe.widthTable=[1,1,2,2,4,4,4,5,8,10];var Dt=class{constructor(e){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;if(!e){this.nameUCToId=new Map,this.vdata=[];return}this.vdata=e.map(i=>{let n;switch(i.type){case"FLOAT":case"INTEGER":n=R.Float;break;case"HANDLE":n=R.Handle;break;case"STRING":n=R.String;break;case"COLORREF":n=R.ColorRef;break}let s=i.defaultValue.length>0?vt(n,i.defaultValue):null;return{name:i.name,type:n,defaultValue:s,isReturnValue:!!(i.flags&D.VF_RETURN)}});let r=e.map(i=>i.name.toUpperCase());this.nameUCToId=new Map(r.map((i,n)=>[i,n]));for(let i=0;i<e.length;++i){let n=r[i],s=this.vdata[i].type;n==="_ENABLE"&&s===R.Float?this._enableVarId=i:n==="_DISABLE"&&s===R.Float?this._disableVarId=i:n==="MSG"&&s===R.Float?this.msgVarId=i:n==="_HOBJECT"&&s===R.Handle?this._hobjectVarId=i:n==="IDITEM"&&s===R.Float?this.iditemVarId=i:n==="WNOTIFYCODE"&&s===R.Float?this.wnotifycodeVarId=i:n==="NWIDTH"&&s===R.Float?this.nwidthVarId=i:n==="NHEIGHT"&&s===R.Float?this.nheightVarId=i:n==="XPOS"&&s===R.Float?this.xposVarId=i:n==="YPOS"&&s===R.Float?this.yposVarId=i:n==="FWKEYS"&&s===R.Float?this.fwkeysVarId=i:n==="ORGX"&&s===R.Float?this.orgxVarId=i:n==="ORGY"&&s===R.Float?this.orgyVarId=i:n==="_OBJNAME"&&s===R.String?this._objnameVarId=i:n==="_CLASSNAME"&&s===R.String&&(this._classnameVarId=i)}}id(e){var r;return(r=this.nameUCToId.get(e.toUpperCase()))!=null?r:null}get(e){let r=this.nameUCToId.get(e.toUpperCase());return typeof r=="undefined"?null:this.vdata[r]}data(e){return this.vdata[e]}count(){return this.vdata.length}toArray(){return this.vdata}};var Ot=class{constructor(e,r){this._model=null;this._compiled=!1;var n,s,a,l,c,p,d,S;this.name=e.name,this.children=(n=e.children)!=null?n:[],this.links=(s=e.links)!=null?s:[],this._schemeBytes=(a=e.scheme)!=null?a:null,this._scheme=null,this._imageBytes=(l=e.image)!=null?l:null,this._image=null,this.iconFile=(c=e.iconFile)!=null?c:null,this.iconIndex=(p=e.iconIndex)!=null?p:0,this.sourceCode=(d=e.sourceCode)!=null?d:null,this._vars=new Dt(e.vars);let i=(S=e.flags)!=null?S:0;this.alwaysUseIcon=!!(i&W.CF_USEDEFICON),this.lib=r}vars(){return this._vars}scheme(){let e=this._scheme;if(e)return e;let r=this._schemeBytes;if(!r)return null;this._schemeBytes=null;let i=`\u0421\u0445\u0435\u043C\u0430 ${this.name}`;if(typeof r=="string")throw Error(`${i}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${r}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let n=new Z(r,i),s=Pe(n,{origin:"class",name:this.name}),a=this.children;if(!a)return this._scheme=s;let l=new Je(s);for(let c=0;c<a.length;++c){let p=a[c],d=this.lib.get(p.classname);if(!d){console.warn(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${p.classname} #${p.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435 ${this.name}`);continue}let S=d.iconFile;if(S&&l.replaceIcon(p.handle,S,d.iconIndex),!d.alwaysUseIcon){let g=d.image();g&&l.insertChildImage(p.handle,g)}}return this._scheme=l.result()}image(){let e=this._image;if(e)return e;let r=this._imageBytes;if(!r)return null;this._imageBytes=null;let i=`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${this.name}`;if(typeof r=="string")throw Error(`${i}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${r}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let n=new Z(r,i);return this._image=Pe(n,{origin:"class",name:this.name})}model(){if(this._compiled)return this._model;this._compiled=!0;let e=this.sourceCode;return e?this._model=Ht(e,this.lib,this.name,this._vars.toArray()):null}schema(e,r){let i=this.children.map(n=>{let s=this.lib.get(n.classname);if(!s)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${n.classname}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);return s.schema(e,n)});return e(this,i,this.links,r)}};function Oa(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=t.string(),s=t.string(),a=t.string(),l=t.string().toUpperCase();if(l!=="STRING"&&l!=="FLOAT"&&l!=="INTEGER"&&l!=="HANDLE"&&l!=="COLORREF")throw new ie(t,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${l}.`);let c=t.int32();r[i]={name:n,description:s,defaultValue:a,type:l,flags:c}}return r}function xa(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=t.uint16(),s=t.uint16(),a=t.uint16(),l=t.int32(),c=t.uint16(),p=t.uint16(),d=new Array(c);for(let S=0;S<c;S++){let g=t.string(),y=t.string();d[S]={name1:g,name2:y}}r[i]={handle1:n,handle2:s,linkHandle:a,flags:l,connectedVars:d,contactPadHandle:p}}return r}function Ba(t,e){let r=t.uint16(),i=new Array(r);for(let n=0;n<r;++n){let s=t.string(),a=t.uint16(),l=t.string(),c=t.point2d(e<12290),p=t.byte();i[n]={classname:s,handle:a,schemeName:l,position:c,flags:p}}return i}function Oi(t){return t.int32()&W.SF_EXTERNAL?t.string():t.bytes(t.int32())}function Kt(t){let e=t.uint16();if(e!==16979)throw new K(t,e,16979);let r=t.int32();return t.skip(8),{name:t.string(),version:r}}function xi(t){let e=Kt(t),r=t.uint16();if(r===W.CR_VARS1&&(e.vars=Oa(t),r=t.uint16()),r===W.CR_LINKS&&(e.links=xa(t),r=t.uint16()),(r===W.CR_CHILDSnameXY||r===W.CR_CHILDSname||r===W.CR_CHILDS)&&(e.children=Ba(t,e.version),r=t.uint16()),r===W.CR_ICON){let i=t.int32();t.skip(i-4),r=t.uint16()}return r===W.CR_SCHEME&&(t.skip(4),e.scheme=Oi(t),r=t.uint16()),r===W.CR_IMAGE&&(t.skip(4),e.image=Oi(t),r=t.uint16()),r===W.CR_TEXT&&(e.sourceCode=t.string(),r=t.uint16()),r===W.CR_INFO&&(t.skip(t.uint16()),r=t.uint16()),r===W.CR_VARSIZE&&(t.skip(2),r=t.uint16()),r===W.CR_FLAGS&&(e.flags=t.int32(),r=t.uint16()),r===W.CR_DEFICON&&(e.iconIndex=t.uint16(),r=t.uint16()),r===W.CR_ICONFILE&&(e.iconFile=t.string(),r=t.uint16()),r===W.CR_CODE&&(t.skip(t.int32()*2),r=t.uint16()),r===W.CR_EQU||r!==W.CR_CLASSTIME&&e.version===12291&&console.warn(`${e.name} (${t.name||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),e}var Qt=class{constructor(){this.filenames=new Set;this.lib=new Map}add(e,r,i,n){return C(this,null,function*(){let s=yield e.searchClsFiles(r,i),a=[],l=s.filter(S=>{let g=S.toString(),y=this.filenames.size;this.filenames.add(g);let _=this.filenames.size!==y;return _&&a.push(g),_});if(l.length===0)return;let c=yield e.arraybuffers(l),p=0,d=0;for(let S=0;S<c.length;++S){let g=c[S];if(!g)continue;let y=a[S],_=new Z(g,y),I;try{I=Kt(_).name}catch(M){console.warn(M.message);continue}_.seek(0),_.name=`${I} (${y})`;let O=I.toUpperCase(),P=this.lib.get(O);if(P)throw typeof n!="undefined"&&this.clear(n),Error(`\u0418\u043C\u0438\u0434\u0436 ${I} \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445: ${P.path}, ${y}`);this.lib.set(O,{type:"unloaded",id:n!=null?n:null,path:y,reader:_}),p+=g.byteLength,++d}d>0&&G.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E ${d} \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043E\u0431\u044A\u0435\u043C\u043E\u043C ${(p/1024).toFixed()} \u041A\u0411. \u0412\u0441\u0435\u0433\u043E: ${this.lib.size}.`)})}clear(e){let i=[...this.lib].filter(a=>a[1].id!==e),n=this.lib.size-i.length;n>0&&G.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${n} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(i);let s=i.map(a=>a[1].path);this.filenames=new Set(s)}clearAll(){let r=[...this.lib].filter(s=>s[1].id===null),i=this.lib.size-r.length;i>0&&G.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${i} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(r);let n=r.map(s=>s[1].path);this.filenames=new Set(n)}has(e){return this.lib.has(e.toUpperCase())}get(e){let r=e.toUpperCase(),i=this.lib.get(r);if(!i)return null;if(i.type==="loaded")return i.proto;let n=xi(i.reader),s=new Ot(n,this);return this.lib.set(r,{type:"loaded",id:i.id,path:i.path,proto:s}),s}getModel(e){var r,i;return(i=(r=this.get(e))==null?void 0:r.model())!=null?i:null}getPath(e){var r,i;return(i=(r=this.lib.get(e.toUpperCase()))==null?void 0:r.path)!=null?i:null}};var xt=class{constructor(e){this.minX=e.minX,this.minY=e.minY,this.rows=e.rows,this.cols=e.cols,this.data=e.data?new Float64Array(e.data):new Float64Array(this.rows*this.cols)}get(e,r){let i=e-this.minX,n=r-this.minY;return i<0||n<0||i>=this.rows||n>=this.cols?0:this.data[i*this.cols+n]}set(e,r,i){let n=e-this.minX,s=r-this.minY;return n<0||s<0||n>=this.rows||s>=this.cols?0:(this.data[n*this.cols+s]=i,i)}fill(e){return this.data.fill(e),1}};function Bi(t){let e=t.uint16();if(e!==12)throw new K(t,e,12);t.seek(14);let r=t.int32(),i=t.int32(),n=t.int32(),s=t.int32();t.uint16(),t.uint16();let a=Array.from({length:r*i},()=>t.float64());return{minX:n,minY:s,rows:r,cols:i,data:a}}function Ie(t,e){return C(this,null,function*(){let r=yield t.fs.arraybuffer(t);if(!r)throw Error(`\u0424\u0430\u0439\u043B ${t.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let i=new Z(r,t.toString());switch(e){case"prj":return St(i);case"stt":return yt(i);case"vdr":return Pe(i,{origin:"file",name:t.toString()});case"mat":return Bi(i);case"bmp":return It(i);case"dbm":return xe(i)}})}var et=class{constructor(e,r){this._shouldQuit=!1;this._isWaiting=!1;this.loading=null;this.windows=new Map;this.scenes=new Map;this.matrices=new Map;this.streams=new Map;this.targetScene=null;this.lastOpenPopup="";this.setWindowOwnerwarnShowed=!1;this.lockSpace2dWarnShowed=!1;this.projects=[new Fe(this,e)],this.classes=e.classes,this.host=r}static loadProject(e,r){return C(this,null,function*(){let i=r==null?void 0:r.filter(s=>!s.type||s.type==="library").map(s=>s.dir),n=new Qt;return et.loadProjectResources(e,{lib:n},i)})}static loadProjectResources(e,r,i){return C(this,null,function*(){var _;let n=e.resolve(".."),s=n.resolve("_preload.stt"),[a,l]=yield n.fs.arraybuffers([e,s]);if(!a)throw Error(`\u0424\u0430\u0439\u043B \u043F\u0440\u043E\u0435\u043A\u0442\u0430 ${e} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);G.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${e.toString()}`);let c=St(new Z(a,e.toString())),p=null;if(l)try{p=yt(new Z(l,s.toString()))}catch(I){console.warn(I)}let d=[n],S=(_=c.settings)==null?void 0:_.classSearchPaths;if(S){let I=S.split(",").map(O=>O.trim()).filter(O=>O);for(let O of I)d.push(n.resolve(O))}let g=i?d.concat(i):d,y=r.lib;return yield y.add(n.fs,g,!0,r.id),{classes:y,dir:n,prjInfo:c,stt:p}})}sessionId(){return this.projects.length}nextSessionId(){return this.projects.length+1}compute(){if(this._shouldQuit)return this.closeAllRes();if(this.loading)return this.loading;let e=this.projects.length-1,r=this.projects[e];if(r.shouldClose()===!0){if(G.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${r.dir.toString()}`),this.classes.clear(this.sessionId()),this.closeProjectWindows(r),this.projects.pop(),this.projects.length===0)return this.closeAllRes();r=this.projects[e-1]}return r.root.compute()}requestStop(){this._shouldQuit=!0}closeAllRes(){return C(this,null,function*(){var i;this._shouldQuit=!0,this.windows.forEach(n=>n.close()),this.scenes.clear(),this.windows.clear(),(i=this.targetScene)==null||i.releaseCapture(),this.targetScene=null;let e=[];for(let n of this.streams.values()){let s=n.close();s instanceof Promise&&e.push(s)}yield Promise.all(e);let r;for(;r=this.projects.pop();)G.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${r.dir.toString()}`);if(this.loading)try{yield this.loading}catch(n){}return this.classes.clearAll(),!0})}isWaiting(){return this._isWaiting}setWaiting(){this._isWaiting=!0}resetWaiting(){this._isWaiting=!1}getTime(e,r,i,n,s,a,l,c){let p=new Date;e[r]=p.getHours(),i[n]=p.getMinutes(),s[a]=p.getSeconds(),l[c]=p.getMilliseconds()*.1}getDate(e,r,i,n,s,a){let l=new Date;e[r]=l.getFullYear(),i[n]=l.getMonth(),s[a]=l.getDate()}getActualSize2d(e,r,i,n,s,a){let l=this.getObject(e,r);return typeof l=="undefined"?(i[n]=0,s[a]=0,0):(i[n]=l.actualWidth(),s[a]=l.actualHeight(),1)}openSchemeWindow(e,r,i,n){var l;let s=this.windows.get(r);if(typeof s!="undefined")return s.sceneHandle;let a=(l=this.classes.get(i))==null?void 0:l.scheme();return this.openWindow(e,r,Rt(n),a)}loadSpaceWindow(e,r,i,n){let s=this.windows.get(r);if(typeof s!="undefined")return s.sceneHandle;let a=Rt(n);return i===""?this.openWindow(e,r,a):Ie(e.dir.resolve(i),"vdr").then(l=>this.openWindow(e,r,a,l)).catch(()=>this.openWindow(e,r,a))}createWindowEx(e,r,i,n,s,a,l,c,p){var y;let d=this.windows.get(r);if(typeof d!="undefined")return d.sceneHandle;let S=_=>{let I=this.windows.get(i),O=Rt(p),P={x:s,y:a,w:l,h:c};return!I||!O.child?this.openWindow(e,r,O,_,P):this.openSubwindow(I,e,r,P,_)},g=(y=this.classes.get(n))==null?void 0:y.scheme();return g?S(g):Ie(e.dir.resolve(n),"vdr").then(_=>S(_)).catch(()=>S())}createDIB2d(e,r,i){let n=this.scenes.get(r);return typeof n=="undefined"?0:Ie(e.resolve(i),"bmp").then(s=>n.createDIBTool(s)).catch(()=>0)}createDoubleDib2D(e,r,i){let n=this.scenes.get(r);return typeof n=="undefined"?0:Ie(e.resolve(i),"dbm").then(s=>n.createDoubleDIBTool(s)).catch(()=>0)}createObjectFromFile2D(e,r,i,n,s,a){let l=this.scenes.get(r);return typeof l=="undefined"?0:Ie(e.resolve(i),"vdr").then(c=>l.insertVectorDrawing(n,s,a,c)).catch(()=>0)}createStream(e,r,i,n){let s=r.toUpperCase(),a=n.toUpperCase().includes("CREATE"),l=H.getFreeHandle(this.streams);if(s==="FILE"){let c=e.resolve(i);return(()=>C(this,null,function*(){let p;if(a){let d=yield c.fs.createFile(c);if(!d)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0444\u0430\u0439\u043B ${c}.`);p=new pe({file:d})}else{let d=c.fs.file(c),S=yield d==null?void 0:d.read();if(!d||!S)throw Error(`\u0424\u0430\u0439\u043B ${c} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);p=new pe({data:S,file:d})}return this.streams.set(l,p),l}))()}if(s==="MEMORY")return this.streams.set(l,new pe),l;throw Error(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${s} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`)}mSaveAs(e,r,i,n){if(n<=0)return 0;throw Error("\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}mLoad(e,r,i,n){return n<=0?0:Ie(e.resolve(i),"mat").then(s=>{let a=r===0?H.getFreeNegativeHandle(this.matrices):r;return this.matrices.set(a,new xt(s)),a}).catch(()=>0)}setCapture(e,r,i){let n=this.scenes.get(r);typeof n!="undefined"&&(this.targetScene=n).setCapture(e)}subscribe(e,r,i,n,s){var l;let a=typeof r=="number"?(l=this.scenes.get(r))==null?void 0:l.wnd:this.windows.get(r);a==null||a.on(e,n,s&1?i:0)}unsubscribe(e,r,i){var s;let n=typeof r=="number"?(s=this.scenes.get(r))==null?void 0:s.wnd:this.windows.get(r);n==null||n.off(e,i)}loadProject(e){return C(this,null,function*(){if(this.loading)return;let r=document.body.style.cursor;document.body.style.cursor="wait";try{let i=yield et.loadProjectResources(e,{id:this.nextSessionId(),lib:this.classes});if(this._shouldQuit)return;this.projects.push(new Fe(this,i))}catch(i){console.error(i)}finally{this.loading=null,document.body.style.cursor=r}})}hyperCall(e,r,i){var n,s,a,l,c;if(this.lastOpenPopup&&((n=this.windows.get(this.lastOpenPopup))==null||n.close(),this.lastOpenPopup=""),!(this.loading||!r))switch((s=r.openMode)!=null?s:0){case 0:{let g=r.target;if(!g)break;let y=(a=this.classes.get(g))==null?void 0:a.scheme();if(!y)break;let _=r.windowName||(((c=(l=y.settings)==null?void 0:l.style)!=null?c:0)&se.SWF_POPUP?"PopupWindow":"MainWindow");if(this.windows.has(_))return;this.openWindow(e,_,{useVdrSettings:!0},y,{x:i.x,y:i.y,w:0,h:0});break}case 1:let p=r.target;if(!p)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A Windows \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F ${e.dir.resolve(p)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;case 2:let d=r.target;if(!d)break;this.loading=this.loadProject(e.dir.resolve(d));break;case 3:break;case 4:let S=r.target;if(!S)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A \u043A\u043E\u043C\u0430\u043D\u0434\u044B ${e.dir.resolve(S)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(r)}}openWindow(e,r,i,n,s){let a=H.getFreeHandle(this.scenes),l={handle:a,wname:r,vdr:n,attribs:i,rect:s,onClosed:()=>this.removeWindow(r)},c=new qe(l,(p,d)=>(d.popup&&(this.lastOpenPopup=r),this.host.window(p,d)));return this.windows.set(r,c),this.scenes.set(a,c.scene),c.projectID=e,c.scene.hyperHandler=e,a}openSubwindow(e,r,i,n,s){let a=H.getFreeHandle(this.scenes),l=e.subwindow({handle:a,wname:i,vdr:s,rect:n,onClosed:()=>this.removeWindow(i)});return this.windows.set(i,l),this.scenes.set(a,l.scene),l.projectID=r,l.scene.hyperHandler=r,a}closeProjectWindows(e){for(let r of this.windows.values())r.projectID===e&&r.close()}removeWindow(e){var i;let r=this.windows.get(e);!r||(this.windows.delete(e),this.scenes.delete(r.sceneHandle),r.scene===this.targetScene&&((i=this.targetScene)==null||i.releaseCapture(),this.targetScene=null))}getObject(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objects.get(r):void 0}getTPen(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.pens.get(r):void 0}getTBrush(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.brushes.get(r):void 0}getTDIB(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.dibs.get(r):void 0}getTText(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.texts.get(r):void 0}getTString(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.strings.get(r):void 0}getTFont(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.fonts.get(r):void 0}stratum_isDlgButtonChecked2d(e,r){return 0}stratum_checkDlgButton2d(e,r,i){return 1}stratum_setObjectAttribute2d(e,r,i,n){return 1}stratum_new(){throw Error("\u0424\u0443\u043D\u043A\u0446\u0438\u044F New \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}stratum_logMessage(e){G.log("\u0418\u043D\u0444\u043E: "+e)}stratum_system(e,...r){return 0}stratum_releaseCapture(){this.targetScene!==null&&(this.targetScene.releaseCapture(),this.targetScene=null)}stratum_setHyperJump2d(e,r,i,...n){if(i<-1||i>4)return 0;let s=this.scenes.get(e);return typeof s=="undefined"?0:i===-1?s.setHyper(r,null):s.setHyper(r,{openMode:i,target:n[0],objectName:n[1],effect:n[2],windowName:n[3],params:n[4]})}stratum_stdHyperJump(e,r,i,n){var s;(s=this.scenes.get(e))==null||s.tryHyper(r,i,n)}stratum_ascii(e){if(e.length===0)return 0;let r=je.indexOf(e[0]);return r<0?0:r}stratum_chr(e){return e<0||e>255?"":je[e]}stratum_getTickCount(){return new Date().getTime()-et.startupTime}stratum_addSlash(e){return e.length===0||e[e.length-1]==="\\"?e:e+"\\"}stratum_MCISendString(){return D.MCIERR_INVALID_DEVICE_NAME}stratum_MCISendStringStr(){return""}stratum_getAsyncKeyState(e){return ye.keyState[e]>0?1:0}stratum_quit(e){e<=0||(this._shouldQuit=!0)}stratum_getClientHeight(e){let r=this.windows.get(e);return typeof r!="undefined"?r.clientHeight():0}stratum_getClientWidth(e){let r=this.windows.get(e);return typeof r!="undefined"?r.clientWidth():0}stratum_getWindowName(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.wnd.name:""}stratum_getWindowOrgX(e){let r=this.windows.get(e);return typeof r!="undefined"?r.originX():0}stratum_getWindowOrgY(e){let r=this.windows.get(e);return typeof r!="undefined"?r.originY():0}stratum_getWindowSpace(e){let r=this.windows.get(e);return typeof r!="undefined"?r.sceneHandle:0}stratum_getWindowWidth(e){let r=this.windows.get(e);return typeof r!="undefined"?r.width():0}stratum_getWindowHeight(e){let r=this.windows.get(e);return typeof r!="undefined"?r.height():0}stratum_getWindowTitle(e){let r=this.windows.get(e);return typeof r!="undefined"?r.title():""}stratum_setClientSize(e,r,i){let n=this.windows.get(e);return typeof n!="undefined"?n.setClientSize(r,i):0}stratum_setWindowOrg(e,r,i){let n=this.windows.get(e);return typeof n!="undefined"?n.setOrigin(r,i):0}stratum_setWindowTitle(e,r){let i=this.windows.get(e);return typeof i!="undefined"?i.setTitle(r):0}stratum_getWindowProp(e,r){var a;let i=(a=this.windows.get(e))==null?void 0:a.source;if(!i)return"";let n=r.toUpperCase();return n==="CLASSNAME"&&i.origin==="class"||n==="FILENAME"&&i.origin==="file"?i.name:""}stratum_isWindowExist(e){return typeof this.windows.get(e)!="undefined"?1:0}stratum_bringWindowToTop(e){let r=this.windows.get(e);return typeof r!="undefined"?r.toTop():0}stratum_showWindow(e,r){let i=this.windows.get(e);return typeof i!="undefined"?i.setAttrib(r):0}stratum_closeWindow(e){let r=this.windows.get(e);return typeof r!="undefined"?r.close():0}stratum_setWindowTransparent(e,r){var n,s;let i=typeof e=="number"?(n=this.scenes.get(e))==null?void 0:n.wnd:this.windows.get(e);return(s=i==null?void 0:i.setTransparent(r))!=null?s:0}stratum_setWindowTransparentColor(e,r){var n,s;let i=typeof e=="number"?(n=this.scenes.get(e))==null?void 0:n.wnd:this.windows.get(e);return(s=i==null?void 0:i.setTransparentColor(r))!=null?s:0}stratum_setWindowOwner(e,r){return e===0||r===0||this.setWindowOwnerwarnShowed||(console.warn(`setWindowOwner(${e},${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430)`),this.setWindowOwnerwarnShowed=!0),1}stratum_getSpaceOrg2dx(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.originX():0}stratum_getSpaceOrg2dy(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.originY():0}stratum_setSpaceOrg2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setOrigin(r,i):0}stratum_getScaleSpace2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.scale():0}stratum_setScaleSpace2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.setScale(r):0}stratum_getBkBrush2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.brushHandle():0}stratum_setBkBrush2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.setBrush(r):0}stratum_lockSpace2d(e,r){return this.lockSpace2dWarnShowed||(console.warn(`LockSpace2d(${e}, ${r}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.lockSpace2dWarnShowed=!0),0}stratum_createPen2d(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createPenTool(r,i,n,s):0}stratum_getPenColor2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.color():0}stratum_getPenRop2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.rop():0}stratum_getPenStyle2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.style():0}stratum_getPenWidth2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.width():0}stratum_setPenColor2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setColor(i):0}stratum_setPenRop2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setRop(i):0}stratum_setPenStyle2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_setPenWidth2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setWidth(i):0}stratum_createBrush2d(e,r,i,n,s,a){let l=this.scenes.get(e);return typeof l!="undefined"?l.createBrushTool(r,i,n,s,a):0}stratum_getBrushColor2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.color():0}stratum_getBrushRop2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.rop():0}stratum_getBrushStyle2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.style():0}stratum_getBrushHatch2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.hatch():0}stratum_getBrushDib2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.dibHandle():0}stratum_setBrushColor2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setColor(i):0}stratum_setBrushRop2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setRop(i):0}stratum_setBrushStyle2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_setBrushHatch2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setHatch(i):0}stratum_setBrushDib2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setDIB(i):0}stratum_createFont2D(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createFontTool(r,i,n):0}stratum_getFontName2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.name():""}stratum_getFontSize2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.size():0}stratum_getFontStyle2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.style():0}stratum_setFontName2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setName(i):0}stratum_setFontSize2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setSize(i):0}stratum_setFontStyle2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_createString2D(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.createStringTool(r):0}stratum_getstring2d(e,r){let i=this.getTString(e,r);return typeof i!="undefined"?i.text():""}stratum_setString2d(e,r,i){let n=this.getTString(e,r);return typeof n!="undefined"?n.setText(i):0}stratum_createText2D(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createTextTool(r,i,n,s):0}stratum_createRasterText2D(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createText(i,n,s,r):0}stratum_getTextObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.textToolHandle():0}stratum_getTextCount2d(e,r){let i=this.getTText(e,r);return typeof i!="undefined"?i.textCount():0}stratum_getTextFont2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.fontHandle(i):0}stratum_getTextString2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.stringHandle(i):0}stratum_getTextFgColor2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.fgColor(i):0}stratum_getTextBkColor2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.bgColor(i):0}stratum_setText2D(e,r,i,n,s,a,l){let c=this.getTText(e,r);if(typeof c=="undefined")return 0;let p=typeof l!="undefined"?i:0,d=typeof l!="undefined"?n:i,S=typeof l!="undefined"?s:n,g=typeof l!="undefined"?a:s,y=typeof l!="undefined"?l:a;return c.setValues(p,d,S,g,y)}stratum_getDibPixel2D(e,r,i,n){let s=this.getTDIB(e,r);return typeof s!="undefined"?s.getPixel(i,n):0}stratum_setDibPixel2D(e,r,i,n,s){let a=this.getTDIB(e,r);return typeof a!="undefined"?a.setPixel(i,n,s):0}stratum_createBitmap2d(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(i,n,r,!1):0}stratum_createDoubleBitmap2D(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(i,n,r,!0):0}stratum_setBitmapSrcRect2d(e,r,i,n,s,a){let l=this.getObject(e,r);return typeof l!="undefined"?l.setBitmapRect(i,n,s,a):0}stratum_getDibObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.dibHandle():0}stratum_getDDibObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.doubleDIBHandle():0}stratum_rgbEx(e,r,i,n){return ke(e,r,i,n)}stratum_rgb(e,r,i){return ke(e,r,i,0)}stratum_getRValue(e){return bt(e)}stratum_getGValue(e){return pt(e)}stratum_getBValue(e){return dt(e)}stratum_deleteObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.deleteObject(r):0}stratum_getObjectName2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectName(r):""}stratum_setObjectName2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setObjectName(r,i):0}stratum_getObject2dByName(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.getObject2dByName(r,i):0}stratum_setObjectOrg2d(e,r,i,n){let s=this.getObject(e,r);return typeof s!="undefined"?s.setOrigin(i,n):0}stratum_getObjectOrg2dx(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.originX():0}stratum_getObjectOrg2dy(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.originY():0}stratum_setObjectSize2d(e,r,i,n){let s=this.getObject(e,r);return typeof s!="undefined"?s.setSize(i,n):0}stratum_getObjectWidth2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.width():0}stratum_getObjectHeight2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.height():0}stratum_getActualHeight2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.actualHeight():0}stratum_getActualWidth2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.actualWidth():0}stratum_getObjectAngle2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.angle():0}stratum_rotateObject2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.rotate(i,n,s):0}stratum_setShowObject2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.setVisibility(i!==0):0}stratum_showObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.setVisibility(!0):0}stratum_hideObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.setVisibility(!1):0}stratum_getObjectFromPoint2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.getObjectFromPoint2d(r,i):0}stratum_getBottomObject2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.bottomObjectHandle():0}stratum_getUpperObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.upperObjectHandle(r):0}stratum_getObjectFromZOrder2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectFromZOrder(r):0}stratum_getLowerObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.lowerObjectHandle(r):0}stratum_getTopObject2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.topObjectHandle():0}stratum_getZOrder2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectZOrder(r):0}stratum_objectToBottom2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectToBottom(r):0}stratum_objectToTop2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectToTop(r):0}stratum_setZOrder2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setObjectZOrder(r,i):0}stratum_swapObject2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.swapObjects(r,i):0}stratum_createPolyLine2d(e,r,i,...n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createLine(n,r,i):0}stratum_createLine2d(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createLine([n,s],r,i):0}stratum_addPoint2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.addPoint(i,n,s):0}stratum_delpoint2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.deletePoint(i):0}stratum_getPenObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.penHandle():0}stratum_getBrushObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.brushHandle():0}stratum_getVectorNumPoints2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.pointCount():0}stratum_getVectorPoint2dx(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.pointOriginX(i):0}stratum_getVectorPoint2dy(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.pointOriginY(i):0}stratum_setVectorPoint2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.setPointOrigin(i,n,s):0}stratum_createGroup2d(e,...r){let i=this.scenes.get(e);return typeof i!="undefined"?i.createGroup(r):0}stratum_deleteGroup2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.deleteGroup2d(r):0}stratum_addGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.addItem(i):0}stratum_delGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.deleteItem(i):0}stratum_getGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.itemHandle(i):0}stratum_getObjectParent2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.parentHandle():0}stratum_isObjectsIntersect2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.isIntersect(r,i):0}stratum_getControlText2d(e,r,i,n){let s=this.getObject(e,r);return typeof s=="undefined"?"":typeof i=="undefined"||typeof n=="undefined"?s.controlText():s.controlText().slice(i,i+n)}stratum_setControlText2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.setControlText(i):0}stratum_getClassDirectory(e){let r=this.classes.getPath(e);return r?vi(r):""}stratum_closeClassScheme(){return 1}stratum_getScreenWidth(){return screen.width}stratum_getScreenHeight(){return screen.height}stratum_getWorkAreaX(){return 0}stratum_getWorkAreaY(){return 0}stratum_getWorkAreaWidth(){return this.host.width||window.innerWidth}stratum_getWorkAreaHeight(){return this.host.height||window.innerHeight}stratum_mCreate(e,r,i,n,s,a){if(a<=0)return 0;let l=i-r+1,c=s-n+1;if(l<=0||c<=0)return 0;let p=e===0?H.getFreeNegativeHandle(this.matrices):e;return this.matrices.set(p,new xt({rows:l,cols:c,minX:r,minY:n})),p}stratum_mDelete(e,r){return r<=0?0:this.matrices.delete(e)?1:0}stratum_mFill(e,r,i){var n,s;return i<=0?0:(s=(n=this.matrices.get(e))==null?void 0:n.fill(r))!=null?s:0}stratum_mGet(e,r,i,n){var s,a;return n<=0?0:(a=(s=this.matrices.get(e))==null?void 0:s.get(r,i))!=null?a:0}stratum_mPut(e,r,i,n,s){var a,l;return s<=0?0:(l=(a=this.matrices.get(e))==null?void 0:a.set(r,i,n))!=null?l:0}stratum_async_mEditor(e,r){if(r<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}stratum_async_closeStream(e){let r=this.streams.get(e);if(!r)return 0;this.streams.delete(e);let i=r.close();return i instanceof Promise?i.then(n=>n?1:0):i?1:0}stratum_seek(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.seek(r))!=null?n:0}stratum_eof(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.eof())!=null?i:0}stratum_getPos(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.pos())!=null?i:0}stratum_getSize(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.size())!=null?i:0}stratum_setWidth(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.setWidth(r))!=null?n:0}stratum_read(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.widthNumber())!=null?i:0}stratum_readLn(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.line())!=null?i:""}stratum_write(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.writeWidthNumber(r))!=null?n:0}stratum_writeLn(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.writeLine(r))!=null?n:0}},Re=et;Re.startupTime=new Date().getTime();Te(Re,"env");var Pi=class{constructor(e,r,{title:i,popup:n}){this.root=e;this.view=r;this.origTitle=document.title,!n&&i&&(document.title=this.origTitle?`${this.origTitle} - ${i}`:i),this.popup=n,e.appendChild(r)}moveTo(e,r){!this.popup||(this.view.style.setProperty("left",e+"px"),this.view.style.setProperty("top",r+"px"))}setTitle(e){document.title=e}setVisibility(e){this.view.style.setProperty("display",e?"block":"none")}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},Bt=class{constructor(e,{title:r}){this.wnd=e;this.handlers=new Set;this.sizedOnce=!1;r&&(e.document.title=r)}subwindow(e,r){let i=window.open("about:blank",void 0,`width=${window.innerWidth/1.5},height=${window.innerHeight/1.5}`);if(!i)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${r.title}`);return i.document.body.appendChild(e),new Bt(i,r)}on(e,r){e==="closed"&&(this.wnd.addEventListener("beforeunload",r),this.handlers.add(r))}off(e,r){e==="closed"&&(r?(this.wnd.removeEventListener("beforeunload",r),this.handlers.delete(r)):(this.handlers.forEach(i=>this.wnd.removeEventListener("beforeunload",i)),this.handlers.clear()))}setTitle(e){this.wnd.document.title=e}resizeTo(e,r){if(this.sizedOnce===!0)return;let{wnd:i}=this;i.addEventListener("resize",()=>i.resizeTo(e+i.outerWidth-i.innerWidth,r+i.outerHeight-i.innerHeight),{once:!0}),this.sizedOnce=!0}close(){this.off("closed"),this.wnd.close()}},Pt=class{constructor(e){this.root=e;e==null||e.style.setProperty("position","relative")}get width(){return window.innerWidth}get height(){return window.innerHeight}window(e,r){var n,s,a,l;if(r.popup){let c=Math.max((s=(n=r.position)==null?void 0:n.x)!=null?s:0,0),p=Math.max((l=(a=r.position)==null?void 0:a.y)!=null?l:0,0);e.style.setProperty("position","absolute"),e.style.setProperty("left",c+"px"),e.style.setProperty("top",p+"px"),e.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)"),e.style.setProperty("opacity","0"),e.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>e.style.setProperty("opacity","1"))}else e.style.setProperty("opacity","0"),e.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>e.style.setProperty("opacity","1")),e.setAttribute("class","stratum-window");if(this.root)return new Pi(this.root,e,r);let i=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!i)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${r.title}`);return i.document.body.style.setProperty("margin","0px"),i.document.body.appendChild(e),new Bt(i,r)}};var Le=class{constructor(e){this._state="closed";this._diag={iterations:0,missingCommands:[]};this.computer=new ve;this.handlers={closed:new Set,error:new Set};this.envArgs=e,this.host=new Pt,this.env=null,this.options={},this.loop=null}static create(e,r){return C(this,null,function*(){let i=yield Re.loadProject(e,r);return new Le(i)})}speed(e,r){let i=e==="smooth"?new ve:new Ft(r),n=this.computer;return n.running&&(n.stop(),this.loop&&i.run(this.loop)),this.computer=i,this}get state(){return this._state}get diag(){return this._diag}play(e){if(this.loop)return this;e&&(this.host=e instanceof HTMLElement?new Pt(e):e);let r=this.env=new Re(this.envArgs,this.host);this._diag.iterations=0;let i=!0;return this.loop=()=>i?(r.isWaiting()||r.compute().then(n=>{++this._diag.iterations,n&&(this.loop=null,this.env=null,this._state="closed",this.handlers.closed.forEach(s=>s())),i=!n}).catch(n=>{i=!1,this._state="error",console.error(n),this.handlers.error.forEach(s=>s(n.message))}),!0):!1,this.computer.run(this.loop),this._state="playing",this}close(){var e,r;return this._state==="error"?((e=this.env)==null||e.closeAllRes().then(()=>{this.loop=null,this._state="closed"}),this.env=null,this):((r=this.env)==null||r.requestStop(),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,r){return this.handlers[e].add(r),this}off(e,r){return r?this.handlers[e].delete(r):this.handlers[e].clear(),this}};var Ni;window.stratum=(Ni=window.stratum)!=null?Ni:{};window.stratum.player=Le.create;window.stratum.options=G;window.stratum.version="0.10.1";})();
