var stratum=(()=>{var Mf=Object.create,Xr=Object.defineProperty,Cf=Object.getPrototypeOf,Uf=Object.prototype.hasOwnProperty,zf=Object.getOwnPropertyNames,Hf=Object.getOwnPropertyDescriptor,q=Object.assign,Po=e=>Xr(e,"__esModule",{value:!0}),F=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),jf=(e,t)=>{Po(e);for(var r in t)Xr(e,r,{get:t[r],enumerable:!0})},Wf=(e,t,r)=>{if(Po(e),typeof t=="object"||typeof t=="function")for(let i of zf(t))!Uf.call(e,i)&&i!=="default"&&Xr(e,i,{get:()=>t[i],enumerable:!(r=Hf(t,i))||r.enumerable});return e},Gr=e=>e&&e.__esModule?e:Wf(Xr(Mf(Cf(e)),"default",{value:e,enumerable:!0}),e),me=(e,t,r)=>new Promise((i,s)=>{var n=c=>{try{l(r.next(c))}catch(u){s(u)}},o=c=>{try{l(r.throw(c))}catch(u){s(u)}},l=c=>c.done?i(c.value):Promise.resolve(c.value).then(n,o);l((r=r.apply(e,t)).next())}),Uo=F((Zg,Co)=>{Co.exports=pe;function pe(e){if(e)return $f(e)}function $f(e){for(var t in pe.prototype)e[t]=pe.prototype[t];return e}pe.prototype.on=pe.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this};pe.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function i(){r.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this};pe.prototype.off=pe.prototype.removeListener=pe.prototype.removeAllListeners=pe.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(arguments.length==1)return delete this._callbacks[e],this;for(var i,s=0;s<r.length;s++)if(i=r[s],i===t||i.fn===t){r.splice(s,1);break}return this};pe.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var i=0,s=r.length;i<s;++i)r[i].apply(this,t)}return this};pe.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]};pe.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),jo=F((Yg,zo)=>{var Ho=Uo();function hr(){Ho.call(this)}hr.prototype=new Ho;zo.exports=hr;hr.Stream=hr;hr.prototype.pipe=function(e,t){var r=this;function i(d){e.writable&&(e.write(d)===!1&&r.pause&&r.pause())}r.on("data",i);function s(){r.readable&&r.resume&&r.resume()}e.on("drain",s),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",o),r.on("close",l));var n=!1;function o(){if(n)return;n=!0,e.end()}function l(){if(n)return;n=!0,typeof e.destroy=="function"&&e.destroy()}function c(d){if(u(),!this.hasListeners("error"))throw d}r.on("error",c),e.on("error",c);function u(){r.off("data",i),e.off("drain",s),r.off("end",o),r.off("close",l),r.off("error",c),e.off("error",c),r.off("end",u),r.off("close",u),e.off("end",u),e.off("close",u)}return r.on("end",u),r.on("close",u),e.on("end",u),e.on("close",u),e.emit("pipe",r),e}}),nn=F((qg,Wo)=>{Wo.exports=jo()}),Xe=F(be=>{"use strict";be.base64=!0;be.array=!0;be.string=!0;be.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined";be.nodebuffer=typeof Buffer!="undefined";be.uint8array=typeof Uint8Array!="undefined";if(typeof ArrayBuffer=="undefined")be.blob=!1;else{var $o=new ArrayBuffer(0);try{be.blob=new Blob([$o],{type:"application/zip"}).size===0}catch(e){try{var Vf=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,Vo=new Vf;Vo.append($o),be.blob=Vo.getBlob("application/zip").size===0}catch(t){be.blob=!1}}}try{be.nodestream=!!nn().Readable}catch(e){be.nodestream=!1}}),on=F(sn=>{"use strict";var Xf=ee(),Gf=Xe(),Ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";sn.encode=function(e){for(var t=[],r,i,s,n,o,l,c,u=0,d=e.length,_=d,b=Xf.getTypeOf(e)!=="string";u<e.length;)_=d-u,b?(r=e[u++],i=u<d?e[u++]:0,s=u<d?e[u++]:0):(r=e.charCodeAt(u++),i=u<d?e.charCodeAt(u++):0,s=u<d?e.charCodeAt(u++):0),n=r>>2,o=(r&3)<<4|i>>4,l=_>1?(i&15)<<2|s>>6:64,c=_>2?s&63:64,t.push(Ce.charAt(n)+Ce.charAt(o)+Ce.charAt(l)+Ce.charAt(c));return t.join("")};sn.decode=function(e){var t,r,i,s,n,o,l,c=0,u=0,d="data:";if(e.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var _=e.length*3/4;if(e.charAt(e.length-1)===Ce.charAt(64)&&_--,e.charAt(e.length-2)===Ce.charAt(64)&&_--,_%1!==0)throw new Error("Invalid base64 input, bad content length.");var b;for(Gf.uint8array?b=new Uint8Array(_|0):b=new Array(_|0);c<e.length;)s=Ce.indexOf(e.charAt(c++)),n=Ce.indexOf(e.charAt(c++)),o=Ce.indexOf(e.charAt(c++)),l=Ce.indexOf(e.charAt(c++)),t=s<<2|n>>4,r=(n&15)<<4|o>>2,i=(o&3)<<6|l,b[u++]=t,o!==64&&(b[u++]=r),l!==64&&(b[u++]=i);return b}}),cr=F((Qg,Xo)=>{"use strict";Xo.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}}),Zo=F((e_,Go)=>{"use strict";Go.exports=typeof setImmediate=="function"?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}),ea=F((t_,Yo)=>{"use strict";var qo=global.MutationObserver||global.WebKitMutationObserver,dr;if(qo){var Ko=0,Zf=new qo(Yr),Jo=global.document.createTextNode("");Zf.observe(Jo,{characterData:!0}),dr=function(){Jo.data=Ko=++Ko%2}}else if(!global.setImmediate&&typeof global.MessageChannel!="undefined"){var Qo=new global.MessageChannel;Qo.port1.onmessage=Yr,dr=function(){Qo.port2.postMessage(0)}}else"document"in global&&"onreadystatechange"in global.document.createElement("script")?dr=function(){var e=global.document.createElement("script");e.onreadystatechange=function(){Yr(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:dr=function(){setTimeout(Yr,0)};var an,fr=[];function Yr(){an=!0;for(var e,t,r=fr.length;r;){for(t=fr,fr=[],e=-1;++e<r;)t[e]();r=fr.length}an=!1}Yo.exports=Yf;function Yf(e){fr.push(e)===1&&!an&&dr()}}),oa=F((r_,ta)=>{"use strict";var qf=ea();function Ft(){}var le={},ra=["REJECTED"],ln=["FULFILLED"],ia=["PENDING"];ta.exports=Je;function Je(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=ia,this.queue=[],this.outcome=void 0,e!==Ft&&na(this,e)}Je.prototype.finally=function(e){if(typeof e!="function")return this;var t=this.constructor;return this.then(r,i);function r(s){function n(){return s}return t.resolve(e()).then(n)}function i(s){function n(){throw s}return t.resolve(e()).then(n)}};Je.prototype.catch=function(e){return this.then(null,e)};Je.prototype.then=function(e,t){if(typeof e!="function"&&this.state===ln||typeof t!="function"&&this.state===ra)return this;var r=new this.constructor(Ft);if(this.state!==ia){var i=this.state===ln?e:t;un(r,i,this.outcome)}else this.queue.push(new mr(r,e,t));return r};function mr(e,t,r){this.promise=e,typeof t=="function"&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),typeof r=="function"&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}mr.prototype.callFulfilled=function(e){le.resolve(this.promise,e)};mr.prototype.otherCallFulfilled=function(e){un(this.promise,this.onFulfilled,e)};mr.prototype.callRejected=function(e){le.reject(this.promise,e)};mr.prototype.otherCallRejected=function(e){un(this.promise,this.onRejected,e)};function un(e,t,r){qf(function(){var i;try{i=t(r)}catch(s){return le.reject(e,s)}i===e?le.reject(e,new TypeError("Cannot resolve promise with itself")):le.resolve(e,i)})}le.resolve=function(e,t){var r=sa(Kf,t);if(r.status==="error")return le.reject(e,r.value);var i=r.value;if(i)na(e,i);else{e.state=ln,e.outcome=t;for(var s=-1,n=e.queue.length;++s<n;)e.queue[s].callFulfilled(t)}return e};le.reject=function(e,t){e.state=ra,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callRejected(t);return e};function Kf(e){var t=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof t=="function")return function(){t.apply(e,arguments)}}function na(e,t){var r=!1;function i(l){if(r)return;r=!0,le.reject(e,l)}function s(l){if(r)return;r=!0,le.resolve(e,l)}function n(){t(s,i)}var o=sa(n);o.status==="error"&&i(o.value)}function sa(e,t){var r={};try{r.value=e(t),r.status="success"}catch(i){r.status="error",r.value=i}return r}Je.resolve=Jf;function Jf(e){return e instanceof this?e:le.resolve(new this(Ft),e)}Je.reject=Qf;function Qf(e){var t=new this(Ft);return le.reject(t,e)}Je.all=em;function em(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var s=new Array(r),n=0,o=-1,l=new this(Ft);++o<r;)c(e[o],o);return l;function c(u,d){t.resolve(u).then(_,function(b){i||(i=!0,le.reject(l,b))});function _(b){s[d]=b,++n===r&&!i&&(i=!0,le.resolve(l,s))}}}Je.race=tm;function tm(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var s=-1,n=new this(Ft);++s<r;)o(e[s]);return n;function o(l){t.resolve(l).then(function(c){i||(i=!0,le.resolve(n,c))},function(c){i||(i=!0,le.reject(n,c))})}}}),Pt=F((i_,aa)=>{"use strict";var hn=null;typeof Promise!="undefined"?hn=Promise:hn=oa();aa.exports={Promise:hn}}),ee=F(ne=>{"use strict";var Qe=Xe(),rm=on(),Mt=cr(),im=Zo(),cn=Pt();function nm(e){var t=null;return Qe.uint8array?t=new Uint8Array(e.length):t=new Array(e.length),qr(e,t)}ne.newBlob=function(e,t){ne.checkSupport("blob");try{return new Blob([e],{type:t})}catch(s){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,i=new r;return i.append(e),i.getBlob(t)}catch(n){throw new Error("Bug : can't construct the Blob.")}}};function pr(e){return e}function qr(e,t){for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)&255;return t}var Kr={stringifyByChunk:function(e,t,r){var i=[],s=0,n=e.length;if(n<=r)return String.fromCharCode.apply(null,e);for(;s<n;)t==="array"||t==="nodebuffer"?i.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+r,n)))):i.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+r,n)))),s+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return Qe.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return!1}}(),nodebuffer:function(){try{return Qe.nodebuffer&&String.fromCharCode.apply(null,Mt.allocBuffer(1)).length===1}catch(e){return!1}}()}};function br(e){var t=65536,r=ne.getTypeOf(e),i=!0;if(r==="uint8array"?i=Kr.applyCanBeUsed.uint8array:r==="nodebuffer"&&(i=Kr.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return Kr.stringifyByChunk(e,r,t)}catch(s){t=Math.floor(t/2)}return Kr.stringifyByChar(e)}ne.applyFromCharCode=br;function Jr(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var et={};et.string={string:pr,array:function(e){return qr(e,new Array(e.length))},arraybuffer:function(e){return et.string.uint8array(e).buffer},uint8array:function(e){return qr(e,new Uint8Array(e.length))},nodebuffer:function(e){return qr(e,Mt.allocBuffer(e.length))}};et.array={string:br,array:pr,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Mt.newBufferFrom(e)}};et.arraybuffer={string:function(e){return br(new Uint8Array(e))},array:function(e){return Jr(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:pr,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Mt.newBufferFrom(new Uint8Array(e))}};et.uint8array={string:br,array:function(e){return Jr(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:pr,nodebuffer:function(e){return Mt.newBufferFrom(e)}};et.nodebuffer={string:br,array:function(e){return Jr(e,new Array(e.length))},arraybuffer:function(e){return et.nodebuffer.uint8array(e).buffer},uint8array:function(e){return Jr(e,new Uint8Array(e.length))},nodebuffer:pr};ne.transformTo=function(e,t){if(t||(t=""),!e)return t;ne.checkSupport(e);var r=ne.getTypeOf(t),i=et[r][e](t);return i};ne.getTypeOf=function(e){if(typeof e=="string")return"string";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(Qe.nodebuffer&&Mt.isBuffer(e))return"nodebuffer";if(Qe.uint8array&&e instanceof Uint8Array)return"uint8array";if(Qe.arraybuffer&&e instanceof ArrayBuffer)return"arraybuffer"};ne.checkSupport=function(e){var t=Qe[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")};ne.MAX_VALUE_16BITS=65535;ne.MAX_VALUE_32BITS=-1;ne.pretty=function(e){var t="",r,i;for(i=0;i<(e||"").length;i++)r=e.charCodeAt(i),t+="\\x"+(r<16?"0":"")+r.toString(16).toUpperCase();return t};ne.delay=function(e,t,r){im(function(){e.apply(r||null,t||[])})};ne.inherits=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r};ne.extend=function(){var e={},t,r;for(t=0;t<arguments.length;t++)for(r in arguments[t])arguments[t].hasOwnProperty(r)&&typeof e[r]=="undefined"&&(e[r]=arguments[t][r]);return e};ne.prepareContent=function(e,t,r,i,s){var n=cn.Promise.resolve(t).then(function(o){var l=Qe.blob&&(o instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(o))!==-1);return l&&typeof FileReader!="undefined"?new cn.Promise(function(c,u){var d=new FileReader;d.onload=function(_){c(_.target.result)},d.onerror=function(_){u(_.target.error)},d.readAsArrayBuffer(o)}):o});return n.then(function(o){var l=ne.getTypeOf(o);return l?(l==="arraybuffer"?o=ne.transformTo("uint8array",o):l==="string"&&(s?o=rm.decode(o):r&&(i!==!0&&(o=nm(o)))),o):cn.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}}),ge=F((s_,la)=>{"use strict";function ua(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}ua.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.end()}),e.on("error",function(r){t.error(r)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(e))continue;this.streamInfo[e]=this.extraStreamInfo[e]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}};la.exports=ua}),_t=F(tt=>{"use strict";var Ct=ee(),gt=Xe(),sm=cr(),Qr=ge(),gr=new Array(256);for(var rt=0;rt<256;rt++)gr[rt]=rt>=252?6:rt>=248?5:rt>=240?4:rt>=224?3:rt>=192?2:1;gr[254]=gr[254]=1;var om=function(e){var t,r,i,s,n,o=e.length,l=0;for(s=0;s<o;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<o&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(gt.uint8array?t=new Uint8Array(l):t=new Array(l),n=0,s=0;n<l;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<o&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|r&63):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|r&63):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|r&63);return t},am=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+gr[e[r]]>t?r:t},lm=function(e){var t,r,i,s,n,o=e.length,l=new Array(o*2);for(i=0,r=0;r<o;){if(s=e[r++],s<128){l[i++]=s;continue}if(n=gr[s],n>4){l[i++]=65533,r+=n-1;continue}for(s&=n===2?31:n===3?15:7;n>1&&r<o;)s=s<<6|e[r++]&63,n--;if(n>1){l[i++]=65533;continue}s<65536?l[i++]=s:(s-=65536,l[i++]=55296|s>>10&1023,l[i++]=56320|s&1023)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),Ct.applyFromCharCode(l)};tt.utf8encode=function(t){return gt.nodebuffer?sm.newBufferFrom(t,"utf-8"):om(t)};tt.utf8decode=function(t){return gt.nodebuffer?Ct.transformTo("nodebuffer",t).toString("utf-8"):(t=Ct.transformTo(gt.uint8array?"uint8array":"array",t),lm(t))};function ei(){Qr.call(this,"utf-8 decode"),this.leftOver=null}Ct.inherits(ei,Qr);ei.prototype.processChunk=function(e){var t=Ct.transformTo(gt.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(gt.uint8array){var r=t;t=new Uint8Array(r.length+this.leftOver.length),t.set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=am(t),s=t;i!==t.length&&(gt.uint8array?(s=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(s=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:tt.utf8decode(s),meta:e.meta})};ei.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:tt.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};tt.Utf8DecodeWorker=ei;function dn(){Qr.call(this,"utf-8 encode")}Ct.inherits(dn,Qr);dn.prototype.processChunk=function(e){this.push({data:tt.utf8encode(e.data),meta:e.meta})};tt.Utf8EncodeWorker=dn}),fa=F((a_,ha)=>{"use strict";var ca=ge(),da=ee();function fn(e){ca.call(this,"ConvertWorker to "+e),this.destType=e}da.inherits(fn,ca);fn.prototype.processChunk=function(e){this.push({data:da.transformTo(this.destType,e.data),meta:e.meta})};ha.exports=fn}),ba=F((l_,ma)=>{"use strict";var pa=nn().Readable,um=ee();um.inherits(mn,pa);function mn(e,t,r){pa.call(this,t),this._helper=e;var i=this;e.on("data",function(s,n){i.push(s)||i._helper.pause(),r&&r(n)}).on("error",function(s){i.emit("error",s)}).on("end",function(){i.push(null)})}mn.prototype._read=function(){this._helper.resume()};ma.exports=mn}),pn=F((u_,ga)=>{"use strict";var wt=ee(),hm=fa(),cm=ge(),dm=on(),fm=Xe(),mm=Pt(),_a=null;if(fm.nodestream)try{_a=ba()}catch(e){}function pm(e,t,r){switch(e){case"blob":return wt.newBlob(wt.transformTo("arraybuffer",t),r);case"base64":return dm.encode(t);default:return wt.transformTo(e,t)}}function bm(e,t){var r,i=0,s=null,n=0;for(r=0;r<t.length;r++)n+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(s=new Uint8Array(n),r=0;r<t.length;r++)s.set(t[r],i),i+=t[r].length;return s;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function gm(e,t){return new mm.Promise(function(r,i){var s=[],n=e._internalType,o=e._outputType,l=e._mimeType;e.on("data",function(c,u){s.push(c),t&&t(u)}).on("error",function(c){s=[],i(c)}).on("end",function(){try{var c=pm(o,bm(n,s),l);r(c)}catch(u){i(u)}s=[]}).resume()})}function wa(e,t,r){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string";break}try{this._internalType=i,this._outputType=t,this._mimeType=r,wt.checkSupport(i),this._worker=e.pipe(new hm(i)),e.lock()}catch(s){this._worker=new cm("error"),this._worker.error(s)}}wa.prototype={accumulate:function(e){return gm(this,e)},on:function(e,t){var r=this;return e==="data"?this._worker.on(e,function(i){t.call(r,i.data,i.meta)}):this._worker.on(e,function(){wt.delay(t,arguments,r)}),this},resume:function(){return wt.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(wt.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new _a(this,{objectMode:this._outputType!=="nodebuffer"},e)}};ga.exports=wa}),bn=F(Oe=>{"use strict";Oe.base64=!1;Oe.binary=!1;Oe.dir=!1;Oe.createFolders=!0;Oe.date=null;Oe.compression=null;Oe.compressionOptions=null;Oe.comment=null;Oe.unixPermissions=null;Oe.dosPermissions=null}),gn=F((c_,ya)=>{"use strict";var ti=ee(),ri=ge(),_m=16*1024;function Ut(e){ri.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(r){t.dataIsReady=!0,t.data=r,t.max=r&&r.length||0,t.type=ti.getTypeOf(r),t.isPaused||t._tickAndRepeat()},function(r){t.error(r)})}ti.inherits(Ut,ri);Ut.prototype.cleanUp=function(){ri.prototype.cleanUp.call(this),this.data=null};Ut.prototype.resume=function(){return ri.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,ti.delay(this._tickAndRepeat,[],this)),!0):!1};Ut.prototype._tickAndRepeat=function(){if(this._tickScheduled=!1,this.isPaused||this.isFinished)return;this._tick(),this.isFinished||(ti.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)};Ut.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=_m,t=null,r=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,r);break;case"uint8array":t=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":t=this.data.slice(this.index,r);break}return this.index=r,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};ya.exports=Ut}),yn=F((d_,va)=>{"use strict";var wm=ee(),_n=ge();function wn(e){_n.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}wm.inherits(wn,_n);wn.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}_n.prototype.processChunk.call(this,e)};va.exports=wn}),ii=F((f_,Sa)=>{"use strict";var ym=ee();function vm(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var Ta=vm();function Sm(e,t,r,i){var s=Ta,n=i+r;e=e^-1;for(var o=i;o<n;o++)e=e>>>8^s[(e^t[o])&255];return e^-1}function Tm(e,t,r,i){var s=Ta,n=i+r;e=e^-1;for(var o=i;o<n;o++)e=e>>>8^s[(e^t.charCodeAt(o))&255];return e^-1}Sa.exports=function(t,r){if(typeof t=="undefined"||!t.length)return 0;var i=ym.getTypeOf(t)!=="string";return i?Sm(r|0,t,t.length,0):Tm(r|0,t,t.length,0)}}),Sn=F((m_,xa)=>{"use strict";var Ea=ge(),xm=ii(),Em=ee();function vn(){Ea.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Em.inherits(vn,Ea);vn.prototype.processChunk=function(e){this.streamInfo.crc32=xm(e.data,this.streamInfo.crc32||0),this.push(e)};xa.exports=vn}),si=F((p_,Ia)=>{"use strict";var Oa=Pt(),Aa=gn(),ni=yn(),Im=Sn(),ni=yn();function Tn(e,t,r,i,s){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=s}Tn.prototype={getContentWorker:function(){var e=new Aa(Oa.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new ni("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new Aa(Oa.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};Tn.createWorkerFrom=function(e,t,r){return e.pipe(new Im).pipe(new ni("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new ni("compressedSize")).withStreamInfo("compression",t)};Ia.exports=Tn}),Ba=F((b_,Da)=>{"use strict";var Om=pn(),Am=gn(),xn=_t(),En=si(),Na=ge(),In=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};In.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");r=e.toLowerCase();var i=r==="string"||r==="text";(r==="binarystring"||r==="text")&&(r="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(t=t.pipe(new xn.Utf8EncodeWorker)),!s&&i&&(t=t.pipe(new xn.Utf8DecodeWorker))}catch(n){t=new Na("error"),t.error(n)}return new Om(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof En&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new xn.Utf8EncodeWorker)),En.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof En?this._data.getContentWorker():this._data instanceof Na?this._data:new Am(this._data)}};var Ra=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Dm=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var On=0;On<Ra.length;On++)In.prototype[Ra[On]]=Dm;Da.exports=In}),Ge=F(he=>{"use strict";var Nm=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function Rm(e,t){return Object.prototype.hasOwnProperty.call(e,t)}he.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(!r)continue;if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var i in r)Rm(r,i)&&(e[i]=r[i])}return e};he.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var Bm={arraySet:function(e,t,r,i,s){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),s);return}for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){var t,r,i,s,n,o;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(o=new Uint8Array(i),s=0,t=0,r=e.length;t<r;t++)n=e[t],o.set(n,s),s+=n.length;return o}},km={arraySet:function(e,t,r,i,s){for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};he.setTyped=function(e){e?(he.Buf8=Uint8Array,he.Buf16=Uint16Array,he.Buf32=Int32Array,he.assign(he,Bm)):(he.Buf8=Array,he.Buf16=Array,he.Buf32=Array,he.assign(he,km))};he.setTyped(Nm)}),tl=F(zt=>{"use strict";var Lm=Ge(),Fm=4,ka=0,La=1,Pm=2;function Ht(e){for(var t=e.length;--t>=0;)e[t]=0}var Mm=0,Fa=1,Cm=2,Um=3,zm=258,An=29,_r=256,wr=_r+1+An,jt=30,Dn=19,Pa=2*wr+1,yt=15,Nn=16,Hm=7,Rn=256,Ma=16,Ca=17,Ua=18,Bn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],oi=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],jm=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],za=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Wm=512,Ze=new Array((wr+2)*2);Ht(Ze);var yr=new Array(jt*2);Ht(yr);var vr=new Array(Wm);Ht(vr);var Sr=new Array(zm-Um+1);Ht(Sr);var kn=new Array(An);Ht(kn);var ai=new Array(jt);Ht(ai);function Ln(e,t,r,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}var Ha,ja,Wa;function Fn(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function $a(e){return e<256?vr[e]:vr[256+(e>>>7)]}function Tr(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function de(e,t,r){e.bi_valid>Nn-r?(e.bi_buf|=t<<e.bi_valid&65535,Tr(e,e.bi_buf),e.bi_buf=t>>Nn-e.bi_valid,e.bi_valid+=r-Nn):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function Ue(e,t,r){de(e,r[t*2],r[t*2+1])}function Va(e,t){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1}function $m(e){e.bi_valid===16?(Tr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function Vm(e,t){var r=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length,u,d,_,b,g,T,w=0;for(b=0;b<=yt;b++)e.bl_count[b]=0;for(r[e.heap[e.heap_max]*2+1]=0,u=e.heap_max+1;u<Pa;u++){if(d=e.heap[u],b=r[r[d*2+1]*2+1]+1,b>c&&(b=c,w++),r[d*2+1]=b,d>i)continue;e.bl_count[b]++,g=0,d>=l&&(g=o[d-l]),T=r[d*2],e.opt_len+=T*(b+g),n&&(e.static_len+=T*(s[d*2+1]+g))}if(w===0)return;do{for(b=c-1;e.bl_count[b]===0;)b--;e.bl_count[b]--,e.bl_count[b+1]+=2,e.bl_count[c]--,w-=2}while(w>0);for(b=c;b!==0;b--)for(d=e.bl_count[b];d!==0;){if(_=e.heap[--u],_>i)continue;r[_*2+1]!==b&&(e.opt_len+=(b-r[_*2+1])*r[_*2],r[_*2+1]=b),d--}}function Xa(e,t,r){var i=new Array(yt+1),s=0,n,o;for(n=1;n<=yt;n++)i[n]=s=s+r[n-1]<<1;for(o=0;o<=t;o++){var l=e[o*2+1];if(l===0)continue;e[o*2]=Va(i[l]++,l)}}function Xm(){var e,t,r,i,s,n=new Array(yt+1);for(r=0,i=0;i<An-1;i++)for(kn[i]=r,e=0;e<1<<Bn[i];e++)Sr[r++]=i;for(Sr[r-1]=i,s=0,i=0;i<16;i++)for(ai[i]=s,e=0;e<1<<oi[i];e++)vr[s++]=i;for(s>>=7;i<jt;i++)for(ai[i]=s<<7,e=0;e<1<<oi[i]-7;e++)vr[256+s++]=i;for(t=0;t<=yt;t++)n[t]=0;for(e=0;e<=143;)Ze[e*2+1]=8,e++,n[8]++;for(;e<=255;)Ze[e*2+1]=9,e++,n[9]++;for(;e<=279;)Ze[e*2+1]=7,e++,n[7]++;for(;e<=287;)Ze[e*2+1]=8,e++,n[8]++;for(Xa(Ze,wr+1,n),e=0;e<jt;e++)yr[e*2+1]=5,yr[e*2]=Va(e,5);Ha=new Ln(Ze,Bn,_r+1,wr,yt),ja=new Ln(yr,oi,0,jt,yt),Wa=new Ln(new Array(0),jm,0,Dn,Hm)}function Ga(e){var t;for(t=0;t<wr;t++)e.dyn_ltree[t*2]=0;for(t=0;t<jt;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Dn;t++)e.bl_tree[t*2]=0;e.dyn_ltree[Rn*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Za(e){e.bi_valid>8?Tr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Gm(e,t,r,i){Za(e),i&&(Tr(e,r),Tr(e,~r)),Lm.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function Ya(e,t,r,i){var s=t*2,n=r*2;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[r]}function Pn(e,t,r){for(var i=e.heap[r],s=r<<1;s<=e.heap_len&&!(s<e.heap_len&&Ya(t,e.heap[s+1],e.heap[s],e.depth)&&s++,Ya(t,i,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=i}function qa(e,t,r){var i,s,n=0,o,l;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+n*2]<<8|e.pending_buf[e.d_buf+n*2+1],s=e.pending_buf[e.l_buf+n],n++,i===0?Ue(e,s,t):(o=Sr[s],Ue(e,o+_r+1,t),l=Bn[o],l!==0&&(s-=kn[o],de(e,s,l)),i--,o=$a(i),Ue(e,o,r),l=oi[o],l!==0&&(i-=ai[o],de(e,i,l)));while(n<e.last_lit);Ue(e,Rn,t)}function Mn(e,t){var r=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems,o,l,c=-1,u;for(e.heap_len=0,e.heap_max=Pa,o=0;o<n;o++)r[o*2]!==0?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):r[o*2+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=c<2?++c:0,r[u*2]=1,e.depth[u]=0,e.opt_len--,s&&(e.static_len-=i[u*2+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Pn(e,r,o);u=n;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Pn(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,r[u*2]=r[o*2]+r[l*2],e.depth[u]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,r[o*2+1]=r[l*2+1]=u,e.heap[1]=u++,Pn(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Vm(e,t),Xa(r,c,e.bl_count)}function Ka(e,t,r){var i,s=-1,n,o=t[0*2+1],l=0,c=7,u=4;for(o===0&&(c=138,u=3),t[(r+1)*2+1]=65535,i=0;i<=r;i++){if(n=o,o=t[(i+1)*2+1],++l<c&&n===o)continue;l<u?e.bl_tree[n*2]+=l:n!==0?(n!==s&&e.bl_tree[n*2]++,e.bl_tree[Ma*2]++):l<=10?e.bl_tree[Ca*2]++:e.bl_tree[Ua*2]++,l=0,s=n,o===0?(c=138,u=3):n===o?(c=6,u=3):(c=7,u=4)}}function Ja(e,t,r){var i,s=-1,n,o=t[0*2+1],l=0,c=7,u=4;for(o===0&&(c=138,u=3),i=0;i<=r;i++){if(n=o,o=t[(i+1)*2+1],++l<c&&n===o)continue;if(l<u)do Ue(e,n,e.bl_tree);while(--l!==0);else n!==0?(n!==s&&(Ue(e,n,e.bl_tree),l--),Ue(e,Ma,e.bl_tree),de(e,l-3,2)):l<=10?(Ue(e,Ca,e.bl_tree),de(e,l-3,3)):(Ue(e,Ua,e.bl_tree),de(e,l-11,7));l=0,s=n,o===0?(c=138,u=3):n===o?(c=6,u=3):(c=7,u=4)}}function Zm(e){var t;for(Ka(e,e.dyn_ltree,e.l_desc.max_code),Ka(e,e.dyn_dtree,e.d_desc.max_code),Mn(e,e.bl_desc),t=Dn-1;t>=3&&!(e.bl_tree[za[t]*2+1]!==0);t--);return e.opt_len+=3*(t+1)+5+5+4,t}function Ym(e,t,r,i){var s;for(de(e,t-257,5),de(e,r-1,5),de(e,i-4,4),s=0;s<i;s++)de(e,e.bl_tree[za[s]*2+1],3);Ja(e,e.dyn_ltree,t-1),Ja(e,e.dyn_dtree,r-1)}function qm(e){var t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return ka;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return La;for(r=32;r<_r;r++)if(e.dyn_ltree[r*2]!==0)return La;return ka}var Qa=!1;function Km(e){Qa||(Xm(),Qa=!0),e.l_desc=new Fn(e.dyn_ltree,Ha),e.d_desc=new Fn(e.dyn_dtree,ja),e.bl_desc=new Fn(e.bl_tree,Wa),e.bi_buf=0,e.bi_valid=0,Ga(e)}function el(e,t,r,i){de(e,(Mm<<1)+(i?1:0),3),Gm(e,t,r,!0)}function Jm(e){de(e,Fa<<1,3),Ue(e,Rn,Ze),$m(e)}function Qm(e,t,r,i){var s,n,o=0;e.level>0?(e.strm.data_type===Pm&&(e.strm.data_type=qm(e)),Mn(e,e.l_desc),Mn(e,e.d_desc),o=Zm(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=r+5,r+4<=s&&t!==-1?el(e,t,r,i):e.strategy===Fm||n===s?(de(e,(Fa<<1)+(i?1:0),3),qa(e,Ze,yr)):(de(e,(Cm<<1)+(i?1:0),3),Ym(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),qa(e,e.dyn_ltree,e.dyn_dtree)),Ga(e),i&&Za(e)}function ep(e,t,r){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(Sr[r]+_r+1)*2]++,e.dyn_dtree[$a(t)*2]++),e.last_lit===e.lit_bufsize-1}zt._tr_init=Km;zt._tr_stored_block=el;zt._tr_flush_block=Qm;zt._tr_tally=ep;zt._tr_align=Jm}),Cn=F((w_,rl)=>{"use strict";function tp(e,t,r,i){for(var s=e&65535|0,n=e>>>16&65535|0,o=0;r!==0;){o=r>2e3?2e3:r,r-=o;do s=s+t[i++]|0,n=n+s|0;while(--o);s%=65521,n%=65521}return s|n<<16|0}rl.exports=tp}),Un=F((y_,il)=>{"use strict";function rp(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var ip=rp();function np(e,t,r,i){var s=ip,n=i+r;e^=-1;for(var o=i;o<n;o++)e=e>>>8^s[(e^t[o])&255];return e^-1}il.exports=np}),li=F((v_,nl)=>{"use strict";nl.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),fl=F(ze=>{"use strict";var ce=Ge(),Se=tl(),sl=Cn(),it=Un(),sp=li(),vt=0,op=1,ap=3,nt=4,ol=5,He=0,al=1,Te=-2,lp=-3,zn=-5,up=-1,hp=1,ui=2,cp=3,dp=4,fp=0,mp=2,hi=8,pp=9,bp=15,gp=8,_p=29,wp=256,Hn=wp+1+_p,yp=30,vp=19,Sp=2*Hn+1,Tp=15,X=3,st=258,Ae=st+X+1,xp=32,ci=42,jn=69,di=73,fi=91,mi=103,St=113,xr=666,se=1,Er=2,Tt=3,Wt=4,Ep=3;function ot(e,t){return e.msg=sp[t],t}function ll(e){return(e<<1)-(e>4?9:0)}function at(e){for(var t=e.length;--t>=0;)e[t]=0}function lt(e){var t=e.state,r=t.pending;if(r>e.avail_out&&(r=e.avail_out),r===0)return;ce.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0)}function ae(e,t){Se._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,lt(e.strm)}function G(e,t){e.pending_buf[e.pending++]=t}function Ir(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function Ip(e,t,r,i){var s=e.avail_in;return s>i&&(s=i),s===0?0:(e.avail_in-=s,ce.arraySet(t,e.input,e.next_in,s,r),e.state.wrap===1?e.adler=sl(e.adler,t,s,r):e.state.wrap===2&&(e.adler=it(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)}function ul(e,t){var r=e.max_chain_length,i=e.strstart,s,n,o=e.prev_length,l=e.nice_match,c=e.strstart>e.w_size-Ae?e.strstart-(e.w_size-Ae):0,u=e.window,d=e.w_mask,_=e.prev,b=e.strstart+st,g=u[i+o-1],T=u[i+o];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do{if(s=t,u[s+o]!==T||u[s+o-1]!==g||u[s]!==u[i]||u[++s]!==u[i+1])continue;i+=2,s++;do;while(u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&u[++i]===u[++s]&&i<b);if(n=st-(b-i),i=b-st,n>o){if(e.match_start=t,o=n,n>=l)break;g=u[i+o-1],T=u[i+o]}}while((t=_[t&d])>c&&--r!==0);return o<=e.lookahead?o:e.lookahead}function xt(e){var t=e.w_size,r,i,s,n,o;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ae)){ce.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,r=i;do s=e.head[--r],e.head[r]=s>=t?s-t:0;while(--i);i=t,r=i;do s=e.prev[--r],e.prev[r]=s>=t?s-t:0;while(--i);n+=t}if(e.strm.avail_in===0)break;if(i=Ip(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=X)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&!(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+X-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,e.lookahead+e.insert<X););}while(e.lookahead<Ae&&e.strm.avail_in!==0)}function Op(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(xt(e),e.lookahead===0&&t===vt)return se;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,ae(e,!1),e.strm.avail_out===0))return se;if(e.strstart-e.block_start>=e.w_size-Ae&&(ae(e,!1),e.strm.avail_out===0))return se}return e.insert=0,t===nt?(ae(e,!0),e.strm.avail_out===0?Tt:Wt):(e.strstart>e.block_start&&(ae(e,!1),e.strm.avail_out===0),se)}function Wn(e,t){for(var r,i;;){if(e.lookahead<Ae){if(xt(e),e.lookahead<Ae&&t===vt)return se;if(e.lookahead===0)break}if(r=0,e.lookahead>=X&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+X-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Ae&&(e.match_length=ul(e,r)),e.match_length>=X)if(i=Se._tr_tally(e,e.strstart-e.match_start,e.match_length-X),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=X){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+X-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=Se._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(ae(e,!1),e.strm.avail_out===0))return se}return e.insert=e.strstart<X-1?e.strstart:X-1,t===nt?(ae(e,!0),e.strm.avail_out===0?Tt:Wt):e.last_lit&&(ae(e,!1),e.strm.avail_out===0)?se:Er}function $t(e,t){for(var r,i,s;;){if(e.lookahead<Ae){if(xt(e),e.lookahead<Ae&&t===vt)return se;if(e.lookahead===0)break}if(r=0,e.lookahead>=X&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+X-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=X-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ae&&(e.match_length=ul(e,r),e.match_length<=5&&(e.strategy===hp||e.match_length===X&&e.strstart-e.match_start>4096)&&(e.match_length=X-1)),e.prev_length>=X&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-X,i=Se._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-X),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+X-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=X-1,e.strstart++,i&&(ae(e,!1),e.strm.avail_out===0))return se}else if(e.match_available){if(i=Se._tr_tally(e,0,e.window[e.strstart-1]),i&&ae(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return se}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Se._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<X-1?e.strstart:X-1,t===nt?(ae(e,!0),e.strm.avail_out===0?Tt:Wt):e.last_lit&&(ae(e,!1),e.strm.avail_out===0)?se:Er}function Ap(e,t){for(var r,i,s,n,o=e.window;;){if(e.lookahead<=st){if(xt(e),e.lookahead<=st&&t===vt)return se;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=X&&e.strstart>0&&(s=e.strstart-1,i=o[s],i===o[++s]&&i===o[++s]&&i===o[++s])){n=e.strstart+st;do;while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<n);e.match_length=st-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=X?(r=Se._tr_tally(e,1,e.match_length-X),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Se._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ae(e,!1),e.strm.avail_out===0))return se}return e.insert=0,t===nt?(ae(e,!0),e.strm.avail_out===0?Tt:Wt):e.last_lit&&(ae(e,!1),e.strm.avail_out===0)?se:Er}function Dp(e,t){for(var r;;){if(e.lookahead===0&&(xt(e),e.lookahead===0)){if(t===vt)return se;break}if(e.match_length=0,r=Se._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ae(e,!1),e.strm.avail_out===0))return se}return e.insert=0,t===nt?(ae(e,!0),e.strm.avail_out===0?Tt:Wt):e.last_lit&&(ae(e,!1),e.strm.avail_out===0)?se:Er}function je(e,t,r,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=s}var Vt;Vt=[new je(0,0,0,0,Op),new je(4,4,8,4,Wn),new je(4,5,16,8,Wn),new je(4,6,32,32,Wn),new je(4,4,16,16,$t),new je(8,16,32,32,$t),new je(8,16,128,128,$t),new je(8,32,128,256,$t),new je(32,128,258,1024,$t),new je(32,258,258,4096,$t)];function Np(e){e.window_size=2*e.w_size,at(e.head),e.max_lazy_match=Vt[e.level].max_lazy,e.good_match=Vt[e.level].good_length,e.nice_match=Vt[e.level].nice_length,e.max_chain_length=Vt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=X-1,e.match_available=0,e.ins_h=0}function Rp(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=hi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ce.Buf16(Sp*2),this.dyn_dtree=new ce.Buf16((2*yp+1)*2),this.bl_tree=new ce.Buf16((2*vp+1)*2),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ce.Buf16(Tp+1),this.heap=new ce.Buf16(2*Hn+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ce.Buf16(2*Hn+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function hl(e){var t;return!e||!e.state?ot(e,Te):(e.total_in=e.total_out=0,e.data_type=mp,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ci:St,e.adler=t.wrap===2?0:1,t.last_flush=vt,Se._tr_init(t),He)}function cl(e){var t=hl(e);return t===He&&Np(e.state),t}function Bp(e,t){return!e||!e.state||e.state.wrap!==2?Te:(e.state.gzhead=t,He)}function dl(e,t,r,i,s,n){if(!e)return Te;var o=1;if(t===up&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>pp||r!==hi||i<8||i>15||t<0||t>9||n<0||n>dp)return ot(e,Te);i===8&&(i=9);var l=new Rp;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+X-1)/X),l.window=new ce.Buf8(l.w_size*2),l.head=new ce.Buf16(l.hash_size),l.prev=new ce.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new ce.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=(1+2)*l.lit_bufsize,l.level=t,l.strategy=n,l.method=r,cl(e)}function kp(e,t){return dl(e,t,hi,bp,gp,fp)}function Lp(e,t){var r,i,s,n;if(!e||!e.state||t>ol||t<0)return e?ot(e,Te):Te;if(i=e.state,!e.output||!e.input&&e.avail_in!==0||i.status===xr&&t!==nt)return ot(e,e.avail_out===0?zn:Te);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===ci)if(i.wrap===2)e.adler=0,G(i,31),G(i,139),G(i,8),i.gzhead?(G(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),G(i,i.gzhead.time&255),G(i,i.gzhead.time>>8&255),G(i,i.gzhead.time>>16&255),G(i,i.gzhead.time>>24&255),G(i,i.level===9?2:i.strategy>=ui||i.level<2?4:0),G(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(G(i,i.gzhead.extra.length&255),G(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=it(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=jn):(G(i,0),G(i,0),G(i,0),G(i,0),G(i,0),G(i,i.level===9?2:i.strategy>=ui||i.level<2?4:0),G(i,Ep),i.status=St);else{var o=hi+(i.w_bits-8<<4)<<8,l=-1;i.strategy>=ui||i.level<2?l=0:i.level<6?l=1:i.level===6?l=2:l=3,o|=l<<6,i.strstart!==0&&(o|=xp),o+=31-o%31,i.status=St,Ir(i,o),i.strstart!==0&&(Ir(i,e.adler>>>16),Ir(i,e.adler&65535)),e.adler=1}if(i.status===jn)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),lt(e),s=i.pending,i.pending===i.pending_buf_size));)G(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=di)}else i.status=di;if(i.status===di)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),lt(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,G(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),n===0&&(i.gzindex=0,i.status=fi)}else i.status=fi;if(i.status===fi)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),lt(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,G(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=it(e.adler,i.pending_buf,i.pending-s,s)),n===0&&(i.status=mi)}else i.status=mi;if(i.status===mi&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&lt(e),i.pending+2<=i.pending_buf_size&&(G(i,e.adler&255),G(i,e.adler>>8&255),e.adler=0,i.status=St)):i.status=St),i.pending!==0){if(lt(e),e.avail_out===0)return i.last_flush=-1,He}else if(e.avail_in===0&&ll(t)<=ll(r)&&t!==nt)return ot(e,zn);if(i.status===xr&&e.avail_in!==0)return ot(e,zn);if(e.avail_in!==0||i.lookahead!==0||t!==vt&&i.status!==xr){var c=i.strategy===ui?Dp(i,t):i.strategy===cp?Ap(i,t):Vt[i.level].func(i,t);if((c===Tt||c===Wt)&&(i.status=xr),c===se||c===Tt)return e.avail_out===0&&(i.last_flush=-1),He;if(c===Er&&(t===op?Se._tr_align(i):t!==ol&&(Se._tr_stored_block(i,0,0,!1),t===ap&&(at(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),lt(e),e.avail_out===0))return i.last_flush=-1,He}return t!==nt?He:i.wrap<=0?al:(i.wrap===2?(G(i,e.adler&255),G(i,e.adler>>8&255),G(i,e.adler>>16&255),G(i,e.adler>>24&255),G(i,e.total_in&255),G(i,e.total_in>>8&255),G(i,e.total_in>>16&255),G(i,e.total_in>>24&255)):(Ir(i,e.adler>>>16),Ir(i,e.adler&65535)),lt(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?He:al)}function Fp(e){var t;return!e||!e.state?Te:(t=e.state.status,t!==ci&&t!==jn&&t!==di&&t!==fi&&t!==mi&&t!==St&&t!==xr?ot(e,Te):(e.state=null,t===St?ot(e,lp):He))}function Pp(e,t){var r=t.length,i,s,n,o,l,c,u,d;if(!e||!e.state)return Te;if(i=e.state,o=i.wrap,o===2||o===1&&i.status!==ci||i.lookahead)return Te;for(o===1&&(e.adler=sl(e.adler,t,r,0)),i.wrap=0,r>=i.w_size&&(o===0&&(at(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new ce.Buf8(i.w_size),ce.arraySet(d,t,r-i.w_size,i.w_size,0),t=d,r=i.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=r,e.next_in=0,e.input=t,xt(i);i.lookahead>=X;){s=i.strstart,n=i.lookahead-(X-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+X-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++;while(--n);i.strstart=s,i.lookahead=X-1,xt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=X-1,i.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,i.wrap=o,He}ze.deflateInit=kp;ze.deflateInit2=dl;ze.deflateReset=cl;ze.deflateResetKeep=hl;ze.deflateSetHeader=Bp;ze.deflate=Lp;ze.deflateEnd=Fp;ze.deflateSetDictionary=Pp;ze.deflateInfo="pako deflate (from Nodeca project)"}),$n=F(Xt=>{"use strict";var pi=Ge(),ml=!0,pl=!0;try{String.fromCharCode.apply(null,[0])}catch(e){ml=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){pl=!1}var Or=new pi.Buf8(256);for(var ut=0;ut<256;ut++)Or[ut]=ut>=252?6:ut>=248?5:ut>=240?4:ut>=224?3:ut>=192?2:1;Or[254]=Or[254]=1;Xt.string2buf=function(e){var t,r,i,s,n,o=e.length,l=0;for(s=0;s<o;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<o&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new pi.Buf8(l),n=0,s=0;n<l;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<o&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|r&63):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|r&63):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|r&63);return t};function bl(e,t){if(t<65534&&(e.subarray&&pl||!e.subarray&&ml))return String.fromCharCode.apply(null,pi.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}Xt.buf2binstring=function(e){return bl(e,e.length)};Xt.binstring2buf=function(e){for(var t=new pi.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t};Xt.buf2string=function(e,t){var r,i,s,n,o=t||e.length,l=new Array(o*2);for(i=0,r=0;r<o;){if(s=e[r++],s<128){l[i++]=s;continue}if(n=Or[s],n>4){l[i++]=65533,r+=n-1;continue}for(s&=n===2?31:n===3?15:7;n>1&&r<o;)s=s<<6|e[r++]&63,n--;if(n>1){l[i++]=65533;continue}s<65536?l[i++]=s:(s-=65536,l[i++]=55296|s>>10&1023,l[i++]=56320|s&1023)}return bl(l,i)};Xt.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+Or[e[r]]>t?r:t}}),Vn=F((x_,gl)=>{"use strict";function Mp(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}gl.exports=Mp}),vl=F(Ar=>{"use strict";var Dr=fl(),Nr=Ge(),Xn=$n(),Gn=li(),Cp=Vn(),_l=Object.prototype.toString,Up=0,Zn=4,Gt=0,wl=1,yl=2,zp=-1,Hp=0,jp=8;function Et(e){if(!(this instanceof Et))return new Et(e);this.options=Nr.assign({level:zp,method:jp,chunkSize:16384,windowBits:15,memLevel:8,strategy:Hp,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cp,this.strm.avail_out=0;var r=Dr.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Gt)throw new Error(Gn[r]);if(t.header&&Dr.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(typeof t.dictionary=="string"?i=Xn.string2buf(t.dictionary):_l.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,r=Dr.deflateSetDictionary(this.strm,i),r!==Gt)throw new Error(Gn[r]);this._dict_set=!0}}Et.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,s,n;if(this.ended)return!1;n=t===~~t?t:t===!0?Zn:Up,typeof e=="string"?r.input=Xn.string2buf(e):_l.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new Nr.Buf8(i),r.next_out=0,r.avail_out=i),s=Dr.deflate(r,n),s!==wl&&s!==Gt)return this.onEnd(s),this.ended=!0,!1;(r.avail_out===0||r.avail_in===0&&(n===Zn||n===yl))&&(this.options.to==="string"?this.onData(Xn.buf2binstring(Nr.shrinkBuf(r.output,r.next_out))):this.onData(Nr.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||r.avail_out===0)&&s!==wl);return n===Zn?(s=Dr.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Gt):(n===yl&&(this.onEnd(Gt),r.avail_out=0),!0)};Et.prototype.onData=function(e){this.chunks.push(e)};Et.prototype.onEnd=function(e){e===Gt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Nr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Yn(e,t){var r=new Et(t);if(r.push(e,!0),r.err)throw r.msg||Gn[r.err];return r.result}function Wp(e,t){return t=t||{},t.raw=!0,Yn(e,t)}function $p(e,t){return t=t||{},t.gzip=!0,Yn(e,t)}Ar.Deflate=Et;Ar.deflate=Yn;Ar.deflateRaw=Wp;Ar.gzip=$p}),Tl=F((I_,Sl)=>{"use strict";var bi=30,Vp=12;Sl.exports=function(t,r){var i,s,n,o,l,c,u,d,_,b,g,T,w,E,I,R,P,M,D,j,H,C,W,Y,k;i=t.state,s=t.next_in,Y=t.input,n=s+(t.avail_in-5),o=t.next_out,k=t.output,l=o-(r-t.avail_out),c=o+(t.avail_out-257),u=i.dmax,d=i.wsize,_=i.whave,b=i.wnext,g=i.window,T=i.hold,w=i.bits,E=i.lencode,I=i.distcode,R=(1<<i.lenbits)-1,P=(1<<i.distbits)-1;e:do{w<15&&(T+=Y[s++]<<w,w+=8,T+=Y[s++]<<w,w+=8),M=E[T&R];t:for(;;){if(D=M>>>24,T>>>=D,w-=D,D=M>>>16&255,D===0)k[o++]=M&65535;else if(D&16){j=M&65535,D&=15,D&&(w<D&&(T+=Y[s++]<<w,w+=8),j+=T&(1<<D)-1,T>>>=D,w-=D),w<15&&(T+=Y[s++]<<w,w+=8,T+=Y[s++]<<w,w+=8),M=I[T&P];r:for(;;){if(D=M>>>24,T>>>=D,w-=D,D=M>>>16&255,D&16){if(H=M&65535,D&=15,w<D&&(T+=Y[s++]<<w,w+=8,w<D&&(T+=Y[s++]<<w,w+=8)),H+=T&(1<<D)-1,H>u){t.msg="invalid distance too far back",i.mode=bi;break e}if(T>>>=D,w-=D,D=o-l,H>D){if(D=H-D,D>_&&i.sane){t.msg="invalid distance too far back",i.mode=bi;break e}if(C=0,W=g,b===0){if(C+=d-D,D<j){j-=D;do k[o++]=g[C++];while(--D);C=o-H,W=k}}else if(b<D){if(C+=d+b-D,D-=b,D<j){j-=D;do k[o++]=g[C++];while(--D);if(C=0,b<j){D=b,j-=D;do k[o++]=g[C++];while(--D);C=o-H,W=k}}}else if(C+=b-D,D<j){j-=D;do k[o++]=g[C++];while(--D);C=o-H,W=k}for(;j>2;)k[o++]=W[C++],k[o++]=W[C++],k[o++]=W[C++],j-=3;j&&(k[o++]=W[C++],j>1&&(k[o++]=W[C++]))}else{C=o-H;do k[o++]=k[C++],k[o++]=k[C++],k[o++]=k[C++],j-=3;while(j>2);j&&(k[o++]=k[C++],j>1&&(k[o++]=k[C++]))}}else if((D&64)===0){M=I[(M&65535)+(T&(1<<D)-1)];continue r}else{t.msg="invalid distance code",i.mode=bi;break e}break}}else if((D&64)===0){M=E[(M&65535)+(T&(1<<D)-1)];continue t}else if(D&32){i.mode=Vp;break e}else{t.msg="invalid literal/length code",i.mode=bi;break e}break}}while(s<n&&o<c);j=w>>3,s-=j,w-=j<<3,T&=(1<<w)-1,t.next_in=s,t.next_out=o,t.avail_in=s<n?5+(n-s):5-(s-n),t.avail_out=o<c?257+(c-o):257-(o-c),i.hold=T,i.bits=w;return}}),Nl=F((O_,xl)=>{"use strict";var El=Ge(),Zt=15,Il=852,Ol=592,Al=0,qn=1,Dl=2,Xp=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Gp=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Zp=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Yp=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];xl.exports=function(t,r,i,s,n,o,l,c){var u=c.bits,d=0,_=0,b=0,g=0,T=0,w=0,E=0,I=0,R=0,P=0,M,D,j,H,C,W=null,Y=0,k,oe=new El.Buf16(Zt+1),A=new El.Buf16(Zt+1),$=null,Hr=0,jr,Bt,kt;for(d=0;d<=Zt;d++)oe[d]=0;for(_=0;_<s;_++)oe[r[i+_]]++;for(T=u,g=Zt;g>=1&&!(oe[g]!==0);g--);if(T>g&&(T=g),g===0)return n[o++]=1<<24|64<<16|0,n[o++]=1<<24|64<<16|0,c.bits=1,0;for(b=1;b<g&&!(oe[b]!==0);b++);for(T<b&&(T=b),I=1,d=1;d<=Zt;d++)if(I<<=1,I-=oe[d],I<0)return-1;if(I>0&&(t===Al||g!==1))return-1;for(A[1]=0,d=1;d<Zt;d++)A[d+1]=A[d]+oe[d];for(_=0;_<s;_++)r[i+_]!==0&&(l[A[r[i+_]]++]=_);if(t===Al?(W=$=l,k=19):t===qn?(W=Xp,Y-=257,$=Gp,Hr-=257,k=256):(W=Zp,$=Yp,k=-1),P=0,_=0,d=b,C=o,w=T,E=0,j=-1,R=1<<T,H=R-1,t===qn&&R>Il||t===Dl&&R>Ol)return 1;for(;;){jr=d-E,l[_]<k?(Bt=0,kt=l[_]):l[_]>k?(Bt=$[Hr+l[_]],kt=W[Y+l[_]]):(Bt=32+64,kt=0),M=1<<d-E,D=1<<w,b=D;do D-=M,n[C+(P>>E)+D]=jr<<24|Bt<<16|kt|0;while(D!==0);for(M=1<<d-1;P&M;)M>>=1;if(M!==0?(P&=M-1,P+=M):P=0,_++,--oe[d]===0){if(d===g)break;d=r[i+l[_]]}if(d>T&&(P&H)!==j){for(E===0&&(E=T),C+=b,w=d-E,I=1<<w;w+E<g&&!(I-=oe[w+E],I<=0);)w++,I<<=1;if(R+=1<<w,t===qn&&R>Il||t===Dl&&R>Ol)return 1;j=P&H,n[j]=T<<24|w<<16|C-o|0}}return P!==0&&(n[C+P]=d-E<<24|64<<16|0),c.bits=T,0}}),cu=F(De=>{"use strict";var _e=Ge(),Kn=Cn(),We=Un(),qp=Tl(),Rr=Nl(),Kp=0,Rl=1,Bl=2,kl=4,Jp=5,gi=6,It=0,Qp=1,eb=2,xe=-2,Ll=-3,Jn=-4,tb=-5,Fl=8,Pl=1,Ml=2,Cl=3,Ul=4,zl=5,Hl=6,jl=7,Wl=8,$l=9,Vl=10,_i=11,Ye=12,Qn=13,Xl=14,es=15,Gl=16,Zl=17,Yl=18,ql=19,wi=20,yi=21,Kl=22,Jl=23,Ql=24,eu=25,tu=26,ts=27,ru=28,iu=29,te=30,rs=31,rb=32,ib=852,nb=592,sb=15,ob=sb;function nu(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function ab(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _e.Buf16(320),this.work=new _e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function su(e){var t;return!e||!e.state?xe:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=Pl,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _e.Buf32(ib),t.distcode=t.distdyn=new _e.Buf32(nb),t.sane=1,t.back=-1,It)}function ou(e){var t;return!e||!e.state?xe:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,su(e))}function au(e,t){var r,i;return!e||!e.state?xe:(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?xe:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,ou(e)))}function lu(e,t){var r,i;return e?(i=new ab,e.state=i,i.window=null,r=au(e,t),r!==It&&(e.state=null),r):xe}function lb(e){return lu(e,ob)}var uu=!0,is,ns;function ub(e){if(uu){var t;for(is=new _e.Buf32(512),ns=new _e.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Rr(Rl,e.lens,0,288,is,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Rr(Bl,e.lens,0,32,ns,0,e.work,{bits:5}),uu=!1}e.lencode=is,e.lenbits=9,e.distcode=ns,e.distbits=5}function hu(e,t,r,i){var s,n=e.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new _e.Buf8(n.wsize)),i>=n.wsize?(_e.arraySet(n.window,t,r-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>i&&(s=i),_e.arraySet(n.window,t,r-i,s,n.wnext),i-=s,i?(_e.arraySet(n.window,t,r-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0}function hb(e,t){var r,i,s,n,o,l,c,u,d,_,b,g,T,w,E=0,I,R,P,M,D,j,H,C,W=new _e.Buf8(4),Y,k,oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return xe;r=e.state,r.mode===Ye&&(r.mode=Qn),o=e.next_out,s=e.output,c=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,u=r.hold,d=r.bits,_=l,b=c,C=It;e:for(;;)switch(r.mode){case Pl:if(r.wrap===0){r.mode=Qn;break}for(;d<16;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(r.wrap&2&&u===35615){r.check=0,W[0]=u&255,W[1]=u>>>8&255,r.check=We(r.check,W,2,0),u=0,d=0,r.mode=Ml;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((u&255)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=te;break}if((u&15)!==Fl){e.msg="unknown compression method",r.mode=te;break}if(u>>>=4,d-=4,H=(u&15)+8,r.wbits===0)r.wbits=H;else if(H>r.wbits){e.msg="invalid window size",r.mode=te;break}r.dmax=1<<H,e.adler=r.check=1,r.mode=u&512?Vl:Ye,u=0,d=0;break;case Ml:for(;d<16;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(r.flags=u,(r.flags&255)!==Fl){e.msg="unknown compression method",r.mode=te;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=te;break}r.head&&(r.head.text=u>>8&1),r.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,r.check=We(r.check,W,2,0)),u=0,d=0,r.mode=Cl;case Cl:for(;d<32;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.head&&(r.head.time=u),r.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,W[2]=u>>>16&255,W[3]=u>>>24&255,r.check=We(r.check,W,4,0)),u=0,d=0,r.mode=Ul;case Ul:for(;d<16;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.head&&(r.head.xflags=u&255,r.head.os=u>>8),r.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,r.check=We(r.check,W,2,0)),u=0,d=0,r.mode=zl;case zl:if(r.flags&1024){for(;d<16;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.length=u,r.head&&(r.head.extra_len=u),r.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,r.check=We(r.check,W,2,0)),u=0,d=0}else r.head&&(r.head.extra=null);r.mode=Hl;case Hl:if(r.flags&1024&&(g=r.length,g>l&&(g=l),g&&(r.head&&(H=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),_e.arraySet(r.head.extra,i,n,g,H)),r.flags&512&&(r.check=We(r.check,i,g,n)),l-=g,n+=g,r.length-=g),r.length))break e;r.length=0,r.mode=jl;case jl:if(r.flags&2048){if(l===0)break e;g=0;do H=i[n+g++],r.head&&H&&r.length<65536&&(r.head.name+=String.fromCharCode(H));while(H&&g<l);if(r.flags&512&&(r.check=We(r.check,i,g,n)),l-=g,n+=g,H)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Wl;case Wl:if(r.flags&4096){if(l===0)break e;g=0;do H=i[n+g++],r.head&&H&&r.length<65536&&(r.head.comment+=String.fromCharCode(H));while(H&&g<l);if(r.flags&512&&(r.check=We(r.check,i,g,n)),l-=g,n+=g,H)break e}else r.head&&(r.head.comment=null);r.mode=$l;case $l:if(r.flags&512){for(;d<16;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(u!==(r.check&65535)){e.msg="header crc mismatch",r.mode=te;break}u=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Ye;break;case Vl:for(;d<32;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}e.adler=r.check=nu(u),u=0,d=0,r.mode=_i;case _i:if(r.havedict===0)return e.next_out=o,e.avail_out=c,e.next_in=n,e.avail_in=l,r.hold=u,r.bits=d,eb;e.adler=r.check=1,r.mode=Ye;case Ye:if(t===Jp||t===gi)break e;case Qn:if(r.last){u>>>=d&7,d-=d&7,r.mode=ts;break}for(;d<3;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.last=u&1,u>>>=1,d-=1;switch(u&3){case 0:r.mode=Xl;break;case 1:if(ub(r),r.mode=wi,t===gi){u>>>=2,d-=2;break e}break;case 2:r.mode=Zl;break;case 3:e.msg="invalid block type",r.mode=te}u>>>=2,d-=2;break;case Xl:for(u>>>=d&7,d-=d&7;d<32;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if((u&65535)!==(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=te;break}if(r.length=u&65535,u=0,d=0,r.mode=es,t===gi)break e;case es:r.mode=Gl;case Gl:if(g=r.length,g){if(g>l&&(g=l),g>c&&(g=c),g===0)break e;_e.arraySet(s,i,n,g,o),l-=g,n+=g,c-=g,o+=g,r.length-=g;break}r.mode=Ye;break;case Zl:for(;d<14;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(r.nlen=(u&31)+257,u>>>=5,d-=5,r.ndist=(u&31)+1,u>>>=5,d-=5,r.ncode=(u&15)+4,u>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=te;break}r.have=0,r.mode=Yl;case Yl:for(;r.have<r.ncode;){for(;d<3;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.lens[oe[r.have++]]=u&7,u>>>=3,d-=3}for(;r.have<19;)r.lens[oe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Y={bits:r.lenbits},C=Rr(Kp,r.lens,0,19,r.lencode,0,r.work,Y),r.lenbits=Y.bits,C){e.msg="invalid code lengths set",r.mode=te;break}r.have=0,r.mode=ql;case ql:for(;r.have<r.nlen+r.ndist;){for(;!(E=r.lencode[u&(1<<r.lenbits)-1],I=E>>>24,R=E>>>16&255,P=E&65535,I<=d);){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(P<16)u>>>=I,d-=I,r.lens[r.have++]=P;else{if(P===16){for(k=I+2;d<k;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(u>>>=I,d-=I,r.have===0){e.msg="invalid bit length repeat",r.mode=te;break}H=r.lens[r.have-1],g=3+(u&3),u>>>=2,d-=2}else if(P===17){for(k=I+3;d<k;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}u>>>=I,d-=I,H=0,g=3+(u&7),u>>>=3,d-=3}else{for(k=I+7;d<k;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}u>>>=I,d-=I,H=0,g=11+(u&127),u>>>=7,d-=7}if(r.have+g>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=te;break}for(;g--;)r.lens[r.have++]=H}}if(r.mode===te)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=te;break}if(r.lenbits=9,Y={bits:r.lenbits},C=Rr(Rl,r.lens,0,r.nlen,r.lencode,0,r.work,Y),r.lenbits=Y.bits,C){e.msg="invalid literal/lengths set",r.mode=te;break}if(r.distbits=6,r.distcode=r.distdyn,Y={bits:r.distbits},C=Rr(Bl,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Y),r.distbits=Y.bits,C){e.msg="invalid distances set",r.mode=te;break}if(r.mode=wi,t===gi)break e;case wi:r.mode=yi;case yi:if(l>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=n,e.avail_in=l,r.hold=u,r.bits=d,qp(e,b),o=e.next_out,s=e.output,c=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,u=r.hold,d=r.bits,r.mode===Ye&&(r.back=-1);break}for(r.back=0;!(E=r.lencode[u&(1<<r.lenbits)-1],I=E>>>24,R=E>>>16&255,P=E&65535,I<=d);){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(R&&(R&240)===0){for(M=I,D=R,j=P;!(E=r.lencode[j+((u&(1<<M+D)-1)>>M)],I=E>>>24,R=E>>>16&255,P=E&65535,M+I<=d);){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}u>>>=M,d-=M,r.back+=M}if(u>>>=I,d-=I,r.back+=I,r.length=P,R===0){r.mode=tu;break}if(R&32){r.back=-1,r.mode=Ye;break}if(R&64){e.msg="invalid literal/length code",r.mode=te;break}r.extra=R&15,r.mode=Kl;case Kl:if(r.extra){for(k=r.extra;d<k;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Jl;case Jl:for(;!(E=r.distcode[u&(1<<r.distbits)-1],I=E>>>24,R=E>>>16&255,P=E&65535,I<=d);){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if((R&240)===0){for(M=I,D=R,j=P;!(E=r.distcode[j+((u&(1<<M+D)-1)>>M)],I=E>>>24,R=E>>>16&255,P=E&65535,M+I<=d);){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}u>>>=M,d-=M,r.back+=M}if(u>>>=I,d-=I,r.back+=I,R&64){e.msg="invalid distance code",r.mode=te;break}r.offset=P,r.extra=R&15,r.mode=Ql;case Ql:if(r.extra){for(k=r.extra;d<k;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=te;break}r.mode=eu;case eu:if(c===0)break e;if(g=b-c,r.offset>g){if(g=r.offset-g,g>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=te;break}g>r.wnext?(g-=r.wnext,T=r.wsize-g):T=r.wnext-g,g>r.length&&(g=r.length),w=r.window}else w=s,T=o-r.offset,g=r.length;g>c&&(g=c),c-=g,r.length-=g;do s[o++]=w[T++];while(--g);r.length===0&&(r.mode=yi);break;case tu:if(c===0)break e;s[o++]=r.length,c--,r.mode=yi;break;case ts:if(r.wrap){for(;d<32;){if(l===0)break e;l--,u|=i[n++]<<d,d+=8}if(b-=c,e.total_out+=b,r.total+=b,b&&(e.adler=r.check=r.flags?We(r.check,s,b,o-b):Kn(r.check,s,b,o-b)),b=c,(r.flags?u:nu(u))!==r.check){e.msg="incorrect data check",r.mode=te;break}u=0,d=0}r.mode=ru;case ru:if(r.wrap&&r.flags){for(;d<32;){if(l===0)break e;l--,u+=i[n++]<<d,d+=8}if(u!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=te;break}u=0,d=0}r.mode=iu;case iu:C=Qp;break e;case te:C=Ll;break e;case rs:return Jn;case rb:default:return xe}return e.next_out=o,e.avail_out=c,e.next_in=n,e.avail_in=l,r.hold=u,r.bits=d,(r.wsize||b!==e.avail_out&&r.mode<te&&(r.mode<ts||t!==kl))&&hu(e,e.output,e.next_out,b-e.avail_out)?(r.mode=rs,Jn):(_-=e.avail_in,b-=e.avail_out,e.total_in+=_,e.total_out+=b,r.total+=b,r.wrap&&b&&(e.adler=r.check=r.flags?We(r.check,s,b,e.next_out-b):Kn(r.check,s,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Ye?128:0)+(r.mode===wi||r.mode===es?256:0),(_===0&&b===0||t===kl)&&C===It&&(C=tb),C)}function cb(e){if(!e||!e.state)return xe;var t=e.state;return t.window&&(t.window=null),e.state=null,It}function db(e,t){var r;return!e||!e.state?xe:(r=e.state,(r.wrap&2)===0?xe:(r.head=t,t.done=!1,It))}function fb(e,t){var r=t.length,i,s,n;return!e||!e.state?xe:(i=e.state,i.wrap!==0&&i.mode!==_i?xe:i.mode===_i&&(s=1,s=Kn(s,t,r,0),s!==i.check)?Ll:(n=hu(e,t,r,r),n?(i.mode=rs,Jn):(i.havedict=1,It)))}De.inflateReset=ou;De.inflateReset2=au;De.inflateResetKeep=su;De.inflateInit=lb;De.inflateInit2=lu;De.inflate=hb;De.inflateEnd=cb;De.inflateGetHeader=db;De.inflateSetDictionary=fb;De.inflateInfo="pako inflate (from Nodeca project)"}),ss=F((D_,du)=>{"use strict";du.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),mu=F((N_,fu)=>{"use strict";function mb(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}fu.exports=mb}),bu=F(Br=>{"use strict";var Yt=cu(),kr=Ge(),vi=$n(),ie=ss(),os=li(),pb=Vn(),bb=mu(),pu=Object.prototype.toString;function Ot(e){if(!(this instanceof Ot))return new Ot(e);this.options=kr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&((t.windowBits&15)===0&&(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pb,this.strm.avail_out=0;var r=Yt.inflateInit2(this.strm,t.windowBits);if(r!==ie.Z_OK)throw new Error(os[r]);if(this.header=new bb,Yt.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=vi.string2buf(t.dictionary):pu.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Yt.inflateSetDictionary(this.strm,t.dictionary),r!==ie.Z_OK)))throw new Error(os[r])}Ot.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,s=this.options.dictionary,n,o,l,c,u,d=!1;if(this.ended)return!1;o=t===~~t?t:t===!0?ie.Z_FINISH:ie.Z_NO_FLUSH,typeof e=="string"?r.input=vi.binstring2buf(e):pu.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new kr.Buf8(i),r.next_out=0,r.avail_out=i),n=Yt.inflate(r,ie.Z_NO_FLUSH),n===ie.Z_NEED_DICT&&s&&(n=Yt.inflateSetDictionary(this.strm,s)),n===ie.Z_BUF_ERROR&&d===!0&&(n=ie.Z_OK,d=!1),n!==ie.Z_STREAM_END&&n!==ie.Z_OK)return this.onEnd(n),this.ended=!0,!1;r.next_out&&((r.avail_out===0||n===ie.Z_STREAM_END||r.avail_in===0&&(o===ie.Z_FINISH||o===ie.Z_SYNC_FLUSH))&&(this.options.to==="string"?(l=vi.utf8border(r.output,r.next_out),c=r.next_out-l,u=vi.buf2string(r.output,l),r.next_out=c,r.avail_out=i-c,c&&kr.arraySet(r.output,r.output,l,c,0),this.onData(u)):this.onData(kr.shrinkBuf(r.output,r.next_out)))),r.avail_in===0&&r.avail_out===0&&(d=!0)}while((r.avail_in>0||r.avail_out===0)&&n!==ie.Z_STREAM_END);return n===ie.Z_STREAM_END&&(o=ie.Z_FINISH),o===ie.Z_FINISH?(n=Yt.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===ie.Z_OK):(o===ie.Z_SYNC_FLUSH&&(this.onEnd(ie.Z_OK),r.avail_out=0),!0)};Ot.prototype.onData=function(e){this.chunks.push(e)};Ot.prototype.onEnd=function(e){e===ie.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function as(e,t){var r=new Ot(t);if(r.push(e,!0),r.err)throw r.msg||os[r.err];return r.result}function gb(e,t){return t=t||{},t.raw=!0,as(e,t)}Br.Inflate=Ot;Br.inflate=as;Br.inflateRaw=gb;Br.ungzip=as}),wu=F((B_,gu)=>{"use strict";var _b=Ge().assign,wb=vl(),yb=bu(),vb=ss(),_u={};_b(_u,wb,yb,vb);gu.exports=_u}),vu=F(Si=>{"use strict";var Sb=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",Tb=wu(),yu=ee(),Ti=ge(),xb=Sb?"uint8array":"array";Si.magic="\b\0";function At(e,t){Ti.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}yu.inherits(At,Ti);At.prototype.processChunk=function(e){this.meta=e.meta,this._pako===null&&this._createPako(),this._pako.push(yu.transformTo(xb,e.data),!1)};At.prototype.flush=function(){Ti.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)};At.prototype.cleanUp=function(){Ti.prototype.cleanUp.call(this),this._pako=null};At.prototype._createPako=function(){this._pako=new Tb[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}};Si.compressWorker=function(e){return new At("Deflate",e)};Si.uncompressWorker=function(){return new At("Inflate",{})}}),us=F(ls=>{"use strict";var Su=ge();ls.STORE={magic:"\0\0",compressWorker:function(e){return new Su("STORE compression")},uncompressWorker:function(){return new Su("STORE decompression")}};ls.DEFLATE=vu()}),hs=F(Dt=>{"use strict";Dt.LOCAL_FILE_HEADER="PK";Dt.CENTRAL_FILE_HEADER="PK";Dt.CENTRAL_DIRECTORY_END="PK";Dt.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07";Dt.ZIP64_CENTRAL_DIRECTORY_END="PK";Dt.DATA_DESCRIPTOR="PK\x07\b"}),Iu=F((P_,Tu)=>{"use strict";var qt=ee(),Kt=ge(),cs=_t(),xu=ii(),xi=hs(),Q=function(e,t){var r="",i;for(i=0;i<t;i++)r+=String.fromCharCode(e&255),e=e>>>8;return r},Eb=function(e,t){var r=e;return e||(r=t?16893:33204),(r&65535)<<16},Ib=function(e,t){return(e||0)&63},Eu=function(e,t,r,i,s,n){var o=e.file,l=e.compression,c=n!==cs.utf8encode,u=qt.transformTo("string",n(o.name)),d=qt.transformTo("string",cs.utf8encode(o.name)),_=o.comment,b=qt.transformTo("string",n(_)),g=qt.transformTo("string",cs.utf8encode(_)),T=d.length!==o.name.length,w=g.length!==_.length,E,I,R="",P="",M="",D=o.dir,j=o.date,H={crc32:0,compressedSize:0,uncompressedSize:0};(!t||r)&&(H.crc32=e.crc32,H.compressedSize=e.compressedSize,H.uncompressedSize=e.uncompressedSize);var C=0;t&&(C|=8),!c&&(T||w)&&(C|=2048);var W=0,Y=0;D&&(W|=16),s==="UNIX"?(Y=798,W|=Eb(o.unixPermissions,D)):(Y=20,W|=Ib(o.dosPermissions,D)),E=j.getUTCHours(),E=E<<6,E=E|j.getUTCMinutes(),E=E<<5,E=E|j.getUTCSeconds()/2,I=j.getUTCFullYear()-1980,I=I<<4,I=I|j.getUTCMonth()+1,I=I<<5,I=I|j.getUTCDate(),T&&(P=Q(1,1)+Q(xu(u),4)+d,R+="up"+Q(P.length,2)+P),w&&(M=Q(1,1)+Q(xu(b),4)+g,R+="uc"+Q(M.length,2)+M);var k="";k+=`
\0`,k+=Q(C,2),k+=l.magic,k+=Q(E,2),k+=Q(I,2),k+=Q(H.crc32,4),k+=Q(H.compressedSize,4),k+=Q(H.uncompressedSize,4),k+=Q(u.length,2),k+=Q(R.length,2);var oe=xi.LOCAL_FILE_HEADER+k+u+R,A=xi.CENTRAL_FILE_HEADER+Q(Y,2)+k+Q(b.length,2)+"\0\0\0\0"+Q(W,4)+Q(i,4)+u+R+b;return{fileRecord:oe,dirRecord:A}},Ob=function(e,t,r,i,s){var n="",o=qt.transformTo("string",s(i));return n=xi.CENTRAL_DIRECTORY_END+"\0\0\0\0"+Q(e,2)+Q(e,2)+Q(t,4)+Q(r,4)+Q(o.length,2)+o,n},Ab=function(e){var t="";return t=xi.DATA_DESCRIPTOR+Q(e.crc32,4)+Q(e.compressedSize,4)+Q(e.uncompressedSize,4),t};function Ne(e,t,r,i){Kt.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}qt.inherits(Ne,Kt);Ne.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,Kt.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))};Ne.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=Eu(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0};Ne.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=Eu(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:Ab(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null};Ne.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=Ob(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})};Ne.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()};Ne.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(r){t.error(r)}),this};Ne.prototype.resume=function(){if(!Kt.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0};Ne.prototype.error=function(e){var t=this._sources;if(!Kt.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(i){}return!0};Ne.prototype.lock=function(){Kt.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()};Tu.exports=Ne}),Au=F(Ou=>{"use strict";var Db=us(),Nb=Iu(),Rb=function(e,t){var r=e||t,i=Db[r];if(!i)throw new Error(r+" is not a valid compression method !");return i};Ou.generateWorker=function(e,t,r){var i=new Nb(t.streamFiles,r,t.platform,t.encodeFileName),s=0;try{e.forEach(function(n,o){s++;var l=Rb(o.options.compression,t.compression),c=o.options.compressionOptions||t.compressionOptions||{},u=o.dir,d=o.date;o._compressWorker(l,c).withStreamInfo("file",{name:n,dir:u,date:d,comment:o.comment||"",unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions}).pipe(i)}),i.entriesCount=s}catch(n){i.error(n)}return i}}),Nu=F((C_,Du)=>{"use strict";var Bb=ee(),Ei=ge();function Lr(e,t){Ei.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}Bb.inherits(Lr,Ei);Lr.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(r){t.push({data:r,meta:{percent:0}})}).on("error",function(r){t.isPaused?this.generatedError=r:t.error(r)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})};Lr.prototype.pause=function(){return Ei.prototype.pause.call(this)?(this._stream.pause(),!0):!1};Lr.prototype.resume=function(){return Ei.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1};Du.exports=Lr}),zu=F((U_,Ru)=>{"use strict";var kb=_t(),Fr=ee(),Bu=ge(),Lb=pn(),ku=bn(),Lu=si(),Fb=Ba(),Pb=Au(),Fu=cr(),Mb=Nu(),Cu=function(e,t,r){var i=Fr.getTypeOf(t),s,n=Fr.extend(r||{},ku);n.date=n.date||new Date,n.compression!==null&&(n.compression=n.compression.toUpperCase()),typeof n.unixPermissions=="string"&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&n.unixPermissions&16384&&(n.dir=!0),n.dosPermissions&&n.dosPermissions&16&&(n.dir=!0),n.dir&&(e=Pu(e)),n.createFolders&&(s=Cb(e))&&Mu.call(this,s,!0);var o=i==="string"&&n.binary===!1&&n.base64===!1;(!r||typeof r.binary=="undefined")&&(n.binary=!o);var l=t instanceof Lu&&t.uncompressedSize===0;(l||n.dir||!t||t.length===0)&&(n.base64=!1,n.binary=!0,t="",n.compression="STORE",i="string");var c=null;t instanceof Lu||t instanceof Bu?c=t:Fu.isNode&&Fu.isStream(t)?c=new Mb(e,t):c=Fr.prepareContent(e,t,n.binary,n.optimizedBinaryString,n.base64);var u=new Fb(e,c,n);this.files[e]=u},Cb=function(e){e.slice(-1)==="/"&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},Pu=function(e){return e.slice(-1)!=="/"&&(e+="/"),e},Mu=function(e,t){return t=typeof t!="undefined"?t:ku.createFolders,e=Pu(e),this.files[e]||Cu.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function Uu(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var Ub={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files){if(!this.files.hasOwnProperty(t))continue;i=this.files[t],r=t.slice(this.root.length,t.length),r&&t.slice(0,this.root.length)===this.root&&e(r,i)}},filter:function(e){var t=[];return this.forEach(function(r,i){e(r,i)&&t.push(i)}),t},file:function(e,t,r){if(arguments.length===1)if(Uu(e)){var i=e;return this.filter(function(n,o){return!o.dir&&i.test(n)})}else{var s=this.files[this.root+e];return s&&!s.dir?s:null}else e=this.root+e,Cu.call(this,e,t,r);return this},folder:function(e){if(!e)return this;if(Uu(e))return this.filter(function(s,n){return n.dir&&e.test(s)});var t=this.root+e,r=Mu.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||(e.slice(-1)!=="/"&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(s,n){return n.name.slice(0,e.length)===e}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if(r=Fr.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:kb.utf8encode}),r.type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),r.type==="binarystring"&&(r.type="string"),!r.type)throw new Error("No output type specified.");Fr.checkSupport(r.type),(r.platform==="darwin"||r.platform==="freebsd"||r.platform==="linux"||r.platform==="sunos")&&(r.platform="UNIX"),r.platform==="win32"&&(r.platform="DOS");var i=r.comment||this.comment||"";t=Pb.generateWorker(this,r,i)}catch(s){t=new Bu("error"),t.error(s)}return new Lb(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};Ru.exports=Ub}),ds=F((z_,Hu)=>{"use strict";var zb=ee();function ju(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}ju.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,r;for(this.checkOffset(e),r=this.index+e-1;r>=this.index;r--)t=(t<<8)+this.byteAt(r);return this.index+=e,t},readString:function(e){return zb.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))}};Hu.exports=ju}),fs=F((H_,Wu)=>{"use strict";var $u=ds(),Hb=ee();function Jt(e){$u.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=e[t]&255}Hb.inherits(Jt,$u);Jt.prototype.byteAt=function(e){return this.data[this.zero+e]};Jt.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),n=this.length-4;n>=0;--n)if(this.data[n]===t&&this.data[n+1]===r&&this.data[n+2]===i&&this.data[n+3]===s)return n-this.zero;return-1};Jt.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),n=this.readData(4);return t===n[0]&&r===n[1]&&i===n[2]&&s===n[3]};Jt.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Wu.exports=Jt}),Gu=F((j_,Vu)=>{"use strict";var Xu=ds(),jb=ee();function Qt(e){Xu.call(this,e)}jb.inherits(Qt,Xu);Qt.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)};Qt.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero};Qt.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t};Qt.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Vu.exports=Qt}),ps=F((W_,Zu)=>{"use strict";var Yu=fs(),Wb=ee();function ms(e){Yu.call(this,e)}Wb.inherits(ms,Yu);ms.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};Zu.exports=ms}),Ju=F(($_,qu)=>{"use strict";var Ku=ps(),$b=ee();function bs(e){Ku.call(this,e)}$b.inherits(bs,Ku);bs.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};qu.exports=bs}),gs=F((V_,Qu)=>{"use strict";var Ii=ee(),eh=Xe(),Vb=fs(),Xb=Gu(),Gb=Ju(),Zb=ps();Qu.exports=function(e){var t=Ii.getTypeOf(e);return Ii.checkSupport(t),t==="string"&&!eh.uint8array?new Xb(e):t==="nodebuffer"?new Gb(e):eh.uint8array?new Zb(Ii.transformTo("uint8array",e)):new Vb(Ii.transformTo("array",e))}}),nh=F((X_,th)=>{"use strict";var _s=gs(),ht=ee(),Yb=si(),rh=ii(),Oi=_t(),Ai=us(),qb=Xe(),Kb=0,Jb=3,Qb=function(e){for(var t in Ai){if(!Ai.hasOwnProperty(t))continue;if(Ai[t].magic===e)return Ai[t]}return null};function ih(e,t){this.options=e,this.loadOptions=t}ih.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=Qb(this.compressionMethod),t===null)throw new Error("Corrupted zip : compression "+ht.pretty(this.compressionMethod)+" unknown (inner file : "+ht.transformTo("string",this.fileName)+")");this.decompressed=new Yb(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),e===Kb&&(this.dosPermissions=this.externalFileAttributes&63),e===Jb&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(e){if(!this.extraFields[1])return;var t=_s(this.extraFields[1].value);this.uncompressedSize===ht.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===ht.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===ht.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===ht.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,r,i,s;for(this.extraFields||(this.extraFields={});e.index+4<t;)r=e.readInt(2),i=e.readInt(2),s=e.readData(i),this.extraFields[r]={id:r,length:i,value:s};e.setIndex(t)},handleUTF8:function(){var e=qb.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Oi.utf8decode(this.fileName),this.fileCommentStr=Oi.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(t!==null)this.fileNameStr=t;else{var r=ht.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(i!==null)this.fileCommentStr=i;else{var s=ht.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=_s(e.value);return t.readInt(1)!==1||rh(this.fileName)!==t.readInt(4)?null:Oi.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=_s(e.value);return t.readInt(1)!==1||rh(this.fileComment)!==t.readInt(4)?null:Oi.utf8decode(t.readData(e.length-5))}return null}};th.exports=ih}),ah=F((Z_,sh)=>{"use strict";var eg=gs(),qe=ee(),Re=hs(),tg=nh(),G_=_t(),rg=Xe();function oh(e){this.files=[],this.loadOptions=e}oh.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+qe.pretty(t)+", expected "+qe.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),s=i===t;return this.reader.setIndex(r),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=rg.uint8array?"uint8array":"array",r=qe.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,r,i,s;t<e;)r=this.reader.readInt(2),i=this.reader.readInt(4),s=this.reader.readData(i),this.zip64ExtensibleData[r]={id:r,length:i,value:s}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(Re.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(Re.CENTRAL_FILE_HEADER);)e=new tg({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(Re.CENTRAL_DIRECTORY_END);if(e<0){var t=!this.isSignature(0,Re.LOCAL_FILE_HEADER);throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var r=e;if(this.checkSignature(Re.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===qe.MAX_VALUE_16BITS||this.diskWithCentralDirStart===qe.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===qe.MAX_VALUE_16BITS||this.centralDirRecords===qe.MAX_VALUE_16BITS||this.centralDirSize===qe.MAX_VALUE_32BITS||this.centralDirOffset===qe.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(Re.ZIP64_CENTRAL_DIRECTORY_LOCATOR),e<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(Re.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,Re.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(Re.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(Re.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=r-i;if(s>0)this.isSignature(r,Re.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(e){this.reader=eg(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};sh.exports=oh}),hh=F((Y_,lh)=>{"use strict";var ws=ee(),Di=Pt(),ig=_t(),ws=ee(),ng=ah(),sg=Sn(),uh=cr();function og(e){return new Di.Promise(function(t,r){var i=e.decompressed.getContentWorker().pipe(new sg);i.on("error",function(s){r(s)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}lh.exports=function(e,t){var r=this;return t=ws.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:ig.utf8decode}),uh.isNode&&uh.isStream(e)?Di.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):ws.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(i){var s=new ng(t);return s.load(i),s}).then(function(s){var n=[Di.Promise.resolve(s)],o=s.files;if(t.checkCRC32)for(var l=0;l<o.length;l++)n.push(og(o[l]));return Di.Promise.all(n)}).then(function(s){for(var n=s.shift(),o=n.files,l=0;l<o.length;l++){var c=o[l];r.file(c.fileNameStr,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r})}}),dh=F((q_,ch)=>{"use strict";function Ee(){if(!(this instanceof Ee))return new Ee;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new Ee;for(var t in this)typeof this[t]!="function"&&(e[t]=this[t]);return e}}Ee.prototype=zu();Ee.prototype.loadAsync=hh();Ee.support=Xe();Ee.defaults=bn();Ee.version="3.5.0";Ee.loadAsync=function(e,t){return new Ee().loadAsync(e,t)};Ee.external=Pt();ch.exports=Ee}),Wh=F((tv,jh)=>{jh.exports=function(){"use strict";function e(i,s){function n(){this.constructor=i}n.prototype=s.prototype,i.prototype=new n}function t(i,s,n,o){this.message=i,this.expected=s,this.found=n,this.location=o,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,t)}e(t,Error),t.buildMessage=function(i,s){var n={literal:function(b){return'"'+l(b.text)+'"'},class:function(b){var g="",T;for(T=0;T<b.parts.length;T++)g+=b.parts[T]instanceof Array?c(b.parts[T][0])+"-"+c(b.parts[T][1]):c(b.parts[T]);return"["+(b.inverted?"^":"")+g+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};function o(b){return b.charCodeAt(0).toString(16).toUpperCase()}function l(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+o(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+o(g)})}function c(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+o(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+o(g)})}function u(b){return n[b.type](b)}function d(b){var g=new Array(b.length),T,w;for(T=0;T<b.length;T++)g[T]=u(b[T]);if(g.sort(),g.length>0){for(T=1,w=1;T<g.length;T++)g[T-1]!==g[T]&&(g[w]=g[T],w++);g.length=w}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function _(b){return b?'"'+l(b)+'"':"end of input"}return"Expected "+d(i)+" but "+_(s)+" found."};function r(i,s){s=s!==void 0?s:{};var n={},o={Code:Ro},l=Ro,c=function(a){return a},u=function(a){return a.filter(f=>f)},d=re("if(<condition>)"),_="if",b=U("if",!0),g=function(a){return{type:"if",expr:a}},T="else",w=U("else",!0),E=function(a){return a},I=function(a){return{type:"else",then:a}},R="endif",P=U("endif",!0),M=function(a){return{type:"endif",then:a}},D="break",j=U("break",!0),H=function(){return{type:"break"}},C=re("while(<condition>)"),W="while",Y=U("while",!0),k=function(a){return{type:"while",expr:a}},oe="endwhile",A=U("endwhile",!0),$=function(){return{type:"endwhile"}},Hr="do",jr=U("do",!0),Bt=function(){return{type:"do"}},kt=re("until(<condition>)"),oc="until",ac=U("until",!0),lc=function(a){return{type:"until",expr:a}},uc="endswitch",hc=U("endswitch",!0),cc=function(){return{type:"endswitch"}},dc="switch",fc=U("switch",!0),mc=function(){return{type:"switch"}},pc=re("case(<condition>)"),bc="case",gc=U("case",!0),_c=function(a,f){return f},wc=function(a,f){return{type:"case",expr:a,then:f}},yc="default",vc=U("default",!0),Sc=function(a){return{type:"default",then:a}},Tc="function",xc=U("function",!0),Ec=function(){return{type:"function"}},Ic=re("return <var name>"),Oc="return",Ac=U("return",!0),Dc=function(a){return{type:"return",to:a}},$s=function(a,f){return f},Nc=function(a,f,p){return{type:"varsDec",datatype:a,modifiers:f,names:p}},Rc=re("assigment operator"),Vs=":=",Bc=U(":=",!1),Xs="::=",kc=U("::=",!1),Lc=function(a,f,p){return{type:f,to:a,operand:p}},Fc=re("equality operator"),Pc="=",Mc=U("=",!1),Cc=function(a,f,p){return{type:f,first:a,second:p}},Uc=re("function call"),Gs="(",Zs=U("(",!1),Ki=")",Ji=U(")",!1),zc=function(a,f){return{type:"call",name:a,args:f}},Hc=re("function call chain"),Ys=function(a,f){return f},jc=function(a,f){return{type:"callChain",functions:[a].concat(f)}},Wc=re("unary operator"),$c=function(a,f){return{type:a,operand:f}},qs=re("expression"),Ks=function(a){return{type:"expression",body:a}},Vc=re("constant"),Js='"',Qs=U('"',!1),eo=/^[^"]/,to=Pe(['"'],!0,!1),ro="'",io=U("'",!1),no=/^[^']/,so=Pe(["'"],!0,!1),Xc=/^[\-+]/,Gc=Pe(["-","+"],!1,!1),Zc=/^[0-9.]/,Yc=Pe([["0","9"],"."],!1,!1),oo=/^[0-9.e]/,ao=Pe([["0","9"],".","e"],!1,!1),qc="#",Kc=U("#",!1),lo=/^[0-9]/,uo=Pe([["0","9"]],!1,!1),Jc=function(a){return{type:"const",value:a}},Qc=function(a){return{type:"var",name:a}},ed=re("valid function name"),ho="-",co=U("-",!1),fo="+",mo=U("+",!1),td="!",rd=U("!",!1),id="^",nd=U("^",!1),sd=function(){return"**"},od="*",ad=U("*",!1),ld="/",ud=U("/",!1),hd="%",cd=U("%",!1),po=">>",dd=U(">>",!1),bo=">=",fd=U(">=",!1),md=">",pd=U(">",!1),go="<<",bd=U("<<",!1),_o="<=",gd=U("<=",!1),_d="<",wd=U("<",!1),wo="==",yd=U("==",!1),yo="!=",vd=U("!=",!1),vo="&&",Sd=U("&&",!1),Td="&",xd=U("&",!1),So="||",Ed=U("||",!1),Id="|",Od=U("|",!1),Ad=re("operand"),To=function(a,f,p){return{action:f,op:p}},Dd=function(a,f){return{first:a,rest:f}},Nd=re("operator"),Rd="~",Bd=U("~",!1),kd=function(a,f){return q(q({},f),{isNew:!!a})},Ld="handle",Fd=U("HANDLE",!0),Pd="string",Md=U("STRING",!0),Cd="float",Ud=U("FLOAT",!0),zd="colorref",Hd=U("COLORREF",!0),jd="integer",Wd=U("INTEGER",!0),$d="local",Vd=U("LOCAL",!0),Xd="nosave",Gd=U("NOSAVE",!0),Zd="parameter",Yd=U("PARAMETER",!0),Qi=",",en=U(",",!1),xo=function(a,f){return f},qd=function(a,f){return[a].concat(f)},Kd=re("variable name"),Eo=/^[_a-z\u0430-\u044F0-9]/i,Io=Pe(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),Jd=re("space or tab"),Qd=/^[ \t]/,ef=Pe([" ","	"],!1,!1),tf=re("new line"),rf=/^[\n]/,nf=Pe([`
`],!1,!1),sf=re("whitespace"),Oo=/^[ \t\n\r]/,Ao=Pe([" ","	",`
`,"\r"],!1,!1),of=re("if !<condition>)"),h=0,z=0,Wr=[{line:1,column:1}],Fe=0,tn=[],v=0,$r;if("startRule"in s){if(!(s.startRule in o))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');l=o[s.startRule]}function Hg(){return i.substring(z,h)}function jg(){return lr(z,h)}function Wg(a,f){throw f=f!==void 0?f:lr(z,h),No([re(a)],i.substring(z,h),f)}function $g(a,f){throw f=f!==void 0?f:lr(z,h),lf(a,f)}function U(a,f){return{type:"literal",text:a,ignoreCase:f}}function Pe(a,f,p){return{type:"class",parts:a,inverted:f,ignoreCase:p}}function Vg(){return{type:"any"}}function af(){return{type:"end"}}function re(a){return{type:"other",description:a}}function Do(a){var f=Wr[a],p;if(f)return f;for(p=a-1;!Wr[p];)p--;for(f=Wr[p],f={line:f.line,column:f.column};p<a;)i.charCodeAt(p)===10?(f.line++,f.column=1):f.column++,p++;return Wr[a]=f,f}function lr(a,f){var p=Do(a),m=Do(f);return{start:{offset:a,line:p.line,column:p.column},end:{offset:f,line:m.line,column:m.column}}}function x(a){if(h<Fe)return;h>Fe&&(Fe=h,tn=[]),tn.push(a)}function lf(a,f){return new t(a,null,null,f)}function No(a,f,p){return new t(t.buildMessage(a,f),a,f,p)}function Ro(){var a,f,p,m,y,S,L;for(a=h,f=[],p=h,m=[],y=B();y!==n;)m.push(y),y=B();if(m!==n)if(y=Lt(),y===n&&(y=null),y!==n){for(S=[],L=B();L!==n;)S.push(L),L=B();S!==n?(L=Fo(),L!==n?(z=p,m=c(y),p=m):(h=p,p=n)):(h=p,p=n)}else h=p,p=n;else h=p,p=n;for(;p!==n;){for(f.push(p),p=h,m=[],y=B();y!==n;)m.push(y),y=B();if(m!==n)if(y=Lt(),y===n&&(y=null),y!==n){for(S=[],L=B();L!==n;)S.push(L),L=B();S!==n?(L=Fo(),L!==n?(z=p,m=c(y),p=m):(h=p,p=n)):(h=p,p=n)}else h=p,p=n;else h=p,p=n}return f!==n&&(z=a,f=u(f)),a=f,a}function Lt(){var a;return a=xf(),a===n&&(a=Ef(),a===n&&(a=If(),a===n&&(a=uf(),a===n&&(a=cf(),a===n&&(a=df(),a===n&&(a=ff(),a===n&&(a=mf(),a===n&&(a=pf(),a===n&&(a=bf(),a===n&&(a=gf(),a===n&&(a=_f(),a===n&&(a=wf(),a===n&&(a=yf(),a===n&&(a=vf(),a===n&&(a=Of(),a===n&&(a=Sf(),a===n&&(a=Tf()))))))))))))))))),a}function uf(){var a;return a=hf(),a===n&&(a=Ff()),a}function hf(){var a,f,p,m;return v++,a=h,i.substr(h,2).toLowerCase()===_?(f=i.substr(h,2),h+=2):(f=n,v===0&&x(b)),f!==n?(p=fe(),p!==n?(m=ur(),m!==n?(z=a,f=g(m),a=f):(h=a,a=n)):(h=a,a=n)):(h=a,a=n),v--,a===n&&(f=n,v===0&&x(d)),a}function cf(){var a,f,p,m,y;if(a=h,i.substr(h,4).toLowerCase()===T?(f=i.substr(h,4),h+=4):(f=n,v===0&&x(w)),f!==n){if(p=h,m=[],y=B(),y!==n)for(;y!==n;)m.push(y),y=B();else m=n;m!==n?(y=Lt(),y!==n?(z=p,m=E(y),p=m):(h=p,p=n)):(h=p,p=n),p===n&&(p=null),p!==n?(z=a,f=I(p),a=f):(h=a,a=n)}else h=a,a=n;return a}function df(){var a,f,p,m,y;if(a=h,i.substr(h,5).toLowerCase()===R?(f=i.substr(h,5),h+=5):(f=n,v===0&&x(P)),f!==n){if(p=h,m=[],y=B(),y!==n)for(;y!==n;)m.push(y),y=B();else m=n;m!==n?(y=Lt(),y!==n?(z=p,m=E(y),p=m):(h=p,p=n)):(h=p,p=n),p===n&&(p=null),p!==n?(z=a,f=M(p),a=f):(h=a,a=n)}else h=a,a=n;return a}function ff(){var a,f;return a=h,i.substr(h,5).toLowerCase()===D?(f=i.substr(h,5),h+=5):(f=n,v===0&&x(j)),f!==n&&(z=a,f=H()),a=f,a}function mf(){var a,f,p,m;return v++,a=h,i.substr(h,5).toLowerCase()===W?(f=i.substr(h,5),h+=5):(f=n,v===0&&x(Y)),f!==n?(p=fe(),p!==n?(m=ur(),m!==n?(z=a,f=k(m),a=f):(h=a,a=n)):(h=a,a=n)):(h=a,a=n),v--,a===n&&(f=n,v===0&&x(C)),a}function pf(){var a,f;return a=h,i.substr(h,8).toLowerCase()===oe?(f=i.substr(h,8),h+=8):(f=n,v===0&&x(A)),f!==n&&(z=a,f=$()),a=f,a}function bf(){var a,f;return a=h,i.substr(h,2).toLowerCase()===Hr?(f=i.substr(h,2),h+=2):(f=n,v===0&&x(jr)),f!==n&&(z=a,f=Bt()),a=f,a}function gf(){var a,f,p,m;return v++,a=h,i.substr(h,5).toLowerCase()===oc?(f=i.substr(h,5),h+=5):(f=n,v===0&&x(ac)),f!==n?(p=fe(),p!==n?(m=ur(),m!==n?(z=a,f=lc(m),a=f):(h=a,a=n)):(h=a,a=n)):(h=a,a=n),v--,a===n&&(f=n,v===0&&x(kt)),a}function _f(){var a,f;return a=h,i.substr(h,9).toLowerCase()===uc?(f=i.substr(h,9),h+=9):(f=n,v===0&&x(hc)),f!==n&&(z=a,f=cc()),a=f,a}function wf(){var a,f;return a=h,i.substr(h,6).toLowerCase()===dc?(f=i.substr(h,6),h+=6):(f=n,v===0&&x(fc)),f!==n&&(z=a,f=mc()),a=f,a}function yf(){var a,f,p,m,y,S,L;if(v++,a=h,i.substr(h,4).toLowerCase()===bc?(f=i.substr(h,4),h+=4):(f=n,v===0&&x(gc)),f!==n)if(p=fe(),p!==n)if(m=ur(),m!==n){if(y=h,S=[],L=B(),L!==n)for(;L!==n;)S.push(L),L=B();else S=n;S!==n?(L=Lt(),L!==n?(z=y,S=_c(m,L),y=S):(h=y,y=n)):(h=y,y=n),y===n&&(y=null),y!==n?(z=a,f=wc(m,y),a=f):(h=a,a=n)}else h=a,a=n;else h=a,a=n;else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(pc)),a}function vf(){var a,f,p,m,y;if(a=h,i.substr(h,7).toLowerCase()===yc?(f=i.substr(h,7),h+=7):(f=n,v===0&&x(vc)),f!==n){if(p=h,m=[],y=B(),y!==n)for(;y!==n;)m.push(y),y=B();else m=n;m!==n?(y=Lt(),y!==n?(z=p,m=E(y),p=m):(h=p,p=n)):(h=p,p=n),p===n&&(p=null),p!==n?(z=a,f=Sc(p),a=f):(h=a,a=n)}else h=a,a=n;return a}function Sf(){var a,f;return a=h,i.substr(h,8).toLowerCase()===Tc?(f=i.substr(h,8),h+=8):(f=n,v===0&&x(xc)),f!==n&&(z=a,f=Ec()),a=f,a}function Tf(){var a,f,p,m;return v++,a=h,i.substr(h,6).toLowerCase()===Oc?(f=i.substr(h,6),h+=6):(f=n,v===0&&x(Ac)),f!==n?(p=fe(),p!==n?(m=bt(),m!==n?(z=a,f=Dc(m),a=f):(h=a,a=n)):(h=a,a=n)):(h=a,a=n),v--,a===n&&(f=n,v===0&&x(Ic)),a}function xf(){var a,f,p,m,y,S,L,V,Me;if(a=h,f=kf(),f!==n){if(p=[],m=B(),m!==n)for(;m!==n;)p.push(m),m=B();else p=n;if(p!==n)if(m=fe(),m!==n){if(y=[],S=h,L=ko(),L!==n){if(V=[],Me=B(),Me!==n)for(;Me!==n;)V.push(Me),Me=B();else V=n;V!==n?(z=S,L=$s(f,L),S=L):(h=S,S=n)}else h=S,S=n;for(;S!==n;)if(y.push(S),S=h,L=ko(),L!==n){if(V=[],Me=B(),Me!==n)for(;Me!==n;)V.push(Me),Me=B();else V=n;V!==n?(z=S,L=$s(f,L),S=L):(h=S,S=n)}else h=S,S=n;y!==n?(S=Lf(),S!==n?(z=a,f=Nc(f,y,S),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n}else h=a,a=n;return a}function Ef(){var a,f,p,m,y,S;if(v++,a=h,f=bt(),f!==n)if(p=fe(),p!==n)if(i.substr(h,2)===Vs?(m=Vs,h+=2):(m=n,v===0&&x(Bc)),m===n&&(i.substr(h,3)===Xs?(m=Xs,h+=3):(m=n,v===0&&x(kc))),m!==n){for(y=[],S=B();S!==n;)y.push(S),S=B();y!==n?(S=pt(),S!==n?(z=a,f=Lc(f,m,S),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n;else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Rc)),a}function If(){var a,f,p,m,y,S;if(v++,a=h,f=pt(),f!==n)if(p=fe(),p!==n)if(i.charCodeAt(h)===61?(m=Pc,h++):(m=n,v===0&&x(Mc)),m!==n){for(y=[],S=B();S!==n;)y.push(S),S=B();y!==n?(S=pt(),S!==n?(z=a,f=Cc(f,m,S),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n;else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Fc)),a}function Vr(){var a,f,p,m,y,S,L,V;if(v++,a=h,f=Rf(),f!==n){for(p=[],m=B();m!==n;)p.push(m),m=B();if(p!==n)if(i.charCodeAt(h)===40?(m=Gs,h++):(m=n,v===0&&x(Zs)),m!==n){for(y=[],S=B();S!==n;)y.push(S),S=B();if(y!==n){for(S=[],L=Lo();L!==n;)S.push(L),L=Lo();if(S!==n){for(L=[],V=B();V!==n;)L.push(V),V=B();L!==n?(i.charCodeAt(h)===41?(V=Ki,h++):(V=n,v===0&&x(Ji)),V!==n?(z=a,f=zc(f,S),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n}else h=a,a=n}else h=a,a=n;else h=a,a=n}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Uc)),a}function Of(){var a,f,p,m,y,S;if(v++,a=h,f=Vr(),f!==n){if(p=[],m=h,y=[],S=B(),S!==n)for(;S!==n;)y.push(S),S=B();else y=n;for(y!==n?(S=Vr(),S!==n?(z=m,y=Ys(f,S),m=y):(h=m,m=n)):(h=m,m=n);m!==n;){if(p.push(m),m=h,y=[],S=B(),S!==n)for(;S!==n;)y.push(S),S=B();else y=n;y!==n?(S=Vr(),S!==n?(z=m,y=Ys(f,S),m=y):(h=m,m=n)):(h=m,m=n)}p!==n?(z=a,f=jc(f,p),a=f):(h=a,a=n)}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Hc)),a}function Af(){var a,f,p,m;if(v++,a=h,f=Bf(),f!==n){for(p=[],m=B();m!==n;)p.push(m),m=B();p!==n?(m=pt(),m!==n?(z=a,f=$c(f,m),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Wc)),a}function ur(){var a,f,p,m,y,S;if(v++,a=h,i.charCodeAt(h)===40?(f=Gs,h++):(f=n,v===0&&x(Zs)),f!==n){for(p=[],m=B();m!==n;)p.push(m),m=B();if(p!==n)if(m=pt(),m!==n){for(y=[],S=B();S!==n;)y.push(S),S=B();y!==n?(i.charCodeAt(h)===41?(S=Ki,h++):(S=n,v===0&&x(Ji)),S!==n?(z=a,f=Ks(m),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(qs)),a}function Df(){var a,f,p,m,y,S,L;if(v++,a=h,f=h,p=h,i.charCodeAt(h)===34?(m=Js,h++):(m=n,v===0&&x(Qs)),m!==n){for(y=[],eo.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(to));S!==n;)y.push(S),eo.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(to));y!==n?(i.charCodeAt(h)===34?(S=Js,h++):(S=n,v===0&&x(Qs)),S!==n?(m=[m,y,S],p=m):(h=p,p=n)):(h=p,p=n)}else h=p,p=n;if(p===n){if(p=h,i.charCodeAt(h)===39?(m=ro,h++):(m=n,v===0&&x(io)),m!==n){for(y=[],no.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(so));S!==n;)y.push(S),no.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(so));y!==n?(i.charCodeAt(h)===39?(S=ro,h++):(S=n,v===0&&x(io)),S!==n?(m=[m,y,S],p=m):(h=p,p=n)):(h=p,p=n)}else h=p,p=n;if(p===n){if(p=h,Xc.test(i.charAt(h))?(m=i.charAt(h),h++):(m=n,v===0&&x(Gc)),m===n&&(m=null),m!==n)if(Zc.test(i.charAt(h))?(y=i.charAt(h),h++):(y=n,v===0&&x(Yc)),y!==n){for(S=[],oo.test(i.charAt(h))?(L=i.charAt(h),h++):(L=n,v===0&&x(ao));L!==n;)S.push(L),oo.test(i.charAt(h))?(L=i.charAt(h),h++):(L=n,v===0&&x(ao));S!==n?(m=[m,y,S],p=m):(h=p,p=n)}else h=p,p=n;else h=p,p=n;if(p===n)if(p=h,i.charCodeAt(h)===35?(m=qc,h++):(m=n,v===0&&x(Kc)),m!==n){for(y=[],lo.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(uo));S!==n;)y.push(S),lo.test(i.charAt(h))?(S=i.charAt(h),h++):(S=n,v===0&&x(uo));y!==n?(m=[m,y],p=m):(h=p,p=n)}else h=p,p=n}}return p!==n?f=i.substring(f,h):f=p,f!==n&&(z=a,f=Jc(f)),a=f,v--,a===n&&(f=n,v===0&&x(Vc)),a}function Nf(){var a,f;return a=h,f=bt(),f!==n&&(z=a,f=Qc(f)),a=f,a}function Rf(){var a,f;return v++,a=bt(),v--,a===n&&(f=n,v===0&&x(ed)),a}function Bf(){var a;return i.charCodeAt(h)===45?(a=ho,h++):(a=n,v===0&&x(co)),a===n&&(i.charCodeAt(h)===43?(a=fo,h++):(a=n,v===0&&x(mo)),a===n&&(i.charCodeAt(h)===33?(a=td,h++):(a=n,v===0&&x(rd)))),a}function Bo(){var a,f;return a=h,i.charCodeAt(h)===94?(f=id,h++):(f=n,v===0&&x(nd)),f!==n&&(z=a,f=sd()),a=f,a===n&&(i.charCodeAt(h)===42?(a=od,h++):(a=n,v===0&&x(ad)),a===n&&(i.charCodeAt(h)===47?(a=ld,h++):(a=n,v===0&&x(ud)),a===n&&(i.charCodeAt(h)===37?(a=hd,h++):(a=n,v===0&&x(cd)),a===n&&(i.charCodeAt(h)===43?(a=fo,h++):(a=n,v===0&&x(mo)),a===n&&(i.charCodeAt(h)===45?(a=ho,h++):(a=n,v===0&&x(co)),a===n&&(i.substr(h,2)===po?(a=po,h+=2):(a=n,v===0&&x(dd)),a===n&&(i.substr(h,2)===bo?(a=bo,h+=2):(a=n,v===0&&x(fd)),a===n&&(i.charCodeAt(h)===62?(a=md,h++):(a=n,v===0&&x(pd)),a===n&&(i.substr(h,2)===go?(a=go,h+=2):(a=n,v===0&&x(bd)),a===n&&(i.substr(h,2)===_o?(a=_o,h+=2):(a=n,v===0&&x(gd)),a===n&&(i.charCodeAt(h)===60?(a=_d,h++):(a=n,v===0&&x(wd)),a===n&&(i.substr(h,2)===wo?(a=wo,h+=2):(a=n,v===0&&x(yd)),a===n&&(i.substr(h,2)===yo?(a=yo,h+=2):(a=n,v===0&&x(vd)),a===n&&(i.substr(h,2)===vo?(a=vo,h+=2):(a=n,v===0&&x(Sd)),a===n&&(i.charCodeAt(h)===38?(a=Td,h++):(a=n,v===0&&x(xd)),a===n&&(i.substr(h,2)===So?(a=So,h+=2):(a=n,v===0&&x(Ed)),a===n&&(i.charCodeAt(h)===124?(a=Id,h++):(a=n,v===0&&x(Od))))))))))))))))))),a}function pt(){var a,f,p,m,y,S,L,V;if(v++,a=h,f=rn(),f!==n){for(p=[],m=h,y=[],S=B();S!==n;)y.push(S),S=B();if(y!==n)if(S=Bo(),S!==n){for(L=[],V=B();V!==n;)L.push(V),V=B();L!==n?(V=rn(),V!==n?(z=m,y=To(f,S,V),m=y):(h=m,m=n)):(h=m,m=n)}else h=m,m=n;else h=m,m=n;for(;m!==n;){for(p.push(m),m=h,y=[],S=B();S!==n;)y.push(S),S=B();if(y!==n)if(S=Bo(),S!==n){for(L=[],V=B();V!==n;)L.push(V),V=B();L!==n?(V=rn(),V!==n?(z=m,y=To(f,S,V),m=y):(h=m,m=n)):(h=m,m=n)}else h=m,m=n;else h=m,m=n}p!==n?(z=a,f=Dd(f,p),a=f):(h=a,a=n)}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Ad)),a}function rn(){var a,f,p,m;if(v++,a=h,i.charCodeAt(h)===126?(f=Rd,h++):(f=n,v===0&&x(Bd)),f===n&&(f=null),f!==n){for(p=[],m=B();m!==n;)p.push(m),m=B();p!==n?(m=Af(),m===n&&(m=Df(),m===n&&(m=Vr(),m===n&&(m=Nf(),m===n&&(m=ur())))),m!==n?(z=a,f=kd(f,m),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(Nd)),a}function kf(){var a;return i.substr(h,6).toLowerCase()===Ld?(a=i.substr(h,6),h+=6):(a=n,v===0&&x(Fd)),a===n&&(i.substr(h,6).toLowerCase()===Pd?(a=i.substr(h,6),h+=6):(a=n,v===0&&x(Md)),a===n&&(i.substr(h,5).toLowerCase()===Cd?(a=i.substr(h,5),h+=5):(a=n,v===0&&x(Ud)),a===n&&(i.substr(h,8).toLowerCase()===zd?(a=i.substr(h,8),h+=8):(a=n,v===0&&x(Hd)),a===n&&(i.substr(h,7).toLowerCase()===jd?(a=i.substr(h,7),h+=7):(a=n,v===0&&x(Wd)))))),a}function ko(){var a;return i.substr(h,5).toLowerCase()===$d?(a=i.substr(h,5),h+=5):(a=n,v===0&&x(Vd)),a===n&&(i.substr(h,6).toLowerCase()===Xd?(a=i.substr(h,6),h+=6):(a=n,v===0&&x(Gd)),a===n&&(i.substr(h,9).toLowerCase()===Zd?(a=i.substr(h,9),h+=9):(a=n,v===0&&x(Yd)))),a}function Lf(){var a,f,p,m,y,S,L,V;if(a=h,f=bt(),f!==n){for(p=[],m=h,y=fe(),y!==n?(i.charCodeAt(h)===44?(S=Qi,h++):(S=n,v===0&&x(en)),S!==n?(L=fe(),L!==n?(V=bt(),V!==n?(z=m,y=xo(f,V),m=y):(h=m,m=n)):(h=m,m=n)):(h=m,m=n)):(h=m,m=n);m!==n;)p.push(m),m=h,y=fe(),y!==n?(i.charCodeAt(h)===44?(S=Qi,h++):(S=n,v===0&&x(en)),S!==n?(L=fe(),L!==n?(V=bt(),V!==n?(z=m,y=xo(f,V),m=y):(h=m,m=n)):(h=m,m=n)):(h=m,m=n)):(h=m,m=n);p!==n?(z=a,f=qd(f,p),a=f):(h=a,a=n)}else h=a,a=n;return a}function Lo(){var a,f,p,m,y;for(a=h,f=[],p=B();p!==n;)f.push(p),p=B();if(f!==n)if(p=pt(),p!==n){for(m=[],y=B();y!==n;)m.push(y),y=B();m!==n?(i.charCodeAt(h)===44?(y=Qi,h++):(y=n,v===0&&x(en)),y===n&&(y=null),y!==n?(z=a,f=E(p),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n;return a}function bt(){var a,f,p;if(v++,a=h,f=[],Eo.test(i.charAt(h))?(p=i.charAt(h),h++):(p=n,v===0&&x(Io)),p!==n)for(;p!==n;)f.push(p),Eo.test(i.charAt(h))?(p=i.charAt(h),h++):(p=n,v===0&&x(Io));else f=n;return f!==n?a=i.substring(a,h):a=f,v--,a===n&&(f=n,v===0&&x(Kd)),a}function B(){var a,f;return v++,Qd.test(i.charAt(h))?(a=i.charAt(h),h++):(a=n,v===0&&x(ef)),v--,a===n&&(f=n,v===0&&x(Jd)),a}function Fo(){var a,f;return v++,rf.test(i.charAt(h))?(a=i.charAt(h),h++):(a=n,v===0&&x(nf)),v--,a===n&&(f=n,v===0&&x(tf)),a}function fe(){var a,f;for(v++,a=[],Oo.test(i.charAt(h))?(f=i.charAt(h),h++):(f=n,v===0&&x(Ao));f!==n;)a.push(f),Oo.test(i.charAt(h))?(f=i.charAt(h),h++):(f=n,v===0&&x(Ao));return v--,a===n&&(f=n,v===0&&x(sf)),a}function Ff(){var a,f,p,m;return v++,a=h,i.substr(h,2).toLowerCase()===_?(f=i.substr(h,2),h+=2):(f=n,v===0&&x(b)),f!==n?(p=fe(),p!==n?(m=Pf(),m!==n?(z=a,f=g(m),a=f):(h=a,a=n)):(h=a,a=n)):(h=a,a=n),v--,a===n&&(f=n,v===0&&x(of)),a}function Pf(){var a,f,p,m,y;for(v++,a=h,f=[],p=B();p!==n;)f.push(p),p=B();if(f!==n)if(p=pt(),p!==n){for(m=[],y=B();y!==n;)m.push(y),y=B();m!==n?(i.charCodeAt(h)===41?(y=Ki,h++):(y=n,v===0&&x(Ji)),y!==n?(z=a,f=Ks(p),a=f):(h=a,a=n)):(h=a,a=n)}else h=a,a=n;else h=a,a=n;return v--,a===n&&(f=n,v===0&&x(qs)),a}if($r=l(),$r!==n&&h===i.length)return $r;throw $r!==n&&h<i.length&&x(af()),No(tn,Fe<i.length?i.charAt(Fe):null,Fe<i.length?lr(Fe,Fe+1):lr(Fe,Fe))}return{SyntaxError:t,parse:r}}()}),Hi=F(zg=>{jf(zg,{FastestExecutor:()=>nc,SmoothExecutor:()=>ic,options:()=>tc,setLogLevel:()=>rc,unzip:()=>ec,version:()=>sc});const ec=Qh,tc={};function rc(e){}const ic=Zr,nc=Mo,sc="0.9.1"});class Zr{constructor(){this.frameId=0;this._running=!1}_loop(e){return requestAnimationFrame(()=>{e()?this.frameId=this._loop(e):this._running=!1})}_unloop(){cancelAnimationFrame(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._running=!0,this.frameId=this._loop(e)}stop(){if(!this._running)return;this._running=!1,this._unloop()}}class Mo{constructor(e){this.frameId=0;this._running=!1;this.timeout=typeof e=="number"?e:0}_loop(e){return setTimeout(()=>{e()&&e()&&e()&&e()?this.frameId=this._loop(e):this._running=!1},this.timeout)}_unloop(){clearTimeout(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._running=!0,this.frameId=this._loop(e)}stop(){if(!this._running)return;this._running=!1,this._unloop()}}const xh=Gr(dh()),fh=["brushTools","penTools","dibTools","doubleDibTools","fontTools","stringTools","textTools"];function er(e){return e?e.map(t=>q({},t)):void 0}function mh(e){var r,i;const t=q({},e);return t.brushTools=er(e.brushTools),t.penTools=er(e.penTools),t.dibTools=er(e.dibTools),t.doubleDibTools=er(e.doubleDibTools),t.fontTools=er(e.fontTools),t.stringTools=er(e.stringTools),t.textTools=(r=e.textTools)==null?void 0:r.map(s=>q(q({},s),{textCollection:s.textCollection.map(n=>q({},n))})),t.elements=(i=e.elements)==null?void 0:i.map(s=>s.type==="group"?q(q({},s),{childHandles:s.childHandles.slice()}):q({},s)),t.elementOrder=e.elementOrder&&e.elementOrder.slice(),t}function ph(e,t){const r=e.find(i=>i.handle===t);if(!r||r.type!=="group")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${t}`);return r}function bh(e,t){const r=t.childHandles[0],i=e.find(s=>s.handle===r);if(!i||i.type!=="doubleBitmap")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0438\u043A\u043E\u043D\u043A\u0438 \u0438\u043C\u0438\u0434\u0436\u0430 #${t.handle}`);return i}function ag(e,t){const r=new Map;let i=1;for(const s of t){for(;e.some(n=>n.handle===i);)++i;r.set(s.handle,i),s.handle=i,e.push(s)}return r}function lg(e,t){const r={};for(const i of fh){const s=t[i];if(!s)continue;const n=e[i];if(!n){e[i]=s;continue}r[i]=ag(n,s)}return r}function ct(e,t,r){if(!e)return;for(const i of e){const s=i[t];i[t]=r.get(s)||s}}function ug(e,t,r){switch(t){case"fontTools":{const{textTools:i}=e;i&&i.forEach(s=>ct(s.textCollection,"fontHandle",r));break}case"stringTools":{const{textTools:i}=e;i&&i.forEach(s=>ct(s.textCollection,"stringHandle",r));break}case"dibTools":{ct(e.brushTools,"dibHandle",r);break}}}function hg(e,t,r){switch(t){case"brushTools":const i=e.filter(c=>c.type==="line");ct(i,"brushHandle",r);break;case"penTools":const s=e.filter(c=>c.type==="line");ct(s,"penHandle",r);break;case"dibTools":const n=e.filter(c=>c.type==="bitmap");ct(n,"dibHandle",r);break;case"doubleDibTools":const o=e.filter(c=>c.type==="doubleBitmap");ct(o,"dibHandle",r);break;case"textTools":const l=e.filter(c=>c.type==="text");ct(l,"textToolHandle",r);break}}function cg(e,t){for(const r of fh){const i=t[r];if(!i)continue;ug(e,r,i),e.elements&&hg(e.elements,r,i)}}function dg(e){let t,r;for(const i of e){if(i.type==="group")continue;(t===void 0||i.originX<t)&&(t=i.originX),(r===void 0||i.originY<r)&&(r=i.originY)}return{x:t||0,y:r||0}}function fg(e,t){return e.some(r=>r.type==="group"&&r.childHandles.includes(t.handle))}function mg(e,t,r){const i=new Map;if(t.length===0)return{map:i,rootHandle:0};let s=1;const n=[];for(const l of t){for(;e.some(c=>c.handle===s);)++s;if(fg(t,l)||n.push(s),i.set(l.handle,s),l.handle=s,e.push(l),l.type==="group")continue;if(l.originX+=r.x,l.originY+=r.y,l.type==="line"){l.coords=l.coords.slice();for(let c=0;c<l.coords.length;c+=2)l.coords[c+0]+=r.x,l.coords[c+1]+=r.y}}if(n.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u044A\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F \u0438\u043C\u0438\u0434\u0436\u0435\u0439");if(n.length===1)return{map:i,rootHandle:n[0]};for(;e.some(l=>l.handle===s);)++s;const o={type:"group",handle:s,childHandles:n,options:0};return e.push(o),{map:i,rootHandle:o.handle}}function pg(e,t){for(const r of e){if(r.type!=="group")continue;r.childHandles=r.childHandles.map(i=>t.get(i)||i)}}function bg(e,t){return e.map(r=>t.get(r)||r)}function gg(e){return e.elements!==void 0&&e.elements.length>0}class gh{constructor(e){const t=mh(e);if(!gg(t))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=t}get result(){return this.scheme}insertChildImage(e,t){const{scheme:r}=this,i=mh(t),s=lg(r,i);if(cg(i,s),!i.elements)return;const n=ph(r.elements,e),o=bh(r.elements,n);o.options|=1;const l=dg(i.elements),c={x:o.originX-l.x,y:o.originY-l.y},{map:u,rootHandle:d}=mg(r.elements,i.elements,c);if(pg(i.elements,u),n.childHandles.push(d),!i.elementOrder)return;const _=bg(i.elementOrder,u),b=r.elementOrder;r.elementOrder=b?b.concat(_):_}replaceIcon(e,t,r){const{scheme:i}=this,s=ph(i.elements,e),n=bh(i.elements,s),o={type:"DBMReference",handle:0,filename:t};let l=1;if(i.doubleDibTools){for(;i.doubleDibTools.some(u=>u.handle===l);)++l;i.doubleDibTools.push(o)}else i.doubleDibTools=[o];n.dibHandle=o.handle=l;let c=0;switch(t.toUpperCase()){case"SYSTEM.DBM":c=2;break;default:return}n.cropX=r%c*32,n.cropY=Math.floor(r/c)*32}}class _h{constructor(){this.lib=new Map}add(e,t=0){for(const r of e){const i=r.name.toUpperCase(),s=this.lib.get(i);if(s){if(s.cls.filepathDos===r.filepathDos)continue;throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: "${r.name}" \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445:
${r.filepathDos},${s.cls.filepathDos}.`)}this.lib.set(i,{cls:r,id:t})}return this}remove(e){return e===0?this:(this.lib=new Map([...this.lib].filter(t=>t[1].id!==e)),this)}get(e){var t;return(t=this.lib.get(e.toUpperCase()))==null?void 0:t.cls}getComposedScheme(e){const t=this.get(e);if(!(t==null?void 0:t.scheme))return;if(!t.children)return t.scheme;const r=new gh(t.scheme);for(const i of t.children){const s=this.get(i.classname);if(!s)throw Error(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${i.classname} #${i.schemeInfo.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const{handle:n}=i.schemeInfo;s.iconFile&&r.replaceIcon(n,s.iconFile,s.iconIndex||0),s.image&&!s.alwaysUseIcon()&&r.insertChildImage(n,s.image)}return r.result}}const ys=/[/\\]/;function tr(e){return e.split(ys).map(t=>t.trim()).filter(t=>t.length>0)}function vs(e){if(e.length!==1||!/[A-Z]/.test(e))throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043F\u0440\u0435\u0444\u0438\u043A\u0441 \u0434\u0438\u0441\u043A\u0430: ${e}.`)}function wh(e,t){const r=e.split(":");if(r.length>2)throw Error("\u0414\u0432\u043E\u0435\u0442\u043E\u0447\u0438\u0435 \u043F\u043E\u0441\u043B\u0435 \u043F\u0440\u0435\u0444\u0438\u043A\u0441\u0430 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u043D\u043E \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044C\u0441\u044F \u043B\u0438\u0448\u044C \u0435\u0434\u0438\u043D\u043E\u0436\u0434\u044B.");let i=t,s=r[0];if(r.length!==1){s=r[1];const n=r[0].trim().toUpperCase();vs(n),i=n}return[i,tr(s)]}const Th=Gr(Hi());var O;(function(e){e[e.PI=Math.PI]="PI",e[e.WORD8=0]="WORD8",e[e.INT8=1]="INT8",e[e.WORD16=2]="WORD16",e[e.INT16=3]="INT16",e[e.WORD32=4]="WORD32",e[e.INT32=5]="INT32",e[e.FLOAT32=6]="FLOAT32",e[e.FLOAT40=7]="FLOAT40",e[e.FLOAT64=8]="FLOAT64",e[e.FLOAT80=9]="FLOAT80",e[e.PEN2D=1]="PEN2D",e[e.BRUSH2D=2]="BRUSH2D",e[e.DIB2D=3]="DIB2D",e[e.DOUBLEDIB2D=4]="DOUBLEDIB2D",e[e.FONT2D=5]="FONT2D",e[e.STRING2D=6]="STRING2D",e[e.TEXT2D=7]="TEXT2D",e[e.SPACE3D=8]="SPACE3D",e[e.TEXTURE3D=9]="TEXTURE3D",e[e.SIZE_RESTORED=0]="SIZE_RESTORED",e[e.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",e[e.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",e[e.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",e[e.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",e[e.OTGROUP2D=3]="OTGROUP2D",e[e.OTRGROUP2D=4]="OTRGROUP2D",e[e.OTGROUP3D=5]="OTGROUP3D",e[e.OTOBJECT3D=10]="OTOBJECT3D",e[e.OTLINE_2D=20]="OTLINE_2D",e[e.OTBITMAP_2D=21]="OTBITMAP_2D",e[e.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",e[e.OTTEXT_2D=23]="OTTEXT_2D",e[e.OTVIEW3D_2D=24]="OTVIEW3D_2D",e[e.OTEDITFRAME=50]="OTEDITFRAME",e[e.OTROTATECENTER=51]="OTROTATECENTER",e[e.OTFRAME3D=52]="OTFRAME3D",e[e.OTAXIS3D=53]="OTAXIS3D",e[e.OTPEN2D=101]="OTPEN2D",e[e.OTBRUSH2D=102]="OTBRUSH2D",e[e.OTDIB2D=103]="OTDIB2D",e[e.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",e[e.OTFONT2D=105]="OTFONT2D",e[e.OTSTRING2D=106]="OTSTRING2D",e[e.OTTEXT2D=107]="OTTEXT2D",e[e.OTREFTODIB2D=110]="OTREFTODIB2D",e[e.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",e[e.ATTRSET=1]="ATTRSET",e[e.ATTRRESET=2]="ATTRRESET",e[e.ATTRPUT=3]="ATTRPUT",e[e.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",e[e.PFC_SETCURRENT=16384]="PFC_SETCURRENT",e[e.PFC_SETFRAME=8192]="PFC_SETFRAME",e[e.PFC_PENS=1]="PFC_PENS",e[e.PFC_BRUHS=2]="PFC_BRUHS",e[e.PFC_DIBS=4]="PFC_DIBS",e[e.PFC_DDIBS=8]="PFC_DDIBS",e[e.PFC_STRINGS=16]="PFC_STRINGS",e[e.PFC_FONTS=32]="PFC_FONTS",e[e.PFC_TEXTS=64]="PFC_TEXTS",e[e.PFC_3D=128]="PFC_3D",e[e.PFC_ALL=255]="PFC_ALL",e[e.OID_RESERVED=32e3]="OID_RESERVED",e[e.OID_RCENTER=32001]="OID_RCENTER",e[e.OID_FRAME2D1=32002]="OID_FRAME2D1",e[e.OID_FRAME2D2=32003]="OID_FRAME2D2",e[e.OID_FRAME2D3=32004]="OID_FRAME2D3",e[e.OID_FRAME2D4=32005]="OID_FRAME2D4",e[e.OID_FRAME2D5=32006]="OID_FRAME2D5",e[e.OID_FRAME2D6=32007]="OID_FRAME2D6",e[e.OID_FRAME2D7=32008]="OID_FRAME2D7",e[e.OID_FRAME2D8=32009]="OID_FRAME2D8",e[e.OID_FRAME2D=32010]="OID_FRAME2D",e[e.OID_AXIS3D=32100]="OID_AXIS3D",e[e.OID_FRAME3D1=32102]="OID_FRAME3D1",e[e.OID_FRAME3D2=32103]="OID_FRAME3D2",e[e.OID_FRAME3D3=32104]="OID_FRAME3D3",e[e.OID_FRAME3D4=32105]="OID_FRAME3D4",e[e.OID_FRAME3D5=32106]="OID_FRAME3D5",e[e.OID_FRAME3D6=32107]="OID_FRAME3D6",e[e.OID_FRAME3D7=32108]="OID_FRAME3D7",e[e.OID_FRAME3D8=32109]="OID_FRAME3D8",e[e.OID_FRAME3D=32110]="OID_FRAME3D",e[e.MB_OK=0]="MB_OK",e[e.MB_OKCANCEL=1]="MB_OKCANCEL",e[e.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",e[e.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",e[e.MB_YESNO=4]="MB_YESNO",e[e.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",e[e.MB_TYPEMASK=15]="MB_TYPEMASK",e[e.MB_ICONHAND=16]="MB_ICONHAND",e[e.MB_ICONQUESTION=32]="MB_ICONQUESTION",e[e.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",e[e.MB_ICONASTERISK=64]="MB_ICONASTERISK",e[e.MB_ICONMASK=240]="MB_ICONMASK",e[e.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",e[e.MB_ICONSTOP=16]="MB_ICONSTOP",e[e.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",e[e.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",e[e.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",e[e.MB_DEFMASK=3840]="MB_DEFMASK",e[e.MB_APPLMODAL=0]="MB_APPLMODAL",e[e.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",e[e.MB_TASKMODAL=8192]="MB_TASKMODAL",e[e.MB_NOFOCUS=32768]="MB_NOFOCUS",e[e.SW_HIDE=0]="SW_HIDE",e[e.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",e[e.SW_NORMAL=1]="SW_NORMAL",e[e.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",e[e.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",e[e.SW_MAXIMIZE=3]="SW_MAXIMIZE",e[e.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",e[e.SW_SHOW=5]="SW_SHOW",e[e.SW_MINIMIZE=6]="SW_MINIMIZE",e[e.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",e[e.SW_SHOWNA=8]="SW_SHOWNA",e[e.SW_RESTORE=9]="SW_RESTORE",e[e.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",e[e.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",e[e.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",e[e.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",e[e.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",e[e.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",e[e.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",e[e.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",e[e.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",e[e.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",e[e.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",e[e.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",e[e.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",e[e.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",e[e.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",e[e.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",e[e.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",e[e.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",e[e.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",e[e.MCIERR_DRIVER=278]="MCIERR_DRIVER",e[e.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",e[e.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",e[e.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",e[e.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",e[e.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",e[e.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",e[e.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",e[e.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",e[e.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",e[e.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",e[e.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",e[e.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",e[e.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",e[e.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",e[e.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",e[e.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",e[e.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",e[e.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",e[e.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",e[e.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",e[e.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",e[e.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",e[e.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",e[e.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",e[e.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",e[e.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",e[e.MCIERR_GET_CD=307]="MCIERR_GET_CD",e[e.MCIERR_SET_CD=308]="MCIERR_SET_CD",e[e.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",e[e.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",e[e.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",e[e.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",e[e.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",e[e.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",e[e.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",e[e.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",e[e.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",e[e.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",e[e.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",e[e.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",e[e.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",e[e.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",e[e.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",e[e.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",e[e.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",e[e.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",e[e.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",e[e.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",e[e.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",e[e.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",e[e.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",e[e.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",e[e.WS_VISIBLE=268435456]="WS_VISIBLE",e[e.WS_DISABLED=134217728]="WS_DISABLED",e[e.WS_CAPTION=12582912]="WS_CAPTION",e[e.WS_BORDER=8388608]="WS_BORDER",e[e.WS_DLGFRAME=4194304]="WS_DLGFRAME",e[e.WS_VSCROLL=2097152]="WS_VSCROLL",e[e.WS_HSCROLL=1048576]="WS_HSCROLL",e[e.WS_SYSMENU=524288]="WS_SYSMENU",e[e.WS_THICKFRAME=262144]="WS_THICKFRAME",e[e.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",e[e.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",e[e.WS_GROUP=131072]="WS_GROUP",e[e.WS_TABSTOP=65536]="WS_TABSTOP",e[e.WS_OVERLAPPED=0]="WS_OVERLAPPED",e[e.WS_POPUP=2147483648]="WS_POPUP",e[e.WS_CHILD=1073741824]="WS_CHILD",e[e.IDX_PRIMARY=1]="IDX_PRIMARY",e[e.IDX_UNIQUE=2]="IDX_UNIQUE",e[e.IDX_DESCENDING=4]="IDX_DESCENDING",e[e.IDX_MAINTAINED=8]="IDX_MAINTAINED",e[e.IDX_SUBSET=16]="IDX_SUBSET",e[e.IDX_EXPR=32]="IDX_EXPR",e[e.IDX_IDXOOD=64]="IDX_IDXOOD",e[e.IDX_CASEINSENS=128]="IDX_CASEINSENS",e[e.FLDDBCHAR=513]="FLDDBCHAR",e[e.FLDDBNUM=514]="FLDDBNUM",e[e.FLDDBMEMO=515]="FLDDBMEMO",e[e.FLDDBBOOL=516]="FLDDBBOOL",e[e.FLDDBDATE=517]="FLDDBDATE",e[e.FLDDBFLOAT=518]="FLDDBFLOAT",e[e.FLDDBLOCK=519]="FLDDBLOCK",e[e.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",e[e.FLDDBBINARY=521]="FLDDBBINARY",e[e.FLDDBBYTES=522]="FLDDBBYTES",e[e.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",e[e.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",e[e.BS_CHECKBOX=2]="BS_CHECKBOX",e[e.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",e[e.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",e[e.BS_3STATE=5]="BS_3STATE",e[e.BS_AUTO3STATE=6]="BS_AUTO3STATE",e[e.BS_GROUPBOX=7]="BS_GROUPBOX",e[e.BS_USERBUTTON=8]="BS_USERBUTTON",e[e.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",e[e.BS_OWNERDRAW=11]="BS_OWNERDRAW",e[e.BS_LEFTTEXT=32]="BS_LEFTTEXT",e[e.ES_LEFT=0]="ES_LEFT",e[e.ES_CENTER=1]="ES_CENTER",e[e.ES_RIGHT=2]="ES_RIGHT",e[e.ES_MULTILINE=4]="ES_MULTILINE",e[e.ES_UPPERCASE=8]="ES_UPPERCASE",e[e.ES_LOWERCASE=16]="ES_LOWERCASE",e[e.ES_PASSWORD=32]="ES_PASSWORD",e[e.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",e[e.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",e[e.ES_NOHIDESEL=256]="ES_NOHIDESEL",e[e.SBS_HORZ=0]="SBS_HORZ",e[e.SBS_VERT=1]="SBS_VERT",e[e.SBS_TOPALIGN=2]="SBS_TOPALIGN",e[e.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",e[e.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",e[e.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",e[e.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",e[e.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",e[e.SBS_SIZEBOX=8]="SBS_SIZEBOX",e[e.LBS_NOTIFY=1]="LBS_NOTIFY",e[e.LBS_SORT=2]="LBS_SORT",e[e.LBS_NOREDRAW=4]="LBS_NOREDRAW",e[e.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",e[e.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",e[e.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",e[e.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",e[e.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",e[e.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",e[e.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",e[e.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",e[e.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",e[e.CBS_SIMPLE=1]="CBS_SIMPLE",e[e.CBS_DROPDOWN=2]="CBS_DROPDOWN",e[e.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",e[e.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",e[e.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",e[e.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",e[e.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",e[e.CBS_SORT=256]="CBS_SORT",e[e.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",e[e.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",e[e.BS_SOLID=0]="BS_SOLID",e[e.BS_NULL=1]="BS_NULL",e[e.BS_HATCHED=2]="BS_HATCHED",e[e.BS_PATTERN=3]="BS_PATTERN",e[e.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",e[e.HS_HORIZONTAL=0]="HS_HORIZONTAL",e[e.HS_VERTICAL=1]="HS_VERTICAL",e[e.HS_FDIAGONAL=2]="HS_FDIAGONAL",e[e.HS_BDIAGONAL=3]="HS_BDIAGONAL",e[e.HS_CROSS=4]="HS_CROSS",e[e.HS_DIAGCROSS=5]="HS_DIAGCROSS",e[e.PS_SOLID=0]="PS_SOLID",e[e.PS_DASH=1]="PS_DASH",e[e.PS_DOT=2]="PS_DOT",e[e.PS_DASHDOT=3]="PS_DASHDOT",e[e.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",e[e.PS_NULL=5]="PS_NULL",e[e.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",e[e.R2_BLACK=1]="R2_BLACK",e[e.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",e[e.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",e[e.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",e[e.R2_MASKPENNOT=5]="R2_MASKPENNOT",e[e.R2_NOT=6]="R2_NOT",e[e.R2_XORPEN=7]="R2_XORPEN",e[e.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",e[e.R2_MASKPEN=9]="R2_MASKPEN",e[e.R2_NOTXORPEN=10]="R2_NOTXORPEN",e[e.R2_NOP=11]="R2_NOP",e[e.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",e[e.R2_COPYPEN=13]="R2_COPYPEN",e[e.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",e[e.R2_MERGEPEN=15]="R2_MERGEPEN",e[e.R2_WHITE=16]="R2_WHITE",e[e.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",e[e.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",e[e.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",e[e.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",e[e.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",e[e.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",e[e.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",e[e.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",e[e.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.CUR_ARROW=0]="CUR_ARROW",e[e.CUR_CROSS=1]="CUR_CROSS",e[e.CUR_TEXT=2]="CUR_TEXT",e[e.CUR_NO=3]="CUR_NO",e[e.CUR_SIZE=4]="CUR_SIZE",e[e.CUR_SIZENESW=5]="CUR_SIZENESW",e[e.CUR_SIZENS=6]="CUR_SIZENS",e[e.CUR_SIZENWSE=7]="CUR_SIZENWSE",e[e.CUR_SIZEWE=8]="CUR_SIZEWE",e[e.CUR_UPARROW=9]="CUR_UPARROW",e[e.CUR_WAIT=10]="CUR_WAIT",e[e.CUR_LINK=11]="CUR_LINK",e[e.CUR_HELP=12]="CUR_HELP",e[e.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",e[e.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",e[e.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",e[e.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",e[e.FOG_NONE=0]="FOG_NONE",e[e.FOG_EXP=1]="FOG_EXP",e[e.FOG_EXP2=2]="FOG_EXP2",e[e.FOG_LINEAR=3]="FOG_LINEAR",e[e.TEX_TYPE_1D=1]="TEX_TYPE_1D",e[e.TEX_TYPE_2D=2]="TEX_TYPE_2D",e[e.TEX_TYPE_3D=3]="TEX_TYPE_3D",e[e.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",e[e.SBF_ONE=0]="SBF_ONE",e[e.SBF_ZERO=1]="SBF_ZERO",e[e.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",e[e.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",e[e.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",e[e.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",e[e.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",e[e.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",e[e.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",e[e.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",e[e.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",e[e.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",e[e.CMPF_LESS=2]="CMPF_LESS",e[e.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",e[e.CMPF_EQUAL=4]="CMPF_EQUAL",e[e.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",e[e.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",e[e.CMPF_GREATER=7]="CMPF_GREATER",e[e.CULL_NONE=1]="CULL_NONE",e[e.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",e[e.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",e[e.SO_FLAT=0]="SO_FLAT",e[e.SO_GOURAUD=1]="SO_GOURAUD",e[e.SO_PHONG=2]="SO_PHONG",e[e.PM_POINTS=1]="PM_POINTS",e[e.PM_WIREFRAME=2]="PM_WIREFRAME",e[e.PM_SOLID=3]="PM_SOLID",e[e.LT_POINT=0]="LT_POINT",e[e.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",e[e.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",e[e.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",e[e.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",e[e.OT_POINT_LIST=1]="OT_POINT_LIST",e[e.OT_LINE_LIST=2]="OT_LINE_LIST",e[e.OT_LINE_STRIP=3]="OT_LINE_STRIP",e[e.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",e[e.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",e[e.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",e[e.BBT_POINT=0]="BBT_POINT",e[e.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",e[e.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",e[e.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",e[e.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",e[e.GMM_RELATIVE=0]="GMM_RELATIVE",e[e.GMM_PIXELS=1]="GMM_PIXELS",e[e.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",e[e.GHA_LEFT=0]="GHA_LEFT",e[e.GHA_CENTER=1]="GHA_CENTER",e[e.GHA_RIGHT=2]="GHA_RIGHT",e[e.GVA_TOP=0]="GVA_TOP",e[e.GVA_CENTER=1]="GVA_CENTER",e[e.GVA_BOTTOM=2]="GVA_BOTTOM",e[e.MTHA_LEFT=0]="MTHA_LEFT",e[e.MTHA_CENTER=1]="MTHA_CENTER",e[e.MTVA_BELOW=0]="MTVA_BELOW",e[e.MTVA_ABOVE=1]="MTVA_ABOVE",e[e.MTVA_CENTER=2]="MTVA_CENTER",e[e.PT_BOOL=0]="PT_BOOL",e[e.PT_REAL=1]="PT_REAL",e[e.PT_INT=2]="PT_INT",e[e.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",e[e.PT_SHORT=4]="PT_SHORT",e[e.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",e[e.PT_LONG=6]="PT_LONG",e[e.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",e[e.PT_STRING=8]="PT_STRING",e[e.PT_VECTOR3=9]="PT_VECTOR3",e[e.PT_MATRIX3=10]="PT_MATRIX3",e[e.PT_MATRIX4=11]="PT_MATRIX4",e[e.PT_QUATERNION=12]="PT_QUATERNION",e[e.PT_COLOURVALUE=13]="PT_COLOURVALUE",e[e.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",e[e.NUI_SP_SPINE=1]="NUI_SP_SPINE",e[e.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",e[e.NUI_SP_HEAD=3]="NUI_SP_HEAD",e[e.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",e[e.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",e[e.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",e[e.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",e[e.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",e[e.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",e[e.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",e[e.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",e[e.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",e[e.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",e[e.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",e[e.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",e[e.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",e[e.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",e[e.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",e[e.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",e[e.NUI_SP_COUNT=20]="NUI_SP_COUNT",e[e.WM_DESTROY=2]="WM_DESTROY",e[e.WM_MOVE=3]="WM_MOVE",e[e.WM_SIZE=5]="WM_SIZE",e[e.WM_CLOSE=16]="WM_CLOSE",e[e.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",e[e.WM_COMMAND=273]="WM_COMMAND",e[e.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",e[e.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",e[e.WM_LBUTTONUP=514]="WM_LBUTTONUP",e[e.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",e[e.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",e[e.WM_RBUTTONUP=517]="WM_RBUTTONUP",e[e.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",e[e.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",e[e.WM_MBUTTONUP=520]="WM_MBUTTONUP",e[e.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",e[e.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",e[e.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",e[e.WM_KEYDOWN=256]="WM_KEYDOWN",e[e.WM_KEYUP=257]="WM_KEYUP",e[e.WM_CANCLOSE=1538]="WM_CANCLOSE",e[e.WM_SPACEDONE=1539]="WM_SPACEDONE",e[e.WM_SPACEINIT=1540]="WM_SPACEINIT",e[e.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",e[e.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(O||(O={}));const _g=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],Ss=1<<24,Ts=2<<24;function yh(e){const t=e.toLowerCase().trim();if(t.startsWith("transparent"))return Ss;if(t.startsWith("syscolor"))return Ts|parseInt(t.split("(")[1].split(")")[0]);if(t.startsWith("rgb")){const r=t.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: ${e}`)}function Ke(e){if(e&Ss)return"transparent";const t=e&255;if(e&Ts)return _g[t]||"black";const r=e>>8&255,i=e>>16&255;return`rgb(${t},${r},${i})`}function Pr(e,t,r,i){const s=i===1?Ss:i===2?Ts:0;return e&255|(t&255)<<8|(r&255)<<16|s}function Ni(e){return e&255}function Ri(e){return e>>8&255}function Bi(e){return e>>16&255}var N;(function(e){e[e.Float=1]="Float",e[e.Handle=2]="Handle",e[e.String=3]="String",e[e.ColorRef=4]="ColorRef"})(N||(N={}));class xs{constructor(e,t){this.x=0;this.y=0;this.width=0;this.height=0;this.hidden=!1;const r=this.elem=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("class","stratum-textbox"),r.style.setProperty("position","absolute"),this.setOrigin(t.x,t.y),this.setSize(t.width,t.height),this.setText(t.text),this.setHidden(t.hidden),e.appendChild(r)}setOrigin(e,t){this.elem.style.setProperty("left",e+"px"),this.elem.style.setProperty("top",t+"px")}setSize(e,t){this.elem.style.setProperty("width",e+"px"),this.elem.style.setProperty("height",t+"px")}setHidden(e){this.elem.hidden=e}text(){return this.elem.value}setText(e){this.elem.value=e}destroy(){this.elem.remove()}onEdit(e){this.elem.addEventListener("input",e)}offEdit(e){this.elem.removeEventListener("input",e)}}class J extends Map{static create(e){return new Map(e)}static getFreeHandle(e,t){let r=t||0;for(;e.has(++r););return r}static getFreeNegativeHandle(e){let t=0;for(;e.has(--t););return t}}class ki{constructor(e,{hyperbase:t,handle:r,name:i,options:s,originX:n,originY:o,type:l,dibHandle:c,width:u,height:d,cropX:_,cropY:b,cropW:g,cropH:T}){this.type="bitmap";this.hyperbase=t!=null?t:null,this.scene=e,this.handle=r,this.name=i||"",this.markDeleted=!1,e.dirty=!0,this.isDouble=l==="doubleBitmap";const w=(this.isDouble?e.doubleDibs:e.dibs).get(c);w==null||w.subscribe(this),this.dib=w||null,this._originX=n,this._originY=o;const E=(w==null?void 0:w.width())||0,I=(w==null?void 0:w.height())||0;this.hardHidden=s?!!(s&1):!1,this._width=this.hardHidden?1:u||E,this._height=this.hardHidden?1:d||I,this.cropX=_||0,this.cropY=b||0,this.cropW=g||E,this.cropH=T||I;const R=s||0;this._visible=!0,this._selectable=R&8?0:1;const P=R>>8&31;this._layer=1<<P,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[0]+r*e[3]+e[6])/i}originY(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[1]+r*e[4]+e[7])/i}setOrigin(e,t){var o;const r=this.scene.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return this._originX=s,this._originY=n,(o=this._parent)==null||o.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){var e;return((e=this.dib)==null?void 0:e.width())||0}height(){return this._height}actualHeight(){var e;return((e=this.dib)==null?void 0:e.height())||0}setSize(e,t){var s;if(e<0||t<0)return 0;const r=this._width,i=this._height;return r===0||i===0||(this.onParentResized(this._originX,this._originY,e/r,t/i),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,t,r){var i;return r===0||(this.onParentRotated(e,t,r),(i=this._parent)==null||i.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}setBitmapRect(e,t,r,i){return e<0||t<0||r<0||i<0?0:(this.cropX=e,this.cropY=t,this.cropW=r,this.cropH=i,this.scene.dirty=!0,1)}dibHandle(){return!this.isDouble&&this.dib?this.dib.handle:0}doubleDIBHandle(){return this.isDouble&&this.dib?this.dib.handle:0}delete(){var e,t;(e=this.dib)==null||e.unsubscribe(this),(t=this._parent)==null||t.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var t;if(e===this._parent)return;(t=this._parent)==null||t.removeChild(this),this._parent=e}onParentMoved(e,t){this._originX+=e,this._originY+=t,this.scene.dirty=!0}onParentResized(e,t,r,i){this._originX=e+(this._originX-e)*r,this._originY=t+(this._originY-t)*i,this._width*=r,this._height*=i,this.scene.dirty=!0}onParentRotated(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=this._originX-e,o=this._originY-t,l=n*s-o*i,c=n*i+o*s;this._originX=l+e,this._originY=c+t,this.scene.dirty=!0}render(e,t,r,i){if(this.hardHidden||!this.dib||!this._visible||(this._layer&i)!==0)return;const s=this._originX-t,n=this._originY-r;this.dib.render(e,this.cropX,this.cropY,this.cropW,this.cropH,s,n,this._width,this._height)}tryClick(e,t,r){if(this.hardHidden||!this.dib||!this._visible||(this._layer&r)!==0||this._selectable===0)return;const i=e-this._originX,s=t-this._originY;if(i<0||s<0||i>this._width||s>this._height)return;const n=i*(this.cropW/this._width)+this.cropX,o=s*(this.cropH/this._height)+this.cropY;return this.dib.tryClick(n,o)?this._parent?this._parent.root():this:void 0}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}}class Li{constructor(e,t,{hyperbase:r,handle:i,options:s,name:n,originX:o,originY:l,width:c,height:u,className:d,text:_}){this.type="control";const b=d.toUpperCase();if(b!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${d} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);this.hyperbase=r!=null?r:null,this.handle=i,this.name=n||"",this.scene=e,this.markDeleted=!1,this._originX=o,this._originY=l,this._width=c,this._height=u;const g=s||0;this._visible=!0,this._selectable=g&8?0:1;const T=g>>8&31;this._layer=1<<T,this._parent=null,e.dirty=!0,this.lastX=o-e.originX(),this.lastY=l-e.originY(),this.lastWidth=c,this.lastHeight=u,this.lastHidden=!this._visible,this.wrapper=t.textInput({x:this.lastX,y:this.lastY,width:c,height:u,text:_,hidden:this.lastHidden}),this.wrapper.onEdit(w=>e.dispatchControlNotifyEvent(this.handle,w))}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[0]+r*e[3]+e[6])/i}originY(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[1]+r*e[4]+e[7])/i}setOrigin(e,t){var o;const r=this.scene.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return this._originX=s,this._originY=n,(o=this._parent)==null||o.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,t){var s;if(e<0||t<0)return 0;const r=this._width,i=this._height;return r===0||i===0||(this.onParentResized(this._originX,this._originY,e/r,t/i),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,t,r){var i;return r===0||(this.onParentRotated(e,t,r),(i=this._parent)==null||i.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}controlText(){return this.wrapper.text()}setControlText(e){return this.wrapper.setText(e),1}delete(){var e;this.wrapper.destroy(),(e=this._parent)==null||e.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var t;if(e===this._parent)return;(t=this._parent)==null||t.removeChild(this),this._parent=e}onParentMoved(e,t){this._originX+=e,this._originY+=t,this.scene.dirty=!0}onParentResized(e,t,r,i){this._originX=e+(this._originX-e)*r,this._originY=t+(this._originY-t)*i,this._width*=r,this._height*=i,this.scene.dirty=!0}onParentRotated(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=this._originX-e,o=this._originY-t,l=n*s-o*i,c=n*i+o*s;this._originX=l+e,this._originY=c+t,this.scene.dirty=!0}render(e,t,r,i){const s=!this._visible||(this._layer&i)!==0;s!==this.lastHidden&&(this.lastHidden=s,this.wrapper.setHidden(s));const n=this._originX-t,o=this._originY-r;(n!==this.lastX||o!==this.lastY)&&(this.lastX=n,this.lastY=o,this.wrapper.setOrigin(n,o));const l=this._width,c=this._height;(l!==this.lastWidth||c!==this.lastHeight)&&(this.lastWidth=l,this.lastHeight=c,this.wrapper.setSize(l,c))}tryClick(e,t,r){if(!this._visible||(this._layer&r)!==0||this._selectable===0)return;const i=e-this._originX,s=t-this._originY;return i<0||s<0||i>this._width||s>this._height?void 0:this._parent?this._parent.root():this}textToolHandle(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}}class Mr{constructor(e,{hyperbase:t,handle:r,name:i}){this.type="group";this._minX=0;this._maxX=0;this._minY=0;this._maxY=0;this._parent=null;this.hyperbase=t!=null?t:null,this.scene=e,this.handle=r,this.name=i||"",this.children=[],this.markDeleted=!1}addChildren(e){var t;return e.length===0?this:(this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity,e.forEach(r=>{const i=this.scene.objects.get(r);if(!i)return;this._minX=Math.min(this._minX,i.minX()),this._minY=Math.min(this._minY,i.minY()),this._maxX=Math.max(this._maxX,i.maxX()),this._maxY=Math.max(this._maxY,i.maxY()),i.onParentChanged(this),this.children.push(i)}),(t=this._parent)==null||t.updateBorders(),this)}root(){let e=this;for(;e._parent;)e=e._parent;return e}ungroup(){this.markDeleted=!0;for(const e of this.children.values())e.onParentChanged(null);this.onParentChanged(null)}removeChild(e){if(this.markDeleted)return;this.children=this.children.filter(t=>t.handle!==e.handle),this.children.length===0&&(this._minX=0,this._maxX=0,this._minY=0,this._maxY=0),this.updateBorders()}updateBorders(){var e;if(this.children.length===0)return;this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(const t of this.children.values())this._minX=Math.min(this._minX,t.minX()),this._minY=Math.min(this._minY,t.minY()),this._maxX=Math.max(this._maxX,t.maxX()),this._maxY=Math.max(this._maxY,t.maxY());(e=this._parent)==null||e.updateBorders()}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){const e=this.scene.invMatrix,t=this._minX,r=this._minY,i=t*e[2]+r*e[5]+e[8];return(t*e[0]+r*e[3]+e[6])/i}originY(){const e=this.scene.invMatrix,t=this._minX,r=this._minY,i=t*e[2]+r*e[5]+e[8];return(t*e[1]+r*e[4]+e[7])/i}setOrigin(e,t){var o;const r=this.scene.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return this.onParentMoved(s-this._minX,n-this._minY),(o=this._parent)==null||o.updateBorders(),1}width(){return this._maxX-this._minX}actualWidth(){return this._maxX-this._minX}height(){return this._maxY-this._minY}actualHeight(){return this._maxY-this._minY}setSize(e,t){var s;if(e<0||t<0)return 0;const r=this.width(),i=this.height();return r===0||i===0||(this.onParentResized(this._minX,this._minY,e/r,t/i),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,t,r){var i;return r===0||(this.onParentRotated(e,t,r),(i=this._parent)==null||i.updateBorders()),1}setVisibility(e){for(const t of this.children.values())t.setVisibility(e);return 1}itemHandle(e){return e<0||e>=this.children.length?0:this.children[e].handle}addItem(e){const t=this.scene.objects.get(e);return!t||this.children.some(r=>r.handle===e)?0:(t.onParentChanged(this),this.children.push(t),this.updateBorders(),1)}deleteItem(e){const t=this.children.find(r=>r.handle===e);return t?(t.onParentChanged(null),1):0}delete(){this.markDeleted=!0;for(const e of this.children.values())e.delete();this.onParentChanged(null)}getChildByName(e){if(this.name===e)return this.handle;for(const t of this.children.values()){const r=t.getChildByName(e);if(r!==0)return r}return 0}minX(){return this._minX}minY(){return this._minY}maxX(){return this._maxX}maxY(){return this._maxY}onParentChanged(e){var t;if(e===this._parent)return;{let r=e;for(;r;){if(r===this)return;r=r._parent}}(t=this._parent)==null||t.removeChild(this),this._parent=e}onParentMoved(e,t){if(this.children.length===0)return;for(const r of this.children.values())r.onParentMoved(e,t);this._minX+=e,this._minY+=t,this._maxX+=e,this._maxY+=t}onParentResized(e,t,r,i){if(this.children.length===0)return;this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(const s of this.children.values())s.onParentResized(e,t,r,i),this._minX=Math.min(this._minX,s.minX()),this._minY=Math.min(this._minY,s.minY()),this._maxX=Math.max(this._maxX,s.maxX()),this._maxY=Math.max(this._maxY,s.maxY())}onParentRotated(e,t,r){if(this.children.length===0)return;this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(const i of this.children.values())i.onParentRotated(e,t,r),this._minX=Math.min(this._minX,i.minX()),this._minY=Math.min(this._minY,i.minY()),this._maxX=Math.max(this._maxX,i.maxX()),this._maxY=Math.max(this._maxY,i.maxY())}addPoint(){return 0}deletePoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}}class rr{constructor(e,{hyperbase:t,handle:r,name:i,options:s,coords:n,penHandle:o,brushHandle:l}){this.type="line";var w,E;if(n.length<2)throw Error("\u041B\u0438\u043D\u0438\u044F \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u043E\u0447\u0435\u043A");this.hyperbase=t!=null?t:null,this.scene=e,this.handle=r,this.name=i||"",this.cnv=document.createElement("canvas");const c=this.cnv.getContext("2d",{alpha:!0});if(!c)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=c,this.markDeleted=!1,this.needRedraw=!0,e.dirty=!0;let u=n[0],d=n[1],_=u,b=d;for(let I=2;I<n.length;I+=2){const R=n[I+0],P=n[I+1];R<u&&(u=R),R>_&&(_=R),P<d&&(d=P),P>b&&(b=P)}this.coords=n.slice();for(let I=0;I<n.length;I+=2)this.coords[I+0]-=u,this.coords[I+1]-=d;this._originX=u,this._originY=d,this._width=_-u,this._height=b-d;const g=s||0;this._visible=!0,this._selectable=g&8?0:1;const T=g>>8&31;this._layer=1<<T,this._parent=null,this.pen=e.pens.get(o)||null,this.brush=e.brushes.get(l)||null,(w=this.pen)==null||w.subscribe(this),(E=this.brush)==null||E.subscribe(this)}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[0]+r*e[3]+e[6])/i}originY(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[1]+r*e[4]+e[7])/i}setOrigin(e,t){var o;const r=this.scene.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return this._originX=s,this._originY=n,(o=this._parent)==null||o.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,t){var s;if(e<0||t<0)return 0;const r=this._width,i=this._height;return r===0||i===0||(this.onParentResized(this._originX,this._originY,e/r,t/i),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,t,r){var i;return r===0||(this.onParentRotated(e,t,r),(i=this._parent)==null||i.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}pointOriginX(e){const t=e*2;if(t<0||t>=this.coords.length)return 0;const r=this.scene.invMatrix,i=this.coords[t+0]+this._originX,s=this.coords[t+1]+this._originY,n=i*r[2]+s*r[5]+r[8];return(i*r[0]+s*r[3]+r[6])/n}pointOriginY(e){const t=e*2;if(t<0||t>=this.coords.length)return 0;const r=this.scene.invMatrix,i=this.coords[t+0]+this._originX,s=this.coords[t+1]+this._originY,n=i*r[2]+s*r[5]+r[8];return(i*r[1]+s*r[4]+r[7])/n}updateSize(){var s;let e=Infinity,t=-Infinity,r=Infinity,i=-Infinity;for(let n=0;n<this.coords.length;n+=2){const o=this.coords[n+0],l=this.coords[n+1];o<e&&(e=o),o>t&&(t=o),l<r&&(r=l),l>i&&(i=l)}if(e!==0||r!==0){for(let n=0;n<this.coords.length;n+=2)this.coords[n+0]-=e,this.coords[n+1]-=r;this._originX+=e,this._originY+=r}this._width=t-e,this._height=i-r,(s=this._parent)==null||s.updateBorders(),this.scene.dirty=!0,this.needRedraw=!0}setPointOrigin(e,t,r){const i=e*2;if(i<0||i>=this.coords.length)return 0;const s=this.scene.matrix,n=t*s[2]+r*s[5]+s[8],o=(t*s[0]+r*s[3]+s[6])/n,l=(t*s[1]+r*s[4]+s[7])/n,c=o-this._originX,u=l-this._originY;return this.coords[i+0]=c,this.coords[i+1]=u,this.updateSize(),1}addPoint(e,t,r){if(Math.floor(e)===0)return 0;const i=this.scene.matrix,s=t*i[2]+r*i[5]+i[8],n=(t*i[0]+r*i[3]+i[6])/s,o=(t*i[1]+r*i[4]+i[7])/s,l=n-this._originX,c=o-this._originY,u=e*2;return u<0||u>=this.coords.length?this.coords.push(l,c):this.coords.splice(u,0,l,c),this.updateSize(),1}deletePoint(e){const t=e*2;return e<0||t>this.coords.length?0:(this.coords.splice(t,2),this.updateSize(),1)}pointCount(){return this.coords.length/2}penHandle(){return this.pen?this.pen.handle:0}brushHandle(){return this.brush?this.brush.handle:0}delete(){var e,t,r;(e=this.pen)==null||e.unsubscribe(this),(t=this.brush)==null||t.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var t;if(e===this._parent)return;(t=this._parent)==null||t.removeChild(this),this._parent=e}onParentMoved(e,t){this._originX+=e,this._originY+=t,this.scene.dirty=!0}onParentResized(e,t,r,i){this._originX=e+(this._originX-e)*r,this._originY=t+(this._originY-t)*i;for(let s=0;s<this.coords.length;s+=2)this.coords[s+0]*=r,this.coords[s+1]*=i;this._width*=r,this._height*=i,this.needRedraw=!0,this.scene.dirty=!0}onParentRotated(e,t,r){const i=e-this._originX,s=t-this._originY;let n=Infinity,o=-Infinity,l=Infinity,c=-Infinity;const u=Math.sin(r),d=Math.cos(r);for(let _=0;_<this.coords.length;_+=2){const b=this.coords[_+0]-i,g=this.coords[_+1]-s,T=b*d-g*u+i,w=b*u+g*d+s;this.coords[_+0]=T,this.coords[_+1]=w,T<n&&(n=T),T>o&&(o=T),w<l&&(l=w),w>c&&(c=w)}for(let _=0;_<this.coords.length;_+=2)this.coords[_+0]-=n,this.coords[_+1]-=l;this._originX+=n,this._originY+=l,this._width=o-n,this._height=c-l,this.scene.dirty=!0,this.needRedraw=!0}static drawFigure(e,t,r,i,s,n,o){e.beginPath(),e.moveTo(i[0]+t+o,i[1]+r+o);for(let l=2;l<i.length;l+=2)e.lineTo(i[l]+t+o,i[l+1]+r+o);s&&(e.closePath(),e.fillStyle=s,e.fill("evenodd")),n&&(e.lineWidth=o,e.strokeStyle=n,e.stroke())}render(e,t,r,i){var u,d;if(!this._visible||(this._layer&i)!==0)return;const s=this.pen?this.pen.width()||1:0,n=this._originX-t-s,o=this._originY-r-s,l=this.coords.length>4&&((u=this.brush)==null?void 0:u.fillStyle(e))||null,c=((d=this.pen)==null?void 0:d.strokeStyle())||null;if(!l&&!c)return;if(this._width*this._height>4194304){this._selectable=0,rr.drawFigure(e,n,o,this.coords,l,c,s);return}this.needRedraw&&(this.cnv.width=Math.max(this._width+s*2,1),this.cnv.height=Math.max(this._height+s*2,1),rr.drawFigure(this.ctx2,0,0,this.coords,l,c,s),this.needRedraw=!1),e.drawImage(this.cnv,n,o)}tryClick(e,t,r){if(!this._visible||(this._layer&r)!==0||this._selectable===0)return;const i=this.pen?this.pen.width()||1:0,s=e-this._originX,n=t-this._originY;return s<-i||n<-i||s>this._width+i||n>this._height+i||this.ctx2.getImageData(s,n,1,1).data[3]===0?void 0:this._parent?this._parent.root():this}toolChanged(){this.needRedraw=!0,this.scene.dirty=!0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}}class Fi{constructor(e,{hyperbase:t,handle:r,name:i,options:s,originX:n,originY:o,width:l,height:c,angle:u,textToolHandle:d}){this.type="text";var g;this.hyperbase=t!=null?t:null,this.scene=e,this.handle=r,this.name=i||"",this.markDeleted=!1,e.dirty=!0,this.textTool=e.texts.get(d)||null,(g=this.textTool)==null||g.subscribe(this),this._originX=n,this._originY=o,this._angle=u/-10*Math.PI/180,this._width=l||this.actualWidth(),this._height=c||this.actualHeight();const _=s||0;this._visible=!0,this._selectable=_&8?0:1;const b=_>>8&31;this._layer=1<<b,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[0]+r*e[3]+e[6])/i}originY(){const e=this.scene.invMatrix,t=this._originX,r=this._originY,i=t*e[2]+r*e[5]+e[8];return(t*e[1]+r*e[4]+e[7])/i}setOrigin(e,t){var o;const r=this.scene.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return this._originX=s,this._originY=n,(o=this._parent)==null||o.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}height(){return this._height}actualWidth(){var e;return((e=this.textTool)==null?void 0:e.width())||0}actualHeight(){var e;return((e=this.textTool)==null?void 0:e.height())||0}setSize(e,t){var r;return e<0||t<0?0:(this._width=e,this._height=t,(r=this._parent)==null||r.updateBorders(),this.scene.dirty=!0,1)}angle(){return this._angle}rotate(e,t,r){var i;return r===0||(this.onParentRotated(e,t,r),(i=this._parent)==null||i.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}textToolHandle(){return this.textTool?this.textTool.handle:0}delete(){var e,t;(e=this.textTool)==null||e.unsubscribe(this),(t=this._parent)==null||t.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var t;if(e===this._parent)return;(t=this._parent)==null||t.removeChild(this),this._parent=e}onParentMoved(e,t){this._originX+=e,this._originY+=t,this.scene.dirty=!0}onParentResized(e,t,r,i){this._originX=e+(this._originX-e)*r,this._originY=t+(this._originY-t)*i,this._width*=r,this._height*=i,this.scene.dirty=!0}onParentRotated(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=this._originX-e,o=this._originY-t,l=n*s-o*i,c=n*i+o*s;this._originX=l+e,this._originY=c+t,this._angle+=r,this.scene.dirty=!0}render(e,t,r,i){if(!this.textTool||!this._visible||(this._layer&i)!==0)return;const s=this._originX-t,n=this._originY-r;this.textTool.render(e,s,n,this._width,this._height,this._angle)}tryClick(e,t,r){if(!this.textTool||!this._visible||(this._layer&r)!==0||this._selectable===0)return;const i=Math.sin(-this._angle),s=Math.cos(-this._angle),n=e-this._originX,o=t-this._originY,l=n*s-o*i,c=n*i+o*s;return l<0||c<0||l>this._width||c>this._height?void 0:this._parent?this._parent.root():this}addPoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}}class Pi{constructor(e,{handle:t,color:r,hatch:i,rop2:s,style:n,dibHandle:o}){var l;this.handle=t,this.subs=new Set,this._color=r,this._cssColor=Ke(r),this._style=n,this._hatch=i,this._rop=s,this._dibTool=o&&e.dibs.get(o)||null,(l=this._dibTool)==null||l.subscribe(this),this.scene=e}toolChanged(){this.subs.forEach(e=>e.toolChanged())}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}dibTool(){return this._dibTool}setDIB(e){var t,r;return(t=this._dibTool)==null||t.unsubscribe(this),this._dibTool=this.scene.dibs.get(e)||null,(r=this._dibTool)==null||r.subscribe(this),this.subs.forEach(i=>i.toolChanged()),1}dibHandle(){var e;return((e=this._dibTool)==null?void 0:e.handle)||0}color(){return this._color}setColor(e){return this._color=e,this._cssColor=Ke(e),this.subs.forEach(t=>t.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(t=>t.toolChanged()),1}hatch(){return this._hatch}setHatch(e){return this._hatch=e,1}rop(){return this._rop}setRop(e){return this._rop=e,1}fillStyle(e){var t,r;switch(this._style){case O.BS_SOLID:return this._cssColor;case O.BS_NULL:return null;case O.BS_PATTERN:return(r=(t=this.dibTool())==null?void 0:t.pattern(e))!=null?r:"white";default:return"white"}}}const Sh=Gr(Hi()),Mi=[String.fromCharCode(0),String.fromCharCode(1),String.fromCharCode(2),String.fromCharCode(3),String.fromCharCode(4),String.fromCharCode(5),String.fromCharCode(6),String.fromCharCode(7),String.fromCharCode(8),String.fromCharCode(9),String.fromCharCode(10),String.fromCharCode(11),String.fromCharCode(12),String.fromCharCode(13),String.fromCharCode(14),String.fromCharCode(15),String.fromCharCode(16),String.fromCharCode(17),String.fromCharCode(18),String.fromCharCode(19),String.fromCharCode(20),String.fromCharCode(21),String.fromCharCode(22),String.fromCharCode(23),String.fromCharCode(24),String.fromCharCode(25),String.fromCharCode(26),String.fromCharCode(27),String.fromCharCode(28),String.fromCharCode(29),String.fromCharCode(30),String.fromCharCode(31),String.fromCharCode(32),String.fromCharCode(33),String.fromCharCode(34),String.fromCharCode(35),String.fromCharCode(36),String.fromCharCode(37),String.fromCharCode(38),String.fromCharCode(39),String.fromCharCode(40),String.fromCharCode(41),String.fromCharCode(42),String.fromCharCode(43),String.fromCharCode(44),String.fromCharCode(45),String.fromCharCode(46),String.fromCharCode(47),String.fromCharCode(48),String.fromCharCode(49),String.fromCharCode(50),String.fromCharCode(51),String.fromCharCode(52),String.fromCharCode(53),String.fromCharCode(54),String.fromCharCode(55),String.fromCharCode(56),String.fromCharCode(57),String.fromCharCode(58),String.fromCharCode(59),String.fromCharCode(60),String.fromCharCode(61),String.fromCharCode(62),String.fromCharCode(63),String.fromCharCode(64),String.fromCharCode(65),String.fromCharCode(66),String.fromCharCode(67),String.fromCharCode(68),String.fromCharCode(69),String.fromCharCode(70),String.fromCharCode(71),String.fromCharCode(72),String.fromCharCode(73),String.fromCharCode(74),String.fromCharCode(75),String.fromCharCode(76),String.fromCharCode(77),String.fromCharCode(78),String.fromCharCode(79),String.fromCharCode(80),String.fromCharCode(81),String.fromCharCode(82),String.fromCharCode(83),String.fromCharCode(84),String.fromCharCode(85),String.fromCharCode(86),String.fromCharCode(87),String.fromCharCode(88),String.fromCharCode(89),String.fromCharCode(90),String.fromCharCode(91),String.fromCharCode(92),String.fromCharCode(93),String.fromCharCode(94),String.fromCharCode(95),String.fromCharCode(96),String.fromCharCode(97),String.fromCharCode(98),String.fromCharCode(99),String.fromCharCode(100),String.fromCharCode(101),String.fromCharCode(102),String.fromCharCode(103),String.fromCharCode(104),String.fromCharCode(105),String.fromCharCode(106),String.fromCharCode(107),String.fromCharCode(108),String.fromCharCode(109),String.fromCharCode(110),String.fromCharCode(111),String.fromCharCode(112),String.fromCharCode(113),String.fromCharCode(114),String.fromCharCode(115),String.fromCharCode(116),String.fromCharCode(117),String.fromCharCode(118),String.fromCharCode(119),String.fromCharCode(120),String.fromCharCode(121),String.fromCharCode(122),String.fromCharCode(123),String.fromCharCode(124),String.fromCharCode(125),String.fromCharCode(126),String.fromCharCode(127),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function Ci(e){return Array.from(e).map(t=>Mi[t]).join("")}const wg=" ".charCodeAt(0);function vh(e){return new Uint8Array([...e].map(t=>{const r=Mi.indexOf(t);return r>-1?r:wg}))}class ir{constructor(e,t){e instanceof ArrayBuffer?this.v=new DataView(e):this.v=new DataView(e.buffer,e.byteOffset,e.byteLength),this.p=0,this.name=t!=null?t:""}pos(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}size(){return this.v.byteLength}eof(){return this.p>=this.size()}bytes(e){const t=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,t}byte(){const e=this.v.getUint8(this.p);return this.p+=1,e}int16(){const e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){const e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){const e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){const e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){const e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?Ci(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){const t=e!=null?e:this.size()-this.p,r=this.p;let i=0;for(;i<t-1&&this.v.getUint8(r+ ++i)!==0;);const s=this.fixedString(i);return this.p+=1,s}vmString(){const e=this.uint16()*2,t=this.v.getUint8(this.p+e-2)===0?2:1,r=this.fixedString(e-t);return this.p+=t,r}point2d(){return{x:this.float64(),y:this.float64()}}point2dInt(){return{x:this.int16(),y:this.int16()}}}class dt extends Error{constructor(e,t){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.name||""}:
${t}`)}}class Ie extends dt{constructor(e,t,r){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${t.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}}class yg{constructor(e,t,r=!1,i=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.data=t,this.pos=i,this.view=e,this.is_with_alpha=!!r,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){const e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let t=0;t<e;t++){const r=this.view.getUint8(this.pos++),i=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);this.palette[t]={red:s,green:i,blue:r,quad:n}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){const e="bit"+this.bitPP,t=this.width*this.height*4;if(this.data.length!==t)throw Error("Error reading BMP file");if(e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){const e=Math.ceil(this.width/8),t=e%4;let r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let s=0;s<e;s++){const n=this.view.getUint8(this.pos++),o=i*this.width*4+s*8*4;for(let l=0;l<8&&s*8+l<this.width;l++){const c=this.palette[n>>7-l&1];this.data[o+l*4]=c.red,this.data[o+l*4+1]=c.green,this.data[o+l*4+2]=c.blue,this.data[o+l*4+3]=255}}t!==0&&(this.pos+=4-t)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0,r=!1;const i=s=>{const n=this.palette[s];this.data[e]=n.red,this.data[e+1]=n.green,this.data[e+2]=n.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const s=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);if(s===0)if(n===0){this.bottom_up?t--:t++,e=t*this.width*4,r=!1;continue}else{if(n===1)break;if(n===2){const o=this.view.getUint8(this.pos++),l=this.view.getUint8(this.pos++);this.bottom_up?t-=l:t+=l,e+=l*this.width*4+o*4}else{let o=this.view.getUint8(this.pos++);for(let l=0;l<n;l++)r?i.call(this,o&15):i.call(this,(o&240)>>4),l&1&&l+1<n&&(o=this.view.getUint8(this.pos++)),r=!r;(n+1>>1&1)===1&&this.pos++}}else for(let o=0;o<s;o++)r?i.call(this,n&15):i.call(this,(n&240)>>4),r=!r}}else{const e=Math.ceil(this.width/2),t=e%4;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let s=0;s<e;s++){const n=this.view.getUint8(this.pos++),o=i*this.width*4+s*2*4,l=n>>4,c=n&15;let u=this.palette[l];if(this.data[o]=u.red,this.data[o+1]=u.green,this.data[o+2]=u.blue,this.data[o+3]=255,s*2+1>=this.width)break;u=this.palette[c],this.data[o+4]=u.red,this.data[o+4+1]=u.green,this.data[o+4+2]=u.blue,this.data[o+4+3]=255}t!==0&&(this.pos+=4-t)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0;const r=i=>{const s=this.palette[i];this.data[e]=s.red,this.data[e+1]=s.green,this.data[e+2]=s.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const i=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);if(i===0)if(s===0){this.bottom_up?t--:t++,e=t*this.width*4;continue}else{if(s===1)break;if(s===2){const n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.bottom_up?t-=o:t+=o,e+=o*this.width*4+n*4}else{for(let n=0;n<s;n++){const o=this.view.getUint8(this.pos++);r.call(this,o)}(s&1)===1&&this.pos++}}else for(let n=0;n<i;n++)r.call(this,s)}}else{const e=this.width%4;for(let t=this.height-1;t>=0;t--){const r=this.bottom_up?t:this.height-1-t;for(let i=0;i<this.width;i++){const s=this.view.getUint8(this.pos++),n=r*this.width*4+i*4;if(s<this.palette.length){const o=this.palette[s];this.data[n]=o.red,this.data[n+1]=o.green,this.data[n+2]=o.blue,this.data[n+3]=255}else this.data[n]=255,this.data[n+1]=255,this.data[n+2]=255,this.data[n+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){const e=this.width%3,t=parseInt("11111",2),r=t;for(let i=this.height-1;i>=0;i--){const s=this.bottom_up?i:this.height-1-i;for(let n=0;n<this.width;n++){const o=this.view.getUint16(this.pos,!0);this.pos+=2;const l=(o&r)/r*255|0,c=(o>>5&r)/r*255|0,u=(o>>10&r)/r*255|0,d=s*this.width*4+n*4;this.data[d]=u,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=e}}bit16(){const e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);const t=[0,0,0];for(let r=0;r<16;r++)this.maskRed>>r&1&&t[0]++,this.maskGreen>>r&1&&t[1]++,this.maskBlue>>r&1&&t[2]++;t[1]+=t[0],t[2]+=t[1],t[0]=8-t[0],t[1]-=8,t[2]-=8;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let s=0;s<this.width;s++){const n=this.view.getUint16(this.pos,!0);this.pos+=2;const o=(n&this.maskBlue)<<t[0],l=(n&this.maskGreen)>>t[1],c=(n&this.maskRed)>>t[2],u=i*this.width*4+s*4;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=o,this.data[u+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=t*this.width*4+r*4;this.data[o]=n,this.data[o+1]=s,this.data[o+2]=i,this.data[o+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){this.view.getUint8(this.pos++);const i=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=t*this.width*4+r*4;this.data[o]=n,this.data[o+1]=s,this.data[o+2]=i,this.data[o+3]=255}}}else for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);const o=t*this.width*4+r*4;this.data[o]=n,this.data[o+1]=s,this.data[o+2]=i,this.data[o+3]=255}}}}function Ui(e,t){new yg(e,t)}function Es(e){return{width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}function Is(e){const t=e.pos(),r=e.uint16();if(r!==19778)throw new Ie(e,r,19778);const i=e.int32();return e.seek(t),i}function Os(e){return new DataView(e.buffer,e.byteOffset)}function zi(e){const t=e.bytes(Is(e)),r=Os(t),{width:i,height:s}=Es(r);if(i===0||s===0)return null;const n=document.createElement("canvas");n.width=i,n.height=s;const o=n.getContext("2d",{alpha:!1});if(!o)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${e.name}`);const l=o.createImageData(i,s);return Ui(r,l.data),o.putImageData(l,0,0),o}function nr(e){const t=e.bytes(Is(e)),r=e.bytes(Is(e)),i=Os(t),{width:s,height:n}=Es(i);if(s===0||n===0)return null;const o=document.createElement("canvas");o.width=s,o.height=n;const l=o.getContext("2d",{alpha:!0});if(!l)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${e.name}`);const c=l.createImageData(s,n),u=c.data,d=new Uint8ClampedArray(s*n*4);Ui(i,u),Ui(Os(r),d);for(let _=3;_<u.length&&_<d.length;_+=4)u[_]=255^d[_-1];return l.putImageData(c,0,0),l}class we{static loadBitmap(e){const t=we.promises.get(e);if(t)return t;const r=new Promise(i=>{const s=new Image;s.addEventListener("load",()=>{const n=document.createElement("canvas"),o=n.getContext("2d",{alpha:!1});if(!o||s.width===0||s.height===0){i(null);return}n.width=s.width,n.height=s.height,o.drawImage(s,0,0),i(o)}),s.addEventListener("error",()=>i(null)),s.src=e});return this.promises.set(e,r),r}static loadDBM(e){const t=we.promises.get(e);if(t)return t;const r=new Promise(i=>me(this,null,function*(){const s=yield fetch(e,{cache:"force-cache"}),n=yield s.arrayBuffer(),o=nr(new ir(n,e));i(o)}));return we.promises.set(e,r),r}constructor(e){if(this.handle=e.handle,this._pattern=null,this.subs=new Set,e.type==="image")this.img=e.img;else{this.img=null;const t=Sh.options.iconsLocation;if(!t)return;const r=`${t.endsWith("/")?t:t+"/"}${e.filename.toUpperCase()}`,i=e.type==="BMPReference"?we.loadBitmap:we.loadDBM;i(r).then(s=>{this.img=s,this.subs.forEach(n=>n.toolChanged())})}}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}getPixel(e,t){if(!this.img)return 0;const r=this.img.getImageData(e,t,1,1).data;return Pr(r[0],r[1],r[2],0)}setPixel(e,t,r){if(!this.img)return 1;const i=this.img.createImageData(1,1),s=i.data;return s[0]=Ni(r),s[1]=Ri(r),s[2]=Bi(r),s[3]=255,this.img.putImageData(i,e,t),this.subs.forEach(n=>n.toolChanged()),1}pattern(e){return this.img?this._pattern?this._pattern:this._pattern=e.createPattern(this.img.canvas,"repeat"):null}render(e,t,r,i,s,n,o,l,c){this.img&&e.drawImage(this.img.canvas,t,r,i,s,n,o,l,c)}tryClick(e,t){return this.img?this.img.getImageData(e,t,1,1).data[3]!==0:!1}width(){var e,t;return(t=(e=this.img)==null?void 0:e.canvas.width)!=null?t:0}height(){var e,t;return(t=(e=this.img)==null?void 0:e.canvas.height)!=null?t:0}}we.promises=new Map;class ji{constructor({handle:e,fontName:t,height:r,italic:i,underline:s,strikeOut:n,weight:o}){this.handle=e,this.subs=new Set,this._name=t,this._size=r||0,this._size*=this._size<0?-1:1,this._style=(i?1:0)|(s?2:0)|(n?4:0)|(o?8:0),this._cssName=t.toUpperCase().endsWith(" CYR")?t.slice(0,t.length-4):t}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}name(){return this._name}setName(e){return this._name=e,this._cssName=e.endsWith(" CYR")?e.slice(0,e.length-4):e,this.subs.forEach(t=>t.toolChanged()),1}size(){return this._size}setSize(e){return this._size=e,this.subs.forEach(t=>t.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(t=>t.toolChanged()),1}underline(){return!!(this._style&2)}strikeOut(){return!!(this._style&4)}toCSSString(){return`${this._style&8?"bold":""} ${this._style&1?"italic":""} ${this._size}px ${this._cssName}`}}class Wi{constructor({handle:e,color:t,rop2:r,style:i,width:s}){this.handle=e,this.subs=new Set,this._color=t,this._cssColor=Ke(t),this._width=s,this._style=i,this._rop=r}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}color(){return this._color}setColor(e){return this._color=e,this._cssColor=Ke(e),this.subs.forEach(t=>t.toolChanged()),1}width(){return this._width}setWidth(e){return this._width=e,this.subs.forEach(t=>t.toolChanged()),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(t=>t.toolChanged()),1}rop(){return this._rop}setRop(e){return this._rop=e,1}strokeStyle(){return this._style===O.PS_NULL?null:this._cssColor}}class $i{constructor({handle:e,text:t}){this.handle=e,this.subs=new Set,this._text=t}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}text(){return this._text}setText(e){return this._text=e,this.subs.forEach(t=>t.toolChanged()),1}}class Vi{constructor(e,{handle:t,textCollection:r}){this.handle=t,this.subs=new Set,this.scene=e,this.cnv=document.createElement("canvas");const i=this.cnv.getContext("2d",{alpha:!0});if(!i)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=i,this.needUpdatePrepared=!0,this.needRedraw=!0,this.textCollection=r.map(s=>{const n=e.fonts.get(s.fontHandle)||null;n==null||n.subscribe(this);const o=e.strings.get(s.stringHandle)||null;return o==null||o.subscribe(this),{font:n,string:o,fgColor:s.fgColor,bgColor:s.bgColor}}),this.prepared=[],this._width=0,this._height=0}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}toolChanged(){this.needRedraw=!0,this.needUpdatePrepared=!0,this.subs.forEach(e=>e.toolChanged())}textCount(){return this.textCollection.length}fontHandle(e){if(e<0||e>=this.textCollection.length)return 0;const t=this.textCollection[e].font;return t?t.handle:0}stringHandle(e){if(e<0||e>=this.textCollection.length)return 0;const t=this.textCollection[e].string;return t?t.handle:0}fgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].fgColor}bgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].bgColor}updatePrepared(){if(!this.needUpdatePrepared)return;const e=this.ctx2,t=[];let r=0,i=0,s=0,n=0,o=[];for(const l of this.textCollection){const c=l.font,u=l.string;if(!c||!u)continue;const d=Ke(l.fgColor),_=Ke(l.bgColor),b=c.toCSSString(),g=c.size(),T=u.text().split(`
`);e.font=b;let w=!1;for(const E of T){w&&(t.push({row:o,height:n}),i=Math.max(i,s),r+=n,o=[],s=0,n=0);const I=e.measureText(E).width;o.push({elem:E,font:b,width:I,height:g,fgColor:d,bgColor:_,underline:c.underline(),strikeout:c.strikeOut()}),s+=I,w=!0,n=Math.max(n,g)}}t.push({row:o,height:n}),i=Math.max(i,s),r+=n,this._width=i*1.01,this._height=r*1.01,this.prepared=t,this.needUpdatePrepared=!1}redraw(){if(!this.needRedraw)return;this.updatePrepared(),this.cnv.width=Math.max(this._width,1),this.cnv.height=Math.max(this._height,1);const e=this.ctx2;let t=0,r=0;for(const{row:i,height:s}of this.prepared){t=0,r+=s;for(const{elem:n,font:o,width:l,height:c,bgColor:u,fgColor:d,underline:_,strikeout:b}of i){e.font=o,e.textAlign="left",e.textBaseline="ideographic";const g=c,T=(s-g)/4;e.fillStyle=u,e.fillRect(t,r-g-T,l,g),e.fillStyle=d;const w=r-T+g/15;e.fillText(n,t,w);const E=g/20;b&&e.fillRect(t,r-g/2.5,l,E),_&&e.fillRect(t,r-E,l,E),t+=l}}this.needRedraw=!1}render(e,t,r,i,s,n){if(this.redraw(),this.cnv.width===0||this.cnv.height===0)return;e.save(),e.translate(t,r),e.rotate(n),e.drawImage(this.cnv,0,0,i*1.02,s*1.02,0,0,i*1.02,s*1.02),e.restore()}width(){return this.updatePrepared(),this._width}height(){return this.updatePrepared(),this._height}setValues(e,t,r,i,s){var o,l,c,u;if(e<0||e>=this.textCollection.length)return 0;const n=this.textCollection[e];if(t>0&&((o=n.font)==null?void 0:o.handle)!==t){(l=n.font)==null||l.unsubscribe(this);const d=this.scene.fonts.get(t)||null;d==null||d.subscribe(this),n.font=d}if(r>0&&((c=n.string)==null?void 0:c.handle)!==r){(u=n.string)==null||u.unsubscribe(this);const d=this.scene.strings.get(r)||null;d==null||d.subscribe(this),n.string=d}return n.fgColor=i,n.bgColor=s,this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(d=>d.toolChanged()),1}}class Xi{constructor(e,t){this.capture=null;this.moveSubs=new Map;this.leftButtonUpSubs=new Map;this.leftButtonDownSubs=new Map;this.rightButtonUpSubs=new Map;this.rightButtonDownSubs=new Map;this.middleButtonUpSubs=new Map;this.middleButtonDownSubs=new Map;this.blocked=!1;this.controlNotifySubs=new Map;var s,n,o,l,c,u,d,_,b,g,T;if(this.dirty=!1,this.html=e,this.hyperTarget=null,this.cursor="default",!t){this._originX=0,this._originY=0,this._scale=1,this.layers=0,this.objects=new Map,this.primaryObjects=[],this.pens=new Map,this.brushes=new Map,this.dibs=new Map,this.doubleDibs=new Map,this.strings=new Map,this.fonts=new Map,this.texts=new Map,this.matrix=[1,0,0,0,1,0,0,0,1],this.invMatrix=[1,0,0,0,1,0,0,0,1],this.brush=null;return}this.pens=new Map((s=t.penTools)==null?void 0:s.map(w=>[w.handle,new Wi(w)])),this.dibs=new Map((n=t.dibTools)==null?void 0:n.map(w=>[w.handle,new we(w)])),this.brushes=new Map((o=t.brushTools)==null?void 0:o.map(w=>[w.handle,new Pi(this,w)])),this.doubleDibs=new Map((l=t.doubleDibTools)==null?void 0:l.map(w=>[w.handle,new we(w)])),this.strings=new Map((c=t.stringTools)==null?void 0:c.map(w=>[w.handle,new $i(w)])),this.fonts=new Map((u=t.fontTools)==null?void 0:u.map(w=>[w.handle,new ji(w)])),this.texts=new Map((d=t.textTools)==null?void 0:d.map(w=>[w.handle,new Vi(this,w)])),this.brush=t.brushHandle>0&&this.brushes.get(t.brushHandle)||null,(_=this.brush)==null||_.subscribe(this),this.matrix=((b=t.crdSystem)==null?void 0:b.matrix.slice())||[1,0,0,0,1,0,0,0,1],this.invMatrix=t.crdSystem?Xi.getInversedMatrix(this.matrix):[1,0,0,0,1,0,0,0,1],this._originX=t.origin.x,this._originY=t.origin.y,this.layers=t.layers,this._scale=1;const r=new Set,i=w=>{switch(w.type){case"group":const E=new Mr(this,w);return r.add({g:E,h:w.childHandles}),[w.handle,E];case"line":return[w.handle,new rr(this,w)];case"text":return[w.handle,new Fi(this,w)];case"control":return[w.handle,new Li(this,e,w)];case"bitmap":case"doubleBitmap":return[w.handle,new ki(this,w)]}};this.objects=new Map((g=t.elements)==null?void 0:g.map(i)),r.forEach(w=>w.g.addChildren(w.h)),this.primaryObjects=[],(T=t.elementOrder)==null||T.forEach(w=>{const E=this.objects.get(w);if(!E||E.type==="group")return;this.primaryObjects.push(E)})}static getInversedMatrix(e){const t=e[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]);return[(e[4]*e[8]-e[7]*e[5])/t,(e[2]*e[7]-e[1]*e[8])/t,(e[1]*e[5]-e[2]*e[4])/t,(e[5]*e[6]-e[3]*e[8])/t,(e[0]*e[8]-e[2]*e[6])/t,(e[3]*e[2]-e[0]*e[5])/t,(e[3]*e[7]-e[6]*e[4])/t,(e[6]*e[1]-e[0]*e[7])/t,(e[0]*e[4]-e[3]*e[1])/t]}setHyper(e,t){const r=this.objects.get(e);return r?(r.hyperbase=t,1):0}tryHyper(e,t,r){var n,o;const i=r||this.getObjectFromPoint2d(e,t),s=(n=this.objects.get(i))==null?void 0:n.hyperbase;s&&((o=this.hyperTarget)==null||o.hyperCall(s))}setBrush(e){var t,r;return(t=this.brush)==null||t.unsubscribe(this),this.brush=this.brushes.get(e)||null,(r=this.brush)==null||r.subscribe(this),1}brushHandle(){var e;return((e=this.brush)==null?void 0:e.handle)||0}clear(){throw new Error("Method not implemented.")}toolChanged(){this.dirty=!0}render(e){var t;e.fillStyle=((t=this.brush)==null?void 0:t.fillStyle(e))||"white",e.fillRect(0,0,e.canvas.width,e.canvas.height),this.primaryObjects.forEach(r=>r.render(e,this._originX,this._originY,this.layers))}originX(){return this._originX}originY(){return this._originY}setOrigin(e,t){return this._originX=e,this._originY=t,this.dirty=!0,1}scale(){return this._scale}setScale(e){return this._scale=e,1}createLine(e,t,r){const i=J.getFreeHandle(this.objects),s=this.matrix,n=new Array(e.length);for(let l=0;l<e.length;l+=2){const c=e[l],u=e[l+1],d=c*s[2]+u*s[5]+s[8];n[l]=(c*s[0]+u*s[3]+s[6])/d,n[l+1]=(c*s[1]+u*s[4]+s[7])/d}const o=new rr(this,{handle:i,penHandle:t,brushHandle:r,coords:n});return this.objects.set(i,o),this.primaryObjects.push(o),i}createBitmap(e,t,r,i){const s=this.matrix,n=e*s[2]+t*s[5]+s[8],o=(e*s[0]+t*s[3]+s[6])/n,l=(e*s[1]+t*s[4]+s[7])/n,c=J.getFreeHandle(this.objects),u=new ki(this,{handle:c,originX:o,originY:l,type:i?"doubleBitmap":"bitmap",dibHandle:r});return this.objects.set(c,u),this.primaryObjects.push(u),c}createText(e,t,r,i){const s=this.matrix,n=e*s[2]+t*s[5]+s[8],o=(e*s[0]+t*s[3]+s[6])/n,l=(e*s[1]+t*s[4]+s[7])/n,c=J.getFreeHandle(this.objects),u=new Fi(this,{handle:c,originX:o,originY:l,angle:r,textToolHandle:i});return this.objects.set(c,u),this.primaryObjects.push(u),c}createControl(e,t,r,i,s,n,o){const l=s.toUpperCase();if(l!=="EDIT"&&l!=="BUTTON"&&l!=="COMBOBOX")return 0;const c=this.matrix,u=e*c[2]+t*c[5]+c[8],d=(e*c[0]+t*c[3]+c[6])/u,_=(e*c[1]+t*c[4]+c[7])/u,b=J.getFreeHandle(this.objects),g=new Li(this,this.html,{handle:b,originX:d,originY:_,width:r,height:i,className:s,text:n});return this.objects.set(b,g),this.primaryObjects.push(g),b}createGroup(e){const t=J.getFreeHandle(this.objects),r=new Mr(this,{handle:t}).addChildren(e);return this.objects.set(t,r),t}insertVectorDrawing(e,t,r,i){var D,j,H,C,W,Y,k,oe;if(!i.elements)return 0;const s=this.matrix,n=e*s[2]+t*s[5]+s[8],o=(e*s[0]+t*s[3]+s[6])/n,l=(e*s[1]+t*s[4]+s[7])/n,c=this.pens,u=this.dibs,d=this.brushes,_=this.doubleDibs,b=this.strings,g=this.fonts,T=this.texts,w=this.objects;this.pens=new Map((D=i.penTools)==null?void 0:D.map(A=>[A.handle,new Wi(A)])),this.dibs=new Map((j=i.dibTools)==null?void 0:j.map(A=>[A.handle,new we(A)])),this.brushes=new Map((H=i.brushTools)==null?void 0:H.map(A=>[A.handle,new Pi(this,A)])),this.doubleDibs=new Map((C=i.doubleDibTools)==null?void 0:C.map(A=>[A.handle,new we(A)])),this.strings=new Map((W=i.stringTools)==null?void 0:W.map(A=>[A.handle,new $i(A)])),this.fonts=new Map((Y=i.fontTools)==null?void 0:Y.map(A=>[A.handle,new ji(A)])),this.texts=new Map((k=i.textTools)==null?void 0:k.map(A=>[A.handle,new Vi(this,A)]));const E=new Set,I=A=>{switch(A.type){case"group":const $=new Mr(this,A);return E.add({g:$,h:A.childHandles}),[A.handle,$];case"line":return[A.handle,new rr(this,A)];case"text":return[A.handle,new Fi(this,A)];case"control":return[A.handle,new Li(this,this.html,A)];case"bitmap":case"doubleBitmap":return[A.handle,new ki(this,A)]}},R=i.elements.map(I);this.objects=new Map(R),E.forEach(A=>A.g.addChildren(A.h)),(oe=i.elementOrder)==null||oe.forEach(A=>{const $=this.objects.get(A);if(!$||$.type==="group")return;this.primaryObjects.push($)});const P=R.filter(A=>A[1].parentHandle()===0).map(A=>A[1].handle);if(P.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");let M;if(P.length>1){const A=J.getFreeHandle(this.objects),$=new Mr(this,{handle:A}).addChildren(P);this.objects.set(A,$),M=$}else M=this.objects.values().next().value;return M.setOrigin(o,l),this.pens.forEach(A=>{const $=J.getFreeHandle(c);A.handle=$,c.set($,A)}),this.dibs.forEach(A=>{const $=J.getFreeHandle(u);A.handle=$,u.set($,A)}),this.brushes.forEach(A=>{const $=J.getFreeHandle(d);A.handle=$,d.set($,A)}),this.doubleDibs.forEach(A=>{const $=J.getFreeHandle(_);A.handle=$,_.set($,A)}),this.strings.forEach(A=>{const $=J.getFreeHandle(b);A.handle=$,b.set($,A)}),this.fonts.forEach(A=>{const $=J.getFreeHandle(g);A.handle=$,g.set($,A)}),this.texts.forEach(A=>{const $=J.getFreeHandle(T);A.handle=$,T.set($,A)}),this.objects.forEach(A=>{const $=J.getFreeHandle(w);A.handle=$,w.set($,A)}),this.pens=c,this.dibs=u,this.brushes=d,this.doubleDibs=_,this.strings=b,this.fonts=g,this.texts=T,this.objects=w,M.handle}deleteObject(e){const t=this.objects.get(e);return t?(t.delete(),this.objects=new Map([...this.objects].filter(r=>!r[1].markDeleted)),this.primaryObjects=this.primaryObjects.filter(r=>!r.markDeleted),1):0}deleteGroup2d(e){const t=this.objects.get(e);return!t||t.type!=="group"?0:(t.ungroup(),this.objects.delete(e),1)}topObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[0].handle:0}bottomObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[this.primaryObjects.length-1].handle:0}objectFromZOrder(e){const t=e-1;return t<0||t>=this.primaryObjects.length?0:this.primaryObjects[t].handle}objectZOrder(e){for(let t=0;t<this.primaryObjects.length;++t)if(this.primaryObjects[t].handle===e)return t+1;return 0}lowerObjectHandle(e){const t=this.primaryObjects.findIndex(r=>r.handle===e);return t<1?0:this.primaryObjects[t-1].handle}upperObjectHandle(e){const t=this.primaryObjects.findIndex(r=>r.handle===e);return t<0||t>=this.primaryObjects.length-1?0:this.primaryObjects[t+1].handle}objectToTop(e){const t=this.primaryObjects.find(r=>r.handle===e);return t?(this.primaryObjects=[...this.primaryObjects.filter(r=>r!==t),t],this.dirty=!0,1):0}objectToBottom(e){const t=this.primaryObjects.find(r=>r.handle===e);return t?(this.primaryObjects=[t,...this.primaryObjects.filter(r=>r!==t)],this.dirty=!0,1):0}swapObjects(e,t){const r=this.primaryObjects.findIndex(n=>n.handle===e);if(r<0)return 0;const i=this.primaryObjects.findIndex(n=>n.handle===t);if(i<0)return 0;const s=this.primaryObjects[r];return this.primaryObjects[r]=this.primaryObjects[i],this.primaryObjects[i]=s,this.dirty=!0,1}setObjectZOrder(e,t){const r=t-1;if(r<0)return 0;const i=this.primaryObjects.find(n=>n.handle===e);if(!i)return 0;const s=[];for(let n=0;n<this.primaryObjects.length;++n){n===r&&s.push(i);const o=this.primaryObjects[n];o!==i&&s.push(o)}return r>=this.primaryObjects.length&&s.push(i),this.primaryObjects=s,this.dirty=!0,1}objectName(e){var t;return((t=this.objects.get(e))==null?void 0:t.name)||""}setObjectName(e,t){const r=this.objects.get(e);return r?(r.name=t,1):0}getObject2dByName(e,t){if(t==="")return 0;if(e){const r=this.objects.get(e);return r?r.getChildByName(t):0}for(const r of this.objects.values())if(r.name===t)return r.handle;return 0}getObjectInRealCoords(e,t){for(let r=this.primaryObjects.length-1;r>=0;--r){const i=this.primaryObjects[r].tryClick(e,t,this.layers);if(i)return i}return}getObjectFromPoint2d(e,t){var o,l;const r=this.matrix,i=e*r[2]+t*r[5]+r[8],s=(e*r[0]+t*r[3]+r[6])/i,n=(e*r[1]+t*r[4]+r[7])/i;return(l=(o=this.getObjectInRealCoords(s,n))==null?void 0:o.handle)!=null?l:0}isIntersect(e,t){const r=this.objects.get(e);if(!r)return 0;const i=this.objects.get(t);return i&&(r.maxX()>=i.minX()&&i.maxX()>=r.minX()&&r.maxY()>=i.minY()&&i.maxY()>=r.minY())?1:0}createPenTool(e,t,r,i){const s=J.getFreeHandle(this.pens);return this.pens.set(s,new Wi({handle:s,color:r,width:t,rop2:i,style:e})),s}createBrushTool(e,t,r,i,s){const n=J.getFreeHandle(this.brushes);return this.brushes.set(n,new Pi(this,{handle:n,color:r,hatch:t,dibHandle:i,style:e,rop2:s})),n}createDIBTool(e){const t=J.getFreeHandle(this.dibs);return this.dibs.set(t,new we({handle:t,type:"image",img:e})),t}createDoubleDIBTool(e){const t=J.getFreeHandle(this.doubleDibs);return this.doubleDibs.set(t,new we({handle:t,type:"image",img:e})),t}createStringTool(e){const t=J.getFreeHandle(this.strings);return this.strings.set(t,new $i({handle:t,text:e})),t}createFontTool(e,t,r){const i=J.getFreeHandle(this.fonts),s=r&1,n=r&2,o=r&4,l=r&8;return this.fonts.set(i,new ji({handle:i,fontName:e,height:-t,italic:s,underline:n,strikeOut:o,weight:l})),i}createTextTool(e,t,r,i){const s=J.getFreeHandle(this.texts);return this.texts.set(s,new Vi(this,{handle:s,textCollection:[{fgColor:r,bgColor:i,fontHandle:e,stringHandle:t}]})),s}setCapture(e){this.capture=e}releaseCapture(){this.capture=null}onMouse(e,t,r){switch(t){case O.WM_MOUSEMOVE:this.moveSubs.set(e,r);break;case O.WM_LBUTTONDOWN:this.leftButtonDownSubs.set(e,r);break;case O.WM_LBUTTONUP:this.leftButtonUpSubs.set(e,r);break;case O.WM_RBUTTONDOWN:this.rightButtonDownSubs.set(e,r);break;case O.WM_RBUTTONUP:this.rightButtonUpSubs.set(e,r);break;case O.WM_MBUTTONDOWN:this.middleButtonDownSubs.set(e,r);break;case O.WM_MBUTTONUP:this.middleButtonUpSubs.set(e,r);break;case O.WM_ALLMOUSEMESSAGE:this.moveSubs.set(e,r),this.leftButtonDownSubs.set(e,r),this.leftButtonUpSubs.set(e,r),this.rightButtonDownSubs.set(e,r),this.rightButtonUpSubs.set(e,r),this.middleButtonDownSubs.set(e,r),this.middleButtonUpSubs.set(e,r);break}}offMouse(e,t){switch(t){case O.WM_MOUSEMOVE:this.moveSubs.delete(e);break;case O.WM_LBUTTONDOWN:this.leftButtonDownSubs.delete(e);break;case O.WM_LBUTTONUP:this.leftButtonUpSubs.delete(e);break;case O.WM_RBUTTONDOWN:this.rightButtonDownSubs.delete(e);break;case O.WM_RBUTTONUP:this.rightButtonUpSubs.delete(e);break;case O.WM_MBUTTONDOWN:this.middleButtonDownSubs.delete(e);break;case O.WM_MBUTTONUP:this.middleButtonUpSubs.delete(e);break;case O.WM_ALLMOUSEMESSAGE:this.moveSubs.delete(e),this.leftButtonDownSubs.delete(e),this.leftButtonUpSubs.delete(e),this.rightButtonDownSubs.delete(e),this.rightButtonUpSubs.delete(e),this.middleButtonDownSubs.delete(e),this.middleButtonUpSubs.delete(e);break}}pointerEventHandler(e){var _,b;const t=e.target.getBoundingClientRect(),r=e.clientX-t.left+this.originX(),i=e.clientY-t.top+this.originY(),s=e.buttons&1?1:0,n=e.buttons&2?2:0,o=e.buttons&4?16:0,l=s|n|o;ye.keyState[1]=s,ye.keyState[2]=n,ye.keyState[4]=o;const c=this.getObjectInRealCoords(r,i),u=(_=c==null?void 0:c.handle)!=null?_:0,d=c==null?void 0:c.hyperbase;this.cursor=d?"pointer":"default";switch(e.type){case"pointerdown":{this.blocked=!0;switch(e.button){case 0:d&&((b=this.hyperTarget)==null||b.hyperCall(d)),this.dispatchMouseEvent(this.leftButtonDownSubs,u,O.WM_LBUTTONDOWN,r,i,l);return;case 1:this.dispatchMouseEvent(this.middleButtonDownSubs,u,O.WM_MBUTTONDOWN,r,i,l);return;case 2:this.dispatchMouseEvent(this.rightButtonDownSubs,u,O.WM_RBUTTONDOWN,r,i,l);return}return}case"pointerup":{switch(e.button){case 0:this.dispatchMouseEvent(this.leftButtonUpSubs,u,O.WM_LBUTTONUP,r,i,l);return;case 1:this.dispatchMouseEvent(this.middleButtonUpSubs,u,O.WM_MBUTTONUP,r,i,l);return;case 2:this.dispatchMouseEvent(this.rightButtonUpSubs,u,O.WM_RBUTTONUP,r,i,l);return}return}case"pointerleave":{this.dispatchMouseEvent(this.leftButtonUpSubs,u,O.WM_LBUTTONUP,r,i,0);return}case"pointermove":if(this.blocked){this.blocked=!1;return}this.dispatchMouseEvent(this.moveSubs,u,O.WM_MOUSEMOVE,r,i,l);return}}dispatchMouseEvent(e,t,r,i,s,n){const o=this.invMatrix,l=i*o[2]+s*o[5]+o[8],c=(i*o[0]+s*o[3]+o[6])/l,u=(i*o[1]+s*o[4]+o[7])/l;this.capture&&this.capture.receive(r,c,u,n);for(const[d,_]of e)(_===0||_===t)&&d.receive(r,c,u,n)}onControlNotify(e,t){this.controlNotifySubs.set(e,t)}offControlNotify(e){this.controlNotifySubs.delete(e)}dispatchControlNotifyEvent(e,t){let r=0;switch(t.type){case"input":r=768;break;default:return}for(const[i,s]of this.controlNotifySubs)(s===0||s===e)&&i.receive(O.WM_CONTROLNOTIFY,e,0,r)}}class Be{constructor(e,t){this.classname="";this.filename="";this._originX=0;this._originY=0;this.spaceDoneSubs=new Set;this.closeSubs=new Set;this.sizeSubs=new Set;var c,u;if(this.ignoreSetSize=(c=t.disableResize)!=null?c:!1,this.noCaption=!!t.noCaption,t.vdr){this.resizible=!((u=t.vdr.settings)==null?void 0:u.some(b=>b.id===11));const{name:d,origin:_}=t.vdr.source;_==="class"?this.classname=d:_==="file"&&(this.filename=d)}else this.resizible=!0;const r=this.view=document.createElement("div");r.style.setProperty("position","relative"),r.style.setProperty("overflow","hidden"),r.style.setProperty("width","100%"),r.style.setProperty("height","100%");const i=this.cnv=document.createElement("canvas");i.style.setProperty("top","0px"),i.style.setProperty("left","0px"),i.style.setProperty("position","absolute"),i.style.setProperty("touch-action","pinch-zoom"),r.appendChild(i),this.wnd=e.window({title:t.noCaption?void 0:t.title,view:r}),i.width=this.width(),i.height=this.height(),this._title=t.title;const s=i.getContext("2d",{alpha:!1});if(!s)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");s.fillStyle="white",s.fillRect(0,0,this.cnv.width,this.cnv.height),this.ctx=s;const n=this.scene=new Xi(this,t.vdr),o=d=>{n.pointerEventHandler(d),i.style.cursor=n.cursor};i.addEventListener("pointerdown",o),i.addEventListener("pointerup",o),i.addEventListener("pointerleave",o),i.addEventListener("pointermove",o),Be.wins.add(this),Be.updater.run(Be.redrawAll);const l=t.onClosed;this.wnd.on("closed",()=>{Be.wins.delete(this),this.spaceDoneSubs.forEach(d=>d.receive(O.WM_SPACEDONE)),l&&l()})}static redrawAll(){return Be.wins.forEach(e=>e.redraw()),Be.wins.size>0}textInput(e){return new xs(this.view,e)}redraw(){const e=this.view.clientWidth,t=this.view.clientHeight,r=e!==this.cnv.width||t!==this.cnv.height;if(r){this.cnv.width=e,this.cnv.height=t;for(const i of this.sizeSubs)i.receive(O.WM_SIZE,e,t)}(r||this.scene.dirty)&&(this.scene.render(this.ctx),this.scene.dirty=!1)}close(){Be.wins.delete(this),this.wnd.close(),this.spaceDoneSubs.forEach(e=>e.receive(O.WM_SPACEDONE))}getProp(e){const t=e.toUpperCase();return t==="CLASSNAME"?this.classname:t==="FILENAME"?this.filename:""}width(){const e=this.view.clientWidth;return e>0?e:300}height(){const e=this.view.clientHeight;return e>0?e:200}setSize(e,t){return this.ignoreSetSize===!0?1:(this.wnd.setSize(e,t),this.resizible===!0||(this.view.style.setProperty("width",e+"px"),this.view.style.setProperty("height",t+"px")),1)}toTop(){return this.wnd.toTop(),1}setAttrib(e){switch(e){case O.SW_HIDE:this.view.style.setProperty("visibility","hidden");break;case O.SW_SHOW:this.view.style.removeProperty("visibility");break}return 1}title(){return this._title}setTitle(e){return this._title=e,this.noCaption||this.wnd.setTitle(e),1}originX(){return this._originX}originY(){return this._originY}setOrigin(e,t){return this._originX=e,this._originY=t,1}setTransparent(e){return 1}setTransparentColor(e){return 1}onSpaceDone(e){this.spaceDoneSubs.add(e)}offSpaceDone(e){this.spaceDoneSubs.delete(e)}onDestroy(e){this.closeSubs.add(e)}offDestroy(e){this.closeSubs.delete(e)}onResize(e){this.sizeSubs.add(e)}offResize(e){this.sizeSubs.delete(e)}onControlNotifty(e,t){this.scene.onControlNotify(e,t)}offControlNotify(e){this.scene.offControlNotify(e)}onMouse(e,t,r){this.scene.onMouse(e,t,r)}offMouse(e,t){this.scene.offMouse(e,t)}}Be.updater=new Zr,Be.wins=new Set;const sr=new Map;function Gi(e,t){switch(e){case N.String:return t;case N.Float:return parseFloat(t)||0;case N.Handle:return(t.startsWith("#")?parseInt(t.substring(1,t.length)):parseInt(t))||0;case N.ColorRef:return yh(t)}}function vg(e,t){const r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${e.proto.name}: ${i}`);for(const{handle1:i,handle2:s,flags:n,connectedVars:o}of t){const l=i===0?e:e.child(i),c=s===0?e:e.child(s);if(l?l.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),c?c.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${s} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${s} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),!l||!l.proto.vars||!c||!c.proto.vars)continue;const u=l.proto.vars,d=c.proto.vars,_=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${l.proto.name} #${i}`,b=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${c.proto.name} #${s}`;for(const{name1:g,name2:T}of o){const w=u.nameUCToId.get(g.toUpperCase()),E=d.nameUCToId.get(T.toUpperCase());if(w===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${_}`),E===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${T} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${b}`),w===void 0||E===void 0)continue;if(!l.connectVar(w,c,E,n)){const I=N[l.proto.vars.types[w]],R=N[c.proto.vars.types[E]];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${g} (${I}) \u0432 ${_} \u0438 ${T} (${R}) \u0432 ${b}`)}}}}function As(e,t,r,i){const s=t.get(e);if(!s)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${e}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const n=new ke(s,r,t,i);if(s.children){const o=s.children.map(l=>As(l.classname,t,r,q({parent:n},l.schemeInfo)));n.setChildren(o)}return s.links&&vg(n,s.links),n}class Ds{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,t){if(e.type!==t.type)return!1;if(e.indexWasSet||t.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(t),t.connectedNodes.add(e),!0}shareIndex(e){if(this.indexWasSet)return;this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(t=>t.shareIndex(e))}getIndex(e){if(!this.indexWasSet)switch(this.type){case N.Float:this.shareIndex(e.floatsCount++);break;case N.Handle:case N.ColorRef:this.shareIndex(e.intsCount++);break;case N.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}}class ke{constructor(e,t,r,i){this.handle=0;this.name="";this.position={x:0,y:0};this.parent=this;this.varGraphNodes=[];this.isDisabled=ke.alwaysEnabled;this.disOrEnVarId=-1;this.children=[];this.classNodeCache=new Map;var s;this.model=(s=e.model(r))!=null?s:ke.NoModel,this.proto=e,this.prj=t,i&&(this.handle=i.handle,this.name=i.name,this.position=i.position,this.parent=i.parent);{const n=this.vars=e.vars;this.varGraphNodes=n.types.map(c=>new Ds(c)),this.TLB=new Uint16Array(n.count);const o=this.proto._enableVarId,l=this.proto._disableVarId;o>0&&(l<0||o<l)&&(this.isDisabled=ke.disabledByEnable,this.disOrEnVarId=o),l>0&&(o<0||l<o)&&(this.isDisabled=ke.disabledByDisable,this.disOrEnVarId=l)}{let n=this;for(;n.parent!==n;)n=n.parent;this.root=n,this.neighMapUC=new Map([["",this],["\\",n]]),i&&this.neighMapUC.set("..",i.parent)}}static build(e,t,r){return As(e,t,r)}stratum_getHObject(){return this.handle}stratum_getClassName(e){const t=this.resolve(e);return typeof t=="undefined"?"":t.proto.name}stratum_setVar(e,t,r){const i=this.resolve(e);if(typeof i=="undefined")return;const{vars:s}=i.proto;if(typeof s=="undefined")return;const n=s.nameUCToId.get(t.toUpperCase());typeof n!="undefined"&&i.setVarValue(n,s.types[n],r)}stratum_sendMessage(e,t,...r){const{prj:i,vars:s,TLB:n}=this;if(i.canExecute()===!1)return;let o;if(e!==""){const g=this.resolve(e);typeof g!="undefined"&&(o=[g])}if(t!==""){const g=t.toUpperCase();o=typeof o=="undefined"?this.findClasses(g):o.filter(T=>T.proto.name.toUpperCase()===g)}if(typeof o=="undefined"||o.length===0)return;const l=o[0],c=l.vars,u=new Array(r.length+r.length/2);let d=0;for(let g=0;g<r.length;g+=2){const T=r[g].toUpperCase(),w=s.nameUCToId.get(T);if(typeof w=="undefined")continue;const E=r[g+1].toUpperCase(),I=c.nameUCToId.get(E);if(typeof I=="undefined")continue;const R=s.types[w],P=c.types[I];if(R!==P)continue;u[d+0]=w,u[d+1]=I,u[d+2]=R,d+=3}const{news:_,olds:b}=i;for(const g of o){if(g===this)continue;for(let T=0;T<u.length;T+=3){const w=u[T+2];if(typeof w=="undefined")continue;const E=n[u[T+0]],I=g.TLB[u[T+1]],R=_[w],P=b[w],M=R[E];R[I]=M,P[I]=M}i.inc(),g.forceCompute(),i.syncLocal(g.TLB),i.dec();for(let T=0;T<u.length;T+=3){const w=u[T+2];if(typeof w=="undefined")continue;const E=n[u[T+0]],I=g.TLB[u[T+1]],R=_[w],P=b[w],M=R[I];R[E]=M,P[E]=M}}}stratum_setCapture(e,t,r){if(t!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 setCapture \u0441 path=${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const i=this;if(typeof i=="undefined"||i.proto.msgVarId<0)return;this.prj.env.setCapture(e,i)}stratum_registerObject(e,t,r,i,s){if(r!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 RegisterObject \u0441 path=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const n=this;if(typeof n=="undefined"||n.proto.msgVarId<0)return;this.prj.env.subscribe(n,e,t,i)}stratum_unregisterObject(e,t,r){if(t!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 UnRegisterObject \u0441 path=${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);const i=this;if(typeof i=="undefined"||i.proto.msgVarId<0)return;this.prj.env.unsubscribe(i,e,r)}receive(e,...t){const{proto:r}=this;if(r.msgVarId<0)return;this.setVarValue(r.msgVarId,N.Float,e);switch(e){case O.WM_CONTROLNOTIFY:this.setVarValue(r._hobjectVarId,N.Handle,t[0]),this.setVarValue(r.iditemVarId,N.Float,t[1]),this.setVarValue(r.wnotifycodeVarId,N.Float,t[2]);break;case O.WM_SIZE:this.setVarValue(r.nwidthVarId,N.Float,t[0]),this.setVarValue(r.nheightVarId,N.Float,t[1]);break;case O.WM_MOUSEMOVE:case O.WM_LBUTTONDOWN:case O.WM_LBUTTONUP:case O.WM_LBUTTONDBLCLK:case O.WM_RBUTTONDOWN:case O.WM_RBUTTONUP:case O.WM_RBUTTONDBLCLK:case O.WM_MBUTTONDOWN:case O.WM_MBUTTONUP:case O.WM_MBUTTONDBLCLK:this.setVarValue(r.xposVarId,N.Float,t[0]),this.setVarValue(r.yposVarId,N.Float,t[1]),this.setVarValue(r.fwkeysVarId,N.Float,t[2]);break}this.model(this),this.prj.syncAll()}setChildren(e){if(this.children.length>0)throw Error("\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return(this.children=e).forEach(t=>{t.name&&this.neighMapUC.set(t.name.toUpperCase(),t)}),this}child(e){return this.children.find(t=>t.handle===e)}connectVar(e,t,r,i){return i&1?!0:Ds.connect(this.varGraphNodes[e],t.varGraphNodes[r])}createTLB(){const e={floatsCount:1,intsCount:1,stringsCount:1};return function t({children:r,TLB:i,varGraphNodes:s}){r.forEach(t),i.set(s.map(n=>n.getIndex(e)))}(this),e}applyDefaults(){this.children.forEach(t=>t.applyDefaults());const{vars:e}=this.proto;if(!e)return this;for(let t=0;t<e.count;++t){const r=e.types[t],i=e.defaultValues[t];if(typeof i!="undefined"){this.setVarValue(t,r,i);continue}switch(t){case this.proto.orgxVarId:this.setVarValue(t,r,this.position.x);break;case this.proto.orgyVarId:this.setVarValue(t,r,this.position.y);break;case this.proto._hobjectVarId:this.setVarValue(t,r,this.handle);break;case this.proto._objnameVarId:this.setVarValue(t,r,this.name);break;case this.proto._classnameVarId:this.setVarValue(t,r,this.proto.name);break}}return this}applyVarSet(e){const{name:t,vars:r}=this.proto;if(r&&t.toUpperCase()===e.classname.toUpperCase())for(const i of e.values){const s=r.nameUCToId.get(i.name.toUpperCase());if(typeof s=="undefined")continue;const n=r.types[s];this.setVarValue(s,n,Gi(n,i.value))}return e.childSets.forEach(i=>{var s;return(s=this.child(i.handle))==null?void 0:s.applyVarSet(i)}),this}forceCompute(){for(const e of this.children)e.compute();this.model(this)}compute(){if(this.isDisabled(this)===!0)return;for(const e of this.children)e.compute();this.model(this)}resolve(e){if(e==="")return this;const t=e.split("\\");let r=e[0]==="\\"?this.root:this;for(let i=0;i<t.length;++i){const s=r.neighMapUC.get(t[i]);if(typeof s=="undefined")return;r=s}return r}setVarValue(e,t,r){if(e<0)return;const i=this.TLB[e];this.prj.olds[t][i]=r,this.prj.news[t][i]=r}findClasses(e){const{root:t}=this,r=t.classNodeCache.get(e);if(typeof r!="undefined")return r;const i=new Array;return function s(n){n.children.forEach(s),n.proto.name.toUpperCase()===e&&i.push(n)}(t),t.classNodeCache.set(e,i),i}stubCall(e,...t){let r=this,i="";for(;r.parent!==r;)i=` -> ${r.proto.name} #${r.handle}${i}`,r=r.parent;throw i=r.proto.name+i,Error(`\u0412\u044B\u0437\u043E\u0432 \u043D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e}(${t.map(s=>typeof s).join(",")})
\u0432 ${i}`)}static alwaysEnabled(){return!1}static disabledByEnable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]<=0}static disabledByDisable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]>0}static NoModel(){}}class or{constructor(e,t){this.level=0,this.shouldClose=!1,this.env=e,this.dir=t.dir,sr.clear();const r=this.schema=ke.build(t.prjInfo.rootClassName,t.classes,this);sr.size>0&&console.log(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438:
${[...sr.values()].join(`
`)}`);const i=r.createTLB();this.oldFloats=new Float64Array(i.floatsCount),this.newFloats=new Float64Array(i.floatsCount),this.oldInts=new Int32Array(i.intsCount),this.newInts=new Int32Array(i.intsCount),this.oldStrings=new Array(i.stringsCount).fill(""),this.newStrings=new Array(i.stringsCount).fill(""),this.olds=[],this.olds[N.Float]=this.oldFloats,this.olds[N.Handle]=this.oldInts,this.olds[N.ColorRef]=this.oldInts,this.olds[N.String]=this.oldStrings,this.news=[],this.news[N.Float]=this.newFloats,this.news[N.Handle]=this.newInts,this.news[N.ColorRef]=this.newInts,this.news[N.String]=this.newStrings,r.applyDefaults(),t.stt&&r.applyVarSet(t.stt)}stratum_closeAll(){this.shouldClose=!0}hyperCall(e){return this.env.hyperCall(this.dir,e)}stratum_openSchemeWindow(e,t,r){return this.env.openSchemeWindow(this,e,t,r)}stratum_loadSpaceWindow(e,t,r){return this.env.loadSpaceWindow(this,e,t,r)}stratum_createWindowEx(e,t,r,i,s,n,o,l){return this.env.createWindowEx(this,e,t,r,i,s,n,o,l)}stratum_createDIB2d(e,t){return this.env.createDIB2d(this.dir,e,t)}stratum_createDoubleDib2D(e,t){return this.env.createDoubleDib2D(this.dir,e,t)}stratum_createObjectFromFile2D(e,t,r,i,s){return this.env.createObjectFromFile2D(this.dir,e,t,r,i,s)}stratum_createStream(e,t,r){return this.env.createStream(this.dir,e,t,r)}stratum_mSaveAs(e,t,r){return this.env.mSaveAs(this.dir,e,t,r)}stratum_mLoad(e,t,r){return this.env.mLoad(this.dir,e,t,r)}stratum_createDir(e){return this.dir.create("dir",e)?1:0}stratum_fileExist(e){const t=this.dir.get(e);return typeof t!="undefined"?1:0}stratum_getProjectDirectory(){return this.dir.pathDos}stop(){this.shouldClose=!0}canExecute(){return this.level<59}inc(){++this.level}dec(){--this.level}syncLocal(e){const{newFloats:t,oldFloats:r,newInts:i,oldInts:s,newStrings:n,oldStrings:o}=this;for(const l of e)r[l]=t[l],s[l]=i[l],o[l]=n[l]}syncAll(){this.oldFloats.set(this.newFloats),this.oldInts.set(this.newInts);for(let e=0;e<this.newStrings.length;++e)this.oldStrings[e]=this.newStrings[e];return this}assertZeroIndexEmpty(){if(this.oldFloats[0]!==0||"undefined"in this.oldFloats||this.newFloats[0]!==0||"undefined"in this.newFloats||this.oldInts[0]!==0||"undefined"in this.oldInts||this.newInts[0]!==0||"undefined"in this.newInts||this.oldStrings[0]!==""||"undefined"in this.oldStrings||this.newStrings[0]!==""||"undefined"in this.newStrings)throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}compute(){return this.schema.compute(),this.syncAll().assertZeroIndexEmpty(),!this.shouldClose}}class Le{static widthToSize(e){return e<0||e>9?0:Le.widthTable[e]}constructor(e={}){var t,r,i;this.v=new DataView((r=(t=e.data)==null?void 0:t.slice(0))!=null?r:new ArrayBuffer(0)),this.p=0,this.width=8,this.onflush=(i=e.onFlush)!=null?i:null}seek(e){return this.p=e}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(e){return this.width=e,1}widthNumber(){const e=Le.widthToSize(this.width);if(e===0)return 0;const t=this.p,r=t+e;if(r>this.size())return 0;this.p=r;switch(this.width){case 0:return this.v.getUint8(t);case 1:return this.v.getInt8(t);case 2:return this.v.getUint16(t,!0);case 3:return this.v.getInt16(t,!0);case 4:return this.v.getUint32(t,!0);case 5:return this.v.getInt32(t,!0);case 6:return this.v.getFloat32(t,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(t,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(e){const t=new Uint8Array(new ArrayBuffer(e));t.set(new Uint8Array(this.v.buffer)),this.v=new DataView(t.buffer)}writeWidthNumber(e){const t=Le.widthToSize(this.width);if(t===0)return 0;const r=this.p,i=r+t;i>this.size()&&this.resize(i),this.p=i;switch(this.width){case 0:return this.v.setUint8(r,e),1;case 1:return this.v.setInt8(r,e),1;case 2:return this.v.setUint16(r,e,!0),2;case 3:return this.v.setInt16(r,e,!0),2;case 4:return this.v.setUint32(r,e,!0),4;case 5:return this.v.setInt32(r,e,!0),4;case 6:return this.v.setFloat32(r,e,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(r,e,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}line(){const e=this.p,t=this.size()-e;if(t<=0)return"";let r=0,i=0;for(;r<t;){const n=this.v.getUint8(e+r);if(n===0){i=1;break}if(n===Le.slashR&&r+1<t&&this.v.getInt8(e+r+1)===Le.slashN){i=2;break}r+=1}const s=Ci(new Uint8Array(this.v.buffer,e,r));return this.p=e+r+i,s}writeLine(e){const t=e+`\r
`;let r=this.p;const i=r+t.length;i>this.size()&&this.resize(i),this.p=i;for(const s of vh(t))this.v.setUint8(r,s),r+=1;return t.length}close(){return this.onflush&&this.onflush(this.v.buffer),1}}Le.slashR="\r".charCodeAt(0),Le.slashN=`
`.charCodeAt(0),Le.widthTable=[1,1,2,2,4,4,4,5,8,10];class Ns{constructor(e){this.minX=e.minX,this.minY=e.minY,this.rows=e.rows,this.cols=e.cols,this.data=e.data?new Float64Array(e.data):new Float64Array(this.rows*this.cols)}get(e,t){const r=e-this.minX,i=t-this.minY;return r<0||i<0||r>=this.rows||i>=this.cols?0:this.data[r*this.cols+i]}set(e,t,r){const i=e-this.minX,s=t-this.minY;return i<0||s<0||i>=this.rows||s>=this.cols?0:(this.data[i*this.cols+s]=r,r)}fill(e){return this.data.fill(e),1}}class ye{constructor(e,t,r={}){this.windows=new Map;this.scenes=new Map;this.hspaceToWname=new Map;this.wnameToHspace=new Map;this.targetScene=null;this.matrices=new Map;this.streams=new Map;this._shouldQuit=!1;this.lockSpace2dS=!1;this._unsub=new Set;this._unsubS=0;this.projects=[new or(this,e)],this.lib=e.classes,this.host=t,this.inHyperCall=!1,this.options=r}compute(){const e=this.projects[this.projects.length-1].compute();if(this._shouldQuit)return this.closeAllRes(),!1;if(e===!0)return!0;if(this.projects.length>1){const t=this.sessionId();return this.closeProjectRes(t),this.projects.pop(),!0}return this.closeAllRes(),!1}sessionId(){return this.projects.length-1}callFunction(e,t,...r){var I;const i=this.lib.get(e),s=i==null?void 0:i.funcModel(this.lib);if(!s)return;const n=i==null?void 0:i.vars;let o=0;const l=[];let c=0;const u=[];let d=0;const _=[],b=new Uint16Array((I=n==null?void 0:n.count)!=null?I:0);if(n&&r.length>0){if(r.length>n.count)throw Error("\u041A\u043E\u043B-\u0432\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0431\u043E\u043B\u044C\u0448\u0435 \u043A\u043E\u043B-\u0432\u0430 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");let R=0;for(;R<n.count;++R){const P=(R<r.length?r:n.defaultValues)[R],M=n.types[R];switch(M){case N.Float:if(typeof P=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");b[R]=o,o+=1,l.push(P!=null?P:0);break;case N.Handle:case N.ColorRef:if(typeof P=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");b[R]=c,c+=1,u.push(P!=null?P:0);break;case N.String:if(typeof P=="number")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");b[R]=d,d+=1,_.push(P!=null?P:"");break}}}const g=new Float64Array(l),T=new Int32Array(u);if(s(t,b,g,T,_),!n)return;const w=n.flags.findIndex(R=>R&O.VF_RETURN);if(w<0)return;const E=n.types[w];return E===N.String?_[b[w]]:E===N.Float?g[b[w]]:T[b[w]]}stratum_setHyperJump2d(e,t,r,...i){if(r!==2)return 0;const s=this.scenes.get(e);return typeof s=="undefined"?0:s.setHyper(t,{openMode:r,target:i[0],objectName:i[1],effect:i[2],windowName:i[3],params:i[4]})}stratum_stdHyperJump(e,t,r,i,s){var n;(n=this.scenes.get(e))==null||n.tryHyper(t,r,i)}hyperCall(e,t){return me(this,null,function*(){var i;if(this.inHyperCall)return;this.inHyperCall=!0;const r=(i=t.openMode)!=null?i:0;switch(r){case 2:{if(!t.target)return;const s=e.get(t.target);if(!s||s.dir)return;const n=document.body.style.cursor;document.body.style.cursor="wait";try{const o=yield ve.project(s,this.lib,this.sessionId()+1);if(this.inHyperCall=!1,this._shouldQuit)return;this.projects.push(new or(this,o))}catch(o){console.error(o),this._shouldQuit=!0}finally{document.body.style.cursor=n}break}default:console.log(t)}this.inHyperCall=!1})}stratum_chr(e){return e<0||e>255?"":Mi[e]}getTime(e,t,r,i,s,n,o,l){const c=new Date;e[t]=c.getHours(),r[i]=c.getMinutes(),s[n]=c.getSeconds(),o[l]=c.getMilliseconds()*.1}getDate(e,t,r,i,s,n){const o=new Date;e[t]=o.getFullYear(),r[i]=o.getMonth(),s[n]=o.getDate()}stratum_getTickCount(){return new Date().getTime()-ye.startupTime}stratum_new(){throw Error("\u0424\u0443\u043D\u043A\u0446\u0438\u044F New \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}stratum_logMessage(e){}stratum_MCISendString(){return 263}stratum_MCISendStringStr(){return""}stratum_system(e,...t){return 0}stratum_getAsyncKeyState(e){return ye.keyState[e]>0?1:0}stratum_quit(e){if(e<=0)return;this._shouldQuit=!0}openSchemeWindow(e,t,r,i){const s=this.wnameToHspace.get(t);if(typeof s!="undefined")return s;const n=this.lib.getComposedScheme(r);return this.openWindow(e,t,i,n)}loadSpaceWindow(e,t,r,i){const s=this.wnameToHspace.get(t);if(typeof s!="undefined")return s;const n=e.dir.get(r),o=n&&!n.dir?n.readSyncAs("vdr"):void 0;return this.openWindow(e,t,i,o)}createWindowEx(e,t,r,i,s,n,o,l,c){const u=this.wnameToHspace.get(t);if(typeof u!="undefined")return u;let d=this.lib.getComposedScheme(i);if(!d){const b=e.dir.get(i);d=b&&!b.dir?b.readSyncAs("vdr"):void 0}const _=this.windows.get(r);return _?this.openWindow(e,t,c,d):this.openWindow(e,t,c,d)}stratum_getClientHeight(e){const t=this.windows.get(e);return typeof t!="undefined"?t.height():0}stratum_getClientWidth(e){const t=this.windows.get(e);return typeof t!="undefined"?t.width():0}stratum_getWindowName(e){const t=this.hspaceToWname.get(e);return typeof t!="undefined"?t:""}stratum_getWindowOrgX(e){const t=this.windows.get(e);return typeof t!="undefined"?t.originX():0}stratum_getWindowOrgY(e){const t=this.windows.get(e);return typeof t!="undefined"?t.originY():0}stratum_getWindowSpace(e){const t=this.wnameToHspace.get(e);return typeof t!="undefined"?t:0}stratum_getWindowWidth(e){const t=this.windows.get(e);return typeof t!="undefined"?t.width():0}stratum_getWindowHeight(e){const t=this.windows.get(e);return typeof t!="undefined"?t.height():0}stratum_getWindowTitle(e){const t=this.windows.get(e);return typeof t!="undefined"?t.title():""}stratum_setClientSize(e,t,r){const i=this.windows.get(e);return typeof i!="undefined"?i.setSize(t,r):0}stratum_setWindowOrg(e,t,r){const i=this.windows.get(e);return typeof i!="undefined"?i.setOrigin(t,r):0}stratum_setWindowTitle(e,t){const r=this.windows.get(e);return typeof r!="undefined"?r.setTitle(t):0}stratum_getWindowProp(e,t){const r=this.windows.get(e);return typeof r!="undefined"?r.getProp(t):""}stratum_isWindowExist(e){const t=this.windows.get(e);return typeof t!="undefined"?1:0}stratum_bringWindowToTop(e){const t=this.windows.get(e);return typeof t!="undefined"?t.toTop():0}stratum_showWindow(e,t){const r=this.windows.get(e);return typeof r!="undefined"?r.setAttrib(t):0}stratum_closeWindow(e){const t=this.windows.get(e);return typeof t=="undefined"?0:(t.close(),this.removeWindow(e),1)}stratum_setWindowTransparent(e,t){var i,s;const r=typeof e=="string"?e:this.hspaceToWname.get(e);return r&&(s=(i=this.windows.get(r))==null?void 0:i.setTransparent(t))!=null?s:0}stratum_setWindowTransparentColor(e,t){var i,s;const r=typeof e=="string"?e:this.hspaceToWname.get(e);return r&&(s=(i=this.windows.get(r))==null?void 0:i.setTransparentColor(t))!=null?s:0}stratum_setWindowOwner(e,t){return 1}stratum_getSpaceOrg2dx(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.originX():0}stratum_getSpaceOrg2dy(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.originY():0}stratum_setSpaceOrg2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.setOrigin(t,r):0}stratum_getScaleSpace2d(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.scale():0}stratum_setScaleSpace2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.setScale(t):0}stratum_getBkBrush2d(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.brushHandle():0}stratum_setBkBrush2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.setBrush(t):0}stratum_lockSpace2d(e,t){return this.lockSpace2dS||(console.warn("LockSpace2d \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F"),this.lockSpace2dS=!0),0}stratum_createPen2d(e,t,r,i,s){const n=this.scenes.get(e);return typeof n!="undefined"?n.createPenTool(t,r,i,s):0}stratum_getPenColor2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.color():0}stratum_getPenRop2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.rop():0}stratum_getPenStyle2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.style():0}stratum_getPenWidth2d(e,t){const r=this.getTPen(e,t);return typeof r!="undefined"?r.width():0}stratum_setPenColor2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setColor(r):0}stratum_setPenRop2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setRop(r):0}stratum_setPenStyle2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setStyle(r):0}stratum_setPenWidth2d(e,t,r){const i=this.getTPen(e,t);return typeof i!="undefined"?i.setWidth(r):0}stratum_createBrush2d(e,t,r,i,s,n){const o=this.scenes.get(e);return typeof o!="undefined"?o.createBrushTool(t,r,i,s,n):0}stratum_getBrushColor2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.color():0}stratum_getBrushRop2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.rop():0}stratum_getBrushStyle2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.style():0}stratum_getBrushHatch2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.hatch():0}stratum_getBrushDib2d(e,t){const r=this.getTBrush(e,t);return typeof r!="undefined"?r.dibHandle():0}stratum_setBrushColor2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setColor(r):0}stratum_setBrushRop2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setRop(r):0}stratum_setBrushStyle2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setStyle(r):0}stratum_setBrushHatch2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setHatch(r):0}stratum_setBrushDib2d(e,t,r){const i=this.getTBrush(e,t);return typeof i!="undefined"?i.setDIB(r):0}stratum_createFont2D(e,t,r,i){const s=this.scenes.get(e);return typeof s!="undefined"?s.createFontTool(t,r,i):0}stratum_getFontName2d(e,t){const r=this.getTFont(e,t);return typeof r!="undefined"?r.name():""}stratum_getFontSize2d(e,t){const r=this.getTFont(e,t);return typeof r!="undefined"?r.size():0}stratum_getFontStyle2d(e,t){const r=this.getTFont(e,t);return typeof r!="undefined"?r.style():0}stratum_setFontName2d(e,t,r){const i=this.getTFont(e,t);return typeof i!="undefined"?i.setName(r):0}stratum_setFontSize2d(e,t,r){const i=this.getTFont(e,t);return typeof i!="undefined"?i.setSize(r):0}stratum_setFontStyle2d(e,t,r){const i=this.getTFont(e,t);return typeof i!="undefined"?i.setStyle(r):0}stratum_createString2D(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.createStringTool(t):0}stratum_getstring2d(e,t){const r=this.getTString(e,t);return typeof r!="undefined"?r.text():""}stratum_setString2d(e,t,r){const i=this.getTString(e,t);return typeof i!="undefined"?i.setText(r):0}stratum_createText2D(e,t,r,i,s){const n=this.scenes.get(e);return typeof n!="undefined"?n.createTextTool(t,r,i,s):0}stratum_createRasterText2D(e,t,r,i,s){const n=this.scenes.get(e);return typeof n!="undefined"?n.createText(r,i,s,t):0}stratum_getTextObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.textToolHandle():0}stratum_getTextCount2d(e,t){const r=this.getTText(e,t);return typeof r!="undefined"?r.textCount():0}stratum_getTextFont2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.fontHandle(r):0}stratum_getTextString2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.stringHandle(r):0}stratum_getTextFgColor2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.fgColor(r):0}stratum_getTextBkColor2d(e,t,r=0){const i=this.getTText(e,t);return typeof i!="undefined"?i.bgColor(r):0}stratum_setText2D(e,t,r,i,s,n,o){const l=this.getTText(e,t);if(typeof l=="undefined")return 0;const c=typeof o!="undefined"?r:0,u=typeof o!="undefined"?i:r,d=typeof o!="undefined"?s:i,_=typeof o!="undefined"?n:s,b=typeof o!="undefined"?o:n;return l.setValues(c,u,d,_,b)}createDIB2d(e,t,r){const i=this.scenes.get(t);if(typeof i=="undefined")return 0;const s=e.get(r),n=s&&!s.dir&&s.readSyncAs("bmp");return n?i.createDIBTool(n):0}stratum_getDibPixel2D(e,t,r,i){const s=this.getTDIB(e,t);return typeof s!="undefined"?s.getPixel(r,i):0}stratum_setDibPixel2D(e,t,r,i,s){const n=this.getTDIB(e,t);return typeof n!="undefined"?n.setPixel(r,i,s):0}createDoubleDib2D(e,t,r){const i=this.scenes.get(t);if(typeof i=="undefined")return 0;const s=e.get(r),n=s&&!s.dir&&s.readSyncAs("dbm");return n?i.createDoubleDIBTool(n):0}stratum_createBitmap2d(e,t,r,i){const s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(r,i,t,!1):0}stratum_createDoubleBitmap2D(e,t,r,i){const s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(r,i,t,!0):0}stratum_setBitmapSrcRect2d(e,t,r,i,s,n){const o=this.getObject(e,t);return typeof o!="undefined"?o.setBitmapRect(r,i,s,n):0}stratum_getDibObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.dibHandle():0}stratum_getDDibObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.doubleDIBHandle():0}stratum_rgbEx(e,t,r,i){return Pr(e,t,r,i)}stratum_rgb(e,t,r){return Pr(e,t,r,0)}stratum_getRValue(e){return Ni(e)}stratum_getGValue(e){return Ri(e)}stratum_getBValue(e){return Bi(e)}createObjectFromFile2D(e,t,r,i,s,n){const o=this.scenes.get(t);if(typeof o=="undefined")return 0;const l=e.get(r),c=l&&!l.dir&&l.readSyncAs("vdr");return c?o.insertVectorDrawing(i,s,n,c):0}stratum_deleteObject2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.deleteObject(t):0}stratum_getObjectName2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objectName(t):""}stratum_setObjectName2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.setObjectName(t,r):0}stratum_getObject2dByName(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.getObject2dByName(t,r):0}stratum_setObjectOrg2d(e,t,r,i){const s=this.getObject(e,t);return typeof s!="undefined"?s.setOrigin(r,i):0}stratum_getObjectOrg2dx(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.originX():0}stratum_getObjectOrg2dy(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.originY():0}stratum_setObjectSize2d(e,t,r,i){const s=this.getObject(e,t);return typeof s!="undefined"?s.setSize(r,i):0}stratum_getObjectWidth2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.width():0}stratum_getObjectHeight2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.height():0}stratum_getActualHeight2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.actualHeight():0}stratum_getActualWidth2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.actualWidth():0}getActualSize2d(e,t,r,i,s,n){const o=this.getObject(e,t);return typeof o=="undefined"?0:(r[i]=o.actualWidth(),s[n]=o.actualHeight(),1)}stratum_getObjectAngle2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.angle():0}stratum_rotateObject2d(e,t,r,i,s){const n=this.getObject(e,t);return typeof n!="undefined"?n.rotate(r,i,s):0}stratum_setShowObject2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.setVisibility(r!==0):0}stratum_showObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.setVisibility(!0):0}stratum_hideObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.setVisibility(!1):0}stratum_getObjectFromPoint2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.getObjectFromPoint2d(t,r):0}stratum_getBottomObject2d(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.bottomObjectHandle():0}stratum_getUpperObject2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.upperObjectHandle(t):0}stratum_getObjectFromZOrder2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objectFromZOrder(t):0}stratum_getLowerObject2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.lowerObjectHandle(t):0}stratum_getTopObject2d(e){const t=this.scenes.get(e);return typeof t!="undefined"?t.topObjectHandle():0}stratum_getZOrder2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objectZOrder(t):0}stratum_objectToBottom2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objectToBottom(t):0}stratum_objectToTop2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objectToTop(t):0}stratum_setZOrder2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.setObjectZOrder(t,r):0}stratum_swapObject2d(e,t,r){const i=this.scenes.get(e);return typeof i!="undefined"?i.swapObjects(t,r):0}stratum_createPolyLine2d(e,t,r,...i){const s=this.scenes.get(e);return typeof s!="undefined"?s.createLine(i,t,r):0}stratum_createLine2d(e,t,r,i,s){const n=this.scenes.get(e);return typeof n!="undefined"?n.createLine([i,s],t,r):0}stratum_addPoint2d(e,t,r,i,s){const n=this.getObject(e,t);return typeof n!="undefined"?n.addPoint(r,i,s):0}stratum_delpoint2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.deletePoint(r):0}stratum_getPenObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.penHandle():0}stratum_getBrushObject2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.brushHandle():0}stratum_getVectorNumPoints2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.pointCount():0}stratum_getVectorPoint2dx(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.pointOriginX(r):0}stratum_getVectorPoint2dy(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.pointOriginY(r):0}stratum_setVectorPoint2d(e,t,r,i,s){const n=this.getObject(e,t);return typeof n!="undefined"?n.setPointOrigin(r,i,s):0}stratum_createGroup2d(e,...t){const r=this.scenes.get(e);return typeof r!="undefined"?r.createGroup(t):0}stratum_deleteGroup2d(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.deleteGroup2d(t):0}stratum_addGroupItem2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.addItem(r):0}stratum_delGroupItem2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.deleteItem(r):0}stratum_getGroupItem2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.itemHandle(r):0}stratum_getObjectParent2d(e,t){const r=this.getObject(e,t);return typeof r!="undefined"?r.parentHandle():0}stratum_isObjectsIntersect2d(e,t,r,i){const s=this.scenes.get(e);return typeof s!="undefined"?s.isIntersect(t,r):0}stratum_getControlText2d(e,t,r,i){const s=this.getObject(e,t);return typeof s=="undefined"?"":typeof r=="undefined"||typeof i=="undefined"?s.controlText():s.controlText().slice(r,r+i)}stratum_setControlText2d(e,t,r){const i=this.getObject(e,t);return typeof i!="undefined"?i.setControlText(r):0}stratum_getClassDirectory(e){const t=this.lib.get(e);return typeof t!="undefined"?t.directoryDos:""}stratum_closeClassScheme(e){return 1}stratum_getScreenWidth(){return screen.width}stratum_getScreenHeight(){return screen.height}stratum_getWorkAreaX(){return 0}stratum_getWorkAreaY(){return 0}stratum_getWorkAreaWidth(){return this.host.width}stratum_getWorkAreaHeight(){return this.host.height}subscribe(e,t,r,i){const s=typeof t=="string"?t:this.hspaceToWname.get(t);if(!s)return;const n=this.windows.get(s);if(typeof n=="undefined")return;switch(i){case O.WM_CONTROLNOTIFY:n.onControlNotifty(e,r);break;case O.WM_MOVE:break;case O.WM_SIZE:n.onResize(e);break;case O.WM_SPACEDONE:n.onSpaceDone(e);break;case O.WM_MOUSEMOVE:case O.WM_LBUTTONDOWN:case O.WM_LBUTTONUP:case O.WM_LBUTTONDBLCLK:case O.WM_RBUTTONDOWN:case O.WM_RBUTTONUP:case O.WM_RBUTTONDBLCLK:case O.WM_MBUTTONDOWN:case O.WM_MBUTTONUP:case O.WM_MBUTTONDBLCLK:case O.WM_ALLMOUSEMESSAGE:{n.onMouse(e,i,r);break}default:this._unsub.add(O[i]),this._unsub.size>this._unsubS&&(this._unsubS=this._unsub.size,console.warn(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${O[i]} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`));break}}unsubscribe(e,t,r){const i=typeof t=="string"?t:this.hspaceToWname.get(t);if(!i)return;const s=this.windows.get(i);if(typeof s=="undefined")return;switch(r){case O.WM_CONTROLNOTIFY:s.offControlNotify(e);break;case O.WM_SIZE:s.offResize(e);break;case O.WM_SPACEDONE:s.offSpaceDone(e);break;case O.WM_MOUSEMOVE:case O.WM_LBUTTONDOWN:case O.WM_LBUTTONUP:case O.WM_LBUTTONDBLCLK:case O.WM_RBUTTONDOWN:case O.WM_RBUTTONUP:case O.WM_RBUTTONDBLCLK:case O.WM_MBUTTONDOWN:case O.WM_MBUTTONUP:case O.WM_MBUTTONDBLCLK:case O.WM_ALLMOUSEMESSAGE:{s.offMouse(e,r);break}}}setCapture(e,t){const r=this.scenes.get(e);typeof r!="undefined"&&(this.targetScene=r).setCapture(t)}stratum_releaseCapture(){if(this.targetScene===null)return;this.targetScene.releaseCapture(),this.targetScene=null}openWindow(e,t,r,i){const s=r.toUpperCase(),n=s.includes("WS_NOCAPTION"),o=new Be(this.host,{title:t,vdr:i,noCaption:n,disableResize:this.options.disableWindowResize,onClosed:()=>this.removeWindow(t)});o.id=this.sessionId(),this.windows.set(t,o);const l=J.getFreeHandle(this.scenes);return this.wnameToHspace.set(t,l),this.hspaceToWname.set(l,t),this.scenes.set(l,o.scene),o.scene.hyperTarget=e,l}removeWindow(e){var i;this.windows.delete(e);const t=this.wnameToHspace.get(e);if(typeof t=="undefined")return;this.wnameToHspace.delete(e),this.hspaceToWname.delete(t);const r=this.scenes.get(t);this.scenes.delete(t),r===this.targetScene&&((i=this.targetScene)==null||i.releaseCapture(),this.targetScene=null)}closeProjectRes(e){const t=[...this.windows].filter(r=>r[1].id===e);t.forEach(r=>{r[1].close(),this.removeWindow(r[0])}),this.lib.remove(e)}closeAllRes(){var e;this._shouldQuit=!0,this.windows.forEach(t=>{t.close()}),this.hspaceToWname.clear(),this.wnameToHspace.clear(),this.scenes.clear(),this.windows.clear(),(e=this.targetScene)==null||e.releaseCapture(),this.targetScene=null,this.streams.forEach(t=>t.close());for(let t=1;t<this.projects.length;++t)this.lib.remove(t)}getObject(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.objects.get(t):void 0}getTPen(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.pens.get(t):void 0}getTBrush(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.brushes.get(t):void 0}getTDIB(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.dibs.get(t):void 0}getTText(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.texts.get(t):void 0}getTString(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.strings.get(t):void 0}getTFont(e,t){const r=this.scenes.get(e);return typeof r!="undefined"?r.fonts.get(t):void 0}stratum_mCreate(e,t,r,i,s,n){if(n<=0)return 0;const o=r-t+1,l=s-i+1;if(o<=0||l<=0)return 0;const c=e===0?J.getFreeNegativeHandle(this.matrices):e;return this.matrices.set(c,new Ns({rows:o,cols:l,minX:t,minY:i})),c}stratum_mDelete(e,t){return t<=0?0:this.matrices.delete(e)?1:0}stratum_mFill(e,t,r){var i,s;return r<=0?0:(s=(i=this.matrices.get(e))==null?void 0:i.fill(t))!=null?s:0}stratum_mGet(e,t,r,i){var s,n;return i<=0?0:(n=(s=this.matrices.get(e))==null?void 0:s.get(t,r))!=null?n:0}stratum_mPut(e,t,r,i,s){var n,o;return s<=0?0:(o=(n=this.matrices.get(e))==null?void 0:n.set(t,r,i))!=null?o:0}stratum_mEditor(e,t){if(t<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}mSaveAs(e,t,r,i){if(i<=0)return 0;throw Error("\u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}mLoad(e,t,r,i){if(i<=0)return 0;const s=e.get(r);if(!s||s.dir)return 0;const n=s.readSyncAs("mat");if(!n)return 0;const o=t===0?J.getFreeNegativeHandle(this.matrices):t;return this.matrices.set(o,new Ns(n)),o}createStream(e,t,r,i){const s=t.toUpperCase(),n=i.toUpperCase().includes("CREATE"),o=J.getFreeHandle(this.streams);let l;if(s==="FILE"){const c=n?e.create("file",r):e.get(r);if(!c||c.dir)return 0;l=new Le({data:n?void 0:c.bufferSync(),onFlush:u=>c.write(u)})}else if(s==="MEMORY")l=new Le;else throw Error(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${s} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`);return this.streams.set(o,l),o}stratum_closeStream(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.close())!=null?r:0}stratum_seek(e,t){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.seek(t))!=null?i:0}stratum_eof(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.eof())!=null?r:0}stratum_getPos(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.pos())!=null?r:0}stratum_getSize(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.size())!=null?r:0}stratum_setWidth(e,t){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.setWidth(t))!=null?i:0}stratum_read(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.widthNumber())!=null?r:0}stratum_readLn(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.line())!=null?r:""}stratum_write(e,t){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.writeWidthNumber(t))!=null?i:0}stratum_writeLn(e,t){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.writeLine(t))!=null?i:0}}ye.startupTime=new Date().getTime(),ye.keyState=new Uint8Array(256);class Sg{constructor(e,t){this.view=e;this.origTitle=document.title,t&&(document.title=this.origTitle?`${this.origTitle} - ${t}`:t)}setTitle(e){document.title=e}setSize(e,t){const{view:{clientWidth:r,clientHeight:i,style:s}}=this;r!==e&&s.setProperty("width",e+"px"),i!==t&&s.setProperty("height",t+"px")}close(){this.view.remove(),document.title=this.origTitle}on(){}off(){}toTop(){}}class Tg{constructor(e,t){this.wnd=e;this.handlers=new Set;this.sizedOnce=!1;t&&(e.document.title=t)}on(e,t){if(e!=="closed")return;this.wnd.addEventListener("beforeunload",t),this.handlers.add(t)}off(e,t){if(e!=="closed")return;t?(this.wnd.removeEventListener("beforeunload",t),this.handlers.delete(t)):(this.handlers.forEach(r=>this.wnd.removeEventListener("beforeunload",r)),this.handlers.clear())}setTitle(e){this.wnd.document.title=e}setSize(e,t){if(this.sizedOnce===!0)return;const{wnd:r}=this;r.addEventListener("resize",()=>r.resizeTo(e+r.outerWidth-r.innerWidth+15,t+r.outerHeight-r.innerHeight+15),{once:!0}),this.sizedOnce=!0}toTop(){}close(){this.off("closed"),this.wnd.close()}}class Rs{constructor(e){this.root=e}get width(){return window.innerWidth}get height(){return window.innerHeight}window({title:e,view:t}){if(this.root)return this.root.appendChild(t),new Sg(t,e);const r=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!r)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${e}`);return r.document.body.appendChild(t),new Tg(r,e)}}class Bs{constructor(e){this._state="closed";this._diag={iterations:0,missingCommands:[]};this._computer=new Th.SmoothExecutor;this.handlers={closed:new Set,error:new Set};this.projectRes=e,this.host=new Rs,this.env=null,this.options={}}get state(){return this._state}get diag(){return this._diag}get computer(){return this._computer}set computer(e){if(e===this._computer)return;this._computer.running&&(this._computer.stop(),this.loop&&e.run(this.loop)),this._computer=e}play(e){if(this.loop)return this;e&&(this.host=e instanceof HTMLElement?new Rs(e):e);const t=this.env=new ye(this.projectRes,this.host,this.options);return this._diag.iterations=0,this.loop=()=>{let r=!1;try{r=t.compute()}catch(i){return console.error(i),this._state="error",this.handlers.error.forEach(s=>s(i.message)),!1}return++this._diag.iterations,r===!1&&(this.close(),this.handlers.closed.forEach(i=>i())),r},this.computer.run(this.loop),this._state="playing",this}close(){return this.computer.stop(),this.loop=void 0,this.env&&(this.env.closeAllRes(),this.env=null),this._state="closed",this}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,t){return this.handlers[e].add(t),this}off(e,t){return t?this.handlers[e].delete(t):this.handlers[e].clear(),this}}class ve{constructor(){this.disks=new Map}static fromZip(r){return me(this,arguments,function*(e,t={}){const i=new TextDecoder(t.encoding||"cp866");let s;try{s=yield xh.loadAsync(e,{decodeFileName:u=>i.decode(u),createFolders:!1})}catch(u){const d=e instanceof File?`\u0424\u0430\u0439\u043B ${e.name}`:e instanceof Blob?`Blob { size: ${e.size}, type: ${e.type} }`:`${e.toString()}(${e.byteLength})`;throw Error(`${d} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F ZIP-\u0430\u0440\u0445\u0438\u0432\u043E\u043C`)}const n=new ve,[o,l]=wh(t.directory||"",ve.defaultPrefix);let c=new ft(o,n);n.disks.set(o,c);for(const u of l)c=c.createLocalDir(u);return s.forEach((u,d)=>{const _=u.split(ys);let b=c;for(let g=0;g<_.length-1;g++)b=b.createLocalDir(_[g]);d.dir||b.createLocalFile(_[_.length-1],d)}),n})}static loadClasses(e){return me(this,null,function*(){for(let n of e)for(;n!==n.parent;n=n.parent)e.has(n.parent)&&e.delete(n);const t=[...e];console.log(`\u041F\u0443\u0442\u0438 \u043F\u043E\u0438\u0441\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:
${t.map(n=>n.pathDos).join(`;
`)}`);const r=t.map(n=>[...n.files(/.+\.cls$/i)]),i=new Array().concat(...r),s=yield Promise.all(i.map(n=>n.readAs("cls")));return console.log(`\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E ${i.length} \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043E\u0431\u044A\u0435\u043C\u043E\u043C ${(s.reduce((n,o)=>n+o.byteSize,0)/1024).toFixed()} \u041A\u0411`),s})}static project(e,t,r){return me(this,null,function*(){var o;const i=e.parent;console.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${e.pathDos}`);const s=yield e.readAs("prj");{const l=new Set([i]),c=(o=s.settings)==null?void 0:o.classSearchPaths;if(c){const d=c.split(",").map(_=>_.trim()).filter(_=>_);for(const _ of d){const b=i.get(_);(b==null?void 0:b.dir)&&l.add(b)}}const u=yield ve.loadClasses(l);t.add(u,r)}let n;{const l=i.get("_preload.stt");if(l&&!l.dir)try{n=yield l.readAs("stt")}catch(c){console.warn(c.message)}}return{dir:i,prjInfo:s,classes:t,stt:n}})}disk(e){return this.disks.get(e.toUpperCase())}merge(e){if(!(e instanceof ve))throw Error("fs is not instanceof VFS");const{disks:t}=e,{disks:r}=this;for(const[i,s]of t)r.set(i,(r.get(i)||new ft(i,this)).merge(s));return this}*files(e){for(const t of this.disks.values())yield*t.files(e)}project(){return me(this,arguments,function*(e={}){let t;{const n=new Array,o=e.path&&tr(e.path).join("\\").toUpperCase();for(const l of this.files(/.+\.(prj|spj)$/i)){if(o&&!l.pathDos.toUpperCase().includes(o))continue;t=l,n.push(l.pathDos)}if(n.length>1)throw Error(`\u041D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432:
${n.join(`
`)}`);if(!t)throw Error("\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432")}const r=new _h,i=yield ve.project(t,r),s=e.additionalClassPaths;if(s){const n=new Set;for(const l of s){const c=(this.disks.get(ve.defaultPrefix)||i.dir).get(l);(c==null?void 0:c.dir)&&n.add(c)}const o=yield ve.loadClasses(n);r.add(o)}return new Bs(i)})}}ve.defaultPrefix="C";const ks=e=>Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u0430\u0442\u0430\u043B\u043E\u0433 ${e} - \u043F\u043E \u044D\u0442\u043E\u043C\u0443 \u043F\u0443\u0442\u0438 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0444\u0430\u0439\u043B.`);class ft{constructor(e,t){this.localName=e;this.nodes=new Map;this.dir=!0;t instanceof ft?(this.fs=t.fs,this.parent=t,this.pathDos=t.pathDos+"\\"+e):(this.fs=t,this.parent=this,vs(e),this.pathDos=this.localName=e+":")}resolve(e,t=!1){if(e.length===0)return;const r=e[0].length===2&&e[0][1]===":";let i;if(r){const s=this.fs.disk(e[0][0]);if(e.length===1)return s;if(s===void 0)return;i=s}else i=this;for(let s=r?1:0;s<e.length;++s)if(e[s]==="..")i=i.parent;else{const n=e[s],o=n.toUpperCase(),l=i.nodes.get(o);if(l==null?void 0:l.dir){i=l;continue}if(!l&&t){const c=new ft(n,i);i.nodes.set(o,c),i=c;continue}return s===e.length-1?l:void 0}return i}get(e){return this.resolve(tr(e))}create(e,t,r){const i=tr(t);if(e==="dir")return this.resolve(i,!0);const s=i.slice(0,i.length-1),n=i[i.length-1],o=this.resolve(s);if(!(o==null?void 0:o.dir))return;const l=n.toUpperCase(),c=o.nodes.get(l);if(c==null?void 0:c.dir)return;const u=new Cr(n,o,r!=null?r:new ArrayBuffer(0));return o.nodes.set(l,u),u}setLocalSafe(e,t){const r=this.nodes.size;if(this.nodes.set(e.toUpperCase(),t),this.nodes.size===r)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${t.pathDos}`)}createLocalFile(e,t){const r=new Cr(e,this,t);this.setLocalSafe(e,r)}createLocalDir(e){const t=e.toUpperCase(),r=this.nodes.get(t);if(r){if(r.dir)return r;throw ks(r.pathDos)}const i=new ft(e,this);return this.nodes.set(t,i),i}merge({nodes:e}){const{nodes:t}=this;for(const[r,i]of e){let s=t.get(r);if(s&&!s.dir)throw ks(s.pathDos);if(i.dir){s||(s=new ft(i.localName,this),t.set(r,s)),s.merge(i);continue}if(s)throw ks(s.pathDos);t.set(r,i.hardlink(this))}return this}*files(e){for(const t of this.nodes.values()){if(t.dir){yield*t.files(e);continue}(!e||e.test(t.pathDos))&&(yield t)}}}var K;(function(e){e[e.CR_MATH=1]="CR_MATH",e[e.CR_MATHDATA=2]="CR_MATHDATA",e[e.CR_FLAGS=4]="CR_FLAGS",e[e.CR_VARS=5]="CR_VARS",e[e.CR_CHILDS=6]="CR_CHILDS",e[e.CR_LINKS=7]="CR_LINKS",e[e.CR_ICON=8]="CR_ICON",e[e.CR_SCHEME=9]="CR_SCHEME",e[e.CR_TEXT=10]="CR_TEXT",e[e.CR_VARSIZE=11]="CR_VARSIZE",e[e.CR_IMAGE=12]="CR_IMAGE",e[e.CR_CODE=13]="CR_CODE",e[e.CR_INFO=14]="CR_INFO",e[e.CR_VARS1=15]="CR_VARS1",e[e.CR_CHILDSname=16]="CR_CHILDSname",e[e.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",e[e.CR_DEFICON=20]="CR_DEFICON",e[e.CR_CLASSTIME=21]="CR_CLASSTIME",e[e.CR_ICONFILE=22]="CR_ICONFILE",e[e.CR_HELPFILE=25]="CR_HELPFILE",e[e.CR_EQU=30]="CR_EQU",e[e.CR_MOVEINFO=31]="CR_MOVEINFO",e[e.RR_VERSION=40]="RR_VERSION",e[e.PR_MAINCLASS=100]="PR_MAINCLASS",e[e.PR_PASSWORD=101]="PR_PASSWORD",e[e.PR_VARS=102]="PR_VARS",e[e.PR_WATCH=103]="PR_WATCH",e[e.VR_CLASSES=1e3]="VR_CLASSES",e[e.VR_VARS=1001]="VR_VARS",e[e.VR_SETVAR=1002]="VR_SETVAR",e[e.CR_CLASSINFO=8e3]="CR_CLASSINFO",e[e.PPR_FIELDS=2048]="PPR_FIELDS",e[e.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",e[e.PPR_SCALEMODE=2050]="PPR_SCALEMODE",e[e.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",e[e.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",e[e.PPR_USEADDF=2053]="PPR_USEADDF",e[e.PPR_SRCRECT=2054]="PPR_SRCRECT",e[e.PPR_USESRC=2055]="PPR_USESRC",e[e.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",e[e.CLF_LOADED=1]="CLF_LOADED",e[e.CLF_PROJECT=2]="CLF_PROJECT",e[e.CLF_MODIFY=4]="CLF_MODIFY",e[e.CLF_READONLY=8]="CLF_READONLY",e[e.CLF_NORECURSE=16]="CLF_NORECURSE",e[e.CLF_ADDLIB=32]="CLF_ADDLIB",e[e.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",e[e.CLF_LIBRARY=256]="CLF_LIBRARY",e[e.CLF_PACKFILE=512]="CLF_PACKFILE",e[e.CF_PROTECTED=1]="CF_PROTECTED",e[e.CF_ONEFASE=2]="CF_ONEFASE",e[e.CF_COMPILED=4]="CF_COMPILED",e[e.CF_VIRTUAL=8]="CF_VIRTUAL",e[e.CF_SCHEME=16]="CF_SCHEME",e[e.CF_MODIFY=32]="CF_MODIFY",e[e.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",e[e.CF_BUILDIN=256]="CF_BUILDIN",e[e.CF_ICON=512]="CF_ICON",e[e.CF_PROCEDURE=1024]="CF_PROCEDURE",e[e.CF_STRUCTURE=2048]="CF_STRUCTURE",e[e.CF_USEDEFICON=4096]="CF_USEDEFICON",e[e.CF_SIZEABLE=8192]="CF_SIZEABLE",e[e.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",e[e.TCF_WASSAVE=1]="TCF_WASSAVE",e[e.TCF_NEWCLASS=2]="TCF_NEWCLASS",e[e.OF_DISABLED=1]="OF_DISABLED",e[e.OF_ONEFASE=2]="OF_ONEFASE",e[e.OF_ERROR=4]="OF_ERROR",e[e.LF_DISABLED=1]="LF_DISABLED",e[e.LF_AUTOLINK=2]="LF_AUTOLINK",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_NOREAD=4]="VF_NOREAD",e[e.VF_NOWRITE=8]="VF_NOWRITE",e[e.VF_STATIC=16]="VF_STATIC",e[e.VF_ONSCHEME=32]="VF_ONSCHEME",e[e.VF_PARAMETER=64]="VF_PARAMETER",e[e.VF_LEFT=128]="VF_LEFT",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.VF_NOSAVE=2048]="VF_NOSAVE",e[e.VF_GLOBAL=4096]="VF_GLOBAL",e[e.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",e[e.SF_EXTERNAL=1]="SF_EXTERNAL",e[e.SF_EDITING=2]="SF_EDITING",e[e.STATE_FAST=0]="STATE_FAST",e[e.STATE_VARS=1]="STATE_VARS",e[e.STATE_DEBUG=2]="STATE_DEBUG",e[e.STATE_SET=3]="STATE_SET",e[e.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",e[e.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",e[e.CHF_WASSIZED=4]="CHF_WASSIZED",e[e.CHF_PREPROCESS=8]="CHF_PREPROCESS",e[e.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",e[e.IF_CORRECTED=1]="IF_CORRECTED",e[e.EF_RUNNING=1]="EF_RUNNING",e[e.EF_MUSTSTOP=2]="EF_MUSTSTOP",e[e.EF_STEPACTIVE=4]="EF_STEPACTIVE",e[e.EF_EQUACTIVE=8]="EF_EQUACTIVE",e[e.EF_MSGACTIVE=16]="EF_MSGACTIVE",e[e.EF_BYTIMER=32]="EF_BYTIMER"})(K||(K={}));var Z;(function(e){e[e.otGROUP=1]="otGROUP",e[e.otCOLLECTION=1e3]="otCOLLECTION",e[e.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",e[e.otPENCOLLECTION=1004]="otPENCOLLECTION",e[e.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",e[e.otDIBCOLLECTION=1006]="otDIBCOLLECTION",e[e.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",e[e.otFONTCOLLECTION=1008]="otFONTCOLLECTION",e[e.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",e[e.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",e[e.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",e[e.ot3DCOLLECTION=1012]="ot3DCOLLECTION",e[e.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",e[e.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",e[e.otDATAITEMS=1022]="otDATAITEMS",e[e.otMATERIALS3D=1024]="otMATERIALS3D",e[e.otSPACE2D=17458]="otSPACE2D",e[e.otSPACE3D=17459]="otSPACE3D",e[e.otSPACE3Df=25668]="otSPACE3Df",e[e.otGROUP2D=3]="otGROUP2D",e[e.otRGROUP2D=4]="otRGROUP2D",e[e.otGROUP3D=5]="otGROUP3D",e[e.otOBJECT3D=10]="otOBJECT3D",e[e.otCAMERA3D=11]="otCAMERA3D",e[e.otLIGHT3D=12]="otLIGHT3D",e[e.otLINE2D=20]="otLINE2D",e[e.otBITMAP2D=21]="otBITMAP2D",e[e.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",e[e.otTEXT2D=23]="otTEXT2D",e[e.otVIEW3D2D=24]="otVIEW3D2D",e[e.otUSEROBJECT2D=25]="otUSEROBJECT2D",e[e.otCONTROL2D=26]="otCONTROL2D",e[e.otEDITFRAME2D=50]="otEDITFRAME2D",e[e.otROTATECENTER2D=51]="otROTATECENTER2D",e[e.otFRAME3D=52]="otFRAME3D",e[e.otAXIS3D=53]="otAXIS3D",e[e.ttPEN2D=101]="ttPEN2D",e[e.ttBRUSH2D=102]="ttBRUSH2D",e[e.ttDIB2D=103]="ttDIB2D",e[e.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",e[e.ttFONT2D=105]="ttFONT2D",e[e.ttSTRING2D=106]="ttSTRING2D",e[e.ttTEXT2D=107]="ttTEXT2D",e[e.ttREFTODIB2D=110]="ttREFTODIB2D",e[e.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",e[e.ctINFONAME=200]="ctINFONAME",e[e.ctINFOAUTOR=201]="ctINFOAUTOR",e[e.ctINFOINFO=202]="ctINFOINFO",e[e.ctCRDSYSTEM=203]="ctCRDSYSTEM",e[e.stSPACEDATA=204]="stSPACEDATA",e[e.stOBJNAME=205]="stOBJNAME"})(Z||(Z={}));function Eh(e,t){if(e!==Z.ttPEN2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Pen");return{handle:t.uint16(),color:t.int32(),style:t.int16(),width:t.int16(),rop2:t.int16()}}function Ih(e,t){if(e!==Z.ttBRUSH2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Brush");return{handle:t.uint16(),color:t.int32(),style:t.int16(),hatch:t.int16(),rop2:t.int16(),dibHandle:t.uint16()}}function Oh(e,t){switch(e){case Z.ttDIB2D:return{type:"image",handle:t.uint16(),img:zi(t)};case Z.ttREFTODIB2D:return{type:"BMPReference",handle:t.uint16(),filename:t.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Dib")}}function Ah(e,t){switch(e){case Z.ttDOUBLEDIB2D:return{type:"image",handle:t.uint16(),img:nr(t)};case Z.ttREFTODOUBLEDIB2D:return{type:"DBMReference",handle:t.uint16(),filename:t.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 DoubleDib")}}function Dh(e,t,r){if(e!==Z.ttFONT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Font");const i=t.pos(),s={handle:t.uint16(),height:t.int16(),width:t.int16(),escapement:t.int16(),orientation:t.int16(),weight:t.int16(),italic:t.byte(),underline:t.byte(),strikeOut:t.byte(),charSet:t.byte(),outPrecision:t.byte(),clipPrecision:t.byte(),quality:t.byte(),pitchAndFamily:t.byte(),fontName:t.nulltString(32)};return t.seek(i+52),r>=515&&(s.size=t.int32(),s.style=t.int32()),s}function Nh(e,t){if(e!==Z.ttSTRING2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 String");return{handle:t.uint16(),text:t.string()}}function xg(e){return{fgColor:e.int32(),bgColor:e.int32(),fontHandle:e.uint16(),stringHandle:e.uint16()}}function Rh(e,t,r){if(e!==Z.ttTEXT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Text");const i=t.uint16(),s=new ue(t,r,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u044B\u0445 \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\u043E\u0432"),n=s.readCollection(xg);return s.checkReaded(),{handle:i,textCollection:n}}function Ls(e){return e.uint16()}function Fs(e,t){const r={handle:e.uint16(),options:e.uint16()};return t>=258&&t<768&&(r.name=e.string()),r}function Zi(e,t){return t<512?q(q({},Fs(e,t)),{originX:e.int16(),originY:e.int16(),width:e.int16(),height:e.int16()}):q(q({},Fs(e,t)),{originX:e.float64(),originY:e.float64(),width:e.float64(),height:e.float64()})}function Bh(e,t){const r=Fs(e,t),i=new ue(e,t,"\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0433\u0440\u0443\u043F\u043F\u044B"),s=i.readCollection(Ls);return i.checkReaded(),q(q({type:"group"},r),{childHandles:s})}function kh(e,t){const r=Zi(e,t),i=e.uint16(),s=e.uint16(),n=e.uint16()*2,o=new Array(n);for(let c=0;c<n;c+=2)t<512?(o[c+0]=e.int16(),o[c+1]=e.int16()):(o[c+0]=e.float64(),o[c+1]=e.float64());const l=q(q({type:"line"},r),{penHandle:i,brushHandle:s,coords:o});if(t>512){const c=e.byte();c>0&&(l.arrows=e.bytes(c))}return l}function Ps(e,t,r){return q(q({type:r},Zi(e,t)),{cropX:t<512?e.int16():e.float64(),cropY:t<512?e.int16():e.float64(),cropW:t<512?e.int16():e.float64(),cropH:t<512?e.int16():e.float64(),angle:e.int16(),dibHandle:e.uint16()})}function Lh(e,t){return q(q({type:"text"},Zi(e,t)),{textToolHandle:e.uint16(),delta:t<512?e.point2dInt():e.point2d(),angle:e.int16()})}function Fh(e,t){const r=q(q({type:"control"},Zi(e,t)),{className:e.string().toUpperCase(),text:e.string(),dwStyle:e.int32(),exStyle:e.int32(),id:e.uint16(),controlSize:e.point2dInt()});return e.uint16(),r}function Ph(e,t){const r={};let i=0;const s=e.pos()+t;for(;e.pos()<s&&(i=e.uint16())!=0;)switch(i){case 1:r.target=e.string();break;case 2:r.windowName=e.string();break;case 3:r.objectName=e.string();break;case 4:r.openMode=e.uint16();break;case 5:r.effect=e.string();break;case 6:r.time=e.uint16();break;case 7:r.params=e.string();break;case 8:r.disabled=!0;break}return r}function Ms(e,t){const r=e.uint16();return e.skip(5),Array.from({length:r},()=>{const i=e.uint16(),s=e.uint16();return t(i,s,e)})}function Mh(e){return{type:e.uint16(),objectHandle:e.int16(),center:e.point2d(),matrix:Array.from({length:9},()=>e.float64())}}class ue{constructor(e,t,r){this.name=r;this.reader=e,this.version=t,this.start=e.pos(),this.code=e.int16(),this.size=t>=768?e.int32():0}goEnd(){this.reader.seek(this.start+this.size)}readToolCollection(e){const t=this.reader.uint16();return this.reader.skip(7),Array.from({length:t},()=>{const r=new ue(this.reader,this.version,"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442");this.reader.skip(2);const i=e(r.code,this.reader,this.version);return r.checkReaded(),i})}readElementCollection(){const e=this.reader.uint16();return this.reader.skip(7),Array.from({length:e},()=>{const{reader:t,version:r}=this,i=new ue(t,r,"\u0413\u0440\u0430\u0444. \u043E\u0431\u044A\u0435\u043A\u0442");let s;switch(i.code){case Z.otGROUP2D:s=Bh(t,r);break;case Z.otLINE2D:s=kh(t,r);break;case Z.otBITMAP2D:s=Ps(t,r,"bitmap");break;case Z.otDOUBLEBITMAP2D:s=Ps(t,r,"doubleBitmap");break;case Z.otTEXT2D:s=Lh(t,r);break;case Z.otCONTROL2D:s=Fh(t,r);break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442: ${Z[i.code]}`)}if(r<768)return s;for(;i.hasData();){const n=new ue(this.reader,this.version,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435");n.readElementData(s),n.checkReaded()}return i.checkReaded(),s})}readElementData(e){switch(this.code){case Z.otDATAITEMS:Ms(this.reader,(t,r,i)=>{if(t===10){e.hyperbase=Ph(i,r);return}console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043E\u0431\u044A\u0435\u043A\u0442\u0435 ${e.handle}: id ${t}, ${r} \u0431\u0430\u0439\u0442\u043E\u0432`),i.skip(r);return});break;case Z.stOBJNAME:e.name=this.reader.fixedString(this.size-6);break}}readCollection(e){const t=this.reader.uint16();return this.reader.skip(4),Array.from({length:t},()=>e(this.reader))}readObject(e){switch(this.code){case 1004:e.penTools=this.readToolCollection(Eh);break;case 1005:e.brushTools=this.readToolCollection(Ih);break;case 1006:e.dibTools=this.readToolCollection(Oh);break;case 1007:e.doubleDibTools=this.readToolCollection(Ah);break;case 1008:e.fontTools=this.readToolCollection(Dh);break;case 1009:e.stringTools=this.readToolCollection(Nh);break;case 1010:e.textTools=this.readToolCollection(Rh);break;case 1012:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 3D-\u0444\u0440\u0435\u0439\u043C\u043E\u0432 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");case Z.otPRIMARYCOLLECTION:e.elementOrder=this.readCollection(Ls);break;case Z.otOBJECTCOLLECTION:e.elements=this.readElementCollection();break;case Z.otDATAITEMS:e.settings=Ms(this.reader,(t,r,i)=>({id:t,data:i.bytes(r)}));break;case Z.ctINFONAME:this.goEnd();break;case Z.ctINFOAUTOR:this.goEnd();break;case Z.ctINFOINFO:this.goEnd();break;case Z.ctCRDSYSTEM:e.crdSystem=Mh(this.reader);break;default:console.warn(`${Z[this.code]} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.goEnd()}}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.reader.pos()-this.start}checkReaded(){if(this.version<768)return;const e=this.readedBytes();if(e>this.size)throw Error(`Chunk ${this.name} data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk ${this.name} not readed: ${e} instead of ${this.size}`)}}function Eg(e,t){const r=new ue(e,t,"VDR");if(r.code!==Z.stSPACEDATA)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x");const i={version:t,origin:e.point2d(),scaleDiv:e.point2d(),scaleMul:e.point2d(),state:e.uint16(),brushHandle:e.uint16(),layers:e.uint32(),flags:e.uint16()};for(;r.hasData();){const s=new ue(e,t,"");s.readObject(i),s.checkReaded()}return r.checkReaded(),i}function Ig(e,t,r){var g;const i=e.int32()+r,s=e.int32()+r,n=()=>t<512?e.point2dInt():e.point2d(),o=n(),l=n(),c=n();e.string();const u=e.uint16();e.string(),e.string(),e.string(),new ue(e,t,"RCenter").goEnd(),new ue(e,t,"Frame").goEnd();const d=e.uint16(),_={version:t,origin:o,scaleDiv:l,scaleMul:c,state:u,flags:0,brushHandle:d,layers:0};e.seek(i),new ue(e,t,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(_),new ue(e,t,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(_),e.seek(s);const b=e.uint16();for(let T=0;T<b;T++)new ue(e,t,"").readObject(_);if(t>258){_.layers=e.uint32(),_.flags=e.uint16();let T;for(;(T=e.uint16())!==0;)switch(T){case 1:const w=e.uint16(),E=(g=_.elements)==null?void 0:g.find(I=>I.handle===w);if(!E)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${w} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435`);new ue(e,t,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readElementData(E);break;case 2:new ue(e,t,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readObject(_);break;default:return _}}return e.string(),_}function Ur(e,t,r=!0){const i=e.uint16();if(i!==17458)throw new Ie(e,i,17458);const s=e.pos(),n=e.uint16();e.skip(2);const o=n<768?Ig(e,n,s):Eg(e,n);if(o.source=t,!r)return o;const l=e.size()-e.pos();if(l!==0){const c=`${e.name}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${e.pos()} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${l}. v0x${o.version.toString(16)}.`;console.warn(c)}return o}function Og(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const s=e.string(),n=e.string(),o=e.string(),l=e.string().toUpperCase();if(l!=="STRING"&&l!=="FLOAT"&&l!=="INTEGER"&&l!=="HANDLE"&&l!=="COLORREF")throw new dt(e,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${l}.`);const c=e.int32();r[i]={name:s,description:n,defaultValue:o,type:l,flags:c}}return r}function Ag(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const s=e.uint16(),n=e.uint16(),o=e.uint16(),l=e.int32(),c=e.uint16(),u=e.uint16(),d=new Array(c);for(let _=0;_<c;_++){const b=e.string(),g=e.string();d[_]={name1:b,name2:g}}r[i]={handle1:s,handle2:n,linkHandle:o,flags:l,connectedVars:d,contactPadHandle:u}}return r}function Dg(e,t){const r=e.uint16(),i=new Array(r);for(let s=0;s<r;s++){const n=e.string(),o=e.uint16(),l=e.string(),c=t<12290?e.point2dInt():e.point2d(),u=e.byte();i[s]={classname:n,schemeInfo:{handle:o,name:l,position:c},flags:u}}return i}function Ch(e,t,r){const i=`${r} ${t} (${e.name||"?"})`,s=e.int32();if(s&K.SF_EXTERNAL){const o=e.string();console.warn(`${i}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F. \u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${o}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);return}const n=e.bytes(e.int32());try{return Ur(new ir(n,i),{origin:"class",name:t})}catch(o){console.warn(`${i}): \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${o.message}`);return}}function Uh(e){const t=e.uint16();if(t!==16979)throw new Ie(e,t,16979);const r=e.int32();e.int32(),e.int32();const i=e.string();return{name:i,version:r}}function zh(e,t,r,i){const s={};let n=e.uint16();if(n===K.CR_VARS1&&(s.vars=Og(e),n=e.uint16()),n===K.CR_LINKS&&(s.links=Ag(e),n=e.uint16()),(n===K.CR_CHILDSnameXY||n===K.CR_CHILDSname||n===K.CR_CHILDS)&&(s.children=Dg(e,r),n=e.uint16()),n===K.CR_ICON){const o=e.int32();e.skip(o-4),n=e.uint16()}if(n===K.CR_SCHEME){const o=e.int32();i.readScheme?s.scheme=Ch(e,t,"\u0421\u0445\u0435\u043C\u0430"):e.skip(o-4),n=e.uint16()}if(n===K.CR_IMAGE){const o=e.int32();i.readImage?s.image=Ch(e,t,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"):e.skip(o-4),n=e.uint16()}if(n===K.CR_TEXT&&(s.sourceCode=e.string(),n=e.uint16()),n===K.CR_INFO&&(s.description=e.string(),n=e.uint16()),n===K.CR_VARSIZE&&(s.varsize=e.uint16(),n=e.uint16()),n===K.CR_FLAGS&&(s.flags=e.int32(),n=e.uint16()),n===K.CR_DEFICON&&(s.iconIndex=e.uint16(),n=e.uint16()),n===K.CR_ICONFILE&&(s.iconFile=e.string(),n=e.uint16()),n===K.CR_CODE){const o=e.int32()*2;if(i.parseBytecode!==void 0){const l=e.bytes(o);try{s.code=i.parseBytecode(l)}catch(c){console.warn(`\u0411\u0430\u0439\u0442\u043A\u043E\u0434 ${t} (${e.name||"?"}): \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${c.message}`)}}else e.skip(o);n=e.uint16()}return n===K.CR_EQU?(console.warn(`${t} (${e.name||"?"}):
\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F.`),s):(n!==K.CR_CLASSTIME&&r===12291&&console.warn(`${t} (${e.name||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),s)}const Cs="'",Us='"';function Hh(e){let t="",r;for(let i=0;i<e.length;++i){const s=e[i];if(s===Cs&&r!==Us?r=r?void 0:Cs:s===Us&&r!==Cs&&(r=r?void 0:Us),r){t+=s;continue}if(s==="/"){const n=e[i+1];if(n==="*"){for(i+=2;i<e.length&&(e[i]!=="*"||e[i+1]!=="/");)++i;++i;continue}if(n==="/"){for(++i;i<e.length&&e[++i]!==`
`;);t[t.length-1]!==`
`&&(t+=`
`);continue}}if(s===";"||s===`
`){t[t.length-1]!==`
`&&(t+=`
`);continue}if(s==="\r"){e[i+1]===`
`&&++i,t[t.length-1]!==`
`&&(t+=`
`);continue}t+=s}return t[t.length-1]===`
`?t:t+`
`}const $h=Gr(Wh());function zs(e,t){const r="stratum_",i=r.length,s=Object.getOwnPropertyNames(e.prototype).filter(n=>{const o=e.prototype[n];return typeof o=="function"&&o.name.startsWith(r)});return s.map(n=>[n.toString().substring(i).toUpperCase(),`${t}.${n}`])}const Nt="schema",$e="prj",Rt="env",Ng="getTime",Rg="getDate",Bg="getActualSize2d",kg=new Map([["ADDSLASH","addSlash"],["LN","ln"],["POS","pos"],["RIGHT","right"],["ROUND","round"],...zs(ye,Rt),...zs(or,$e),...zs(ke,Nt)]),ar=new Map([[N.Float,"F"],[N.Handle,"I"],[N.ColorRef,"I"],[N.String,"S"]]),mt="TLB",Vh=`
function addSlash(a) {
    return a[a.length - 1] === "\\\\" ? a : a + "\\\\";
}
function ln(a) {
    return a > 0 ? Math.log(a) : -(10**100)
}
function pos(s1, s2, n) {
    if(s2 === "") return -1
    let idx = -1;
    let srch = 0;
    for(let i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, srch);
        if(idx < 0) return -1;
        srch = idx + s2.length;
    }
    return idx;
}
function right(a, n) {
    return a.substr(a.length - n);
}
function round(a, b) {
    const pw = Math.ceil(10 ** b);
    return Math.round(a * pw + Number.EPSILON) / pw;
}
var ${$e} = ${Nt}.${$e};
var ${Rt} = ${$e}.${Rt};
`,Lg=`
var ${mt} = ${Nt}.${mt};
var oldF = ${$e}.oldFloats;
var newF = ${$e}.newFloats;
var oldI = ${$e}.oldInts;
var newI = ${$e}.newInts;
var oldS = ${$e}.oldStrings;
var newS = ${$e}.newStrings;
`,Fg=`
var oldF = floats;
var newF = floats;
var oldI = ints;
var newI = ints;
var oldS = strings;
var newS = strings;
`,Pg=[mt,"floats","ints","strings"];let Hs=!1;function Yi(e,t,r){var i;e.isNew&&e.type!=="var"&&(Hs=!0);switch(e.type){case"const":{const s=e.value;if(s[0]==="#")return s.length>1?s.substring(1,s.length):"0";if(s[0]==='"'||s[0]==="'"){const n=s.substring(1,s.length-1).split("\\").join("\\\\").split("`").join("\\`");return"`"+n+"`"}return s}case"-":return"-"+Ve(e.operand,t,r);case"!":return"!"+Ve(e.operand,t,r);case"var":{if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const s=e.name.toUpperCase(),n=t.nameUCToId.get(s);if(n===void 0){const l=O[s];if(l===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0438\u043B\u0438 \u043A\u043E\u043D\u0441\u0442\u0430\u043D\u0442\u0430: ${e.name}`);return l}const o=ar.get(t.types[n]);if(!o)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439 ${e.name}`);return`${e.isNew?"new":"old"}${o}[${mt}[${n}]]`}case"call":{const s=e.name.toUpperCase();if(s==="EXIT")return"return";if(s==="INC"){const u=ar.get(N.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const d=e.args[0];if(d.first.type!=="var")throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");const _=d.first.name,b=t.nameUCToId.get(_.toUpperCase());if(b===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 Inc: ${_}`);const g=e.args.length<2?1:Ve(e.args[1],t,r);return`${d.first.isNew?"new":"old"}${u}[${mt}[${b}]] += ${g}`}if(s==="GETTIME"){const u=ar.get(N.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const d=e.args.map(_=>{if(_.first.type!=="var")throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");const b=_.first.name,g=t.nameUCToId.get(b.toUpperCase());if(g===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetTime: ${b}`);return`${_.first.isNew?"new":"old"}${u},${mt}[${g}]`});return`${Rt}.${Ng}(${d.join(",")})`}if(s==="GETDATE"){const u=ar.get(N.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const d=e.args.map(_=>{if(_.first.type!=="var")throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");const b=_.first.name,g=t.nameUCToId.get(b.toUpperCase());if(g===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetDate: ${b}`);return`${_.first.isNew?"new":"old"}${u},${mt}[${g}]`});return`${Rt}.${Rg}(${d.join(",")})`}if(s==="GETACTUALSIZE2D"){const u=ar.get(N.Float);if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const d=e.args.slice(0,2).map(b=>Ve(b,t,r)),_=e.args.slice(2,4).map(b=>{if(b.first.type!=="var")throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");const g=b.first.name,T=t.nameUCToId.get(g.toUpperCase());if(T===void 0)throw Error(`\u041D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 GetActualSize2d: ${g}`);return`${b.first.isNew?"new":"old"}${u},${mt}[${T}]`});return`${Rt}.${Bg}(${d.join(",")},${_.join(",")})`}const n=e.args.map(u=>Ve(u,t,r));if(s==="NOT")return`((${n[0]})>0===true?0:1)`;if(s==="AND")return`(((${n[0]})>0&&(${n[1]})>0)===true?1:0)`;if(s==="SQR")return`(${n[0]})**2`;if(s==="ABS")return`(Math.abs(${n[0]})||0)`;if(s==="TRUNC")return`(Math.trunc(${n[0]})||0)`;if(s==="SQRT")return`(Math.sqrt(${n[0]})||0)`;if(s==="SIN")return`(Math.sin(${n[0]})||0)`;if(s==="COS")return`(Math.cos(${n[0]})||0)`;if(s==="EXP")return`(Math.exp(${n[0]})||0)`;if(s==="SGN")return`(Math.sign(${n[0]})||0)`;if(s==="MIN")return`(Math.min(${n[0]}, ${n[1]})||0)`;if(s==="MAX")return`(Math.max(${n[0]}, ${n[1]})||0)`;if(s==="AVERAGE")return`((${n[0]})/2+(${n[1]})/2)`;if(s==="HANDLE")return`(parseInt(${n[0]})||0)`;if(s==="FLOAT")return`(parseFloat(${n[0]})||0)`;if(s==="STRING")return`(Math.round((${n[0]})*100000)/100000).toString()`;if(s==="LENGTH")return`(${n[0]}).length`;if(s==="SUBSTR")return`(${n[0]}).substr(${n[1]},${n[2]})`;if(s==="LEFT")return`(${n[0]}).substr(0,${n[1]})`;if(s==="RND")return`(Math.random() * (${n[0]}))`;if(s==="CHANGE")return`(${n[0]}).replace(new RegExp(${n[1]}, "g"), ${n[2]})`;const o=n.join(","),l=kg.get(s);if(l)return`${l}(${o})`;const c=(i=r.get(s))==null?void 0:i.funcModel(r);return c?`${Rt}.callFunction("${s}", ${Nt}${n.length>0?","+n:""})`:(zr.set(s,e.name),n.unshift(`"${e.name}"`),`${Nt}.stubCall(${o})`)}case"expression":return`(${Ve(e.body,t,r)})`;default:throw console.log(e),Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u043D\u0434: ${e.type}`)}}function Ve(e,t,r){const i=Yi(e.first,t,r),s=e.rest.map(n=>n.action==="/"?`/(${Yi(n.op,t,r)} || Infinity)`:n.action+Yi(n.op,t,r));return i+s.join("")}let js=!1;function Xh(e,t,r){switch(e.type){case":=":{if(!t)throw Error("\u0418\u043C\u0438\u0434\u0436 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");const i=t.nameUCToId.get(e.to.toUpperCase());if(i===void 0)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${e.to}`);const s=ar.get(t.types[i]);if(!s)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${t.types[i]} ${e.to}`);return`new${s}[TLB[${i}]] = ${Ve(e.operand,t,r)};`}case"varsDec":return;case"function":return;case"return":return;case"=":js=!0;return;case"switch":return"do{let exc=false;{";case"case":return`}if ((${Ve(e.expr.body,t,r)})&&exc===false) {exc=true;`;case"default":return"}if (exc===false) {exc=true;";case"endswitch":return"}}while(false);";case"if":case"while":return`${e.type} (${Ve(e.expr.body,t,r)}) {`;case"endif":case"endwhile":return"}";case"else":return"} else {";case"do":return"do {";case"until":return`}
while(${Ve(e.expr.body,t,r)});`;case"break":return"break;";case"callChain":return e.functions.map(i=>`${Yi(i,t,r)}`).join("; ")+";";default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: ${e.type}`)}}const zr=new Map;function Gh(e,t,r,i,s){zr.clear();const n=Hh(e);let o;try{o=$h.parse(n)}catch(c){throw console.log(n),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${r}: ${c.message}`)}if(o.length===0)return;if(s&&o[0].type!=="function")return;let l="";js=Hs=!1;for(let c=0;c<o.length;++c)try{const u=o[c];{const _=Xh(u,t,i);_&&(l+=_+`
`)}let d=u.then;for(;d;){const _=Xh(d,t,i);_&&(l+=_+`
`),d=d.then}}catch(u){throw console.log(n.split(`
`).filter(d=>d.trim()).map((d,_)=>`${_+1}: ${d}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 ${r}: ${u.message} \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 ${c+1}`)}return js&&console.warn(`\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B`),Hs&&console.warn(`${r}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),l.length===0?void 0:(zr.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...zr.values()].join(", ")} \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),zr.forEach((c,u)=>sr.set(u,c)),{body:l,norm:n})}function Ws(e,t,r,i){const s=Gh(e,t,r,i,!1);if(!s)return;console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${r}`);const{body:n,norm:o}=s;try{return new Function(Nt,Vh+Lg+n+`//# sourceURL=${r}`)}catch(l){throw console.log(o.split(`
`).filter(c=>c.trim()).map((c,u)=>`${u+1}: ${c}`).join(`
`)),console.log(n),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r}: ${l.message}`)}}function Zh(e,t,r,i){const s=Gh(e,t,r,i,!0);if(!s)return;console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${r} \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u044E`);const{body:n,norm:o}=s;try{return new Function(Nt,...Pg,Vh+Fg+n+`//# sourceURL=${r}`)}catch(l){throw console.log(o.split(`
`).filter(c=>c.trim()).map((c,u)=>`${u+1}: ${c}`).join(`
`)),console.log(n),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r}: ${l.message}`)}}class qi{constructor(e){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;this.compiled=!1;this.fCompiled=!1;const t=this.filepathDos=e.name;this.directoryDos=t.substring(0,t.lastIndexOf("\\")+1),this.byteSize=e.size();const r=Uh(e);this.name=r.name,this.version=r.version,this.__body={loaded:!1,reader:e}}get children(){return this.body.children}get links(){return this.body.links}get image(){return this.body.image}get iconFile(){return this.body.iconFile}get iconIndex(){return this.body.iconIndex}get scheme(){return this.body.scheme}alwaysUseIcon(){return(this.body.flags||0)&4096}get vars(){if(typeof this._vars!="undefined")return this._vars;const e=this.body.vars;if(!e)return this._vars={count:0,nameUCToId:new Map,defaultValues:[],types:[],flags:[]};const t=e.map(i=>i.name.toUpperCase()),r=e.map(i=>{switch(i.type){case"FLOAT":case"INTEGER":return N.Float;case"HANDLE":return N.Handle;case"STRING":return N.String;case"COLORREF":return N.ColorRef}});for(let i=0;i<e.length;i++){const s=t[i],n=r[i];s==="_ENABLE"&&n===N.Float?this._enableVarId=i:s==="_DISABLE"&&n===N.Float?this._disableVarId=i:s==="MSG"&&n===N.Float?this.msgVarId=i:s==="_HOBJECT"&&n===N.Handle?this._hobjectVarId=i:s==="IDITEM"&&n===N.Float?this.iditemVarId=i:s==="WNOTIFYCODE"&&n===N.Float?this.wnotifycodeVarId=i:s==="NWIDTH"&&n===N.Float?this.nwidthVarId=i:s==="NHEIGHT"&&n===N.Float?this.nheightVarId=i:s==="XPOS"&&n===N.Float?this.xposVarId=i:s==="YPOS"&&n===N.Float?this.yposVarId=i:s==="FWKEYS"&&n===N.Float?this.fwkeysVarId=i:s==="ORGX"&&n===N.Float?this.orgxVarId=i:s==="ORGY"&&n===N.Float?this.orgyVarId=i:s==="_OBJNAME"&&n===N.String?this._objnameVarId=i:s==="_CLASSNAME"&&n===N.String&&(this._classnameVarId=i)}return this._vars={count:e.length,nameUCToId:new Map(t.map((i,s)=>[i,s])),types:r,defaultValues:e.map((i,s)=>i.defaultValue!==""?Gi(r[s],i.defaultValue):void 0),flags:e.map(i=>i.flags)}}model(e){if(this.compiled===!0)return this._model;this.compiled=!0;const t=this.body.sourceCode;return t?this._model=Ws(t,this.vars,this.name,e):void 0}funcModel(e){if(this.fCompiled===!0)return this._fModel;this.fCompiled=!0;const t=this.body.sourceCode;return t?this._fModel=Zh(t,this.vars,this.name,e):void 0}get body(){const{__body:e}=this;if(e.loaded)return e.data;console.log(`\u0427\u0438\u0442\u0430\u0435\u043C ${this.name} (${e.reader.name})`);const t=zh(e.reader,this.name,this.version,qi.blocks);return this.__body={loaded:!0,data:t},t}}qi.blocks={readScheme:!0,readImage:!0};function Yh(e){const t=e.uint16();if(t!==12)throw new Ie(e,t,12);e.seek(14);const r=e.int32(),i=e.int32(),s=e.int32(),n=e.int32();e.uint16(),e.uint16();const o=Array.from({length:r*i},()=>e.float64());return{minX:s,minY:n,rows:r,cols:i,data:o}}const Mg={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone"};function Cg(e){const t={},r=e.uint16();for(let i=0;i<r;i++){const s=e.uint16(),n=e.byte(),o=e.byte(),l=e.fixedString(o-1);e.byte();let c;switch(n){case 0:c=e.int32();break;case 1:c=e.float64();break;case 2:c=e.fixedString(s-o-3),e.byte();break;default:throw new dt(e,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${n}`)}const u=Mg[l];u?t[u]=c:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${l} (${c})`)}return t}function Ug(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const s=Array.from({length:e.uint16()},()=>e.uint16()),n=e.string(),o=e.string();r[i]={path:s,name:n,info:o}}return r}function qh(e){const t=e.uint16();if(t!==26697)throw new Ie(e,t,26697);const r={rootClassName:""};let i=0;for(;(i=e.uint16())!==0;)switch(i){case K.PR_PASSWORD:e.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case K.PR_MAINCLASS:r.rootClassName=e.string();break;case K.PR_VARS:r.settings=Cg(e);break;case K.PR_WATCH:r.watchedVariables=Ug(e);break}if(!r.rootClassName)throw new dt(e,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}function Kh(e){const t=e.int32(),r=e.uint16(),i=e.string(),s=e.int32(),n=Array.from({length:e.uint16()},()=>({name:e.string(),value:e.string()})),o=[];for(;e.pos()<t;)o.push(Kh(e));return{handle:r,classname:i,classId:s,values:n,childSets:o}}function Jh(e){const t=e.uint16();if(t!==19)throw new Ie(e,t,19);e.seek(21),e.string(),e.uint16(),e.uint16();switch(e.uint16()){case K.VR_CLASSES:throw new dt(e,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case K.VR_SETVAR:return Kh(e)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}class Cr{constructor(e,t,r){this.localName=e;this.dir=!1;this.warnShowed=!1;this.buf=r,this.parent=t,this.pathDos=t.pathDos+"\\"+e}hardlink(e,t){return new Cr(t||this.localName,e,this.buf)}arraybuffer(){return me(this,null,function*(){return this.buf instanceof ArrayBuffer||(this.buf=yield this.buf.async("arraybuffer")),this.buf})}makeSync(){return me(this,null,function*(){yield this.arraybuffer()})}write(e){this.buf=e}bufferSync(){if(this.buf instanceof ArrayBuffer)return this.buf;throw Error(`\u0424\u0430\u0439\u043B ${this.pathDos} \u043D\u0435 \u0431\u044B\u043B \u043F\u0440\u0435\u0434\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D.`)}read(e,t){const r=new ir(e,this.pathDos);switch(t){case"prj":return qh(r);case"cls":return new qi(r);case"stt":return Jh(r);case"vdr":return Ur(r,{origin:"file",name:this.pathDos});case"mat":return Yh(r);case"bmp":return zi(r);case"dbm":return nr(r)}}readAs(e){return me(this,null,function*(){const t=yield this.arraybuffer();return this.read(t,e)})}readSyncAs(e){const t=this.bufferSync();try{return this.read(t,e)}catch(r){this.warnShowed||(console.warn(`${this.pathDos}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${r.message}`),this.warnShowed=!0);return}}}function Qh(e,t){return ve.fromZip(e,t)}return Hi();})();
