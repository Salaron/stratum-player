<head>
    <meta charset="utf-8" />
    <script src="stratum.js"></script>
    <script>
        let player;
        const stdlibPromise = StratumPlayer.loadLibraryFromUrl("/data/library.zip");
        window.onload = () => {
            const canvas = document.getElementById("canvas");
            canvas.width = window.innerWidth - 40;
            canvas.height = window.innerHeight - 100;
            document.getElementById("file_drop").addEventListener("change", e => play("file", e.target.files));
            document.getElementById("combobox").addEventListener("change", e => play("ref", e.target.value));
        };
        async function play(type, value) {
            const projectFile = document.getElementById("proj_name").value || "project.spj";
            if (!value) return;
            const preloadedLibs = await stdlibPromise;
            console.log("Стандартная библиотека имиджей загружена");
            const globalCanvas = document.getElementById("canvas");
            const htmlRoot = document.getElementById("root");
            const contoller = document.getElementById("controller");
            const one_step = document.getElementById("one_step");
            controller.removeAttribute("hidden");
            one_step.removeAttribute("hidden");
            const opts = { globalCanvas, htmlRoot, preloadedLibs, projectFile, continueOnErrorCallback: () => true };
            const getPlayer = type === "file" ? StratumPlayer.fromFileList(value, opts) : StratumPlayer.fromUrl(`projects/${value}.zip`, opts);
            getPlayer.then(p => {
                controller.innerHTML = "Пауза";
                if (player) player.pause();
                player = p;
                if (!player) return;
                p.on("WINDOW_CREATED", name => (document.title = name));
                let playing = true;
                controller.addEventListener("click", () => {
                    if (playing) player.pause();
                    else player.play();
                    controller.innerHTML = playing ? "Продолжить" : "Пауза";
                    playing = !playing;
                });
                one_step.addEventListener("click", () => {
                    player.oneStep();
                    controller.innerHTML = "Продолжить";
                    playing = false;
                });
                return player.play();
            })
            .catch(e => {
                console.error(e);
                alert("Возникли ошибки, см. в консоли (F12)");
            });
        }
    </script>
</head>
<body>
    <input id="file_drop" type="file" accept=".zip" />
    <button id="one_step" hidden style="height: 50px">Один шаг</button>
    <button id="controller" hidden style="height: 50px">Пауза</button>
    <input id="proj_name" type="text" placeholder="название файла проекта"></input>
    <select id="combobox">
        <option value="" disabled selected>Выберите проект</option>
        <option value="myach">Интерактивная физика - мяч</option>
        <option value="balls">Много мячиков</option>
        <option value="balls2">Мячики</option>
        <option value="sqr">Квадратное уравнение</option>
        <option value="25d">2,5d</option>
        <option value="solar">Солнечная система</option>
      </select>
    <div id="root" style="position:relative;">
        <canvas id="canvas" width="900" height="900" style="border:1px solid #000000;"></canvas>
    </div>
</body>
