var stratum=(()=>{var Hh=Object.create,ui=Object.defineProperty,Wh=Object.getPrototypeOf,zh=Object.prototype.hasOwnProperty,Xh=Object.getOwnPropertyNames,Yh=Object.getOwnPropertyDescriptor,Q=Object.assign,qa=e=>ui(e,"__esModule",{value:!0}),te=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),qh=(e,t)=>{qa(e);for(var r in t)ui(e,r,{get:t[r],enumerable:!0})},Zh=(e,t)=>{if(qa(e),typeof t=="object"||typeof t=="function")for(let r of Xh(t))!zh.call(e,r)&&r!=="default"&&ui(e,r,{get:()=>t[r],enumerable:Yh(t,r).enumerable});return e},Dt=e=>e&&e.__esModule?e:Zh(ui(Hh(Wh(e)),"default",{value:e,enumerable:!0}),e),it=(e,t,r)=>new Promise((i,n)=>{var a=c=>{try{o(r.next(c))}catch(l){n(l)}},s=c=>{try{o(r.throw(c))}catch(l){n(l)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,s);o((r=r.apply(e,t)).next())}),Ka=te((Xv,Za)=>{Za.exports=Oe;function Oe(e){if(e)return Kh(e)}function Kh(e){for(var t in Oe.prototype)e[t]=Oe.prototype[t];return e}Oe.prototype.on=Oe.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this};Oe.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function i(){r.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this};Oe.prototype.off=Oe.prototype.removeListener=Oe.prototype.removeAllListeners=Oe.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(arguments.length==1)return delete this._callbacks[e],this;for(var i,n=0;n<r.length;n++)if(i=r[n],i===t||i.fn===t){r.splice(n,1);break}return this};Oe.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var i=0,n=r.length;i<n;++i)r[i].apply(this,t)}return this};Oe.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]};Oe.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),Qa=te((Yv,Ja)=>{var $a=Ka();function Er(){$a.call(this)}Er.prototype=new $a;Ja.exports=Er;Er.Stream=Er;Er.prototype.pipe=function(e,t){var r=this;function i(h){e.writable&&(e.write(h)===!1&&r.pause&&r.pause())}r.on("data",i);function n(){r.readable&&r.resume&&r.resume()}e.on("drain",n),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",s),r.on("close",o));var a=!1;function s(){if(a)return;a=!0,e.end()}function o(){if(a)return;a=!0,typeof e.destroy=="function"&&e.destroy()}function c(h){if(l(),!this.hasListeners("error"))throw h}r.on("error",c),e.on("error",c);function l(){r.off("data",i),e.off("drain",n),r.off("end",s),r.off("close",o),r.off("error",c),e.off("error",c),r.off("end",l),r.off("close",l),e.off("end",l),e.off("close",l)}return r.on("end",l),r.on("close",l),e.on("end",l),e.on("close",l),e.emit("pipe",r),e}}),cn=te((qv,eo)=>{eo.exports=Qa()}),nt=te(Ie=>{"use strict";Ie.base64=!0;Ie.array=!0;Ie.string=!0;Ie.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined";Ie.nodebuffer=typeof Buffer!="undefined";Ie.uint8array=typeof Uint8Array!="undefined";if(typeof ArrayBuffer=="undefined")Ie.blob=!1;else{var to=new ArrayBuffer(0);try{Ie.blob=new Blob([to],{type:"application/zip"}).size===0}catch(e){try{var Jh=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,ro=new Jh;ro.append(to),Ie.blob=ro.getBlob("application/zip").size===0}catch(t){Ie.blob=!1}}}try{Ie.nodestream=!!cn().Readable}catch(e){Ie.nodestream=!1}}),un=te(hn=>{"use strict";var $h=de(),Qh=nt(),qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";hn.encode=function(e){for(var t=[],r,i,n,a,s,o,c,l=0,h=e.length,u=h,f=$h.getTypeOf(e)!=="string";l<e.length;)u=h-l,f?(r=e[l++],i=l<h?e[l++]:0,n=l<h?e[l++]:0):(r=e.charCodeAt(l++),i=l<h?e.charCodeAt(l++):0,n=l<h?e.charCodeAt(l++):0),a=r>>2,s=(r&3)<<4|i>>4,o=u>1?(i&15)<<2|n>>6:64,c=u>2?n&63:64,t.push(qe.charAt(a)+qe.charAt(s)+qe.charAt(o)+qe.charAt(c));return t.join("")};hn.decode=function(e){var t,r,i,n,a,s,o,c=0,l=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var u=e.length*3/4;if(e.charAt(e.length-1)===qe.charAt(64)&&u--,e.charAt(e.length-2)===qe.charAt(64)&&u--,u%1!==0)throw new Error("Invalid base64 input, bad content length.");var f;for(Qh.uint8array?f=new Uint8Array(u|0):f=new Array(u|0);c<e.length;)n=qe.indexOf(e.charAt(c++)),a=qe.indexOf(e.charAt(c++)),s=qe.indexOf(e.charAt(c++)),o=qe.indexOf(e.charAt(c++)),t=n<<2|a>>4,r=(a&15)<<4|s>>2,i=(s&3)<<6|o,f[l++]=t,s!==64&&(f[l++]=r),o!==64&&(f[l++]=i);return f}}),Cr=te((Jv,io)=>{"use strict";io.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}}),ao=te(($v,no)=>{"use strict";no.exports=typeof setImmediate=="function"?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}),uo=te((Qv,oo)=>{"use strict";var so=global.MutationObserver||global.WebKitMutationObserver,Ar;if(so){var lo=0,eu=new so(fi),co=global.document.createTextNode("");eu.observe(co,{characterData:!0}),Ar=function(){co.data=lo=++lo%2}}else if(!global.setImmediate&&typeof global.MessageChannel!="undefined"){var ho=new global.MessageChannel;ho.port1.onmessage=fi,Ar=function(){ho.port2.postMessage(0)}}else"document"in global&&"onreadystatechange"in global.document.createElement("script")?Ar=function(){var e=global.document.createElement("script");e.onreadystatechange=function(){fi(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:Ar=function(){setTimeout(fi,0)};var fn,Dr=[];function fi(){fn=!0;for(var e,t,r=Dr.length;r;){for(t=Dr,Dr=[],e=-1;++e<r;)t[e]();r=Dr.length}fn=!1}oo.exports=tu;function tu(e){Dr.push(e)===1&&!fn&&Ar()}}),vo=te((ey,fo)=>{"use strict";var ru=uo();function Zt(){}var Te={},po=["REJECTED"],dn=["FULFILLED"],mo=["PENDING"];fo.exports=ht;function ht(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=mo,this.queue=[],this.outcome=void 0,e!==Zt&&go(this,e)}ht.prototype.finally=function(e){if(typeof e!="function")return this;var t=this.constructor;return this.then(r,i);function r(n){function a(){return n}return t.resolve(e()).then(a)}function i(n){function a(){throw n}return t.resolve(e()).then(a)}};ht.prototype.catch=function(e){return this.then(null,e)};ht.prototype.then=function(e,t){if(typeof e!="function"&&this.state===dn||typeof t!="function"&&this.state===po)return this;var r=new this.constructor(Zt);if(this.state!==mo){var i=this.state===dn?e:t;pn(r,i,this.outcome)}else this.queue.push(new Or(r,e,t));return r};function Or(e,t,r){this.promise=e,typeof t=="function"&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),typeof r=="function"&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}Or.prototype.callFulfilled=function(e){Te.resolve(this.promise,e)};Or.prototype.otherCallFulfilled=function(e){pn(this.promise,this.onFulfilled,e)};Or.prototype.callRejected=function(e){Te.reject(this.promise,e)};Or.prototype.otherCallRejected=function(e){pn(this.promise,this.onRejected,e)};function pn(e,t,r){ru(function(){var i;try{i=t(r)}catch(n){return Te.reject(e,n)}i===e?Te.reject(e,new TypeError("Cannot resolve promise with itself")):Te.resolve(e,i)})}Te.resolve=function(e,t){var r=bo(iu,t);if(r.status==="error")return Te.reject(e,r.value);var i=r.value;if(i)go(e,i);else{e.state=dn,e.outcome=t;for(var n=-1,a=e.queue.length;++n<a;)e.queue[n].callFulfilled(t)}return e};Te.reject=function(e,t){e.state=po,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callRejected(t);return e};function iu(e){var t=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof t=="function")return function(){t.apply(e,arguments)}}function go(e,t){var r=!1;function i(o){if(r)return;r=!0,Te.reject(e,o)}function n(o){if(r)return;r=!0,Te.resolve(e,o)}function a(){t(n,i)}var s=bo(a);s.status==="error"&&i(s.value)}function bo(e,t){var r={};try{r.value=e(t),r.status="success"}catch(i){r.status="error",r.value=i}return r}ht.resolve=nu;function nu(e){return e instanceof this?e:Te.resolve(new this(Zt),e)}ht.reject=au;function au(e){var t=new this(Zt);return Te.reject(t,e)}ht.all=ou;function ou(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var n=new Array(r),a=0,s=-1,o=new this(Zt);++s<r;)c(e[s],s);return o;function c(l,h){t.resolve(l).then(u,function(f){i||(i=!0,Te.reject(o,f))});function u(f){n[h]=f,++a===r&&!i&&(i=!0,Te.resolve(o,n))}}}ht.race=su;function su(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var n=-1,a=new this(Zt);++n<r;)s(e[n]);return a;function s(o){t.resolve(o).then(function(c){i||(i=!0,Te.resolve(a,c))},function(c){i||(i=!0,Te.reject(a,c))})}}}),Kt=te((ty,yo)=>{"use strict";var mn=null;typeof Promise!="undefined"?mn=Promise:mn=vo();yo.exports={Promise:mn}}),de=te(be=>{"use strict";var ut=nt(),lu=un(),Jt=Cr(),cu=ao(),gn=Kt();function hu(e){var t=null;return ut.uint8array?t=new Uint8Array(e.length):t=new Array(e.length),di(e,t)}be.newBlob=function(e,t){be.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,i=new r;return i.append(e),i.getBlob(t)}catch(a){throw new Error("Bug : can't construct the Blob.")}}};function Ir(e){return e}function di(e,t){for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)&255;return t}var pi={stringifyByChunk:function(e,t,r){var i=[],n=0,a=e.length;if(a<=r)return String.fromCharCode.apply(null,e);for(;n<a;)t==="array"||t==="nodebuffer"?i.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+r,a)))):i.push(String.fromCharCode.apply(null,e.subarray(n,Math.min(n+r,a)))),n+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return ut.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return!1}}(),nodebuffer:function(){try{return ut.nodebuffer&&String.fromCharCode.apply(null,Jt.allocBuffer(1)).length===1}catch(e){return!1}}()}};function Rr(e){var t=65536,r=be.getTypeOf(e),i=!0;if(r==="uint8array"?i=pi.applyCanBeUsed.uint8array:r==="nodebuffer"&&(i=pi.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return pi.stringifyByChunk(e,r,t)}catch(n){t=Math.floor(t/2)}return pi.stringifyByChar(e)}be.applyFromCharCode=Rr;function mi(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var ft={};ft.string={string:Ir,array:function(e){return di(e,new Array(e.length))},arraybuffer:function(e){return ft.string.uint8array(e).buffer},uint8array:function(e){return di(e,new Uint8Array(e.length))},nodebuffer:function(e){return di(e,Jt.allocBuffer(e.length))}};ft.array={string:Rr,array:Ir,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Jt.newBufferFrom(e)}};ft.arraybuffer={string:function(e){return Rr(new Uint8Array(e))},array:function(e){return mi(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:Ir,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Jt.newBufferFrom(new Uint8Array(e))}};ft.uint8array={string:Rr,array:function(e){return mi(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:Ir,nodebuffer:function(e){return Jt.newBufferFrom(e)}};ft.nodebuffer={string:Rr,array:function(e){return mi(e,new Array(e.length))},arraybuffer:function(e){return ft.nodebuffer.uint8array(e).buffer},uint8array:function(e){return mi(e,new Uint8Array(e.length))},nodebuffer:Ir};be.transformTo=function(e,t){if(t||(t=""),!e)return t;be.checkSupport(e);var r=be.getTypeOf(t),i=ft[r][e](t);return i};be.getTypeOf=function(e){if(typeof e=="string")return"string";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(ut.nodebuffer&&Jt.isBuffer(e))return"nodebuffer";if(ut.uint8array&&e instanceof Uint8Array)return"uint8array";if(ut.arraybuffer&&e instanceof ArrayBuffer)return"arraybuffer"};be.checkSupport=function(e){var t=ut[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")};be.MAX_VALUE_16BITS=65535;be.MAX_VALUE_32BITS=-1;be.pretty=function(e){var t="",r,i;for(i=0;i<(e||"").length;i++)r=e.charCodeAt(i),t+="\\x"+(r<16?"0":"")+r.toString(16).toUpperCase();return t};be.delay=function(e,t,r){cu(function(){e.apply(r||null,t||[])})};be.inherits=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r};be.extend=function(){var e={},t,r;for(t=0;t<arguments.length;t++)for(r in arguments[t])arguments[t].hasOwnProperty(r)&&typeof e[r]=="undefined"&&(e[r]=arguments[t][r]);return e};be.prepareContent=function(e,t,r,i,n){var a=gn.Promise.resolve(t).then(function(s){var o=ut.blob&&(s instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(s))!==-1);return o&&typeof FileReader!="undefined"?new gn.Promise(function(c,l){var h=new FileReader;h.onload=function(u){c(u.target.result)},h.onerror=function(u){l(u.target.error)},h.readAsArrayBuffer(s)}):s});return a.then(function(s){var o=be.getTypeOf(s);return o?(o==="arraybuffer"?s=be.transformTo("uint8array",s):o==="string"&&(n?s=lu.decode(s):r&&(i!==!0&&(s=hu(s)))),s):gn.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}}),Re=te((iy,_o)=>{"use strict";function wo(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}wo.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.end()}),e.on("error",function(r){t.error(r)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(e))continue;this.streamInfo[e]=this.extraStreamInfo[e]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}};_o.exports=wo}),It=te(dt=>{"use strict";var $t=de(),Ot=nt(),uu=Cr(),gi=Re(),jr=new Array(256);for(var pt=0;pt<256;pt++)jr[pt]=pt>=252?6:pt>=248?5:pt>=240?4:pt>=224?3:pt>=192?2:1;jr[254]=jr[254]=1;var fu=function(e){var t,r,i,n,a,s=e.length,o=0;for(n=0;n<s;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(Ot.uint8array?t=new Uint8Array(o):t=new Array(o),a=0,n=0;a<o;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|r&63):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|r&63):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|r&63);return t},du=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+jr[e[r]]>t?r:t},pu=function(e){var t,r,i,n,a,s=e.length,o=new Array(s*2);for(i=0,r=0;r<s;){if(n=e[r++],n<128){o[i++]=n;continue}if(a=jr[n],a>4){o[i++]=65533,r+=a-1;continue}for(n&=a===2?31:a===3?15:7;a>1&&r<s;)n=n<<6|e[r++]&63,a--;if(a>1){o[i++]=65533;continue}n<65536?o[i++]=n:(n-=65536,o[i++]=55296|n>>10&1023,o[i++]=56320|n&1023)}return o.length!==i&&(o.subarray?o=o.subarray(0,i):o.length=i),$t.applyFromCharCode(o)};dt.utf8encode=function(t){return Ot.nodebuffer?uu.newBufferFrom(t,"utf-8"):fu(t)};dt.utf8decode=function(t){return Ot.nodebuffer?$t.transformTo("nodebuffer",t).toString("utf-8"):(t=$t.transformTo(Ot.uint8array?"uint8array":"array",t),pu(t))};function bi(){gi.call(this,"utf-8 decode"),this.leftOver=null}$t.inherits(bi,gi);bi.prototype.processChunk=function(e){var t=$t.transformTo(Ot.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(Ot.uint8array){var r=t;t=new Uint8Array(r.length+this.leftOver.length),t.set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=du(t),n=t;i!==t.length&&(Ot.uint8array?(n=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(n=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:dt.utf8decode(n),meta:e.meta})};bi.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:dt.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};dt.Utf8DecodeWorker=bi;function bn(){gi.call(this,"utf-8 encode")}$t.inherits(bn,gi);bn.prototype.processChunk=function(e){this.push({data:dt.utf8encode(e.data),meta:e.meta})};dt.Utf8EncodeWorker=bn}),Eo=te((ay,So)=>{"use strict";var To=Re(),xo=de();function vn(e){To.call(this,"ConvertWorker to "+e),this.destType=e}xo.inherits(vn,To);vn.prototype.processChunk=function(e){this.push({data:xo.transformTo(this.destType,e.data),meta:e.meta})};So.exports=vn}),Do=te((oy,Co)=>{"use strict";var Ao=cn().Readable,mu=de();mu.inherits(yn,Ao);function yn(e,t,r){Ao.call(this,t),this._helper=e;var i=this;e.on("data",function(n,a){i.push(n)||i._helper.pause(),r&&r(a)}).on("error",function(n){i.emit("error",n)}).on("end",function(){i.push(null)})}yn.prototype._read=function(){this._helper.resume()};Co.exports=yn}),_n=te((sy,Oo)=>{"use strict";var Rt=de(),gu=Eo(),bu=Re(),vu=un(),yu=nt(),_u=Kt(),Io=null;if(yu.nodestream)try{Io=Do()}catch(e){}function wu(e,t,r){switch(e){case"blob":return Rt.newBlob(Rt.transformTo("arraybuffer",t),r);case"base64":return vu.encode(t);default:return Rt.transformTo(e,t)}}function Su(e,t){var r,i=0,n=null,a=0;for(r=0;r<t.length;r++)a+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(a),r=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;return n;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function Tu(e,t){return new _u.Promise(function(r,i){var n=[],a=e._internalType,s=e._outputType,o=e._mimeType;e.on("data",function(c,l){n.push(c),t&&t(l)}).on("error",function(c){n=[],i(c)}).on("end",function(){try{var c=wu(s,Su(a,n),o);r(c)}catch(l){i(l)}n=[]}).resume()})}function Ro(e,t,r){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string";break}try{this._internalType=i,this._outputType=t,this._mimeType=r,Rt.checkSupport(i),this._worker=e.pipe(new gu(i)),e.lock()}catch(n){this._worker=new bu("error"),this._worker.error(n)}}Ro.prototype={accumulate:function(e){return Tu(this,e)},on:function(e,t){var r=this;return e==="data"?this._worker.on(e,function(i){t.call(r,i.data,i.meta)}):this._worker.on(e,function(){Rt.delay(t,arguments,r)}),this},resume:function(){return Rt.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(Rt.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new Io(this,{objectMode:this._outputType!=="nodebuffer"},e)}};Oo.exports=Ro}),wn=te(Ve=>{"use strict";Ve.base64=!1;Ve.binary=!1;Ve.dir=!1;Ve.createFolders=!0;Ve.date=null;Ve.compression=null;Ve.compressionOptions=null;Ve.comment=null;Ve.unixPermissions=null;Ve.dosPermissions=null}),Sn=te((cy,jo)=>{"use strict";var vi=de(),yi=Re(),xu=16*1024;function Qt(e){yi.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(r){t.dataIsReady=!0,t.data=r,t.max=r&&r.length||0,t.type=vi.getTypeOf(r),t.isPaused||t._tickAndRepeat()},function(r){t.error(r)})}vi.inherits(Qt,yi);Qt.prototype.cleanUp=function(){yi.prototype.cleanUp.call(this),this.data=null};Qt.prototype.resume=function(){return yi.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,vi.delay(this._tickAndRepeat,[],this)),!0):!1};Qt.prototype._tickAndRepeat=function(){if(this._tickScheduled=!1,this.isPaused||this.isFinished)return;this._tick(),this.isFinished||(vi.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)};Qt.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=xu,t=null,r=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,r);break;case"uint8array":t=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":t=this.data.slice(this.index,r);break}return this.index=r,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};jo.exports=Qt}),En=te((hy,ko)=>{"use strict";var Eu=de(),Tn=Re();function xn(e){Tn.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}Eu.inherits(xn,Tn);xn.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}Tn.prototype.processChunk.call(this,e)};ko.exports=xn}),_i=te((uy,Lo)=>{"use strict";var Cu=de();function Au(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var No=Au();function Du(e,t,r,i){var n=No,a=i+r;e=e^-1;for(var s=i;s<a;s++)e=e>>>8^n[(e^t[s])&255];return e^-1}function Ou(e,t,r,i){var n=No,a=i+r;e=e^-1;for(var s=i;s<a;s++)e=e>>>8^n[(e^t.charCodeAt(s))&255];return e^-1}Lo.exports=function(t,r){if(typeof t=="undefined"||!t.length)return 0;var i=Cu.getTypeOf(t)!=="string";return i?Du(r|0,t,t.length,0):Ou(r|0,t,t.length,0)}}),An=te((fy,Po)=>{"use strict";var Mo=Re(),Iu=_i(),Ru=de();function Cn(){Mo.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Ru.inherits(Cn,Mo);Cn.prototype.processChunk=function(e){this.streamInfo.crc32=Iu(e.data,this.streamInfo.crc32||0),this.push(e)};Po.exports=Cn}),Si=te((dy,Bo)=>{"use strict";var Fo=Kt(),Go=Sn(),wi=En(),ju=An(),wi=En();function Dn(e,t,r,i,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=n}Dn.prototype={getContentWorker:function(){var e=new Go(Fo.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new wi("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new Go(Fo.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};Dn.createWorkerFrom=function(e,t,r){return e.pipe(new ju).pipe(new wi("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new wi("compressedSize")).withStreamInfo("compression",t)};Bo.exports=Dn}),Wo=te((py,Vo)=>{"use strict";var ku=_n(),Lu=Sn(),On=It(),In=Si(),Uo=Re(),Rn=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};Rn.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");r=e.toLowerCase();var i=r==="string"||r==="text";(r==="binarystring"||r==="text")&&(r="string"),t=this._decompressWorker();var n=!this._dataBinary;n&&!i&&(t=t.pipe(new On.Utf8EncodeWorker)),!n&&i&&(t=t.pipe(new On.Utf8DecodeWorker))}catch(a){t=new Uo("error"),t.error(a)}return new ku(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof In&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new On.Utf8EncodeWorker)),In.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof In?this._data.getContentWorker():this._data instanceof Uo?this._data:new Lu(this._data)}};var Ho=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Nu=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var jn=0;jn<Ho.length;jn++)Rn.prototype[Ho[jn]]=Nu;Vo.exports=Rn}),at=te(Ee=>{"use strict";var Pu=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function Mu(e,t){return Object.prototype.hasOwnProperty.call(e,t)}Ee.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(!r)continue;if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var i in r)Mu(r,i)&&(e[i]=r[i])}return e};Ee.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var Bu={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),n);return}for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){var t,r,i,n,a,s;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(s=new Uint8Array(i),n=0,t=0,r=e.length;t<r;t++)a=e[t],s.set(a,n),n+=a.length;return s}},Fu={arraySet:function(e,t,r,i,n){for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};Ee.setTyped=function(e){e?(Ee.Buf8=Uint8Array,Ee.Buf16=Uint16Array,Ee.Buf32=Int32Array,Ee.assign(Ee,Bu)):(Ee.Buf8=Array,Ee.Buf16=Array,Ee.Buf32=Array,Ee.assign(Ee,Fu))};Ee.setTyped(Pu)}),ds=te(er=>{"use strict";var Gu=at(),Vu=4,zo=0,Xo=1,Uu=2;function tr(e){for(var t=e.length;--t>=0;)e[t]=0}var Hu=0,Yo=1,Wu=2,zu=3,Xu=258,kn=29,kr=256,Lr=kr+1+kn,rr=30,Ln=19,qo=2*Lr+1,jt=15,Nn=16,Yu=7,Pn=256,Zo=16,Ko=17,Jo=18,Mn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ti=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],qu=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$o=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Zu=512,ot=new Array((Lr+2)*2);tr(ot);var Nr=new Array(rr*2);tr(Nr);var Pr=new Array(Zu);tr(Pr);var Mr=new Array(Xu-zu+1);tr(Mr);var Bn=new Array(kn);tr(Bn);var xi=new Array(rr);tr(xi);function Fn(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}var Qo,es,ts;function Gn(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function rs(e){return e<256?Pr[e]:Pr[256+(e>>>7)]}function Br(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function De(e,t,r){e.bi_valid>Nn-r?(e.bi_buf|=t<<e.bi_valid&65535,Br(e,e.bi_buf),e.bi_buf=t>>Nn-e.bi_valid,e.bi_valid+=r-Nn):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function Ze(e,t,r){De(e,r[t*2],r[t*2+1])}function is(e,t){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1}function Ku(e){e.bi_valid===16?(Br(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function Ju(e,t){var r=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,h,u,f,d,m,g=0;for(f=0;f<=jt;f++)e.bl_count[f]=0;for(r[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<qo;l++){if(h=e.heap[l],f=r[r[h*2+1]*2+1]+1,f>c&&(f=c,g++),r[h*2+1]=f,h>i)continue;e.bl_count[f]++,d=0,h>=o&&(d=s[h-o]),m=r[h*2],e.opt_len+=m*(f+d),a&&(e.static_len+=m*(n[h*2+1]+d))}if(g===0)return;do{for(f=c-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(f=c;f!==0;f--)for(h=e.bl_count[f];h!==0;){if(u=e.heap[--l],u>i)continue;r[u*2+1]!==f&&(e.opt_len+=(f-r[u*2+1])*r[u*2],r[u*2+1]=f),h--}}function ns(e,t,r){var i=new Array(jt+1),n=0,a,s;for(a=1;a<=jt;a++)i[a]=n=n+r[a-1]<<1;for(s=0;s<=t;s++){var o=e[s*2+1];if(o===0)continue;e[s*2]=is(i[o]++,o)}}function $u(){var e,t,r,i,n,a=new Array(jt+1);for(r=0,i=0;i<kn-1;i++)for(Bn[i]=r,e=0;e<1<<Mn[i];e++)Mr[r++]=i;for(Mr[r-1]=i,n=0,i=0;i<16;i++)for(xi[i]=n,e=0;e<1<<Ti[i];e++)Pr[n++]=i;for(n>>=7;i<rr;i++)for(xi[i]=n<<7,e=0;e<1<<Ti[i]-7;e++)Pr[256+n++]=i;for(t=0;t<=jt;t++)a[t]=0;for(e=0;e<=143;)ot[e*2+1]=8,e++,a[8]++;for(;e<=255;)ot[e*2+1]=9,e++,a[9]++;for(;e<=279;)ot[e*2+1]=7,e++,a[7]++;for(;e<=287;)ot[e*2+1]=8,e++,a[8]++;for(ns(ot,Lr+1,a),e=0;e<rr;e++)Nr[e*2+1]=5,Nr[e*2]=is(e,5);Qo=new Fn(ot,Mn,kr+1,Lr,jt),es=new Fn(Nr,Ti,0,rr,jt),ts=new Fn(new Array(0),qu,0,Ln,Yu)}function as(e){var t;for(t=0;t<Lr;t++)e.dyn_ltree[t*2]=0;for(t=0;t<rr;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Ln;t++)e.bl_tree[t*2]=0;e.dyn_ltree[Pn*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function os(e){e.bi_valid>8?Br(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Qu(e,t,r,i){os(e),i&&(Br(e,r),Br(e,~r)),Gu.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function ss(e,t,r,i){var n=t*2,a=r*2;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]}function Vn(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&!(n<e.heap_len&&ss(t,e.heap[n+1],e.heap[n],e.depth)&&n++,ss(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function ls(e,t,r){var i,n,a=0,s,o;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1],n=e.pending_buf[e.l_buf+a],a++,i===0?Ze(e,n,t):(s=Mr[n],Ze(e,s+kr+1,t),o=Mn[s],o!==0&&(n-=Bn[s],De(e,n,o)),i--,s=rs(i),Ze(e,s,r),o=Ti[s],o!==0&&(i-=xi[s],De(e,i,o)));while(a<e.last_lit);Ze(e,Pn,t)}function Un(e,t){var r=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,a=t.stat_desc.elems,s,o,c=-1,l;for(e.heap_len=0,e.heap_max=qo,s=0;s<a;s++)r[s*2]!==0?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):r[s*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[l*2]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=i[l*2+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)Vn(e,r,s);l=a;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Vn(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[l*2]=r[s*2]+r[o*2],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[s*2+1]=r[o*2+1]=l,e.heap[1]=l++,Vn(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Ju(e,t),ns(r,c,e.bl_count)}function cs(e,t,r){var i,n=-1,a,s=t[0*2+1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),t[(r+1)*2+1]=65535,i=0;i<=r;i++){if(a=s,s=t[(i+1)*2+1],++o<c&&a===s)continue;o<l?e.bl_tree[a*2]+=o:a!==0?(a!==n&&e.bl_tree[a*2]++,e.bl_tree[Zo*2]++):o<=10?e.bl_tree[Ko*2]++:e.bl_tree[Jo*2]++,o=0,n=a,s===0?(c=138,l=3):a===s?(c=6,l=3):(c=7,l=4)}}function hs(e,t,r){var i,n=-1,a,s=t[0*2+1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),i=0;i<=r;i++){if(a=s,s=t[(i+1)*2+1],++o<c&&a===s)continue;if(o<l)do Ze(e,a,e.bl_tree);while(--o!==0);else a!==0?(a!==n&&(Ze(e,a,e.bl_tree),o--),Ze(e,Zo,e.bl_tree),De(e,o-3,2)):o<=10?(Ze(e,Ko,e.bl_tree),De(e,o-3,3)):(Ze(e,Jo,e.bl_tree),De(e,o-11,7));o=0,n=a,s===0?(c=138,l=3):a===s?(c=6,l=3):(c=7,l=4)}}function ef(e){var t;for(cs(e,e.dyn_ltree,e.l_desc.max_code),cs(e,e.dyn_dtree,e.d_desc.max_code),Un(e,e.bl_desc),t=Ln-1;t>=3&&!(e.bl_tree[$o[t]*2+1]!==0);t--);return e.opt_len+=3*(t+1)+5+5+4,t}function tf(e,t,r,i){var n;for(De(e,t-257,5),De(e,r-1,5),De(e,i-4,4),n=0;n<i;n++)De(e,e.bl_tree[$o[n]*2+1],3);hs(e,e.dyn_ltree,t-1),hs(e,e.dyn_dtree,r-1)}function rf(e){var t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return zo;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Xo;for(r=32;r<kr;r++)if(e.dyn_ltree[r*2]!==0)return Xo;return zo}var us=!1;function nf(e){us||($u(),us=!0),e.l_desc=new Gn(e.dyn_ltree,Qo),e.d_desc=new Gn(e.dyn_dtree,es),e.bl_desc=new Gn(e.bl_tree,ts),e.bi_buf=0,e.bi_valid=0,as(e)}function fs(e,t,r,i){De(e,(Hu<<1)+(i?1:0),3),Qu(e,t,r,!0)}function af(e){De(e,Yo<<1,3),Ze(e,Pn,ot),Ku(e)}function of(e,t,r,i){var n,a,s=0;e.level>0?(e.strm.data_type===Uu&&(e.strm.data_type=rf(e)),Un(e,e.l_desc),Un(e,e.d_desc),s=ef(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=n&&(n=a)):n=a=r+5,r+4<=n&&t!==-1?fs(e,t,r,i):e.strategy===Vu||a===n?(De(e,(Yo<<1)+(i?1:0),3),ls(e,ot,Nr)):(De(e,(Wu<<1)+(i?1:0),3),tf(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),ls(e,e.dyn_ltree,e.dyn_dtree)),as(e),i&&os(e)}function sf(e,t,r){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(Mr[r]+kr+1)*2]++,e.dyn_dtree[rs(t)*2]++),e.last_lit===e.lit_bufsize-1}er._tr_init=nf;er._tr_stored_block=fs;er._tr_flush_block=of;er._tr_tally=sf;er._tr_align=af}),Hn=te((by,ps)=>{"use strict";function lf(e,t,r,i){for(var n=e&65535|0,a=e>>>16&65535|0,s=0;r!==0;){s=r>2e3?2e3:r,r-=s;do n=n+t[i++]|0,a=a+n|0;while(--s);n%=65521,a%=65521}return n|a<<16|0}ps.exports=lf}),Wn=te((vy,ms)=>{"use strict";function cf(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var hf=cf();function uf(e,t,r,i){var n=hf,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^n[(e^t[s])&255];return e^-1}ms.exports=uf}),Ei=te((yy,gs)=>{"use strict";gs.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),Es=te(Ke=>{"use strict";var Ce=at(),ke=ds(),bs=Hn(),mt=Wn(),ff=Ei(),kt=0,df=1,pf=3,gt=4,vs=5,Je=0,ys=1,Le=-2,mf=-3,zn=-5,gf=-1,bf=1,Ci=2,vf=3,yf=4,_f=0,wf=2,Ai=8,Sf=9,Tf=15,xf=8,Ef=29,Cf=256,Xn=Cf+1+Ef,Af=30,Df=19,Of=2*Xn+1,If=15,se=3,bt=258,Ue=bt+se+1,Rf=32,Di=42,Yn=69,Oi=73,Ii=91,Ri=103,Lt=113,Fr=666,ve=1,Gr=2,Nt=3,ir=4,jf=3;function vt(e,t){return e.msg=ff[t],t}function _s(e){return(e<<1)-(e>4?9:0)}function yt(e){for(var t=e.length;--t>=0;)e[t]=0}function _t(e){var t=e.state,r=t.pending;if(r>e.avail_out&&(r=e.avail_out),r===0)return;Ce.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0)}function we(e,t){ke._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_t(e.strm)}function le(e,t){e.pending_buf[e.pending++]=t}function Vr(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function kf(e,t,r,i){var n=e.avail_in;return n>i&&(n=i),n===0?0:(e.avail_in-=n,Ce.arraySet(t,e.input,e.next_in,n,r),e.state.wrap===1?e.adler=bs(e.adler,t,n,r):e.state.wrap===2&&(e.adler=mt(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)}function ws(e,t){var r=e.max_chain_length,i=e.strstart,n,a,s=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-Ue?e.strstart-(e.w_size-Ue):0,l=e.window,h=e.w_mask,u=e.prev,f=e.strstart+bt,d=l[i+s-1],m=l[i+s];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,l[n+s]!==m||l[n+s-1]!==d||l[n]!==l[i]||l[++n]!==l[i+1])continue;i+=2,n++;do;while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<f);if(a=bt-(f-i),i=f-bt,a>s){if(e.match_start=t,s=a,a>=o)break;d=l[i+s-1],m=l[i+s]}}while((t=u[t&h])>c&&--r!==0);return s<=e.lookahead?s:e.lookahead}function Pt(e){var t=e.w_size,r,i,n,a,s;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ue)){Ce.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,r=i;do n=e.head[--r],e.head[r]=n>=t?n-t:0;while(--i);i=t,r=i;do n=e.prev[--r],e.prev[r]=n>=t?n-t:0;while(--i);a+=t}if(e.strm.avail_in===0)break;if(i=kf(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=i,e.lookahead+e.insert>=se)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&!(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+se-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,e.lookahead+e.insert<se););}while(e.lookahead<Ue&&e.strm.avail_in!==0)}function Lf(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Pt(e),e.lookahead===0&&t===kt)return ve;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,we(e,!1),e.strm.avail_out===0))return ve;if(e.strstart-e.block_start>=e.w_size-Ue&&(we(e,!1),e.strm.avail_out===0))return ve}return e.insert=0,t===gt?(we(e,!0),e.strm.avail_out===0?Nt:ir):(e.strstart>e.block_start&&(we(e,!1),e.strm.avail_out===0),ve)}function qn(e,t){for(var r,i;;){if(e.lookahead<Ue){if(Pt(e),e.lookahead<Ue&&t===kt)return ve;if(e.lookahead===0)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Ue&&(e.match_length=ws(e,r)),e.match_length>=se)if(i=ke._tr_tally(e,e.strstart-e.match_start,e.match_length-se),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=se){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=ke._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(we(e,!1),e.strm.avail_out===0))return ve}return e.insert=e.strstart<se-1?e.strstart:se-1,t===gt?(we(e,!0),e.strm.avail_out===0?Nt:ir):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?ve:Gr}function nr(e,t){for(var r,i,n;;){if(e.lookahead<Ue){if(Pt(e),e.lookahead<Ue&&t===kt)return ve;if(e.lookahead===0)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=se-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ue&&(e.match_length=ws(e,r),e.match_length<=5&&(e.strategy===bf||e.match_length===se&&e.strstart-e.match_start>4096)&&(e.match_length=se-1)),e.prev_length>=se&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-se,i=ke._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-se),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=se-1,e.strstart++,i&&(we(e,!1),e.strm.avail_out===0))return ve}else if(e.match_available){if(i=ke._tr_tally(e,0,e.window[e.strstart-1]),i&&we(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return ve}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ke._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<se-1?e.strstart:se-1,t===gt?(we(e,!0),e.strm.avail_out===0?Nt:ir):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?ve:Gr}function Nf(e,t){for(var r,i,n,a,s=e.window;;){if(e.lookahead<=bt){if(Pt(e),e.lookahead<=bt&&t===kt)return ve;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=se&&e.strstart>0&&(n=e.strstart-1,i=s[n],i===s[++n]&&i===s[++n]&&i===s[++n])){a=e.strstart+bt;do;while(i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<a);e.match_length=bt-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=se?(r=ke._tr_tally(e,1,e.match_length-se),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=ke._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(we(e,!1),e.strm.avail_out===0))return ve}return e.insert=0,t===gt?(we(e,!0),e.strm.avail_out===0?Nt:ir):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?ve:Gr}function Pf(e,t){for(var r;;){if(e.lookahead===0&&(Pt(e),e.lookahead===0)){if(t===kt)return ve;break}if(e.match_length=0,r=ke._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(we(e,!1),e.strm.avail_out===0))return ve}return e.insert=0,t===gt?(we(e,!0),e.strm.avail_out===0?Nt:ir):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?ve:Gr}function $e(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}var ar;ar=[new $e(0,0,0,0,Lf),new $e(4,4,8,4,qn),new $e(4,5,16,8,qn),new $e(4,6,32,32,qn),new $e(4,4,16,16,nr),new $e(8,16,32,32,nr),new $e(8,16,128,128,nr),new $e(8,32,128,256,nr),new $e(32,128,258,1024,nr),new $e(32,258,258,4096,nr)];function Mf(e){e.window_size=2*e.w_size,yt(e.head),e.max_lazy_match=ar[e.level].max_lazy,e.good_match=ar[e.level].good_length,e.nice_match=ar[e.level].nice_length,e.max_chain_length=ar[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=se-1,e.match_available=0,e.ins_h=0}function Bf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ai,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Ce.Buf16(Of*2),this.dyn_dtree=new Ce.Buf16((2*Af+1)*2),this.bl_tree=new Ce.Buf16((2*Df+1)*2),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Ce.Buf16(If+1),this.heap=new Ce.Buf16(2*Xn+1),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Ce.Buf16(2*Xn+1),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ss(e){var t;return!e||!e.state?vt(e,Le):(e.total_in=e.total_out=0,e.data_type=wf,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Di:Lt,e.adler=t.wrap===2?0:1,t.last_flush=kt,ke._tr_init(t),Je)}function Ts(e){var t=Ss(e);return t===Je&&Mf(e.state),t}function Ff(e,t){return!e||!e.state||e.state.wrap!==2?Le:(e.state.gzhead=t,Je)}function xs(e,t,r,i,n,a){if(!e)return Le;var s=1;if(t===gf&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),n<1||n>Sf||r!==Ai||i<8||i>15||t<0||t>9||a<0||a>yf)return vt(e,Le);i===8&&(i=9);var o=new Bf;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+se-1)/se),o.window=new Ce.Buf8(o.w_size*2),o.head=new Ce.Buf16(o.hash_size),o.prev=new Ce.Buf16(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Ce.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=(1+2)*o.lit_bufsize,o.level=t,o.strategy=a,o.method=r,Ts(e)}function Gf(e,t){return xs(e,t,Ai,Tf,xf,_f)}function Vf(e,t){var r,i,n,a;if(!e||!e.state||t>vs||t<0)return e?vt(e,Le):Le;if(i=e.state,!e.output||!e.input&&e.avail_in!==0||i.status===Fr&&t!==gt)return vt(e,e.avail_out===0?zn:Le);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===Di)if(i.wrap===2)e.adler=0,le(i,31),le(i,139),le(i,8),i.gzhead?(le(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),le(i,i.gzhead.time&255),le(i,i.gzhead.time>>8&255),le(i,i.gzhead.time>>16&255),le(i,i.gzhead.time>>24&255),le(i,i.level===9?2:i.strategy>=Ci||i.level<2?4:0),le(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(le(i,i.gzhead.extra.length&255),le(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=mt(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Yn):(le(i,0),le(i,0),le(i,0),le(i,0),le(i,0),le(i,i.level===9?2:i.strategy>=Ci||i.level<2?4:0),le(i,jf),i.status=Lt);else{var s=Ai+(i.w_bits-8<<4)<<8,o=-1;i.strategy>=Ci||i.level<2?o=0:i.level<6?o=1:i.level===6?o=2:o=3,s|=o<<6,i.strstart!==0&&(s|=Rf),s+=31-s%31,i.status=Lt,Vr(i,s),i.strstart!==0&&(Vr(i,e.adler>>>16),Vr(i,e.adler&65535)),e.adler=1}if(i.status===Yn)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),_t(e),n=i.pending,i.pending===i.pending_buf_size));)le(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Oi)}else i.status=Oi;if(i.status===Oi)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),_t(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}i.gzindex<i.gzhead.name.length?a=i.gzhead.name.charCodeAt(i.gzindex++)&255:a=0,le(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),a===0&&(i.gzindex=0,i.status=Ii)}else i.status=Ii;if(i.status===Ii)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),_t(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}i.gzindex<i.gzhead.comment.length?a=i.gzhead.comment.charCodeAt(i.gzindex++)&255:a=0,le(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>n&&(e.adler=mt(e.adler,i.pending_buf,i.pending-n,n)),a===0&&(i.status=Ri)}else i.status=Ri;if(i.status===Ri&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&_t(e),i.pending+2<=i.pending_buf_size&&(le(i,e.adler&255),le(i,e.adler>>8&255),e.adler=0,i.status=Lt)):i.status=Lt),i.pending!==0){if(_t(e),e.avail_out===0)return i.last_flush=-1,Je}else if(e.avail_in===0&&_s(t)<=_s(r)&&t!==gt)return vt(e,zn);if(i.status===Fr&&e.avail_in!==0)return vt(e,zn);if(e.avail_in!==0||i.lookahead!==0||t!==kt&&i.status!==Fr){var c=i.strategy===Ci?Pf(i,t):i.strategy===vf?Nf(i,t):ar[i.level].func(i,t);if((c===Nt||c===ir)&&(i.status=Fr),c===ve||c===Nt)return e.avail_out===0&&(i.last_flush=-1),Je;if(c===Gr&&(t===df?ke._tr_align(i):t!==vs&&(ke._tr_stored_block(i,0,0,!1),t===pf&&(yt(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),_t(e),e.avail_out===0))return i.last_flush=-1,Je}return t!==gt?Je:i.wrap<=0?ys:(i.wrap===2?(le(i,e.adler&255),le(i,e.adler>>8&255),le(i,e.adler>>16&255),le(i,e.adler>>24&255),le(i,e.total_in&255),le(i,e.total_in>>8&255),le(i,e.total_in>>16&255),le(i,e.total_in>>24&255)):(Vr(i,e.adler>>>16),Vr(i,e.adler&65535)),_t(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Je:ys)}function Uf(e){var t;return!e||!e.state?Le:(t=e.state.status,t!==Di&&t!==Yn&&t!==Oi&&t!==Ii&&t!==Ri&&t!==Lt&&t!==Fr?vt(e,Le):(e.state=null,t===Lt?vt(e,mf):Je))}function Hf(e,t){var r=t.length,i,n,a,s,o,c,l,h;if(!e||!e.state)return Le;if(i=e.state,s=i.wrap,s===2||s===1&&i.status!==Di||i.lookahead)return Le;for(s===1&&(e.adler=bs(e.adler,t,r,0)),i.wrap=0,r>=i.w_size&&(s===0&&(yt(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new Ce.Buf8(i.w_size),Ce.arraySet(h,t,r-i.w_size,i.w_size,0),t=h,r=i.w_size),o=e.avail_in,c=e.next_in,l=e.input,e.avail_in=r,e.next_in=0,e.input=t,Pt(i);i.lookahead>=se;){n=i.strstart,a=i.lookahead-(se-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+se-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++;while(--a);i.strstart=n,i.lookahead=se-1,Pt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=se-1,i.match_available=0,e.next_in=c,e.input=l,e.avail_in=o,i.wrap=s,Je}Ke.deflateInit=Gf;Ke.deflateInit2=xs;Ke.deflateReset=Ts;Ke.deflateResetKeep=Ss;Ke.deflateSetHeader=Ff;Ke.deflate=Vf;Ke.deflateEnd=Uf;Ke.deflateSetDictionary=Hf;Ke.deflateInfo="pako deflate (from Nodeca project)"}),Zn=te(or=>{"use strict";var ji=at(),Cs=!0,As=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Cs=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){As=!1}var Ur=new ji.Buf8(256);for(var wt=0;wt<256;wt++)Ur[wt]=wt>=252?6:wt>=248?5:wt>=240?4:wt>=224?3:wt>=192?2:1;Ur[254]=Ur[254]=1;or.string2buf=function(e){var t,r,i,n,a,s=e.length,o=0;for(n=0;n<s;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new ji.Buf8(o),a=0,n=0;a<o;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|r&63):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|r&63):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|r&63);return t};function Ds(e,t){if(t<65534&&(e.subarray&&As||!e.subarray&&Cs))return String.fromCharCode.apply(null,ji.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}or.buf2binstring=function(e){return Ds(e,e.length)};or.binstring2buf=function(e){for(var t=new ji.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t};or.buf2string=function(e,t){var r,i,n,a,s=t||e.length,o=new Array(s*2);for(i=0,r=0;r<s;){if(n=e[r++],n<128){o[i++]=n;continue}if(a=Ur[n],a>4){o[i++]=65533,r+=a-1;continue}for(n&=a===2?31:a===3?15:7;a>1&&r<s;)n=n<<6|e[r++]&63,a--;if(a>1){o[i++]=65533;continue}n<65536?o[i++]=n:(n-=65536,o[i++]=55296|n>>10&1023,o[i++]=56320|n&1023)}return Ds(o,i)};or.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+Ur[e[r]]>t?r:t}}),Kn=te((Sy,Os)=>{"use strict";function Wf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}Os.exports=Wf}),ks=te(Hr=>{"use strict";var Wr=Es(),zr=at(),Jn=Zn(),$n=Ei(),zf=Kn(),Is=Object.prototype.toString,Xf=0,Qn=4,sr=0,Rs=1,js=2,Yf=-1,qf=0,Zf=8;function Mt(e){if(!(this instanceof Mt))return new Mt(e);this.options=zr.assign({level:Yf,method:Zf,chunkSize:16384,windowBits:15,memLevel:8,strategy:qf,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zf,this.strm.avail_out=0;var r=Wr.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==sr)throw new Error($n[r]);if(t.header&&Wr.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(typeof t.dictionary=="string"?i=Jn.string2buf(t.dictionary):Is.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,r=Wr.deflateSetDictionary(this.strm,i),r!==sr)throw new Error($n[r]);this._dict_set=!0}}Mt.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,n,a;if(this.ended)return!1;a=t===~~t?t:t===!0?Qn:Xf,typeof e=="string"?r.input=Jn.string2buf(e):Is.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new zr.Buf8(i),r.next_out=0,r.avail_out=i),n=Wr.deflate(r,a),n!==Rs&&n!==sr)return this.onEnd(n),this.ended=!0,!1;(r.avail_out===0||r.avail_in===0&&(a===Qn||a===js))&&(this.options.to==="string"?this.onData(Jn.buf2binstring(zr.shrinkBuf(r.output,r.next_out))):this.onData(zr.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||r.avail_out===0)&&n!==Rs);return a===Qn?(n=Wr.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===sr):(a===js&&(this.onEnd(sr),r.avail_out=0),!0)};Mt.prototype.onData=function(e){this.chunks.push(e)};Mt.prototype.onEnd=function(e){e===sr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=zr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function ea(e,t){var r=new Mt(t);if(r.push(e,!0),r.err)throw r.msg||$n[r.err];return r.result}function Kf(e,t){return t=t||{},t.raw=!0,ea(e,t)}function Jf(e,t){return t=t||{},t.gzip=!0,ea(e,t)}Hr.Deflate=Mt;Hr.deflate=ea;Hr.deflateRaw=Kf;Hr.gzip=Jf}),Ns=te((xy,Ls)=>{"use strict";var ki=30,$f=12;Ls.exports=function(t,r){var i,n,a,s,o,c,l,h,u,f,d,m,g,b,_,I,M,U,L,Y,V,F,O,R,x;i=t.state,n=t.next_in,R=t.input,a=n+(t.avail_in-5),s=t.next_out,x=t.output,o=s-(r-t.avail_out),c=s+(t.avail_out-257),l=i.dmax,h=i.wsize,u=i.whave,f=i.wnext,d=i.window,m=i.hold,g=i.bits,b=i.lencode,_=i.distcode,I=(1<<i.lenbits)-1,M=(1<<i.distbits)-1;e:do{g<15&&(m+=R[n++]<<g,g+=8,m+=R[n++]<<g,g+=8),U=b[m&I];t:for(;;){if(L=U>>>24,m>>>=L,g-=L,L=U>>>16&255,L===0)x[s++]=U&65535;else if(L&16){Y=U&65535,L&=15,L&&(g<L&&(m+=R[n++]<<g,g+=8),Y+=m&(1<<L)-1,m>>>=L,g-=L),g<15&&(m+=R[n++]<<g,g+=8,m+=R[n++]<<g,g+=8),U=_[m&M];r:for(;;){if(L=U>>>24,m>>>=L,g-=L,L=U>>>16&255,L&16){if(V=U&65535,L&=15,g<L&&(m+=R[n++]<<g,g+=8,g<L&&(m+=R[n++]<<g,g+=8)),V+=m&(1<<L)-1,V>l){t.msg="invalid distance too far back",i.mode=ki;break e}if(m>>>=L,g-=L,L=s-o,V>L){if(L=V-L,L>u&&i.sane){t.msg="invalid distance too far back",i.mode=ki;break e}if(F=0,O=d,f===0){if(F+=h-L,L<Y){Y-=L;do x[s++]=d[F++];while(--L);F=s-V,O=x}}else if(f<L){if(F+=h+f-L,L-=f,L<Y){Y-=L;do x[s++]=d[F++];while(--L);if(F=0,f<Y){L=f,Y-=L;do x[s++]=d[F++];while(--L);F=s-V,O=x}}}else if(F+=f-L,L<Y){Y-=L;do x[s++]=d[F++];while(--L);F=s-V,O=x}for(;Y>2;)x[s++]=O[F++],x[s++]=O[F++],x[s++]=O[F++],Y-=3;Y&&(x[s++]=O[F++],Y>1&&(x[s++]=O[F++]))}else{F=s-V;do x[s++]=x[F++],x[s++]=x[F++],x[s++]=x[F++],Y-=3;while(Y>2);Y&&(x[s++]=x[F++],Y>1&&(x[s++]=x[F++]))}}else if((L&64)===0){U=_[(U&65535)+(m&(1<<L)-1)];continue r}else{t.msg="invalid distance code",i.mode=ki;break e}break}}else if((L&64)===0){U=b[(U&65535)+(m&(1<<L)-1)];continue t}else if(L&32){i.mode=$f;break e}else{t.msg="invalid literal/length code",i.mode=ki;break e}break}}while(n<a&&s<c);Y=g>>3,n-=Y,g-=Y<<3,m&=(1<<g)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<c?257+(c-s):257-(s-c),i.hold=m,i.bits=g;return}}),Us=te((Ey,Ps)=>{"use strict";var Ms=at(),lr=15,Bs=852,Fs=592,Gs=0,ta=1,Vs=2,Qf=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ed=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],td=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],rd=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];Ps.exports=function(t,r,i,n,a,s,o,c){var l=c.bits,h=0,u=0,f=0,d=0,m=0,g=0,b=0,_=0,I=0,M=0,U,L,Y,V,F,O=null,R=0,x,v=new Ms.Buf16(lr+1),E=new Ms.Buf16(lr+1),A=null,S=0,Z,w,T;for(h=0;h<=lr;h++)v[h]=0;for(u=0;u<n;u++)v[r[i+u]]++;for(m=l,d=lr;d>=1&&!(v[d]!==0);d--);if(m>d&&(m=d),d===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,c.bits=1,0;for(f=1;f<d&&!(v[f]!==0);f++);for(m<f&&(m=f),_=1,h=1;h<=lr;h++)if(_<<=1,_-=v[h],_<0)return-1;if(_>0&&(t===Gs||d!==1))return-1;for(E[1]=0,h=1;h<lr;h++)E[h+1]=E[h]+v[h];for(u=0;u<n;u++)r[i+u]!==0&&(o[E[r[i+u]]++]=u);if(t===Gs?(O=A=o,x=19):t===ta?(O=Qf,R-=257,A=ed,S-=257,x=256):(O=td,A=rd,x=-1),M=0,u=0,h=f,F=s,g=m,b=0,Y=-1,I=1<<m,V=I-1,t===ta&&I>Bs||t===Vs&&I>Fs)return 1;for(;;){Z=h-b,o[u]<x?(w=0,T=o[u]):o[u]>x?(w=A[S+o[u]],T=O[R+o[u]]):(w=32+64,T=0),U=1<<h-b,L=1<<g,f=L;do L-=U,a[F+(M>>b)+L]=Z<<24|w<<16|T|0;while(L!==0);for(U=1<<h-1;M&U;)U>>=1;if(U!==0?(M&=U-1,M+=U):M=0,u++,--v[h]===0){if(h===d)break;h=r[i+o[u]]}if(h>m&&(M&V)!==Y){for(b===0&&(b=m),F+=f,g=h-b,_=1<<g;g+b<d&&!(_-=v[g+b],_<=0);)g++,_<<=1;if(I+=1<<g,t===ta&&I>Bs||t===Vs&&I>Fs)return 1;Y=M&V,a[Y]=m<<24|g<<16|F-s|0}}return M!==0&&(a[F+M]=h-b<<24|64<<16|0),c.bits=m,0}}),Tl=te(He=>{"use strict";var je=at(),ra=Hn(),Qe=Wn(),id=Ns(),Xr=Us(),nd=0,Hs=1,Ws=2,zs=4,ad=5,Li=6,Bt=0,od=1,sd=2,Ne=-2,Xs=-3,ia=-4,ld=-5,Ys=8,qs=1,Zs=2,Ks=3,Js=4,$s=5,Qs=6,el=7,tl=8,rl=9,il=10,Ni=11,st=12,na=13,nl=14,aa=15,al=16,ol=17,sl=18,ll=19,Pi=20,Mi=21,cl=22,hl=23,ul=24,fl=25,dl=26,oa=27,pl=28,ml=29,pe=30,sa=31,cd=32,hd=852,ud=592,fd=15,dd=fd;function gl(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function pd(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new je.Buf16(320),this.work=new je.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function bl(e){var t;return!e||!e.state?Ne:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=qs,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new je.Buf32(hd),t.distcode=t.distdyn=new je.Buf32(ud),t.sane=1,t.back=-1,Bt)}function vl(e){var t;return!e||!e.state?Ne:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,bl(e))}function yl(e,t){var r,i;return!e||!e.state?Ne:(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?Ne:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,vl(e)))}function _l(e,t){var r,i;return e?(i=new pd,e.state=i,i.window=null,r=yl(e,t),r!==Bt&&(e.state=null),r):Ne}function md(e){return _l(e,dd)}var wl=!0,la,ca;function gd(e){if(wl){var t;for(la=new je.Buf32(512),ca=new je.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Xr(Hs,e.lens,0,288,la,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Xr(Ws,e.lens,0,32,ca,0,e.work,{bits:5}),wl=!1}e.lencode=la,e.lenbits=9,e.distcode=ca,e.distbits=5}function Sl(e,t,r,i){var n,a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new je.Buf8(a.wsize)),i>=a.wsize?(je.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),je.arraySet(a.window,t,r-i,n,a.wnext),i-=n,i?(je.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function bd(e,t){var r,i,n,a,s,o,c,l,h,u,f,d,m,g,b=0,_,I,M,U,L,Y,V,F,O=new je.Buf8(4),R,x,v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Ne;r=e.state,r.mode===st&&(r.mode=na),s=e.next_out,n=e.output,c=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,u=o,f=c,F=Bt;e:for(;;)switch(r.mode){case qs:if(r.wrap===0){r.mode=na;break}for(;h<16;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(r.wrap&2&&l===35615){r.check=0,O[0]=l&255,O[1]=l>>>8&255,r.check=Qe(r.check,O,2,0),l=0,h=0,r.mode=Zs;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=pe;break}if((l&15)!==Ys){e.msg="unknown compression method",r.mode=pe;break}if(l>>>=4,h-=4,V=(l&15)+8,r.wbits===0)r.wbits=V;else if(V>r.wbits){e.msg="invalid window size",r.mode=pe;break}r.dmax=1<<V,e.adler=r.check=1,r.mode=l&512?il:st,l=0,h=0;break;case Zs:for(;h<16;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(r.flags=l,(r.flags&255)!==Ys){e.msg="unknown compression method",r.mode=pe;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=pe;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Qe(r.check,O,2,0)),l=0,h=0,r.mode=Ks;case Ks:for(;h<32;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.head&&(r.head.time=l),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,O[2]=l>>>16&255,O[3]=l>>>24&255,r.check=Qe(r.check,O,4,0)),l=0,h=0,r.mode=Js;case Js:for(;h<16;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Qe(r.check,O,2,0)),l=0,h=0,r.mode=$s;case $s:if(r.flags&1024){for(;h<16;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Qe(r.check,O,2,0)),l=0,h=0}else r.head&&(r.head.extra=null);r.mode=Qs;case Qs:if(r.flags&1024&&(d=r.length,d>o&&(d=o),d&&(r.head&&(V=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),je.arraySet(r.head.extra,i,a,d,V)),r.flags&512&&(r.check=Qe(r.check,i,d,a)),o-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=el;case el:if(r.flags&2048){if(o===0)break e;d=0;do V=i[a+d++],r.head&&V&&r.length<65536&&(r.head.name+=String.fromCharCode(V));while(V&&d<o);if(r.flags&512&&(r.check=Qe(r.check,i,d,a)),o-=d,a+=d,V)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=tl;case tl:if(r.flags&4096){if(o===0)break e;d=0;do V=i[a+d++],r.head&&V&&r.length<65536&&(r.head.comment+=String.fromCharCode(V));while(V&&d<o);if(r.flags&512&&(r.check=Qe(r.check,i,d,a)),o-=d,a+=d,V)break e}else r.head&&(r.head.comment=null);r.mode=rl;case rl:if(r.flags&512){for(;h<16;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(l!==(r.check&65535)){e.msg="header crc mismatch",r.mode=pe;break}l=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=st;break;case il:for(;h<32;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}e.adler=r.check=gl(l),l=0,h=0,r.mode=Ni;case Ni:if(r.havedict===0)return e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=h,sd;e.adler=r.check=1,r.mode=st;case st:if(t===ad||t===Li)break e;case na:if(r.last){l>>>=h&7,h-=h&7,r.mode=oa;break}for(;h<3;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.last=l&1,l>>>=1,h-=1;switch(l&3){case 0:r.mode=nl;break;case 1:if(gd(r),r.mode=Pi,t===Li){l>>>=2,h-=2;break e}break;case 2:r.mode=ol;break;case 3:e.msg="invalid block type",r.mode=pe}l>>>=2,h-=2;break;case nl:for(l>>>=h&7,h-=h&7;h<32;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=pe;break}if(r.length=l&65535,l=0,h=0,r.mode=aa,t===Li)break e;case aa:r.mode=al;case al:if(d=r.length,d){if(d>o&&(d=o),d>c&&(d=c),d===0)break e;je.arraySet(n,i,a,d,s),o-=d,a+=d,c-=d,s+=d,r.length-=d;break}r.mode=st;break;case ol:for(;h<14;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(r.nlen=(l&31)+257,l>>>=5,h-=5,r.ndist=(l&31)+1,l>>>=5,h-=5,r.ncode=(l&15)+4,l>>>=4,h-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=pe;break}r.have=0,r.mode=sl;case sl:for(;r.have<r.ncode;){for(;h<3;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.lens[v[r.have++]]=l&7,l>>>=3,h-=3}for(;r.have<19;)r.lens[v[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},F=Xr(nd,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,F){e.msg="invalid code lengths set",r.mode=pe;break}r.have=0,r.mode=ll;case ll:for(;r.have<r.nlen+r.ndist;){for(;!(b=r.lencode[l&(1<<r.lenbits)-1],_=b>>>24,I=b>>>16&255,M=b&65535,_<=h);){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(M<16)l>>>=_,h-=_,r.lens[r.have++]=M;else{if(M===16){for(x=_+2;h<x;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(l>>>=_,h-=_,r.have===0){e.msg="invalid bit length repeat",r.mode=pe;break}V=r.lens[r.have-1],d=3+(l&3),l>>>=2,h-=2}else if(M===17){for(x=_+3;h<x;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}l>>>=_,h-=_,V=0,d=3+(l&7),l>>>=3,h-=3}else{for(x=_+7;h<x;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}l>>>=_,h-=_,V=0,d=11+(l&127),l>>>=7,h-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=pe;break}for(;d--;)r.lens[r.have++]=V}}if(r.mode===pe)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=pe;break}if(r.lenbits=9,R={bits:r.lenbits},F=Xr(Hs,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,F){e.msg="invalid literal/lengths set",r.mode=pe;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},F=Xr(Ws,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,F){e.msg="invalid distances set",r.mode=pe;break}if(r.mode=Pi,t===Li)break e;case Pi:r.mode=Mi;case Mi:if(o>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=h,id(e,f),s=e.next_out,n=e.output,c=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,r.mode===st&&(r.back=-1);break}for(r.back=0;!(b=r.lencode[l&(1<<r.lenbits)-1],_=b>>>24,I=b>>>16&255,M=b&65535,_<=h);){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(I&&(I&240)===0){for(U=_,L=I,Y=M;!(b=r.lencode[Y+((l&(1<<U+L)-1)>>U)],_=b>>>24,I=b>>>16&255,M=b&65535,U+_<=h);){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}l>>>=U,h-=U,r.back+=U}if(l>>>=_,h-=_,r.back+=_,r.length=M,I===0){r.mode=dl;break}if(I&32){r.back=-1,r.mode=st;break}if(I&64){e.msg="invalid literal/length code",r.mode=pe;break}r.extra=I&15,r.mode=cl;case cl:if(r.extra){for(x=r.extra;h<x;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=hl;case hl:for(;!(b=r.distcode[l&(1<<r.distbits)-1],_=b>>>24,I=b>>>16&255,M=b&65535,_<=h);){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if((I&240)===0){for(U=_,L=I,Y=M;!(b=r.distcode[Y+((l&(1<<U+L)-1)>>U)],_=b>>>24,I=b>>>16&255,M=b&65535,U+_<=h);){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}l>>>=U,h-=U,r.back+=U}if(l>>>=_,h-=_,r.back+=_,I&64){e.msg="invalid distance code",r.mode=pe;break}r.offset=M,r.extra=I&15,r.mode=ul;case ul:if(r.extra){for(x=r.extra;h<x;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=pe;break}r.mode=fl;case fl:if(c===0)break e;if(d=f-c,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=pe;break}d>r.wnext?(d-=r.wnext,m=r.wsize-d):m=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=n,m=s-r.offset,d=r.length;d>c&&(d=c),c-=d,r.length-=d;do n[s++]=g[m++];while(--d);r.length===0&&(r.mode=Mi);break;case dl:if(c===0)break e;n[s++]=r.length,c--,r.mode=Mi;break;case oa:if(r.wrap){for(;h<32;){if(o===0)break e;o--,l|=i[a++]<<h,h+=8}if(f-=c,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?Qe(r.check,n,f,s-f):ra(r.check,n,f,s-f)),f=c,(r.flags?l:gl(l))!==r.check){e.msg="incorrect data check",r.mode=pe;break}l=0,h=0}r.mode=pl;case pl:if(r.wrap&&r.flags){for(;h<32;){if(o===0)break e;o--,l+=i[a++]<<h,h+=8}if(l!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=pe;break}l=0,h=0}r.mode=ml;case ml:F=od;break e;case pe:F=Xs;break e;case sa:return ia;case cd:default:return Ne}return e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=h,(r.wsize||f!==e.avail_out&&r.mode<pe&&(r.mode<oa||t!==zs))&&Sl(e,e.output,e.next_out,f-e.avail_out)?(r.mode=sa,ia):(u-=e.avail_in,f-=e.avail_out,e.total_in+=u,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?Qe(r.check,n,f,e.next_out-f):ra(r.check,n,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===st?128:0)+(r.mode===Pi||r.mode===aa?256:0),(u===0&&f===0||t===zs)&&F===Bt&&(F=ld),F)}function vd(e){if(!e||!e.state)return Ne;var t=e.state;return t.window&&(t.window=null),e.state=null,Bt}function yd(e,t){var r;return!e||!e.state?Ne:(r=e.state,(r.wrap&2)===0?Ne:(r.head=t,t.done=!1,Bt))}function _d(e,t){var r=t.length,i,n,a;return!e||!e.state?Ne:(i=e.state,i.wrap!==0&&i.mode!==Ni?Ne:i.mode===Ni&&(n=1,n=ra(n,t,r,0),n!==i.check)?Xs:(a=Sl(e,t,r,r),a?(i.mode=sa,ia):(i.havedict=1,Bt)))}He.inflateReset=vl;He.inflateReset2=yl;He.inflateResetKeep=bl;He.inflateInit=md;He.inflateInit2=_l;He.inflate=bd;He.inflateEnd=vd;He.inflateGetHeader=yd;He.inflateSetDictionary=_d;He.inflateInfo="pako inflate (from Nodeca project)"}),ha=te((Ay,xl)=>{"use strict";xl.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),Cl=te((Dy,El)=>{"use strict";function wd(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}El.exports=wd}),Dl=te(Yr=>{"use strict";var cr=Tl(),qr=at(),Bi=Zn(),me=ha(),ua=Ei(),Sd=Kn(),Td=Cl(),Al=Object.prototype.toString;function Ft(e){if(!(this instanceof Ft))return new Ft(e);this.options=qr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&((t.windowBits&15)===0&&(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sd,this.strm.avail_out=0;var r=cr.inflateInit2(this.strm,t.windowBits);if(r!==me.Z_OK)throw new Error(ua[r]);if(this.header=new Td,cr.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Bi.string2buf(t.dictionary):Al.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=cr.inflateSetDictionary(this.strm,t.dictionary),r!==me.Z_OK)))throw new Error(ua[r])}Ft.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,n=this.options.dictionary,a,s,o,c,l,h=!1;if(this.ended)return!1;s=t===~~t?t:t===!0?me.Z_FINISH:me.Z_NO_FLUSH,typeof e=="string"?r.input=Bi.binstring2buf(e):Al.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new qr.Buf8(i),r.next_out=0,r.avail_out=i),a=cr.inflate(r,me.Z_NO_FLUSH),a===me.Z_NEED_DICT&&n&&(a=cr.inflateSetDictionary(this.strm,n)),a===me.Z_BUF_ERROR&&h===!0&&(a=me.Z_OK,h=!1),a!==me.Z_STREAM_END&&a!==me.Z_OK)return this.onEnd(a),this.ended=!0,!1;r.next_out&&((r.avail_out===0||a===me.Z_STREAM_END||r.avail_in===0&&(s===me.Z_FINISH||s===me.Z_SYNC_FLUSH))&&(this.options.to==="string"?(o=Bi.utf8border(r.output,r.next_out),c=r.next_out-o,l=Bi.buf2string(r.output,o),r.next_out=c,r.avail_out=i-c,c&&qr.arraySet(r.output,r.output,o,c,0),this.onData(l)):this.onData(qr.shrinkBuf(r.output,r.next_out)))),r.avail_in===0&&r.avail_out===0&&(h=!0)}while((r.avail_in>0||r.avail_out===0)&&a!==me.Z_STREAM_END);return a===me.Z_STREAM_END&&(s=me.Z_FINISH),s===me.Z_FINISH?(a=cr.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===me.Z_OK):(s===me.Z_SYNC_FLUSH&&(this.onEnd(me.Z_OK),r.avail_out=0),!0)};Ft.prototype.onData=function(e){this.chunks.push(e)};Ft.prototype.onEnd=function(e){e===me.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function fa(e,t){var r=new Ft(t);if(r.push(e,!0),r.err)throw r.msg||ua[r.err];return r.result}function xd(e,t){return t=t||{},t.raw=!0,fa(e,t)}Yr.Inflate=Ft;Yr.inflate=fa;Yr.inflateRaw=xd;Yr.ungzip=fa}),Rl=te((Iy,Ol)=>{"use strict";var Ed=at().assign,Cd=ks(),Ad=Dl(),Dd=ha(),Il={};Ed(Il,Cd,Ad,Dd);Ol.exports=Il}),kl=te(Fi=>{"use strict";var Od=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",Id=Rl(),jl=de(),Gi=Re(),Rd=Od?"uint8array":"array";Fi.magic="\b\0";function Gt(e,t){Gi.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}jl.inherits(Gt,Gi);Gt.prototype.processChunk=function(e){this.meta=e.meta,this._pako===null&&this._createPako(),this._pako.push(jl.transformTo(Rd,e.data),!1)};Gt.prototype.flush=function(){Gi.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)};Gt.prototype.cleanUp=function(){Gi.prototype.cleanUp.call(this),this._pako=null};Gt.prototype._createPako=function(){this._pako=new Id[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}};Fi.compressWorker=function(e){return new Gt("Deflate",e)};Fi.uncompressWorker=function(){return new Gt("Inflate",{})}}),pa=te(da=>{"use strict";var Ll=Re();da.STORE={magic:"\0\0",compressWorker:function(e){return new Ll("STORE compression")},uncompressWorker:function(){return new Ll("STORE decompression")}};da.DEFLATE=kl()}),ma=te(Vt=>{"use strict";Vt.LOCAL_FILE_HEADER="PK";Vt.CENTRAL_FILE_HEADER="PK";Vt.CENTRAL_DIRECTORY_END="PK";Vt.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07";Vt.ZIP64_CENTRAL_DIRECTORY_END="PK";Vt.DATA_DESCRIPTOR="PK\x07\b"}),Bl=te((Ly,Nl)=>{"use strict";var hr=de(),ur=Re(),ga=It(),Pl=_i(),Vi=ma(),ue=function(e,t){var r="",i;for(i=0;i<t;i++)r+=String.fromCharCode(e&255),e=e>>>8;return r},jd=function(e,t){var r=e;return e||(r=t?16893:33204),(r&65535)<<16},kd=function(e,t){return(e||0)&63},Ml=function(e,t,r,i,n,a){var s=e.file,o=e.compression,c=a!==ga.utf8encode,l=hr.transformTo("string",a(s.name)),h=hr.transformTo("string",ga.utf8encode(s.name)),u=s.comment,f=hr.transformTo("string",a(u)),d=hr.transformTo("string",ga.utf8encode(u)),m=h.length!==s.name.length,g=d.length!==u.length,b,_,I="",M="",U="",L=s.dir,Y=s.date,V={crc32:0,compressedSize:0,uncompressedSize:0};(!t||r)&&(V.crc32=e.crc32,V.compressedSize=e.compressedSize,V.uncompressedSize=e.uncompressedSize);var F=0;t&&(F|=8),!c&&(m||g)&&(F|=2048);var O=0,R=0;L&&(O|=16),n==="UNIX"?(R=798,O|=jd(s.unixPermissions,L)):(R=20,O|=kd(s.dosPermissions,L)),b=Y.getUTCHours(),b=b<<6,b=b|Y.getUTCMinutes(),b=b<<5,b=b|Y.getUTCSeconds()/2,_=Y.getUTCFullYear()-1980,_=_<<4,_=_|Y.getUTCMonth()+1,_=_<<5,_=_|Y.getUTCDate(),m&&(M=ue(1,1)+ue(Pl(l),4)+h,I+="up"+ue(M.length,2)+M),g&&(U=ue(1,1)+ue(Pl(f),4)+d,I+="uc"+ue(U.length,2)+U);var x="";x+=`
\0`,x+=ue(F,2),x+=o.magic,x+=ue(b,2),x+=ue(_,2),x+=ue(V.crc32,4),x+=ue(V.compressedSize,4),x+=ue(V.uncompressedSize,4),x+=ue(l.length,2),x+=ue(I.length,2);var v=Vi.LOCAL_FILE_HEADER+x+l+I,E=Vi.CENTRAL_FILE_HEADER+ue(R,2)+x+ue(f.length,2)+"\0\0\0\0"+ue(O,4)+ue(i,4)+l+I+f;return{fileRecord:v,dirRecord:E}},Ld=function(e,t,r,i,n){var a="",s=hr.transformTo("string",n(i));return a=Vi.CENTRAL_DIRECTORY_END+"\0\0\0\0"+ue(e,2)+ue(e,2)+ue(t,4)+ue(r,4)+ue(s.length,2)+s,a},Nd=function(e){var t="";return t=Vi.DATA_DESCRIPTOR+ue(e.crc32,4)+ue(e.compressedSize,4)+ue(e.uncompressedSize,4),t};function We(e,t,r,i){ur.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}hr.inherits(We,ur);We.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,ur.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))};We.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=Ml(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0};We.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=Ml(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:Nd(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null};We.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=Ld(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})};We.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()};We.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(r){t.processChunk(r)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(r){t.error(r)}),this};We.prototype.resume=function(){if(!ur.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0};We.prototype.error=function(e){var t=this._sources;if(!ur.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(i){}return!0};We.prototype.lock=function(){ur.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()};Nl.exports=We}),Gl=te(Fl=>{"use strict";var Pd=pa(),Md=Bl(),Bd=function(e,t){var r=e||t,i=Pd[r];if(!i)throw new Error(r+" is not a valid compression method !");return i};Fl.generateWorker=function(e,t,r){var i=new Md(t.streamFiles,r,t.platform,t.encodeFileName),n=0;try{e.forEach(function(a,s){n++;var o=Bd(s.options.compression,t.compression),c=s.options.compressionOptions||t.compressionOptions||{},l=s.dir,h=s.date;s._compressWorker(o,c).withStreamInfo("file",{name:a,dir:l,date:h,comment:s.comment||"",unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions}).pipe(i)}),i.entriesCount=n}catch(a){i.error(a)}return i}}),Ul=te((Py,Vl)=>{"use strict";var Fd=de(),Ui=Re();function Zr(e,t){Ui.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}Fd.inherits(Zr,Ui);Zr.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(r){t.push({data:r,meta:{percent:0}})}).on("error",function(r){t.isPaused?this.generatedError=r:t.error(r)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})};Zr.prototype.pause=function(){return Ui.prototype.pause.call(this)?(this._stream.pause(),!0):!1};Zr.prototype.resume=function(){return Ui.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1};Vl.exports=Zr}),$l=te((My,Hl)=>{"use strict";var Gd=It(),Kr=de(),Wl=Re(),Vd=_n(),zl=wn(),Xl=Si(),Ud=Wo(),Hd=Gl(),Yl=Cr(),Wd=Ul(),Kl=function(e,t,r){var i=Kr.getTypeOf(t),n,a=Kr.extend(r||{},zl);a.date=a.date||new Date,a.compression!==null&&(a.compression=a.compression.toUpperCase()),typeof a.unixPermissions=="string"&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&a.unixPermissions&16384&&(a.dir=!0),a.dosPermissions&&a.dosPermissions&16&&(a.dir=!0),a.dir&&(e=ql(e)),a.createFolders&&(n=zd(e))&&Zl.call(this,n,!0);var s=i==="string"&&a.binary===!1&&a.base64===!1;(!r||typeof r.binary=="undefined")&&(a.binary=!s);var o=t instanceof Xl&&t.uncompressedSize===0;(o||a.dir||!t||t.length===0)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",i="string");var c=null;t instanceof Xl||t instanceof Wl?c=t:Yl.isNode&&Yl.isStream(t)?c=new Wd(e,t):c=Kr.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var l=new Ud(e,c,a);this.files[e]=l},zd=function(e){e.slice(-1)==="/"&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},ql=function(e){return e.slice(-1)!=="/"&&(e+="/"),e},Zl=function(e,t){return t=typeof t!="undefined"?t:zl.createFolders,e=ql(e),this.files[e]||Kl.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function Jl(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var Xd={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files){if(!this.files.hasOwnProperty(t))continue;i=this.files[t],r=t.slice(this.root.length,t.length),r&&t.slice(0,this.root.length)===this.root&&e(r,i)}},filter:function(e){var t=[];return this.forEach(function(r,i){e(r,i)&&t.push(i)}),t},file:function(e,t,r){if(arguments.length===1)if(Jl(e)){var i=e;return this.filter(function(a,s){return!s.dir&&i.test(a)})}else{var n=this.files[this.root+e];return n&&!n.dir?n:null}else e=this.root+e,Kl.call(this,e,t,r);return this},folder:function(e){if(!e)return this;if(Jl(e))return this.filter(function(n,a){return a.dir&&e.test(n)});var t=this.root+e,r=Zl.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||(e.slice(-1)!=="/"&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(n,a){return a.name.slice(0,e.length)===e}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if(r=Kr.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:Gd.utf8encode}),r.type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),r.type==="binarystring"&&(r.type="string"),!r.type)throw new Error("No output type specified.");Kr.checkSupport(r.type),(r.platform==="darwin"||r.platform==="freebsd"||r.platform==="linux"||r.platform==="sunos")&&(r.platform="UNIX"),r.platform==="win32"&&(r.platform="DOS");var i=r.comment||this.comment||"";t=Hd.generateWorker(this,r,i)}catch(n){t=new Wl("error"),t.error(n)}return new Vd(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};Hl.exports=Xd}),ba=te((By,Ql)=>{"use strict";var Yd=de();function ec(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}ec.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,r;for(this.checkOffset(e),r=this.index+e-1;r>=this.index;r--)t=(t<<8)+this.byteAt(r);return this.index+=e,t},readString:function(e){return Yd.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))}};Ql.exports=ec}),va=te((Fy,tc)=>{"use strict";var rc=ba(),qd=de();function fr(e){rc.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=e[t]&255}qd.inherits(fr,rc);fr.prototype.byteAt=function(e){return this.data[this.zero+e]};fr.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===i&&this.data[a+3]===n)return a-this.zero;return-1};fr.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&r===a[1]&&i===a[2]&&n===a[3]};fr.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};tc.exports=fr}),ac=te((Gy,ic)=>{"use strict";var nc=ba(),Zd=de();function dr(e){nc.call(this,e)}Zd.inherits(dr,nc);dr.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)};dr.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero};dr.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t};dr.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};ic.exports=dr}),_a=te((Vy,oc)=>{"use strict";var sc=va(),Kd=de();function ya(e){sc.call(this,e)}Kd.inherits(ya,sc);ya.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};oc.exports=ya}),hc=te((Uy,lc)=>{"use strict";var cc=_a(),Jd=de();function wa(e){cc.call(this,e)}Jd.inherits(wa,cc);wa.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};lc.exports=wa}),Sa=te((Hy,uc)=>{"use strict";var Hi=de(),fc=nt(),$d=va(),Qd=ac(),ep=hc(),tp=_a();uc.exports=function(e){var t=Hi.getTypeOf(e);return Hi.checkSupport(t),t==="string"&&!fc.uint8array?new Qd(e):t==="nodebuffer"?new ep(e):fc.uint8array?new tp(Hi.transformTo("uint8array",e)):new $d(Hi.transformTo("array",e))}}),gc=te((Wy,dc)=>{"use strict";var Ta=Sa(),St=de(),rp=Si(),pc=_i(),Wi=It(),zi=pa(),ip=nt(),np=0,ap=3,op=function(e){for(var t in zi){if(!zi.hasOwnProperty(t))continue;if(zi[t].magic===e)return zi[t]}return null};function mc(e,t){this.options=e,this.loadOptions=t}mc.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=op(this.compressionMethod),t===null)throw new Error("Corrupted zip : compression "+St.pretty(this.compressionMethod)+" unknown (inner file : "+St.transformTo("string",this.fileName)+")");this.decompressed=new rp(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),e===np&&(this.dosPermissions=this.externalFileAttributes&63),e===ap&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(e){if(!this.extraFields[1])return;var t=Ta(this.extraFields[1].value);this.uncompressedSize===St.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===St.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===St.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===St.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,r,i,n;for(this.extraFields||(this.extraFields={});e.index+4<t;)r=e.readInt(2),i=e.readInt(2),n=e.readData(i),this.extraFields[r]={id:r,length:i,value:n};e.setIndex(t)},handleUTF8:function(){var e=ip.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Wi.utf8decode(this.fileName),this.fileCommentStr=Wi.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(t!==null)this.fileNameStr=t;else{var r=St.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(i!==null)this.fileCommentStr=i;else{var n=St.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=Ta(e.value);return t.readInt(1)!==1||pc(this.fileName)!==t.readInt(4)?null:Wi.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=Ta(e.value);return t.readInt(1)!==1||pc(this.fileComment)!==t.readInt(4)?null:Wi.utf8decode(t.readData(e.length-5))}return null}};dc.exports=mc}),yc=te((Xy,bc)=>{"use strict";var sp=Sa(),lt=de(),ze=ma(),lp=gc(),zy=It(),cp=nt();function vc(e){this.files=[],this.loadOptions=e}vc.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+lt.pretty(t)+", expected "+lt.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),n=i===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=cp.uint8array?"uint8array":"array",r=lt.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,r,i,n;t<e;)r=this.reader.readInt(2),i=this.reader.readInt(4),n=this.reader.readData(i),this.zip64ExtensibleData[r]={id:r,length:i,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(ze.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(ze.CENTRAL_FILE_HEADER);)e=new lp({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(ze.CENTRAL_DIRECTORY_END);if(e<0){var t=!this.isSignature(0,ze.LOCAL_FILE_HEADER);throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var r=e;if(this.checkSignature(ze.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===lt.MAX_VALUE_16BITS||this.diskWithCentralDirStart===lt.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===lt.MAX_VALUE_16BITS||this.centralDirRecords===lt.MAX_VALUE_16BITS||this.centralDirSize===lt.MAX_VALUE_32BITS||this.centralDirOffset===lt.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(ze.ZIP64_CENTRAL_DIRECTORY_LOCATOR),e<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(ze.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,ze.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(ze.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(ze.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=r-i;if(n>0)this.isSignature(r,ze.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=sp(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};bc.exports=vc}),Sc=te((Yy,_c)=>{"use strict";var xa=de(),Xi=Kt(),hp=It(),xa=de(),up=yc(),fp=An(),wc=Cr();function dp(e){return new Xi.Promise(function(t,r){var i=e.decompressed.getContentWorker().pipe(new fp);i.on("error",function(n){r(n)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}_c.exports=function(e,t){var r=this;return t=xa.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:hp.utf8decode}),wc.isNode&&wc.isStream(e)?Xi.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):xa.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(i){var n=new up(t);return n.load(i),n}).then(function(n){var a=[Xi.Promise.resolve(n)],s=n.files;if(t.checkCRC32)for(var o=0;o<s.length;o++)a.push(dp(s[o]));return Xi.Promise.all(a)}).then(function(n){for(var a=n.shift(),s=a.files,o=0;o<s.length;o++){var c=s[o];r.file(c.fileNameStr,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:t.createFolders})}return a.zipComment.length&&(r.comment=a.zipComment),r})}}),xc=te((qy,Tc)=>{"use strict";function Pe(){if(!(this instanceof Pe))return new Pe;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new Pe;for(var t in this)typeof this[t]!="function"&&(e[t]=this[t]);return e}}Pe.prototype=$l();Pe.prototype.loadAsync=Sc();Pe.support=nt();Pe.defaults=wn();Pe.version="3.5.0";Pe.loadAsync=function(e,t){return new Pe().loadAsync(e,t)};Pe.external=Kt();Tc.exports=Pe}),Lc=te(()=>{}),Nc=te(()=>{}),Pc=te(()=>{}),pr=te(P=>{var p=p||{version:"4.2.0"};typeof P!="undefined"?P.fabric=p:typeof define=="function"&&define.amd&&define([],function(){return p});if(typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?p.document=document:p.document=document.implementation.createHTMLDocument(""),p.window=window;else{var Ep=Lc(),Mc=new Ep.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;p.document=Mc.document,p.jsdomImplForWrapper=Nc().implForWrapper,p.nodeCanvas=Pc().Canvas,p.window=Mc,DOMParser=p.window.DOMParser}p.isTouchSupported="ontouchstart"in p.window||"ontouchstart"in p.document||p.window&&p.window.navigator&&p.window.navigator.maxTouchPoints>0;p.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";p.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];p.DPI=96;p.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";p.commaWsp="(?:\\s+,?\\s*|,\\s*)";p.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;p.reNonWord=/[ \n\.,;!\?\-]/;p.fontPaths={};p.iMatrix=[1,0,0,1,0,0];p.svgNS="http://www.w3.org/2000/svg";p.perfLimitSizeTotal=2097152;p.maxCacheSideLimit=4096;p.minCacheSideLimit=256;p.charWidthsCache={};p.textureSize=2048;p.disableStyleCopyPaste=!1;p.enableGLFiltering=!0;p.devicePixelRatio=p.window.devicePixelRatio||p.window.webkitDevicePixelRatio||p.window.mozDevicePixelRatio||1;p.browserShadowBlurConstant=1;p.arcToSegmentsCache={};p.boundsOfCurveCache={};p.cachesBoundsOfCurve=!0;p.forceGLPutImageData=!1;p.initFilterBackend=function(){if(p.enableGLFiltering&&p.isWebglSupported&&p.isWebglSupported(p.textureSize))return console.log("max texture size: "+p.maxTextureSize),new p.WebglFilterBackend({tileSize:p.textureSize});if(p.Canvas2dFilterBackend)return new p.Canvas2dFilterBackend};typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=p);(function(){function e(n,a){if(!this.__eventListeners[n])return;var s=this.__eventListeners[n];a?s[s.indexOf(a)]=!1:p.util.array.fill(s,!1)}function t(n,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var s in n)this.on(s,n[s]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(a);return this}function r(n,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(n in this.__eventListeners)e.call(this,n);else if(arguments.length===1&&typeof arguments[0]=="object")for(var s in n)e.call(this,s,n[s]);else e.call(this,n,a);return this}function i(n,a){if(!this.__eventListeners)return this;var s=this.__eventListeners[n];if(!s)return this;for(var o=0,c=s.length;o<c;o++)s[o]&&s[o].call(this,a||{});return this.__eventListeners[n]=s.filter(function(l){return l!==!1}),this}p.Observable={fire:i,on:t,off:r}})();p.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,r){var i=this._objects;return r?i[t]=e:i.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e=this._objects,t,r=!1,i=0,n=arguments.length;i<n;i++)t=e.indexOf(arguments[i]),t!==-1&&(r=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&r&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var r=this.getObjects(),i=0,n=r.length;i<n;i++)e.call(t,r[i],i,r);return this},getObjects:function(e){return typeof e=="undefined"?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(e){return this._objects.indexOf(e)>-1},complexity:function(){return this._objects.reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}};p.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){e&&e.colorStops&&!(e instanceof p.Gradient)&&this.set(t,new p.Gradient(e))},_initPattern:function(e,t,r){e&&e.source&&!(e instanceof p.Pattern)?this.set(t,new p.Pattern(e,r)):r&&r()},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},get:function(e){return this[e]}};(function(e){var t=Math.sqrt,r=Math.atan2,i=Math.pow,n=Math.PI/180,a=Math.PI/2;p.util={cos:function(s){if(s===0)return 1;s<0&&(s=-s);var o=s/a;switch(o){case 1:case 3:return 0;case 2:return-1}return Math.cos(s)},sin:function(s){if(s===0)return 0;var o=s/a,c=1;s<0&&(c=-1);switch(o){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(s)},removeFromArray:function(s,o){var c=s.indexOf(o);return c!==-1&&s.splice(c,1),s},getRandomInt:function(s,o){return Math.floor(Math.random()*(o-s+1))+s},degreesToRadians:function(s){return s*n},radiansToDegrees:function(s){return s/n},rotatePoint:function(s,o,c){s.subtractEquals(o);var l=p.util.rotateVector(s,c);return new p.Point(l.x,l.y).addEquals(o)},rotateVector:function(s,o){var c=p.util.sin(o),l=p.util.cos(o),h=s.x*l-s.y*c,u=s.x*c+s.y*l;return{x:h,y:u}},transformPoint:function(s,o,c){return c?new p.Point(o[0]*s.x+o[2]*s.y,o[1]*s.x+o[3]*s.y):new p.Point(o[0]*s.x+o[2]*s.y+o[4],o[1]*s.x+o[3]*s.y+o[5])},makeBoundingBoxFromPoints:function(s,o){if(o)for(var c=0;c<s.length;c++)s[c]=p.util.transformPoint(s[c],o);var l=[s[0].x,s[1].x,s[2].x,s[3].x],h=p.util.array.min(l),u=p.util.array.max(l),f=u-h,d=[s[0].y,s[1].y,s[2].y,s[3].y],m=p.util.array.min(d),g=p.util.array.max(d),b=g-m;return{left:h,top:m,width:f,height:b}},invertTransform:function(s){var o=1/(s[0]*s[3]-s[1]*s[2]),c=[o*s[3],-o*s[1],-o*s[2],o*s[0]],l=p.util.transformPoint({x:s[4],y:s[5]},c,!0);return c[4]=-l.x,c[5]=-l.y,c},toFixed:function(s,o){return parseFloat(Number(s).toFixed(o))},parseUnit:function(s,o){var c=/\D{0,2}$/.exec(s),l=parseFloat(s);o||(o=p.Text.DEFAULT_SVG_FONT_SIZE);switch(c[0]){case"mm":return l*p.DPI/25.4;case"cm":return l*p.DPI/2.54;case"in":return l*p.DPI;case"pt":return l*p.DPI/72;case"pc":return l*p.DPI/72*12;case"em":return l*o;default:return l}},falseFunction:function(){return!1},getKlass:function(s,o){return s=p.util.string.camelize(s.charAt(0).toUpperCase()+s.slice(1)),p.util.resolveNamespace(o)[s]},getSvgAttributes:function(s){var o=["instantiated_by_use","style","id","class"];switch(s){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"]);break}return o},resolveNamespace:function(s){if(!s)return p;var o=s.split("."),c=o.length,l,h=e||p.window;for(l=0;l<c;++l)h=h[o[l]];return h},loadImage:function(s,o,c,l){if(!s){o&&o.call(c,s);return}var h=p.util.createImage(),u=function(){o&&o.call(c,h,!1),h=h.onload=h.onerror=null};h.onload=u,h.onerror=function(){p.log("Error loading "+h.src),o&&o.call(c,null,!0),h=h.onload=h.onerror=null},s.indexOf("data")!==0&&l!==void 0&&l!==null&&(h.crossOrigin=l),s.substring(0,14)==="data:image/svg"&&(h.onload=null,p.util.loadImageInDom(h,u)),h.src=s},loadImageInDom:function(s,o){var c=p.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(s),p.document.querySelector("body").appendChild(c),s.onload=function(){o(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(s,o,c,l){s=s||[];var h=[],u=0,f=s.length;function d(){++u===f&&(o&&o(h.filter(function(m){return m})))}if(!f){o&&o(h);return}s.forEach(function(m,g){if(!m||!m.type){d();return}var b=p.util.getKlass(m.type,c);b.fromObject(m,function(_,I){I||(h[g]=_),l&&l(m,_,I),d()})})},enlivenPatterns:function(s,o){s=s||[];function c(){++h===u&&(o&&o(l))}var l=[],h=0,u=s.length;if(!u){o&&o(l);return}s.forEach(function(f,d){f&&f.source?new p.Pattern(f,function(m){l[d]=m,c()}):(l[d]=f,c())})},groupSVGElements:function(s,o,c){var l;return s&&s.length===1?s[0]:(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),l=new p.Group(s,o),typeof c!="undefined"&&(l.sourcePath=c),l)},populateWithProperties:function(s,o,c){if(c&&Object.prototype.toString.call(c)==="[object Array]")for(var l=0,h=c.length;l<h;l++)c[l]in s&&(o[c[l]]=s[c[l]])},drawDashedLine:function(s,o,c,l,h,u){var f=l-o,d=h-c,m=t(f*f+d*d),g=r(d,f),b=u.length,_=0,I=!0;for(s.save(),s.translate(o,c),s.moveTo(0,0),s.rotate(g),o=0;m>o;)o+=u[_++%b],o>m&&(o=m),s[I?"lineTo":"moveTo"](o,0),I=!I;s.restore()},createCanvasElement:function(){return p.document.createElement("canvas")},copyCanvasElement:function(s){var o=p.util.createCanvasElement();return o.width=s.width,o.height=s.height,o.getContext("2d").drawImage(s,0,0),o},toDataURL:function(s,o,c){return s.toDataURL("image/"+o,c)},createImage:function(){return p.document.createElement("img")},multiplyTransformMatrices:function(s,o,c){return[s[0]*o[0]+s[2]*o[1],s[1]*o[0]+s[3]*o[1],s[0]*o[2]+s[2]*o[3],s[1]*o[2]+s[3]*o[3],c?0:s[0]*o[4]+s[2]*o[5]+s[4],c?0:s[1]*o[4]+s[3]*o[5]+s[5]]},qrDecompose:function(s){var o=r(s[1],s[0]),c=i(s[0],2)+i(s[1],2),l=t(c),h=(s[0]*s[3]-s[2]*s[1])/l,u=r(s[0]*s[2]+s[1]*s[3],c);return{angle:o/n,scaleX:l,scaleY:h,skewX:u/n,skewY:0,translateX:s[4],translateY:s[5]}},calcRotateMatrix:function(s){if(!s.angle)return p.iMatrix.concat();var o=p.util.degreesToRadians(s.angle),c=p.util.cos(o),l=p.util.sin(o);return[c,l,-l,c,0,0]},calcDimensionsMatrix:function(s){var o=typeof s.scaleX=="undefined"?1:s.scaleX,c=typeof s.scaleY=="undefined"?1:s.scaleY,l=[s.flipX?-o:o,0,0,s.flipY?-c:c,0,0],h=p.util.multiplyTransformMatrices,u=p.util.degreesToRadians;return s.skewX&&(l=h(l,[1,0,Math.tan(u(s.skewX)),1],!0)),s.skewY&&(l=h(l,[1,Math.tan(u(s.skewY)),0,1],!0)),l},composeMatrix:function(s){var o=[1,0,0,1,s.translateX||0,s.translateY||0],c=p.util.multiplyTransformMatrices;return s.angle&&(o=c(o,p.util.calcRotateMatrix(s))),(s.scaleX!==1||s.scaleY!==1||s.skewX||s.skewY||s.flipX||s.flipY)&&(o=c(o,p.util.calcDimensionsMatrix(s))),o},resetObjectTransform:function(s){s.scaleX=1,s.scaleY=1,s.skewX=0,s.skewY=0,s.flipX=!1,s.flipY=!1,s.rotate(0)},saveObjectTransform:function(s){return{scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,angle:s.angle,left:s.left,flipX:s.flipX,flipY:s.flipY,top:s.top}},isTransparent:function(s,o,c,l){l>0&&(o>l?o-=l:o=0,c>l?c-=l:c=0);var h=!0,u,f,d=s.getImageData(o,c,l*2||1,l*2||1),m=d.data.length;for(u=3;u<m&&!(f=d.data[u],h=f<=0,h===!1);u+=4);return d=null,h},parsePreserveAspectRatioAttribute:function(s){var o="meet",c="Mid",l="Mid",h=s.split(" "),u;return h&&h.length&&(o=h.pop(),o!=="meet"&&o!=="slice"?(u=o,o="meet"):h.length&&(u=h.pop())),c=u!=="none"?u.slice(1,4):"none",l=u!=="none"?u.slice(5,8):"none",{meetOrSlice:o,alignX:c,alignY:l}},clearFabricFontCache:function(s){s=(s||"").toLowerCase(),s?p.charWidthsCache[s]&&delete p.charWidthsCache[s]:p.charWidthsCache={}},limitDimsByArea:function(s,o){var c=Math.sqrt(o*s),l=Math.floor(o/c);return{x:Math.floor(c),y:l}},capValue:function(s,o,c){return Math.max(s,Math.min(o,c))},findScaleToFit:function(s,o){return Math.min(o.width/s.width,o.height/s.height)},findScaleToCover:function(s,o){return Math.max(o.width/s.width,o.height/s.height)},matrixToSVG:function(s){return"matrix("+s.map(function(o){return p.util.toFixed(o,p.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},sizeAfterTransform:function(s,o,c){var l=s/2,h=o/2,u=[{x:-l,y:-h},{x:l,y:-h},{x:-l,y:h},{x:l,y:h}],f=p.util.calcDimensionsMatrix(c),d=p.util.makeBoundingBoxFromPoints(u,f);return{x:d.width,y:d.height}}}})((typeof P!="undefined",P));(function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r={m:"l",M:"L"};function i(O,R,x,v,E,A,S,Z,w,T,D){var j=p.util.cos(O),W=p.util.sin(O),G=p.util.cos(R),z=p.util.sin(R),X=x*E*G-v*A*z+S,k=v*E*G+x*A*z+Z,C=T+w*(-x*E*W-v*A*j),N=D+w*(-v*E*W+x*A*j),H=X+w*(x*E*z+v*A*G),B=k+w*(v*E*z-x*A*G);return["C",C,N,H,B,X,k]}function n(O,R,x,v,E,A,S){var Z=Math.PI,w=S*Z/180,T=p.util.sin(w),D=p.util.cos(w),j=0,W=0;x=Math.abs(x),v=Math.abs(v);var G=-D*O*.5-T*R*.5,z=-D*R*.5+T*O*.5,X=x*x,k=v*v,C=z*z,N=G*G,H=X*k-X*C-k*N,B=0;if(H<0){var q=Math.sqrt(1-H/(X*k));x*=q,v*=q}else B=(E===A?-1:1)*Math.sqrt(H/(X*C+k*N));var K=B*x*z/v,re=-B*v*G/x,ie=D*K-T*re+O*.5,J=T*K+D*re+R*.5,$=a(1,0,(G-K)/x,(z-re)/v),ee=a((G-K)/x,(z-re)/v,(-G-K)/x,(-z-re)/v);A===0&&ee>0?ee-=2*Z:A===1&&ee<0&&(ee+=2*Z);for(var ae=Math.ceil(Math.abs(ee/Z*2)),ce=[],_e=ee/ae,xe=8/3*Math.sin(_e/4)*Math.sin(_e/4)/Math.sin(_e/2),Ge=$+_e,ye=0;ye<ae;ye++)ce[ye]=i($,Ge,D,T,x,v,ie,J,xe,j,W),j=ce[ye][5],W=ce[ye][6],$=Ge,Ge+=_e;return ce}function a(O,R,x,v){var E=Math.atan2(R,O),A=Math.atan2(v,x);return A>=E?A-E:2*Math.PI-(E-A)}function s(O,R,x,v,E,A,S,Z){var w;if(p.cachesBoundsOfCurve&&(w=e.call(arguments),p.boundsOfCurveCache[w]))return p.boundsOfCurveCache[w];var T=Math.sqrt,D=Math.min,j=Math.max,W=Math.abs,G=[],z=[[],[]],X,k,C,N,H,B,q,K;k=6*O-12*x+6*E,X=-3*O+9*x-9*E+3*S,C=3*x-3*O;for(var re=0;re<2;++re){if(re>0&&(k=6*R-12*v+6*A,X=-3*R+9*v-9*A+3*Z,C=3*v-3*R),W(X)<1e-12){if(W(k)<1e-12)continue;N=-C/k,0<N&&N<1&&G.push(N);continue}if(q=k*k-4*C*X,q<0)continue;K=T(q),H=(-k+K)/(2*X),0<H&&H<1&&G.push(H),B=(-k-K)/(2*X),0<B&&B<1&&G.push(B)}for(var ie,J,$=G.length,ee=$,ae;$--;)N=G[$],ae=1-N,ie=ae*ae*ae*O+3*ae*ae*N*x+3*ae*N*N*E+N*N*N*S,z[0][$]=ie,J=ae*ae*ae*R+3*ae*ae*N*v+3*ae*N*N*A+N*N*N*Z,z[1][$]=J;z[0][ee]=O,z[1][ee]=R,z[0][ee+1]=S,z[1][ee+1]=Z;var ce=[{x:D.apply(null,z[0]),y:D.apply(null,z[1])},{x:j.apply(null,z[0]),y:j.apply(null,z[1])}];return p.cachesBoundsOfCurve&&(p.boundsOfCurveCache[w]=ce),ce}function o(O,R,x){for(var v=x[1],E=x[2],A=x[3],S=x[4],Z=x[5],w=x[6],T=x[7],D=n(w-O,T-R,v,E,S,Z,A),j=0,W=D.length;j<W;j++)D[j][1]+=O,D[j][2]+=R,D[j][3]+=O,D[j][4]+=R,D[j][5]+=O,D[j][6]+=R;return D}function c(O){var R=0,x=0,v=O.length,E=0,A=0,S,Z,w,T=[],D,j,W;for(Z=0;Z<v;++Z){w=!1,S=O[Z].slice(0);switch(S[0]){case"l":S[0]="L",S[1]+=R,S[2]+=x;case"L":R=S[1],x=S[2];break;case"h":S[1]+=R;case"H":S[0]="L",S[2]=x,R=S[1];break;case"v":S[1]+=x;case"V":S[0]="L",x=S[1],S[1]=R,S[2]=x;break;case"m":S[0]="M",S[1]+=R,S[2]+=x;case"M":R=S[1],x=S[2],E=S[1],A=S[2];break;case"c":S[0]="C",S[1]+=R,S[2]+=x,S[3]+=R,S[4]+=x,S[5]+=R,S[6]+=x;case"C":j=S[3],W=S[4],R=S[5],x=S[6];break;case"s":S[0]="S",S[1]+=R,S[2]+=x,S[3]+=R,S[4]+=x;case"S":D==="C"?(j=2*R-j,W=2*x-W):(j=R,W=x),R=S[3],x=S[4],S[0]="C",S[5]=S[3],S[6]=S[4],S[3]=S[1],S[4]=S[2],S[1]=j,S[2]=W,j=S[3],W=S[4];break;case"q":S[0]="Q",S[1]+=R,S[2]+=x,S[3]+=R,S[4]+=x;case"Q":j=S[1],W=S[2],R=S[3],x=S[4];break;case"t":S[0]="T",S[1]+=R,S[2]+=x;case"T":D==="Q"?(j=2*R-j,W=2*x-W):(j=R,W=x),S[0]="Q",R=S[1],x=S[2],S[1]=j,S[2]=W,S[3]=R,S[4]=x;break;case"a":S[0]="A",S[6]+=R,S[7]+=x;case"A":w=!0,T=T.concat(o(R,x,S)),R=S[6],x=S[7];break;case"z":case"Z":R=E,x=A;break;default:}w||T.push(S),D=S[0]}return T}function l(O,R,x,v){return Math.sqrt((x-O)*(x-O)+(v-R)*(v-R))}function h(O){return O*O*O}function u(O){return 3*O*O*(1-O)}function f(O){return 3*O*(1-O)*(1-O)}function d(O){return(1-O)*(1-O)*(1-O)}function m(O,R,x,v,E,A,S,Z){return function(w){var T=h(w),D=u(w),j=f(w),W=d(w);return{x:S*T+E*D+x*j+O*W,y:Z*T+A*D+v*j+R*W}}}function g(O){return O*O}function b(O){return 2*O*(1-O)}function _(O){return(1-O)*(1-O)}function I(O,R,x,v,E,A){return function(S){var Z=g(S),w=b(S),T=_(S);return{x:E*Z+x*w+O*T,y:A*Z+v*w+R*T}}}function M(O,R,x){var v={x:R,y:x},E,A=0,S;for(S=.01;S<=1;S+=.01)E=O(S),A+=l(v.x,v.y,E.x,E.y),v=E;return A}function U(O){for(var R=0,x=O.length,v,E=0,A=0,S=0,Z=0,w=[],T,D,j=0;j<x;j++){v=O[j],D={x:E,y:A,command:v[0]};switch(v[0]){case"M":D.length=0,S=E=v[1],Z=A=v[2];break;case"L":D.length=l(E,A,v[1],v[2]),E=v[1],A=v[2];break;case"C":T=m(E,A,v[1],v[2],v[3],v[4],v[5],v[6]),D.length=M(T,E,A),E=v[5],A=v[6];break;case"Q":T=I(E,A,v[1],v[2],v[3],v[4]),D.length=M(T,E,A),E=v[3],A=v[4];break;case"Z":case"z":D.destX=S,D.destY=Z,D.length=l(E,A,S,Z),E=S,A=Z;break}R+=D.length,w.push(D)}return w.push({length:R,x:E,y:A}),w}function L(O,R,x){x||(x=U(O));for(var v=x[x.length-1]*R,E=0;v-x[E]>0&&E<x.length;)v-=x[E],E++;var A=x[E],S=v/A.length,Z=A.length,w=O[E];switch(Z){case"Z":case"z":return new p.Point(A.x,A.y).lerp(new p.Point(A.destX,A.destY),S);case"L":return new p.Point(A.x,A.y).lerp(new p.Point(w[1],w[2]),S);case"C":return m(A.x,A.y,w[1],w[2],w[3],w[4],w[5],w[6])(S);case"Q":return I(A.x,A.y,w[1],w[2],w[3],w[4])(S)}}function Y(O){var R=[],x=[],v,E,A=p.rePathCommand,S="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",Z="("+S+")"+p.commaWsp,w="([01])"+p.commaWsp+"?",T=Z+"?"+Z+"?"+Z+w+w+Z+"?("+S+")",D=new RegExp(T,"g"),j,W,G;if(!O||!O.match)return R;G=O.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var z=0,X,k=G.length;z<k;z++){v=G[z],W=v.slice(1).trim(),x.length=0;var C=v.charAt(0);if(X=[C],C.toLowerCase()==="a")for(var N;N=D.exec(W);)for(var H=1;H<N.length;H++)x.push(N[H]);else for(;j=A.exec(W);)x.push(j[0]);for(var H=0,B=x.length;H<B;H++)E=parseFloat(x[H]),isNaN(E)||X.push(E);var q=t[C.toLowerCase()],K=r[C]||C;if(X.length-1>q)for(var re=1,ie=X.length;re<ie;re+=q)R.push([C].concat(X.slice(re,re+q))),C=K;else R.push(X)}return R}function V(O,R,x,v,E,A,S,Z,w){for(var T=0,D=0,j,W=[],G=n(Z-O,w-R,x,v,A,S,E),z=0,X=G.length;z<X;z++)j=s(T,D,G[z][1],G[z][2],G[z][3],G[z][4],G[z][5],G[z][6]),W.push({x:j[0].x+O,y:j[0].y+R}),W.push({x:j[1].x+O,y:j[1].y+R}),T=G[z][5],D=G[z][6];return W}function F(O,R,x,v){v=v.slice(0).unshift("X");var E=o(R,x,v);E.forEach(function(A){O.bezierCurveTo.apply(O,A.slice(1))})}p.util.parsePath=Y,p.util.makePathSimpler=c,p.util.getPathSegmentsInfo=U,p.util.fromArcToBeizers=o,p.util.getBoundsOfCurve=s,p.util.getPointOnPath=L,p.util.getBoundsOfArc=V,p.util.drawArc=F})();(function(){var e=Array.prototype.slice;function t(s,o){for(var c=e.call(arguments,2),l=[],h=0,u=s.length;h<u;h++)l[h]=c.length?s[h][o].apply(s[h],c):s[h][o].call(s[h]);return l}function r(s,o){return a(s,o,function(c,l){return c>=l})}function i(s,o){return a(s,o,function(c,l){return c<l})}function n(s,o){for(var c=s.length;c--;)s[c]=o;return s}function a(s,o,c){if(!s||s.length===0)return;var l=s.length-1,h=o?s[l][o]:s[l];if(o)for(;l--;)c(s[l][o],h)&&(h=s[l][o]);else for(;l--;)c(s[l],h)&&(h=s[l]);return h}p.util.array={fill:n,invoke:t,min:i,max:r}})();(function(){function e(r,i,n){if(n)if(!p.isLikelyNode&&i instanceof Element)r=i;else if(i instanceof Array){r=[];for(var a=0,s=i.length;a<s;a++)r[a]=e({},i[a],n)}else if(i&&typeof i=="object")for(var o in i)o==="canvas"||o==="group"?r[o]=null:i.hasOwnProperty(o)&&(r[o]=e({},i[o],n));else r=i;else for(var o in i)r[o]=i[o];return r}function t(r,i){return e({},r,i)}p.util.object={extend:e,clone:t},p.util.object.extend(p.util,p.Observable)})();(function(){function e(a){return a.replace(/-+(.)?/g,function(s,o){return o?o.toUpperCase():""})}function t(a,s){return a.charAt(0).toUpperCase()+(s?a.slice(1):a.slice(1).toLowerCase())}function r(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(a){var s=0,o,c=[];for(s=0,o;s<a.length;s++){if((o=n(a,s))===!1)continue;c.push(o)}return c}function n(a,s){var o=a.charCodeAt(s);if(isNaN(o))return"";if(o<55296||o>57343)return a.charAt(s);if(55296<=o&&o<=56319){if(a.length<=s+1)throw"High surrogate without following low surrogate";var c=a.charCodeAt(s+1);if(56320>c||c>57343)throw"High surrogate without following low surrogate";return a.charAt(s)+a.charAt(s+1)}if(s===0)throw"Low surrogate without preceding high surrogate";var l=a.charCodeAt(s-1);if(55296>l||l>56319)throw"Low surrogate without preceding high surrogate";return!1}p.util.string={camelize:e,capitalize:t,escapeXml:r,graphemeSplit:i}})();(function(){var e=Array.prototype.slice,t=function(){},r=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),i=function(o,c,l){for(var h in c)h in o.prototype&&typeof o.prototype[h]=="function"&&(c[h]+"").indexOf("callSuper")>-1?o.prototype[h]=function(u){return function(){var f=this.constructor.superclass;this.constructor.superclass=l;var d=c[u].apply(this,arguments);if(this.constructor.superclass=f,u!=="initialize")return d}}(h):o.prototype[h]=c[h],r&&(c.toString!==Object.prototype.toString&&(o.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=c.valueOf))};function n(){}function a(o){for(var c=null,l=this;l.constructor.superclass;){var h=l.constructor.superclass.prototype[o];if(l[o]!==h){c=h;break}l=l.constructor.superclass.prototype}return c?arguments.length>1?c.apply(this,e.call(arguments,1)):c.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}function s(){var o=null,c=e.call(arguments,0);typeof c[0]=="function"&&(o=c.shift());function l(){this.initialize.apply(this,arguments)}l.superclass=o,l.subclasses=[],o&&(n.prototype=o.prototype,l.prototype=new n,o.subclasses.push(l));for(var h=0,u=c.length;h<u;h++)i(l,c[h],o);return l.prototype.initialize||(l.prototype.initialize=t),l.prototype.constructor=l,l.prototype.callSuper=a,l}p.util.createClass=s})();(function(){var e=!!p.document.createElement("div").attachEvent,t=["touchstart","touchmove","touchend"];p.util.addListener=function(i,n,a,s){i&&i.addEventListener(n,a,e?!1:s)},p.util.removeListener=function(i,n,a,s){i&&i.removeEventListener(n,a,e?!1:s)};function r(i){var n=i.changedTouches;return n&&n[0]?n[0]:i}p.util.getPointer=function(i){var n=i.target,a=p.util.getScrollLeftTop(n),s=r(i);return{x:s.clientX+a.left,y:s.clientY+a.top}},p.util.isTouchEvent=function(i){return t.indexOf(i.type)>-1||i.pointerType==="touch"}})();(function(){function e(s,o){var c=s.style;if(!c)return s;if(typeof o=="string")return s.style.cssText+=";"+o,o.indexOf("opacity")>-1?a(s,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):s;for(var l in o)if(l==="opacity")a(s,o[l]);else{var h=l==="float"||l==="cssFloat"?typeof c.styleFloat=="undefined"?"cssFloat":"styleFloat":l;c[h]=o[l]}return s}var t=p.document.createElement("div"),r=typeof t.style.opacity=="string",i=typeof t.style.filter=="string",n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(s){return s};r?a=function(s,o){return s.style.opacity=o,s}:i&&(a=function(s,o){var c=s.style;return s.currentStyle&&!s.currentStyle.hasLayout&&(c.zoom=1),n.test(c.filter)?(o=o>=.9999?"":"alpha(opacity="+o*100+")",c.filter=c.filter.replace(n,o)):c.filter+=" alpha(opacity="+o*100+")",s}),p.util.setStyle=e})();(function(){var e=Array.prototype.slice;function t(d){return typeof d=="string"?p.document.getElementById(d):d}var r,i=function(d){return e.call(d,0)};try{r=i(p.document.childNodes)instanceof Array}catch(d){}r||(i=function(d){for(var m=new Array(d.length),g=d.length;g--;)m[g]=d[g];return m});function n(d,m){var g=p.document.createElement(d);for(var b in m)b==="class"?g.className=m[b]:b==="for"?g.htmlFor=m[b]:g.setAttribute(b,m[b]);return g}function a(d,m){d&&(" "+d.className+" ").indexOf(" "+m+" ")===-1&&(d.className+=(d.className?" ":"")+m)}function s(d,m,g){return typeof m=="string"&&(m=n(m,g)),d.parentNode&&d.parentNode.replaceChild(m,d),m.appendChild(d),m}function o(d){for(var m=0,g=0,b=p.document.documentElement,_=p.document.body||{scrollLeft:0,scrollTop:0};d&&(d.parentNode||d.host)&&!(d=d.parentNode||d.host,d===p.document?(m=_.scrollLeft||b.scrollLeft||0,g=_.scrollTop||b.scrollTop||0):(m+=d.scrollLeft||0,g+=d.scrollTop||0),d.nodeType===1&&d.style.position==="fixed"););return{left:m,top:g}}function c(d){var m,g=d&&d.ownerDocument,b={left:0,top:0},_={left:0,top:0},I,M={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return _;for(var U in M)_[M[U]]+=parseInt(l(d,U),10)||0;return m=g.documentElement,typeof d.getBoundingClientRect!="undefined"&&(b=d.getBoundingClientRect()),I=o(d),{left:b.left+I.left-(m.clientLeft||0)+_.left,top:b.top+I.top-(m.clientTop||0)+_.top}}var l;p.document.defaultView&&p.document.defaultView.getComputedStyle?l=function(d,m){var g=p.document.defaultView.getComputedStyle(d,null);return g?g[m]:void 0}:l=function(d,m){var g=d.style[m];return!g&&d.currentStyle&&(g=d.currentStyle[m]),g},function(){var d=p.document.documentElement.style,m="userSelect"in d?"userSelect":"MozUserSelect"in d?"MozUserSelect":"WebkitUserSelect"in d?"WebkitUserSelect":"KhtmlUserSelect"in d?"KhtmlUserSelect":"";function g(_){return typeof _.onselectstart!="undefined"&&(_.onselectstart=p.util.falseFunction),m?_.style[m]="none":typeof _.unselectable=="string"&&(_.unselectable="on"),_}function b(_){return typeof _.onselectstart!="undefined"&&(_.onselectstart=null),m?_.style[m]="":typeof _.unselectable=="string"&&(_.unselectable=""),_}p.util.makeElementUnselectable=g,p.util.makeElementSelectable=b}();function h(d){var m=p.jsdomImplForWrapper(d);return m._canvas||m._image}function u(d){if(!p.isLikelyNode)return;var m=p.jsdomImplForWrapper(d);m&&(m._image=null,m._canvas=null,m._currentSrc=null,m._attributes=null,m._classList=null)}function f(d,m){d.imageSmoothingEnabled=d.imageSmoothingEnabled||d.webkitImageSmoothingEnabled||d.mozImageSmoothingEnabled||d.msImageSmoothingEnabled||d.oImageSmoothingEnabled,d.imageSmoothingEnabled=m}p.util.setImageSmoothing=f,p.util.getById=t,p.util.toArray=i,p.util.addClass=a,p.util.makeElement=n,p.util.wrapElement=s,p.util.getScrollLeftTop=o,p.util.getElementOffset=c,p.util.getNodeCanvas=h,p.util.cleanUpJsdomNode=u})();(function(){function e(i,n){return i+(/\?/.test(i)?"&":"?")+n}function t(){}function r(i,n){n||(n={});var a=n.method?n.method.toUpperCase():"GET",s=n.onComplete||function(){},o=new p.window.XMLHttpRequest,c=n.body||n.parameters;return o.onreadystatechange=function(){o.readyState===4&&(s(o),o.onreadystatechange=t)},a==="GET"&&(c=null,typeof n.parameters=="string"&&(i=e(i,n.parameters))),o.open(a,i,!0),(a==="POST"||a==="PUT")&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}p.util.request=r})();p.log=console.log;p.warn=console.warn;(function(){function e(){return!1}function t(o,c,l,h){return-l*Math.cos(o/h*(Math.PI/2))+l+c}function r(o){a(function(c){o||(o={});var l=c||+new Date,h=o.duration||500,u=l+h,f,d=o.onChange||e,m=o.abort||e,g=o.onComplete||e,b=o.easing||t,_="startValue"in o?o.startValue:0,I="endValue"in o?o.endValue:100,M=o.byValue||I-_;o.onStart&&o.onStart(),function U(L){f=L||+new Date;var Y=f>u?h:f-l,V=Y/h,F=b(Y,_,M,h),O=Math.abs((F-_)/M);if(m()){g(I,1,1);return}if(f>u){d(I,1,1),g(I,1,1);return}else d(F,O,V),a(U)}(l)})}var i=p.window.requestAnimationFrame||p.window.webkitRequestAnimationFrame||p.window.mozRequestAnimationFrame||p.window.oRequestAnimationFrame||p.window.msRequestAnimationFrame||function(o){return p.window.setTimeout(o,1e3/60)},n=p.window.cancelAnimationFrame||p.window.clearTimeout;function a(){return i.apply(p.window,arguments)}function s(){return n.apply(p.window,arguments)}p.util.animate=r,p.util.requestAnimFrame=a,p.util.cancelAnimFrame=s})();(function(){function e(r,i,n){var a="rgba("+parseInt(r[0]+n*(i[0]-r[0]),10)+","+parseInt(r[1]+n*(i[1]-r[1]),10)+","+parseInt(r[2]+n*(i[2]-r[2]),10);return a+=","+(r&&i?parseFloat(r[3]+n*(i[3]-r[3])):1),a+=")",a}function t(r,i,n,a){var s=new p.Color(r).getSource(),o=new p.Color(i).getSource(),c=a.onComplete,l=a.onChange;a=a||{},p.util.animate(p.util.object.extend(a,{duration:n||500,startValue:s,endValue:o,byValue:o,easing:function(h,u,f,d){var m=a.colorEasing?a.colorEasing(h,d):1-Math.cos(h/d*(Math.PI/2));return e(u,f,m)},onComplete:function(h,u,f){if(c)return c(e(o,o,0),u,f)},onChange:function(h,u,f){if(l){if(Array.isArray(h))return l(e(h,h,0),u,f);l(h,u,f)}}}))}p.util.animateColor=t})();(function(){function e(v,E,A,S){return v<Math.abs(E)?(v=E,S=A/4):E===0&&v===0?S=A/(2*Math.PI)*Math.asin(1):S=A/(2*Math.PI)*Math.asin(E/v),{a:v,c:E,p:A,s:S}}function t(v,E,A){return v.a*Math.pow(2,10*(E-=1))*Math.sin((E*A-v.s)*(2*Math.PI)/v.p)}function r(v,E,A,S){return A*((v=v/S-1)*v*v+1)+E}function i(v,E,A,S){return v/=S/2,v<1?A/2*v*v*v+E:A/2*((v-=2)*v*v+2)+E}function n(v,E,A,S){return A*(v/=S)*v*v*v+E}function a(v,E,A,S){return-A*((v=v/S-1)*v*v*v-1)+E}function s(v,E,A,S){return v/=S/2,v<1?A/2*v*v*v*v+E:-A/2*((v-=2)*v*v*v-2)+E}function o(v,E,A,S){return A*(v/=S)*v*v*v*v+E}function c(v,E,A,S){return A*((v=v/S-1)*v*v*v*v+1)+E}function l(v,E,A,S){return v/=S/2,v<1?A/2*v*v*v*v*v+E:A/2*((v-=2)*v*v*v*v+2)+E}function h(v,E,A,S){return-A*Math.cos(v/S*(Math.PI/2))+A+E}function u(v,E,A,S){return A*Math.sin(v/S*(Math.PI/2))+E}function f(v,E,A,S){return-A/2*(Math.cos(Math.PI*v/S)-1)+E}function d(v,E,A,S){return v===0?E:A*Math.pow(2,10*(v/S-1))+E}function m(v,E,A,S){return v===S?E+A:A*(-Math.pow(2,-10*v/S)+1)+E}function g(v,E,A,S){return v===0?E:v===S?E+A:(v/=S/2,v<1?A/2*Math.pow(2,10*(v-1))+E:A/2*(-Math.pow(2,-10*--v)+2)+E)}function b(v,E,A,S){return-A*(Math.sqrt(1-(v/=S)*v)-1)+E}function _(v,E,A,S){return A*Math.sqrt(1-(v=v/S-1)*v)+E}function I(v,E,A,S){return v/=S/2,v<1?-A/2*(Math.sqrt(1-v*v)-1)+E:A/2*(Math.sqrt(1-(v-=2)*v)+1)+E}function M(v,E,A,S){var Z=1.70158,w=0,T=A;if(v===0)return E;if(v/=S,v===1)return E+A;w||(w=S*.3);var D=e(T,A,w,Z);return-t(D,v,S)+E}function U(v,E,A,S){var Z=1.70158,w=0,T=A;if(v===0)return E;if(v/=S,v===1)return E+A;w||(w=S*.3);var D=e(T,A,w,Z);return D.a*Math.pow(2,-10*v)*Math.sin((v*S-D.s)*(2*Math.PI)/D.p)+D.c+E}function L(v,E,A,S){var Z=1.70158,w=0,T=A;if(v===0)return E;if(v/=S/2,v===2)return E+A;w||(w=S*(.3*1.5));var D=e(T,A,w,Z);return v<1?-.5*t(D,v,S)+E:D.a*Math.pow(2,-10*(v-=1))*Math.sin((v*S-D.s)*(2*Math.PI)/D.p)*.5+D.c+E}function Y(v,E,A,S,Z){return Z===void 0&&(Z=1.70158),A*(v/=S)*v*((Z+1)*v-Z)+E}function V(v,E,A,S,Z){return Z===void 0&&(Z=1.70158),A*((v=v/S-1)*v*((Z+1)*v+Z)+1)+E}function F(v,E,A,S,Z){return Z===void 0&&(Z=1.70158),v/=S/2,v<1?A/2*(v*v*(((Z*=1.525)+1)*v-Z))+E:A/2*((v-=2)*v*(((Z*=1.525)+1)*v+Z)+2)+E}function O(v,E,A,S){return A-R(S-v,0,A,S)+E}function R(v,E,A,S){return(v/=S)<1/2.75?A*(7.5625*v*v)+E:v<2/2.75?A*(7.5625*(v-=1.5/2.75)*v+.75)+E:v<2.5/2.75?A*(7.5625*(v-=2.25/2.75)*v+.9375)+E:A*(7.5625*(v-=2.625/2.75)*v+.984375)+E}function x(v,E,A,S){return v<S/2?O(v*2,0,A,S)*.5+E:R(v*2-S,0,A,S)*.5+A*.5+E}p.util.ease={easeInQuad:function(v,E,A,S){return A*(v/=S)*v+E},easeOutQuad:function(v,E,A,S){return-A*(v/=S)*(v-2)+E},easeInOutQuad:function(v,E,A,S){return v/=S/2,v<1?A/2*v*v+E:-A/2*(--v*(v-2)-1)+E},easeInCubic:function(v,E,A,S){return A*(v/=S)*v*v+E},easeOutCubic:r,easeInOutCubic:i,easeInQuart:n,easeOutQuart:a,easeInOutQuart:s,easeInQuint:o,easeOutQuint:c,easeInOutQuint:l,easeInSine:h,easeOutSine:u,easeInOutSine:f,easeInExpo:d,easeOutExpo:m,easeInOutExpo:g,easeInCirc:b,easeOutCirc:_,easeInOutCirc:I,easeInElastic:M,easeOutElastic:U,easeInOutElastic:L,easeInBack:Y,easeOutBack:V,easeInOutBack:F,easeInBounce:O,easeOutBounce:R,easeInOutBounce:x}})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n=t.util.toFixed,a=t.util.parseUnit,s=t.util.multiplyTransformMatrices,o=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],c=["symbol","image","marker","pattern","view","svg"],l=["pattern","defs","symbol","metadata","clipPath","mask","desc"],h=["symbol","g","a","svg","clipPath","defs"],u={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},d="font-size",m="clip-path";t.svgValidTagNamesRegEx=_(o),t.svgViewBoxElementsRegEx=_(c),t.svgInvalidAncestorsRegEx=_(l),t.svgValidParentsRegEx=_(h),t.cssRules={},t.gradientDefs={},t.clipPaths={};function g(w){return w in u?u[w]:w}function b(w,T,D,j){var W=Object.prototype.toString.call(T)==="[object Array]",G;if((w==="fill"||w==="stroke")&&T==="none")T="";else{if(w==="strokeUniform")return T==="non-scaling-stroke";if(w==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(w==="transformMatrix")D&&D.transformMatrix?T=s(D.transformMatrix,t.parseTransformAttribute(T)):T=t.parseTransformAttribute(T);else if(w==="visible")T=T!=="none"&&T!=="hidden",D&&D.visible===!1&&(T=!1);else if(w==="opacity")T=parseFloat(T),D&&typeof D.opacity!="undefined"&&(T*=D.opacity);else if(w==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(w==="charSpacing")G=a(T,j)/j*1e3;else if(w==="paintFirst"){var z=T.indexOf("fill"),X=T.indexOf("stroke"),T="fill";(z>-1&&X>-1&&X<z||z===-1&&X>-1)&&(T="stroke")}else{if(w==="href"||w==="xlink:href"||w==="font")return T;if(w==="imageSmoothing")return T==="optimizeQuality";G=W?T.map(a):a(T,j)}}return!W&&isNaN(G)?T:G}function _(w){return new RegExp("^("+w.join("|")+")\\b","i")}function I(w){for(var T in f){if(typeof w[f[T]]=="undefined"||w[T]==="")continue;if(typeof w[T]=="undefined"){if(!t.Object.prototype[T])continue;w[T]=t.Object.prototype[T]}if(w[T].indexOf("url(")===0)continue;var D=new t.Color(w[T]);w[T]=D.setAlpha(n(D.getAlpha()*w[f[T]],2)).toRgba()}return w}function M(w,T){var D,j=[],W,G,z;for(G=0,z=T.length;G<z;G++)D=T[G],W=w.getElementsByTagName(D),j=j.concat(Array.prototype.slice.call(W));return j}t.parseTransformAttribute=function(){function w($,ee){var ae=t.util.cos(ee[0]),ce=t.util.sin(ee[0]),_e=0,xe=0;ee.length===3&&(_e=ee[1],xe=ee[2]),$[0]=ae,$[1]=ce,$[2]=-ce,$[3]=ae,$[4]=_e-(ae*_e-ce*xe),$[5]=xe-(ce*_e+ae*xe)}function T($,ee){var ae=ee[0],ce=ee.length===2?ee[1]:ee[0];$[0]=ae,$[3]=ce}function D($,ee,ae){$[ae]=Math.tan(t.util.degreesToRadians(ee[0]))}function j($,ee){$[4]=ee[0],ee.length===2&&($[5]=ee[1])}var W=t.iMatrix,G=t.reNum,z=t.commaWsp,X="(?:(skewX)\\s*\\(\\s*("+G+")\\s*\\))",k="(?:(skewY)\\s*\\(\\s*("+G+")\\s*\\))",C="(?:(rotate)\\s*\\(\\s*("+G+")(?:"+z+"("+G+")"+z+"("+G+"))?\\s*\\))",N="(?:(scale)\\s*\\(\\s*("+G+")(?:"+z+"("+G+"))?\\s*\\))",H="(?:(translate)\\s*\\(\\s*("+G+")(?:"+z+"("+G+"))?\\s*\\))",B="(?:(matrix)\\s*\\(\\s*("+G+")"+z+"("+G+")"+z+"("+G+")"+z+"("+G+")"+z+"("+G+")"+z+"("+G+")\\s*\\))",q="(?:"+B+"|"+H+"|"+N+"|"+C+"|"+X+"|"+k+")",K="(?:"+q+"(?:"+z+"*"+q+")*)",re="^\\s*(?:"+K+"?)\\s*$",ie=new RegExp(re),J=new RegExp(q,"g");return function($){var ee=W.concat(),ae=[];if(!$||$&&!ie.test($))return ee;$.replace(J,function(_e){var xe=new RegExp(q).exec(_e).filter(function(sn){return!!sn}),Ge=xe[1],ye=xe.slice(2).map(parseFloat);switch(Ge){case"translate":j(ee,ye);break;case"rotate":ye[0]=t.util.degreesToRadians(ye[0]),w(ee,ye);break;case"scale":T(ee,ye);break;case"skewX":D(ee,ye,2);break;case"skewY":D(ee,ye,1);break;case"matrix":ee=ye;break}ae.push(ee.concat()),ee=W.concat()});for(var ce=ae[0];ae.length>1;)ae.shift(),ce=t.util.multiplyTransformMatrices(ce,ae[0]);return ce}}();function U(w,T){var D,j;w.replace(/;\s*$/,"").split(";").forEach(function(W){var G=W.split(":");D=G[0].trim().toLowerCase(),j=G[1].trim(),T[D]=j})}function L(w,T){var D,j;for(var W in w){if(typeof w[W]=="undefined")continue;D=W.toLowerCase(),j=w[W],T[D]=j}}function Y(w,T){var D={};for(var j in t.cssRules[T])if(V(w,j.split(" ")))for(var W in t.cssRules[T][j])D[W]=t.cssRules[T][j][W];return D}function V(w,T){var D,j=!0;return D=O(w,T.pop()),D&&T.length&&(j=F(w,T)),D&&j&&T.length===0}function F(w,T){for(var D,j=!0;w.parentNode&&w.parentNode.nodeType===1&&T.length;)j&&(D=T.pop()),w=w.parentNode,j=O(w,D);return T.length===0}function O(w,T){var D=w.nodeName,j=w.getAttribute("class"),W=w.getAttribute("id"),G,z;if(G=new RegExp("^"+D,"i"),T=T.replace(G,""),W&&T.length&&(G=new RegExp("#"+W+"(?![a-zA-Z\\-]+)","i"),T=T.replace(G,"")),j&&T.length)for(j=j.split(" "),z=j.length;z--;)G=new RegExp("\\."+j[z]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(G,"");return T.length===0}function R(w,T){var D;if(w.getElementById&&(D=w.getElementById(T)),D)return D;var j,W,G,z=w.getElementsByTagName("*");for(W=0,G=z.length;W<G;W++)if(j=z[W],T===j.getAttribute("id"))return j}function x(w){for(var T=M(w,["use","svg:use"]),D=0;T.length&&D<T.length;){var j=T[D],W=(j.getAttribute("xlink:href")||j.getAttribute("href")).substr(1),G=j.getAttribute("x")||0,z=j.getAttribute("y")||0,X=R(w,W).cloneNode(!0),k=(X.getAttribute("transform")||"")+" translate("+G+", "+z+")",C,N=T.length,H,B,q,K,re=t.svgNS;if(E(X),/^svg$/i.test(X.nodeName)){var ie=X.ownerDocument.createElementNS(re,"g");for(B=0,q=X.attributes,K=q.length;B<K;B++)H=q.item(B),ie.setAttributeNS(re,H.nodeName,H.nodeValue);for(;X.firstChild;)ie.appendChild(X.firstChild);X=ie}for(B=0,q=j.attributes,K=q.length;B<K;B++){if(H=q.item(B),H.nodeName==="x"||H.nodeName==="y"||H.nodeName==="xlink:href"||H.nodeName==="href")continue;H.nodeName==="transform"?k=H.nodeValue+" "+k:X.setAttribute(H.nodeName,H.nodeValue)}X.setAttribute("transform",k),X.setAttribute("instantiated_by_use","1"),X.removeAttribute("id"),C=j.parentNode,C.replaceChild(X,j),T.length===N&&D++}}var v=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function E(w){if(!t.svgViewBoxElementsRegEx.test(w.nodeName))return;var T=w.getAttribute("viewBox"),D=1,j=1,W=0,G=0,z,X,k,C,N=w.getAttribute("width"),H=w.getAttribute("height"),B=w.getAttribute("x")||0,q=w.getAttribute("y")||0,K=w.getAttribute("preserveAspectRatio")||"",re=!T||!(T=T.match(v)),ie=!N||!H||N==="100%"||H==="100%",J=re&&ie,$={},ee="",ae=0,ce=0;if($.width=0,$.height=0,$.toBeParsed=J,re&&((B||q)&&w.parentNode.nodeName!=="#document"&&(ee=" translate("+a(B)+" "+a(q)+") ",k=(w.getAttribute("transform")||"")+ee,w.setAttribute("transform",k),w.removeAttribute("x"),w.removeAttribute("y"))),J)return $;if(re)return $.width=a(N),$.height=a(H),$;if(W=-parseFloat(T[1]),G=-parseFloat(T[2]),z=parseFloat(T[3]),X=parseFloat(T[4]),$.minX=W,$.minY=G,$.viewBoxWidth=z,$.viewBoxHeight=X,ie?($.width=z,$.height=X):($.width=a(N),$.height=a(H),D=$.width/z,j=$.height/X),K=t.util.parsePreserveAspectRatioAttribute(K),K.alignX!=="none"&&(K.meetOrSlice==="meet"&&(j=D=D>j?j:D),K.meetOrSlice==="slice"&&(j=D=D>j?D:j),ae=$.width-z*D,ce=$.height-X*D,K.alignX==="Mid"&&(ae/=2),K.alignY==="Mid"&&(ce/=2),K.alignX==="Min"&&(ae=0),K.alignY==="Min"&&(ce=0)),D===1&&j===1&&W===0&&G===0&&B===0&&q===0)return $;if((B||q)&&w.parentNode.nodeName!=="#document"&&(ee=" translate("+a(B)+" "+a(q)+") "),k=ee+" matrix("+D+" 0 0 "+j+" "+(W*D+ae)+" "+(G*j+ce)+") ",w.nodeName==="svg"){for(C=w.ownerDocument.createElementNS(t.svgNS,"g");w.firstChild;)C.appendChild(w.firstChild);w.appendChild(C)}else C=w,C.removeAttribute("x"),C.removeAttribute("y"),k=C.getAttribute("transform")+k;return C.setAttribute("transform",k),$}function A(w,T){for(;w&&(w=w.parentNode);)if(w.nodeName&&T.test(w.nodeName.replace("svg:",""))&&!w.getAttribute("instantiated_by_use"))return!0;return!1}t.parseSVGDocument=function(w,T,D,j){if(!w)return;x(w);var W=t.Object.__uid++,G,z,X=E(w),k=t.util.toArray(w.getElementsByTagName("*"));if(X.crossOrigin=j&&j.crossOrigin,X.svgUid=W,k.length===0&&t.isLikelyNode){k=w.selectNodes('//*[name(.)!="svg"]');var C=[];for(G=0,z=k.length;G<z;G++)C[G]=k[G];k=C}var N=k.filter(function(B){return E(B),t.svgValidTagNamesRegEx.test(B.nodeName.replace("svg:",""))&&!A(B,t.svgInvalidAncestorsRegEx)});if(!N||N&&!N.length){T&&T([],{});return}var H={};k.filter(function(B){return B.nodeName.replace("svg:","")==="clipPath"}).forEach(function(B){var q=B.getAttribute("id");H[q]=t.util.toArray(B.getElementsByTagName("*")).filter(function(K){return t.svgValidTagNamesRegEx.test(K.nodeName.replace("svg:",""))})}),t.gradientDefs[W]=t.getGradientDefs(w),t.cssRules[W]=t.getCSSRules(w),t.clipPaths[W]=H,t.parseElements(N,function(B,q){T&&(T(B,X,q,k),delete t.gradientDefs[W],delete t.cssRules[W],delete t.clipPaths[W])},i(X),D,j)};function S(w,T){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],j="xlink:href",W=T.getAttribute(j).substr(1),G=R(w,W);if(G&&G.getAttribute(j)&&S(w,G),D.forEach(function(X){G&&!T.hasAttribute(X)&&G.hasAttribute(X)&&T.setAttribute(X,G.getAttribute(X))}),!T.children.length)for(var z=G.cloneNode(!0);z.firstChild;)T.appendChild(z.firstChild);T.removeAttribute(j)}var Z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");r(t,{parseFontDeclaration:function(w,T){var D=w.match(Z);if(!D)return;var j=D[1],W=D[3],G=D[4],z=D[5],X=D[6];j&&(T.fontStyle=j),W&&(T.fontWeight=isNaN(parseFloat(W))?W:parseFloat(W)),G&&(T.fontSize=a(G)),X&&(T.fontFamily=X),z&&(T.lineHeight=z==="normal"?1:z)},getGradientDefs:function(w){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=M(w,T),j,W=0,G={};for(W=D.length;W--;)j=D[W],j.getAttribute("xlink:href")&&S(w,j),G[j.getAttribute("id")]=j;return G},parseAttributes:function(w,T,D){if(!w)return;var j,W={},G,z;typeof D=="undefined"&&(D=w.getAttribute("svgUid")),w.parentNode&&t.svgValidParentsRegEx.test(w.parentNode.nodeName)&&(W=t.parseAttributes(w.parentNode,T,D));var X=T.reduce(function(K,re){return j=w.getAttribute(re),j&&(K[re]=j),K},{}),k=r(Y(w,D),t.parseStyleAttribute(w));X=r(X,k),k[m]&&w.setAttribute(m,k[m]),G=z=W.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,X[d]&&(X[d]=G=a(X[d],z));var C,N,H={};for(var B in X)C=g(B),N=b(C,X[B],W,G),H[C]=N;H&&H.font&&t.parseFontDeclaration(H.font,H);var q=r(W,H);return t.svgValidParentsRegEx.test(w.nodeName)?q:I(q)},parseElements:function(w,T,D,j,W){new t.ElementsParser(w,T,D,j,W).parse()},parseStyleAttribute:function(w){var T={},D=w.getAttribute("style");return D&&(typeof D=="string"?U(D,T):L(D,T)),T},parsePointsAttribute:function(w){if(!w)return null;w=w.replace(/,/g," ").trim(),w=w.split(/\s+/);var T=[],D,j;for(D=0,j=w.length;D<j;D+=2)T.push({x:parseFloat(w[D]),y:parseFloat(w[D+1])});return T},getCSSRules:function(w){var T=w.getElementsByTagName("style"),D,j,W={},G;for(D=0,j=T.length;D<j;D++){var z=T[D].textContent||"";if(z=z.replace(/\/\*[\s\S]*?\*\//g,""),z.trim()==="")continue;G=z.match(/[^{]*\{[\s\S]*?\}/g),G=G.map(function(X){return X.trim()}),G.forEach(function(X){var k=X.match(/([\s\S]*?)\s*\{([^}]*)\}/),C={},N=k[2].trim(),H=N.replace(/;$/,"").split(/\s*;\s*/);for(D=0,j=H.length;D<j;D++){var B=H[D].split(/\s*:\s*/),q=B[0],K=B[1];C[q]=K}X=k[1],X.split(",").forEach(function(re){if(re=re.replace(/^svg/i,"").trim(),re==="")return;W[re]?t.util.object.extend(W[re],C):W[re]=t.util.object.clone(C)})})}return W},loadSVGFromURL:function(w,T,D,j){w=w.replace(/^\n\s*/,"").trim(),new t.util.request(w,{method:"get",onComplete:W});function W(G){var z=G.responseXML;if(!z||!z.documentElement)return T&&T(null),!1;t.parseSVGDocument(z.documentElement,function(X,k,C,N){T&&T(X,k,C,N)},D,j)}},loadSVGFromString:function(w,T,D,j){var W=new t.window.DOMParser,G=W.parseFromString(w.trim(),"text/xml");t.parseSVGDocument(G.documentElement,function(z,X,k,C){T(z,X,k,C)},D,j)}})})((typeof P!="undefined",P));p.ElementsParser=function(e,t,r,i,n,a){this.elements=e,this.callback=t,this.options=r,this.reviver=i,this.svgUid=r&&r.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a};(function(e){e.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var t=this;this.elements.forEach(function(r,i){r.setAttribute("svgUid",t.svgUid),t.createObject(r,i)})},e.findTag=function(t){return p[p.util.string.capitalize(t.tagName.replace("svg:",""))]},e.createObject=function(t,r){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(r,t),this.options)}catch(n){p.log(n)}else this.checkIfDone()},e.createCallback=function(t,r){var i=this;return function(n){var a;i.resolveGradient(n,r,"fill"),i.resolveGradient(n,r,"stroke"),n instanceof p.Image&&n._originalElement&&(a=n.parsePreserveAspectRatioAttribute(r)),n._removeTransformMatrix(a),i.resolveClipPath(n,r),i.reviver&&i.reviver(r,n),i.instances[t]=n,i.checkIfDone()}},e.extractPropertyDefinition=function(t,r,i){var n=t[r],a=this.regexUrl;if(!a.test(n))return;a.lastIndex=0;var s=a.exec(n)[1];return a.lastIndex=0,p[i][this.svgUid][s]},e.resolveGradient=function(t,r,i){var n=this.extractPropertyDefinition(t,i,"gradientDefs");if(n){var a=r.getAttribute(i+"-opacity"),s=p.Gradient.fromElement(n,t,a,this.options);t.set(i,s)}},e.createClipPathCallback=function(t,r){return function(i){i._removeTransformMatrix(),i.fillRule=i.clipRule,r.push(i)}},e.resolveClipPath=function(t,r){var i=this.extractPropertyDefinition(t,"clipPath","clipPaths"),n,a,s,o,c,l;if(i){o=[],s=p.util.invertTransform(t.calcTransformMatrix());for(var h=i[0].parentNode,u=r;u.parentNode&&u.getAttribute("clip-path")!==t.clipPath;)u=u.parentNode;u.parentNode.appendChild(h);for(var f=0;f<i.length;f++)n=i[f],a=this.findTag(n),a.fromElement(n,this.createClipPathCallback(t,o),this.options);o.length===1?i=o[0]:i=new p.Group(o),c=p.util.multiplyTransformMatrices(s,i.calcTransformMatrix()),i.clipPath&&this.resolveClipPath(i,u);var l=p.util.qrDecompose(c);i.flipX=!1,i.flipY=!1,i.set("scaleX",l.scaleX),i.set("scaleY",l.scaleY),i.angle=l.angle,i.skewX=l.skewX,i.skewY=0,i.setPositionByOrigin({x:l.translateX,y:l.translateY},"center","center"),t.clipPath=i}else delete t.clipPath},e.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(t){return t!=null}),this.callback(this.instances,this.elements))}})(p.ElementsParser.prototype);(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=r;function r(i,n){this.x=i,this.y=n}r.prototype={type:"point",constructor:r,add:function(i){return new r(this.x+i.x,this.y+i.y)},addEquals:function(i){return this.x+=i.x,this.y+=i.y,this},scalarAdd:function(i){return new r(this.x+i,this.y+i)},scalarAddEquals:function(i){return this.x+=i,this.y+=i,this},subtract:function(i){return new r(this.x-i.x,this.y-i.y)},subtractEquals:function(i){return this.x-=i.x,this.y-=i.y,this},scalarSubtract:function(i){return new r(this.x-i,this.y-i)},scalarSubtractEquals:function(i){return this.x-=i,this.y-=i,this},multiply:function(i){return new r(this.x*i,this.y*i)},multiplyEquals:function(i){return this.x*=i,this.y*=i,this},divide:function(i){return new r(this.x/i,this.y/i)},divideEquals:function(i){return this.x/=i,this.y/=i,this},eq:function(i){return this.x===i.x&&this.y===i.y},lt:function(i){return this.x<i.x&&this.y<i.y},lte:function(i){return this.x<=i.x&&this.y<=i.y},gt:function(i){return this.x>i.x&&this.y>i.y},gte:function(i){return this.x>=i.x&&this.y>=i.y},lerp:function(i,n){return typeof n=="undefined"&&(n=.5),n=Math.max(Math.min(1,n),0),new r(this.x+(i.x-this.x)*n,this.y+(i.y-this.y)*n)},distanceFrom:function(i){var n=this.x-i.x,a=this.y-i.y;return Math.sqrt(n*n+a*a)},midPointFrom:function(i){return this.lerp(i)},min:function(i){return new r(Math.min(this.x,i.x),Math.min(this.y,i.y))},max:function(i){return new r(Math.max(this.x,i.x),Math.max(this.y,i.y))},toString:function(){return this.x+","+this.y},setXY:function(i,n){return this.x=i,this.y=n,this},setX:function(i){return this.x=i,this},setY:function(i){return this.y=i,this},setFromPoint:function(i){return this.x=i.x,this.y=i.y,this},swap:function(i){var n=this.x,a=this.y;this.x=i.x,this.y=i.y,i.x=n,i.y=a},clone:function(){return new r(this.x,this.y)}}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}function r(i){this.status=i,this.points=[]}t.Intersection=r,t.Intersection.prototype={constructor:r,appendPoint:function(i){return this.points.push(i),this},appendPoints:function(i){return this.points=this.points.concat(i),this}},t.Intersection.intersectLineLine=function(i,n,a,s){var o,c=(s.x-a.x)*(i.y-a.y)-(s.y-a.y)*(i.x-a.x),l=(n.x-i.x)*(i.y-a.y)-(n.y-i.y)*(i.x-a.x),h=(s.y-a.y)*(n.x-i.x)-(s.x-a.x)*(n.y-i.y);if(h!==0){var u=c/h,f=l/h;0<=u&&u<=1&&0<=f&&f<=1?(o=new r("Intersection"),o.appendPoint(new t.Point(i.x+u*(n.x-i.x),i.y+u*(n.y-i.y)))):o=new r}else c===0||l===0?o=new r("Coincident"):o=new r("Parallel");return o},t.Intersection.intersectLinePolygon=function(i,n,a){var s=new r,o=a.length,c,l,h,u;for(u=0;u<o;u++)c=a[u],l=a[(u+1)%o],h=r.intersectLineLine(i,n,c,l),s.appendPoints(h.points);return s.points.length>0&&(s.status="Intersection"),s},t.Intersection.intersectPolygonPolygon=function(i,n){var a=new r,s=i.length,o;for(o=0;o<s;o++){var c=i[o],l=i[(o+1)%s],h=r.intersectLinePolygon(c,l,n);a.appendPoints(h.points)}return a.points.length>0&&(a.status="Intersection"),a},t.Intersection.intersectPolygonRectangle=function(i,n,a){var s=n.min(a),o=n.max(a),c=new t.Point(o.x,s.y),l=new t.Point(s.x,o.y),h=r.intersectLinePolygon(s,c,i),u=r.intersectLinePolygon(c,o,i),f=r.intersectLinePolygon(o,l,i),d=r.intersectLinePolygon(l,s,i),m=new r;return m.appendPoints(h.points),m.appendPoints(u.points),m.appendPoints(f.points),m.appendPoints(d.points),m.points.length>0&&(m.status="Intersection"),m}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}function r(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}t.Color=r,t.Color.prototype={_tryParsingColor:function(n){var a;n in r.colorNameMap&&(n=r.colorNameMap[n]),n==="transparent"&&(a=[255,255,255,0]),a||(a=r.sourceFromHex(n)),a||(a=r.sourceFromRgb(n)),a||(a=r.sourceFromHsl(n)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(n,a,s){n/=255,a/=255,s/=255;var o,c,l,h=t.util.array.max([n,a,s]),u=t.util.array.min([n,a,s]);if(l=(h+u)/2,h===u)o=c=0;else{var f=h-u;c=l>.5?f/(2-h-u):f/(h+u);switch(h){case n:o=(a-s)/f+(a<s?6:0);break;case a:o=(s-n)/f+2;break;case s:o=(n-a)/f+4;break}o/=6}return[Math.round(o*360),Math.round(c*100),Math.round(l*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),a=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var n=this.getSource(),a=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+n[3]+")"},toHex:function(){var n=this.getSource(),a,s,o;return a=n[0].toString(16),a=a.length===1?"0"+a:a,s=n[1].toString(16),s=s.length===1?"0"+s:s,o=n[2].toString(16),o=o.length===1?"0"+o:o,a.toUpperCase()+s.toUpperCase()+o.toUpperCase()},toHexa:function(){var n=this.getSource(),a;return a=Math.round(n[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var a=this.getSource();return a[3]=n,this.setSource(a),this},toGrayscale:function(){var n=this.getSource(),a=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),s=n[3];return this.setSource([a,a,a,s]),this},toBlackWhite:function(n){var a=this.getSource(),s=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),o=a[3];return n=n||127,s=Number(s)<Number(n)?0:255,this.setSource([s,s,s,o]),this},overlayWith:function(n){n instanceof r||(n=new r(n));var a=[],s=this.getAlpha(),o=.5,c=this.getSource(),l=n.getSource(),h;for(h=0;h<3;h++)a.push(Math.round(c[h]*(1-o)+l[h]*o));return a[3]=s,this.setSource(a),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(n,a,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(a-n)*6*s:s<1/2?a:s<2/3?n+(a-n)*(2/3-s)*6:n}t.Color.fromRgb=function(n){return r.fromSource(r.sourceFromRgb(n))},t.Color.sourceFromRgb=function(n){var a=n.match(r.reRGBa);if(a){var s=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),o=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),c=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(s,10),parseInt(o,10),parseInt(c,10),a[4]?parseFloat(a[4]):1]}},t.Color.fromRgba=r.fromRgb,t.Color.fromHsl=function(n){return r.fromSource(r.sourceFromHsl(n))},t.Color.sourceFromHsl=function(n){var a=n.match(r.reHSLa);if(!a)return;var s=(parseFloat(a[1])%360+360)%360/360,o=parseFloat(a[2])/(/%$/.test(a[2])?100:1),c=parseFloat(a[3])/(/%$/.test(a[3])?100:1),l,h,u;if(o===0)l=h=u=c;else{var f=c<=.5?c*(o+1):c+o-c*o,d=c*2-f;l=i(d,f,s+1/3),h=i(d,f,s),u=i(d,f,s-1/3)}return[Math.round(l*255),Math.round(h*255),Math.round(u*255),a[4]?parseFloat(a[4]):1]},t.Color.fromHsla=r.fromHsl,t.Color.fromHex=function(n){return r.fromSource(r.sourceFromHex(n))},t.Color.sourceFromHex=function(n){if(n.match(r.reHex)){var a=n.slice(n.indexOf("#")+1),s=a.length===3||a.length===4,o=a.length===8||a.length===4,c=s?a.charAt(0)+a.charAt(0):a.substring(0,2),l=s?a.charAt(1)+a.charAt(1):a.substring(2,4),h=s?a.charAt(2)+a.charAt(2):a.substring(4,6),u=o?s?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(c,16),parseInt(l,16),parseInt(h,16),parseFloat((parseInt(u,16)/255).toFixed(2))]}},t.Color.fromSource=function(n){var a=new r;return a.setSource(n),a}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=["e","se","s","sw","w","nw","n","ne","e"],i=["ns","nesw","ew","nwse"],n={},a="left",s="top",o="right",c="bottom",l="center",h={top:c,bottom:s,left:o,right:a,center:l},u=t.util.radiansToDegrees,f=Math.sign||function(k){return(k>0)-(k<0)||+k};function d(k,C){var N=k.angle+u(Math.atan2(C.y,C.x))+360;return Math.round(N%360/45)}function m(k,C){var N=C.transform.target,H=N.canvas,B=t.util.object.clone(C);B.target=N,H&&H.fire("object:"+k,B),N.fire(k,C)}function g(k,C){var N=C.canvas,H=N.uniScaleKey,B=k[H];return N.uniformScaling&&!B||!N.uniformScaling&&B}function b(k){return k.originX===l&&k.originY===l}function _(k,C,N){var H=k.lockScalingX,B=k.lockScalingY;return H&&B||(!C&&(H||B)&&N||H&&C==="x")?!0:!!(B&&C==="y")}function I(k,C,N){var H="not-allowed",B=g(k,N),q="";if(C.x!==0&&C.y===0?q="x":C.x===0&&C.y!==0&&(q="y"),_(N,q,B))return H;var K=d(N,C);return r[K]+"-resize"}function M(k,C,N){var H="not-allowed";if(C.x!==0&&N.lockSkewingY)return H;if(C.y!==0&&N.lockSkewingX)return H;var B=d(N,C)%4;return i[B]+"-resize"}function U(k,C,N){return k[N.canvas.altActionKey]?n.skewCursorStyleHandler(k,C,N):n.scaleCursorStyleHandler(k,C,N)}function L(k,C,N){var H=k[N.canvas.altActionKey];if(C.x===0)return H?"skewX":"scaleY";if(C.y===0)return H?"skewY":"scaleX"}function Y(k,C,N){return N.lockRotation?"not-allowed":C.cursorStyle}function V(k,C,N,H){return{e:k,transform:C,pointer:{x:N,y:H}}}function F(k){return function(C,N,H,B){var q=N.target,K=q.getCenterPoint(),re=q.translateToOriginPoint(K,N.originX,N.originY),ie=k(C,N,H,B);return q.setPositionByOrigin(re,N.originX,N.originY),ie}}function O(k,C,N,H,B){var q=k.target,K=q.controls[k.corner],re=q.canvas.getZoom(),ie=q.padding/re,J=q.toLocalPoint(new t.Point(H,B),C,N);return J.x>=ie&&(J.x-=ie),J.x<=-ie&&(J.x+=ie),J.y>=ie&&(J.y-=ie),J.y<=ie&&(J.y+=ie),J.x-=K.offsetX,J.y-=K.offsetY,J}function R(k){return k.flipX&&!k.flipY||!k.flipX&&k.flipY}function x(k,C,N,H,B){if(k[C]!==0){var q=k._getTransformedDimensions()[H],K=B/q*k[N];k.set(N,K)}}function v(k,C,N,H){var B=C.target,q=B._getTransformedDimensions(0,B.skewY),K=O(C,C.originX,C.originY,N,H),re=Math.abs(K.x*2)-q.x,ie=B.skewX,J;re<2?J=0:(J=u(Math.atan2(re/B.scaleX,q.y/B.scaleY)),C.originX===a&&C.originY===c&&(J=-J),C.originX===o&&C.originY===s&&(J=-J),R(B)&&(J=-J));var $=ie!==J;if($){var ee=B._getTransformedDimensions().y;B.set("skewX",J),x(B,"skewY","scaleY","y",ee),m("skewing",V(k,C,N,H))}return $}function E(k,C,N,H){var B=C.target,q=B._getTransformedDimensions(B.skewX,0),K=O(C,C.originX,C.originY,N,H),re=Math.abs(K.y*2)-q.y,ie=B.skewY,J;re<2?J=0:(J=u(Math.atan2(re/B.scaleY,q.x/B.scaleX)),C.originX===a&&C.originY===c&&(J=-J),C.originX===o&&C.originY===s&&(J=-J),R(B)&&(J=-J));var $=ie!==J;if($){var ee=B._getTransformedDimensions().x;B.set("skewY",J),x(B,"skewX","scaleX","x",ee),m("skewing",V(k,C,N,H))}return $}function A(k,C,N,H){var B=C.target,q=B.skewX,K,re=C.originY;if(B.lockSkewingX)return!1;if(q===0){var ie=O(C,l,l,N,H);ie.x>0?K=a:K=o}else q>0&&(K=re===s?a:o),q<0&&(K=re===s?o:a),R(B)&&(K=K===a?o:a);C.originX=K;var J=F(v);return J(k,C,N,H)}function S(k,C,N,H){var B=C.target,q=B.skewY,K,re=C.originX;if(B.lockSkewingY)return!1;if(q===0){var ie=O(C,l,l,N,H);ie.y>0?K=s:K=c}else q>0&&(K=re===a?s:c),q<0&&(K=re===a?c:s),R(B)&&(K=K===s?c:s);C.originY=K;var J=F(E);return J(k,C,N,H)}function Z(k,C,N,H){var B=C,q=B.target,K=q.translateToOriginPoint(q.getCenterPoint(),B.originX,B.originY);if(q.lockRotation)return!1;var re=Math.atan2(B.ey-K.y,B.ex-K.x),ie=Math.atan2(H-K.y,N-K.x),J=u(ie-re+B.theta),$=!0;if(q.snapAngle>0){var ee=q.snapAngle,ae=q.snapThreshold||ee,ce=Math.ceil(J/ee)*ee,_e=Math.floor(J/ee)*ee;Math.abs(J-_e)<ae?J=_e:Math.abs(J-ce)<ae&&(J=ce)}return J<0&&(J=360+J),J%=360,$=q.angle!==J,q.angle=J,$&&m("rotating",V(k,C,N,H)),$}function w(k,C,N,H,B){B=B||{};var q=C.target,K=q.lockScalingX,re=q.lockScalingY,ie=B.by,J,$,ee,ae,ce=g(k,q),_e=_(q,ie,ce),xe,Ge,ye=C.gestureScale;if(_e)return!1;if(ye)$=C.scaleX*ye,ee=C.scaleY*ye;else{if(J=O(C,C.originX,C.originY,N,H),xe=ie!=="y"?f(J.x):1,Ge=ie!=="x"?f(J.y):1,C.signX||(C.signX=xe),C.signY||(C.signY=Ge),q.lockScalingFlip&&(C.signX!==xe||C.signY!==Ge))return!1;if(ae=q._getTransformedDimensions(),ce&&!ie){var sn=Math.abs(J.x)+Math.abs(J.y),hi=C.original,Gh=Math.abs(ae.x*hi.scaleX/q.scaleX)+Math.abs(ae.y*hi.scaleY/q.scaleY),Ya=sn/Gh,ln;$=hi.scaleX*Ya,ee=hi.scaleY*Ya}else $=Math.abs(J.x*q.scaleX/ae.x),ee=Math.abs(J.y*q.scaleY/ae.y);b(C)&&($*=2,ee*=2),C.signX!==xe&&ie!=="y"&&(C.originX=h[C.originX],$*=-1,C.signX=xe),C.signY!==Ge&&ie!=="x"&&(C.originY=h[C.originY],ee*=-1,C.signY=Ge)}var Vh=q.scaleX,Uh=q.scaleY;return ie?(ie==="x"&&q.set("scaleX",$),ie==="y"&&q.set("scaleY",ee)):(!K&&q.set("scaleX",$),!re&&q.set("scaleY",ee)),ln=Vh!==q.scaleX||Uh!==q.scaleY,ln&&m("scaling",V(k,C,N,H)),ln}function T(k,C,N,H){return w(k,C,N,H)}function D(k,C,N,H){return w(k,C,N,H,{by:"x"})}function j(k,C,N,H){return w(k,C,N,H,{by:"y"})}function W(k,C,N,H){return k[C.target.canvas.altActionKey]?n.skewHandlerX(k,C,N,H):n.scalingY(k,C,N,H)}function G(k,C,N,H){return k[C.target.canvas.altActionKey]?n.skewHandlerY(k,C,N,H):n.scalingX(k,C,N,H)}function z(k,C,N,H){var B=C.target,q=O(C,C.originX,C.originY,N,H),K=B.strokeWidth/(B.strokeUniform?B.scaleX:1),re=b(C)?2:1,ie=B.width,J,$=Math.abs(q.x*re/B.scaleX)-K;return B.set("width",Math.max($,0)),J=ie!==$,J&&m("resizing",V(k,C,N,H)),J}function X(k,C,N,H){var B=C.target,q=N-C.offsetX,K=H-C.offsetY,re=!B.get("lockMovementX")&&B.left!==q,ie=!B.get("lockMovementY")&&B.top!==K;return re&&B.set("left",q),ie&&B.set("top",K),(re||ie)&&m("moving",V(k,C,N,H)),re||ie}n.scaleCursorStyleHandler=I,n.skewCursorStyleHandler=M,n.scaleSkewCursorStyleHandler=U,n.rotationWithSnapping=F(Z),n.scalingEqually=F(T),n.scalingX=F(D),n.scalingY=F(j),n.scalingYOrSkewingX=W,n.scalingXOrSkewingY=G,n.changeWidth=F(z),n.skewHandlerX=A,n.skewHandlerY=S,n.dragHandler=X,n.scaleOrSkewActionName=L,n.rotationStyleHandler=Y,n.fireEvent=m,n.wrapWithFixedAnchor=F,n.getLocalPoint=O,t.controlsUtils=n})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.degreesToRadians,i=t.controlsUtils;function n(s,o,c,l,h){l=l||{};var u=l.cornerSize||h.cornerSize,f=typeof l.transparentCorners!="undefined"?l.transparentCorners:this.transparentCorners,d=f?"stroke":"fill",m=!f&&(l.cornerStrokeColor||h.cornerStrokeColor);s.save(),s.fillStyle=l.cornerColor||h.cornerColor,s.strokeStyle=l.cornerStrokeColor||h.cornerStrokeColor,s.lineWidth=1,s.beginPath(),s.arc(o,c,u/2,0,2*Math.PI,!1),s[d](),m&&s.stroke(),s.restore()}function a(s,o,c,l,h){l=l||{};var u=l.cornerSize||h.cornerSize,f=typeof l.transparentCorners!="undefined"?l.transparentCorners:h.transparentCorners,d=f?"stroke":"fill",m=!f&&(l.cornerStrokeColor||h.cornerStrokeColor),g=u/2;s.save(),s.fillStyle=l.cornerColor||h.cornerColor,s.strokeStyle=l.strokeCornerColor||h.strokeCornerColor,s.lineWidth=1,s.translate(o,c),s.rotate(r(h.angle)),s[d+"Rect"](-g,-g,u,u),m&&s.strokeRect(-g,-g,u,u),s.restore()}i.renderCircleControl=n,i.renderSquareControl=a})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});function r(i){for(var n in i)this[n]=i[n]}t.Control=r,t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(i,n){return n.cursorStyle},getActionName:function(i,n){return n.actionName},getVisibility:function(i,n){var a=i._controlsVisibility;return a&&typeof a[n]!="undefined"?a[n]:this.visible},setVisibility:function(i){this.visible=i},positionHandler:function(i,n){var a=t.util.transformPoint({x:this.x*i.x+this.offsetX,y:this.y*i.y+this.offsetY},n);return a},render:function(i,n,a,s,o){s=s||{};switch(s.cornerStyle||o.cornerStyle){case"circle":t.controlsUtils.renderCircleControl.call(this,i,n,a,s,o);break;default:t.controlsUtils.renderSquareControl.call(this,i,n,a,s,o)}}}})((typeof P!="undefined",P));(function(){function e(a,s){var o=a.getAttribute("style"),c=a.getAttribute("offset")||0,l,h,u,f;if(c=parseFloat(c)/(/%$/.test(c)?100:1),c=c<0?0:c>1?1:c,o){var d=o.split(/\s*;\s*/);for(d[d.length-1]===""&&d.pop(),f=d.length;f--;){var m=d[f].split(/\s*:\s*/),g=m[0].trim(),b=m[1].trim();g==="stop-color"?l=b:g==="stop-opacity"&&(u=b)}}return l||(l=a.getAttribute("stop-color")||"rgb(0,0,0)"),u||(u=a.getAttribute("stop-opacity")),l=new p.Color(l),h=l.getAlpha(),u=isNaN(parseFloat(u))?1:parseFloat(u),u*=h*s,{offset:c,color:l.toRgb(),opacity:u}}function t(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function r(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var i=p.util.object.clone;p.Gradient=p.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var s,o=this;Object.keys(a).forEach(function(c){o[c]=a[c]}),this.id?this.id+="_"+p.Object.__uid++:this.id=p.Object.__uid++,s={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(s.r1=a.coords.r1||0,s.r2=a.coords.r2||0),this.coords=s,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var s in a){var o=new p.Color(a[s]);this.colorStops.push({offset:parseFloat(s),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(a){var s={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return p.util.populateWithProperties(this,s,a),s},toSVG:function(a,s){var o=i(this.coords,!0),c,l,s=s||{},h,u,f=i(this.colorStops,!0),d=o.r1>o.r2,m=this.gradientTransform?this.gradientTransform.concat():p.iMatrix.concat(),g=-this.offsetX,b=-this.offsetY,_=!!s.additionalTransform,I=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(f.sort(function(V,F){return V.offset-F.offset}),I==="objectBoundingBox"?(g/=a.width,b/=a.height):(g+=a.width/2,b+=a.height/2),a.type==="path"&&(g-=a.pathOffset.x,b-=a.pathOffset.y),m[4]-=g,m[5]-=b,u='id="SVGID_'+this.id+'" gradientUnits="'+I+'"',u+=' gradientTransform="'+(_?s.additionalTransform+" ":"")+p.util.matrixToSVG(m)+'" ',this.type==="linear"?h=["<linearGradient ",u,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",u,' cx="',d?o.x1:o.x2,'" cy="',d?o.y1:o.y2,'" r="',d?o.r1:o.r2,'" fx="',d?o.x2:o.x1,'" fy="',d?o.y2:o.y1,`">
`]),this.type==="radial"){if(d)for(f=f.concat(),f.reverse(),c=0,l=f.length;c<l;c++)f[c].offset=1-f[c].offset;var M=Math.min(o.r1,o.r2);if(M>0){var U=Math.max(o.r1,o.r2),L=M/U;for(c=0,l=f.length;c<l;c++)f[c].offset+=L*(1-f[c].offset)}}for(c=0,l=f.length;c<l;c++){var Y=f[c];h.push("<stop ",'offset="',Y.offset*100+"%",'" style="stop-color:',Y.color,typeof Y.opacity!="undefined"?";stop-opacity: "+Y.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(a){var s,o=p.util.object.clone(this.coords),c,l;if(!this.type)return;for(this.type==="linear"?s=a.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(s=a.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),c=0,l=this.colorStops.length;c<l;c++){var h=this.colorStops[c].color,u=this.colorStops[c].opacity,f=this.colorStops[c].offset;typeof u!="undefined"&&(h=new p.Color(h).setAlpha(u).toRgba()),s.addColorStop(f,h)}return s}}),p.util.object.extend(p.Gradient,{fromElement:function(a,s,o,c){var l=parseFloat(o)/(/%$/.test(o)?100:1);l=l<0?0:l>1?1:l,isNaN(l)&&(l=1);var h=a.getElementsByTagName("stop"),u,f=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",d=a.getAttribute("gradientTransform")||"",m=[],g,b,_=0,I=0,M;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(u="linear",g=t(a)):(u="radial",g=r(a)),b=h.length;b--;)m.push(e(h[b],l));M=p.parseTransformAttribute(d),n(s,g,c,f),f==="pixels"&&(_=-s.left,I=-s.top);var U=new p.Gradient({id:a.getAttribute("id"),type:u,coords:g,colorStops:m,gradientUnits:f,gradientTransform:M,offsetX:_,offsetY:I});return U}});function n(a,s,o,c){var l,h;Object.keys(s).forEach(function(u){l=s[u],l==="Infinity"?h=1:l==="-Infinity"?h=0:(h=parseFloat(s[u],10),typeof l=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(l)&&(h*=.01,c==="pixels"&&((u==="x1"||u==="x2"||u==="r2")&&(h*=o.viewBoxWidth||o.width),(u==="y1"||u==="y2")&&(h*=o.viewBoxHeight||o.height)))),s[u]=h})}})();(function(){"use strict";var e=p.util.toFixed;p.Pattern=p.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,r){if(t||(t={}),this.id=p.Object.__uid++,this.setOptions(t),!t.source||t.source&&typeof t.source!="string"){r&&r(this);return}else{var i=this;this.source=p.util.createImage(),p.util.loadImage(t.source,function(n,a){i.source=n,r&&r(i,a)},null,this.crossOrigin)}},toObject:function(t){var r=p.Object.NUM_FRACTION_DIGITS,i,n;return typeof this.source.src=="string"?i=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(i=this.source.toDataURL()),n={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:e(this.offsetX,r),offsetY:e(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},p.util.populateWithProperties(this,n,t),n},toSVG:function(t){var r=typeof this.source=="function"?this.source():this.source,i=r.width/t.width,n=r.height/t.height,a=this.offsetX/t.width,s=this.offsetY/t.height,o="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(n=1,s&&(n+=Math.abs(s))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(i=1,a&&(i+=Math.abs(a))),r.src?o=r.src:r.toDataURL&&(o=r.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+s+'" width="'+i+'" height="'+n+`">
<image x="0" y="0" width="`+r.width+'" height="'+r.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(t){for(var r in t)this[r]=t[r]},toLive:function(t){var r=this.source;if(!r)return"";if(typeof r.src!="undefined"){if(!r.complete)return"";if(r.naturalWidth===0||r.naturalHeight===0)return""}return t.createPattern(r,this.repeat)}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.toFixed;if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(i){typeof i=="string"&&(i=this._parseShadow(i));for(var n in i)this[n]=i[n];this.id=t.Object.__uid++},_parseShadow:function(i){var n=i.trim(),a=t.Shadow.reOffsetsAndBlur.exec(n)||[],s=n.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:s.trim(),offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(i){var n=40,a=40,s=t.Object.NUM_FRACTION_DIGITS,o=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-i.angle)),c=20,l=new t.Color(this.color);return i.width&&i.height&&(n=r((Math.abs(o.x)+this.blur)/i.width,s)*100+c,a=r((Math.abs(o.y)+this.blur)/i.height,s)*100+c),i.flipX&&(o.x*=-1),i.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+n+'%" width="'+(100+2*n)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+r(this.blur?this.blur/2:0,s)+`"></feGaussianBlur>
	<feOffset dx="`+r(o.x,s)+'" dy="'+r(o.y,s)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+l.toRgb()+'" flood-opacity="'+l.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var i={},n=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==n[a]&&(i[a]=this[a])},this),i}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})((typeof P!="undefined",P));(function(){"use strict";if(p.StaticCanvas){p.warn("fabric.StaticCanvas is already defined.");return}var e=p.util.object.extend,t=p.util.getElementOffset,r=p.util.removeFromArray,i=p.util.toFixed,n=p.util.transformPoint,a=p.util.invertTransform,s=p.util.getNodeCanvas,o=p.util.createCanvasElement,c=new Error("Could not initialize `canvas` element");p.StaticCanvas=p.util.createClass(p.CommonMethods,{initialize:function(l,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(l,h)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:p.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(l,h){var u=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(l),this._initOptions(h),this.interactive||this._initRetinaScaling(),h.overlayImage&&this.setOverlayImage(h.overlayImage,u),h.backgroundImage&&this.setBackgroundImage(h.backgroundImage,u),h.backgroundColor&&this.setBackgroundColor(h.backgroundColor,u),h.overlayColor&&this.setOverlayColor(h.overlayColor,u),this.calcOffset()},_isRetinaScaling:function(){return p.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?p.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling())return;var l=p.devicePixelRatio;this.__initRetinaScaling(l,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(l,this.upperCanvasEl,this.contextTop)},__initRetinaScaling:function(l,h,u){h.setAttribute("width",this.width*l),h.setAttribute("height",this.height*l),u.scale(l,l)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(l,h,u){return this.__setBgOverlayImage("overlayImage",l,h,u)},setBackgroundImage:function(l,h,u){return this.__setBgOverlayImage("backgroundImage",l,h,u)},setOverlayColor:function(l,h){return this.__setBgOverlayColor("overlayColor",l,h)},setBackgroundColor:function(l,h){return this.__setBgOverlayColor("backgroundColor",l,h)},__setBgOverlayImage:function(l,h,u,f){return typeof h=="string"?p.util.loadImage(h,function(d,m){if(d){var g=new p.Image(d,f);this[l]=g,g.canvas=this}u&&u(d,m)},this,f&&f.crossOrigin):(f&&h.setOptions(f),this[l]=h,h&&(h.canvas=this),u&&u(h,!1)),this},__setBgOverlayColor:function(l,h,u){return this[l]=h,this._initGradient(h,l),this._initPattern(h,l,u),this},_createCanvasElement:function(){var l=o();if(!l)throw c;if(l.style||(l.style={}),typeof l.getContext=="undefined")throw c;return l},_initOptions:function(l){var h=this.lowerCanvasEl;if(this._setOptions(l),this.width=this.width||parseInt(h.width,10)||0,this.height=this.height||parseInt(h.height,10)||0,!this.lowerCanvasEl.style)return;h.width=this.width,h.height=this.height,h.style.width=this.width+"px",h.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(l){l&&l.getContext?this.lowerCanvasEl=l:this.lowerCanvasEl=p.util.getById(l)||this._createCanvasElement(),p.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(l,h){return this.setDimensions({width:l},h)},setHeight:function(l,h){return this.setDimensions({height:l},h)},setDimensions:function(l,h){var u;h=h||{};for(var f in l)u=l[f],h.cssOnly||(this._setBackstoreDimension(f,l[f]),u+="px",this.hasLostContext=!0),h.backstoreOnly||this._setCssDimension(f,u);return this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles()),this._initRetinaScaling(),this.calcOffset(),h.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(l,h){return this.lowerCanvasEl[l]=h,this.upperCanvasEl&&(this.upperCanvasEl[l]=h),this.cacheCanvasEl&&(this.cacheCanvasEl[l]=h),this[l]=h,this},_setCssDimension:function(l,h){return this.lowerCanvasEl.style[l]=h,this.upperCanvasEl&&(this.upperCanvasEl.style[l]=h),this.wrapperEl&&(this.wrapperEl.style[l]=h),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(l){var h=this._activeObject,u,f,d;for(this.viewportTransform=l,f=0,d=this._objects.length;f<d;f++)u=this._objects[f],u.group||u.setCoords(!0);return h&&h.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(l,h){var u=l,f=this.viewportTransform.slice(0);l=n(l,a(this.viewportTransform)),f[0]=h,f[3]=h;var d=n(l,f);return f[4]+=u.x-d.x,f[5]+=u.y-d.y,this.setViewportTransform(f)},setZoom:function(l){return this.zoomToPoint(new p.Point(0,0),l),this},absolutePan:function(l){var h=this.viewportTransform.slice(0);return h[4]=-l.x,h[5]=-l.y,this.setViewportTransform(h)},relativePan:function(l){return this.absolutePan(new p.Point(-l.x-this.viewportTransform[4],-l.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(l){this.stateful&&l.setupState(),l._set("canvas",this),l.setCoords(),this.fire("object:added",{target:l}),l.fire("added")},_onObjectRemoved:function(l){this.fire("object:removed",{target:l}),l.fire("removed"),delete l.canvas},clearContext:function(l){return l.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var l=this.contextContainer;return this.renderCanvas(l,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=p.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var l={},h=this.width,u=this.height,f=a(this.viewportTransform);return l.tl=n({x:0,y:0},f),l.br=n({x:h,y:u},f),l.tr=new p.Point(l.br.x,l.tl.y),l.bl=new p.Point(l.tl.x,l.br.y),this.vptCoords=l,l},cancelRequestedRender:function(){this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(l,h){var u=this.viewportTransform,f=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(l),p.util.setImageSmoothing(l,this.imageSmoothingEnabled),this.fire("before:render",{ctx:l}),this._renderBackground(l),l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._renderObjects(l,h),l.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),f&&(f.canvas=this,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(l)),this._renderOverlay(l),this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),this.fire("after:render",{ctx:l})},drawClipPathOnCanvas:function(l){var h=this.viewportTransform,u=this.clipPath;l.save(),l.transform(h[0],h[1],h[2],h[3],h[4],h[5]),l.globalCompositeOperation="destination-in",u.transform(l),l.scale(1/u.zoomX,1/u.zoomY),l.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),l.restore()},_renderObjects:function(l,h){var u,f;for(u=0,f=h.length;u<f;++u)h[u]&&h[u].render(l)},_renderBackgroundOrOverlay:function(l,h){var u=this[h+"Color"],f=this[h+"Image"],d=this.viewportTransform,m=this[h+"Vpt"];if(!u&&!f)return;if(u){l.save(),l.beginPath(),l.moveTo(0,0),l.lineTo(this.width,0),l.lineTo(this.width,this.height),l.lineTo(0,this.height),l.closePath(),l.fillStyle=u.toLive?u.toLive(l,this):u,m&&l.transform(d[0],d[1],d[2],d[3],d[4],d[5]),l.transform(1,0,0,1,u.offsetX||0,u.offsetY||0);var g=u.gradientTransform||u.patternTransform;g&&l.transform(g[0],g[1],g[2],g[3],g[4],g[5]),l.fill(),l.restore()}f&&(l.save(),m&&l.transform(d[0],d[1],d[2],d[3],d[4],d[5]),f.render(l),l.restore())},_renderBackground:function(l){this._renderBackgroundOrOverlay(l,"background")},_renderOverlay:function(l){this._renderBackgroundOrOverlay(l,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(l){return this._centerObject(l,new p.Point(this.getCenter().left,l.getCenterPoint().y))},centerObjectV:function(l){return this._centerObject(l,new p.Point(l.getCenterPoint().x,this.getCenter().top))},centerObject:function(l){var h=this.getCenter();return this._centerObject(l,new p.Point(h.left,h.top))},viewportCenterObject:function(l){var h=this.getVpCenter();return this._centerObject(l,h)},viewportCenterObjectH:function(l){var h=this.getVpCenter();return this._centerObject(l,new p.Point(h.x,l.getCenterPoint().y)),this},viewportCenterObjectV:function(l){var h=this.getVpCenter();return this._centerObject(l,new p.Point(l.getCenterPoint().x,h.y))},getVpCenter:function(){var l=this.getCenter(),h=a(this.viewportTransform);return n({x:l.left,y:l.top},h)},_centerObject:function(l,h){return l.setPositionByOrigin(h,"center","center"),l.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(l){return this.toDatalessObject(l)},toObject:function(l){return this._toObjectMethod("toObject",l)},toDatalessObject:function(l){return this._toObjectMethod("toDatalessObject",l)},_toObjectMethod:function(l,h){var u=this.clipPath,f={version:p.version,objects:this._toObjects(l,h)};return u&&(f.clipPath=this._toObject(this.clipPath,l,h)),e(f,this.__serializeBgOverlay(l,h)),p.util.populateWithProperties(this,f,h),f},_toObjects:function(l,h){return this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){return this._toObject(u,l,h)},this)},_toObject:function(l,h,u){var f;this.includeDefaultValues||(f=l.includeDefaultValues,l.includeDefaultValues=!1);var d=l[h](u);return this.includeDefaultValues||(l.includeDefaultValues=f),d},__serializeBgOverlay:function(l,h){var u={},f=this.backgroundImage,d=this.overlayImage;return this.backgroundColor&&(u.background=this.backgroundColor.toObject?this.backgroundColor.toObject(h):this.backgroundColor),this.overlayColor&&(u.overlay=this.overlayColor.toObject?this.overlayColor.toObject(h):this.overlayColor),f&&!f.excludeFromExport&&(u.backgroundImage=this._toObject(f,l,h)),d&&!d.excludeFromExport&&(u.overlayImage=this._toObject(d,l,h)),u},svgViewportTransformation:!0,toSVG:function(l,h){l||(l={}),l.reviver=h;var u=[];return this._setSVGPreamble(u,l),this._setSVGHeader(u,l),this.clipPath&&u.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(u,"background"),this._setSVGBgOverlayImage(u,"backgroundImage",h),this._setSVGObjects(u,h),this.clipPath&&u.push(`</g>
`),this._setSVGBgOverlayColor(u,"overlay"),this._setSVGBgOverlayImage(u,"overlayImage",h),u.push("</svg>"),u.join("")},_setSVGPreamble:function(l,h){if(h.suppressPreamble)return;l.push('<?xml version="1.0" encoding="',h.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(l,h){var u=h.width||this.width,f=h.height||this.height,d,m='viewBox="0 0 '+this.width+" "+this.height+'" ',g=p.Object.NUM_FRACTION_DIGITS;h.viewBox?m='viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" ':this.svgViewportTransformation&&(d=this.viewportTransform,m='viewBox="'+i(-d[4]/d[0],g)+" "+i(-d[5]/d[3],g)+" "+i(this.width/d[0],g)+" "+i(this.height/d[3],g)+'" '),l.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',u,'" ','height="',f,'" ',m,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",p.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(h),`</defs>
`)},createSVGClipPathMarkup:function(l){var h=this.clipPath;return h?(h.clipPathId="CLIPPATH_"+p.Object.__uid++,'<clipPath id="'+h.clipPathId+`" >
`+this.clipPath.toClipPathSVG(l.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var l=this,h=["background","overlay"].map(function(u){var f=l[u+"Color"];if(f&&f.toLive){var d=l[u+"Vpt"],m=l.viewportTransform,g={width:l.width/(d?m[0]:1),height:l.height/(d?m[3]:1)};return f.toSVG(g,{additionalTransform:d?p.util.matrixToSVG(m):""})}});return h.join("")},createSVGFontFacesMarkup:function(){var l="",h={},u,f,d,m,g,b,_,I,M,U=p.fontPaths,L=[];for(this._objects.forEach(function V(F){L.push(F),F._objects&&F._objects.forEach(V)}),I=0,M=L.length;I<M;I++){if(u=L[I],f=u.fontFamily,u.type.indexOf("text")===-1||h[f]||!U[f])continue;if(h[f]=!0,!u.styles)continue;d=u.styles;for(g in d){m=d[g];for(_ in m)b=m[_],f=b.fontFamily,!h[f]&&U[f]&&(h[f]=!0)}}for(var Y in h)l+=[`		@font-face {
`,"			font-family: '",Y,`';
`,"			src: url('",U[Y],`');
`,`		}
`].join("");return l&&(l=['	<style type="text/css">',`<![CDATA[
`,l,"]]>",`</style>
`].join("")),l},_setSVGObjects:function(l,h){var u,f,d,m=this._objects;for(f=0,d=m.length;f<d;f++){if(u=m[f],u.excludeFromExport)continue;this._setSVGObject(l,u,h)}},_setSVGObject:function(l,h,u){l.push(h.toSVG(u))},_setSVGBgOverlayImage:function(l,h,u){this[h]&&!this[h].excludeFromExport&&this[h].toSVG&&l.push(this[h].toSVG(u))},_setSVGBgOverlayColor:function(l,h){var u=this[h+"Color"],f=this.viewportTransform,d=this.width,m=this.height;if(!u)return;if(u.toLive){var g=u.repeat,b=p.util.invertTransform(f),_=this[h+"Vpt"],I=_?p.util.matrixToSVG(b):"";l.push('<rect transform="'+I+" translate(",d/2,",",m/2,')"',' x="',u.offsetX-d/2,'" y="',u.offsetY-m/2,'" ','width="',g==="repeat-y"||g==="no-repeat"?u.source.width:d,'" height="',g==="repeat-x"||g==="no-repeat"?u.source.height:m,'" fill="url(#SVGID_'+u.id+')"',`></rect>
`)}else l.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',u,'"',`></rect>
`)},sendToBack:function(l){if(!l)return this;var h=this._activeObject,u,f,d;if(l===h&&l.type==="activeSelection")for(d=h._objects,u=d.length;u--;)f=d[u],r(this._objects,f),this._objects.unshift(f);else r(this._objects,l),this._objects.unshift(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(l){if(!l)return this;var h=this._activeObject,u,f,d;if(l===h&&l.type==="activeSelection")for(d=h._objects,u=0;u<d.length;u++)f=d[u],r(this._objects,f),this._objects.push(f);else r(this._objects,l),this._objects.push(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(l,h){if(!l)return this;var u=this._activeObject,f,d,m,g,b,_=0;if(l===u&&l.type==="activeSelection")for(b=u._objects,f=0;f<b.length;f++)d=b[f],m=this._objects.indexOf(d),m>0+_&&(g=m-1,r(this._objects,d),this._objects.splice(g,0,d)),_++;else m=this._objects.indexOf(l),m!==0&&(g=this._findNewLowerIndex(l,m,h),r(this._objects,l),this._objects.splice(g,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(l,h,u){var f,d;if(u)for(f=h,d=h-1;d>=0;--d){var m=l.intersectsWithObject(this._objects[d])||l.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(l);if(m){f=d;break}}else f=h-1;return f},bringForward:function(l,h){if(!l)return this;var u=this._activeObject,f,d,m,g,b,_=0;if(l===u&&l.type==="activeSelection")for(b=u._objects,f=b.length;f--;)d=b[f],m=this._objects.indexOf(d),m<this._objects.length-1-_&&(g=m+1,r(this._objects,d),this._objects.splice(g,0,d)),_++;else m=this._objects.indexOf(l),m!==this._objects.length-1&&(g=this._findNewUpperIndex(l,m,h),r(this._objects,l),this._objects.splice(g,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(l,h,u){var f,d,m;if(u)for(f=h,d=h+1,m=this._objects.length;d<m;++d){var g=l.intersectsWithObject(this._objects[d])||l.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(l);if(g){f=d;break}}else f=h+1;return f},moveTo:function(l,h){return r(this._objects,l),this._objects.splice(h,0,l),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(l){l.dispose&&l.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,p.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(p.StaticCanvas.prototype,p.Observable),e(p.StaticCanvas.prototype,p.Collection),e(p.StaticCanvas.prototype,p.DataURLExporter),e(p.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(l){var h=o();if(!h||!h.getContext)return null;var u=h.getContext("2d");if(!u)return null;switch(l){case"setLineDash":return typeof u.setLineDash!="undefined";default:return null}}}),p.StaticCanvas.prototype.toJSON=p.StaticCanvas.prototype.toObject,p.isLikelyNode&&(p.StaticCanvas.prototype.createPNGStream=function(){var l=s(this.lowerCanvasEl);return l&&l.createPNGStream()},p.StaticCanvas.prototype.createJPEGStream=function(l){var h=s(this.lowerCanvasEl);return h&&h.createJPEGStream(l)})})();p.BaseBrush=p.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,p.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(!this.shadow)return;var e=this.canvas,t=this.shadow,r=e.contextTop,i=e.getZoom();e&&e._isRetinaScaling()&&(i*=p.devicePixelRatio),r.shadowColor=t.color,r.shadowBlur=t.blur*i,r.shadowOffsetX=t.offsetX*i,r.shadowOffsetY=t.offsetY*i},needsFullRender:function(){var e=new p.Color(this.color);return e.getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});(function(){p.PencilBrush=p.util.createClass(p.BaseBrush,{decimate:.4,initialize:function(e){this.canvas=e,this._points=[]},_drawSegment:function(e,t,r){var i=t.midPointFrom(r);return e.quadraticCurveTo(t.x,t.y,i.x,i.y),i},onMouseDown:function(e,t){if(!this.canvas._isMainEvent(t.e))return;this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e,t){if(!this.canvas._isMainEvent(t.e))return;if(this._captureDrawingPath(e)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var r=this._points,i=r.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,r[i-2],r[i-1],!0),n.stroke(),n.restore()}},onMouseUp:function(e){return this.canvas._isMainEvent(e.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(e){var t=new p.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return this._points.length>1&&e.eq(this._points[this._points.length-1])?!1:(this._points.push(e),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new p.Point(e.x,e.y);return this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t,r,i=this._points[0],n=this._points[1];if(this._saveAndTransform(e),e.beginPath(),this._points.length===2&&i.x===n.x&&i.y===n.y){var a=this.width/1e3;i=new p.Point(i.x,i.y),n=new p.Point(n.x,n.y),i.x-=a,n.x+=a}for(e.moveTo(i.x,i.y),t=1,r=this._points.length;t<r;t++)this._drawSegment(e,i,n),i=this._points[t],n=this._points[t+1];e.lineTo(i.x,i.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=[],r,i=this.width/1e3,n=new p.Point(e[0].x,e[0].y),a=new p.Point(e[1].x,e[1].y),s=e.length,o=1,c=0,l=s>2;for(l&&(o=e[2].x<a.x?-1:e[2].x===a.x?0:1,c=e[2].y<a.y?-1:e[2].y===a.y?0:1),t.push("M ",n.x-o*i," ",n.y-c*i," "),r=1;r<s;r++){if(!n.eq(a)){var h=n.midPointFrom(a);t.push("Q ",n.x," ",n.y," ",h.x," ",h.y," ")}n=e[r],r+1<e.length&&(a=e[r+1])}return l&&(o=n.x>e[r-2].x?1:n.x===e[r-2].x?0:-1,c=n.y>e[r-2].y?1:n.y===e[r-2].y?0:-1),t.push("L ",n.x+o*i," ",n.y+c*i),t},createPath:function(e){var t=new p.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new p.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var r=this.canvas.getZoom(),i=Math.pow(t/r,2),n,a=e.length-1,s=e[0],o=[s],c;for(n=1;n<a;n++)c=Math.pow(s.x-e[n].x,2)+Math.pow(s.y-e[n].y,2),c>=i&&(s=e[n],o.push(s));return o.length===1&&o.push(new p.Point(o[0].x,o[0].y)),o},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var r=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}})})();p.CircleBrush=p.util.createClass(p.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),r=this.canvas.contextTop;this._saveAndTransform(r),this.dot(r,t),r.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e=this.canvas.contextTop,t,r,i=this.points;for(this._saveAndTransform(e),t=0,r=i.length;t<r;t++)this.dot(e,i[t]);e.restore()},onMouseMove:function(e){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,t,r;this.canvas.renderOnAddRemove=!1;var i=[];for(t=0,r=this.points.length;t<r;t++){var n=this.points[t],a=new p.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(a.shadow=new p.Shadow(this.shadow)),i.push(a)}var s=new p.Group(i);s.canvas=this.canvas,this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},addPoint:function(e){var t=new p.Point(e.x,e.y),r=p.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,i=new p.Color(this.color).setAlpha(p.util.getRandomInt(0,100)/100).toRgba();return t.radius=r,t.fill=i,this.points.push(t),t}});p.SprayBrush=p.util.createClass(p.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],r=0,i=this.sprayChunks.length;r<i;r++)for(var n=this.sprayChunks[r],a=0,s=n.length;a<s;a++){var o=new p.Rect({width:n[a].width,height:n[a].width,left:n[a].x+1,top:n[a].y+1,originX:"center",originY:"center",fill:this.color});t.push(o)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var c=new p.Group(t);this.shadow&&c.set("shadow",new p.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t={},r,i,n;for(i=0,n=e.length;i<n;i++)r=e[i].left+""+e[i].top,t[r]||(t[r]=e[i]);var a=[];for(r in t)a.push(t[r]);return a},render:function(e){var t=this.canvas.contextTop,r,i;for(t.fillStyle=this.color,this._saveAndTransform(t),r=0,i=e.length;r<i;r++){var n=e[r];typeof n.opacity!="undefined"&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},_render:function(){var e=this.canvas.contextTop,t,r;for(e.fillStyle=this.color,this._saveAndTransform(e),t=0,r=this.sprayChunks.length;t<r;t++)this.render(this.sprayChunks[t]);e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,r,i,n=this.width/2,a;for(a=0;a<this.density;a++){t=p.util.getRandomInt(e.x-n,e.x+n),r=p.util.getRandomInt(e.y-n,e.y+n),this.dotWidthVariance?i=p.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):i=this.dotWidth;var s=new p.Point(t,r);s.width=i,this.randomOpacity&&(s.opacity=p.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}});p.PatternBrush=p.util.createClass(p.PencilBrush,{getPatternSrc:function(){var e=20,t=5,r=p.util.createCanvasElement(),i=r.getContext("2d");return r.width=r.height=e+t,i.fillStyle=this.color,i.beginPath(),i.arc(e/2,e/2,e/2,0,Math.PI*2,!1),i.closePath(),i.fill(),r},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),r=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new p.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-r.x,offsetY:-r.y}),t}});(function(){var e=p.util.getPointer,t=p.util.degreesToRadians,r=Math.abs,i=p.StaticCanvas.supports("setLineDash"),n=p.util.isTouchEvent,a=.5;p.Canvas=p.util.createClass(p.StaticCanvas,{initialize:function(o,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=p.PencilBrush&&new p.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o=this.getActiveObjects(),c,l,h;if(o.length>0&&!this.preserveObjectStacking){l=[],h=[];for(var u=0,f=this._objects.length;u<f;u++)c=this._objects[u],o.indexOf(c)===-1?l.push(c):h.push(c);o.length>1&&(this._activeObject._objects=h),l.push.apply(l,h)}else l=this._objects;return l},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var o=this.contextContainer;return this.renderCanvas(o,this._chooseObjectsToRender()),this},renderTopLayer:function(o){o.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(o),this.contextTopDirty=!0),o.restore()},renderTop:function(){var o=this.contextTop;return this.clearContext(o),this.renderTopLayer(o),this.fire("after:render"),this},_normalizePointer:function(o,c){var l=o.calcTransformMatrix(),h=p.util.invertTransform(l),u=this.restorePointerVpt(c);return p.util.transformPoint(u,h)},isTargetTransparent:function(o,c,l){if(o.shouldCache()&&o._cacheCanvas&&o!==this._activeObject){var h=this._normalizePointer(o,{x:c,y:l}),u=Math.max(o.cacheTranslationX+h.x*o.zoomX,0),f=Math.max(o.cacheTranslationY+h.y*o.zoomY,0),b=p.util.isTransparent(o._cacheContext,Math.round(u),Math.round(f),this.targetFindTolerance);return b}var d=this.contextCache,m=o.selectionBackgroundColor,g=this.viewportTransform;o.selectionBackgroundColor="",this.clearContext(d),d.save(),d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),o.render(d),d.restore(),o===this._activeObject&&o._renderControls(d,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),o.selectionBackgroundColor=m;var b=p.util.isTransparent(d,c,l,this.targetFindTolerance);return b},_isSelectionKeyPressed:function(o){var c=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?c=!!this.selectionKey.find(function(l){return o[l]===!0}):c=o[this.selectionKey],c},_shouldClearSelection:function(o,c){var l=this.getActiveObjects(),h=this._activeObject;return!c||c&&h&&l.length>1&&l.indexOf(c)===-1&&h!==c&&!this._isSelectionKeyPressed(o)||c&&!c.evented||c&&!c.selectable&&h&&h!==c},_shouldCenterTransform:function(o,c,l){if(!o)return;var h;return c==="scale"||c==="scaleX"||c==="scaleY"||c==="resizing"?h=this.centeredScaling||o.centeredScaling:c==="rotate"&&(h=this.centeredRotation||o.centeredRotation),h?!l:l},_getOriginFromCorner:function(o,c){var l={x:o.originX,y:o.originY};return c==="ml"||c==="tl"||c==="bl"?l.x="right":(c==="mr"||c==="tr"||c==="br")&&(l.x="left"),c==="tl"||c==="mt"||c==="tr"?l.y="bottom":c==="bl"||c==="mb"||c==="br"?l.y="top":c==="mtr"&&(l.x="center",l.y="center"),l},_getActionFromCorner:function(o,c,l,h){if(!c||!o)return"drag";var u=h.controls[c];return u.getActionName(l,u,h)},_setupCurrentTransform:function(o,c,l){if(!c)return;var h=this.getPointer(o),u=c.__corner,f=l&&u?c.controls[u].getActionHandler():p.controlsUtils.dragHandler,d=this._getActionFromCorner(l,u,o,c),m=this._getOriginFromCorner(c,u),g=o[this.centeredKey],b={target:c,action:d,actionHandler:f,corner:u,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:h.x-c.left,offsetY:h.y-c.top,originX:m.x,originY:m.y,ex:h.x,ey:h.y,lastX:h.x,lastY:h.y,theta:t(c.angle),width:c.width*c.scaleX,shiftKey:o.shiftKey,altKey:g,original:p.util.saveObjectTransform(c)};this._shouldCenterTransform(c,d,g)&&(b.originX="center",b.originY="center"),b.original.originX=m.x,b.original.originY=m.y,this._currentTransform=b,this._beforeTransform(o)},setCursor:function(o){this.upperCanvasEl.style.cursor=o},_drawSelection:function(o){var c=this._groupSelector,l=c.left,h=c.top,u=r(l),f=r(h);if(this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(c.ex-(l>0?0:-l),c.ey-(h>0?0:-h),u,f)),!this.selectionLineWidth||!this.selectionBorderColor)return;if(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!i){var d=c.ex+a-(l>0?0:u),m=c.ey+a-(h>0?0:f);o.beginPath(),p.util.drawDashedLine(o,d,m,d+u,m,this.selectionDashArray),p.util.drawDashedLine(o,d,m+f-1,d+u,m+f-1,this.selectionDashArray),p.util.drawDashedLine(o,d,m,d,m+f,this.selectionDashArray),p.util.drawDashedLine(o,d+u-1,m,d+u-1,m+f,this.selectionDashArray),o.closePath(),o.stroke()}else p.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(c.ex+a-(l>0?0:u),c.ey+a-(h>0?0:f),u,f)},findTarget:function(o,c){if(this.skipTargetFind)return;var l=!0,h=this.getPointer(o,l),u=this._activeObject,f=this.getActiveObjects(),d,m,g=n(o);if(this.targets=[],f.length>1&&!c&&u===this._searchPossibleTargets([u],h))return u;if(f.length===1&&u._findTargetCorner(h,g))return u;if(f.length===1&&u===this._searchPossibleTargets([u],h))if(this.preserveObjectStacking)d=u,m=this.targets,this.targets=[];else return u;var b=this._searchPossibleTargets(this._objects,h);return o[this.altSelectionKey]&&b&&d&&b!==d&&(b=d,this.targets=m),b},_checkTarget:function(o,c,l){if(c&&c.visible&&c.evented&&(c.containsPoint(o)||!!c._findTargetCorner(o)))if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var h=this.isTargetTransparent(c,l.x,l.y);if(!h)return!0}else return!0},_searchPossibleTargets:function(o,c){for(var l,h=o.length,u;h--;){var f=o[h],d=f.group?this._normalizePointer(f.group,c):c;if(this._checkTarget(d,f,c)){l=o[h],l.subTargetCheck&&l instanceof p.Group&&(u=this._searchPossibleTargets(l._objects,c),u&&this.targets.push(u));break}}return l},restorePointerVpt:function(o){return p.util.transformPoint(o,p.util.invertTransform(this.viewportTransform))},getPointer:function(o,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var l=e(o),h=this.upperCanvasEl,u=h.getBoundingClientRect(),f=u.width||0,d=u.height||0,m;(!f||!d)&&("top"in u&&"bottom"in u&&(d=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(f=Math.abs(u.right-u.left))),this.calcOffset(),l.x=l.x-this._offset.left,l.y=l.y-this._offset.top,c||(l=this.restorePointerVpt(l));var g=this.getRetinaScaling();return g!==1&&(l.x/=g,l.y/=g),f===0||d===0?m={width:1,height:1}:m={width:h.width/f,height:h.height/d},{x:l.x*m.width,y:l.y*m.height}},_createUpperCanvas:function(){var o=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,l=this.upperCanvasEl;l?l.className="":(l=this._createCanvasElement(),this.upperCanvasEl=l),p.util.addClass(l,"upper-canvas "+o),this.wrapperEl.appendChild(l),this._copyCanvasStyle(c,l),this._applyCanvasStyle(l),this.contextTop=l.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=p.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),p.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),p.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(o){var c=this.width||o.width,l=this.height||o.height;p.util.setStyle(o,{position:"absolute",width:c+"px",height:l+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),o.width=c,o.height=l,p.util.makeElementUnselectable(o)},_copyCanvasStyle:function(o,c){c.style.cssText=o.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var o=this._activeObject;return o?o.type==="activeSelection"&&o._objects?o._objects.slice(0):[o]:[]},_onObjectRemoved:function(o){o===this._activeObject&&(this.fire("before:selection:cleared",{target:o}),this._discardActiveObject(),this.fire("selection:cleared",{target:o}),o.fire("deselected")),o===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",o)},_fireSelectionEvents:function(o,c){var l=!1,h=this.getActiveObjects(),u=[],f=[],d={e:c};o.forEach(function(m){h.indexOf(m)===-1&&(l=!0,m.fire("deselected",d),f.push(m))}),h.forEach(function(m){o.indexOf(m)===-1&&(l=!0,m.fire("selected",d),u.push(m))}),o.length>0&&h.length>0?(d.selected=u,d.deselected=f,d.updated=u[0]||f[0],d.target=this._activeObject,l&&this.fire("selection:updated",d)):h.length>0?(d.selected=u,d.target=this._activeObject,this.fire("selection:created",d)):o.length>0&&(d.deselected=f,this.fire("selection:cleared",d))},setActiveObject:function(o,c){var l=this.getActiveObjects();return this._setActiveObject(o,c),this._fireSelectionEvents(l,c),this},_setActiveObject:function(o,c){return this._activeObject===o?!1:this._discardActiveObject(c,o)?o.onSelect({e:c})?!1:(this._activeObject=o,!0):!1},_discardActiveObject:function(o,c){var l=this._activeObject;if(l){if(l.onDeselect({e:o,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(o){var c=this.getActiveObjects(),l=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:l,e:o}),this._discardActiveObject(o),this._fireSelectionEvents(c,o),this},dispose:function(){var o=this.wrapperEl;return this.removeListeners(),o.removeChild(this.upperCanvasEl),o.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(c){p.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this)),o.parentNode&&o.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,p.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(o){var c=this._activeObject;c&&c._renderControls(o)},_toObject:function(o,c,l){var h=this._realizeGroupTransformOnObject(o),u=this.callSuper("_toObject",o,c,l);return this._unwindGroupTransformOnObject(o,h),u},_realizeGroupTransformOnObject:function(o){if(o.group&&o.group.type==="activeSelection"&&this._activeObject===o.group){var c=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],l={};return c.forEach(function(h){l[h]=o[h]}),this._activeObject.realizeTransform(o),l}else return null},_unwindGroupTransformOnObject:function(o,c){c&&o.set(c)},_setSVGObject:function(o,c,l){var h=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",o,c,l),this._unwindGroupTransformOnObject(c,h)},setViewportTransform:function(o){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),p.StaticCanvas.prototype.setViewportTransform.call(this,o)}});for(var s in p.StaticCanvas)s!=="prototype"&&(p.Canvas[s]=p.StaticCanvas[s])})();(function(){var e=p.util.addListener,t=p.util.removeListener,r=3,i=2,n=1,a={passive:!1};function s(o,c){return o.button&&o.button===c-1}p.util.object.extend(p.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,c){var l=this.upperCanvasEl,h=this._getEventPrefix();o(p.window,"resize",this._onResize),o(l,h+"down",this._onMouseDown),o(l,h+"move",this._onMouseMove,a),o(l,h+"out",this._onMouseOut),o(l,h+"enter",this._onMouseEnter),o(l,"wheel",this._onMouseWheel),o(l,"contextmenu",this._onContextMenu),o(l,"dblclick",this._onDoubleClick),o(l,"dragover",this._onDragOver),o(l,"dragenter",this._onDragEnter),o(l,"dragleave",this._onDragLeave),o(l,"drop",this._onDrop),this.enablePointerEvents||o(l,"touchstart",this._onTouchStart,a),typeof eventjs!="undefined"&&c in eventjs&&(eventjs[c](l,"gesture",this._onGesture),eventjs[c](l,"drag",this._onDrag),eventjs[c](l,"orientation",this._onOrientationChange),eventjs[c](l,"shake",this._onShake),eventjs[c](l,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var o=this._getEventPrefix();t(p.document,o+"up",this._onMouseUp),t(p.document,"touchend",this._onTouchEnd,a),t(p.document,o+"move",this._onMouseMove,a),t(p.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){if(this.eventsBound)return;this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0},_onGesture:function(o,c){this.__onTransformGesture&&this.__onTransformGesture(o,c)},_onDrag:function(o,c){this.__onDrag&&this.__onDrag(o,c)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var c=this._hoveredTarget;this.fire("mouse:out",{target:c,e:o}),this._hoveredTarget=null,c&&c.fire("mouseout",{e:o});var l=this;this._hoveredTargets.forEach(function(h){l.fire("mouse:out",{target:c,e:o}),h&&c.fire("mouseout",{e:o})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(h){h.isEditing&&h.hiddenTextarea.focus()})},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,c){this.__onOrientationChange&&this.__onOrientationChange(o,c)},_onShake:function(o,c){this.__onShake&&this.__onShake(o,c)},_onLongPress:function(o,c){this.__onLongPress&&this.__onLongPress(o,c)},_onDragOver:function(o){o.preventDefault();var c=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(c,o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var c=o.changedTouches;return c?c[0]&&c[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0?!0:o.isPrimary===!1?!1:o.type==="touchend"&&o.touches.length===0?!0:o.changedTouches?o.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();e(p.document,"touchend",this._onTouchEnd,a),e(p.document,"touchmove",this._onMouseMove,a),t(c,l+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();t(c,l+"move",this._onMouseMove,a),e(p.document,l+"up",this._onMouseUp),e(p.document,l+"move",this._onMouseMove,a)},_onTouchEnd:function(o){if(o.touches.length>0)return;this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var c=this._getEventPrefix();t(p.document,"touchend",this._onTouchEnd,a),t(p.document,"touchmove",this._onMouseMove,a);var l=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(l.upperCanvasEl,c+"down",l._onMouseDown),l._willAddMouseDown=0},400)},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var c=this.upperCanvasEl,l=this._getEventPrefix();this._isMainEvent(o)&&(t(p.document,l+"up",this._onMouseUp),t(p.document,l+"move",this._onMouseMove,a),e(c,l+"move",this._onMouseMove,a))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var c=this._activeObject;return!!c!==!!o||c&&o&&c!==o?!0:(c&&c.isEditing,!1)},__onMouseUp:function(o){var c,l=this._currentTransform,h=this._groupSelector,u=!1,f=!h||h.left===0&&h.top===0;if(this._cacheTransformEventData(o),c=this._target,this._handleEvent(o,"up:before"),s(o,r)){this.fireRightClick&&this._handleEvent(o,"up",r,f);return}if(s(o,i)){this.fireMiddleClick&&this._handleEvent(o,"up",i,f),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(o);return}if(!this._isMainEvent(o))return;if(l&&(this._finalizeCurrentTransform(o),u=l.actionPerformed),!f){var d=c===this._activeObject;this._maybeGroupObjects(o),u||(u=this._shouldRender(c)||!d&&c===this._activeObject)}if(c){var m=c._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o)),g=c.controls[m],b=g&&g.getMouseUpHandler(o,c,g);b&&b(o,c,g),c.isMoving=!1}this._setCursorFromEvent(o,c),this._handleEvent(o,"up",n,f),this._groupSelector=null,this._currentTransform=null,c&&(c.__corner=0),u?this.requestRenderAll():f||this.renderTop()},_simpleEventHandler:function(o,c){var l=this.findTarget(c),h=this.targets,u={e:c,target:l,subTargets:h};if(this.fire(o,u),l&&l.fire(o,u),!h)return l;for(var f=0;f<h.length;f++)h[f].fire(o,u);return l},_handleEvent:function(o,c,l,h){var u=this._target,f=this.targets||[],d={e:o,target:u,subTargets:f,button:l||n,isClick:h||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};c==="up"&&(d.currentTarget=this.findTarget(o),d.currentSubTargets=this.targets),this.fire("mouse:"+c,d),u&&u.fire("mouse"+c,d);for(var m=0;m<f.length;m++)f[m].fire("mouse"+c,d)},_finalizeCurrentTransform:function(o){var c=this._currentTransform,l=c.target,h,u={e:o,target:l,transform:c,action:c.action};l._scaling&&(l._scaling=!1),l.setCoords(),(c.actionPerformed||this.stateful&&l.hasStateChanged())&&(c.actionPerformed&&(h=this._addEventOptions(u,c),this._fire(h,u)),this._fire("modified",u))},_addEventOptions:function(o,c){var l,h;switch(c.action){case"scaleX":l="scaled",h="x";break;case"scaleY":l="scaled",h="y";break;case"skewX":l="skewed",h="x";break;case"skewY":l="skewed",h="y";break;case"scale":l="scaled",h="equally";break;case"rotate":l="rotated";break;case"drag":l="moved";break}return o.by=h,l},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var c=this.getPointer(o);this.freeDrawingBrush.onMouseDown(c,{e:o,pointer:c}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var c=this.getPointer(o);this.freeDrawingBrush.onMouseMove(c,{e:o,pointer:c})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var c=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:c}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var c=this._target;if(s(o,r)){this.fireRightClick&&this._handleEvent(o,"down",r);return}if(s(o,i)){this.fireMiddleClick&&this._handleEvent(o,"down",i);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(o);return}if(!this._isMainEvent(o))return;if(this._currentTransform)return;var l=this._pointer;this._previousPointer=l;var h=this._shouldRender(c),u=this._shouldGroup(o,c);if(this._shouldClearSelection(o,c)?this.discardActiveObject(o):u&&(this._handleGrouping(o,c),c=this._activeObject),this.selection&&(!c||!c.selectable&&!c.isEditing&&c!==this._activeObject)&&(this._groupSelector={ex:l.x,ey:l.y,top:0,left:0}),c){var f=c===this._activeObject;c.selectable&&this.setActiveObject(c,o);var d=c._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o));if(c.__corner=d,c===this._activeObject&&(d||!u)){var m=c.controls[d],g=m&&m.getMouseDownHandler(o,c,m);g&&g(o,c,m),this._setupCurrentTransform(o,c,f)}}this._handleEvent(o,"down"),(h||u)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var c=this._currentTransform;this.stateful&&c.target.saveState(),this.fire("before:transform",{e:o,transform:c})},__onMouseMove:function(o){this._handleEvent(o,"move:before"),this._cacheTransformEventData(o);var c,l;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(o);return}if(!this._isMainEvent(o))return;var h=this._groupSelector;h?(l=this._pointer,h.left=l.x-h.ex,h.top=l.y-h.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(c=this.findTarget(o)||null,this._setCursorFromEvent(o,c),this._fireOverOutEvents(c,o)),this._handleEvent(o,"move"),this._resetTransformEventData()},_fireOverOutEvents:function(o,c){var l=this._hoveredTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:l,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var d=0;d<f;d++)this.fireSyntheticInOutEvents(u[d],c,{oldTarget:h[d],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,c){var l=this._draggedoverTarget,h=this._hoveredTargets,u=this.targets,f=Math.max(h.length,u.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:l,evtOut:"dragleave",evtIn:"dragenter"});for(var d=0;d<f;d++)this.fireSyntheticInOutEvents(u[d],c,{oldTarget:h[d],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,c,l){var h,u,f=l.oldTarget,d,m,g=f!==o,b=l.canvasEvtIn,_=l.canvasEvtOut;g&&(h={e:c,target:o,previousTarget:f},u={e:c,target:f,nextTarget:o}),m=o&&g,d=f&&g,d&&(_&&this.fire(_,u),f.fire(l.evtOut,u)),m&&(b&&this.fire(b,h),o.fire(l.evtIn,h))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var c=this.getPointer(o),l=this._currentTransform;l.reset=!1,l.target.isMoving=!0,l.shiftKey=o.shiftKey,l.altKey=o[this.centeredKey],this._performTransformAction(o,l,c),l.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,c,l){var h=l.x,u=l.y,f=c.action,d=!1,m=c.actionHandler;m&&(d=m(o,c,h,u)),f==="drag"&&d&&this.setCursor(c.target.moveCursor||this.moveCursor),c.actionPerformed=c.actionPerformed||d},_fire:p.controlsUtils.fireEvent,_setCursorFromEvent:function(o,c){if(!c)return this.setCursor(this.defaultCursor),!1;var l=c.hoverCursor||this.hoverCursor,h=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,u=(!h||!h.contains(c))&&c._findTargetCorner(this.getPointer(o,!0));u?this.setCursor(this.getCornerCursor(u,c,o)):(c.subTargetCheck&&this.targets.concat().reverse().map(function(f){l=f.hoverCursor||l}),this.setCursor(l))},getCornerCursor:function(o,c,l){var h=c.controls[o];return h.cursorStyleHandler(l,h,c)}})})();(function(){var e=Math.min,t=Math.max;p.util.object.extend(p.Canvas.prototype,{_shouldGroup:function(r,i){var n=this._activeObject;return n&&this._isSelectionKeyPressed(r)&&i&&i.selectable&&this.selection&&(n!==i||n.type==="activeSelection")&&!i.onSelect({e:r})},_handleGrouping:function(r,i){var n=this._activeObject;if(n.__corner)return;if(i===n&&(i=this.findTarget(r,!0),!i||!i.selectable))return;n&&n.type==="activeSelection"?this._updateActiveSelection(i,r):this._createActiveSelection(i,r)},_updateActiveSelection:function(r,i){var n=this._activeObject,a=n._objects.slice(0);n.contains(r)?(n.removeWithUpdate(r),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),i)):(n.addWithUpdate(r),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,i)},_createActiveSelection:function(r,i){var n=this.getActiveObjects(),a=this._createGroup(r);this._hoveredTarget=a,this._setActiveObject(a,i),this._fireSelectionEvents(n,i)},_createGroup:function(r){var i=this._objects,n=i.indexOf(this._activeObject)<i.indexOf(r),a=n?[this._activeObject,r]:[r,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new p.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(r){var i=this._collectObjects(r),n;i.length===1?this.setActiveObject(i[0],r):i.length>1&&(n=new p.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(n,r))},_collectObjects:function(r){for(var i=[],n,a=this._groupSelector.ex,s=this._groupSelector.ey,o=a+this._groupSelector.left,c=s+this._groupSelector.top,l=new p.Point(e(a,o),e(s,c)),h=new p.Point(t(a,o),t(s,c)),u=!this.selectionFullyContained,f=a===o&&s===c,d=this._objects.length;d--;){if(n=this._objects[d],!n||!n.selectable||!n.visible)continue;if((u&&n.intersectsWithRect(l,h)||n.isContainedWithinRect(l,h)||u&&n.containsPoint(l)||u&&n.containsPoint(h))&&(i.push(n),f))break}return i.length>1&&(i=i.filter(function(m){return!m.onSelect({e:r})})),i},_maybeGroupObjects:function(r){this.selection&&this._groupSelector&&this._groupSelectedObjects(r),this.setCursor(this.defaultCursor),this._groupSelector=null}})})();(function(){p.util.object.extend(p.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",r=e.quality||1,i=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(i,e);return p.util.toDataURL(n,t,r)},toCanvasElement:function(e,t){e=e||1,t=t||{};var r=(t.width||this.width)*e,i=(t.height||this.height)*e,n=this.getZoom(),a=this.width,s=this.height,o=n*e,c=this.viewportTransform,l=(c[4]-(t.left||0))*e,h=(c[5]-(t.top||0))*e,u=this.interactive,f=[o,0,0,o,l,h],d=this.enableRetinaScaling,m=p.util.createCanvasElement(),g=this.contextTop;return m.width=r,m.height=i,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=r,this.height=i,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),this._objects),this.viewportTransform=c,this.width=a,this.height=s,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=d,this.contextTop=g,m}})})();p.util.object.extend(p.StaticCanvas.prototype,{loadFromJSON:function(e,t,r){if(!e)return;var i=typeof e=="string"?JSON.parse(e):p.util.object.clone(e),n=this,a=i.clipPath,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete i.clipPath,this._enlivenObjects(i.objects,function(o){n.clear(),n._setBgOverlay(i,function(){a?n._enlivenObjects([a],function(c){n.clipPath=c[0],n.__setupCanvas.call(n,i,o,s,t)}):n.__setupCanvas.call(n,i,o,s,t)})},r),this},__setupCanvas:function(e,t,r,i){var n=this;t.forEach(function(a,s){n.insertAt(a,s)}),this.renderOnAddRemove=r,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),i&&i()},_setBgOverlay:function(e,t){var r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var i=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(t&&t())};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,i),this.__setBgOverlay("overlayImage",e.overlayImage,r,i),this.__setBgOverlay("backgroundColor",e.background,r,i),this.__setBgOverlay("overlayColor",e.overlay,r,i)},__setBgOverlay:function(e,t,r,i){var n=this;if(!t){r[e]=!0,i&&i();return}e==="backgroundImage"||e==="overlayImage"?p.util.enlivenObjects([t],function(a){n[e]=a[0],r[e]=!0,i&&i()}):this["set"+p.util.string.capitalize(e,!0)](t,function(){r[e]=!0,i&&i()})},_enlivenObjects:function(e,t,r){if(!e||e.length===0){t&&t([]);return}p.util.enlivenObjects(e,function(i){t&&t(i)},null,r)},_toDataURL:function(e,t){this.clone(function(r){t(r.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,r){this.clone(function(i){r(i.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var r=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(i){i.loadFromJSON(r,function(){e&&e(i)})})},cloneWithoutData:function(e){var t=p.util.createCanvasElement();t.width=this.width,t.height=this.height;var r=new p.Canvas(t);this.backgroundImage?(r.setBackgroundImage(this.backgroundImage.src,function(){r.renderAll(),e&&e(r)}),r.backgroundImageOpacity=this.backgroundImageOpacity,r.backgroundImageStretch=this.backgroundImageStretch):e&&e(r)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n=t.util.toFixed,a=t.util.string.capitalize,s=t.util.degreesToRadians,o=t.StaticCanvas.supports("setLineDash"),c=!t.isLikelyNode,l=2;if(t.Object)return;t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(h){h&&this.setOptions(h)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(h){var u=t.perfLimitSizeTotal,f=h.width,d=h.height,m=t.maxCacheSideLimit,g=t.minCacheSideLimit;if(f<=m&&d<=m&&f*d<=u)return f<g&&(h.width=g),d<g&&(h.height=g),h;var b=f/d,_=t.util.limitDimsByArea(b,u),I=t.util.capValue,M=I(g,_.x,m),U=I(g,_.y,m);return f>M&&(h.zoomX/=f/M,h.width=M,h.capped=!0),d>U&&(h.zoomY/=d/U,h.height=U,h.capped=!0),h},_getCacheCanvasDimensions:function(){var h=this.getTotalObjectScaling(),u=this._getTransformedDimensions(0,0),f=u.x*h.scaleX/this.scaleX,d=u.y*h.scaleY/this.scaleY;return{width:f+l,height:d+l,zoomX:h.scaleX,zoomY:h.scaleY,x:f,y:d}},_updateCacheCanvas:function(){var h=this.canvas;if(this.noScaleCache&&h&&h._currentTransform){var u=h._currentTransform.target,f=h._currentTransform.action;if(this===u&&f.slice&&f.slice(0,5)==="scale")return!1}var d=this._cacheCanvas,m=this._limitCacheSize(this._getCacheCanvasDimensions()),g=t.minCacheSideLimit,b=m.width,_=m.height,I,M,U=m.zoomX,L=m.zoomY,Y=b!==this.cacheWidth||_!==this.cacheHeight,V=this.zoomX!==U||this.zoomY!==L,F=Y||V,O=0,R=0,x=!1;if(Y){var v=this._cacheCanvas.width,E=this._cacheCanvas.height,A=b>v||_>E,S=(b<v*.9||_<E*.9)&&v>g&&E>g;x=A||S,A&&!m.capped&&(b>g||_>g)&&(O=b*.1,R=_*.1)}return F?(x?(d.width=Math.ceil(b+O),d.height=Math.ceil(_+R)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,d.width,d.height)),I=m.x/2,M=m.y/2,this.cacheTranslationX=Math.round(d.width/2-I)+I,this.cacheTranslationY=Math.round(d.height/2-M)+M,this.cacheWidth=b,this.cacheHeight=_,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(U,L),this.zoomX=U,this.zoomY=L,!0):!1},setOptions:function(h){this._setOptions(h),this._initGradient(h.fill,"fill"),this._initGradient(h.stroke,"stroke"),this._initPattern(h.fill,"fill"),this._initPattern(h.stroke,"stroke")},transform:function(h){var u=this.group&&!this.group._transformDone||this.group&&this.canvas&&h===this.canvas.contextTop,f=this.calcTransformMatrix(!u);h.transform(f[0],f[1],f[2],f[3],f[4],f[5])},toObject:function(h){var u=t.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:n(this.left,u),top:n(this.top,u),width:n(this.width,u),height:n(this.height,u),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,u),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,u),scaleX:n(this.scaleX,u),scaleY:n(this.scaleY,u),angle:n(this.angle,u),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,u),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,u),skewY:n(this.skewY,u)};return this.clipPath&&(f.clipPath=this.clipPath.toObject(h),f.clipPath.inverted=this.clipPath.inverted,f.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,f,h),this.includeDefaultValues||(f=this._removeDefaultValues(f)),f},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(h){var u=t.util.getKlass(h.type).prototype,f=u.stateProperties;return f.forEach(function(d){if(d==="left"||d==="top")return;h[d]===u[d]&&delete h[d];var m=Object.prototype.toString.call(h[d])==="[object Array]"&&Object.prototype.toString.call(u[d])==="[object Array]";m&&h[d].length===0&&u[d].length===0&&delete h[d]}),h},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var h=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(h.scaleX),scaleY:Math.abs(h.scaleY)}},getTotalObjectScaling:function(){var h=this.getObjectScaling(),u=h.scaleX,f=h.scaleY;if(this.canvas){var d=this.canvas.getZoom(),m=this.canvas.getRetinaScaling();u*=d*m,f*=d*m}return{scaleX:u,scaleY:f}},getObjectOpacity:function(){var h=this.opacity;return this.group&&(h*=this.group.getObjectOpacity()),h},_set:function(h,u){var f=h==="scaleX"||h==="scaleY",d=this[h]!==u,m=!1;return f&&(u=this._constrainScale(u)),h==="scaleX"&&u<0?(this.flipX=!this.flipX,u*=-1):h==="scaleY"&&u<0?(this.flipY=!this.flipY,u*=-1):h==="shadow"&&u&&!(u instanceof t.Shadow)?u=new t.Shadow(u):h==="dirty"&&this.group&&this.group.set("dirty",u),this[h]=u,d&&(m=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(h)>-1?(this.dirty=!0,m&&this.group.set("dirty",!0)):m&&this.stateProperties.indexOf(h)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(h){if(this.isNotVisible())return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;h.save(),this._setupCompositeOperation(h),this.drawSelectionBackground(h),this.transform(h),this._setOpacity(h),this._setShadow(h,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(h)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(h),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),h.restore()},renderCache:function(h){h=h||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,h.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"?!0:!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(h){var u=this.clipPath;if(h.save(),u.inverted?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="destination-in",u.absolutePositioned){var f=t.util.invertTransform(this.calcTransformMatrix());h.transform(f[0],f[1],f[2],f[3],f[4],f[5])}u.transform(h),h.scale(1/u.zoomX,1/u.zoomY),h.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),h.restore()},drawObject:function(h,u){var f=this.fill,d=this.stroke;u?(this.fill="black",this.stroke="",this._setClippingProperties(h)):(this._renderBackground(h),this._setStrokeStyles(h,this),this._setFillStyles(h,this)),this._render(h),this._drawClipPath(h),this.fill=f,this.stroke=d},_drawClipPath:function(h){var u=this.clipPath;if(!u)return;u.canvas=this.canvas,u.shouldCache(),u._transformDone=!0,u.renderCache({forClipping:!0}),this.drawClipPathOnCache(h)},drawCacheOnCanvas:function(h){h.scale(1/this.zoomX,1/this.zoomY),h.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(h){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!h&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!h){var u=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-u/2,-f/2,u,f)}return!0}return!1},_renderBackground:function(h){if(!this.backgroundColor)return;var u=this._getNonTransformedDimensions();h.fillStyle=this.backgroundColor,h.fillRect(-u.x/2,-u.y/2,u.x,u.y),this._removeShadow(h)},_setOpacity:function(h){this.group&&!this.group._transformDone?h.globalAlpha=this.getObjectOpacity():h.globalAlpha*=this.opacity},_setStrokeStyles:function(h,u){u.stroke&&(h.lineWidth=u.strokeWidth,h.lineCap=u.strokeLineCap,h.lineDashOffset=u.strokeDashOffset,h.lineJoin=u.strokeLineJoin,h.miterLimit=u.strokeMiterLimit,h.strokeStyle=u.stroke.toLive?u.stroke.toLive(h,this):u.stroke)},_setFillStyles:function(h,u){u.fill&&(h.fillStyle=u.fill.toLive?u.fill.toLive(h,this):u.fill)},_setClippingProperties:function(h){h.globalAlpha=1,h.strokeStyle="transparent",h.fillStyle="#000000"},_setLineDash:function(h,u,f){if(!u||u.length===0)return;1&u.length&&u.push.apply(u,u),o?h.setLineDash(u):f&&f(h)},_renderControls:function(h,u){var f=this.getViewportTransform(),d=this.calcTransformMatrix(),m,g,b;u=u||{},g=typeof u.hasBorders!="undefined"?u.hasBorders:this.hasBorders,b=typeof u.hasControls!="undefined"?u.hasControls:this.hasControls,d=t.util.multiplyTransformMatrices(f,d),m=t.util.qrDecompose(d),h.save(),h.translate(m.translateX,m.translateY),h.lineWidth=1*this.borderScaleFactor,this.group||(h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),u.forActiveSelection?(h.rotate(s(m.angle)),g&&this.drawBordersInGroup(h,m,u)):(h.rotate(s(this.angle)),g&&this.drawBorders(h,u)),b&&this.drawControls(h,u),h.restore()},_setShadow:function(h){if(!this.shadow)return;var u=this.shadow,f=this.canvas,d,m=f&&f.viewportTransform[0]||1,g=f&&f.viewportTransform[3]||1;u.nonScaling?d={scaleX:1,scaleY:1}:d=this.getObjectScaling(),f&&f._isRetinaScaling()&&(m*=t.devicePixelRatio,g*=t.devicePixelRatio),h.shadowColor=u.color,h.shadowBlur=u.blur*t.browserShadowBlurConstant*(m+g)*(d.scaleX+d.scaleY)/4,h.shadowOffsetX=u.offsetX*m*d.scaleX,h.shadowOffsetY=u.offsetY*g*d.scaleY},_removeShadow:function(h){if(!this.shadow)return;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_applyPatternGradientTransform:function(h,u){if(!u||!u.toLive)return{offsetX:0,offsetY:0};var f=u.gradientTransform||u.patternTransform,d=-this.width/2+u.offsetX||0,m=-this.height/2+u.offsetY||0;return u.gradientUnits==="percentage"?h.transform(this.width,0,0,this.height,d,m):h.transform(1,0,0,1,d,m),f&&h.transform(f[0],f[1],f[2],f[3],f[4],f[5]),{offsetX:d,offsetY:m}},_renderPaintInOrder:function(h){this.paintFirst==="stroke"?(this._renderStroke(h),this._renderFill(h)):(this._renderFill(h),this._renderStroke(h))},_render:function(){},_renderFill:function(h){if(!this.fill)return;h.save(),this._applyPatternGradientTransform(h,this.fill),this.fillRule==="evenodd"?h.fill("evenodd"):h.fill(),h.restore()},_renderStroke:function(h){if(!this.stroke||this.strokeWidth===0)return;if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeUniform&&this.group){var u=this.getObjectScaling();h.scale(1/u.scaleX,1/u.scaleY)}else this.strokeUniform&&h.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(h,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(h,this.stroke):this._applyPatternGradientTransform(h,this.stroke),h.stroke(),h.restore()},_applyPatternForTransformedGradient:function(h,u){var f=this._limitCacheSize(this._getCacheCanvasDimensions()),d=t.util.createCanvasElement(),m,g=this.canvas.getRetinaScaling(),b=f.x/this.scaleX/g,_=f.y/this.scaleY/g;d.width=b,d.height=_,m=d.getContext("2d"),m.beginPath(),m.moveTo(0,0),m.lineTo(b,0),m.lineTo(b,_),m.lineTo(0,_),m.closePath(),m.translate(b/2,_/2),m.scale(f.zoomX/this.scaleX/g,f.zoomY/this.scaleY/g),this._applyPatternGradientTransform(m,u),m.fillStyle=u.toLive(h),m.fill(),h.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),h.scale(g*this.scaleX/f.zoomX,g*this.scaleY/f.zoomY),h.strokeStyle=m.createPattern(d,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var h=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",h.scaleX),this.set("scaleY",h.scaleY),this.angle=h.angle,this.skewX=h.skewX,this.skewY=0}},_removeTransformMatrix:function(h){var u=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),u=t.util.transformPoint(u,this.transformMatrix)),this.transformMatrix=null,h&&(this.scaleX*=h.scaleX,this.scaleY*=h.scaleY,this.cropX=h.cropX,this.cropY=h.cropY,u.x+=h.offsetLeft,u.y+=h.offsetTop,this.width=h.width,this.height=h.height),this.setPositionByOrigin(u,"center","center")},clone:function(h,u){var f=this.toObject(u);this.constructor.fromObject?this.constructor.fromObject(f,h):t.Object._fromObject("Object",f,h)},cloneAsImage:function(h,u){var f=this.toCanvasElement(u);return h&&h(new t.Image(f)),this},toCanvasElement:function(h){h||(h={});var u=t.util,f=u.saveObjectTransform(this),d=this.group,m=this.shadow,g=Math.abs,b=(h.multiplier||1)*(h.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,h.withoutTransform&&u.resetObjectTransform(this),h.withoutShadow&&(this.shadow=null);var _=t.util.createCanvasElement(),I=this.getBoundingRect(!0,!0),M=this.shadow,U,L={x:0,y:0},Y,V,F;M&&(Y=M.blur,M.nonScaling?U={scaleX:1,scaleY:1}:U=this.getObjectScaling(),L.x=2*Math.round(g(M.offsetX)+Y)*g(U.scaleX),L.y=2*Math.round(g(M.offsetY)+Y)*g(U.scaleY)),V=I.width+L.x,F=I.height+L.y,_.width=Math.ceil(V),_.height=Math.ceil(F);var O=new t.StaticCanvas(_,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});h.format==="jpeg"&&(O.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(O.width/2,O.height/2),"center","center");var R=this.canvas;O.add(this);var x=O.toCanvasElement(b||1,h);return this.shadow=m,this.set("canvas",R),d&&(this.group=d),this.set(f).setCoords(),O._objects=[],O.dispose(),O=null,x},toDataURL:function(h){return h||(h={}),t.util.toDataURL(this.toCanvasElement(h),h.format||"png",h.quality||1)},isType:function(h){return this.type===h},complexity:function(){return 1},toJSON:function(h){return this.toObject(h)},rotate:function(h){var u=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return u&&this._setOriginToCenter(),this.set("angle",h),u&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(h,u){u=u||this.canvas.getPointer(h);var f=new t.Point(u.x,u.y),d=this._getLeftTopCoords();return this.angle&&(f=t.util.rotatePoint(f,d,s(-this.angle))),{x:f.x-d.x,y:f.y-d.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),r(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(h,u,f,d){var m=t[h];u=i(u,!0),t.util.enlivenPatterns([u.fill,u.stroke],function(g){typeof g[0]!="undefined"&&(u.fill=g[0]),typeof g[1]!="undefined"&&(u.stroke=g[1]),t.util.enlivenObjects([u.clipPath],function(b){u.clipPath=b[0];var _=d?new m(u[d],u):new m(u);f&&f(_)})})},t.Object.__uid=0})((typeof P!="undefined",P));(function(){var e=p.util.degreesToRadians,t={left:-.5,center:0,right:.5},r={top:-.5,center:0,bottom:.5};p.util.object.extend(p.Object.prototype,{translateToGivenOrigin:function(i,n,a,s,o){var c=i.x,l=i.y,h,u,f;return typeof n=="string"?n=t[n]:n-=.5,typeof s=="string"?s=t[s]:s-=.5,h=s-n,typeof a=="string"?a=r[a]:a-=.5,typeof o=="string"?o=r[o]:o-=.5,u=o-a,(h||u)&&(f=this._getTransformedDimensions(),c=i.x+h*f.x,l=i.y+u*f.y),new p.Point(c,l)},translateToCenterPoint:function(i,n,a){var s=this.translateToGivenOrigin(i,n,a,"center","center");return this.angle?p.util.rotatePoint(s,i,e(this.angle)):s},translateToOriginPoint:function(i,n,a){var s=this.translateToGivenOrigin(i,"center","center",n,a);return this.angle?p.util.rotatePoint(s,i,e(this.angle)):s},getCenterPoint:function(){var i=new p.Point(this.left,this.top);return this.translateToCenterPoint(i,this.originX,this.originY)},getPointByOrigin:function(i,n){var a=this.getCenterPoint();return this.translateToOriginPoint(a,i,n)},toLocalPoint:function(i,n,a){var s=this.getCenterPoint(),o,c;return typeof n!="undefined"&&typeof a!="undefined"?o=this.translateToGivenOrigin(s,"center","center",n,a):o=new p.Point(this.left,this.top),c=new p.Point(i.x,i.y),this.angle&&(c=p.util.rotatePoint(c,s,-e(this.angle))),c.subtractEquals(o)},setPositionByOrigin:function(i,n,a){var s=this.translateToCenterPoint(i,n,a),o=this.translateToOriginPoint(s,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(i){var n=e(this.angle),a=this.getScaledWidth(),s=p.util.cos(n)*a,o=p.util.sin(n)*a,c,l;typeof this.originX=="string"?c=t[this.originX]:c=this.originX-.5,typeof i=="string"?l=t[i]:l=i-.5,this.left+=s*(l-c),this.top+=o*(l-c),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var i=this.getCenterPoint();this.originX="center",this.originY="center",this.left=i.x,this.top=i.y},_resetOrigin:function(){var i=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=i.x,this.top=i.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function e(a){return[new p.Point(a.tl.x,a.tl.y),new p.Point(a.tr.x,a.tr.y),new p.Point(a.br.x,a.br.y),new p.Point(a.bl.x,a.bl.y)]}var t=p.util,r=t.degreesToRadians,i=t.multiplyTransformMatrices,n=t.transformPoint;t.object.extend(p.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,s){return s?a?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,s){return e(this._getCoords(a,s))},intersectsWithRect:function(a,s,o,c){var l=this.getCoords(o,c),h=p.Intersection.intersectPolygonRectangle(l,a,s);return h.status==="Intersection"},intersectsWithObject:function(a,s,o){var c=p.Intersection.intersectPolygonPolygon(this.getCoords(s,o),a.getCoords(s,o));return c.status==="Intersection"||a.isContainedWithinObject(this,s,o)||this.isContainedWithinObject(a,s,o)},isContainedWithinObject:function(a,s,o){for(var c=this.getCoords(s,o),l=s?a.aCoords:a.lineCoords,h=0,u=a._getImageLines(l);h<4;h++)if(!a.containsPoint(c[h],u))return!1;return!0},isContainedWithinRect:function(a,s,o,c){var l=this.getBoundingRect(o,c);return l.left>=a.x&&l.left+l.width<=s.x&&l.top>=a.y&&l.top+l.height<=s.y},containsPoint:function(a,s,o,c){var l=this._getCoords(o,c),s=s||this._getImageLines(l),h=this._findCrossPoints(a,s);return h!==0&&h%2===1},isOnScreen:function(a){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br,c=this.getCoords(!0,a);return c.some(function(l){return l.x<=o.x&&l.x>=s.x&&l.y<=o.y&&l.y>=s.y})||this.intersectsWithRect(s,o,!0,a)?!0:this._containsCenterOfCanvas(s,o,a)},_containsCenterOfCanvas:function(a,s,o){var c={x:(a.x+s.x)/2,y:(a.y+s.y)/2};return!!this.containsPoint(c,null,!0,o)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;if(this.intersectsWithRect(s,o,!0,a))return!0;var c=this.getCoords(!0,a).every(function(l){return(l.x>=o.x||l.x<=s.x)&&(l.y>=o.y||l.y<=s.y)});return c&&this._containsCenterOfCanvas(s,o,a)},_getImageLines:function(a){var s={topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}};return s},_findCrossPoints:function(a,s){var o,c,l,h,u,f=0,d;for(var m in s){if(d=s[m],d.o.y<a.y&&d.d.y<a.y)continue;if(d.o.y>=a.y&&d.d.y>=a.y)continue;if(d.o.x===d.d.x&&d.o.x>=a.x?u=d.o.x:(o=0,c=(d.d.y-d.o.y)/(d.d.x-d.o.x),l=a.y-o*a.x,h=d.o.y-c*d.o.x,u=-(l-h)/(o-c)),u>=a.x&&(f+=1),f===2)break}return f},getBoundingRect:function(a,s){var o=this.getCoords(a,s);return t.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a===0?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,s){var o=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(a/this.width/o)},scaleToHeight:function(a,s){var o=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(a/this.height/o)},calcCoords:function(a){return a?this.calcACoords():this.calcOCoords()},calcLineCoords:function(){var a=this.getViewportTransform(),s=this.padding,o=r(this.angle),c=t.cos(o),l=t.sin(o),h=c*s,u=l*s,f=h+u,d=h-u,m=this.calcACoords(),g={tl:n(m.tl,a),tr:n(m.tr,a),bl:n(m.bl,a),br:n(m.br,a)};return s&&(g.tl.x-=d,g.tl.y-=f,g.tr.x+=f,g.tr.y-=d,g.bl.x-=f,g.bl.y+=d,g.br.x+=d,g.br.y+=f),g},calcOCoords:function(){var a=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=this.getViewportTransform(),c=i(o,s),l=i(c,a),l=i(l,[1/o[0],0,0,1/o[3],0,0]),h=this._calculateCurrentDimensions(),u={};return this.forEachControl(function(f,d,m){u[d]=f.positionHandler(h,l,m)}),u},calcACoords:function(){var a=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=i(s,a),c=this._getTransformedDimensions(),l=c.x/2,h=c.y/2;return{tl:n({x:-l,y:-h},o),tr:n({x:l,y:-h},o),bl:n({x:-l,y:h},o),br:n({x:l,y:h},o)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return t.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var s="_",o="";return!a&&this.group&&(o=this.group.transformMatrixKey(a)+s),o+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var s=this.calcOwnMatrix();if(a||!this.group)return s;var o=this.transformMatrixKey(a),c=this.matrixCache||(this.matrixCache={});return c.key===o?c.value:(this.group&&(s=i(this.group.calcTransformMatrix(!1),s)),c.key=o,c.value=s,s)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===a)return s.value;var o=this._calcTranslateMatrix(),c={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=a,s.value=t.composeMatrix(c),s.value},_calcDimensionsTransformMatrix:function(a,s,o){return t.calcDimensionsMatrix({skewX:a,skewY:s,scaleX:this.scaleX*(o&&this.flipX?-1:1),scaleY:this.scaleY*(o&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var a=this.strokeWidth,s=this.width+a,o=this.height+a;return{x:s,y:o}},_getTransformedDimensions:function(a,s){typeof a=="undefined"&&(a=this.skewX),typeof s=="undefined"&&(s=this.skewY);var o=this._getNonTransformedDimensions(),c,l,h=a===0&&s===0;if(this.strokeUniform?(c=this.width,l=this.height):(c=o.x,l=o.y),h)return this._finalizeDimensions(c*this.scaleX,l*this.scaleY);var u=t.sizeAfterTransform(c,l,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:s});return this._finalizeDimensions(u.x,u.y)},_finalizeDimensions:function(a,s){return this.strokeUniform?{x:a+this.strokeWidth,y:s+this.strokeWidth}:{x:a,y:s}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),s=this._getTransformedDimensions(),o=n(s,a,!0);return o.scalarAdd(2*this.padding)}})})();p.util.object.extend(p.Object.prototype,{sendToBack:function(){return this.group?p.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?p.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?p.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?p.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&this.group.type!=="activeSelection"?p.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}});(function(){function e(r,i){if(i){if(i.toLive)return r+": url(#SVGID_"+i.id+"); ";var n=new p.Color(i),a=r+": "+n.toRgb()+"; ",s=n.getAlpha();return s!==1&&(a+=r+"-opacity: "+s.toString()+"; "),a}else return r+": none; "}var t=p.util.toFixed;p.util.object.extend(p.Object.prototype,{getSvgStyles:function(r){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",c=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=typeof this.opacity!="undefined"?this.opacity:"1",u=this.visible?"":" visibility: hidden;",f=r?"":this.getSvgFilter(),d=e("fill",this.fill),m=e("stroke",this.stroke);return[m,"stroke-width: ",n,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",c,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",h,";",f,u].join("")},getSvgSpanStyles:function(r,i){var n="; ",a=r.fontFamily?"font-family: "+(r.fontFamily.indexOf("'")===-1&&r.fontFamily.indexOf('"')===-1?"'"+r.fontFamily+"'":r.fontFamily)+n:"",s=r.strokeWidth?"stroke-width: "+r.strokeWidth+n:"",a=a,o=r.fontSize?"font-size: "+r.fontSize+"px"+n:"",c=r.fontStyle?"font-style: "+r.fontStyle+n:"",l=r.fontWeight?"font-weight: "+r.fontWeight+n:"",h=r.fill?e("fill",r.fill):"",u=r.stroke?e("stroke",r.stroke):"",f=this.getSvgTextDecoration(r),d=r.deltaY?"baseline-shift: "+-r.deltaY+"; ":"";return f&&(f="text-decoration: "+f+n),[u,s,a,o,c,l,f,h,d,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(r){return["overline","underline","line-through"].filter(function(i){return r[i.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(r,i){var n=r?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+p.util.matrixToSVG(n);return a+(i||"")+'" '},_setSVGBg:function(r){if(this.backgroundColor){var i=p.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),`"></rect>
`)}},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(r),{reviver:r})},toClipPathSVG:function(r){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(r),{reviver:r})},_createBaseClipPathSVGMarkup:function(r,i){i=i||{};var n=i.reviver,a=i.additionalTransform||"",s=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),o=r.indexOf("COMMON_PARTS");return r[o]=s,n?n(r.join("")):r.join("")},_createBaseSVGMarkup:function(r,i){i=i||{};var n=i.noStyle,a=i.reviver,s=n?"":'style="'+this.getSvgStyles()+'" ',o=i.withShadow?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=c&&c.absolutePositioned,u=this.stroke,f=this.fill,d=this.shadow,m,g=[],b,_=r.indexOf("COMMON_PARTS"),I=i.additionalTransform;return c&&(c.clipPathId="CLIPPATH_"+p.Object.__uid++,b='<clipPath id="'+c.clipPathId+`" >
`+c.toClipPathSVG(a)+`</clipPath>
`),h&&g.push("<g ",o,this.getSvgCommons(),` >
`),g.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons(),` >
`),m=[s,l,n?"":this.addPaintOrder()," ",I?'transform="'+I+'" ':""].join(""),r[_]=m,f&&f.toLive&&g.push(f.toSVG(this)),u&&u.toLive&&g.push(u.toSVG(this)),d&&g.push(d.toSVG(this)),c&&g.push(b),g.push(r.join("")),g.push(`</g>
`),h&&g.push(`</g>
`),a?a(g.join("")):g.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})})();(function(){var e=p.util.object.extend,t="stateProperties";function r(n,a,s){var o={},c=!0;s.forEach(function(l){o[l]=n[l]}),e(n[a],o,c)}function i(n,a,s){if(n===a)return!0;if(Array.isArray(n)){if(!Array.isArray(a)||n.length!==a.length)return!1;for(var o=0,c=n.length;o<c;o++)if(!i(n[o],a[o]))return!1;return!0}else if(n&&typeof n=="object"){var l=Object.keys(n),h;if(!a||typeof a!="object"||!s&&l.length!==Object.keys(a).length)return!1;for(var o=0,c=l.length;o<c;o++){if(h=l[o],h==="canvas"||h==="group")continue;if(!i(n[h],a[h]))return!1}return!0}}p.util.object.extend(p.Object.prototype,{hasStateChanged:function(n){n=n||t;var a="_"+n;return Object.keys(this[a]).length<this[n].length?!0:!i(this[a],this,!0)},saveState:function(n){var a=n&&n.propertySet||t,s="_"+a;return this[s]?(r(this,s,this[a]),n&&n.stateProperties&&r(this,s,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var a=n.propertySet||t;return n.propertySet=a,this["_"+a]={},this.saveState(n),this}})})();(function(){var e=p.util.degreesToRadians;p.util.object.extend(p.Object.prototype,{_findTargetCorner:function(t,r){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i=t.x,n=t.y,a,s,o=Object.keys(this.oCoords),c=o.length-1,l;for(this.__corner=0;c>=0;c--){if(l=o[c],!this.isControlVisible(l))continue;if(s=this._getImageLines(r?this.oCoords[l].touchCorner:this.oCoords[l].corner),a=this._findCrossPoints({x:i,y:n},s),a!==0&&a%2===1)return this.__corner=l,l}return!1},forEachControl:function(t){for(var r in this.controls)t(this.controls[r],r,this)},_setCornerCoords:function(){var t=this.oCoords,r=e(45-this.angle),i=p.util.cos(r),n=p.util.sin(r),a=this.cornerSize*.707106,s=this.touchCornerSize*.707106,o=a*i,c=a*n,l=s*i,h=s*n,u,f;for(var d in t)u=t[d].x,f=t[d].y,t[d].corner={tl:{x:u-c,y:f-o},tr:{x:u+o,y:f-c},bl:{x:u-o,y:f+c},br:{x:u+c,y:f+o}},t[d].touchCorner={tl:{x:u-h,y:f-l},tr:{x:u+l,y:f-h},bl:{x:u-l,y:f+h},br:{x:u+h,y:f+l}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var r=this.getCenterPoint(),i=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return t.translate(r.x,r.y),t.scale(1/n[0],1/n[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(t,r){r=r||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,a=i.x+n,s=i.y+n,o=typeof r.hasControls!="undefined"?r.hasControls:this.hasControls,c=!1;return t.save(),t.strokeStyle=r.borderColor||this.borderColor,this._setLineDash(t,r.borderDashArray||this.borderDashArray,null),t.strokeRect(-a/2,-s/2,a,s),o&&(t.beginPath(),this.forEachControl(function(l,h,u){l.withConnection&&l.getVisibility(u,h)&&(c=!0,t.moveTo(l.x*a,l.y*s),t.lineTo(l.x*a+l.offsetX,l.y*s+l.offsetY))}),c&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,r,i){i=i||{};var n=p.util.sizeAfterTransform(this.width,this.height,r),a=this.strokeWidth,s=this.strokeUniform,o=this.borderScaleFactor,c=n.x+a*(s?this.canvas.getZoom():r.scaleX)+o,l=n.y+a*(s?this.canvas.getZoom():r.scaleY)+o;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-c/2,-l/2,c,l),t.restore(),this},drawControls:function(t,r){return r=r||{},t.save(),t.setTransform(this.canvas.getRetinaScaling(),0,0,this.canvas.getRetinaScaling(),0,0),t.strokeStyle=t.fillStyle=r.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=r.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,r.cornerDashArray||this.cornerDashArray,null),this.setCoords(),this.forEachControl(function(i,n,a){i.getVisibility(a,n)&&i.render(t,a.oCoords[n].x,a.oCoords[n].y,r,a)}),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,r){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=r,this},setControlsVisibility:function(t){t||(t={});for(var r in t)this.setControlVisible(r,t[r]);return this},onDeselect:function(){},onSelect:function(){}})})();p.util.object.extend(p.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,a=this;return p.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(s){e.set("left",s),a.requestRenderAll(),n()},onComplete:function(){e.setCoords(),i()}}),this},fxCenterObjectV:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,a=this;return p.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(s){e.set("top",s),a.requestRenderAll(),n()},onComplete:function(){e.setCoords(),i()}}),this},fxRemove:function(e,t){t=t||{};var r=function(){},i=t.onComplete||r,n=t.onChange||r,a=this;return p.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(s){e.set("opacity",s),a.requestRenderAll(),n()},onComplete:function(){a.remove(e),i()}}),this}});p.util.object.extend(p.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,r;for(t in arguments[0])e.push(t);for(var i=0,n=e.length;i<n;i++)t=e[i],r=i!==n-1,this._animate(t,arguments[0][t],arguments[1],r)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,r,i){var n=this,a;t=t.toString(),r?r=p.util.object.clone(r):r={},~e.indexOf(".")&&(a=e.split("."));var s=n.colorProperties.indexOf(e)>-1||a&&n.colorProperties.indexOf(a[1])>-1,o=a?this.get(a[0])[a[1]]:this.get(e);"from"in r||(r.from=o),s||(~t.indexOf("=")?t=o+parseFloat(t.replace("=","")):t=parseFloat(t));var c={startValue:r.from,endValue:t,byValue:r.by,easing:r.easing,duration:r.duration,abort:r.abort&&function(){return r.abort.call(n)},onChange:function(l,h,u){if(a?n[a[0]][a[1]]=l:n.set(e,l),i)return;r.onChange&&r.onChange(l,h,u)},onComplete:function(l,h,u){if(i)return;n.setCoords(),r.onComplete&&r.onComplete(l,h,u)}};s?p.util.animateColor(c.startValue,c.endValue,c.duration,c):p.util.animate(c)}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.object.clone,n={x1:1,x2:1,y1:1,y2:1},a=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(o,c){o||(o=[0,0,0,0]),this.callSuper("initialize",c),this.set("x1",o[0]),this.set("y1",o[1]),this.set("x2",o[2]),this.set("y2",o[3]),this._setWidthHeight(c)},_setWidthHeight:function(o){o||(o={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in o?o.left:this._getLeftToOriginX(),this.top="top"in o?o.top:this._getTopToOriginY()},_set:function(o,c){return this.callSuper("_set",o,c),typeof n[o]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(o){if(o.beginPath(),!this.strokeDashArray||this.strokeDashArray&&a){var c=this.calcLinePoints();o.moveTo(c.x1,c.y1),o.lineTo(c.x2,c.y2)}o.lineWidth=this.strokeWidth;var l=o.strokeStyle;o.strokeStyle=this.stroke||o.fillStyle,this.stroke&&this._renderStroke(o),o.strokeStyle=l},_renderDashedStroke:function(o){var c=this.calcLinePoints();o.beginPath(),t.util.drawDashedLine(o,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray),o.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(o){return r(this.callSuper("toObject",o),this.calcLinePoints())},_getNonTransformedDimensions:function(){var o=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(o.y-=this.strokeWidth),this.height===0&&(o.x-=this.strokeWidth)),o},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1,l=o*this.width*.5,h=c*this.height*.5,u=o*this.width*-.5,f=c*this.height*-.5;return{x1:l,x2:u,y1:h,y2:f}},_toSVG:function(){var o=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`" />
`]}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(o,c,l){l=l||{};var h=t.parseAttributes(o,t.Line.ATTRIBUTE_NAMES),u=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];c(new t.Line(u,r(h,l)))},t.Line.fromObject=function(o,c){function l(u){delete u.points,c&&c(u)}var h=i(o,!0);h.points=[o.x1,o.y1,o.x2,o.y2],t.Object._fromObject("Line",h,l,"points")};function s(o,c){var l=o.origin,h=o.axis1,u=o.axis2,f=o.dimension,d=c.nearest,m=c.center,g=c.farthest;return function(){switch(this.get(l)){case d:return Math.min(this.get(h),this.get(u));case m:return Math.min(this.get(h),this.get(u))+.5*this.get(f);case g:return Math.max(this.get(h),this.get(u))}}}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:r*2,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,a){return this.callSuper("_set",n,a),n==="radius"&&this.setRadius(a),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,a=0,s=0,o=(this.endAngle-this.startAngle)%(2*r);if(o===0)n=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+s+'" ','r="',this.radius,`" />
`];else{var c=t.util.cos(this.startAngle)*this.radius,l=t.util.sin(this.startAngle)*this.radius,h=t.util.cos(this.endAngle)*this.radius,u=t.util.sin(this.endAngle)*this.radius,f=o>r?"1":"0";n=['<path d="M '+c+" "+l," A "+this.radius+" "+this.radius," 0 ",+f+" 1"," "+h+" "+u,'" ',"COMMON_PARTS",` />
`]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",n*2).set("height",n*2)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(n,a){var s=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES);if(!i(s))throw new Error("value of `r` attribute is required and can not be negative");s.left=(s.left||0)-s.radius,s.top=(s.top||0)-s.radius,a(new t.Circle(s))};function i(n){return"radius"in n&&n.radius>=0}t.Circle.fromObject=function(n,a){return t.Object._fromObject("Circle",n,a)}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(r){var i=this.width/2,n=this.height/2;r.beginPath(),r.moveTo(-i,n),r.lineTo(0,-n),r.lineTo(i,n),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){var i=this.width/2,n=this.height/2;r.beginPath(),t.util.drawDashedLine(r,-i,n,0,-n,this.strokeDashArray),t.util.drawDashedLine(r,0,-n,i,n,this.strokeDashArray),t.util.drawDashedLine(r,i,n,-i,n,this.strokeDashArray),r.closePath()},_toSVG:function(){var r=this.width/2,i=this.height/2,n=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return["<polygon ","COMMON_PARTS",'points="',n,'" />']}}),t.Triangle.fromObject=function(r,i){return t.Object._fromObject("Triangle",r,i)}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.PI*2;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this.set("rx",i&&i.rx||0),this.set("ry",i&&i.ry||0)},_set:function(i,n){this.callSuper("_set",i,n);switch(i){case"rx":this.rx=n,this.set("width",n*2);break;case"ry":this.ry=n,this.set("height",n*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(i){i.beginPath(),i.save(),i.transform(1,0,0,this.ry/this.rx,0,0),i.arc(0,0,this.rx,0,r,!1),i.restore(),this._renderPaintInOrder(i)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(i,n){var a=t.parseAttributes(i,t.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,n(new t.Ellipse(a))},t.Ellipse.fromObject=function(i,n){return t.Object._fromObject("Ellipse",i,n)}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend;if(t.Rect){t.warn("fabric.Rect is already defined");return}t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(i){var n=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,s=this.width,o=this.height,c=-this.width/2,l=-this.height/2,h=n!==0||a!==0,u=1-.5522847498;i.beginPath(),i.moveTo(c+n,l),i.lineTo(c+s-n,l),h&&i.bezierCurveTo(c+s-u*n,l,c+s,l+u*a,c+s,l+a),i.lineTo(c+s,l+o-a),h&&i.bezierCurveTo(c+s,l+o-u*a,c+s-u*n,l+o,c+s-n,l+o),i.lineTo(c+n,l+o),h&&i.bezierCurveTo(c+u*n,l+o,c,l+o-u*a,c,l+o-a),i.lineTo(c,l+a),h&&i.bezierCurveTo(c,l+u*a,c+u*n,l,c+n,l),i.closePath(),this._renderPaintInOrder(i)},_renderDashedStroke:function(i){var n=-this.width/2,a=-this.height/2,s=this.width,o=this.height;i.beginPath(),t.util.drawDashedLine(i,n,a,n+s,a,this.strokeDashArray),t.util.drawDashedLine(i,n+s,a,n+s,a+o,this.strokeDashArray),t.util.drawDashedLine(i,n+s,a+o,n,a+o,this.strokeDashArray),t.util.drawDashedLine(i,n,a+o,n,a,this.strokeDashArray),i.closePath()},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){var i=-this.width/2,n=-this.height/2;return["<rect ","COMMON_PARTS",'x="',i,'" y="',n,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(i,n,a){if(!i)return n(null);a=a||{};var s=t.parseAttributes(i,t.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0,s.height=s.height||0,s.width=s.width||0;var o=new t.Rect(r(a?t.util.object.clone(a):{},s));o.visible=o.visible&&o.width>0&&o.height>0,n(o)},t.Rect.fromObject=function(i,n){return t.Object._fromObject("Rect",i,n)}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.util.array.min,n=t.util.array.max,a=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(s,o){o=o||{},this.points=s||[],this.callSuper("initialize",o),this._setPositionDimensions(o)},_setPositionDimensions:function(s){var o=this._calcDimensions(s),c;this.width=o.width,this.height=o.height,s.fromSVG||(c=this.translateToGivenOrigin({x:o.left-this.strokeWidth/2,y:o.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof s.left=="undefined"&&(this.left=s.fromSVG?o.left:c.x),typeof s.top=="undefined"&&(this.top=s.fromSVG?o.top:c.y),this.pathOffset={x:o.left+this.width/2,y:o.top+this.height/2}},_calcDimensions:function(){var s=this.points,o=i(s,"x")||0,c=i(s,"y")||0,l=n(s,"x")||0,h=n(s,"y")||0,u=l-o,f=h-c;return{left:o,top:c,width:u,height:f}},toObject:function(s){return r(this.callSuper("toObject",s),{points:this.points.concat()})},_toSVG:function(){for(var s=[],o=this.pathOffset.x,c=this.pathOffset.y,l=t.Object.NUM_FRACTION_DIGITS,h=0,u=this.points.length;h<u;h++)s.push(a(this.points[h].x-o,l),",",a(this.points[h].y-c,l)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',s.join(""),`" />
`]},commonRender:function(s){var o,c=this.points.length,l=this.pathOffset.x,h=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;s.beginPath(),s.moveTo(this.points[0].x-l,this.points[0].y-h);for(var u=0;u<c;u++)o=this.points[u],s.lineTo(o.x-l,o.y-h);return!0},_render:function(s){if(!this.commonRender(s))return;this._renderPaintInOrder(s)},_renderDashedStroke:function(s){var o,c;s.beginPath();for(var l=0,h=this.points.length;l<h;l++)o=this.points[l],c=this.points[l+1]||o,t.util.drawDashedLine(s,o.x,o.y,c.x,c.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(s){return function(o,c,l){if(!o)return c(null);l||(l={});var h=t.parsePointsAttribute(o.getAttribute("points")),u=t.parseAttributes(o,t[s].ATTRIBUTE_NAMES);u.fromSVG=!0,c(new t[s](h,r(u,l)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(s,o){return t.Object._fromObject("Polyline",s,o,"points")}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_render:function(r){if(!this.commonRender(r))return;r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){this.callSuper("_renderDashedStroke",r),r.closePath()}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(r,i){return t.Object._fromObject("Polygon",r,i,"points")}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max,n=t.util.object.extend,a=Object.prototype.toString,s=t.util.toFixed;if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(o,c){c=c||{},this.callSuper("initialize",c),o||(o=[]);var l=a.call(o)==="[object Array]";if(this.path=l?t.util.makePathSimpler(o):t.util.makePathSimpler(t.util.parsePath(o)),!this.path)return;t.Polyline.prototype._setPositionDimensions.call(this,c)},_renderPathCommands:function(o){var c,l=0,h=0,u=0,f=0,d=0,m=0,g=-this.pathOffset.x,b=-this.pathOffset.y;o.beginPath();for(var _=0,I=this.path.length;_<I;++_){c=this.path[_];switch(c[0]){case"L":u=c[1],f=c[2],o.lineTo(u+g,f+b);break;case"M":u=c[1],f=c[2],l=u,h=f,o.moveTo(u+g,f+b);break;case"C":u=c[5],f=c[6],d=c[3],m=c[4],o.bezierCurveTo(c[1]+g,c[2]+b,d+g,m+b,u+g,f+b);break;case"Q":o.quadraticCurveTo(c[1]+g,c[2]+b,c[3]+g,c[4]+b),u=c[3],f=c[4],d=c[1],m=c[2];break;case"z":case"Z":u=l,f=h,o.closePath();break}}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return n(this.callSuper("toObject",o),{path:this.path.map(function(c){return c.slice()})})},toDatalessObject:function(o){var c=this.toObject(["sourcePath"].concat(o));return c.sourcePath&&delete c.path,c},_toSVG:function(){var o=this.path.map(function(c){return c.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=t.Object.NUM_FRACTION_DIGITS;return" translate("+s(-this.pathOffset.x,o)+", "+s(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var c=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},toSVG:function(o){var c=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var o=[],c=[],l,h=0,u=0,f=0,d=0,m,g=0,b=this.path.length;g<b;++g){l=this.path[g];switch(l[0]){case"L":f=l[1],d=l[2],m=[];break;case"M":f=l[1],d=l[2],h=f,u=d,m=[];break;case"C":m=t.util.getBoundsOfCurve(f,d,l[1],l[2],l[3],l[4],l[5],l[6]),f=l[5],d=l[6];break;case"Q":m=t.util.getBoundsOfCurve(f,d,l[1],l[2],l[1],l[2],l[3],l[4]),f=l[3],d=l[4];break;case"z":case"Z":f=h,d=u;break}m.forEach(function(V){o.push(V.x),c.push(V.y)}),o.push(f),c.push(d)}var _=r(o)||0,I=r(c)||0,M=i(o)||0,U=i(c)||0,L=M-_,Y=U-I;return{left:_,top:I,width:L,height:Y}}}),t.Path.fromObject=function(o,c){if(typeof o.sourcePath=="string"){var l=o.sourcePath;t.loadSVGFromURL(l,function(h){var u=h[0];u.setOptions(o),c&&c(u)})}else t.Object._fromObject("Path",o,c,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(o,c,l){var h=t.parseAttributes(o,t.Path.ATTRIBUTE_NAMES);h.fromSVG=!0,c(new t.Path(h.d,n(h,l)))}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.array.min,i=t.util.array.max;if(t.Group)return;t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,a,s){a=a||{},this._objects=[],s&&this.callSuper("initialize",a),this._objects=n||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(s)this._updateObjectsACoords();else{var c=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),c||this._calcBounds(),this._updateObjectsCoords(c),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var n=!0,a=this._objects.length;a--;)this._objects[a].setCoords(n)},_updateObjectsCoords:function(n){for(var n=n||this.getCenterPoint(),a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],n)},_updateObjectCoords:function(n,a){var s=n.left,o=n.top,c=!0;n.set({left:s-a.x,top:o-a.y}),n.group=this,n.setCoords(c)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),n&&(this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,a){var s=this._objects.length;if(this.useSetOnGroup)for(;s--;)this._objects[s].setOnGroup(n,a);if(n==="canvas")for(;s--;)this._objects[s]._set(n,a);t.Object.prototype._set.call(this,n,a)},toObject:function(n){var a=this.includeDefaultValues,s=this._objects.map(function(c){var l=c.includeDefaultValues;c.includeDefaultValues=a;var h=c.toObject(n);return c.includeDefaultValues=l,h}),o=t.Object.prototype.toObject.call(this,n);return o.objects=s,o},toDatalessObject:function(n){var a,s=this.sourcePath;if(s)a=s;else{var o=this.includeDefaultValues;a=this._objects.map(function(l){var h=l.includeDefaultValues;l.includeDefaultValues=o;var u=l.toDatalessObject(n);return l.includeDefaultValues=h,u})}var c=t.Object.prototype.toDatalessObject.call(this,n);return c.objects=a,c},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=t.Object.prototype.shouldCache.call(this);if(n){for(var a=0,s=this._objects.length;a<s;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return n},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,a=this._objects.length;n<a;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var a=0,s=this._objects.length;a<s;a++)this._objects[a].render(n);this._drawClipPath(n)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var a=0,s=this._objects.length;a<s;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-c/2,o,c)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(n){var a=n.calcTransformMatrix(),s=t.util.qrDecompose(a),o=new t.Point(s.translateX,s.translateY);return n.flipX=!1,n.flipY=!1,n.set("scaleX",s.scaleX),n.set("scaleY",s.scaleY),n.skewX=s.skewX,n.skewY=s.skewY,n.angle=s.angle,n.setPositionByOrigin(o,"center","center"),n},_restoreObjectState:function(n){return this.realizeTransform(n),delete n.group,n.setCoords(),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(!this.canvas)return;var n=this._objects,a=this.canvas;this._objects=[];var s=this.toObject();delete s.objects;var o=new t.ActiveSelection([]);return o.set(s),o.type="activeSelection",a.remove(this),n.forEach(function(c){c.group=o,c.dirty=!0,a.add(c)}),o.canvas=a,o._objects=n,a._activeObject=o,o.setCoords(),o},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0;return this.forEachObject(function(a){a.setCoords(n)}),this},_calcBounds:function(n){for(var a=[],s=[],o,c,l=["tr","br","bl","tl"],h=0,u=this._objects.length,f,d=l.length;h<u;++h)for(o=this._objects[h],o.aCoords=o.calcACoords(),f=0;f<d;f++)c=l[f],a.push(o.aCoords[c].x),s.push(o.aCoords[c].y);this._getBounds(a,s,n)},_getBounds:function(n,a,s){var o=new t.Point(r(n),r(a)),c=new t.Point(i(n),i(a)),l=o.y||0,h=o.x||0,u=c.x-o.x||0,f=c.y-o.y||0;this.width=u,this.height=f,s||this.setPositionByOrigin({x:h,y:l},"left","top")},_toSVG:function(n){for(var a=["<g ","COMMON_PARTS",` >
`],s=0,o=this._objects.length;s<o;s++)a.push("		",this._objects[s].toSVG(n));return a.push(`</g>
`),a},getSvgStyles:function(){var n=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),a].join("")},toClipPathSVG:function(n){for(var a=[],s=0,o=this._objects.length;s<o;s++)a.push("	",this._objects[s].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(a,{reviver:n})}}),t.Group.fromObject=function(n,a){var s=n.objects,o=t.util.object.clone(n,!0);if(delete o.objects,typeof s=="string"){t.loadSVGFromURL(s,function(c){var l=t.util.groupSVGElements(c,n,s);l.set(o),a&&a(l)});return}t.util.enlivenObjects(s,function(c){t.util.enlivenObjects([n.clipPath],function(l){var h=t.util.object.clone(n,!0);h.clipPath=l[0],delete h.objects,a&&a(new t.Group(c,h,!0))})})}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.ActiveSelection)return;t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(r,i){i=i||{},this._objects=r||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var r=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete i.type,n.set(i),r.forEach(function(s){s.canvas.remove(s),s.group=n}),n._objects=r,!this.canvas)return n;var a=this.canvas;return a.add(n),a._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(r,i,n){r.save(),r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",r,i),n=n||{},typeof n.hasControls=="undefined"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var a=0,s=this._objects.length;a<s;a++)this._objects[a]._renderControls(r,n);r.restore()}}),t.ActiveSelection.fromObject=function(r,i){t.util.enlivenObjects(r.objects,function(n){delete r.objects,i&&i(new t.ActiveSelection(n,r,!0))})}})((typeof P!="undefined",P));(function(e){"use strict";var t=p.util.object.extend;if(e.fabric||(e.fabric={}),e.fabric.Image){p.warn("fabric.Image is already defined.");return}p.Image=p.util.createClass(p.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:p.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(r,i){i||(i={}),this.filters=[],this.cacheKey="texture"+p.Object.__uid++,this.callSuper("initialize",i),this._initElement(r,i)},getElement:function(){return this._element||{}},setElement:function(r,i){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=r,this._originalElement=r,this._initConfig(i),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(r){var i=p.filterBackend;i&&i.evictCachesForKey&&i.evictCachesForKey(r)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(r){p.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var r=this.getElement();return{width:r.naturalWidth||r.width,height:r.naturalHeight||r.height}},_stroke:function(r){if(!this.stroke||this.strokeWidth===0)return;var i=this.width/2,n=this.height/2;r.beginPath(),r.moveTo(-i,-n),r.lineTo(i,-n),r.lineTo(i,n),r.lineTo(-i,n),r.lineTo(-i,-n),r.closePath()},_renderDashedStroke:function(r){var i=-this.width/2,n=-this.height/2,a=this.width,s=this.height;r.save(),this._setStrokeStyles(r,this),r.beginPath(),p.util.drawDashedLine(r,i,n,i+a,n,this.strokeDashArray),p.util.drawDashedLine(r,i+a,n,i+a,n+s,this.strokeDashArray),p.util.drawDashedLine(r,i+a,n+s,i,n+s,this.strokeDashArray),p.util.drawDashedLine(r,i,n+s,i,n,this.strokeDashArray),r.closePath(),r.restore()},toObject:function(r){var i=[];this.filters.forEach(function(a){a&&i.push(a.toObject())});var n=t(this.callSuper("toObject",["cropX","cropY"].concat(r)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var r=[],i=[],n,a=this._element,s=-this.width/2,o=-this.height/2,c="",l="";if(!a)return[];if(this.hasCrop()){var h=p.Object.__uid++;r.push('<clipPath id="imageCrop_'+h+`">
`,'	<rect x="'+s+'" y="'+o+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(l='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',o-this.cropY,'" width="',a.width||a.naturalWidth,'" height="',a.height||a.height,l,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var u=this.fill;this.fill=null,n=["	<rect ",'x="',s,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=u}return this.paintFirst!=="fill"?r=r.concat(n,i):r=r.concat(i,n),r},getSrc:function(r){var i=r?this._element:this._originalElement;return i?i.toDataURL?i.toDataURL():this.srcFromAttribute?i.getAttribute("src"):i.src:this.src||""},setSrc:function(r,i,n){return p.util.loadImage(r,function(a,s){this.setElement(a,n),this._setWidthHeight(),i&&i(this,s)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var r=this.resizeFilter,i=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),a=n.scaleX,s=n.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!r||a>i&&s>i){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=s;return}p.filterBackend||(p.filterBackend=p.initFilterBackend());var c=p.util.createCanvasElement(),l=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,h=o.width,u=o.height;c.width=h,c.height=u,this._element=c,this._lastScaleX=r.scaleX=a,this._lastScaleY=r.scaleY=s,p.filterBackend.applyFilters([r],o,h,u,this._element,l),this._filterScalingX=c.width/this._originalElement.width,this._filterScalingY=c.height/this._originalElement.height},applyFilters:function(r){if(r=r||this.filters||[],r=r.filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),r.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var i=this._originalElement,n=i.naturalWidth||i.width,a=i.naturalHeight||i.height;if(this._element===this._originalElement){var s=p.util.createCanvasElement();s.width=n,s.height=a,this._element=s,this._filteredEl=s}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,a),this._lastScaleX=1,this._lastScaleY=1;return p.filterBackend||(p.filterBackend=p.initFilterBackend()),p.filterBackend.applyFilters(r,this._originalElement,n,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(r){p.util.setImageSmoothing(r,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(r),this._renderPaintInOrder(r)},drawCacheOnCanvas:function(r){p.util.setImageSmoothing(r,this.imageSmoothing),p.Object.prototype.drawCacheOnCanvas.call(this,r)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(r){var i=this._element;if(!i)return;var n=this._filterScalingX,a=this._filterScalingY,s=this.width,o=this.height,c=Math.min,l=Math.max,h=l(this.cropX,0),u=l(this.cropY,0),f=i.naturalWidth||i.width,d=i.naturalHeight||i.height,m=h*n,g=u*a,b=c(s*n,f-m),_=c(o*a,d-g),I=-s/2,M=-o/2,U=c(s,f/n-h),L=c(o,d/n-u);i&&r.drawImage(i,m,g,b,_,I,M,U,L)},_needsResize:function(){var r=this.getTotalObjectScaling();return r.scaleX!==this._lastScaleX||r.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(r,i){this.setElement(p.util.getById(r),i),p.util.addClass(this.getElement(),p.Image.CSS_CANVAS)},_initConfig:function(r){r||(r={}),this.setOptions(r),this._setWidthHeight(r)},_initFilters:function(r,i){r&&r.length?p.util.enlivenObjects(r,function(n){i&&i(n)},"fabric.Image.filters"):i&&i()},_setWidthHeight:function(r){r||(r={});var i=this.getElement();this.width=r.width||i.naturalWidth||i.width||0,this.height=r.height||i.naturalHeight||i.height||0},parsePreserveAspectRatioAttribute:function(){var r=p.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,a=1,s=1,o=0,c=0,l=0,h=0,u,f=this.width,d=this.height,m={width:f,height:d};return r&&(r.alignX!=="none"||r.alignY!=="none")?(r.meetOrSlice==="meet"&&(a=s=p.util.findScaleToFit(this._element,m),u=(f-i*a)/2,r.alignX==="Min"&&(o=-u),r.alignX==="Max"&&(o=u),u=(d-n*s)/2,r.alignY==="Min"&&(c=-u),r.alignY==="Max"&&(c=u)),r.meetOrSlice==="slice"&&(a=s=p.util.findScaleToCover(this._element,m),u=i-f/a,r.alignX==="Mid"&&(l=u/2),r.alignX==="Max"&&(l=u),u=n-d/s,r.alignY==="Mid"&&(h=u/2),r.alignY==="Max"&&(h=u),i=f/a,n=d/s)):(a=f/i,s=d/n),{width:i,height:n,scaleX:a,scaleY:s,offsetLeft:o,offsetTop:c,cropX:l,cropY:h}}}),p.Image.CSS_CANVAS="canvas-img",p.Image.prototype.getSvgSrc=p.Image.prototype.getSrc,p.Image.fromObject=function(r,i){var n=p.util.object.clone(r);p.util.loadImage(n.src,function(a,s){if(s){i&&i(null,!0);return}p.Image.prototype._initFilters.call(n,n.filters,function(o){n.filters=o||[],p.Image.prototype._initFilters.call(n,[n.resizeFilter],function(c){n.resizeFilter=c[0],p.util.enlivenObjects([n.clipPath],function(l){n.clipPath=l[0];var h=new p.Image(a,n);i(h,!1)})})})},null,n.crossOrigin)},p.Image.fromURL=function(r,i,n){p.util.loadImage(r,function(a,s){i&&i(new p.Image(a,n),s)},null,n&&n.crossOrigin)},p.Image.ATTRIBUTE_NAMES=p.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),p.Image.fromElement=function(r,i,n){var a=p.parseAttributes(r,p.Image.ATTRIBUTE_NAMES);p.Image.fromURL(a["xlink:href"],i,t(n?p.util.object.clone(n):{},a))}})((typeof P!="undefined",P));p.util.object.extend(p.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?Math.round((e-1)/90)*90:Math.round(e/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},r=e.onComplete||t,i=e.onChange||t,n=this;return p.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){n.rotate(a),i()},onComplete:function(){n.setCoords(),r()}}),this}});p.util.object.extend(p.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}});(function(){"use strict";function e(r,i){var n="precision "+i+` float;
void main(){}`,a=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(a,n),r.compileShader(a),!!r.getShaderParameter(a,r.COMPILE_STATUS)}p.isWebglSupported=function(r){if(p.isLikelyNode)return!1;r=r||p.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),a=!1;if(n){p.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),a=p.maxTextureSize>=r;for(var s=["highp","mediump","lowp"],o=0;o<3;o++)if(e(n,s[o])){p.webGlPrecision=s[o];break}}return this.isSupported=a,a},p.WebglFilterBackend=t;function t(r){r&&r.tileSize&&(this.tileSize=r.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}t.prototype={tileSize:2048,resources:{},setupGLContext:function(r,i){this.dispose(),this.createWebGLCanvas(r,i),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(r,i)},chooseFastestCopyGLTo2DMethod:function(r,i){var n=typeof window.performance!="undefined",a;try{new ImageData(1,1),a=!0}catch(m){a=!1}var s=typeof ArrayBuffer!="undefined",o=typeof Uint8ClampedArray!="undefined";if(!(n&&a&&s&&o))return;var c=p.util.createCanvasElement(),l=new ArrayBuffer(r*i*4);if(p.forceGLPutImageData){this.imageBuffer=l,this.copyGLTo2D=Aa;return}var h={imageBuffer:l,destinationWidth:r,destinationHeight:i,targetCanvas:c},u,f,d;c.width=r,c.height=i,u=window.performance.now(),Ca.call(h,this.gl,h),f=window.performance.now()-u,u=window.performance.now(),Aa.call(h,this.gl,h),d=window.performance.now()-u,f>d?(this.imageBuffer=l,this.copyGLTo2D=Aa):this.copyGLTo2D=Ca},createWebGLCanvas:function(r,i){var n=p.util.createCanvasElement();n.width=r,n.height=i;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},s=n.getContext("webgl",a);if(s||(s=n.getContext("experimental-webgl",a)),!s)return;s.clearColor(0,0,0,0),this.canvas=n,this.gl=s},applyFilters:function(r,i,n,a,s,o){var c=this.gl,l;o&&(l=this.getCachedTexture(o,i));var h={originalWidth:i.width||i.originalWidth,originalHeight:i.height||i.originalHeight,sourceWidth:n,sourceHeight:a,destinationWidth:n,destinationHeight:a,context:c,sourceTexture:this.createTexture(c,n,a,!l&&i),targetTexture:this.createTexture(c,n,a),originalTexture:l||this.createTexture(c,n,a,!l&&i),passes:r.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},u=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,u),r.forEach(function(f){f&&f.applyTo(h)}),Cp(h),this.copyGLTo2D(c,h),c.bindTexture(c.TEXTURE_2D,null),c.deleteTexture(h.sourceTexture),c.deleteTexture(h.targetTexture),c.deleteFramebuffer(u),s.getContext("2d").setTransform(1,0,0,1,0,0),h},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(r,i,n,a){var s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),a?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i,n,0,r.RGBA,r.UNSIGNED_BYTE,null),s},getCachedTexture:function(r,i){if(this.textureCache[r])return this.textureCache[r];var n=this.createTexture(this.gl,i.width,i.height,i);return this.textureCache[r]=n,n},evictCachesForKey:function(r){this.textureCache[r]&&(this.gl.deleteTexture(this.textureCache[r]),delete this.textureCache[r])},copyGLTo2D:Ca,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var r=this.gl,i={renderer:"",vendor:""};if(!r)return i;var n=r.getExtension("WEBGL_debug_renderer_info");if(n){var a=r.getParameter(n.UNMASKED_RENDERER_WEBGL),s=r.getParameter(n.UNMASKED_VENDOR_WEBGL);a&&(i.renderer=a.toLowerCase()),s&&(i.vendor=s.toLowerCase())}return this.gpuInfo=i,i}}})();function Cp(e){var t=e.targetCanvas,r=t.width,i=t.height,n=e.destinationWidth,a=e.destinationHeight;(r!==n||i!==a)&&(t.width=n,t.height=a)}function Ca(e,t){var r=e.canvas,i=t.targetCanvas,n=i.getContext("2d");n.translate(0,i.height),n.scale(1,-1);var a=r.height-i.height;n.drawImage(r,0,a,i.width,i.height,0,0,i.width,i.height)}function Aa(e,t){var r=t.targetCanvas,i=r.getContext("2d"),n=t.destinationWidth,a=t.destinationHeight,s=n*a*4,o=new Uint8Array(this.imageBuffer,0,s),c=new Uint8ClampedArray(this.imageBuffer,0,s);e.readPixels(0,0,n,a,e.RGBA,e.UNSIGNED_BYTE,o);var l=new ImageData(c,n,a);i.putImageData(l,0,0)}(function(){"use strict";var e=function(){};p.Canvas2dFilterBackend=t;function t(){}t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(r,i,n,a,s){var o=s.getContext("2d");o.drawImage(i,0,0,n,a);var c=o.getImageData(0,0,n,a),l=o.getImageData(0,0,n,a),h={sourceWidth:n,sourceHeight:a,imageData:c,originalEl:i,originalImageData:l,canvasEl:s,ctx:o,filterBackend:this};return r.forEach(function(u){u.applyTo(h)}),(h.imageData.width!==n||h.imageData.height!==a)&&(s.width=h.imageData.width,s.height=h.imageData.height),o.putImageData(h.imageData,0,0),h}}})();p.Image=p.Image||{};p.Image.filters=p.Image.filters||{};p.Image.filters.BaseFilter=p.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,r){t=t||this.fragmentSource,r=r||this.vertexSource,p.webGlPrecision!=="highp"&&(t=t.replace(/precision highp float/g,"precision "+p.webGlPrecision+" float"));var i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(i));var n=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var a=e.createProgram();if(e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(a));var s=this.getAttributeLocations(e,a),o=this.getUniformLocations(e,a)||{};return o.uStepW=e.getUniformLocation(a,"uStepW"),o.uStepH=e.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:s,uniformLocations:o}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,r){var i=t.aPosition,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t=e.context,r,i;e.passes>1?(r=e.destinationWidth,i=e.destinationHeight,(e.sourceWidth!==r||e.sourceHeight!==i)&&(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,r,i)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=p.Image.filters[this.type].prototype;if(e)if(Array.isArray(t[e])){for(var r=t[e].length;r--;)if(this[e][r]!==t[e][r])return!1;return!0}else return t[e]===this[e];else return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,r=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(r.program),this.sendAttributeData(t,r.attributeLocations,e.aPosition),t.uniform1f(r.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(r.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,r.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,r){e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}});p.Image.filters.BaseFilter.fromObject=function(e,t){var r=new p.Image.filters[e.type](e);return t&&t(r),r};(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.ColorMatrix=i(r.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var a=n.imageData,s=a.data,o=s.length,c=this.matrix,l,h,u,f,d,m=this.colorsOnly;for(d=0;d<o;d+=4)l=s[d],h=s[d+1],u=s[d+2],m?(s[d]=l*c[0]+h*c[1]+u*c[2]+c[4]*255,s[d+1]=l*c[5]+h*c[6]+u*c[7]+c[9]*255,s[d+2]=l*c[10]+h*c[11]+u*c[12]+c[14]*255):(f=s[d+3],s[d]=l*c[0]+h*c[1]+u*c[2]+f*c[3]+c[4]*255,s[d+1]=l*c[5]+h*c[6]+u*c[7]+f*c[8]+c[9]*255,s[d+2]=l*c[10]+h*c[11]+u*c[12]+f*c[13]+c[14]*255,s[d+3]=l*c[15]+h*c[16]+u*c[17]+f*c[18]+c[19]*255)},getUniformLocations:function(n,a){return{uColorMatrix:n.getUniformLocation(a,"uColorMatrix"),uConstants:n.getUniformLocation(a,"uConstants")}},sendUniformData:function(n,a){var s=this.matrix,o=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],c=[s[4],s[9],s[14],s[19]];n.uniformMatrix4fv(a.uColorMatrix,!1,o),n.uniform4fv(a.uConstants,c)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Brightness=i(r.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(this.brightness===0)return;var a=n.imageData,s=a.data,o,c=s.length,l=Math.round(this.brightness*255);for(o=0;o<c;o+=4)s[o]=s[o]+l,s[o+1]=s[o+1]+l,s[o+2]=s[o+2]+l},getUniformLocations:function(n,a){return{uBrightness:n.getUniformLocation(a,"uBrightness")}},sendUniformData:function(n,a){n.uniform1f(a.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.Convolute=n(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var s=Math.sqrt(this.matrix.length),o=this.type+"_"+s+"_"+(this.opaque?1:0),c=this.fragmentSource[o];return a.programCache.hasOwnProperty(o)||(a.programCache[o]=this.createProgram(a.context,c)),a.programCache[o]},applyTo2d:function(a){var s=a.imageData,o=s.data,c=this.matrix,l=Math.round(Math.sqrt(c.length)),h=Math.floor(l/2),u=s.width,f=s.height,d=a.ctx.createImageData(u,f),m=d.data,g=this.opaque?1:0,b,_,I,M,U,L,Y,V,F,O,R,x,v;for(R=0;R<f;R++)for(O=0;O<u;O++){for(U=(R*u+O)*4,b=0,_=0,I=0,M=0,v=0;v<l;v++)for(x=0;x<l;x++){if(Y=R+v-h,L=O+x-h,Y<0||Y>=f||L<0||L>=u)continue;V=(Y*u+L)*4,F=c[v*l+x],b+=o[V]*F,_+=o[V+1]*F,I+=o[V+2]*F,g||(M+=o[V+3]*F)}m[U]=b,m[U+1]=_,m[U+2]=I,g?m[U+3]=o[U+3]:m[U+3]=M}a.imageData=d},getUniformLocations:function(a,s){return{uMatrix:a.getUniformLocation(s,"uMatrix"),uOpaque:a.getUniformLocation(s,"uOpaque"),uHalfSize:a.getUniformLocation(s,"uHalfSize"),uSize:a.getUniformLocation(s,"uSize")}},sendUniformData:function(a,s){a.uniform1fv(s.uMatrix,this.matrix)},toObject:function(){return r(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Grayscale=i(r.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(n){var a=n.imageData,s=a.data,o,c=s.length,l,h=this.mode;for(o=0;o<c;o+=4)h==="average"?l=(s[o]+s[o+1]+s[o+2])/3:h==="lightness"?l=(Math.min(s[o],s[o+1],s[o+2])+Math.max(s[o],s[o+1],s[o+2]))/2:h==="luminosity"&&(l=.21*s[o]+.72*s[o+1]+.07*s[o+2]),s[o]=l,s[o+1]=l,s[o+2]=l},retrieveShader:function(n){var a=this.type+"_"+this.mode;if(!n.programCache.hasOwnProperty(a)){var s=this.fragmentSource[this.mode];n.programCache[a]=this.createProgram(n.context,s)}return n.programCache[a]},getUniformLocations:function(n,a){return{uMode:n.getUniformLocation(a,"uMode")}},sendUniformData:function(n,a){var s=1;n.uniform1i(a.uMode,s)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Invert=i(r.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(n){var a=n.imageData,s=a.data,o,c=s.length;for(o=0;o<c;o+=4)s[o]=255-s[o],s[o+1]=255-s[o+1],s[o+2]=255-s[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,a){return{uInvert:n.getUniformLocation(a,"uInvert")}},sendUniformData:function(n,a){n.uniform1i(a.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.Noise=n(i.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise===0)return;var s=a.imageData,o=s.data,c,l=o.length,h=this.noise,u;for(c=0,l=o.length;c<l;c+=4)u=(.5-Math.random())*h,o[c]+=u,o[c+1]+=u,o[c+2]+=u},getUniformLocations:function(a,s){return{uNoise:a.getUniformLocation(s,"uNoise"),uSeed:a.getUniformLocation(s,"uSeed")}},sendUniformData:function(a,s){a.uniform1f(s.uNoise,this.noise/255),a.uniform1f(s.uSeed,Math.random())},toObject:function(){return r(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Pixelate=i(r.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(n){var a=n.imageData,s=a.data,o=a.height,c=a.width,l,h,u,f,d,m,g,b,_,I,M;for(h=0;h<o;h+=this.blocksize)for(u=0;u<c;u+=this.blocksize)for(l=h*4*c+u*4,f=s[l],d=s[l+1],m=s[l+2],g=s[l+3],I=Math.min(h+this.blocksize,o),M=Math.min(u+this.blocksize,c),b=h;b<I;b++)for(_=u;_<M;_++)l=b*4*c+_*4,s[l]=f,s[l+1]=d,s[l+2]=m,s[l+3]=g},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(n,a){return{uBlocksize:n.getUniformLocation(a,"uBlocksize"),uStepW:n.getUniformLocation(a,"uStepW"),uStepH:n.getUniformLocation(a,"uStepH")}},sendUniformData:function(n,a){n.uniform1f(a.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.extend,i=t.Image.filters,n=t.util.createClass;i.RemoveColor=n(i.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var s=a.imageData,o=s.data,c,l=this.distance*255,h,u,f,d=new t.Color(this.color).getSource(),m=[d[0]-l,d[1]-l,d[2]-l],g=[d[0]+l,d[1]+l,d[2]+l];for(c=0;c<o.length;c+=4)h=o[c],u=o[c+1],f=o[c+2],h>m[0]&&u>m[1]&&f>m[2]&&h<g[0]&&u<g[1]&&f<g[2]&&(o[c+3]=0)},getUniformLocations:function(a,s){return{uLow:a.getUniformLocation(s,"uLow"),uHigh:a.getUniformLocation(s,"uHigh")}},sendUniformData:function(a,s){var o=new t.Color(this.color).getSource(),c=parseFloat(this.distance),l=[0+o[0]/255-c,0+o[1]/255-c,0+o[2]/255-c,1],h=[o[0]/255+c,o[1]/255+c,o[2]/255+c,1];a.uniform4fv(s.uLow,l),a.uniform4fv(s.uHigh,h)},toObject:function(){return r(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in n)r[a]=i(r.ColorMatrix,{type:a,matrix:n[a],mainParameter:!1,colorsOnly:!0}),t.Image.filters[a].fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendColor=i(r.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(n){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[n]+`}
}`},retrieveShader:function(n){var a=this.type+"_"+this.mode,s;return n.programCache.hasOwnProperty(a)||(s=this.buildSource(this.mode),n.programCache[a]=this.createProgram(n.context,s)),n.programCache[a]},applyTo2d:function(n){var a=n.imageData,s=a.data,o=s.length,c,l,h,u,f,d,m,g=1-this.alpha;m=new t.Color(this.color).getSource(),c=m[0]*this.alpha,l=m[1]*this.alpha,h=m[2]*this.alpha;for(var b=0;b<o;b+=4){u=s[b],f=s[b+1],d=s[b+2];switch(this.mode){case"multiply":s[b]=u*c/255,s[b+1]=f*l/255,s[b+2]=d*h/255;break;case"screen":s[b]=255-(255-u)*(255-c)/255,s[b+1]=255-(255-f)*(255-l)/255,s[b+2]=255-(255-d)*(255-h)/255;break;case"add":s[b]=u+c,s[b+1]=f+l,s[b+2]=d+h;break;case"diff":case"difference":s[b]=Math.abs(u-c),s[b+1]=Math.abs(f-l),s[b+2]=Math.abs(d-h);break;case"subtract":s[b]=u-c,s[b+1]=f-l,s[b+2]=d-h;break;case"darken":s[b]=Math.min(u,c),s[b+1]=Math.min(f,l),s[b+2]=Math.min(d,h);break;case"lighten":s[b]=Math.max(u,c),s[b+1]=Math.max(f,l),s[b+2]=Math.max(d,h);break;case"overlay":s[b]=c<128?2*u*c/255:255-2*(255-u)*(255-c)/255,s[b+1]=l<128?2*f*l/255:255-2*(255-f)*(255-l)/255,s[b+2]=h<128?2*d*h/255:255-2*(255-d)*(255-h)/255;break;case"exclusion":s[b]=c+u-2*c*u/255,s[b+1]=l+f-2*l*f/255,s[b+2]=h+d-2*h*d/255;break;case"tint":s[b]=c+u*g,s[b+1]=l+f*g,s[b+2]=h+d*g}}},getUniformLocations:function(n,a){return{uColor:n.getUniformLocation(a,"uColor")}},sendUniformData:function(n,a){var s=new t.Color(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,n.uniform4fv(a.uColor,s)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric,r=t.Image.filters,i=t.util.createClass;r.BlendImage=i(r.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(n){var a=this.type+"_"+this.mode,s=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(a)||(n.programCache[a]=this.createProgram(n.context,s)),n.programCache[a]},applyToWebGL:function(n){var a=n.context,s=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(a,s,a.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(n,a){return n.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var n=this.image,a=n._element.width,s=n._element.height;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/a,-n.top/s,1]},applyTo2d:function(n){var a=n.imageData,s=n.filterBackend.resources,o=a.data,c=o.length,l=a.width,h=a.height,u,f,d,m,g,b,_,I,M,U,L=this.image,Y;s.blendImage||(s.blendImage=t.util.createCanvasElement()),M=s.blendImage,U=M.getContext("2d"),M.width!==l||M.height!==h?(M.width=l,M.height=h):U.clearRect(0,0,l,h),U.setTransform(L.scaleX,0,0,L.scaleY,L.left,L.top),U.drawImage(L._element,0,0,l,h),Y=U.getImageData(0,0,l,h).data;for(var V=0;V<c;V+=4){g=o[V],b=o[V+1],_=o[V+2],I=o[V+3],u=Y[V],f=Y[V+1],d=Y[V+2],m=Y[V+3];switch(this.mode){case"multiply":o[V]=g*u/255,o[V+1]=b*f/255,o[V+2]=_*d/255,o[V+3]=I*m/255;break;case"mask":o[V+3]=m;break}}},getUniformLocations:function(n,a){return{uTransformMatrix:n.getUniformLocation(a,"uTransformMatrix"),uImage:n.getUniformLocation(a,"uImage")}},sendUniformData:function(n,a){var s=this.calculateMatrix();n.uniform1i(a.uImage,1),n.uniformMatrix3fv(a.uTransformMatrix,!1,s)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(n,a){t.Image.fromObject(n.image,function(s){var o=t.util.object.clone(n);o.image=s,a(new t.Image.filters.BlendImage(o))})}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=Math.pow,i=Math.floor,n=Math.sqrt,a=Math.abs,s=Math.round,o=Math.sin,c=Math.ceil,l=t.Image.filters,h=t.util.createClass;l.Resize=h(l.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(u,f){return{uDelta:u.getUniformLocation(f,"uDelta"),uTaps:u.getUniformLocation(f,"uTaps")}},sendUniformData:function(u,f){u.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),u.uniform1fv(f.uTaps,this.taps)},retrieveShader:function(u){var f=this.getFilterWindow(),d=this.type+"_"+f;if(!u.programCache.hasOwnProperty(d)){var m=this.generateShader(f);u.programCache[d]=this.createProgram(u.context,m)}return u.programCache[d]},getFilterWindow:function(){var u=this.tempScale;return Math.ceil(this.lanczosLobes/u)},getTaps:function(){for(var u=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,d=this.getFilterWindow(),m=new Array(d),g=1;g<=d;g++)m[g-1]=u(g*f);return m},generateShader:function(u){for(var f=new Array(u),d=this.fragmentSourceTOP,u,m=1;m<=u;m++)f[m-1]=m+".0 * uDelta";return d+="uniform float uTaps["+u+`];
`,d+=`void main() {
`,d+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,d+=`  float sum = 1.0;
`,f.forEach(function(g,b){d+="  color += texture2D(uTexture, vTexCoord + "+g+") * uTaps["+b+`];
`,d+="  color += texture2D(uTexture, vTexCoord - "+g+") * uTaps["+b+`];
`,d+="  sum += 2.0 * uTaps["+b+`];
`}),d+=`  gl_FragColor = color / sum;
`,d+="}",d},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(u){u.webgl?(u.passes++,this.width=u.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=u.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),u.destinationWidth=this.dW,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceWidth=u.destinationWidth,this.height=u.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),u.destinationHeight=this.dH,this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u),u.sourceHeight=u.destinationHeight):this.applyTo2d(u)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(u){return function(f){if(f>=u||f<=-u)return 0;if(f<11920929e-14&&f>-11920929e-14)return 1;f*=Math.PI;var d=f/u;return o(f)/f*o(d)/d}},applyTo2d:function(u){var f=u.imageData,d=this.scaleX,m=this.scaleY;this.rcpScaleX=1/d,this.rcpScaleY=1/m;var g=f.width,b=f.height,_=s(g*d),I=s(b*m),M;this.resizeType==="sliceHack"?M=this.sliceByTwo(u,g,b,_,I):this.resizeType==="hermite"?M=this.hermiteFastResize(u,g,b,_,I):this.resizeType==="bilinear"?M=this.bilinearFiltering(u,g,b,_,I):this.resizeType==="lanczos"&&(M=this.lanczosResize(u,g,b,_,I)),u.imageData=M},sliceByTwo:function(u,f,d,m,g){var b=u.imageData,_=.5,I=!1,M=!1,U=f*_,L=d*_,Y=t.filterBackend.resources,V,F,O=0,R=0,x=f,v=0;for(Y.sliceByTwo||(Y.sliceByTwo=document.createElement("canvas")),V=Y.sliceByTwo,(V.width<f*1.5||V.height<d)&&(V.width=f*1.5,V.height=d),F=V.getContext("2d"),F.clearRect(0,0,f*1.5,d),F.putImageData(b,0,0),m=i(m),g=i(g);!I||!M;)f=U,d=L,m<i(U*_)?U=i(U*_):(U=m,I=!0),g<i(L*_)?L=i(L*_):(L=g,M=!0),F.drawImage(V,O,R,f,d,x,v,U,L),O=x,R=v,v+=L;return F.getImageData(O,R,m,g)},lanczosResize:function(u,f,d,m,g){function b(A){var S,Z,w,T,D,j,W,G,z,X,k;for(v.x=(A+.5)*L,E.x=i(v.x),S=0;S<g;S++){for(v.y=(S+.5)*Y,E.y=i(v.y),D=0,j=0,W=0,G=0,z=0,Z=E.x-O;Z<=E.x+O;Z++){if(Z<0||Z>=f)continue;X=i(1e3*a(Z-v.x)),x[X]||(x[X]={});for(var C=E.y-R;C<=E.y+R;C++){if(C<0||C>=d)continue;k=i(1e3*a(C-v.y)),x[X][k]||(x[X][k]=U(n(r(X*V,2)+r(k*F,2))/1e3)),w=x[X][k],w>0&&(T=(C*f+Z)*4,D+=w,j+=w*_[T],W+=w*_[T+1],G+=w*_[T+2],z+=w*_[T+3])}}T=(S*m+A)*4,M[T]=j/D,M[T+1]=W/D,M[T+2]=G/D,M[T+3]=z/D}return++A<m?b(A):I}var _=u.imageData.data,I=u.ctx.createImageData(m,g),M=I.data,U=this.lanczosCreate(this.lanczosLobes),L=this.rcpScaleX,Y=this.rcpScaleY,V=2/this.rcpScaleX,F=2/this.rcpScaleY,O=c(L*this.lanczosLobes/2),R=c(Y*this.lanczosLobes/2),x={},v={},E={};return b(0)},bilinearFiltering:function(u,f,d,m,g){var b,_,I,M,U,L,Y,V,F,O,R,x,v=0,E,A=this.rcpScaleX,S=this.rcpScaleY,Z=4*(f-1),w=u.imageData,T=w.data,D=u.ctx.createImageData(m,g),j=D.data;for(Y=0;Y<g;Y++)for(V=0;V<m;V++)for(U=i(A*V),L=i(S*Y),F=A*V-U,O=S*Y-L,E=4*(L*f+U),R=0;R<4;R++)b=T[E+R],_=T[E+4+R],I=T[E+Z+R],M=T[E+Z+4+R],x=b*(1-F)*(1-O)+_*F*(1-O)+I*O*(1-F)+M*F*O,j[v++]=x;return D},hermiteFastResize:function(u,f,d,m,g){for(var b=this.rcpScaleX,_=this.rcpScaleY,I=c(b/2),M=c(_/2),U=u.imageData,L=U.data,Y=u.ctx.createImageData(m,g),V=Y.data,F=0;F<g;F++)for(var O=0;O<m;O++){for(var R=(O+F*m)*4,x=0,v=0,E=0,A=0,S=0,Z=0,w=0,T=(F+.5)*_,D=i(F*_);D<(F+1)*_;D++)for(var j=a(T-(D+.5))/M,W=(O+.5)*b,G=j*j,z=i(O*b);z<(O+1)*b;z++){var X=a(W-(z+.5))/I,k=n(G+X*X);if(k>1&&k<-1)continue;x=2*k*k*k-3*k*k+1,x>0&&(X=4*(z+D*f),w+=x*L[X+3],E+=x,L[X+3]<255&&(x=x*L[X+3]/250),A+=x*L[X],S+=x*L[X+1],Z+=x*L[X+2],v+=x)}V[R]=A/v,V[R+1]=S/v,V[R+2]=Z/v,V[R+3]=w/E}return Y},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Contrast=i(r.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(this.contrast===0)return;var a=n.imageData,s,o,c=a.data,o=c.length,l=Math.floor(this.contrast*255),h=259*(l+255)/(255*(259-l));for(s=0;s<o;s+=4)c[s]=h*(c[s]-128)+128,c[s+1]=h*(c[s+1]-128)+128,c[s+2]=h*(c[s+2]-128)+128},getUniformLocations:function(n,a){return{uContrast:n.getUniformLocation(a,"uContrast")}},sendUniformData:function(n,a){n.uniform1f(a.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Saturation=i(r.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(this.saturation===0)return;var a=n.imageData,s=a.data,o=s.length,c=-this.saturation,l,h;for(l=0;l<o;l+=4)h=Math.max(s[l],s[l+1],s[l+2]),s[l]+=h!==s[l]?(h-s[l])*c:0,s[l+1]+=h!==s[l+1]?(h-s[l+1])*c:0,s[l+2]+=h!==s[l+2]?(h-s[l+2])*c:0},getUniformLocations:function(n,a){return{uSaturation:n.getUniformLocation(a,"uSaturation")}},sendUniformData:function(n,a){n.uniform1f(a.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Blur=i(r.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var a=n.filterBackend.resources,s,o,c=n.imageData.width,l=n.imageData.height;a.blurLayer1||(a.blurLayer1=t.util.createCanvasElement(),a.blurLayer2=t.util.createCanvasElement()),s=a.blurLayer1,o=a.blurLayer2,(s.width!==c||s.height!==l)&&(o.width=s.width=c,o.height=s.height=l);var h=s.getContext("2d"),u=o.getContext("2d"),f=15,d,m,g,b,_=this.blur*.06*.5;for(h.putImageData(n.imageData,0,0),u.clearRect(0,0,c,l),b=-f;b<=f;b++)d=(Math.random()-.5)/4,m=b/f,g=_*m*c+d,u.globalAlpha=1-Math.abs(m),u.drawImage(s,g,d),h.drawImage(o,0,0),u.globalAlpha=1,u.clearRect(0,0,o.width,o.height);for(b=-f;b<=f;b++)d=(Math.random()-.5)/4,m=b/f,g=_*m*l+d,u.globalAlpha=1-Math.abs(m),u.drawImage(s,d,g),h.drawImage(o,0,0),u.globalAlpha=1,u.clearRect(0,0,o.width,o.height);n.ctx.drawImage(s,0,0);var I=n.ctx.getImageData(0,0,s.width,s.height);return h.globalAlpha=1,h.clearRect(0,0,s.width,s.height),I},getUniformLocations:function(n,a){return{delta:n.getUniformLocation(a,"uDelta")}},sendUniformData:function(n,a){var s=this.chooseRightDelta();n.uniform2fv(a.delta,s)},chooseRightDelta:function(){var n=1,a=[0,0],s;return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),s=n*this.blur*.12,this.horizontal?a[0]=s:a[1]=s,a}}),r.Blur.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Gamma=i(r.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],r.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var a=n.imageData,s=a.data,o=this.gamma,c=s.length,l=1/o[0],h=1/o[1],u=1/o[2],f;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),f=0,c=256;f<c;f++)this.rVals[f]=Math.pow(f/255,l)*255,this.gVals[f]=Math.pow(f/255,h)*255,this.bVals[f]=Math.pow(f/255,u)*255;for(f=0,c=s.length;f<c;f+=4)s[f]=this.rVals[s[f]],s[f+1]=this.gVals[s[f+1]],s[f+2]=this.bVals[s[f+2]]},getUniformLocations:function(n,a){return{uGamma:n.getUniformLocation(a,"uGamma")}},sendUniformData:function(n,a){n.uniform3fv(a.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.Composed=i(r.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(n)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(n,a){var s=n.subFilters||[],o=s.map(function(l){return new t.Image.filters[l.type](l)}),c=new t.Image.filters.Composed({subFilters:o});return a&&a(c),c}})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.Image.filters,i=t.util.createClass;r.HueRotation=i(r.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,a=t.util.cos(n),s=t.util.sin(n),o=1/3,c=Math.sqrt(o)*s,l=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+l/3,this.matrix[1]=o*l-c,this.matrix[2]=o*l+c,this.matrix[5]=o*l+c,this.matrix[6]=a+o*l,this.matrix[7]=o*l-c,this.matrix[10]=o*l-c,this.matrix[11]=o*l+c,this.matrix[12]=a+o*l},isNeutralState:function(n){return this.calculateMatrix(),r.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),r.BaseFilter.prototype.applyTo.call(this,n)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject})((typeof P!="undefined",P));(function(e){"use strict";var t=e.fabric||(e.fabric={}),r=t.util.object.clone;if(t.Text){t.warn("fabric.Text is already defined");return}t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,n){this.styles=n?n.styles||{}:{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",n),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){if(this.__skipDimension)return;this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},enlargeSpaces:function(){for(var i,n,a,s,o,c,l,h=0,u=this._textLines.length;h<u;h++){if(this.textAlign!=="justify"&&(h===u-1||this.isEndOfWrapping(h)))continue;if(s=0,o=this._textLines[h],n=this.getLineWidth(h),n<this.width&&(l=this.textLines[h].match(this._reSpacesAndTabs))){a=l.length,i=(this.width-n)/a;for(var f=0,d=o.length;f<=d;f++)c=this.__charBounds[h][f],this._reSpaceAndTab.test(o[f])?(c.width+=i,c.kernedWidth+=i,c.left+=s,s+=i):c.left+=s}}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return i.width+=n*i.zoomX,i.height+=n*i.zoomY,i},_render:function(i){this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,n,a){i.textBaseline="alphabetic",i.font=this._getFontDeclaration(n,a)},calcTextWidth:function(){for(var i=this.getLineWidth(0),n=1,a=this._textLines.length;n<a;n++){var s=this.getLineWidth(n);s>i&&(i=s)}return i},_renderTextLine:function(i,n,a,s,o,c){this._renderChars(i,n,a,s,o,c)},_renderTextLinesBackground:function(i){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;for(var n=0,a,s,o=i.fillStyle,c,l,h=this._getLeftOffset(),u=this._getTopOffset(),f=0,d=0,m,g,b=0,_=this._textLines.length;b<_;b++){if(a=this.getHeightOfLine(b),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",b)){n+=a;continue}c=this._textLines[b],s=this._getLineLeftOffset(b),d=0,f=0,l=this.getValueOfPropertyAt(b,0,"textBackgroundColor");for(var I=0,M=c.length;I<M;I++)m=this.__charBounds[b][I],g=this.getValueOfPropertyAt(b,I,"textBackgroundColor"),g!==l?(i.fillStyle=l,l&&i.fillRect(h+s+f,u+n,d,a/this.lineHeight),f=m.left,d=m.width,l=g):d+=m.kernedWidth;g&&(i.fillStyle=g,i.fillRect(h+s+f,u+n,d,a/this.lineHeight)),n+=a}i.fillStyle=o,this._removeShadow(i)},getFontCache:function(i){var n=i.fontFamily.toLowerCase();t.charWidthsCache[n]||(t.charWidthsCache[n]={});var a=t.charWidthsCache[n],s=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return a[s]||(a[s]={}),a[s]},_applyCharStyles:function(i,n,a,s,o){this._setFillStyles(n,o),this._setStrokeStyles(n,o),n.font=this._getFontDeclaration(o)},_measureChar:function(i,n,a,s){var o=this.getFontCache(n),c=this._getFontDeclaration(n),l=this._getFontDeclaration(s),h=a+i,u=c===l,f,d,m,g=n.fontSize/this.CACHE_FONT_SIZE,b;if(a&&o[a]!==void 0&&(m=o[a]),o[i]!==void 0&&(b=f=o[i]),u&&o[h]!==void 0&&(d=o[h],b=d-m),f===void 0||m===void 0||d===void 0){var _=this.getMeasuringContext();this._setTextStyles(_,n,!0)}return f===void 0&&(b=f=_.measureText(i).width,o[i]=f),m===void 0&&u&&a&&(m=_.measureText(a).width,o[a]=m),u&&d===void 0&&(d=_.measureText(h).width,o[h]=d,b=d-m),{width:f*g,kernedWidth:b*g}},getHeightOfChar:function(i,n){return this.getValueOfPropertyAt(i,n,"fontSize")},measureLine:function(i){var n=this._measureLine(i);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(i){var n=0,a,s,o=this._textLines[i],c,l,h=0,u=new Array(o.length);for(this.__charBounds[i]=u,a=0;a<o.length;a++)s=o[a],l=this._getGraphemeBox(s,i,a,c),u[a]=l,n+=l.kernedWidth,c=s;return u[a]={left:l?l.left+l.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:n,numOfSpaces:h}},_getGraphemeBox:function(i,n,a,s,o){var c=this.getCompleteStyleDeclaration(n,a),l=s?this.getCompleteStyleDeclaration(n,a-1):{},h=this._measureChar(i,c,s,l),u=h.kernedWidth,f=h.width,d;this.charSpacing!==0&&(d=this._getWidthOfCharSpacing(),f+=d,u+=d);var m={width:f,left:0,height:c.fontSize,kernedWidth:u,deltaY:c.deltaY};if(a>0&&!o){var g=this.__charBounds[n][a-1];m.left=g.left+g.width+h.kernedWidth-h.width}return m},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var n=this._textLines[i],a=this.getHeightOfChar(i,0),s=1,o=n.length;s<o;s++)a=Math.max(this.getHeightOfChar(i,s),a);return this.__lineHeights[i]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,n=0,a=0,s=this._textLines.length;a<s;a++)i=this.getHeightOfLine(a),n+=a===s-1?i/this.lineHeight:i;return n},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,n){i.save();for(var a=0,s=this._getLeftOffset(),o=this._getTopOffset(),c=this._applyPatternGradientTransform(i,n==="fillText"?this.fill:this.stroke),l=0,h=this._textLines.length;l<h;l++){var u=this.getHeightOfLine(l),f=u/this.lineHeight,d=this._getLineLeftOffset(l);this._renderTextLine(n,i,this._textLines[l],s+d-c.offsetX,o+a+f-c.offsetY,l),a+=u}i.restore()},_renderTextFill:function(i){if(!this.fill&&!this.styleHas("fill"))return;this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles())return;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore()},_renderChars:function(i,n,a,s,o,c){var l=this.getHeightOfLine(c),h=this.textAlign.indexOf("justify")!==-1,u,f,d="",m,g=0,b,_=!h&&this.charSpacing===0&&this.isEmptyStyles(c);if(n.save(),o-=l*this._fontSizeFraction/this.lineHeight,_){this._renderChar(i,n,c,0,a.join(""),s,o,l),n.restore();return}for(var I=0,M=a.length-1;I<=M;I++)b=I===M||this.charSpacing,d+=a[I],m=this.__charBounds[c][I],g===0?(s+=m.kernedWidth-m.width,g+=m.width):g+=m.kernedWidth,h&&!b&&(this._reSpaceAndTab.test(a[I])&&(b=!0)),b||(u=u||this.getCompleteStyleDeclaration(c,I),f=this.getCompleteStyleDeclaration(c,I+1),b=this._hasStyleChanged(u,f)),b&&(this._renderChar(i,n,c,I,d,s,o,l),d="",u=f,s+=g,g=0);n.restore()},_renderChar:function(i,n,a,s,o,c,l){var h=this._getStyleDeclaration(a,s),u=this.getCompleteStyleDeclaration(a,s),f=i==="fillText"&&u.fill,d=i==="strokeText"&&u.stroke&&u.strokeWidth;if(!d&&!f)return;h&&n.save(),this._applyCharStyles(i,n,a,s,u),h&&h.textBackgroundColor&&this._removeShadow(n),h&&h.deltaY&&(l+=h.deltaY),f&&n.fillText(o,c,l),d&&n.strokeText(o,c,l),h&&n.restore()},setSuperscript:function(i,n){return this._setScript(i,n,this.superscript)},setSubscript:function(i,n){return this._setScript(i,n,this.subscript)},_setScript:function(i,n,a){var s=this.get2DCursorLocation(i,!0),o=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),c=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),l={fontSize:o*a.size,deltaY:c+o*a.baseline};return this.setSelectionStyles(l,i,n),this},_hasStyleChanged:function(i,n){return i.fill!==n.fill||i.stroke!==n.stroke||i.strokeWidth!==n.strokeWidth||i.fontSize!==n.fontSize||i.fontFamily!==n.fontFamily||i.fontWeight!==n.fontWeight||i.fontStyle!==n.fontStyle||i.deltaY!==n.deltaY},_hasStyleChangedForSvg:function(i,n){return this._hasStyleChanged(i,n)||i.overline!==n.overline||i.underline!==n.underline||i.linethrough!==n.linethrough},_getLineLeftOffset:function(i){var n=this.getLineWidth(i);return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:this.textAlign==="justify-center"&&this.isEndOfWrapping(i)?(this.width-n)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(i)?this.width-n:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i])return this.__lineWidths[i];var n,a=this._textLines[i],s;return a===""?n=0:(s=this.measureLine(i),n=s.width),this.__lineWidths[i]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,n,a){var s=this._getStyleDeclaration(i,n);return s&&typeof s[a]!="undefined"?s[a]:this[a]},_renderTextDecoration:function(i,n){if(!this[n]&&!this.styleHas(n))return;for(var a,s,o,c,l,h,u,f,d=this._getLeftOffset(),m=this._getTopOffset(),g,b,_,I,M,U,L,Y,V=this._getWidthOfCharSpacing(),F=0,O=this._textLines.length;F<O;F++){if(a=this.getHeightOfLine(F),!this[n]&&!this.styleHas(n,F)){m+=a;continue}u=this._textLines[F],U=a/this.lineHeight,c=this._getLineLeftOffset(F),b=0,_=0,f=this.getValueOfPropertyAt(F,0,n),Y=this.getValueOfPropertyAt(F,0,"fill"),g=m+U*(1-this._fontSizeFraction),s=this.getHeightOfChar(F,0),l=this.getValueOfPropertyAt(F,0,"deltaY");for(var R=0,x=u.length;R<x;R++)I=this.__charBounds[F][R],M=this.getValueOfPropertyAt(F,R,n),L=this.getValueOfPropertyAt(F,R,"fill"),o=this.getHeightOfChar(F,R),h=this.getValueOfPropertyAt(F,R,"deltaY"),(M!==f||L!==Y||o!==s||h!==l)&&_>0?(i.fillStyle=Y,f&&Y&&i.fillRect(d+c+b,g+this.offsets[n]*s+l,_,this.fontSize/15),b=I.left,_=I.width,f=M,Y=L,s=o,l=h):_+=I.kernedWidth;i.fillStyle=L,M&&L&&i.fillRect(d+c+b,g+this.offsets[n]*s+l,_-V,this.fontSize/15),m+=a}this._removeShadow(i)},_getFontDeclaration:function(i,n){var a=i||this,s=this.fontFamily,o=t.Text.genericFonts.indexOf(s.toLowerCase())>-1,c=s===void 0||s.indexOf("'")>-1||s.indexOf(",")>-1||s.indexOf('"')>-1||o?a.fontFamily:'"'+a.fontFamily+'"';return[t.isLikelyNode?a.fontWeight:a.fontStyle,t.isLikelyNode?a.fontStyle:a.fontWeight,n?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",c].join(" ")},render:function(i){if(!this.visible)return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)},_splitTextIntoLines:function(i){for(var n=i.split(this._reNewline),a=new Array(n.length),s=[`
`],o=[],c=0;c<n.length;c++)a[c]=t.util.string.graphemeSplit(n[c]),o=o.concat(a[c],s);return o.pop(),{_unwrappedLines:a,lines:n,graphemeText:o,graphemeLines:a}},toObject:function(i){var n=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(i),a=this.callSuper("toObject",n);return a.styles=r(this.styles,!0),a},set:function(i,n){this.callSuper("set",i,n);var a=!1;if(typeof i=="object")for(var s in i)a=a||this._dimensionAffectingProps.indexOf(s)!==-1;else a=this._dimensionAffectingProps.indexOf(i)!==-1;return a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(i,n,a){if(!i)return n(null);var s=t.parseAttributes(i,t.Text.ATTRIBUTE_NAMES),o=s.textAnchor||"left";if(a=t.util.object.extend(a?r(a):{},s),a.top=a.top||0,a.left=a.left||0,s.textDecoration){var c=s.textDecoration;c.indexOf("underline")!==-1&&(a.underline=!0),c.indexOf("overline")!==-1&&(a.overline=!0),c.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in s&&(a.left+=s.dx),"dy"in s&&(a.top+=s.dy),"fontSize"in a||(a.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in i?l=i.textContent:"firstChild"in i&&i.firstChild!==null&&("data"in i.firstChild&&i.firstChild.data!==null&&(l=i.firstChild.data)),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var h=a.strokeWidth;a.strokeWidth=0;var u=new t.Text(l,a),f=u.getScaledHeight()/u.height,d=(u.height+u.strokeWidth)*u.lineHeight-u.height,m=d*f,g=u.getScaledHeight()+m,b=0;o==="center"&&(b=u.getScaledWidth()/2),o==="right"&&(b=u.getScaledWidth()),u.set({left:u.left-b,top:u.top-(g-u.fontSize*(.07+u._fontSizeFraction))/u.lineHeight,strokeWidth:typeof h!="undefined"?h:1}),n(u)},t.Text.fromObject=function(i,n){return t.Object._fromObject("Text",i,n,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)})((typeof P!="undefined",P));(function(){p.util.object.extend(p.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(typeof e!="undefined"&&!this.styles[e])return!0;var t=typeof e=="undefined"?this.styles:{line:this.styles[e]};for(var r in t)for(var i in t[r])for(var n in t[r][i])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||e==="")return!1;if(typeof t!="undefined"&&!this.styles[t])return!1;var r=typeof t=="undefined"?this.styles:{0:this.styles[t]};for(var i in r)for(var n in r[i])if(typeof r[i][n][e]!="undefined")return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||e==="")return!1;var t=this.styles,r=0,i,n,a=!0,s=0,o;for(var c in t){i=0;for(var l in t[c]){var o=t[c][l],h=o.hasOwnProperty(e);r++,h?(n?o[e]!==n&&(a=!1):n=o[e],o[e]===this[e]&&delete o[e]):a=!1,Object.keys(o).length!==0?i++:delete t[c][l]}i===0&&delete t[c]}for(var u=0;u<this._textLines.length;u++)s+=this._textLines[u].length;a&&r===s&&(this[e]=n,this.removeStyle(e))},removeStyle:function(e){if(!this.styles||!e||e==="")return;var t=this.styles,r,i,n;for(i in t){r=t[i];for(n in r)delete r[n][e],Object.keys(r[n]).length===0&&delete r[n];Object.keys(r).length===0&&delete t[i]}},_extendStyles:function(e,t){var r=this.get2DCursorLocation(e);this._getLineStyle(r.lineIndex)||this._setLineStyle(r.lineIndex),this._getStyleDeclaration(r.lineIndex,r.charIndex)||this._setStyleDeclaration(r.lineIndex,r.charIndex,{}),p.util.object.extend(this._getStyleDeclaration(r.lineIndex,r.charIndex),t)},get2DCursorLocation:function(e,t){typeof e=="undefined"&&(e=this.selectionStart);for(var r=t?this._unwrappedTextLines:this._textLines,i=r.length,n=0;n<i;n++){if(e<=r[n].length)return{lineIndex:n,charIndex:e};e-=r[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:r[n-1].length<e?r[n-1].length:e}},getSelectionStyles:function(e,t,r){typeof e=="undefined"&&(e=this.selectionStart||0),typeof t=="undefined"&&(t=this.selectionEnd||e);for(var i=[],n=e;n<t;n++)i.push(this.getStyleAtPosition(n,r));return i},getStyleAtPosition:function(e,t){var r=this.get2DCursorLocation(e),i=t?this.getCompleteStyleDeclaration(r.lineIndex,r.charIndex):this._getStyleDeclaration(r.lineIndex,r.charIndex);return i||{}},setSelectionStyles:function(e,t,r){typeof t=="undefined"&&(t=this.selectionStart||0),typeof r=="undefined"&&(r=this.selectionEnd||t);for(var i=t;i<r;i++)this._extendStyles(i,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var r=this.styles&&this.styles[e];return r?r[t]:null},getCompleteStyleDeclaration:function(e,t){for(var r=this._getStyleDeclaration(e,t)||{},i={},n,a=0;a<this._styleProperties.length;a++)n=this._styleProperties[a],i[n]=typeof r[n]=="undefined"?this[n]:r[n];return i},_setStyleDeclaration:function(e,t,r){this.styles[e][t]=r},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}})})();(function(){function e(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}p.IText=p.util.createClass(p.Text,p.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,r){this.callSuper("initialize",t,r),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,r){this[t]!==r&&(this._fireSelectionChanged(),this[t]=r),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var r=this.canvas.contextTop,i=this.canvas.viewportTransform;r.save(),r.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(r),this._clearTextArea(r),t||r.restore()},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop)return;var t=this._getCursorBoundaries(),r=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,r):this.renderSelection(t,r),r.restore()},_clearTextArea:function(t){var r=this.width+4,i=this.height+4;t.clearRect(-r/2,-i/2,r,i)},_getCursorBoundaries:function(t){typeof t=="undefined"&&(t=this.selectionStart);var r=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:r,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var r,i,n,a=0,s=0,o,c=this.get2DCursorLocation(t);n=c.charIndex,i=c.lineIndex;for(var l=0;l<i;l++)a+=this.getHeightOfLine(l);r=this._getLineLeftOffset(i);var h=this.__charBounds[i][n];return h&&(s=h.left),this.charSpacing!==0&&n===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing()),o={top:a,left:r+(s>0?s:0)},this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(t,r){var i=this.get2DCursorLocation(),n=i.lineIndex,a=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(n,a,"fontSize"),o=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/o,l=t.topOffset,h=this.getValueOfPropertyAt(n,a,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,r),r.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,a,"fill"),r.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,r.fillRect(t.left+t.leftOffset-c/2,l+t.top+h,c,s)},renderSelection:function(t,r){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,s=this.get2DCursorLocation(i),o=this.get2DCursorLocation(n),c=s.lineIndex,l=o.lineIndex,h=s.charIndex<0?0:s.charIndex,u=o.charIndex<0?0:o.charIndex,f=c;f<=l;f++){var d=this._getLineLeftOffset(f)||0,m=this.getHeightOfLine(f),g=0,b=0,_=0;if(f===c&&(b=this.__charBounds[c][h].left),f>=c&&f<l)_=a&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===l)if(u===0)_=this.__charBounds[l][u].left;else{var I=this._getWidthOfCharSpacing();_=this.__charBounds[l][u-1].left+this.__charBounds[l][u-1].width-I}g=m,(this.lineHeight<1||f===l&&this.lineHeight>1)&&(m/=this.lineHeight),this.inCompositionMode?(r.fillStyle=this.compositionColor||"black",r.fillRect(t.left+d+b,t.top+t.topOffset+m,_-b,1)):(r.fillStyle=this.selectionColor,r.fillRect(t.left+d+b,t.top+t.topOffset,_-b,m)),t.topOffset+=g}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),r=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:r}}}),p.IText.fromObject=function(t,r){if(e(t),t.styles)for(var i in t.styles)for(var n in t.styles[i])e(t.styles[i][n]);p.Object._fromObject("IText",t,r,"text")}})();(function(){var e=p.util.object.clone;p.util.object.extend(p.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var r=t.canvas;r&&(r._hasITextHandlers||(r._hasITextHandlers=!0,t._initCanvasHandlers(r)),r._iTextInstances=r._iTextInstances||[],r._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var r=t.canvas;r&&(r._iTextInstances=r._iTextInstances||[],p.util.removeFromArray(r._iTextInstances,t),r._iTextInstances.length===0&&(r._hasITextHandlers=!1,t._removeCanvasHandlers(r)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,r,i,n){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",r,{duration:i,onComplete:function(){a.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var r=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){r._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,r=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&r&&r.clearContext(r.contextTop||r.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var r=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i--;for(;/\S/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findWordBoundaryRight:function(t){var r=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)r++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},findLineBoundaryLeft:function(t){for(var r=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)r++,i--;return t-r},findLineBoundaryRight:function(t){for(var r=0,i=t;!/\n/.test(this._text[i])&&i<this._text.length;)r++,i++;return t+r},searchWordBoundary:function(t,r){for(var i=this._text,n=this._reSpace.test(i[t])?t-1:t,a=i[n],s=p.reNonWord;!s.test(a)&&n>0&&n<i.length;)n+=r,a=i[n];return s.test(a)&&(n+=r===1?0:1),n},selectWord:function(t){t=t||this.selectionStart;var r=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var r=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=r,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){return this.isEditing||!this.editable?void 0:(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this)},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(r){r.selected=!1,r.isEditing&&r.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(!this.__isMousedown||!this.isEditing)return;var r=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;if((r!==this.__selectionStartOnMouseDown||i===n)&&(i===r||n===r))return;r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==i||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection())},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,r,i){var n=i.slice(0,t),a=p.util.string.graphemeSplit(n).length;if(t===r)return{selectionStart:a,selectionEnd:a};var s=i.slice(t,r),o=p.util.string.graphemeSplit(s).length;return{selectionStart:a,selectionEnd:a+o}},fromGraphemeToStringSelection:function(t,r,i){var n=i.slice(0,t),a=n.join("").length;if(t===r)return{selectionStart:a,selectionEnd:a};var s=i.slice(t,r),o=s.join("").length;return{selectionStart:a,selectionEnd:a+o}},_updateTextarea:function(){if(this.cursorOffsetCache={},!this.hiddenTextarea)return;if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()},updateFromTextArea:function(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,a=i.charIndex,s=this.getValueOfPropertyAt(n,a,"fontSize")*this.lineHeight,o=r.leftOffset,c=this.calcTransformMatrix(),l={x:r.left+o,y:r.top+r.topOffset+s},h=this.canvas.getRetinaScaling(),u=this.canvas.upperCanvasEl,f=u.width/h,d=u.height/h,m=f-s,g=d-s,b=u.clientWidth/f,_=u.clientHeight/d;return l=p.util.transformPoint(l,c),l=p.util.transformPoint(l,this.canvas.viewportTransform),l.x*=b,l.y*=_,l.x<0&&(l.x=0),l.x>m&&(l.x=m),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps)return;this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){var t=this._textBeforeEdit!==this.text,r=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,r&&(r.blur&&r.blur(),r.parentNode&&r.parentNode.removeChild(r)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,r){var i=this.get2DCursorLocation(t,!0),n=this.get2DCursorLocation(r,!0),a=i.lineIndex,s=i.charIndex,o=n.lineIndex,c=n.charIndex,l,h;if(a!==o){if(this.styles[a])for(l=s;l<this._unwrappedTextLines[a].length;l++)delete this.styles[a][l];if(this.styles[o])for(l=c;l<this._unwrappedTextLines[o].length;l++)h=this.styles[o][l],h&&(this.styles[a]||(this.styles[a]={}),this.styles[a][s+l-c]=h);for(l=a+1;l<=o;l++)delete this.styles[l];this.shiftLineStyles(o,a-o)}else if(this.styles[a]){h=this.styles[a];var u=c-s,f,d;for(l=s;l<c;l++)delete h[l];for(d in this.styles[a])f=parseInt(d,10),f>=c&&(h[f-u]=h[d],delete h[d])}},shiftLineStyles:function(t,r){var i=e(this.styles);for(var n in this.styles){var a=parseInt(n,10);a>t&&(this.styles[a+r]=i[a],i[a-r]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,r,i,n){var a,s={},o=!1,c=this._unwrappedTextLines[t].length===r;i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(a=this.styles[t][r===0?r:r-1]);for(var l in this.styles[t]){var h=parseInt(l,10);h>=r&&(o=!0,s[h-r]=this.styles[t][l],c&&r===0||delete this.styles[t][l])}var u=!1;for(o&&!c&&(this.styles[t+i]=s,u=!0),u&&i--;i>0;)n&&n[i-1]?this.styles[t+i]={0:e(n[i-1])}:a?this.styles[t+i]={0:e(a)}:delete this.styles[t+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(t,r,i,n){this.styles||(this.styles={});var a=this.styles[t],s=a?e(a):{};i||(i=1);for(var o in s){var c=parseInt(o,10);c>=r&&(a[c+i]=s[c],s[c-i]||delete a[c])}if(this._forceClearCache=!0,n){for(;i--;){if(!Object.keys(n[i]).length)continue;this.styles[t]||(this.styles[t]={}),this.styles[t][r+i]=e(n[i])}return}if(!a)return;for(var l=a[r?r-1:1];l&&i--;)this.styles[t][r+i]=e(l)},insertNewStyleBlock:function(t,r,i){for(var n=this.get2DCursorLocation(r,!0),a=[0],s=0,o=0;o<t.length;o++)t[o]===`
`?(s++,a[s]=0):a[s]++;a[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,a[0],i),i=i&&i.slice(a[0]+1)),s&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+a[0],s);for(var o=1;o<s;o++)a[o]>0?this.insertCharStyleObject(n.lineIndex+o,0,a[o],i):i&&(this.styles[n.lineIndex+o][0]=i[0]),i=i&&i.slice(a[o]+1);a[o]>0&&this.insertCharStyleObject(n.lineIndex+o,0,a[o],i)},setSelectionStartEndWithShift:function(t,r,i){i<=t?(r===t?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<r?this._selectionDirection==="right"?this.selectionEnd=i:this.selectionStart=i:(r===t?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=r),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})})();p.util.object.extend(p.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(!this.canvas)return;this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){if(!this.isEditing)return;this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){if(!this.isEditing)return;this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())},_mouseDownHandlerBefore:function(e){if(!this.canvas||!this.editable||e.e.button&&e.e.button!==1)return;this.selected=this===this.canvas._activeObject},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&e.e.button!==1)return;if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),r=this.selectionStart,i=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(r,i,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t=this.getLocalPointer(e),r=0,i=0,n=0,a=0,s=0,o,c,l=0,h=this._textLines.length;l<h&&n<=t.y;l++)n+=this.getHeightOfLine(l)*this.scaleY,s=l,l>0&&(a+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));o=this._getLineLeftOffset(s),i=o*this.scaleX,c=this._textLines[s];for(var u=0,f=c.length;u<f&&(r=i,i+=this.__charBounds[s][u].kernedWidth*this.scaleX,i<=t.x);u++)a++;return this._getNewSelectionStartFromOffset(t,r,i,a,f)},_getNewSelectionStartFromOffset:function(e,t,r,i,n){var a=e.x-t,s=r-e.x,o=s>a||s<0?0:1,c=i+o;return this.flipX&&(c=n-c),c>this._text.length&&(c=this._text.length),c}});p.util.object.extend(p.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=p.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+e.fontSize+";",p.document.body.appendChild(this.hiddenTextarea),p.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),p.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),p.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),p.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(p.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing)return;if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else if(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapDown[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()},onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapUp[e.keyCode]](e);else return;e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;var r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,i=this._text.length,n=r.length,a,s,o=n-i,c=this.selectionStart,l=this.selectionEnd,h=c!==l,u,f,d;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var m=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),g=c>m.selectionStart;h?(a=this._text.slice(c,l),o+=l-c):n<i&&(g?a=this._text.slice(l+o,l):a=this._text.slice(c,c-o)),s=r.slice(m.selectionEnd-o,m.selectionEnd),a&&a.length&&(s.length&&(u=this.getSelectionStyles(c,c+1,!1),u=s.map(function(){return u[0]})),h?(f=c,d=l):g?(f=l-a.length,d=l):(f=l,d=l+a.length),this.removeStyleFromTo(f,d)),s.length&&(t&&s.join("")===p.copiedText&&!p.disableStyleCopyPaste&&(u=p.copiedTextStyle),this.insertNewStyleBlock(s,c,u)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){if(this.selectionStart===this.selectionEnd)return;p.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?p.copiedTextStyle=null:p.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||p.window.clipboardData},_getWidthBeforeCursor:function(e,t){var r=this._getLineLeftOffset(e),i;return t>0&&(i=this.__charBounds[e][t-1],r+=i.left+i.width),r},getDownCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),n=i.lineIndex;if(n===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-r;var a=i.charIndex,s=this._getWidthBeforeCursor(n,a),o=this._getIndexOnLine(n+1,s),c=this._textLines[n].slice(a);return c.length+o+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var r=this._getSelectionForOffset(e,t),i=this.get2DCursorLocation(r),n=i.lineIndex;if(n===0||e.metaKey||e.keyCode===33)return-r;var a=i.charIndex,s=this._getWidthBeforeCursor(n,a),o=this._getIndexOnLine(n-1,s),c=this._textLines[n].slice(0,a),l=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+o-c.length+(1-l)},_getIndexOnLine:function(e,t){for(var r=this._textLines[e],i=this._getLineLeftOffset(e),n=i,a=0,s,o,c=0,l=r.length;c<l;c++)if(s=this.__charBounds[e][c].width,n+=s,n>t){o=!0;var h=n-s,u=n,f=Math.abs(h-t),d=Math.abs(u-t);a=d<f?c:c-1;break}return o||(a=r.length-1),a},moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var r="get"+e+"CursorOffset",i=this[r](t,this._selectionDirection==="right");t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),i!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t=this._selectionDirection==="left"?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,r){var i;if(e.altKey)i=this["findWordBoundary"+r](this[t]);else if(e.metaKey||e.keyCode===35||e.keyCode===36)i=this["findLineBoundary"+r](this[t]);else return this[t]+=r==="Left"?-1:1,!0;if(typeof i!==void 0&&this[t]!==i)return this[t]=i,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(e,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(e,"selectionStart")},moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length)return;this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var r="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?r+="Shift":r+="outShift",this[r](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(e,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(e,"selectionEnd")},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){typeof t=="undefined"&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,r,i){typeof i=="undefined"&&(i=r),i>r&&this.removeStyleFromTo(r,i);var n=p.util.string.graphemeSplit(e);this.insertNewStyleBlock(n,r,t),this._text=[].concat(this._text.slice(0,r),n,this._text.slice(i)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}});(function(){var e=p.util.toFixed,t=/  +/g;p.util.object.extend(p.Text.prototype,{_toSVG:function(){var r=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(r){return this._createBaseSVGMarkup(this._toSVG(),{reviver:r,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(r){var i=!0,n=this.getSvgTextDecoration(this);return[r.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",r.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(r,i){var n=[],a=[],s=r,o;this._setSVGBg(a);for(var c=0,l=this._textLines.length;c<l;c++)o=this._getLineLeftOffset(c),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(a,c,i+o,s),this._setSVGTextLineText(n,c,i+o,s),s+=this.getHeightOfLine(c);return{textSpans:n,textBgRects:a}},_createTextCharSpan:function(r,i,n,a){var s=r!==r.trim()||r.match(t),o=this.getSvgSpanStyles(i,s),c=o?'style="'+o+'"':"",l=i.deltaY,h="",u=p.Object.NUM_FRACTION_DIGITS;return l&&(h=' dy="'+e(l,u)+'" '),['<tspan x="',e(n,u),'" y="',e(a,u),'" ',h,c,">",p.util.string.escapeXml(r),"</tspan>"].join("")},_setSVGTextLineText:function(r,i,n,a){var s=this.getHeightOfLine(i),o=this.textAlign.indexOf("justify")!==-1,c,l,h="",u,f,d=0,m=this._textLines[i],g;a+=s*(1-this._fontSizeFraction)/this.lineHeight;for(var b=0,_=m.length-1;b<=_;b++)g=b===_||this.charSpacing,h+=m[b],u=this.__charBounds[i][b],d===0?(n+=u.kernedWidth-u.width,d+=u.width):d+=u.kernedWidth,o&&!g&&(this._reSpaceAndTab.test(m[b])&&(g=!0)),g||(c=c||this.getCompleteStyleDeclaration(i,b),l=this.getCompleteStyleDeclaration(i,b+1),g=this._hasStyleChangedForSvg(c,l)),g&&(f=this._getStyleDeclaration(i,b)||{},r.push(this._createTextCharSpan(h,f,n,a)),h="",c=l,n+=d,d=0)},_pushTextBgRect:function(r,i,n,a,s,o){var c=p.Object.NUM_FRACTION_DIGITS;r.push("		<rect ",this._getFillAttributes(i),' x="',e(n,c),'" y="',e(a,c),'" width="',e(s,c),'" height="',e(o,c),`"></rect>
`)},_setSVGTextLineBg:function(r,i,n,a){for(var s=this._textLines[i],o=this.getHeightOfLine(i)/this.lineHeight,c=0,l=0,h,u,f=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),d=0,m=s.length;d<m;d++)h=this.__charBounds[i][d],u=this.getValueOfPropertyAt(i,d,"textBackgroundColor"),u!==f?(f&&this._pushTextBgRect(r,f,n+l,a,c,o),l=h.left,c=h.width,f=u):c+=h.kernedWidth;u&&this._pushTextBgRect(r,u,n+l,a,c,o)},_getFillAttributes:function(r){var i=r&&typeof r=="string"?new p.Color(r):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+r+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(r){for(var i=0,n=0,a=0;a<r;a++)i+=this.getHeightOfLine(a);return n=this.getHeightOfLine(a),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(r){var i=p.Object.prototype.getSvgStyles.call(this,r);return i+" white-space: pre;"}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){if(this.__skipDimension)return;this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"})},_generateStyleMap:function(r){for(var i=0,n=0,a=0,s={},o=0;o<r.graphemeLines.length;o++)r.graphemeText[a]===`
`&&o>0?(n=0,a++,i++):!this.splitByGrapheme&&this._reSpaceAndTab.test(r.graphemeText[a])&&o>0&&(n++,a++),s[o]={line:i,offset:n},a+=r.graphemeLines[o].length,n+=r.graphemeLines[o].length;return s},styleHas:function(r,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return t.Text.prototype.styleHas.call(this,r,i)},isEmptyStyles:function(r){if(!this.styles)return!0;var i=0,n=r+1,a,s,o=!1,c=this._styleMap[r],l=this._styleMap[r+1];c&&(r=c.line,i=c.offset),l&&(n=l.line,o=n===r,a=l.offset),s=typeof r=="undefined"?this.styles:{line:this.styles[r]};for(var h in s)for(var u in s[h])if(u>=i&&(!o||u<a))for(var f in s[h][u])return!1;return!0},_getStyleDeclaration:function(r,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[r];if(!n)return null;r=n.line,i=n.offset+i}return this.callSuper("_getStyleDeclaration",r,i)},_setStyleDeclaration:function(r,i,n){var a=this._styleMap[r];r=a.line,i=a.offset+i,this.styles[r][i]=n},_deleteStyleDeclaration:function(r,i){var n=this._styleMap[r];r=n.line,i=n.offset+i,delete this.styles[r][i]},_getLineStyle:function(r){var i=this._styleMap[r];return!!this.styles[i.line]},_setLineStyle:function(r){var i=this._styleMap[r];this.styles[i.line]={}},_wrapText:function(r,i){var n=[],a;for(this.isWrapping=!0,a=0;a<r.length;a++)n=n.concat(this._wrapLine(r[a],a,i));return this.isWrapping=!1,n},_measureWord:function(r,i,n){var a=0,s,o=!0;n=n||0;for(var c=0,l=r.length;c<l;c++){var h=this._getGraphemeBox(r[c],i,c+n,s,o);a+=h.kernedWidth,s=r[c]}return a},_wrapLine:function(r,i,n,a){var s=0,o=this.splitByGrapheme,c=[],l=[],h=o?t.util.string.graphemeSplit(r):r.split(this._wordJoiners),u="",f=0,d=o?"":" ",m=0,g=0,b=0,_=!0,I=this._getWidthOfCharSpacing(),a=a||0;h.length===0&&h.push([]),n-=a;for(var M=0;M<h.length;M++)u=o?h[M]:t.util.string.graphemeSplit(h[M]),m=this._measureWord(u,i,f),f+=u.length,s+=g+m-I,s>=n&&!_?(c.push(l),l=[],s=m,_=!0):s+=I,!_&&!o&&l.push(d),l=l.concat(u),g=o?0:this._measureWord([d],i,f),f++,_=!1,m>b&&(b=m);return M&&c.push(l),b+a>this.dynamicMinWidth&&(this.dynamicMinWidth=b-I+a),c},isEndOfWrapping:function(r){return this._styleMap[r+1]?this._styleMap[r+1].line!==this._styleMap[r].line:!0},missingNewlineOffset:function(r){return this.splitByGrapheme?this.isEndOfWrapping(r)?1:0:1},_splitTextIntoLines:function(r){for(var i=t.Text.prototype._splitTextIntoLines.call(this,r),n=this._wrapText(i.lines,this.width),a=new Array(n.length),s=0;s<n.length;s++)a[s]=n[s].join("");return i.lines=a,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var r={};for(var i in this._styleMap)this._textLines[i]&&(r[this._styleMap[i].line]=1);for(var i in this.styles)r[i]||delete this.styles[i]},toObject:function(r){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(r))}}),t.Textbox.fromObject=function(r,i){return t.Object._fromObject("Textbox",r,i,"text")}})((typeof P!="undefined",P));(function(){var e=p.controlsUtils,t=e.scaleSkewCursorStyleHandler,r=e.scaleCursorStyleHandler,i=e.scalingEqually,n=e.scalingYOrSkewingX,a=e.scalingXOrSkewingY,s=e.scaleOrSkewActionName,o=p.Object.prototype.controls;if(o.ml=new p.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:a,getActionName:s}),o.mr=new p.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:a,getActionName:s}),o.mb=new p.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:n,getActionName:s}),o.mt=new p.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:n,getActionName:s}),o.tl=new p.Control({x:-.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),o.tr=new p.Control({x:.5,y:-.5,cursorStyleHandler:r,actionHandler:i}),o.bl=new p.Control({x:-.5,y:.5,cursorStyleHandler:r,actionHandler:i}),o.br=new p.Control({x:.5,y:.5,cursorStyleHandler:r,actionHandler:i}),o.mtr=new p.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),p.Textbox){var c=p.Textbox.prototype.controls={};c.mtr=o.mtr,c.tr=o.tr,c.br=o.br,c.tl=o.tl,c.bl=o.bl,c.mt=o.mt,c.mb=o.mb,c.mr=new p.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),c.ml=new p.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}})()}),Pa=te(Wv=>{qh(Wv,{options:()=>Bh,unzip:()=>Mh,version:()=>Fh});const Mh=Ph,Bh={},Fh="0.4.1"});const yh=Dt(xc()),Ea=/[/\\]/;function Ut(e){return e.split(Ea).map(t=>t.trim()).filter(t=>t)}function Ec(e,t){const r=e.split(":");if(r.length>2)throw Error("\u0414\u0432\u043E\u0435\u0442\u043E\u0447\u0438\u0435 \u043F\u043E\u0441\u043B\u0435 \u043F\u0440\u0435\u0444\u0438\u043A\u0441\u0430 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u043D\u043E \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044C\u0441\u044F \u043B\u0438\u0448\u044C \u0435\u0434\u0438\u043D\u043E\u0436\u0434\u044B.");let i=t,n=r[0];if(r.length!==1){n=r[1];const a=r[0].trim().toUpperCase();if(a.length!==1||!/[A-Z]/.test(a))throw Error("\u041F\u0440\u0435\u0444\u0438\u043A\u0441 \u0434\u0438\u0441\u043A\u0430 \u0434\u043E\u043B\u0436\u0435\u043D \u0441\u043E\u0441\u0442\u043E\u044F\u0442\u044C \u0438\u0437 \u043E\u0434\u043D\u043E\u0439 \u043B\u0430\u0442\u0438\u043D\u0441\u043A\u043E\u0439 \u0431\u0443\u043A\u0432\u044B");i=a}return[i,Ut(n)]}function Cc(e){return e.substring(0,e.lastIndexOf("\\"))}class Ac extends Error{constructor(e){super("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E: "+e)}}class Ht extends Error{constructor(e){super(e)}}class ge extends Error{constructor(e){super(e)}}class et extends ge{constructor(e,t){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.meta.filepathDos||""}:
${t}`)}}class tt extends et{constructor(e,t,r){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${t.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}}const Dc=["brushTools","penTools","bitmapTools","doubleBitmapTools","fontTools","stringTools","textTools"];function Wt(e){return e?e.map(t=>Q({},t)):void 0}function Oc(e){const t=Q({},e);return t.brushTools=Wt(e.brushTools),t.penTools=Wt(e.penTools),t.bitmapTools=Wt(e.bitmapTools),t.doubleBitmapTools=Wt(e.doubleBitmapTools),t.fontTools=Wt(e.fontTools),t.stringTools=Wt(e.stringTools),t.textTools=e.textTools&&e.textTools.map(r=>Q(Q({},r),{textCollection:r.textCollection.map(i=>Q({},i))})),t.elements=Wt(e.elements),t.elementOrder=e.elementOrder&&e.elementOrder.slice(),t}function Ic(e,t){const r=e.find(i=>i.handle===t);if(!r||r.type!=="otGROUP2D")throw new ge(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${t}`);return r}function Rc(e,t){const r=t.childHandles[0],i=e.find(n=>n.handle===r);return!i||i.type!=="otDOUBLEBITMAP2D"?void 0:i}function pp(e,t){const r=new Map;let i=1;for(const n of t){for(;e.some(a=>a.handle===i);)i++;r.set(n.handle,i),n.handle=i,e.push(n)}return r}function mp(e,t){const r={};for(const i of Dc){const n=t[i];if(!n)continue;const a=e[i];if(!a){e[i]=n;continue}r[i]=pp(a,n)}return r}function Tt(e,t,r){if(!e)return;for(const i of e){const n=i[t];i[t]=r.get(n)||n}}function gp(e,t,r){switch(t){case"fontTools":{const{textTools:i}=e;i&&i.forEach(n=>Tt(n.textCollection,"fontHandle",r));break}case"stringTools":{const{textTools:i}=e;i&&i.forEach(n=>Tt(n.textCollection,"stringHandle",r));break}case"bitmapTools":{Tt(e.brushTools,"dibHandle",r);break}}}function bp(e,t,r){switch(t){case"brushTools":const i=e.filter(c=>c.type==="otLINE2D");Tt(i,"brushHandle",r);break;case"penTools":const n=e.filter(c=>c.type==="otLINE2D");Tt(n,"penHandle",r);break;case"bitmapTools":const a=e.filter(c=>c.type==="otBITMAP2D");Tt(a,"bmpHandle",r);break;case"doubleBitmapTools":const s=e.filter(c=>c.type==="otDOUBLEBITMAP2D");Tt(s,"bmpHandle",r);break;case"textTools":const o=e.filter(c=>c.type==="otTEXT2D");Tt(o,"textToolHandle",r);break}}function vp(e,t){for(const r of Dc){const i=t[r];if(!i)continue;gp(e,r,i),e.elements&&bp(e.elements,r,i)}}function yp(e){let t,r;for(const i of e){if(i.type==="otGROUP2D")continue;(t===void 0||i.position.x<t)&&(t=i.position.x),(r===void 0||i.position.y<r)&&(r=i.position.y)}return{x:t||0,y:r||0}}function _p(e,t){return e.some(r=>r.type==="otGROUP2D"&&r.childHandles.includes(t.handle))}function wp(e,t,r){const i=new Map;if(t.length===0)return{map:i,rootHandle:0};let n=1;const a=[];for(const o of t){for(o.type!=="otGROUP2D"&&(o.position={x:o.position.x+r.x,y:o.position.y+r.y});e.some(c=>c.handle===n);)n++;_p(t,o)||a.push(n),i.set(o.handle,n),o.handle=n,e.push(o)}if(t.length===1)return{map:i,rootHandle:t[0].handle};for(;e.some(o=>o.handle===n);)n++;const s={type:"otGROUP2D",handle:n,childHandles:a,options:0,name:""};return e.push(s),{map:i,rootHandle:s.handle}}function Sp(e,t){for(const r of e){if(r.type!=="otGROUP2D")continue;r.childHandles=r.childHandles.map(i=>t.get(i)||i)}}function Tp(e,t){return e.map(r=>t.get(r)||r)}function xp(e){return e.elements!==void 0&&e.elements.length>0}class jc{constructor(e){const t=Oc(e);if(!xp(t))throw new ge("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=t}get result(){return this.scheme}insertChildImage(e,t,r){const{scheme:i}=this,n=Oc(t),a=mp(i,n);if(vp(n,a),!n.elements)return;const s=Ic(i.elements,e),o=Rc(i.elements,s);o&&(o.options=1);const c=yp(n.elements),l={x:r.x-c.x,y:r.y-c.y},{map:h,rootHandle:u}=wp(i.elements,n.elements,l);if(Sp(n.elements,h),s.childHandles.push(u),!n.elementOrder)return;const f=Tp(n.elementOrder,h),d=i.elementOrder;i.elementOrder=d?d.concat(f):f}replaceIcon(e,t){const{scheme:r}=this,i=Ic(r.elements,e),n=Rc(r.elements,i);if(!n)return;const a={type:"ttREFTODOUBLEDIB2D",handle:0,filename:t};let s=1;if(r.doubleBitmapTools){for(;r.doubleBitmapTools.some(o=>o.handle===s);)s++;r.doubleBitmapTools.push(a)}else r.doubleBitmapTools=[a];n.bmpHandle=a.handle=s}}function kc(e,t,r){const i=new jc(e);for(const n of t){const a=r.get(n.classname.toUpperCase());if(!a)throw new ge(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${n.classname} #${n.schemeInfo.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const{handle:s,position:o}=n.schemeInfo;a.iconFile&&i.replaceIcon(s,a.iconFile),a.image&&i.insertChildImage(s,a.image,o)}return i.result}class Yi{constructor(){this.frameId=0;this._running=!1}_loop(e){return requestAnimationFrame(()=>{e()?this.frameId=this._loop(e):this._running=!1})}_unloop(){cancelAnimationFrame(this.frameId)}get running(){return this._running}run(e){if(this._running)return;this._running=!0,this.frameId=this._loop(e)}stop(){if(!this._running)return;this._running=!1,this._unloop()}}const Ia=Dt(pr()),Ap=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],Bc=1<<24,Fc=2<<24;function Gc(e){const t=e.toLowerCase().trim();if(t.startsWith("transparent"))return Bc;if(t.startsWith("syscolor"))return Fc|parseInt(t.split("(")[1].split(")")[0]);if(t.startsWith("rgb")){const r=t.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw new ge(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0446\u0432\u0435\u0442: ${e}`)}function Xe(e){if(e&Bc)return"transparent";const t=e&255;if(e&Fc)return Ap[t]||"black";const r=e>>8&255,i=e>>16&255;return`rgb(${t},${r},${i})`}class ne extends Map{static create(e){return new Map(e)}static getFreeHandle(e,t){let r=t||0;for(;e.has(++r););return r}}var Se;(function(e){e[e.WM_DESTROY=2]="WM_DESTROY",e[e.WM_MOVE=3]="WM_MOVE",e[e.WM_SIZE=5]="WM_SIZE",e[e.WM_CLOSE=16]="WM_CLOSE",e[e.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",e[e.WM_COMMAND=273]="WM_COMMAND",e[e.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",e[e.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",e[e.WM_LBUTTONUP=514]="WM_LBUTTONUP",e[e.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",e[e.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",e[e.WM_RBUTTONUP=517]="WM_RBUTTONUP",e[e.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",e[e.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",e[e.WM_MBUTTONUP=520]="WM_MBUTTONUP",e[e.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",e[e.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",e[e.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",e[e.WM_KEYDOWN=256]="WM_KEYDOWN",e[e.WM_KEYUP=257]="WM_KEYUP",e[e.WM_CANCLOSE=1538]="WM_CANCLOSE",e[e.WM_SPACEDONE=1539]="WM_SPACEDONE",e[e.WM_SPACEINIT=1540]="WM_SPACEINIT",e[e.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",e[e.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(Se||(Se={}));var y;(function(e){e[e.V_END=0]="V_END",e[e.PUSH_FLOAT=1]="PUSH_FLOAT",e[e._PUSH_FLOAT=2]="_PUSH_FLOAT",e[e.vmPUSH_LONG=3]="vmPUSH_LONG",e[e.vm_PUSH_LONG=4]="vm_PUSH_LONG",e[e.vmPUSH_LONG_const=5]="vmPUSH_LONG_const",e[e.PUSH_FLOAT_const=6]="PUSH_FLOAT_const",e[e.PUSH_DATA=7]="PUSH_DATA",e[e.PUSH_DATA_=8]="PUSH_DATA_",e[e.PUSH_DATA_const=9]="PUSH_DATA_const",e[e._POP_FLOAT_OLD=10]="_POP_FLOAT_OLD",e[e._POP_FLOAT=11]="_POP_FLOAT",e[e.vm_POP_LONG_OLD=12]="vm_POP_LONG_OLD",e[e.vm_POP_LONG=13]="vm_POP_LONG",e[e.POP_DATA=14]="POP_DATA",e[e._POP_DATA=15]="_POP_DATA",e[e.FLOAT_TO_LONG=16]="FLOAT_TO_LONG",e[e.LONG_TO_FLOAT=17]="LONG_TO_FLOAT",e[e.V_ADD_F=18]="V_ADD_F",e[e.V_SUB_F=19]="V_SUB_F",e[e.V_DIV_F=20]="V_DIV_F",e[e.V_MUL_F=21]="V_MUL_F",e[e.V_MOD=22]="V_MOD",e[e.V_TAN=23]="V_TAN",e[e.V_ATAN=24]="V_ATAN",e[e.V_SIN=25]="V_SIN",e[e.V_ASIN=26]="V_ASIN",e[e.V_COS=27]="V_COS",e[e.V_ACOS=28]="V_ACOS",e[e.V_LN=29]="V_LN",e[e.V_LG=30]="V_LG",e[e.V_LOG=31]="V_LOG",e[e.V_STEPEN=32]="V_STEPEN",e[e.V_EXP=33]="V_EXP",e[e.V_SQRT=34]="V_SQRT",e[e.V_SQR=35]="V_SQR",e[e.V_ED=36]="V_ED",e[e.V_DELTA=37]="V_DELTA",e[e.V_MAX=38]="V_MAX",e[e.V_MIN=39]="V_MIN",e[e.V_AVERAGE=40]="V_AVERAGE",e[e.V_ROUND=41]="V_ROUND",e[e.V_RANDOM=42]="V_RANDOM",e[e.V_AND=43]="V_AND",e[e.V_OR=44]="V_OR",e[e.V_NOT=45]="V_NOT",e[e.V_ABS=46]="V_ABS",e[e.V_SGN=47]="V_SGN",e[e.V_RAD=48]="V_RAD",e[e.V_DEG=49]="V_DEG",e[e.V_STOP=50]="V_STOP",e[e.V_JMP=51]="V_JMP",e[e.V_JNZ=52]="V_JNZ",e[e.V_JZ=53]="V_JZ",e[e.V_EQUAL=54]="V_EQUAL",e[e.V_NOTEQUAL=55]="V_NOTEQUAL",e[e.V_MORE=56]="V_MORE",e[e.V_MOREorEQUAL=57]="V_MOREorEQUAL",e[e.V_LOW=58]="V_LOW",e[e.V_LOWorEQUAL=59]="V_LOWorEQUAL",e[e.V_MCREATE=60]="V_MCREATE",e[e.V_MDELETE=61]="V_MDELETE",e[e.V_MFILL=62]="V_MFILL",e[e.V_MGET=63]="V_MGET",e[e.V_MPUT=64]="V_MPUT",e[e.V_MEDITOR=65]="V_MEDITOR",e[e.V_MDIAG=66]="V_MDIAG",e[e.V_MADDX=67]="V_MADDX",e[e.V_MSUBX=68]="V_MSUBX",e[e.V_MDIVX=69]="V_MDIVX",e[e.V_MMULX=70]="V_MMULX",e[e.V_MDET=71]="V_MDET",e[e.V_MDELTA=72]="V_MDELTA",e[e.V_MED=73]="V_MED",e[e.V_TRANSP=74]="V_TRANSP",e[e.V_MADDC=75]="V_MADDC",e[e.V_MNOT=76]="V_MNOT",e[e.V_MSUM=77]="V_MSUM",e[e.V_MSUBC=78]="V_MSUBC",e[e.V_MMULC=79]="V_MMULC",e[e.V_TRUNC=80]="V_TRUNC",e[e.V_CLOSEALL=81]="V_CLOSEALL",e[e.V_EQUALI=82]="V_EQUALI",e[e.V_NOTEQUALI=83]="V_NOTEQUALI",e[e.V_EDI=84]="V_EDI",e[e.V_ANDI=85]="V_ANDI",e[e.V_ORI=86]="V_ORI",e[e.V_NOTI=87]="V_NOTI",e[e.V_NOTbin=88]="V_NOTbin",e[e.VM_SETCRDSYSTEM=89]="VM_SETCRDSYSTEM",e[e.V_MDIVC=90]="V_MDIVC",e[e.V_MMUL=91]="V_MMUL",e[e.V_MGLUE=92]="V_MGLUE",e[e.V_MCUT=93]="V_MCUT",e[e.V_MMOVE=94]="V_MMOVE",e[e.V_MOBR=95]="V_MOBR",e[e.V_MDIM=96]="V_MDIM",e[e.V_XOR=97]="V_XOR",e[e.V_XORBIN=98]="V_XORBIN",e[e.V_FOLDERDIALOG=99]="V_FOLDERDIALOG",e[e.V_MSAVEAS=100]="V_MSAVEAS",e[e.V_MLOAD=101]="V_MLOAD",e[e.V_SAVEDIALOG=102]="V_SAVEDIALOG",e[e.V_LOADDIALOG=103]="V_LOADDIALOG",e[e.V_CREATEOBJECTFROMFILE=104]="V_CREATEOBJECTFROMFILE",e[e.V_AND_BINARY=105]="V_AND_BINARY",e[e.V_OR_BINARY=106]="V_OR_BINARY",e[e.V_QUITSC=107]="V_QUITSC",e[e.POP_FLOAT_PTR=108]="POP_FLOAT_PTR",e[e.PUSH_FLOAT_PTR=109]="PUSH_FLOAT_PTR",e[e.V_JNZ_HANDLE=110]="V_JNZ_HANDLE",e[e.V_JZ_HANDLE=111]="V_JZ_HANDLE",e[e.SETSTATUSTEXT=112]="SETSTATUSTEXT",e[e.V_UN_MINUS=113]="V_UN_MINUS",e[e.V_STRINGEX=114]="V_STRINGEX",e[e.GETTICKCOUNT=115]="GETTICKCOUNT",e[e.V_SHR=116]="V_SHR",e[e.V_SHL=117]="V_SHL",e[e.SCHANGE=119]="SCHANGE",e[e.PUSH_STRING=120]="PUSH_STRING",e[e._PUSH_STRING=121]="_PUSH_STRING",e[e.PUSH_STRING_CONST=122]="PUSH_STRING_CONST",e[e._POP_STRING=123]="_POP_STRING",e[e.PLUS_STRING=124]="PLUS_STRING",e[e.LEFT_STRING=125]="LEFT_STRING",e[e.RIGHT_STRING=126]="RIGHT_STRING",e[e.SUBSTR_STRING=127]="SUBSTR_STRING",e[e.POS_STRING=128]="POS_STRING",e[e.REPLICATE_STRING=129]="REPLICATE_STRING",e[e.LOWER_STRING=130]="LOWER_STRING",e[e.UPPER_STRING=131]="UPPER_STRING",e[e.ANSI_TO_OEM_STRING=132]="ANSI_TO_OEM_STRING",e[e.OEM_TO_ANSI_STRING=133]="OEM_TO_ANSI_STRING",e[e.COMPARE_STRING=134]="COMPARE_STRING",e[e.COMPAREI_STRING=135]="COMPAREI_STRING",e[e.LENGTH_STRING=136]="LENGTH_STRING",e[e.LTRIM_STRING=137]="LTRIM_STRING",e[e.RTRIM_STRING=138]="RTRIM_STRING",e[e.ALLTRIM_STRING=139]="ALLTRIM_STRING",e[e.ASCII_STRING=140]="ASCII_STRING",e[e.CHR_STRING=141]="CHR_STRING",e[e.FLOAT_TO_STRING=142]="FLOAT_TO_STRING",e[e.STRING_TO_FLOAT=143]="STRING_TO_FLOAT",e[e.S_EQUAL=144]="S_EQUAL",e[e.S_NOTEQUAL=145]="S_NOTEQUAL",e[e.S_MORE=146]="S_MORE",e[e.S_MOREorEQUAL=147]="S_MOREorEQUAL",e[e.S_LOW=148]="S_LOW",e[e.S_LOWorEQUAL=149]="S_LOWorEQUAL",e[e.RGB_COLOR=150]="RGB_COLOR",e[e.V_SYSTEM=151]="V_SYSTEM",e[e.V_SYSTEMSTR=152]="V_SYSTEMSTR",e[e.V_REGISTEROBJECT=153]="V_REGISTEROBJECT",e[e.V_UNREGISTEROBJECT=154]="V_UNREGISTEROBJECT",e[e.V_SETCAPTURE=155]="V_SETCAPTURE",e[e.V_RELEASECAPTURE=156]="V_RELEASECAPTURE",e[e._POP_STRING_OLD=157]="_POP_STRING_OLD",e[e.VM_GETMOUSEPOS=158]="VM_GETMOUSEPOS",e[e.vm_INPUT_BOX=159]="vm_INPUT_BOX",e[e.MESSAGE_BOX=160]="MESSAGE_BOX",e[e.V_CREATESTREAM=161]="V_CREATESTREAM",e[e.V_CLOSESTREAM=162]="V_CLOSESTREAM",e[e.V_SEEK=163]="V_SEEK",e[e.V_STREAMSTATUS=164]="V_STREAMSTATUS",e[e.V_EOF=165]="V_EOF",e[e.V_GETPOS=167]="V_GETPOS",e[e.V_GETSIZE=168]="V_GETSIZE",e[e.V_SETWIDTH=169]="V_SETWIDTH",e[e.V_FREAD=170]="V_FREAD",e[e.V_SREAD=171]="V_SREAD",e[e.V_FWRITE=172]="V_FWRITE",e[e.V_SWRITE=173]="V_SWRITE",e[e.V_GETLINE=174]="V_GETLINE",e[e.V_COPYBLOCK=175]="V_COPYBLOCK",e[e.V_TRUNCATE=176]="V_TRUNCATE",e[e.V_RANDOMIZE=177]="V_RANDOMIZE",e[e.V_CREATEFROMFILE3D=197]="V_CREATEFROMFILE3D",e[e.WINSHELL=198]="WINSHELL",e[e.RGB_COLORex=199]="RGB_COLORex",e[e.LOADSPACEWINDOW=200]="LOADSPACEWINDOW",e[e.OPENSCHEMEWINDOW=201]="OPENSCHEMEWINDOW",e[e.CLOSEWINDOW=202]="CLOSEWINDOW",e[e.V_GETNAMEBYHSP=203]="V_GETNAMEBYHSP",e[e.V_GETHSPBYNAME=204]="V_GETHSPBYNAME",e[e.V_SETCLIENTSIZE=205]="V_SETCLIENTSIZE",e[e.SETWINDOWTITLE=206]="SETWINDOWTITLE",e[e.GETWINDOWTITLE=207]="GETWINDOWTITLE",e[e.SHOWWINDOW=208]="SHOWWINDOW",e[e.SETWINDOWPOS=209]="SETWINDOWPOS",e[e.SETWINDOWORG=210]="SETWINDOWORG",e[e.SETWINDOWSIZE=211]="SETWINDOWSIZE",e[e.ISWINDOWVISIBLE=212]="ISWINDOWVISIBLE",e[e.ISICONIC=213]="ISICONIC",e[e.ISWINDOWEXIST=214]="ISWINDOWEXIST",e[e.BRINGWINDOWTOTOP=215]="BRINGWINDOWTOTOP",e[e.CASCADEWINDOWS=216]="CASCADEWINDOWS",e[e.TILE=217]="TILE",e[e.ARRANGEICONS=218]="ARRANGEICONS",e[e.WIN_ORGX=219]="WIN_ORGX",e[e.WIN_ORGY=220]="WIN_ORGY",e[e.WIN_SIZEX=221]="WIN_SIZEX",e[e.WIN_SIZEY=222]="WIN_SIZEY",e[e.GETOBJECTHANDLE=223]="GETOBJECTHANDLE",e[e.GETOBJECTBYNAME=224]="GETOBJECTBYNAME",e[e.GETCLIENTWIDTH=225]="GETCLIENTWIDTH",e[e.GETCLIENTHEIGHT=226]="GETCLIENTHEIGHT",e[e.CHOSECOLORDIALOG=227]="CHOSECOLORDIALOG",e[e.JGETX=228]="JGETX",e[e.JGETY=229]="JGETY",e[e.JGETZ=230]="JGETZ",e[e.JGETBTN=231]="JGETBTN",e[e.GETAKEYSTATE=232]="GETAKEYSTATE",e[e.GETCLASSDIR=233]="GETCLASSDIR",e[e.GETPROJECTDIR=234]="GETPROJECTDIR",e[e.GETWINDOWSDIR=235]="GETWINDOWSDIR",e[e.GETSYSTEMDIR=236]="GETSYSTEMDIR",e[e.GETDIRFROMFILE=237]="GETDIRFROMFILE",e[e.ADDSLASH=238]="ADDSLASH",e[e.GETSTRATUMDIR=239]="GETSTRATUMDIR",e[e.WINEXECUTE=240]="WINEXECUTE",e[e.SETSCROLLRANGE=241]="SETSCROLLRANGE",e[e.VM_GETACTUALWIDTH=242]="VM_GETACTUALWIDTH",e[e.VM_GETACTUALHEIGHT=243]="VM_GETACTUALHEIGHT",e[e.VM_SAVEIMAGE=244]="VM_SAVEIMAGE",e[e.V_LOCK2D=245]="V_LOCK2D",e[e.VM_LOADMENU=246]="VM_LOADMENU",e[e.VM_DELETEMENU=247]="VM_DELETEMENU",e[e.REGISTEROBJECTS=248]="REGISTEROBJECTS",e[e.UNREGISTEROBJECTS=249]="UNREGISTEROBJECTS",e[e.MCISENDSTRING=250]="MCISENDSTRING",e[e.MCISENDSTRING_INT=251]="MCISENDSTRING_INT",e[e.MCISENDSTRINGEX=252]="MCISENDSTRINGEX",e[e.GETLASTMCIERROR=253]="GETLASTMCIERROR",e[e.GETMCIERROR=254]="GETMCIERROR",e[e.VM_SETCALCORDER=255]="VM_SETCALCORDER",e[e.VM_GETCALCORDER=256]="VM_GETCALCORDER",e[e.VM_GETOBJECT3DFROMPOINT2D=296]="VM_GETOBJECT3DFROMPOINT2D",e[e.VM_SWEEPEXTRUDE=297]="VM_SWEEPEXTRUDE",e[e.V_ISINTERSECT2D=298]="V_ISINTERSECT2D",e[e.SETARROW2D=299]="SETARROW2D",e[e.CREATELINE2D=300]="CREATELINE2D",e[e.ADDPOINT2D=301]="ADDPOINT2D",e[e.DELPOINT2D=302]="DELPOINT2D",e[e.GETBRUSHOBJECT2D=303]="GETBRUSHOBJECT2D",e[e.GETPENOBJECT2D=304]="GETPENOBJECT2D",e[e.GETRGNCREATEMODE=305]="GETRGNCREATEMODE",e[e.GETVECTORNUMPOINTS2D=306]="GETVECTORNUMPOINTS2D",e[e.GETVECTORPOINT2DX=307]="GETVECTORPOINT2DX",e[e.GETVECTORPOINT2DY=308]="GETVECTORPOINT2DY",e[e.SETBRUSHOBJECT2D=309]="SETBRUSHOBJECT2D",e[e.SETPENOBJECT2D=310]="SETPENOBJECT2D",e[e.SETRGNCREATEMODE=311]="SETRGNCREATEMODE",e[e.SETVECTORPOINT2D=312]="SETVECTORPOINT2D",e[e.CREATEPEN2D=313]="CREATEPEN2D",e[e.GETPENCOLOR2D=314]="GETPENCOLOR2D",e[e.GETPENROP2D=315]="GETPENROP2D",e[e.GETPENSTYLE2D=316]="GETPENSTYLE2D",e[e.GETPENWIDTH2D=317]="GETPENWIDTH2D",e[e.SETPENCOLOR2D=318]="SETPENCOLOR2D",e[e.SETPENROP2D=319]="SETPENROP2D",e[e.SETPENSTYLE2D=320]="SETPENSTYLE2D",e[e.SETPENWIDTH2D=321]="SETPENWIDTH2D",e[e.DELETETOOL2D=322]="DELETETOOL2D",e[e.DELETEOBJECT2D=323]="DELETEOBJECT2D",e[e.GETOBJECTORG2DX=324]="GETOBJECTORG2DX",e[e.GETOBJECTORG2DY=325]="GETOBJECTORG2DY",e[e.GETOBJECTPARENT2D=326]="GETOBJECTPARENT2D",e[e.GETOBJECTANGLE2D=327]="GETOBJECTANGLE2D",e[e.GETOBJECTSIZE2DX=328]="GETOBJECTSIZE2DX",e[e.GETOBJECTSIZE2DY=329]="GETOBJECTSIZE2DY",e[e.GETOBJECTTYPE=330]="GETOBJECTTYPE",e[e.SETOBJECTORG2D=331]="SETOBJECTORG2D",e[e.SETOBJECTSIZE2D=332]="SETOBJECTSIZE2D",e[e.CREATEBRUSH2D=333]="CREATEBRUSH2D",e[e.SETPOINTS2D=334]="SETPOINTS2D",e[e.CREATEDID2D=335]="CREATEDID2D",e[e.CREATEDOUBLEDID2D=336]="CREATEDOUBLEDID2D",e[e.CREATERDID2D=337]="CREATERDID2D",e[e.CREATERDOUBLEDID2D=338]="CREATERDOUBLEDID2D",e[e.CREATEBITMAP2D=339]="CREATEBITMAP2D",e[e.CREATEDOUBLEBITMAP2D=340]="CREATEDOUBLEBITMAP2D",e[e.GETSPACEORGY=341]="GETSPACEORGY",e[e.GETSPACEORGX=342]="GETSPACEORGX",e[e.SETSPACEORG2D=343]="SETSPACEORG2D",e[e.SETSCALESPACE2D=344]="SETSCALESPACE2D",e[e.GETSCALESPACE2D=345]="GETSCALESPACE2D",e[e.SNDPLAYSOUND=346]="SNDPLAYSOUND",e[e.GETBOTTOMOBJECT2D=347]="GETBOTTOMOBJECT2D",e[e.GETUPPEROBJECT2D=348]="GETUPPEROBJECT2D",e[e.GETOBJECTFROMZORDER2D=349]="GETOBJECTFROMZORDER2D",e[e.GETLOWEROBJECT2D=350]="GETLOWEROBJECT2D",e[e.GETTOPOBJECT2D=351]="GETTOPOBJECT2D",e[e.GETZORDER2D=352]="GETZORDER2D",e[e.OBJECTTOBOTTOM2D=353]="OBJECTTOBOTTOM2D",e[e.OBJECTTOTOP2D=354]="OBJECTTOTOP2D",e[e.SETZORDER2D=355]="SETZORDER2D",e[e.SWAPOBJECT2D=356]="SWAPOBJECT2D",e[e.SETBITMAPSRCRECT=357]="SETBITMAPSRCRECT",e[e.SETOBJECTATTRIBUTE2D=358]="SETOBJECTATTRIBUTE2D",e[e.GETOBJECTATTRIBUTE2D=359]="GETOBJECTATTRIBUTE2D",e[e.CREATEFONT2D=360]="CREATEFONT2D",e[e.CREATESTRING2D=361]="CREATESTRING2D",e[e.CREATETEXT2D=362]="CREATETEXT2D",e[e.CREATERASTERTEXT2D=363]="CREATERASTERTEXT2D",e[e.SETSHOWOBJECT2D=364]="SETSHOWOBJECT2D",e[e.SETLOGSTRING2D=365]="SETLOGSTRING2D",e[e.ADDGROUPITEM2D=366]="ADDGROUPITEM2D",e[e.CREATEGROUP2D=367]="CREATEGROUP2D",e[e.DELETEGROUP2D=368]="DELETEGROUP2D",e[e.DELGROUPITEM2D=369]="DELGROUPITEM2D",e[e.GETGROUPITEM2D=370]="GETGROUPITEM2D",e[e.GETGROUPITEMS2D=371]="GETGROUPITEMS2D",e[e.GETGROUPITEMSNUM2D=372]="GETGROUPITEMSNUM2D",e[e.ISGROUPCONTAINOBJECT2D=373]="ISGROUPCONTAINOBJECT2D",e[e.SETGROUPITEM2D=374]="SETGROUPITEM2D",e[e.SETGROUPITEMS2D=375]="SETGROUPITEMS2D",e[e.COPYTOCLIPBOARD2D=376]="COPYTOCLIPBOARD2D",e[e.PASTEFROMCLIPBOARD2D=377]="PASTEFROMCLIPBOARD2D",e[e.GETOBJECTNAME2D=378]="GETOBJECTNAME2D",e[e.SETOBJECTNAME2D=379]="SETOBJECTNAME2D",e[e.GETOBJECTFROMPOINT2D=380]="GETOBJECTFROMPOINT2D",e[e.GETLASTPRIMARY=381]="GETLASTPRIMARY",e[e.ROTATEOBJECT2D=382]="ROTATEOBJECT2D",e[e.SHOWOBJECT2D=383]="SHOWOBJECT2D",e[e.HIDEOBJECT2D=384]="HIDEOBJECT2D",e[e.STDHYPERJUMP=385]="STDHYPERJUMP",e[e.GETCHILDCOUNT=386]="GETCHILDCOUNT",e[e.GETCHILDIDBYNUM=387]="GETCHILDIDBYNUM",e[e.GETCHILDCLASS=389]="GETCHILDCLASS",e[e.VM_CREATECONTROL2D=390]="VM_CREATECONTROL2D",e[e.VM_GETCONTROLTEXT=391]="VM_GETCONTROLTEXT",e[e.VM_SETCONTROLTEXT=392]="VM_SETCONTROLTEXT",e[e.VM_CHECKDLGBUTTON=393]="VM_CHECKDLGBUTTON",e[e.VM_ISDLGBUTTONCHECKED=394]="VM_ISDLGBUTTONCHECKED",e[e.VM_ENABLECONTROL=395]="VM_ENABLECONTROL",e[e.SETBRUSHHATCH2D=396]="SETBRUSHHATCH2D",e[e.GETLOGSTRING2D=397]="GETLOGSTRING2D",e[e.V_GETCLASS=398]="V_GETCLASS",e[e.MESSAGE=400]="MESSAGE",e[e.GETBRUSHCOLOR2D=401]="GETBRUSHCOLOR2D",e[e.GETBRUSHROP2D=402]="GETBRUSHROP2D",e[e.GETBRUSHDIB2D=403]="GETBRUSHDIB2D",e[e.GETBRUSHSTYLE2D=404]="GETBRUSHSTYLE2D",e[e.GETBRUSHHATCH2D=405]="GETBRUSHHATCH2D",e[e.SETBRUSHCOLOR2D=406]="SETBRUSHCOLOR2D",e[e.SETBRUSHROP2D=407]="SETBRUSHROP2D",e[e.SETBRUSHDIB2D=408]="SETBRUSHDIB2D",e[e.SETBRUSHSTYLE2D=409]="SETBRUSHSTYLE2D",e[e.VM_ADDCHILDREN=410]="VM_ADDCHILDREN",e[e.VM_REMOVECHILDREN=411]="VM_REMOVECHILDREN",e[e.VM_CREATECLASS=412]="VM_CREATECLASS",e[e.VM_DELETECLASS=413]="VM_DELETECLASS",e[e.VM_OPENCLASSSCHEME=414]="VM_OPENCLASSSCHEME",e[e.VM_CLOSECLASSSCHEME=415]="VM_CLOSECLASSSCHEME",e[e.VM_CREATELINK=416]="VM_CREATELINK",e[e.VM_SETLINKVARS=417]="VM_SETLINKVARS",e[e.VM_REMOVELINK=418]="VM_REMOVELINK",e[e.VM_GETUNIQUCLASSNAME=419]="VM_GETUNIQUCLASSNAME",e[e.V_GETSCHEMEOBJECT=420]="V_GETSCHEMEOBJECT",e[e.V_CREATEWINDOWEX=421]="V_CREATEWINDOWEX",e[e.V_GETVARF=430]="V_GETVARF",e[e.V_GETVARS=431]="V_GETVARS",e[e.V_GETVARH=432]="V_GETVARH",e[e.V_SETVARF=433]="V_SETVARF",e[e.V_SETVARS=434]="V_SETVARS",e[e.V_SETVARH=435]="V_SETVARH",e[e.VM_CREATELINK2=436]="VM_CREATELINK2",e[e.VM_SETMODELTEXT=437]="VM_SETMODELTEXT",e[e.VM_GETMODELTEXT=438]="VM_GETMODELTEXT",e[e.VM_GETANGLEBYXY=439]="VM_GETANGLEBYXY",e[e.GETOBJECTFROMPOINT2DEX=440]="GETOBJECTFROMPOINT2DEX",e[e.VM_OPENVIDEO=441]="VM_OPENVIDEO",e[e.VM_CLOSEVIDEO=442]="VM_CLOSEVIDEO",e[e.VM_CREATEVIDEOFRAME2D=446]="VM_CREATEVIDEOFRAME2D",e[e.VM_VIDEOSETPOS=447]="VM_VIDEOSETPOS",e[e.VM_FRAMESETPOS2D=448]="VM_FRAMESETPOS2D",e[e.VM_VIDEOPLAY2D=449]="VM_VIDEOPLAY2D",e[e.VM_VIDEOPAUSE2D=450]="VM_VIDEOPAUSE2D",e[e.VM_VIDEORESUME2D=451]="VM_VIDEORESUME2D",e[e.VM_VIDEOSTOP2D=452]="VM_VIDEOSTOP2D",e[e.VM_SETVIDEOSRC2D=453]="VM_SETVIDEOSRC2D",e[e.VM_VIDEOGETPOS=454]="VM_VIDEOGETPOS",e[e.VM_FRAMEGETPOS=455]="VM_FRAMEGETPOS",e[e.VM_FRAMEGETHVIDEO=456]="VM_FRAMEGETHVIDEO",e[e.VM_BEGINWRITEVIDEO=457]="VM_BEGINWRITEVIDEO",e[e.VM_VIDEOCOMPRESSDIALOG=458]="VM_VIDEOCOMPRESSDIALOG",e[e.VM_WRITEFRAME=459]="VM_WRITEFRAME",e[e.SETCONTROLSTYLE2D=460]="SETCONTROLSTYLE2D",e[e.GETCONTROLSTYLE2D=461]="GETCONTROLSTYLE2D",e[e.LBADDSTRING=462]="LBADDSTRING",e[e.LBINSERTSTRING=463]="LBINSERTSTRING",e[e.LBGETSTRING=464]="LBGETSTRING",e[e.LBCLEARLIST=465]="LBCLEARLIST",e[e.LBDELETESTRING=466]="LBDELETESTRING",e[e.LBGETCOUNT=467]="LBGETCOUNT",e[e.LBGETSELINDEX=468]="LBGETSELINDEX",e[e.LBSETSELINDEX=469]="LBSETSELINDEX",e[e.LBGETCARETINDEX=470]="LBGETCARETINDEX",e[e.LBSETCARETINDEX=471]="LBSETCARETINDEX",e[e.LBFINDSTRING=472]="LBFINDSTRING",e[e.LBFINDSTRINGEXACT=473]="LBFINDSTRINGEXACT",e[e.GETPIXEL2D=474]="GETPIXEL2D",e[e.VM_GETTIME=475]="VM_GETTIME",e[e.PUSHPTR=476]="PUSHPTR",e[e.PUSHPTRNEW=477]="PUSHPTRNEW",e[e.VFUNCTION=478]="VFUNCTION",e[e.DLLFUNCTION=479]="DLLFUNCTION",e[e.GETELEMENT=480]="GETELEMENT",e[e.SETELEMENT=481]="SETELEMENT",e[e.EMPTYSPACE2D=482]="EMPTYSPACE2D",e[e.CREATEPOLYLINE2D=485]="CREATEPOLYLINE2D",e[e.VM_GETNAMEBYHANDLE=486]="VM_GETNAMEBYHANDLE",e[e.V_SETSPACELAYERS=487]="V_SETSPACELAYERS",e[e.V_GETSPACELAYERS=488]="V_GETSPACELAYERS",e[e.V_GETOBJECTLAYER2D=489]="V_GETOBJECTLAYER2D",e[e.V_SETOBJECTLAYER2D=490]="V_SETOBJECTLAYER2D",e[e.VM_SCMESSAGE=491]="VM_SCMESSAGE",e[e.VM_SETVARTODEF=492]="VM_SETVARTODEF",e[e.GETTEXTOBJECT2D=493]="GETTEXTOBJECT2D",e[e.GETTEXTSTRING2D=494]="GETTEXTSTRING2D",e[e.GETTEXTFONT2D=495]="GETTEXTFONT2D",e[e.VM_LOADOBJECTSTATE=496]="VM_LOADOBJECTSTATE",e[e.VM_SAVEOBJECTSTATE=497]="VM_SAVEOBJECTSTATE",e[e.VM_GETWINDOWPROP=498]="VM_GETWINDOWPROP",e[e.VM_CAMERAPROC=499]="VM_CAMERAPROC",e[e.DB_OPENBASE=500]="DB_OPENBASE",e[e.DB_OPENTABLE=501]="DB_OPENTABLE",e[e.DB_CLOSEBASE=502]="DB_CLOSEBASE",e[e.DB_CLOSETABLE=503]="DB_CLOSETABLE",e[e.DB_GETERROR=504]="DB_GETERROR",e[e.DB_GETERRORSTR=505]="DB_GETERRORSTR",e[e.DB_SETDIR=506]="DB_SETDIR",e[e.DB_CLOSEALLBASES=507]="DB_CLOSEALLBASES",e[e.DB_GOTOP=508]="DB_GOTOP",e[e.DB_GOBOTTOM=509]="DB_GOBOTTOM",e[e.DB_SKIP=510]="DB_SKIP",e[e.DB_GETFID=511]="DB_GETFID",e[e.DB_GETFSTR=512]="DB_GETFSTR",e[e.DB_SELECT=513]="DB_SELECT",e[e.DB_GETCOUNT=514]="DB_GETCOUNT",e[e.DB_BROWSE=515]="DB_BROWSE",e[e.DB_GETDOUBLE=516]="DB_GETDOUBLE",e[e.DB_GETFNAME=517]="DB_GETFNAME",e[e.DB_GETFTYPE=518]="DB_GETFTYPE",e[e.DB_INSERTRECORD=519]="DB_INSERTRECORD",e[e.DB_APPENDRECORD=520]="DB_APPENDRECORD",e[e.DB_DELETERECORD=521]="DB_DELETERECORD",e[e.DB_SETFIELD=522]="DB_SETFIELD",e[e.DB_SETFIELDNUM=523]="DB_SETFIELDNUM",e[e.DB_SSETFIELD=524]="DB_SSETFIELD",e[e.DB_SSETFIELDNUM=525]="DB_SSETFIELDNUM",e[e.DB_SGETDOUBLE=526]="DB_SGETDOUBLE",e[e.DB_SGETFSTR=527]="DB_SGETFSTR",e[e.DB_CREATETABLE=528]="DB_CREATETABLE",e[e.DB_ZAP=529]="DB_ZAP",e[e.DB_ADDINDEX=530]="DB_ADDINDEX",e[e.DB_DELETEINDEX=531]="DB_DELETEINDEX",e[e.DB_OPENINDEX=532]="DB_OPENINDEX",e[e.DB_SWITCHTOINDEX=533]="DB_SWITCHTOINDEX",e[e.DB_CLOSEINDEX=534]="DB_CLOSEINDEX",e[e.DB_REGENINDEX=535]="DB_REGENINDEX",e[e.DB_READBLOB=536]="DB_READBLOB",e[e.DB_WRITEBLOB=537]="DB_WRITEBLOB",e[e.DB_FREEBLOB=538]="DB_FREEBLOB",e[e.DB_PACKTABLE=539]="DB_PACKTABLE",e[e.DB_SORTTABLE=540]="DB_SORTTABLE",e[e.DB_GETDELMODE=541]="DB_GETDELMODE",e[e.DB_SETDELMODE=542]="DB_SETDELMODE",e[e.DB_SETCODEPAGE=543]="DB_SETCODEPAGE",e[e.DB_GETCODEPAGE=544]="DB_GETCODEPAGE",e[e.DB_LOCK=545]="DB_LOCK",e[e.DB_UNLOCK=546]="DB_UNLOCK",e[e.DB_UNDELETE=547]="DB_UNDELETE",e[e.DB_COPYTO=548]="DB_COPYTO",e[e.DB_SETTOKEY=549]="DB_SETTOKEY",e[e.DB_GETFCOUNT=550]="DB_GETFCOUNT",e[e.DB_SETWINTABLE=580]="DB_SETWINTABLE",e[e.DB_SETCONTROLTABLE=581]="DB_SETCONTROLTABLE",e[e.DB_RECNO=582]="DB_RECNO",e[e.VM_BDEMIN=500]="VM_BDEMIN",e[e.VM_BDEMAX=599]="VM_BDEMAX",e[e.VM_SENDMESSAGE=600]="VM_SENDMESSAGE",e[e.VM_SETIMAGENAME=601]="VM_SETIMAGENAME",e[e.VM_SETLOGTEXT2D=602]="VM_SETLOGTEXT2D",e[e.GETTEXTFG2D=603]="GETTEXTFG2D",e[e.GETTEXTBK2D=604]="GETTEXTBK2D",e[e.VM_DIALOG=605]="VM_DIALOG",e[e.VM_DIALOGEX=606]="VM_DIALOGEX",e[e.VM_GETLINK=607]="VM_GETLINK",e[e.VM_DIALOGEX2=608]="VM_DIALOGEX2",e[e.VM_GETRVALUE=609]="VM_GETRVALUE",e[e.VM_GETGVALUE=610]="VM_GETGVALUE",e[e.VM_GETBVALUE=611]="VM_GETBVALUE",e[e.VM_GETTOOLREF2D=612]="VM_GETTOOLREF2D",e[e.VM_GETNEXTTOOL2D=613]="VM_GETNEXTTOOL2D",e[e.VM_GETNEXTOBJECT=614]="VM_GETNEXTOBJECT",e[e.VM_GETOBJECTPOINT3D=635]="VM_GETOBJECTPOINT3D",e[e.VM_SETOBJECTPOINT3D=636]="VM_SETOBJECTPOINT3D",e[e.VM_SETPRIMITIVE3D=637]="VM_SETPRIMITIVE3D",e[e.VM_CREATEOBJECT3D=638]="VM_CREATEOBJECT3D",e[e.VM_DELPRIMITIVE3D=639]="VM_DELPRIMITIVE3D",e[e.VM_GETNUMPRIMITIVES3D=640]="VM_GETNUMPRIMITIVES3D",e[e.VM_ADDPRIMITIVE3D=641]="VM_ADDPRIMITIVE3D",e[e.VM_DELPOINT3D=642]="VM_DELPOINT3D",e[e.VM_GETNUMPOINTS3D=643]="VM_GETNUMPOINTS3D",e[e.VM_ADDOBJECTPOINT3D=644]="VM_ADDOBJECTPOINT3D",e[e.VM_SETMATRIX3D=645]="VM_SETMATRIX3D",e[e.VM_GETMATRIX3D=646]="VM_GETMATRIX3D",e[e.VM_TRANSFORMPOINTS3D=647]="VM_TRANSFORMPOINTS3D",e[e.VM_ROTATEPOINTS3D=648]="VM_ROTATEPOINTS3D",e[e.VM_GETOBJECTBASE3D=649]="VM_GETOBJECTBASE3D",e[e.VM_SETOBJECTBASE3D=650]="VM_SETOBJECTBASE3D",e[e.VM_GETBASE3D_2=651]="VM_GETBASE3D_2",e[e.VM_GETSPACE3D=652]="VM_GETSPACE3D",e[e.VM_GETDIM3D=653]="VM_GETDIM3D",e[e.VM_TRANSFORM3D=654]="VM_TRANSFORM3D",e[e.VM_ROTATE3D=655]="VM_ROTATE3D",e[e.VM_SETCOLOR3D=656]="VM_SETCOLOR3D",e[e.VM_CREATEDEFCAMERA3D=657]="VM_CREATEDEFCAMERA3D",e[e.VM_SWITCHTOCAMERA3D=658]="VM_SWITCHTOCAMERA3D",e[e.VM_GETACTIVECAMERA3D=659]="VM_GETACTIVECAMERA3D",e[e.VM_CREATESPACE3D=660]="VM_CREATESPACE3D",e[e.VM_DELETESPACE3D=661]="VM_DELETESPACE3D",e[e.VM_CREATEPROJECTION=662]="VM_CREATEPROJECTION",e[e.VM_GETPOINTS3D=663]="VM_GETPOINTS3D",e[e.VM_SETPOINTS3D=664]="VM_SETPOINTS3D",e[e.VM_GETCOLOR3D=665]="VM_GETCOLOR3D",e[e.VM_SETCURRENTOBJ2D=666]="VM_SETCURRENTOBJ2D",e[e.VM_GETCURRENTOBJ2D=667]="VM_GETCURRENTOBJ2D",e[e.VM_MAKEFACE3D=668]="VM_MAKEFACE3D",e[e.VM_FITTOCAMERA3D=669]="VM_FITTOCAMERA3D",e[e.VM_CREATEMATERIAL=670]="VM_CREATEMATERIAL",e[e.PUSHCRDSYSTEM3D=671]="PUSHCRDSYSTEM3D",e[e.POPCRDSYSTEM3D=672]="POPCRDSYSTEM3D",e[e.SELECTLOCALCRD3D=673]="SELECTLOCALCRD3D",e[e.SELECTWORLDCRD3D=674]="SELECTWORLDCRD3D",e[e.SELECTVIEWCRD3D=675]="SELECTVIEWCRD3D",e[e.VM_TRCAMERA3D=676]="VM_TRCAMERA3D",e[e.VM_SETCOLORS3D=677]="VM_SETCOLORS3D",e[e.VM_GETCOLORS3D=678]="VM_GETCOLORS3D",e[e.VM_GETMATERIALs=679]="VM_GETMATERIALs",e[e.VM_new=700]="VM_new",e[e.VM_delete=701]="VM_delete",e[e.VM_VCLEARALL=702]="VM_VCLEARALL",e[e.VM_VINSERT=703]="VM_VINSERT",e[e.VM_VDELETE=704]="VM_VDELETE",e[e.VM_VGETCOUNT=705]="VM_VGETCOUNT",e[e.VM_VGETTYPE=706]="VM_VGETTYPE",e[e.VM_VGETf=707]="VM_VGETf",e[e.VM_VGETs=708]="VM_VGETs",e[e.VM_VGETh=709]="VM_VGETh",e[e.VM_VSETf=710]="VM_VSETf",e[e.VM_VSETs=711]="VM_VSETs",e[e.VM_VSETh=712]="VM_VSETh",e[e.VM_GETCONTROLTEXTH=713]="VM_GETCONTROLTEXTH",e[e.VM_SETCONTROLTEXTH=714]="VM_SETCONTROLTEXTH",e[e.VM_LOADPROJECT=720]="VM_LOADPROJECT",e[e.VM_UNLOADPROJECT=721]="VM_UNLOADPROJECT",e[e.VM_SETACTIVEPROJECT=722]="VM_SETACTIVEPROJECT",e[e.VM_ISPROJECTEXIST=723]="VM_ISPROJECTEXIST",e[e.VM_EXECUTEPROJECT=724]="VM_EXECUTEPROJECT",e[e.VM_SETPROJECTPROP=725]="VM_SETPROJECTPROP",e[e.VM_GETPROJECTPROP=726]="VM_GETPROJECTPROP",e[e.VM_GETPROJECTPROPS=727]="VM_GETPROJECTPROPS",e[e.VM_APPLYTEXTUTRE=728]="VM_APPLYTEXTUTRE",e[e.VM_REMOVETEXTURE=729]="VM_REMOVETEXTURE",e[e.VM_CREATEDIR=730]="VM_CREATEDIR",e[e.VM_DELETEDIR=731]="VM_DELETEDIR",e[e.VM_FILERENAME=732]="VM_FILERENAME",e[e.VM_FILECOPY=733]="VM_FILECOPY",e[e.VM_FILEEXIST=734]="VM_FILEEXIST",e[e.VM_FILEDELETE=735]="VM_FILEDELETE",e[e.VM_GETFILELIST=736]="VM_GETFILELIST",e[e.VM_GETACTUALSIZE=737]="VM_GETACTUALSIZE",e[e.VM_SETBKBRUSH=738]="VM_SETBKBRUSH",e[e.VM_GETBKBRUSH=739]="VM_GETBKBRUSH",e[e.VM_DIFF1=740]="VM_DIFF1",e[e.VM_EQUATION=741]="VM_EQUATION",e[e.VM_DIFF2=742]="VM_DIFF2",e[e.VM_DEQUATION=743]="VM_DEQUATION",e[e.VM_GETDIBOBJECT2D=744]="VM_GETDIBOBJECT2D",e[e.VM_SETDIBOBJECT2D=745]="VM_SETDIBOBJECT2D",e[e.VM_GETDDIBOBJECT2D=746]="VM_GETDDIBOBJECT2D",e[e.VM_SETDDIBOBJECT2D=747]="VM_SETDDIBOBJECT2D",e[e.VM_GETDATE=748]="VM_GETDATE",e[e.VM_VIDEOGETMARKER=749]="VM_VIDEOGETMARKER",e[e.VM_GETVARINFO=750]="VM_GETVARINFO",e[e.VM_GETVARCOUNT=751]="VM_GETVARCOUNT",e[e.VM_VSTORE=752]="VM_VSTORE",e[e.VM_VLOAD=753]="VM_VLOAD",e[e.GETBITMAPSRCRECT=754]="GETBITMAPSRCRECT",e[e.VM_SETHYPERJUMP=755]="VM_SETHYPERJUMP",e[e.SETRDIB2D=756]="SETRDIB2D",e[e.SSETRDDIB2D=757]="SSETRDDIB2D",e[e.GETRDIB2D=758]="GETRDIB2D",e[e.GETRDDIB2D=759]="GETRDDIB2D",e[e.V_MSORT=760]="V_MSORT",e[e.VM_DUPLICATEOBJECT3D=761]="VM_DUPLICATEOBJECT3D",e[e.VM_CHECKMENU=762]="VM_CHECKMENU",e[e.VM_ENABLEMENU=763]="VM_ENABLEMENU",e[e.PLUS_STRING_FLOAT=770]="PLUS_STRING_FLOAT",e[e.PLUS_FLOAT_STRING=771]="PLUS_FLOAT_STRING",e[e.VM_GETSCREENWIDTH=772]="VM_GETSCREENWIDTH",e[e.VM_GETSCREENHEIGHT=773]="VM_GETSCREENHEIGHT",e[e.VM_GETWORKAREAX=774]="VM_GETWORKAREAX",e[e.VM_GETWORKAREAY=775]="VM_GETWORKAREAY",e[e.VM_GETWORKAREAWIDTH=776]="VM_GETWORKAREAWIDTH",e[e.VM_GETWORKAREAHEIGHT=777]="VM_GETWORKAREAHEIGHT",e[e.VM_GETKEYBOARDLAYOUT=778]="VM_GETKEYBOARDLAYOUT",e[e.VM_SUBSTR1_STRING=779]="VM_SUBSTR1_STRING",e[e.VM_SETBRUSHOBJECT2D_HANDLE=780]="VM_SETBRUSHOBJECT2D_HANDLE",e[e.VM_SETPENOBJECT2D_HANDLE=781]="VM_SETPENOBJECT2D_HANDLE",e[e.VM_SETWINDOWTRANSPARENT=782]="VM_SETWINDOWTRANSPARENT",e[e.VM_SETWINDOWTRANSPARENT_H=793]="VM_SETWINDOWTRANSPARENT_H",e[e.VM_SETWINDOWTRANSPARENTCOLOR=783]="VM_SETWINDOWTRANSPARENTCOLOR",e[e.VM_SETWINDOWTRANSPARENTCOLOR_H=794]="VM_SETWINDOWTRANSPARENTCOLOR_H",e[e.VM_SETWINDOWREGION=784]="VM_SETWINDOWREGION",e[e.VM_SETWINDOWREGION_H=795]="VM_SETWINDOWREGION_H",e[e.VM_GETTITLEHEIGHT=785]="VM_GETTITLEHEIGHT",e[e.VM_GETSMALLTITLEHEIGHT=786]="VM_GETSMALLTITLEHEIGHT",e[e.VM_GETFIXEDFRAMEHEIGHT=787]="VM_GETFIXEDFRAMEHEIGHT",e[e.VM_GETFIXEDFRAMEWIDTH=788]="VM_GETFIXEDFRAMEWIDTH",e[e.VM_GETSIZEFRAMEHEIGHT=789]="VM_GETSIZEFRAMEHEIGHT",e[e.VM_GETSIZEFRAMEWIDTH=790]="VM_GETSIZEFRAMEWIDTH",e[e.VM_WINDOWINTASKBAR_H=791]="VM_WINDOWINTASKBAR_H",e[e.VM_WINDOWINTASKBAR_S=792]="VM_WINDOWINTASKBAR_S",e[e.VM_SHOWCURSOR=796]="VM_SHOWCURSOR",e[e.VM_SCREENSHOT=797]="VM_SCREENSHOT",e[e.VM_SCREENSHOT_FULL=842]="VM_SCREENSHOT_FULL",e[e.VM_SCREENSHOT_DESKTOP=844]="VM_SCREENSHOT_DESKTOP",e[e.VM_SCREENSHOT_DESKTOP_FULL=845]="VM_SCREENSHOT_DESKTOP_FULL",e[e.VM_LOCKOBJECT2D=798]="VM_LOCKOBJECT2D",e[e.VM_GETVARINFOFULL=799]="VM_GETVARINFOFULL",e[e.VM_INCREMENT_AFTER=800]="VM_INCREMENT_AFTER",e[e.VM_SENDSMS=841]="VM_SENDSMS",e[e.VM_SENDMAIL=843]="VM_SENDMAIL",e[e.VM_GETFONTNAME2D=846]="VM_GETFONTNAME2D",e[e.VM_GETFONTSIZE2D=847]="VM_GETFONTSIZE2D",e[e.VM_GETTEXTCOUNT2D=848]="VM_GETTEXTCOUNT2D",e[e.VM_GETFONTSTYLE2D=849]="VM_GETFONTSTYLE2D",e[e.VM_SETFONTSIZE2D=850]="VM_SETFONTSIZE2D",e[e.VM_SETFONTSTYLE2D=851]="VM_SETFONTSTYLE2D",e[e.VM_SETFONTNAME2D=852]="VM_SETFONTNAME2D",e[e.VM_GETTEXTSTRING2D_I=853]="VM_GETTEXTSTRING2D_I",e[e.VM_GETTEXTFONT2D_I=854]="VM_GETTEXTFONT2D_I",e[e.VM_GETTEXTFG2D_I=855]="VM_GETTEXTFG2D_I",e[e.VM_GETTEXTBG2D_I=856]="VM_GETTEXTBG2D_I",e[e.VM_SETTEXTSTRING2D_I=857]="VM_SETTEXTSTRING2D_I",e[e.VM_SETTEXTFONT2D_I=858]="VM_SETTEXTFONT2D_I",e[e.VM_SETTEXTFG2D_I=859]="VM_SETTEXTFG2D_I",e[e.VM_SETTEXTBG2D_I=860]="VM_SETTEXTBG2D_I",e[e.VM_SETTEXT2D_I=861]="VM_SETTEXT2D_I",e[e.VM_CREATEFONT2DPT=862]="VM_CREATEFONT2DPT",e[e.VM_SETSTANDARTCURSOR=863]="VM_SETSTANDARTCURSOR",e[e.VM_SETSTANDARTCURSOR_S=864]="VM_SETSTANDARTCURSOR_S",e[e.VM_LOADCURSOR=865]="VM_LOADCURSOR",e[e.VM_LOADCURSOR_S=866]="VM_LOADCURSOR_S",e[e.VM_INC=867]="VM_INC",e[e.VM_INC_STEP=868]="VM_INC_STEP",e[e.VM_DEC=869]="VM_DEC",e[e.VM_DEC_STEP=870]="VM_DEC_STEP",e[e.VM_LIMIT=871]="VM_LIMIT",e[e.VM_GETFONTLIST=872]="VM_GETFONTLIST",e[e.VM_VSORT=873]="VM_VSORT",e[e.VM_VSORT_ASC=874]="VM_VSORT_ASC",e[e.VM_VSORT_DIFFERENT=875]="VM_VSORT_DIFFERENT",e[e.VM_GETUSERKEYVALUE=876]="VM_GETUSERKEYVALUE",e[e.VM_GETUSERKEYFULLVALUE=877]="VM_GETUSERKEYFULLVALUE",e[e.VM_SENDUSERRESULT=879]="VM_SENDUSERRESULT",e[e.VM_COPYUSERRESULT=880]="VM_COPYUSERRESULT",e[e.VM_USERKEYISAUTORIZED=889]="VM_USERKEYISAUTORIZED",e[e.VM_USERKEYISAUTORIZED_UK=890]="VM_USERKEYISAUTORIZED_UK",e[e.VM_READUSERKEY=883]="VM_READUSERKEY",e[e.VM_READPROJECTKEY=888]="VM_READPROJECTKEY",e[e.VM_GETUSERKEYVALUE_UK=884]="VM_GETUSERKEYVALUE_UK",e[e.VM_GETUSERKEYFULLVALUE_UK=885]="VM_GETUSERKEYFULLVALUE_UK",e[e.VM_SENDUSERRESULT_UK=886]="VM_SENDUSERRESULT_UK",e[e.VM_COPYUSERRESULT_UK=887]="VM_COPYUSERRESULT_UK",e[e.VM_GETTEMPDIRECTORY=878]="VM_GETTEMPDIRECTORY",e[e.VM_GETROMDRIVENAMES=881]="VM_GETROMDRIVENAMES",e[e.VM_SHELLWAIT=882]="VM_SHELLWAIT",e[e.VM_SETCONTROLFONT=1101]="VM_SETCONTROLFONT",e[e.VM_SETCONTROLTEXTCOLOR=1102]="VM_SETCONTROLTEXTCOLOR",e[e.VM_GETCONTROLTEXTLENGTH=1103]="VM_GETCONTROLTEXTLENGTH",e[e.VM_GETCONTROLTEXTPART=1104]="VM_GETCONTROLTEXTPART",e[e.VM_ADDCONTROLTEXT=1105]="VM_ADDCONTROLTEXT",e[e.VM_INSERTCONTROLTEXT=1106]="VM_INSERTCONTROLTEXT",e[e.VM_SETWINDOWOWNER=1107]="VM_SETWINDOWOWNER",e[e.VM_SETWINDOWPARENT=1108]="VM_SETWINDOWPARENT",e[e.VM_GETPROJECTCLASSES=1109]="VM_GETPROJECTCLASSES",e[e.VM_GETCLASSFILE=1110]="VM_GETCLASSFILE",e[e.VM_INSERTTEXT2D=1111]="VM_INSERTTEXT2D",e[e.VM_REMOVETEXT2D=1112]="VM_REMOVETEXT2D",e[e.VM_ADDTEXT2D=1113]="VM_ADDTEXT2D",e[e.VM_LBGETSELINDEXS=1114]="VM_LBGETSELINDEXS",e[e.VM_SETSTRINGBUFFERMODE=1115]="VM_SETSTRINGBUFFERMODE",e[e.VM_SETMODELTEXTWITHOUTERROR=1116]="VM_SETMODELTEXTWITHOUTERROR",e[e.VM_SENDSMSWAIT=1117]="VM_SENDSMSWAIT",e[e.VM_SENDMAILWAIT=1118]="VM_SENDMAILWAIT",e[e.VM_SETCONTROLFOCUS=1119]="VM_SETCONTROLFOCUS",e[e.VM_DBSQLH=1120]="VM_DBSQLH",e[e.VM_SETOBJECTALPHA2D=1121]="VM_SETOBJECTALPHA2D",e[e.VM_GETOBJECTALPHA2D=1122]="VM_GETOBJECTALPHA2D",e[e.VM_SETBRUSHPOINTS2D=1123]="VM_SETBRUSHPOINTS2D",e[e.VM_SETBRUSHCOLORS2D=1124]="VM_SETBRUSHCOLORS2D",e[e.VM_SETPIXEL2D=1125]="VM_SETPIXEL2D",e[e.VM_ENCRYPTSTREAM=1126]="VM_ENCRYPTSTREAM",e[e.VM_SENDDATA=1127]="VM_SENDDATA",e[e.VM_DECRYPTSTREAM=1128]="VM_DECRYPTSTREAM",e[e.VM_ROUNDT=1129]="VM_ROUNDT",e[e.VM_SETSPACERENDERERENGINE2D=1130]="VM_SETSPACERENDERERENGINE2D",e[e.VM_AUDIOOPENDEVICE=801]="VM_AUDIOOPENDEVICE",e[e.VM_AUDIOOPENSOUND=802]="VM_AUDIOOPENSOUND",e[e.VM_AUDIOPLAY=803]="VM_AUDIOPLAY",e[e.VM_AUDIOSTOP=804]="VM_AUDIOSTOP",e[e.VM_AUDIOISPLAYING=805]="VM_AUDIOISPLAYING",e[e.VM_AUDIORESET=806]="VM_AUDIORESET",e[e.VM_AUDIOSETREPEAT=807]="VM_AUDIOSETREPEAT",e[e.VM_AUDIOGETREPEAT=808]="VM_AUDIOGETREPEAT",e[e.VM_AUDIOSETVOLUME=809]="VM_AUDIOSETVOLUME",e[e.VM_AUDIOGETVOLUME=810]="VM_AUDIOGETVOLUME",e[e.VM_AUDIOSETBALANCE=811]="VM_AUDIOSETBALANCE",e[e.VM_AUDIOGETBALANCE=812]="VM_AUDIOGETBALANCE",e[e.VM_AUDIOSETTONE=813]="VM_AUDIOSETTONE",e[e.VM_AUDIOGETTONE=814]="VM_AUDIOGETTONE",e[e.VM_AUDIOISSEEKABLE=815]="VM_AUDIOISSEEKABLE",e[e.VM_AUDIOSETPOSITION=816]="VM_AUDIOSETPOSITION",e[e.VM_AUDIOGETPOSITION=817]="VM_AUDIOGETPOSITION",e[e.VM_AUDIOGETLENGTH=818]="VM_AUDIOGETLENGTH",e[e.VM_AUDIODELETESOUND=819]="VM_AUDIODELETESOUND",e[e.VM_AUDIODELETEDEVICE=820]="VM_AUDIODELETEDEVICE",e[e.VM_MAXIMUM_code=1600]="VM_MAXIMUM_code"})(y||(y={}));const Jr=new Array(y.VM_MAXIMUM_code);(function(){function e(t,r){if(Jr[t])throw"Operand already set: "+t;Jr[t]=r}e(y.PUSH_FLOAT_const,"double"),e(y.vmPUSH_LONG_const,"long"),e(y.PUSH_STRING_CONST,"string"),e(y.V_JMP,"codepoint"),e(y.V_JNZ,"codepoint"),e(y.V_JZ,"codepoint"),e(y.V_JNZ_HANDLE,"codepoint"),e(y.V_JZ_HANDLE,"codepoint"),e(y.PUSH_FLOAT,"varId"),e(y._PUSH_FLOAT,"varId"),e(y._POP_FLOAT,"varId"),e(y._POP_FLOAT_OLD,"varId"),e(y.vmPUSH_LONG,"varId"),e(y.vm_PUSH_LONG,"varId"),e(y.vm_POP_LONG,"varId"),e(y.vm_POP_LONG_OLD,"varId"),e(y.PUSH_STRING,"varId"),e(y._PUSH_STRING,"varId"),e(y._POP_STRING,"varId"),e(y._POP_STRING_OLD,"varId"),e(y.PUSHPTR,"varId"),e(y.PUSHPTRNEW,"varId"),e(y.V_SYSTEM,"argCount"),e(y.CREATEGROUP2D,"argCount"),e(y.VM_SENDMESSAGE,"argCount"),e(y.SETGROUPITEMS2D,"argCount"),e(y.CREATEPOLYLINE2D,"argCount"),e(y.VM_ADDPRIMITIVE3D,"argCount"),e(y.VFUNCTION,"funcSignature"),e(y.DLLFUNCTION,"dllFuncSignature")})();const qi=new Uint8Array(2);function Dp(e){const t=e.popDouble();e.pushDouble(qi[t])}function Op(e){e.executionStopped=!0}const Ip={1:"AboutDialog",2:"\u0412\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043D\u043E\u043C\u0435\u0440 \u0432\u0435\u0440\u0441\u0438\u0438 \u043F\u043E\u0441\u0442\u0440\u043E\u0439\u043A\u0438",3:"\u0414\u0438\u0430\u043B\u043E\u0433 \u0441 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0435\u0439 \u043E \u0441\u0438\u0441\u0442\u0435\u043C\u0435",4:"\u0427\u0438\u0441\u043B\u043E \u0448\u0430\u0433\u043E\u0432 \u0441 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0433\u043E \u0437\u0430\u043F\u0443\u0441\u043A\u0430",6:"\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0432\u0441\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430\u043B\u044C\u043D\u044B\u0435 \u043F\u0430\u043D\u0435\u043B\u0438 (0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)",8:`\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0441\u0442\u0440\u043E\u043A\u0443 \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F( 0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C
        1 - \u0441\u0432\u0435\u0440\u0445\u0443
        2 - \u0441\u043D\u0438\u0437\u0443)`,10:"\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0435 \u043C\u0435\u043D\u044E ( 0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)",20:`\u041F\u0440\u044F\u0447\u0435\u0442 \u0438\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442 \u0432\u0441\u0435 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B (\u0441\u0442\u0440\u043E\u043A\u0430
        \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F, \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430\u043B\u044C\u043D\u044B\u0435 \u043F\u0430\u043D\u0435\u043B\u0438 , \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0435 \u043C\u0435\u043D\u044E).
        \u0421\u0442\u0440\u043E\u043A\u0430 \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u0441\u043D\u0438\u0437\u0443.
        (0 - \u0441\u043F\u0440\u044F\u0442\u0430\u0442\u044C 1 - \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C)`,21:`Float(Hspace),
        Float(Hobject)
        \u0412\u044B\u0437\u043E\u0432 \u0434\u0438\u0430\u043B\u043E\u0433\u0430 \u0441\u043E \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430\u043C\u0438 \u0434\u0432\u0443\u0445\u043C\u0435\u0440\u043D\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430`,22:`Float(Hspace),
        Float(Hobject)
        \u0412\u044B\u0437\u043E\u0432 \u0434\u0438\u0430\u043B\u043E\u0433\u0430 \u0441\u043E \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430\u043C\u0438 \u0442\u0440\u0435\u0445\u043C\u0435\u0440\u043D\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430`};function Rp(e,t){const r=new Array(t);for(let n=t-1;n>=0;n--)r[n]=e.popDouble();const i=e.popDouble();console.warn(`\u0412\u044B\u0437\u043E\u0432 System(${i}, ${r})
${Ip[i]}`),e.pushDouble(1)}function jp(e){e.pushString(e.project.getClassDirectory(e.popString()))}function kp(e){e.pushDouble(e.project.isFileExist(e.popString()))}function Lp(e){const t=e.popString();e.pushString(t[t.length-1]==="\\"?t:t+"\\")}function zt(e,t,r){e.memoryManager.newDoubleValues[e.classVars.globalIds[t]]=r}function Xt(e,t,r){e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]]=r}function Np(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.popLong(),s=e.popLong(),o=new Date;t?zt(e,r,o.getDate()):Xt(e,r,o.getDate()),i?zt(e,n,o.getMonth()):Xt(e,n,o.getMonth()),a?zt(e,s,o.getFullYear()):Xt(e,s,o.getFullYear())}function Pp(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.popLong(),s=e.popLong(),o=e.popLong(),c=e.popLong(),l=new Date;t?zt(e,r,l.getMilliseconds()*.1):Xt(e,r,l.getMilliseconds()),i?zt(e,n,l.getSeconds()):Xt(e,n,l.getSeconds()),a?zt(e,s,l.getMinutes()):Xt(e,s,l.getMinutes()),o?zt(e,c,l.getHours()):Xt(e,c,l.getHours())}function Mp(e){e.pushDouble(e.windows.screenWidth)}function Bp(e){e.pushDouble(e.windows.screenHeight)}function Fp(e){e.pushDouble(e.windows.areaOriginX)}function Gp(e){e.pushDouble(e.windows.areaOriginY)}function Vp(e){e.pushDouble(e.windows.areaWidth)}function Up(e){e.pushDouble(e.windows.areaHeight)}const Hp=new Date().getTime();function Wp(e){e.pushDouble(new Date().getTime()-Hp)}function zp(e){const t=e.popDouble(),r=e.popLong(),i=e.popDouble(),n=e.popDouble(),a=e.popLong(),s=e.windows.getSpace(a);if(!s)return;const o=s.getObject(r);if(!o)return;console.warn(`\u0412\u044B\u0437\u043E\u0432 StdHyperJump(${a}, ${n}, ${i}, ${r}, ${t})`)}function Vc(e){e(y.GETAKEYSTATE,Dp),e(y.V_CLOSEALL,Op),e(y.V_SYSTEM,Rp),e(y.VM_GETSCREENWIDTH,Mp),e(y.VM_GETSCREENHEIGHT,Bp),e(y.VM_GETWORKAREAX,Fp),e(y.VM_GETWORKAREAY,Gp),e(y.VM_GETWORKAREAWIDTH,Vp),e(y.VM_GETWORKAREAHEIGHT,Up),e(y.GETCLASSDIR,jp),e(y.VM_FILEEXIST,kp),e(y.ADDSLASH,Lp),e(y.VM_GETDATE,Np),e(y.VM_GETTIME,Pp),e(y.GETTICKCOUNT,Wp),e(y.STDHYPERJUMP,zp)}const Hc=Dt(pr()),Uc={selection:!1,preserveObjectStacking:!0,renderOnAddRemove:!1},mr={selectable:!1,hoverCursor:"pointer"};class Da{constructor({handle:e,isVisible:t,selectable:r,position:i,scale:n,bmpOrigin:a,bmpSize:s,bmpTool:o},c,l){this.viewRef=c;this.requestRedraw=l;this.type="bitmap";this.handle=e,this.posX=i.x,this.posY=i.y,this.visible=t,this.imageLoaded=!!o.image;const h=Q(Q({},mr),{left:i.x-c.x,top:i.y-c.y,cropX:a&&a.x,cropY:a&&a.y,width:s.x,height:s.y,scaleX:n?n.x:1,scaleY:n?n.y:1,visible:t&&this.imageLoaded});this.selectable=r,this.obj=new Hc.fabric.Image(o.image,h),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){const e=this.imageLoaded;this.obj.set({visible:e}),this.visible=e,this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.visible=!1,this.requestRedraw()}updateBitmap(e){this.imageLoaded=!!e.image;const{cropX:t,cropY:r,width:i,height:n,scaleX:a,scaleY:s}=this.obj,o=this.visible&&this.imageLoaded;this.obj.setElement(e.image).set({cropX:t,cropY:r,width:i,height:n,scaleX:a,scaleY:s,visible:o}).setCoords(),this.requestRedraw()}setRect(e,t,r,i){this.obj.set({cropX:e,cropY:t,width:r,height:i}),this.requestRedraw()}}const gr=Dt(pr());function Wc(e){if(!e)return;switch(e.fillType){case"SOLID":return Xe(e.color);case"PATTERN":const t=e.bmpTool;return t&&t.image?new gr.fabric.Pattern({source:t.image}):"white";default:return}}class br{constructor({handle:e,points:t,position:r,isVisible:i,selectable:n,brush:a,pen:s},o,c){this.viewRef=o;this.requestRedraw=c;this.type="line";this.handle=e,this.posX=r.x,this.posY=r.y;const l=Q(Q({},mr),{left:r.x-o.x,top:r.y-o.y,fill:Wc(a),stroke:s&&s.style!=="NULL"?Xe(s.color):void 0,strokeWidth:s?s.width||.5:0,visible:i});this.selectable=a?n:!1,this.obj=new gr.fabric.Polyline(t,l),this.visibleArea=br.calcSize(t).size}static calcSize(e){const t=e.length>0?e.reduce((r,i)=>({minX:Math.min(r.minX,i.x),maxX:Math.max(r.maxX,i.x),minY:Math.min(r.minY,i.y),maxY:Math.max(r.maxY,i.y)}),{minX:e[0].x,maxX:e[0].x,minY:e[0].y,maxY:e[0].y}):{minX:0,maxX:0,minY:0,maxY:0};return{position:{x:t.minX,y:t.minY},size:{x:t.maxX-t.minX,y:t.maxY-t.minY}}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){this.visibleArea={x:e,y:t},this.obj.set({scaleX:e/this.obj.width,scaleY:t/this.obj.height}).setCoords(),this.requestRedraw()}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updatePen(e){this.obj.set({strokeWidth:e.width,stroke:Xe(e.color)}),this.requestRedraw()}updateBrush(e){this.obj.set({fill:Wc(e)}),this.requestRedraw()}setPointPosition(e,t,r){this.obj.points[e]=new gr.fabric.Point(t,r),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:n}=br.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}addPoint(e,t,r){e<0?this.obj.points.push(new gr.fabric.Point(t,r)):this.obj.points.splice(e,0,new gr.fabric.Point(t,r)),this.obj.set({dirty:!0,objectCaching:!1}).setCoords();const{size:i,position:n}=br.calcSize(this.obj.points);this.visibleArea=i,this.requestRedraw()}}const zc=Dt(pr());class Oa{constructor({handle:e,isVisible:t,selectable:r,position:i,angle:n,textTool:a},s,o){this.viewRef=s;this.requestRedraw=o;this.type="text";this.handle=e,this.posX=i.x,this.posY=i.y;const{text:c,size:l}=a.assembledText,h=a.getFragment(0),u=Q(Q({},mr),{left:i.x-s.x,top:i.y-s.y,angle:-(n||0)*.1,backgroundColor:Xe(h.backgroundColor),fill:Xe(h.foregroundColor),fontWeight:h.font.bold?"bold":"normal",fontFamily:h.font.name,visible:t,fontSize:l});this.selectable=r,this.obj=new zc.fabric.Text(c,u),this.visibleArea={x:this.obj.width||0,y:this.obj.height||0}}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.obj.set({left:e-r.x,top:t-r.y}).setCoords()}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.obj.set({left:e-r,top:t-i}).setCoords(),this.posX=e,this.posY=t,this.requestRedraw()}scaleTo(e,t){}setAngle(e){this.obj.set({angle:e}).setCoords(),this.requestRedraw()}testIntersect(e,t){if(!this.obj.visible)return!1;const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.obj.set({visible:!0}),this.requestRedraw()}hide(){this.obj.set({visible:!1}),this.requestRedraw()}updateTextTool(e){const{text:t,size:r}=e.assembledText,i=e.getFragment(0);this.obj.set({text:t,fontSize:r,backgroundColor:Xe(i.backgroundColor),fill:Xe(i.foregroundColor),fontWeight:i.font.bold?"bold":"normal",fontFamily:i.font.name}),this.requestRedraw()}}class Xc{constructor({handle:e,isVisible:t,position:r,classname:i,controlSize:n,text:a},s,o){this.viewRef=s;this.type="control";if(i!=="Edit")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0432\u0432\u043E\u0434\u0430 \u0442\u0438\u043F\u0430 "${i}" \u043F\u043E\u043A\u0430 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F`);this.handle=e,this.posX=r.x,this.posY=r.y,this.selectable=!1,this.visibleArea=Q({},n),this.inp=o.textInput({x:r.x-s.x,y:r.y-s.y,width:n.x,height:n.y,hidden:!t,text:a})}getVisibleAreaSize(){return this.visibleArea}updateAfterViewTranslate(){const{posX:e,posY:t,viewRef:r}=this;this.inp.set({x:e-r.x,y:t-r.y})}setPosition(e,t){const{x:r,y:i}=this.viewRef;this.inp.set({x:e-r,y:t-i}),this.posX=e,this.posY=t}scaleTo(e,t){}setAngle(e){}testIntersect(e,t){const r=e-this.posX,i=t-this.posY;return r>0&&r<=this.visibleArea.x&&i>0&&i<=this.visibleArea.y}show(){this.inp.set({hidden:!1})}hide(){this.inp.set({hidden:!0})}onChange(e){this.inp.onEdit(e)}setText(e){this.inp.set({text:e})}getText(){return this.inp.text}destroyHtml(){this.inp.destroy()}}const Xp=[Se.WM_LBUTTONDOWN,Se.WM_MBUTTONDOWN,Se.WM_RBUTTONDOWN],Yp=[Se.WM_LBUTTONUP,Se.WM_MBUTTONUP,Se.WM_RBUTTONUP];class Ra{constructor(e,t){this.wnd=t;this.objects=ne.create();this.objectsByZReversed=[];this.view={x:0,y:0};this.shouldRedraw=!1;this.mouseSubs=new Set;this.controlsubs=new Set;this.prevWidth=0;this.prevHeight=0;this.prevWidth=t.width,this.prevWidth=t.height,this.canvas=new Ia.fabric.StaticCanvas(e,Q(Q({},Uc),{width:this.prevWidth,height:this.prevHeight}))}requestRedraw(){this.shouldRedraw=!0}assertNoObject(e){if(this.objects.has(e))throw new ge(`\u041E\u0431\u044A\u0435\u043A\u0442 #${e} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`)}createLine(e){this.assertNoObject(e.handle);const t=new br(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createText(e){this.assertNoObject(e.handle);const t=new Oa(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createBitmap(e){this.assertNoObject(e.handle);const t=new Da(e,this.view,()=>this.requestRedraw());return this.objects.set(e.handle,t),t}createControl(e){this.assertNoObject(e.handle);const t=new Xc(e,this.view,this.wnd);return t.onChange(()=>{this.controlsubs.forEach(r=>r(Se.WM_CONTROLNOTIFY,e.handle)),this.requestRedraw()}),this.objects.set(e.handle,t),t}updateBrush(e){const{bmpTool:t,color:r}=e;t&&t.image?this.canvas.backgroundImage=new Ia.fabric.Image(t.image):this.canvas.backgroundColor=Xe(r),this.requestRedraw()}placeObjects(e){const t=[];for(const r of e){const i=this.objects.get(r);if(!i)throw new ge(`\u041E\u0431\u044A\u0435\u043A\u0442 #${r} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0446\u0435\u043D\u0435`);i.type!=="control"&&this.canvas.add(i.obj),t.push(i)}this.objectsByZReversed=t.reverse().concat(this.objectsByZReversed),this.requestRedraw()}appendObjectToEnd(e){e.type!=="control"&&this.canvas.add(e.obj),this.objectsByZReversed=[e].concat(this.objectsByZReversed),this.requestRedraw()}moveObjectToTop(e){e.type!=="control"&&e.obj.bringToFront();const t=this.objectsByZReversed;this.objectsByZReversed=[e].concat(t.filter(r=>r!==e)),this.requestRedraw()}moveObjectRangeToTop(e){const t=[];for(const i of this.objectsByZReversed.reverse())e.includes(i)&&(i.type!=="control"&&i.obj.bringToFront(),t.push(i));const r=this.objectsByZReversed;this.objectsByZReversed=t.reverse().concat(r.filter(i=>!t.includes(i))),this.requestRedraw()}removeObject(e){e.type==="control"?e.destroyHtml():this.canvas.remove(e.obj),this.objects.delete(e.handle),this.objectsByZReversed=this.objectsByZReversed.filter(t=>t!==e),this.requestRedraw()}setView(e,t){this.view.x=e,this.view.y=t;for(const r of this.objects.values())r.updateAfterViewTranslate();this.requestRedraw()}testVisualIntersection(e,t,r){const i=this.objects.get(e);return i?i.testIntersect(t,r):!1}getVisualHandleFromPoint(e,t){for(const r of this.objectsByZReversed)if(r.selectable&&r.testIntersect(e,t)){const i=r.type!=="control"?r.handle:0;return i}return 0}redraw(){const{canvas:e}=this,t=this.wnd.width,r=this.wnd.height;let i=!1;if(t!==this.prevWidth&&(this.prevWidth=t,e.setWidth(t),i=!0),r!==this.prevHeight&&(this.prevHeight=r,e.setHeight(r),i=!0),i)e.calcOffset();else if(!this.shouldRedraw)return!1;return this.shouldRedraw=!1,this.canvas.renderAll(),!0}handleEvent({x:e,y:t,buttons:r,button:i},n){const a=e+this.view.x,s=t+this.view.y;switch(n){case"down":qi[1]=1,this.mouseSubs.forEach(o=>o(Xp[i]||Se.WM_LBUTTONDOWN,r,a,s));break;case"up":qi[1]=0,this.mouseSubs.forEach(o=>o(Yp[i]||Se.WM_LBUTTONUP,0,a,s));break;case"move":this.mouseSubs.forEach(o=>o(Se.WM_MOUSEMOVE,r,a,s));break}}subscribeToMouseEvents(e){this.mouseSubs.add(e)}subscribeToControlEvents(e){this.controlsubs.add(e)}}function $r(e,t){return{buttons:1,button:0,x:e.clientX-t.left,y:e.clientY-t.top}}function Zi(e){const{offsetX:t,offsetY:r,buttons:i,button:n}=e,a=i&1?1:0,s=i&2?2:0,o=i&4?16:0;return{buttons:a|s|o,button:n,x:t,y:r}}function Yc(e,t){let r=!1,i;const n=[{type:"touchstart",listener:a=>{if(r=!0,a.touches.length>1&&i){e.handleEvent($r(i,t.getBoundingClientRect()),"up"),i=void 0;return}if(i!==void 0)return;const s=a.changedTouches[0];i=s,e.handleEvent($r(s,t.getBoundingClientRect()),"down")}},{type:"touchend",listener:a=>{if(r=!0,i===void 0)return;const s=a.changedTouches[i.identifier];if(!s)return;i=void 0,e.handleEvent($r(s,t.getBoundingClientRect()),"up")}},{type:"touchmove",listener:a=>{if(r=!0,a.touches.length<2&&a.preventDefault(),i===void 0)return;const s=a.changedTouches[i.identifier];if(!s)return;const o=t.getBoundingClientRect(),c=$r(s,o);c.x<0||c.y<0||c.x>o.width||c.y>o.height?e.handleEvent($r(i,o),"up"):e.handleEvent(c,"move"),i=s}},{type:"mousedown",listener:a=>{if(r){r=!1;return}e.handleEvent(Zi(a),"down")}},{type:"mouseup",listener:a=>{if(r){r=!1;return}e.handleEvent(Zi(a),"up")}},{type:"mouseleave",listener:a=>{e.handleEvent(Zi(a),"up")}},{type:"mousemove",listener:a=>{e.handleEvent(Zi(a),"move")}},{type:"contextmenu",listener:a=>a.preventDefault()}];for(const a of n)t.addEventListener(a.type,a.listener)}class qc{constructor(e,t){this.elem=e;this.x=0;this.y=0;this.width=0;this.height=0;this.hidden=!1;this.set(t)}updateValues(){const{elem:e,x:t,y:r,width:i,height:n,hidden:a,text:s}=this;e.style.setProperty("left",t+"px"),e.style.setProperty("top",r+"px"),e.style.setProperty("width",i+"px"),e.style.setProperty("height",n+"px"),e.hidden=a,e.value=s}set(e){return Object.assign(this,e),this.updateValues(),this}get text(){return this.elem.value}set text(e){this.elem.value=e}destroy(){this.elem.remove()}onEdit(e){this.elem.addEventListener("input",e)}offEdit(e){this.elem.removeEventListener("input",e)}}class ja{constructor(e,t={}){this.root=e;this.opts=t;this.computer=new Yi;this.disableResize=!1;this.sizeWarned=!1}get container(){if(this._container)return this._container;const{root:e,opts:{customRes:t,disableWindowResize:r}}=this,i=t&&t.width&&t.width>0?t.width+"px":"100%",n=t&&t.height&&t.height>0?t.height+"px":"100%",a=document.createElement("div");return a.style.setProperty("position","relative"),a.style.setProperty("width",i),a.style.setProperty("height",n),a.style.setProperty("overflow","hidden"),this.disableResize=r||!1,e.appendChild(a),this._container=a}get renderer(){if(this._renderer)return this._renderer;const e=document.createElement("canvas"),t=new Ra(e,this);return Yc(t,e),this.computer.run(()=>t.redraw()||!0),this.container.appendChild(e),this._renderer=t}destroy(){if(!this._container)return;this._renderer&&(this.computer.stop(),this._renderer=void 0),this._container.remove(),this._container=void 0}get height(){return this.container.clientHeight}get width(){return this.container.clientWidth}fixedSize(e,t){if(this.disableResize)return this.sizeWarned||console.warn(`\u041F\u0440\u043E\u0435\u043A\u0442 \u043F\u043E\u043F\u044B\u0442\u0430\u043B\u0441\u044F \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C \u0440\u0430\u0437\u043C\u0435\u0440\u044B \u043E\u043A\u043D\u0430 \u0432 (${e}, ${t})`),this.sizeWarned=!0,!1;const r=this.container.style;return r.setProperty("width",e+"px"),r.setProperty("height",t+"px"),!0}textInput(e){const t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("class","stratum-textbox"),t.style.setProperty("position","absolute");const r=new qc(t,e);return this.container.appendChild(t),r}}const Ma=Dt(Pa());class Me{constructor(e,t){this.p=0;this.meta=Q({},t),this.v=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength)}get position(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}get size(){return this.v.byteLength}eof(){return this.p>=this.size}bytes(e){const t=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,t}byte(){const e=this.v.getUint8(this.p);return this.p+=1,e}int16(){const e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){const e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){const e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){const e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){const e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?Me.d.decode(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){const t=this.p;let r=0;for(;r<e-1&&this.v.getUint8(t+ ++r)!==0;);const i=this.fixedString(r);return this.p+=1,i}vmString(){const e=this.uint16()*2,t=this.v.getUint8(this.p+e-2)===0?2:1,r=this.fixedString(e-t);return this.p+=t,r}point2d(){return{x:this.float64(),y:this.float64()}}point2dInt(){return{x:this.int16(),y:this.int16()}}}Me.d=new TextDecoder("windows-1251");const ct=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function Zc(e){let t="",r,i=e.length;for(r=2;r<i;r+=3)t+=ct[e[r-2]>>2],t+=ct[(e[r-2]&3)<<4|e[r-1]>>4],t+=ct[(e[r-1]&15)<<2|e[r]>>6],t+=ct[e[r]&63];return r===i+1&&(t+=ct[e[r-2]>>2],t+=ct[(e[r-2]&3)<<4],t+="=="),r===i&&(t+=ct[e[r-2]>>2],t+=ct[(e[r-2]&3)<<4|e[r-1]>>4],t+=ct[(e[r-1]&15)<<2],t+="="),t}class qp{constructor(e,t=!1,r=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.pos=r,this.view=e,this.is_with_alpha=!!t,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){const e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let t=0;t<e;t++){const r=this.view.getUint8(this.pos++),i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.palette[t]={red:n,green:i,blue:r,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){const e="bit"+this.bitPP,t=this.width*this.height*4;if(this.data=new Uint8ClampedArray(t),e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){const e=Math.ceil(this.width/8),t=e%4;let r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<e;n++){const a=this.view.getUint8(this.pos++),s=i*this.width*4+n*8*4;for(let o=0;o<8&&n*8+o<this.width;o++){const c=this.palette[a>>7-o&1];this.data[s+o*4]=c.red,this.data[s+o*4+1]=c.green,this.data[s+o*4+2]=c.blue,this.data[s+o*4+3]=0}}t!==0&&(this.pos+=4-t)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0,r=!1;const i=n=>{const a=this.palette[n];this.data[e]=a.red,this.data[e+1]=a.green,this.data[e+2]=a.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const n=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);if(n===0)if(a===0){this.bottom_up?t--:t++,e=t*this.width*4,r=!1;continue}else{if(a===1)break;if(a===2){const s=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.bottom_up?t-=o:t+=o,e+=o*this.width*4+s*4}else{let s=this.view.getUint8(this.pos++);for(let o=0;o<a;o++)r?i.call(this,s&15):i.call(this,(s&240)>>4),o&1&&o+1<a&&(s=this.view.getUint8(this.pos++)),r=!r;(a+1>>1&1)===1&&this.pos++}}else for(let s=0;s<n;s++)r?i.call(this,a&15):i.call(this,(a&240)>>4),r=!r}}else{const e=Math.ceil(this.width/2),t=e%4;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<e;n++){const a=this.view.getUint8(this.pos++),s=i*this.width*4+n*2*4,o=a>>4,c=a&15;let l=this.palette[o];if(this.data[s]=l.red,this.data[s+1]=l.green,this.data[s+2]=l.blue,this.data[s+3]=255,n*2+1>=this.width)break;l=this.palette[c],this.data[s+4]=l.red,this.data[s+4+1]=l.green,this.data[s+4+2]=l.blue,this.data[s+4+3]=0}t!==0&&(this.pos+=4-t)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,t=this.bottom_up?this.height-1:0;const r=i=>{const n=this.palette[i];this.data[e]=n.red,this.data[e+1]=n.green,this.data[e+2]=n.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);if(i===0)if(n===0){this.bottom_up?t--:t++,e=t*this.width*4;continue}else{if(n===1)break;if(n===2){const a=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);this.bottom_up?t-=s:t+=s,e+=s*this.width*4+a*4}else{for(let a=0;a<n;a++){const s=this.view.getUint8(this.pos++);r.call(this,s)}(n&1)===1&&this.pos++}}else for(let a=0;a<i;a++)r.call(this,n)}}else{const e=this.width%4;for(let t=this.height-1;t>=0;t--){const r=this.bottom_up?t:this.height-1-t;for(let i=0;i<this.width;i++){const n=this.view.getUint8(this.pos++),a=r*this.width*4+i*4;if(n<this.palette.length){const s=this.palette[n];this.data[a]=s.red,this.data[a+1]=s.green,this.data[a+2]=s.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){const e=this.width%3,t=parseInt("11111",2),r=t;for(let i=this.height-1;i>=0;i--){const n=this.bottom_up?i:this.height-1-i;for(let a=0;a<this.width;a++){const s=this.view.getUint16(this.pos,!0);this.pos+=2;const o=(s&r)/r*255|0,c=(s>>5&r)/r*255|0,l=(s>>10&r)/r*255|0,h=n*this.width*4+a*4;this.data[h]=l,this.data[h+1]=c,this.data[h+2]=o,this.data[h+3]=255}this.pos+=e}}bit16(){const e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);const t=[0,0,0];for(let r=0;r<16;r++)this.maskRed>>r&1&&t[0]++,this.maskGreen>>r&1&&t[1]++,this.maskBlue>>r&1&&t[2]++;t[1]+=t[0],t[2]+=t[1],t[0]=8-t[0],t[1]-=8,t[2]-=8;for(let r=this.height-1;r>=0;r--){const i=this.bottom_up?r:this.height-1-r;for(let n=0;n<this.width;n++){const a=this.view.getUint16(this.pos,!0);this.pos+=2;const s=(a&this.maskBlue)<<t[0],o=(a&this.maskGreen)>>t[1],c=(a&this.maskRed)>>t[2],l=i*this.width*4+n*4;this.data[l]=c,this.data[l+1]=o,this.data[l+2]=s,this.data[l+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=a,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){this.view.getUint8(this.pos++);const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),s=t*this.width*4+r*4;this.data[s]=a,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}}}else for(let e=this.height-1;e>=0;e--){const t=this.bottom_up?e:this.height-1-e;for(let r=0;r<this.width;r++){const i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);const s=t*this.width*4+r*4;this.data[s]=a,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=255}}}getData(){return this.data}}function ka(e){return new qp(e)}function Kc(e){return{width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}function La(e){const t=e.position,r=e.uint16();if(r!==19778)throw new tt(e,r,19778);const i=e.int32();return e.seek(t),i}function Na(e){return new DataView(e.buffer,e.byteOffset)}function Ki(e){const t=e.bytes(La(e)),{width:r,height:i}=Kc(Na(t)),n="data:image/bmp;base64,"+Zc(t);return{base64Image:n,width:r,height:i}}const Ji=document.createElement("canvas"),Zp=Ji.getContext("2d");function Qr(e){const t=e.bytes(La(e)),r=e.bytes(La(e)),{data:i,width:n,height:a}=ka(Na(t)),{data:s}=ka(Na(r));for(let o=3;o<i.length&&o<s.length;o+=4)i[o]=255^s[o-1];return Ji.width=n,Ji.height=a,Zp.putImageData(new ImageData(i,n,a),0,0),{base64Image:Ji.toDataURL(),width:n,height:a}}class Be{constructor(e){this.subs=new Map;this.handle=e.handle}subscribe(e,t){this.subs.set(e,t)}unsubscribe(e){this.subs.delete(e)}get subCount(){return this.subs.size}dispatchChanges(){this.subs.forEach(e=>e())}}class ei extends Be{constructor(e){super(e);this.size=e.width&&e.height?{x:e.width,y:e.height}:void 0,this._image=e.image,this.asyncLoaded=!e.image}get image(){return this._image}setImage(e){this._image=e,this.dispatchChanges()}setPixel(e,t,r){throw this.asyncLoaded?new ge(`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${this.handle} \u0431\u044B\u043B\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0430\u0441\u0438\u043D\u0445\u0440\u043E\u043D\u043D\u043E`):new Error("Method not implemented.")}getPixel(e,t){throw new Error("Method not implemented.")}}class xt{static loadImage(e){return new Promise((t,r)=>{const i=new Image;i.onload=()=>t(i),i.onerror=()=>r(),i.src=e})}static loadDBM(e){return new Promise(t=>it(this,null,function*(){const r=yield fetch(e),i=yield r.arrayBuffer();try{const n=Qr(new Me(i)).base64Image;t(this.loadImage(n))}catch(n){}}))}static loadFromParams(e){if(e.type==="ttDIB2D"||e.type==="ttDOUBLEDIB2D"){const n=new ei(e);return this.loadImage(e.base64Image).then(a=>n.setImage(a)).catch(()=>{const a=e.type==="ttDIB2D"?"\u0411\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430";console.error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442 "${a}" #${e.handle}`)}),n}const t=new ei(e),r=e.filename.toUpperCase(),i=this.cachedIcons.get(r);if(i)i.then(n=>t.setImage(n));else if(Ma.options.iconsLocation){const n=`${Ma.options.iconsLocation}/${r}`,a=e.type==="ttREFTODIB2D"?this.loadImage(n):this.loadDBM(n);this.cachedIcons.set(r,a),a.then(s=>t.setImage(s))}return t}static loadFromStream(e,t,r){const{base64Image:i,width:n,height:a}=r?Qr(e):Ki(e),s=new ei({handle:t,width:n,height:a}),o=this.loadImage(i);return o.then(c=>s.setImage(c)).catch(()=>console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F ${e.meta.filepathDos} #${t}`)),s}}xt.cachedIcons=new Map;const Qi=Dt(pr());class $i{constructor({handle:e,name:t,options:r}){this._layer=0;this._isVisible=1;this._selectable=1;if(e===0)throw new Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${t} \u0438\u043C\u0435\u0435\u0442 \u043D\u0443\u043B\u0435\u0432\u043E\u0439 \u0434\u0435\u0441\u043A\u0440\u0438\u043F\u0442\u043E\u0440.`);this.handle=e,this._name=t||"",this.options=r||0,r&&(this._isVisible=r&1?0:1,this._selectable=r&8?0:1,this._layer=(r&7936)>>8)}get parent(){return this._parent}get name(){return this._name}setName(e){return this._name=e,1}}const Kp=180/Math.PI;class Et extends $i{constructor(e){super(e);this.positionX=0;this.positionY=0;this._angle=0;this.width=0;this.height=0;this._layerVisible=!0;this._hiddenLayers=0;const{position:t,size:r}=e;this.positionX=t.x,this.positionY=t.y,r&&(this.width=r.x,this.height=r.y),this.wasShowed=!!this._isVisible}setPosition(e,t){return this.positionX===e&&this.positionY===t||(this.positionX=e,this.positionY=t,this._isVisible&&this._layerVisible&&this.renderable.setPosition(e,t),this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height)),1}setSize(e,t){return this.width=e,this.height=t,this._isVisible&&this._layerVisible&&this.renderable.scaleTo(e,t),1}get angle(){return this.type==="otTEXT2D"?this._angle:0}rotate(e,t,r){const{positionX:i,positionY:n}=this,a=Qi.fabric.util.rotatePoint(new Qi.fabric.Point(i,n),new Qi.fabric.Point(e,t),r),s=this._angle+r*Kp;return this._angle=s,this._isVisible&&this._layerVisible&&(this.renderable.setAngle(s),this.setPosition(a.x,a.y)),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return this._isVisible}setVisibility(e){return e===this._isVisible||(this._isVisible=e,e&&this._layerVisible?this.showVisual():this.hideVisual()),1}showVisual(){if(this.renderable.show(),this.wasShowed)return;this.renderable.setPosition(this.positionX,this.positionY),this.renderable.setAngle(this.angle),this.renderable.scaleTo(this.width,this.height),this.wasShowed=!0}hideVisual(){this.renderable.hide(),this.wasShowed=!1}get isSelectable(){return this._selectable}updateLayerVisibility(e){if(this._layerVisible===e)return;this._layerVisible=e,e?this.showVisual():this.hideVisual()}setHiddenLayers(e){if(this._hiddenLayers===e)return;this._hiddenLayers=e,this.updateLayerVisibility(!(e>>this._layer&1))}get layer(){return this._layer}setLayer(e){if(this._layer===e)return;this._layer=e,this.updateLayerVisibility(!(this._hiddenLayers>>e&1))}}class vr extends Et{static create(e,t,r){const i=e.bmpHandle,n=e.type==="otBITMAP2D"?r.bitmaps.get(i):r.doubleBitmaps.get(i);return n?new vr(e,t,n):void 0}constructor(e,t,r){super(e);this.type=e.type;const i=e.bmpSize||e.size||r.size;if(!i){const a=`${e.type==="otBITMAP2D"?"\u0411":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431"}\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430`;throw new ge(`${a} #${e.handle}: \u0443 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435\u0442 \u0440\u0430\u0437\u043C\u0435\u0440\u043E\u0432 (\u043E\u0431\u044A\u0435\u043A\u0442: ${this.handle}).`)}const n={x:e.size&&e.bmpSize?e.size.x/e.bmpSize.x:1,y:e.size&&e.bmpSize?e.size.y/e.bmpSize.y:1};if(this.renderable=t.createBitmap({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,scale:n,bmpSize:i,bmpOrigin:e.bmpOrigin,bmpTool:r}),!e.size){const a=this.renderable.getVisibleAreaSize();this.width=a.x,this.height=a.y}this._bmpTool=r,r.subscribe(this,()=>this.renderable.updateBitmap(r))}get bmpTool(){return this._bmpTool}setRect(e,t,r,i){return this.renderable.setRect(e,t,r,i),1}changeBmpTool(e){return this.bmpTool.unsubscribe(this),e.subscribe(this,()=>this.renderable.updateBitmap(e)),this._bmpTool=e,1}unsubFromTools(){this.bmpTool.unsubscribe(this)}}class Ba extends Et{constructor(e,t){super(e);this.type="otCONTROL2D";if(this.renderable=t.createControl({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,classname:e.classname,text:e.text,controlSize:e.controlSize}),!e.size){const r=this.renderable.getVisibleAreaSize();this.width=r.x,this.height=r.y}}get text(){return this.renderable.getText()}setText(e){return this.renderable.setText(e),1}}class yr extends Et{constructor(e,t,r){super(e);this.type="otLINE2D";if(this.points=e.points.slice(),e.penHandle){const i=r&&r.pens.get(e.penHandle);this.changePen(i)}if(e.brushHandle){const i=r&&r.brushes.get(e.brushHandle);this.changeBrush(i)}if(this.renderable=t.createLine({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,points:this.points,pen:this.pen,brush:this.brush}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}}static calculatePosition(e){let t=e[0].x,r=e[0].y;for(const i of e)i.x<t&&(t=i.x),i.y<r&&(r=i.y);return{x:t,y:r}}static create(e,t,r){const i=e.position||this.calculatePosition(e.points);return new yr(Q(Q({},e),{position:i}),t,r)}get pen(){return this._pen}get brush(){return this._brush}getPoint(e){return this.points[e]}setPointPosition(e,t,r){const i=this.points[e];return i?(i.x===t&&i.y===r||(i.x=t,i.y=r,this.renderable.setPointPosition(e,t,r)),1):0}addPoint(e,t,r){return e===-1?this.points.push({x:t,y:r}):this.points.splice(e,0,{x:t,y:r}),this.renderable.addPoint(e,t,r),1}changePen(e){return this.pen&&this.pen.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updatePen(e)),this._pen=e,1}changeBrush(e){return this.brush&&this.brush.unsubscribe(this),e&&e.subscribe(this,()=>this.renderable.updateBrush(e)),this._brush=e,1}unsubFromTools(){this.pen&&this.pen.unsubscribe(this),this.brush&&this.brush.unsubscribe(this)}}class _r extends Et{constructor(e,t,r){super(e);this.type="otTEXT2D";if(this._angle=e.angle||0,this.renderable=t.createText({handle:e.handle,position:e.position,isVisible:!!this.isVisible,selectable:!!this.isSelectable,angle:e.angle,textTool:r}),!e.size){const i=this.renderable.getVisibleAreaSize();this.width=i.x,this.height=i.y}this._text=r,r.subscribe(this,()=>this.renderable.updateTextTool(r))}static create(e,t,r){const i=r.texts.get(e.textToolHandle);return i?new _r(e,t,i):void 0}get textTool(){return this._text}changeTextTool(e){return this._text.unsubscribe(this),this._text=e,e.subscribe(this,()=>this.renderable.updateTextTool(e)),1}unsubFromTools(){this.textTool.unsubscribe(this)}}class wr extends $i{constructor(e){super(e);this.type="otGROUP2D";this.angle=0;this.positionX=0;this.positionY=0;this.width=0;this.height=0;this.items=[];this.handleChildChanges=!0;e.items&&e.items.length!==0&&this.addItems(e.items)}recalcCoords(){let e,t,r,i;for(const n of this.items){if(!n.isVisible)continue;(e===void 0||n.positionX<e)&&(e=n.positionX),(r===void 0||n.positionY<r)&&(r=n.positionY),(t===void 0||n.positionX+n.width>t)&&(t=n.positionX+n.width),(i===void 0||n.positionY+n.height>i)&&(i=n.positionY+n.height)}this.positionX=e||0,this.positionY=r||0,this.width=t-e||0,this.height=i-r||0,this.parent&&this.parent.recalcCoords()}getItem(e){return this.items[e]}hasItem(e){return e.parent===this?1:0}addItemFast(e){return e.parent===this?0:(this.items.includes(e)||this.items.push(e),e._parent=this,1)}addItem(e){return this.addItemFast(e)&&this.recalcCoords(),1}addItems(e){for(const t of e)this.addItemFast(t);return this.recalcCoords(),1}removeItem(e){if(e.parent!==this)return 0;e._parent=void 0;const t=this.items.indexOf(e);return t<0?0:(this.items.splice(t,1),this.recalcCoords(),1)}getItemsRecursive(e){e||(e=[]);for(const t of this.items)t.type==="otGROUP2D"?t.getItemsRecursive(e):e.push(t);return e}handleChildTransform(e,t,r,i){if(!this.handleChildChanges)return;e<this.positionX&&(this.positionX=e),t<this.positionY&&(this.positionY=t),e+r>this.positionX+this.width&&(this.width=e+r-this.positionX),t+i>this.positionY+this.height&&(this.height=t+i-this.positionY),this.parent&&this.parent.handleChildTransform(e,t,r,i)}setPosition(e,t){if(this.positionX===e&&this.positionY===t)return 1;const r=e-this.positionX,i=t-this.positionY;this.handleChildChanges=!1;for(const n of this.items)n.setPosition(n.positionX+r,n.positionY+i);return this.handleChildChanges=!0,this.positionX=e,this.positionY=t,this.parent&&this.parent.handleChildTransform(e,t,this.width,this.height),1}setSize(e,t){if(this.width===e&&this.height===t)return 1;const r=e/this.width,i=t/this.height;this.handleChildChanges=!1;for(const n of this.items)n.setSize(n.width*r,n.height*i);return this.handleChildChanges=!0,this.width=e,this.height=t,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,e,t),1}rotate(e,t,r){this.handleChildChanges=!1;for(const i of this.items)i.rotate(e,t,r);return this.handleChildChanges=!0,this.parent&&this.parent.handleChildTransform(this.positionX,this.positionY,this.width,this.height),1}get zOrder(){return 1}setZorder(e){return 1}get isVisible(){return 1}setVisibility(e){if(e)return 1;throw new Ac("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0441\u043A\u0440\u044B\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442-\u0433\u0440\u0443\u043F\u043F\u0443.")}removeAllItems(){this.items.forEach(e=>e._parent=void 0),this.items=[]}}const Jp={0:"SOLID",1:"NULL",2:"HATCED",3:"PATTERN"};class ti extends Be{constructor(e,t){super(e);if(this._color=e.color,this._fillType=Jp[e.style],this._fillType==="HATCED"?console.warn("\u0421\u0442\u0438\u043B\u044C \u0437\u0430\u043B\u0438\u0432\u043A\u0438 HATCED \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D"):this._fillType||console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0437\u0430\u043B\u0438\u0432\u043A\u0438: ${e.style}`),e.dibHandle){const r=t&&t.get(e.dibHandle);this.changeBmpTool(r)}}get color(){return this._color}get fillType(){return this._fillType}get bmpTool(){return this._bmpTool}setColor(e){return this._color=e,this.dispatchChanges(),1}setFillType(e){return this._fillType=e,this.dispatchChanges(),1}changeBmpTool(e){return this._bmpTool&&this._bmpTool.unsubscribe(this),e&&e.subscribe(this,()=>this.dispatchChanges()),this._bmpTool=e,this.dispatchChanges(),1}unsubFromBmpTool(){this.bmpTool&&this.bmpTool.unsubscribe(this)}}class ri extends Be{constructor(e){super(e);this._name=e.fontName.toLowerCase().startsWith("arial")?"Arial":e.fontName,this._size=-(e.height||0)||e.size,this._bold=!!e.weight}get name(){return this._name}get size(){return this._size}get bold(){return this._bold}}class ii extends Be{constructor(e){super(e);this._color=e.color,this._width=e.width,this._style=e.style===5?"NULL":"SOLID"}get color(){return this._color}get width(){return this._width}get style(){return this._style}setColor(e){return this._color=e,this.dispatchChanges(),1}setWidth(e){return this._width=e,this.dispatchChanges(),1}}class ni extends Be{constructor(e){super(e);this._text=e.text}get text(){return this._text}setText(e){return this._text=e,this.dispatchChanges(),1}}class Sr extends Be{static create(e,t,r){const i=e.textCollection.length,n=new Array;for(let a=0;a<i;a++){const{fontHandle:s,stringHandle:o,foregroundColor:c,backgroundColor:l}=e.textCollection[a],h=t.get(s);if(!h)return;const u=r.get(o);if(!u)return;n[a]={font:h,stringFragment:u,foregroundColor:c,backgroundColor:l}}return new Sr({handle:e.handle,fragments:n})}constructor(e){super(e);e.fragments.forEach(t=>{t.font.subscribe(this,()=>this.update()),t.stringFragment.subscribe(this,()=>this.update())}),this.fragments=e.fragments}get textCount(){return this.fragments.length}get assembledText(){if(!this.cachedString){const e=this.fragments.reduce((r,i)=>r+i.stringFragment.text,""),t=this.fragments.reduce((r,i)=>r+i.font.size,0)/this.fragments.length;this.cachedString={text:e,size:t}}return this.cachedString}getFragment(e){return this.fragments[e]}updateString(e,t){const r=this.fragments[t].stringFragment;r!==e&&(this.fragments[t].stringFragment=e,r&&r.unsubscribe(this),e.subscribe(this,()=>this.dispatchChanges())),this.update()}updateFont(e,t){const r=this.fragments[t].font;r!==e&&(this.fragments[t].font=e,r&&r.unsubscribe(this),e.subscribe(this,()=>this.dispatchChanges())),this.update()}updateFgColor(e,t){this.fragments[t].foregroundColor=e,this.update()}updateBgColor(e,t){this.fragments[t].backgroundColor=e,this.update()}update(){this.cachedString=void 0,this.dispatchChanges()}unsubFromTools(){this.fragments.forEach(({font:e,stringFragment:t})=>{e.unsubscribe(this),t.unsubscribe(this)})}}class en{constructor(e={}){this.bitmaps=e.bitmaps||ne.create(),this.brushes=e.brushes||ne.create(),this.doubleBitmaps=e.doubleBitmaps||ne.create(),this.fonts=e.fonts||ne.create(),this.pens=e.pens||ne.create(),this.strings=e.strings||ne.create(),this.texts=e.texts||ne.create()}createBitmap(e){const t=ne.getFreeHandle(this.bitmaps),r=xt.loadFromStream(e,t,!1);return r?(this.bitmaps.set(t,r),r):void 0}createBrush(e,t,r){const i=ne.getFreeHandle(this.brushes),n=new ti({handle:i,color:e,style:t,dibHandle:r},this.bitmaps);return this.brushes.set(i,n),n}createDoubleBitmap(e){const t=ne.getFreeHandle(this.doubleBitmaps),r=xt.loadFromStream(e,t,!1);return r?(this.doubleBitmaps.set(t,r),r):void 0}createFont(e,t,r){const i=ne.getFreeHandle(this.fonts),n=new ri({handle:i,fontName:e,size:t,weight:+r});return this.fonts.set(i,n),n}createPen(e,t,r){const i=ne.getFreeHandle(this.pens),n=new ii({handle:i,width:e,color:t,style:r});return this.pens.set(i,n),n}createString(e){const t=ne.getFreeHandle(this.strings),r=new ni({handle:t,text:e});return this.strings.set(t,r),r}createText(e,t,r,i){const n=ne.getFreeHandle(this.texts),a=[{fontHandle:e,stringHandle:t,foregroundColor:r,backgroundColor:i}],s=Sr.create({handle:n,textCollection:a},this.fonts,this.strings);return s?(this.texts.set(n,s),s):void 0}deleteTool(e,t){switch(e){case"ttDIB2D":return this.bitmaps.delete(t)?1:0;case"ttBRUSH2D":const r=this.brushes.get(t);return r?(r.unsubFromBmpTool(),this.brushes.delete(t),1):0;case"ttDOUBLEDIB2D":return this.doubleBitmaps.delete(t)?1:0;case"ttFONT2D":return this.fonts.delete(t)?1:0;case"ttPEN2D":return this.pens.delete(t)?1:0;case"ttSTRING2D":return this.strings.delete(t)?1:0;case"ttTEXT2D":const i=this.texts.get(t);return i?(i.unsubFromTools(),this.texts.delete(t),1):0}}merge(e){e.bitmaps.forEach(t=>{const r=ne.getFreeHandle(this.bitmaps);t.handle=r,this.bitmaps.set(r,t)}),e.brushes.forEach(t=>{const r=ne.getFreeHandle(this.brushes);t.handle=r,this.brushes.set(r,t)}),e.doubleBitmaps.forEach(t=>{const r=ne.getFreeHandle(this.doubleBitmaps);t.handle=r,this.doubleBitmaps.set(r,t)}),e.fonts.forEach(t=>{const r=ne.getFreeHandle(this.fonts);t.handle=r,this.fonts.set(r,t)}),e.pens.forEach(t=>{const r=ne.getFreeHandle(this.pens);t.handle=r,this.pens.set(r,t)}),e.strings.forEach(t=>{const r=ne.getFreeHandle(this.strings);t.handle=r,this.strings.set(r,t)}),e.texts.forEach(t=>{const r=ne.getFreeHandle(this.texts);t.handle=r,this.texts.set(r,t)})}}function Fa(e){const{bitmapTools:t,brushTools:r,doubleBitmapTools:i,fontTools:n,penTools:a,stringTools:s,textTools:o}=e,c=t&&ne.create(t.map(g=>[g.handle,xt.loadFromParams(g)])),l=r&&ne.create(r.map(g=>[g.handle,new ti(g,c)])),h=i&&ne.create(i.map(g=>[g.handle,xt.loadFromParams(g)])),u=n&&ne.create(n.map(g=>[g.handle,new ri(g)])),f=a&&ne.create(a.map(g=>[g.handle,new ii(g)])),d=s&&ne.create(s.map(g=>[g.handle,new ni(g)])),m=o&&ne.create(o.map(g=>{const b=Sr.create(g,u,d);if(!b)throw new ge(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0422\u0435\u043A\u0441\u0442 #${g.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);return[g.handle,b]}));return new en({bitmaps:c,brushes:l,doubleBitmaps:h,fonts:u,pens:f,strings:d,texts:m})}function $p(e,t,r){switch(e.type){case"otLINE2D":return new yr(e,t,r);case"otBITMAP2D":case"otDOUBLEBITMAP2D":return vr.create(e,t,r);case"otTEXT2D":return _r.create(e,t,r);case"otCONTROL2D":return new Ba(e,t)}}function Ga(e,t,r,i){const n=ne.create(),a=[];for(const s of e){let o;if(s.type==="otGROUP2D")o=new wr(s),a.push({obj:o,data:s});else{if(o=$p(s,t,r),!o)throw new ge(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C ${s.type} #${s.handle} \u0438\u0437-\u0437\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0445 \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u043E\u0432.`);o.setHiddenLayers(i)}n.set(s.handle,o)}for(const{obj:s,data:o}of a){const c=o.childHandles.map(l=>{const h=n.get(l);if(!h)throw new ge(`\u0413\u0440\u0443\u043F\u043F\u0430 #${o.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043D\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 #${l}`);if(h.parent)throw new ge(`\u0413\u0440\u0443\u043F\u043F\u0430 #${o.handle} \u0441\u0441\u044B\u043B\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u043E\u0431\u044A\u0435\u043A\u0442 #${l}, \u0441\u043E\u0441\u0442\u043E\u044F\u0449\u0438\u0439 \u0432 \u0434\u0440\u0443\u0433\u043E\u0439 \u0433\u0440\u0443\u043F\u043F\u0435`);return h});s.addItems(c)}return n}class Ye{constructor({handle:e,vdr:t,renderer:r}){this._originX=0;this._originY=0;this.subs=new Array;this.layers=0;if(this.handle=e,this.renderer=r,t){const{origin:i,layers:n,brushHandle:a,elements:s,elementOrder:o}=t;if(this.setOrigin(i.x,i.y),this.layers=n,this.tools=Fa(t),a){const c=this.tools.brushes.get(a);c&&(c.subscribe(this,()=>this.renderer.updateBrush(c)),r.updateBrush(c))}this.objects=s?Ga(s,r,this.tools,n):ne.create(),o&&r.placeObjects(o)}else this.tools=new en,this.objects=ne.create();r.subscribeToControlEvents((...i)=>this.dispatchControlEvent(...i)),r.subscribeToMouseEvents((...i)=>this.dispatchMouseEvent(...i))}insertVectorDrawing(e,t,r){const i=Fa(e),n=[],a=new Map;if(e.elements){let o=0;const c=e.elements.map(l=>{const h=o=ne.getFreeHandle(this.objects,o);return a.set(l.handle,h),Q(Q({},l),{handle:h})});c.forEach(l=>{l.type==="otGROUP2D"&&(l.childHandles=l.childHandles.map(h=>a.get(h)))});for(const l of Ga(c,this.renderer,i,e.layers).values())this.objects.set(l.handle,l),l.parent||n.push(l)}if(this.tools.merge(i),n.length===0)return;let s;if(n.length>1){const o=ne.getFreeHandle(this.objects);s=new wr({handle:o,items:n}),this.objects.set(o,s)}else s=n[0];return s.setPosition(t,r),e.elementOrder&&this.renderer.placeObjects(e.elementOrder.map(o=>a.get(o))),s}get originX(){return this._originX}get originY(){return this._originY}setOrigin(e,t){return e===this._originX&&t===this.originY||(this._originX=e,this._originY=t,this.renderer.setView(e,t)),1}setLayers(e){if(this.layers!==e)for(const t of this.objects.values())t.type!=="otGROUP2D"&&t.setHiddenLayers(e)}createLine(e,t,r){const i=ne.getFreeHandle(this.objects),n=yr.create({handle:i,brushHandle:r,penHandle:t,points:e},this.renderer,this.tools);return this.objects.set(i,n),this.renderer.appendObjectToEnd(n.renderable),n}createBitmap(e,t,r,i){const n=ne.getFreeHandle(this.objects),a=vr.create({handle:n,bmpHandle:r,position:{x:e,y:t},type:i?"otDOUBLEBITMAP2D":"otBITMAP2D"},this.renderer,this.tools);return a?(this.objects.set(n,a),this.renderer.appendObjectToEnd(a.renderable),a):void 0}createText(e,t,r,i){const n=ne.getFreeHandle(this.objects),a=_r.create({handle:n,angle:r,position:{x:e,y:t},textToolHandle:i},this.renderer,this.tools);return a?(this.objects.set(n,a),this.renderer.appendObjectToEnd(a.renderable),a):void 0}createGroup(e){const t=new Array(e.length);for(let n=0;n<e.length;n++){const a=e[n],s=this.objects.get(a);s?t[n]=s:console.warn(`\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443 \u0441 \u043D\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u043C \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u043C ${a}`)}const r=ne.getFreeHandle(this.objects),i=new wr({handle:r,items:t});return this.objects.set(r,i),i}getObject(e){return this.objects.get(e)}deleteObject(e){const t=this.objects.get(e);if(!t)return 0;if(t.parent&&t.parent.removeItem(t),t.type!=="otGROUP2D")t.type!=="otCONTROL2D"&&t.unsubFromTools(),this.renderer.removeObject(t.renderable);else{const r=t.items;t.removeAllItems();for(const i of r)this.deleteObject(i.handle)}return this.objects.delete(e),1}deleteGroup(e){const t=this.objects.get(e);return!t||t.type!=="otGROUP2D"?0:(t.removeAllItems(),this.objects.delete(e),1)}moveObjectToTop(e){const t=this.objects.get(e);return t?(t.type==="otGROUP2D"?this.renderer.moveObjectRangeToTop(t.getItemsRecursive().map(r=>r.renderable)):this.renderer.moveObjectToTop(t.renderable),1):0}findObjectInGroup(e,t){for(const r of t.items){if(r.name===e)return r;if(r.type==="otGROUP2D")return this.findObjectInGroup(e,r)}return}findObjectByName(e,t){if(t===0){for(const i of this.objects.values())if(i.name===e)return i;return}const r=this.objects.get(t);return r!==void 0&&r.type==="otGROUP2D"?this.findObjectInGroup(e,r):void 0}getObjectFromPoint(e,t){const r=this.renderer.getVisualHandleFromPoint(e,t);if(!r)return;let i=this.objects.get(r);if(!i)return;for(;i.parent;)i=i.parent;return i}isIntersect(e,t){const r=this.objects.get(e);if(!r)return 0;const i=this.objects.get(t);if(!i)return 0;const n=r.positionX,a=n+r.width,s=r.positionY,o=s+r.height,c=i.positionX,l=c+i.width,h=i.positionY,u=h+i.height;return a>=c&&l>=n&&o>=h&&u>=s?1:0}subscribeToEvent(e,t,r,i){const n=i.currentClass;if(this.subs.some(a=>a.receiver===n&&a.eventCode===e)){console.warn(`\u041F\u043E\u0432\u0442\u043E\u0440\u043D\u044B\u0439 RegisterObject(${n.protoName}, ${Se[e]}, #${t})`);return}this.subs.push({ctx:i,receiver:n,objectHandle:t,eventCode:e})}static setDoubleValue(e,t,r){const i=e.receiver.vars.nameToIdMap.get(t);if(i!==void 0){const n=e.receiver.vars.globalIds[i];e.ctx.memoryManager.newDoubleValues[n]=r,e.ctx.memoryManager.oldDoubleValues[n]=r}}static setLongValue(e,t,r){const i=e.receiver.vars.nameToIdMap.get(t);if(i!==void 0){const n=e.receiver.vars.globalIds[i];e.ctx.memoryManager.newLongValues[n]=r,e.ctx.memoryManager.oldLongValues[n]=r}}dispatchControlEvent(e,t){this.subs.forEach(r=>{const i=r.eventCode===e&&((r.objectHandle?t===r.objectHandle:!0)||r.receiver.isCapturingEvents(this.handle));if(!i||!r.receiver.canReceiveEvents)return;Ye.setDoubleValue(r,"msg",e),Ye.setLongValue(r,"_hobject",t),Ye.setDoubleValue(r,"iditem",-1),Ye.setDoubleValue(r,"wnotifycode",768),r.receiver.compute(r.ctx,!0)})}dispatchMouseEvent(e,t,r,i){this.subs.forEach(n=>{if(!n.receiver.canReceiveEvents)return;const a=n.eventCode===e||n.eventCode===Se.WM_ALLMOUSEMESSAGE;if(!a)return;if(!n.receiver.isCapturingEvents(this.handle)&&n.objectHandle){const s=this.getObjectFromPoint(r,i),o=s?s.handle===n.objectHandle:!1;if(!o&&!this.renderer.testVisualIntersection(n.objectHandle,r,i))return}Ye.setDoubleValue(n,"msg",e),Ye.setDoubleValue(n,"xpos",r),Ye.setDoubleValue(n,"ypos",i),Ye.setDoubleValue(n,"fwkeys",t),n.receiver.compute(n.ctx,!0)})}}class Jc{constructor(e,t){this.wnd=e;this.classname="";this.filename="";this.originX=0;this.originY=0;if(t){const{name:r,origin:i}=t;i==="class"?this.classname=r:i==="file"&&(this.filename=r)}}setOrigin(e,t){return this.originX=e,this.originY=t,1}setSize(e,t){return this.wnd.fixedSize(e,t)?1:0}get width(){return this.wnd.width}get height(){return this.wnd.height}}class $c{constructor(e){this.wnd=e;this.scenes=ne.create();this.scenesByWinName=new Map;this.windowsBySpaceHandle=ne.create();this.windows=new Map;this.areaOriginX=0;this.areaOriginY=0;this.attribWarned=!1;this.noWndShowed=!1;this.secondWndWarned=!1;this.windowWasOpen=!1;this.screenWidth=this.areaWidth=e?e.width:1920,this.screenHeight=this.areaHeight=e?e.height:1080}openSchemeWindow(e,t,r){const{wnd:i}=this;if(!i)return this.noWndShowed||console.warn(`\u041F\u0440\u043E\u0435\u043A\u0442 \u043F\u043E\u043F\u044B\u0442\u0430\u043B\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E "${e}" \u0441 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430\u043C\u0438 "${t}"`),this.noWndShowed=!0,0;if(this.windowWasOpen)return this.secondWndWarned||console.warn(`\u041F\u0440\u043E\u0435\u043A\u0442 \u043F\u043E\u043F\u044B\u0442\u0430\u043B\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u0432\u0442\u043E\u0440\u043E\u0435 \u043E\u043A\u043D\u043E "${e}" \u0441 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430\u043C\u0438 "${t}"`),this.secondWndWarned=!0,0;if(t!==""&&!this.attribWarned&&(console.warn(`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u044B \u043E\u043A\u043D\u0430 "${e}" \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F:
"${t}"`),this.attribWarned=!0),this.hasWindow(e))throw Error(`\u041E\u043A\u043D\u043E "${e}" \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);document.title=e;const n=new Jc(i,r&&r.source),a=ne.getFreeHandle(this.scenes),s=new Ye({handle:a,vdr:r,renderer:i.renderer}),o=e.toUpperCase();return this.scenesByWinName.set(o,s),this.windows.set(o,n),this.scenes.set(a,s),this.windowsBySpaceHandle.set(a,e),this.windowWasOpen=!0,a}hasWindow(e){return this.windows.get(e.toUpperCase())?1:0}getWindow(e){return this.windows.get(e.toUpperCase())}closeWindow(e){return this.windows.delete(e.toUpperCase())?(this.windowWasOpen=!1,1):0}getSpace(e){return this.scenes.get(e)}getWinNameBySpaceHandle(e){return this.windowsBySpaceHandle.get(e)||""}getSpaceByWinName(e){return this.scenesByWinName.get(e.toUpperCase())}}var oe;(function(e){e[e.Float=0]="Float",e[e.Handle=1]="Handle",e[e.String=2]="String",e[e.ColorRef=3]="ColorRef"})(oe||(oe={}));function Qc(e){switch(e){case"FLOAT":return oe.Float;case"HANDLE":return oe.Handle;case"STRING":return oe.String;case"COLORREF":return oe.ColorRef}}function tn(e,t){switch(e){case oe.String:return t;case oe.Float:return parseFloat(t)||0;case oe.Handle:return(t.startsWith("#")?parseInt(t.substring(1,t.length)):parseInt(t))||0;case oe.ColorRef:return Gc(t)}}const rt=2047,Yt=2048,rn=8192,nn=16384;function Qp(e,t){const r=new Array(t);let i=0;for(let f=t-1;f>=0;f--)r[f]=e.popString().toLowerCase();const n=e.popString(),a=e.popString();if(a!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 SendMessage \u0441 path=${a} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);if(!e.canExecuteClass)return;const s=e.classManager.getClassesByProtoName(n);if(s.length===0)return;const o=s[0].vars;if(!o)return;const c=e.classVars,l=new Uint16Array(t),h=new Array(t),u=e.memoryManager;for(let f=0;f<t;f+=2){const d=c.nameToIdMap.get(r[f]);if(d===void 0)continue;const m=o.nameToIdMap.get(r[f+1]);if(m===void 0)continue;const g=c.typeCodes[d],b=o.typeCodes[m];if(g!==b)throw Error("\u0418\u043D\u043A\u043E\u043D\u0441\u0438\u0441\u0442\u0435\u043D\u0442\u043D\u044B\u0435 \u0442\u0438\u043F\u044B \u0441\u0432\u044F\u0437\u044B\u0432\u0430\u0435\u043C\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");l[i]=c.globalIds[d],l[i+1]=m,h[i]=u.getOldValues(g),h[i+1]=u.getNewValues(g),i+=2}for(let f=0;f<s.length;f++){const d=s[f],m=d.vars;if(m===c)continue;for(let g=0;g<i;g+=2){const b=l[g],_=m.globalIds[l[g+1]],I=h[g+1],M=h[g];M[_]=I[_]=I[b]}d.compute(e,!0);for(let g=0;g<t;g+=2){const b=l[g],_=m.globalIds[l[g+1]],I=h[g+1];I[b]=I[_]}}}function em(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),a=e.popLong();if(i!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 RegisterObject \u0441 path=${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);const s=e.windows.getSpace(a);s&&s.subscribeToEvent(r,n,t,e)}function tm(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),a=e.popString();console.warn(`\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E: RegisterObjectByWinname(${a}, ${n}, "${i}", ${r}, ${t})`)}function rm(e){const t=e.currentClass.getClassByPath(e.popString().toLowerCase());e.pushString(t?t.protoName:"")}function im(e,t){throw t&&console.log(t),Error("\u0412\u044B\u0437\u043E\u0432 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0445 \u0444\u0443\u043D\u043A\u0446\u0438\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}function nm(e){const t=e.popDouble(),r=e.popString(),i=e.popLong(),n=e.currentClass.getClassByPath(r.toLowerCase());if(!n)return;n.startCaptureEvents(i)}function am(e){e.currentClass.stopCaptureEvents()}function om(e){const t=e.popDouble(),r=e.popString(),i=e.popString(),n=e.currentClass.getClassByPath(i.toLowerCase());if(n===void 0||n.vars===void 0)return;const a=n.vars.nameToIdMap.get(r.toLowerCase());if(a===void 0)return;const s=n.vars.globalIds[a];e.memoryManager.oldDoubleValues[s]=t,e.memoryManager.newDoubleValues[s]=t}function sm(e){const t=e.popString(),r=e.popString(),i=e.currentClass.getClassByPath(r.toLowerCase());if(i===void 0||i.vars===void 0)return;const n=i.vars.nameToIdMap.get(t.toLowerCase());if(n===void 0)return;const a=i.vars.globalIds[n];e.pushLong(e.memoryManager.newLongValues[a])}function eh(e){e(y.VM_SENDMESSAGE,Qp),e(y.V_REGISTEROBJECT,em),e(y.REGISTEROBJECTS,tm),e(y.V_GETCLASS,rm),e(y.V_SETCAPTURE,nm),e(y.V_RELEASECAPTURE,am),e(y.V_SETVARF,om),e(y.V_GETVARH,sm),e(y.VFUNCTION,im)}function lm(e,t){e.pushDouble(e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]])}function cm(e,t){e.pushDouble(e.memoryManager.newDoubleValues[e.classVars.globalIds[t]])}function hm(e,t){e.memoryManager.newDoubleValues[e.classVars.globalIds[t]]=e.popDouble()}function um(e,t){e.memoryManager.oldDoubleValues[e.classVars.globalIds[t]]=e.popDouble()}function fm(e,t){e.pushLong(e.memoryManager.oldLongValues[e.classVars.globalIds[t]])}function dm(e,t){e.pushLong(e.memoryManager.newLongValues[e.classVars.globalIds[t]])}function pm(e,t){e.memoryManager.newLongValues[e.classVars.globalIds[t]]=e.popLong()}function mm(e,t){e.pushString(e.memoryManager.oldStringValues[e.classVars.globalIds[t]])}function gm(e,t){e.pushString(e.memoryManager.newStringValues[e.classVars.globalIds[t]])}function bm(e,t){e.memoryManager.newStringValues[e.classVars.globalIds[t]]=e.popString()}function vm(e,t){e.pushLong(t),e.pushLong(1)}function ym(e,t){e.pushLong(t),e.pushLong(0)}function _m(e,t){e.pushDouble(t)}function wm(e,t){e.pushLong(t)}function Sm(e,t){e.pushString(t)}function Tm(e,t){e.nextOpPointer=t}function xm(e,t){e.popDouble()!==0&&(e.nextOpPointer=t)}function Em(e,t){e.popDouble()===0&&(e.nextOpPointer=t)}function Cm(e,t){e.popLong()!==0&&(e.nextOpPointer=t)}function Am(e,t){e.popLong()===0&&(e.nextOpPointer=t)}function Dm(e){e.pushLong(e.popDouble())}function Om(e){e.pushDouble(e.popLong())}function Im(e){e.pushDouble(Math.sin(e.popDouble()))}function Rm(e){e.pushDouble(Math.cos(e.popDouble()))}function jm(e){const t=e.popDouble();e.pushDouble(Math.sqrt(t)||0)}function km(e){const t=e.popDouble();e.pushDouble(t*t)}function Lm(e){e.pushDouble(e.popDouble()*e.popDouble())}function Nm(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(t===0?0:r/t)}function Pm(e){e.pushDouble(e.popDouble()+e.popDouble())}function Mm(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(r-t)}function Bm(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(r%t)}function Fm(e){e.pushDouble(Math.log(e.popDouble()))}function Gm(e){e.pushDouble(Math.log10(e.popDouble()))}function Vm(e){const t=e.popDouble(),r=e.popDouble();e.pushDouble(Math.pow(r,t))}function Um(e){e.pushDouble(Math.max(e.popDouble(),e.popDouble()))}function Hm(e){e.pushDouble(Math.min(e.popDouble(),e.popDouble()))}function Wm(e){e.pushDouble((e.popDouble()+e.popDouble())/2)}function zm(e){const t=Math.pow(10,Math.floor(e.popDouble())),r=e.popDouble();e.pushDouble(Math.round(r*t)/t)}function Xm(e){e.pushDouble(Math.trunc(e.popDouble()))}function Ym(e){e.pushDouble(e.popDouble()*Math.random())}function qm(e){e.pushDouble(Math.abs(e.popDouble()))}function Zm(e){const t=e.popDouble()&&1,r=e.popDouble()&&1;e.pushDouble(t&&r)}function Km(e){const t=e.popDouble()&&1,r=e.popDouble()&&1;e.pushDouble(t||r)}function Jm(e){e.pushDouble(Number(e.popDouble()===0))}function $m(e){e.pushDouble(-e.popDouble())}function Qm(e){e.pushDouble(e.popDouble()&e.popDouble())}function eg(e){e.pushDouble(e.popDouble()|e.popDouble())}function tg(e){e.pushDouble(Number(e.popDouble()===e.popDouble()))}function rg(e){e.pushDouble(Number(e.popDouble()!==e.popDouble()))}function ig(e){e.pushDouble(Number(e.popDouble()<e.popDouble()))}function ng(e){e.pushDouble(Number(e.popDouble()<=e.popDouble()))}function ag(e){e.pushDouble(Number(e.popDouble()>e.popDouble()))}function og(e){e.pushDouble(Number(e.popDouble()>=e.popDouble()))}function sg(e){e.pushDouble(Number(e.popString()===e.popString()))}function lg(e){e.pushDouble(Number(e.popString()!==e.popString()))}function cg(e){e.pushDouble(Number(e.popString()<e.popString()))}function hg(e){e.pushDouble(Number(e.popString()<=e.popString()))}function ug(e){e.pushDouble(Number(e.popString()>e.popString()))}function fg(e){e.pushDouble(Number(e.popString()>=e.popString()))}function dg(e){e.pushDouble(Number(e.popLong()===e.popLong()))}function pg(e){e.pushDouble(Number(e.popLong()!==e.popLong()))}function mg(e){e.pushDouble(Number(e.popLong()>0))}function gg(e){e.pushDouble(Number(e.popLong()===0))}function bg(e){const t=e.popString(),r=e.popString(),i=e.popString();e.pushString(i.replace(new RegExp(r,"g"),t))}function vg(e){const t=e.popString(),r=e.popString();e.pushString(r+t)}function yg(e){const t=e.popDouble(),r=e.popString();e.pushString(r.substr(0,t))}function _g(e){const t=e.popDouble(),r=e.popString();e.pushString(r.substr(r.length-t,t))}function wg(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString();e.pushString(i.substr(r,t))}function Sg(e){e.pushDouble(e.popString().length)}function Tg(e){e.pushString(String.fromCharCode(e.popDouble()))}function xg(e){e.pushDouble(parseFloat(e.popString())||0)}function Va(e){return(Math.round(e*1e5)/1e5).toString()}function Eg(e){e.pushString(Va(e.popDouble()))}function Cg(e){const t=Va(e.popDouble()),r=e.popString();e.pushString(r+t)}function Ag(e){const t=e.popString(),r=Va(e.popDouble());e.pushString(r+t)}function th(e){e(y.PUSH_FLOAT,lm),e(y._PUSH_FLOAT,cm),e(y.PUSH_FLOAT_const,_m),e(y._POP_FLOAT,hm),e(y._POP_FLOAT_OLD,um),e(y.vmPUSH_LONG,fm),e(y.vmPUSH_LONG_const,wm),e(y.vm_PUSH_LONG,dm),e(y.vm_POP_LONG,pm),e(y.PUSH_STRING,mm),e(y._PUSH_STRING,gm),e(y.PUSH_STRING_CONST,Sm),e(y._POP_STRING,bm),e(y.V_JMP,Tm),e(y.V_JNZ,xm),e(y.V_JZ,Em),e(y.V_JNZ_HANDLE,Cm),e(y.V_JZ_HANDLE,Am),e(y.PUSHPTRNEW,vm),e(y.PUSHPTR,ym),e(y.FLOAT_TO_LONG,Dm),e(y.LONG_TO_FLOAT,Om),e(y.V_SIN,Im),e(y.V_COS,Rm),e(y.V_SQRT,jm),e(y.V_SQR,km),e(y.V_MUL_F,Lm),e(y.V_DIV_F,Nm),e(y.V_ADD_F,Pm),e(y.V_SUB_F,Mm),e(y.V_MOD,Bm),e(y.V_LN,Fm),e(y.V_LG,Gm),e(y.V_STEPEN,Vm),e(y.V_MAX,Um),e(y.V_MIN,Hm),e(y.V_AVERAGE,Wm),e(y.V_ROUND,zm),e(y.V_TRUNC,Xm),e(y.V_RANDOM,Ym),e(y.V_ABS,qm),e(y.V_AND,Zm),e(y.V_OR,Km),e(y.V_NOT,Jm),e(y.V_UN_MINUS,$m),e(y.V_AND_BINARY,Qm),e(y.V_OR_BINARY,eg),e(y.V_EQUAL,tg),e(y.V_NOTEQUAL,rg),e(y.V_MORE,ig),e(y.V_MOREorEQUAL,ng),e(y.V_LOW,ag),e(y.V_LOWorEQUAL,og),e(y.S_EQUAL,sg),e(y.S_NOTEQUAL,lg),e(y.S_MORE,cg),e(y.S_MOREorEQUAL,hg),e(y.S_LOW,ug),e(y.S_LOWorEQUAL,fg),e(y.V_EQUALI,dg),e(y.V_NOTEQUALI,pg),e(y.V_EDI,mg),e(y.V_NOTI,gg),e(y.SCHANGE,bg),e(y.PLUS_STRING,vg),e(y.LEFT_STRING,yg),e(y.RIGHT_STRING,_g),e(y.SUBSTR_STRING,wg),e(y.LENGTH_STRING,Sg),e(y.CHR_STRING,Tg),e(y.STRING_TO_FLOAT,xg),e(y.FLOAT_TO_STRING,Eg),e(y.PLUS_STRING_FLOAT,Cg),e(y.PLUS_FLOAT_STRING,Ag)}function fe(e,t,r){const i=e.windows.getSpace(t);return i&&i.getObject(r)}function Dg(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n?n.setVisibility(t&&1):0)}function Og(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);i&&i.setVisibility(1)}function Ig(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);i&&i.setVisibility(0)}function Rg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushLong(i&&i.parent?i.parent.handle:0)}function jg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.zOrder:0)}function kg(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n?n.setZorder(t):0)}function Lg(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),a=e.popLong(),s=fe(e,a,n);e.pushDouble(s?s.rotate(i,r,t):0)}function Ng(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),a=fe(e,n,i);e.pushDouble(a?a.setPosition(r,t):0)}function Pg(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),a=fe(e,n,i);e.pushDouble(a?a.setSize(r,t):0)}function Mg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.positionX:0)}function Bg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.positionY:0)}function Fg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.width:0)}function Gg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.height:0)}function Vg(e){const t=e.popString(),r=e.popLong(),i=e.popLong();if(t===""){e.pushLong(0);return}const n=e.windows.getSpace(i);if(!n){e.pushLong(0);return}const a=n.findObjectByName(t,r);e.pushLong(a?a.handle:0)}function Ug(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushLong(0);return}const a=n.getObjectFromPoint(r,t);e.pushLong(a?a.handle:0)}function Hg(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?t.originX:0)}function Wg(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?t.originY:0)}function zg(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.windows.getSpace(i);e.pushDouble(n?n.setOrigin(r,t):0)}function Xg(e){const t=e.popDouble(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?1:0)}function Yg(e){const t=e.windows.getSpace(e.popLong());e.pushDouble(t?1:0)}function qg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.width:0)}function Zg(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushDouble(i?i.height:0)}function Kg(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=fe(e,i,t);e.pushDouble(n&&n.parent?n.parent.removeItem(n):0)}function Jg(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n&&n.type==="otCONTROL2D"?n.setText(t):0)}function $g(e){const t=e.popLong(),r=e.popLong(),i=fe(e,r,t);e.pushString(i&&i.type==="otCONTROL2D"?i.text:"")}function Qg(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popDouble(),a=e.popLong(),s=e.popLong(),o=fe(e,s,a);e.pushDouble(o&&(o.type==="otBITMAP2D"||o.type=="otDOUBLEBITMAP2D")?o.setRect(n,i,r,t):0)}function eb(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n&&n.type==="otLINE2D"?n.getPoint(t).x:0)}function tb(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n&&n.type==="otLINE2D"?n.getPoint(t).y:0)}function rb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),a=e.popLong(),s=fe(e,a,n);e.pushDouble(s&&s.type==="otLINE2D"?s.setPointPosition(i,r,t):0)}function ib(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),a=e.popLong(),s=fe(e,a,n);e.pushDouble(s&&s.type==="otLINE2D"?s.addPoint(i,r,t):0)}function nb(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.windows.getSpace(n);e.pushDouble(a?a.isIntersect(i,r):0)}function ab(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);e.pushDouble(n?n.setName(t):0)}function ob(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.moveObjectToTop(t):0)}function sb(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.popLong(),s=e.popLong(),o=fe(e,s,a);if(!o){e.pushDouble(0);return}const c=o.width,l=o.height,h=e.classVars;i?e.memoryManager.newDoubleValues[h.globalIds[n]]=c:e.memoryManager.oldDoubleValues[h.globalIds[n]]=c,t?e.memoryManager.newDoubleValues[h.globalIds[r]]=l:e.memoryManager.oldDoubleValues[h.globalIds[r]]=l,e.pushDouble(1)}function lb(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=fe(e,i,r);if(!n||n.type!=="otGROUP2D"){e.pushLong(0);return}const a=n.getItem(t);e.pushLong(a?a.handle:0)}function cb(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.deleteGroup(t):0)}function rh(e){e(y.GETOBJECTBYNAME,Vg),e(y.SETOBJECTORG2D,Ng),e(y.GETOBJECTFROMPOINT2D,Ug),e(y.GETOBJECTORG2DX,Mg),e(y.GETOBJECTORG2DY,Bg),e(y.GETOBJECTSIZE2DX,Fg),e(y.GETOBJECTSIZE2DY,Gg),e(y.GETSPACEORGY,Wg),e(y.GETSPACEORGX,Hg),e(y.SETSPACEORG2D,zg),e(y.SETSCALESPACE2D,Xg),e(y.GETSCALESPACE2D,Yg),e(y.GETOBJECTPARENT2D,Rg),e(y.ROTATEOBJECT2D,Lg),e(y.SETOBJECTSIZE2D,Pg),e(y.SETSHOWOBJECT2D,Dg),e(y.SHOWOBJECT2D,Og),e(y.HIDEOBJECT2D,Ig),e(y.SETZORDER2D,kg),e(y.GETZORDER2D,jg),e(y.VM_GETACTUALWIDTH,qg),e(y.VM_GETACTUALHEIGHT,Zg),e(y.DELGROUPITEM2D,Kg),e(y.VM_SETCONTROLTEXT,Jg),e(y.VM_GETCONTROLTEXT,$g),e(y.SETBITMAPSRCRECT,Qg),e(y.GETVECTORPOINT2DX,eb),e(y.GETVECTORPOINT2DY,tb),e(y.SETVECTORPOINT2D,rb),e(y.ADDPOINT2D,ib),e(y.V_ISINTERSECT2D,nb),e(y.SETOBJECTNAME2D,ab),e(y.OBJECTTOTOP2D,ob),e(y.VM_GETACTUALSIZE,sb),e(y.GETGROUPITEM2D,lb),e(y.DELETEGROUP2D,cb)}function hb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popString(),a=e.popLong(),s=e.windows.getSpace(a);if(!s){e.pushLong(0);return}const o=e.project.openVdrFile(n),c=o&&s.insertVectorDrawing(o,i,r);e.pushLong(c?c.handle:0)}function ih(e,t){const r=t/2,i=new Array(r);for(let c=r-1;c>=0;c--)i[c]={y:e.popDouble(),x:e.popDouble()};const n=e.popLong(),a=e.popLong(),s=e.popLong(),o=e.windows.getSpace(s);e.pushLong(o?o.createLine(i,a,n).handle:0)}function ub(e){ih(e,2)}function fb(e,t){const r=new Array(t);for(let a=t-1;a>=0;a--)r[a]=e.popLong();const i=e.popLong(),n=e.windows.getSpace(i);if(n){const a=n.createGroup(r);if(a){e.pushLong(a.handle);return}}e.pushLong(0)}function db(e){const t=e.popDouble(),r=e.popDouble(),i=e.popLong(),n=e.popLong(),a=e.windows.getSpace(n);if(a){const s=a.createBitmap(r,t,i,!1);if(s){e.pushLong(s.handle);return}}e.pushLong(0)}function pb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popLong(),a=e.popLong(),s=e.windows.getSpace(a);if(s){const o=s.createText(i,r,t,n);if(o){e.pushLong(o.handle);return}}e.pushLong(0)}function mb(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);e.pushDouble(i?i.deleteObject(t):0)}function nh(e){e(y.V_CREATEOBJECTFROMFILE,hb),e(y.CREATEPOLYLINE2D,ih),e(y.CREATELINE2D,ub),e(y.CREATEGROUP2D,fb),e(y.CREATEBITMAP2D,db),e(y.CREATERASTERTEXT2D,pb),e(y.DELETEOBJECT2D,mb)}function ai(e,t,r){const i=e.windows.getSpace(t);return i&&i.tools.texts.get(r)}function gb(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushLong(0);return}const n=i.getObject(t);e.pushLong(n&&n.type==="otTEXT2D"?n.textTool.handle:0)}function bb(e){const t=e.popLong(),r=e.popLong(),i=ai(e,r,t);e.pushDouble(i?i.textCount:0)}function vb(e){const t=e.popLong(),r=e.popLong(),i=ai(e,r,t);e.pushLong(i?i.getFragment(0).stringFragment.handle:0)}function yb(e){const t=e.popLong(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushString("");return}const n=i.tools.strings.get(t);e.pushString(n?n.text:"")}function _b(e){const t=e.popLong(),r=e.popLong(),i=ai(e,r,t);e.pushLong(i?i.getFragment(0).font.handle:0)}function wb(e){const t=e.popLong(),r=e.popLong(),i=ai(e,r,t);e.pushLong(i?i.getFragment(0).foregroundColor:0)}function Sb(e){const t=e.popLong(),r=e.popLong(),i=ai(e,r,t);e.pushLong(i?i.getFragment(0).backgroundColor:0)}function Tb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.popLong(),a=e.windows.getSpace(n),s=!!(t&1),o=!!(t&2),c=!!(t&4),l=!!(t&8);e.pushLong(a?a.tools.createFont(i,r,l).handle:0)}function xb(e){const t=e.popString(),r=e.popLong(),i=e.windows.getSpace(r);e.pushLong(i?i.tools.createString(t).handle:0)}function Eb(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.popLong(),s=e.windows.getSpace(a);if(s){const o=s.tools.createText(n,i,r,t);if(o){e.pushLong(o.handle);return}}e.pushLong(0)}function Cb(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.popLong(),a=e.popLong(),s=e.popLong(),o=e.windows.getSpace(s);if(!o){e.pushDouble(0);return}const c=o.tools.texts.get(a);if(!c){e.pushDouble(0);return}const l=o.tools.fonts.get(n);l&&c.updateFont(l,0);const h=o.tools.strings.get(i);h&&c.updateString(h,0),c.updateFgColor(r,0),c.updateBgColor(t,0),e.pushDouble(1)}function Ab(e){const t=e.popString(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const a=n.tools.strings.get(r);e.pushDouble(a?a.setText(t):0)}function Db(e){const t=e.popDouble(),r=e.popLong(),i=e.popDouble(),n=e.popDouble(),a=e.popLong(),s=e.windows.getSpace(a);e.pushLong(s?s.tools.createPen(i,r,n).handle:0)}function Ob(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const a=n.tools.pens.get(r);e.pushDouble(a?1:0)}function Ib(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.popDouble(),a=e.popDouble(),s=e.popLong(),o=e.windows.getSpace(s);e.pushLong(o?o.tools.createBrush(i,a,r).handle:0)}function Rb(e){const t=e.popLong(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const a=n.tools.brushes.get(r);e.pushDouble(a?a.setColor(t):0)}function jb(e){const t=e.popDouble(),r=e.popLong(),i=e.popLong(),n=e.windows.getSpace(i);if(!n){e.pushDouble(0);return}const a=n.tools.brushes.get(r);e.pushDouble(a?1:0)}function kb(e){const t=e.popString(),r=e.popLong(),i=e.windows.getSpace(r);if(!i){e.pushLong(0);return}const n=e.project.openFileStream(t);if(!n){e.pushLong(0);return}const a=i.tools.createBitmap(n);e.pushLong(a?a.handle:0)}function ah(e){e(y.GETTEXTOBJECT2D,gb),e(y.VM_GETTEXTCOUNT2D,bb),e(y.GETTEXTSTRING2D,vb),e(y.GETLOGSTRING2D,yb),e(y.GETTEXTFONT2D,_b),e(y.GETTEXTFG2D,wb),e(y.GETTEXTBK2D,Sb),e(y.CREATEFONT2D,Tb),e(y.CREATESTRING2D,xb),e(y.CREATETEXT2D,Eb),e(y.VM_SETLOGTEXT2D,Cb),e(y.SETLOGSTRING2D,Ab),e(y.CREATEPEN2D,Db),e(y.SETPENROP2D,Ob),e(y.CREATEBRUSH2D,Ib),e(y.SETBRUSHCOLOR2D,Rb),e(y.SETBRUSHROP2D,jb),e(y.CREATEDID2D,kb)}function Lb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popDouble(),n=e.popDouble();console.warn(`\u0412\u044B\u0437\u043E\u0432 MGet(${n}, ${i}, ${r}, ${t})`),e.pushDouble(0)}function oh(e){e(y.V_MGET,Lb)}function Nb(e){const t=e.popString();e.pushDouble(-1)}function sh(e){e(y.MCISENDSTRING_INT,Nb)}function Pb(e){const t=e.popString(),r=e.popString(),i=e.popString(),n=e.windows.getSpaceByWinName(i);if(n){e.pushLong(n.handle);return}const a=e.project.getClassScheme(r);e.pushLong(a?e.windows.openSchemeWindow(i,t,a):0)}function Mb(e){const t=e.popString(),r=e.popString(),i=e.popString(),n=e.windows.getSpaceByWinName(i);if(n){e.pushLong(n.handle);return}if(r!=="")throw Error(`\u0412\u044B\u0437\u043E\u0432 LoadSpaceWindow \u0441 fileName=${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);e.pushLong(e.windows.openSchemeWindow(i,t))}function Bb(e){e.pushDouble(e.windows.hasWindow(e.popString()))}function Fb(e){const t=e.popString();e.pushDouble(1)}function Gb(e){const t=e.windows.getSpaceByWinName(e.popString());e.pushLong(t?t.handle:0)}function Vb(e){const t=e.popDouble(),r=e.popString();e.pushDouble(1)}function Ub(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.windows.getWindow(i);e.pushDouble(n?n.setOrigin(r,t):0)}function Hb(e){const t=e.popDouble(),r=e.popDouble(),i=e.popString(),n=e.windows.getWindow(i);e.pushDouble(n?n.setSize(r,t):0)}function Wb(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.width:0)}function zb(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.height:0)}function Xb(e){const t=e.popString();e.pushDouble(1)}function Yb(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.originX:0)}function qb(e){const t=e.windows.getWindow(e.popString());e.pushDouble(t?t.originY:0)}function Zb(e){const t=e.popDouble(),r=e.popString();e.pushDouble(1)}function Kb(e){const t=e.popLong(),r=e.popString();e.pushDouble(1)}function Jb(e){const t=e.popLong(),r=e.popLong();e.pushDouble(1)}function $b(e){e.pushString(e.windows.getWinNameBySpaceHandle(e.popLong()))}function Qb(e){const t=e.popString().toLowerCase(),r=e.popString(),i=e.windows.getWindow(r);let n="";i&&(t==="classname"?n=i.classname:t==="filename"&&(n=i.filename)),e.pushString(n)}function ev(e){const t=e.popString();e.pushDouble(1)}function lh(e){e(y.OPENSCHEMEWINDOW,Pb),e(y.LOADSPACEWINDOW,Mb),e(y.ISWINDOWEXIST,Bb),e(y.CLOSEWINDOW,Fb),e(y.V_GETHSPBYNAME,Gb),e(y.SHOWWINDOW,Vb),e(y.SETWINDOWORG,Ub),e(y.V_SETCLIENTSIZE,Hb),e(y.GETCLIENTWIDTH,Wb),e(y.GETCLIENTHEIGHT,zb),e(y.BRINGWINDOWTOTOP,Xb),e(y.WIN_ORGX,Yb),e(y.WIN_ORGY,qb),e(y.VM_SETWINDOWTRANSPARENT,Zb),e(y.VM_SETWINDOWTRANSPARENTCOLOR,Kb),e(y.VM_SETWINDOWOWNER,Jb),e(y.V_GETNAMEBYHSP,$b),e(y.VM_GETWINDOWPROP,Qb),e(y.ISWINDOWVISIBLE,ev)}const qt=new Array(y.VM_MAXIMUM_code);(function(){function e(t,r){if(qt[t])throw"Operation already set: "+t;qt[t]=r}eh(e),th(e),rh(e),nh(e),ah(e),oh(e),sh(e),Vc(e),lh(e)})();function ch(e,t){e.code.forEach((r,i)=>{const n=y[r&rt].toString(),a=r&Yt?r&4096?(/push/i.test(n)?"<- ":"-> ")+t[e.numberOperands[i]]:e.numberOperands[i]:e.stringOperands[i]!==void 0?`"${e.stringOperands[i]}"`:"";console.log(`${i}: ${n} ${a}`)})}var oi=["","push","push_new","push","push_new","push_cst","push_cst","","","",":=_old",":=",":=_old",":=","","","RGBf","FLOAT","+","-","/","*","%","tan","arctan","sin","arcsin","cos","arccos","ln","lg","log","^","exp","sqrt","sqr","ed","delta","max","min","average","round","rnd","and","or","not","abs","sgn","rad","deg","Stop","jmp","jnz","jz","==","!=",">",">=","<","<=","MCreate","MDelete","MFill","MGet","MPut","MEditor","MDiag","MAddX","MSubX","MDivX","MMulX","MDet","MDelta","MEd","MTransp","MAddC","MNot","MSum","MSubC","MMulC","trunc","CloseAll","==","!=","ed","&&","||","not","NotBin","SetCrdSystem2d","MDivC","MMul","MGlue","MCut","MMove","MObr","MDim","Xor","XorBin","ChooseFolderDialog","MSaveAs","MLoad","FileSaveDialog","FileLoadDialog","CreateObjectFromFile2d","&","|","Quit","","","jnz","jz","SetStatusText","un_minus","","gettickcount","<<",">>","","Change","push","push_new","push_cst",":=","+","Left","Right","Substr","Pos","Replicate","Lower","Upper","Ansi_To_Oem","Oem_To_Ansi","Compare","Comparei","Length","Ltrim","Rtrim","Alltrim","ASCII","Chr","String","Float","==","!=",">",">=","<","<=","RGB","system","systemstr","RegisterObject","UnregisterObject","SetCapture","ReleaseCapture",":=_old","GetMousePos","InputBox","MessageBox","CreateStream","CloseStream","Seek","StreamStatus","Eof","","Getpos","GetSize","SetWidth","Read","ReadLn","Write","WriteLn","GetLine","CopyBlock","Truncate","randomize","","","","","","","","","","","","","","","","","","","","CreateObjectFromFile3d","Shell","RGBEx","LoadSpacewindow","OpenSchemeWindow","CloseWindow","GetWindowName","GetWindowSpace","SetClientSize","SetWindowTitle","GetWindowTitle","ShowWindow","SetWindowPos","SetWindowOrg","SetWindowSize","IswindowVisible","IsIconic","IsWindowExist","BringWindowToTop","CascadeWindows","Tile","ArrangeIcons","GetWindowOrgX","GetWindowOrgY","GetWindowWidth","GetWindowHeight","GethObject","GetObject2dByName","GetClientWidth","GetClientHeight","ChoseColorDialog","joygetx","joygety","joygetz","joygetbuttons","GetAsyncKeyState","GetClassDirectory","GetProjectDirectory","GetWindowsDirectory","GetSystemDirectory","GetPathFromFile","AddSlash","GetStratumDirectory","WinExecute","SetScrollRange","GetActualWidth2d","GetActualHeight2d","SaveRectArea2d","LockSpace2d","LoadMenu","DeleteMenu","RegisterObject","UnregisterObject","MCISENDSTRINGstr","MCISENDSTRING","MCISENDSTRINGEX","GETLASTMCIERROR","GETMCIERRORSTR","SetCalcOrder","GetCalcOrder","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","GetObject3dFromPoint2d","SweepAndExtrude3d","IsObjectsIntersect2d","SetLineArrows2d","CreateLine2d","AddPoint2d","DelPoint2d","GetBrushObject2d","GetPenObject2d","GetRGNCreateMode","GetVectorNumPoints2d","GetVectorPoint2dx","GetVectorPoint2dy","SetBrushObject2d","SetPenObject2d","SetRGNCreateMode","SetVectorPoint2d","CreatePen2d","GetPenColor2d","GetPenRop2d","GetPenStyle2d","GetPenWidth2d","SetPenColor2d","SetPenROP2d","SetPenStyle2d","SetPenWidth2d","DeleteTool2d","DeleteObject2d","GetObjectOrg2dx","GetObjectOrg2dy","GetObjectParent2d","GetObjectAngle2d","GetObjectWidth2d","GetObjectHeight2d","GetObjectType2d","SetObjectOrg2d","SetObjectSize2d","CreateBrush2d","SetPoints2d","CreateDIB2d","CreateDoubleDIB2d","CreateRDIB2d","CreateRDoubleDIB2d","CreateBitmap2d","CreateDoubleBitmap2d","GetSpaceOrg2dy","GetSpaceOrg2dx","SetSpaceOrg2d","SetScaleSpace2d","GetScaleSpace2d","SndPlaySound","GetBottomObject2d","GetUpperObject2d","GetObjectFromZOrder2d","GetLowerObject2d","GetTopObject2d","GetZOrder2d","ObjectToBottom2d","ObjectToTop2d","SetZOrder2d","SwapObject2d","SetBitmapSrcRect2d","SetObjectAttribute2d","GetObjectAttribute2d","CreateFont2d","CreateString2d","CreateText2d","CreateRasterText2d","SetShowObject2d","SetString2d","AddGroupItem2d","CreateGroup2d","DeleteGroup2d","DelGroupItem2d","GetGroupItem2d","","GetGroupItemsNum2d","IsGroupContainObject2d","SetGroupItem2d","SetGroupItems2d","CopyToClipboard2d","PasteFromClipboard2d","GetObjectName2d","SetObjectName2d","GetObjectFromPoint2d","GetLastPrimary2d","RotateObject2d","ShowObject2d","HideObject2d","StdHyperJump","GetObjectCount","GetHObjectByNum","","GetObjectClass","FLOAT","GetControlText2d","SetControlText2d","CheckDlgButton2d","IsDlgButtonChecked2d","EnableControl2d","SetBrushHatch2d","GetString2d","GetClassName","","","GetBrushColor2d","GetBrushRop2d","GetBrushDib2d","GetBrushStyle2d","GetBrushHatch2d","SetBrushColor2d","SetBrushRop2d","SetBrushDib2d","SetBrushStyle2d","CreateObject","DeleteObject","CreateClass","DeleteClass","OpenClassScheme","CloseClassScheme","CreateLink","SetLinkVars","RemoveLink","GetUniqueClassName","GethObjectByName","CreateWindowEx","","","","","","","","","GetVarF","GetVarS","GetVarC","SetVar","SetVar","SetVar","CreateLink","SetModelText","GetModelText","GetAngleByXY","GetObjectFromPoint2dEx","OpenVideo","CloseVideo","","","","CreateVideoFrame2d","VideoSetPos2d","FrameSetPos2d","VideoPlay2d","VideoPause2d","VideoResume2d","VideoStop2d","FrameSetSrcRect2d","VideoGetPos2d","FrameGetPos2d","FrameGetVideo2d","BeginWriteVideo2d","VideoDialog","WriteVideoFrame2d","SetControlStyle2d","GetControlStyle2d","LBAddString","LBInsertString","LBGetString","LBClearList","LBDeleteString","LBGetCount","LBGetSelIndex","LBSetSelIndex","LBGetCaretIndex","LBSetCaretIndex","LBFindString","LBFindStringExact","GetDibPixel2d","GetTime","","","VFunction","DLLFunction","GetElement","SetElement","EmptySpace2d","","","CreatePolyLine2d","GetNameByHandle","SetSpaceLayers2d","GetSpaceLayers2d","","","LogMessage","SetVarsToDefault","GetTextObject2d","GetTextString2d","GetTextFont2d","LoadObjectState","SaveObjectState","GetWindowProp","_CameraProc3d","DbOpenBase","DbOpenTable","DbCloseBase","DbCloseTable","DbGetError","DbGetErrorStr","DbSetDir","DbCloseAll","DbGoTop","DbGoBottom","DbSkip","DbFieldId","DbGetField","DbSQL","DbGetCount","DbBrowse","DBGetFieldN","DBGetFieldName","DBGetFieldType","DbInsertRecord","DbAppendRecord","DbDeleteRecord","DbSetField","DbSetField","DbSetField","DbSetField","DbGetFieldN","DbGetField","DbCreateTable","DbZap","DbAddIndex","DbDeleteIndex","DbOpenIndex","DbSwitchToIndex","DbCloseIndex","DbRegenIndex","DbGetBlob","DbPutBlob","DbFreeBlob","DbPackFile","DbSortTable","DbGetDelMode","DbSetDelMode","DbSetCodePage","DbGetCodePage","DbLock","DbUnlock","DbUndeleteRecord","DbCopyTo","DbSetToKey","DbGetFieldCount","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","DbSetTable","DbSetControlTable","DbGetPos","","","","","","","","","","","","","","","","","","SendMessage","SetObjectName","SetText2d","GetTextFgColor2d","GetTextBkColor2d","Dialog","DialogEx","GetLink","DialogBox","GetRValue","GetGValue","GetBValue","GetToolRef2d","GetNextTool2d","GetNextObject2d","","","","","","","","","","","","","","","","","","","","","GetPoint3d","SetPoint3d","SetPrimitive3d","CreateObject3d","DelPrimitive3d","GetNumPrimitives3d","AddPrimitive3d","DelPoint3d","GetNumPoints3d","AddPoint3d","SetObjectMatrix3d","GetObjectMatrix3d","TransformObjectPoints3d","RotateObjectPoints3d","GetObjectBase3dM","SetObjectBase3d","GetObjectBase3d","GetSpace3d","GetObjectDimension3d","TransformObject3d","RotateObject3d","SetObjectColor3d","CreateDefCamera3d","SwitchToCamera3d","GetActiveCamera","CreateSpace3d","DeleteSpace3d","Create3dView","GetObjectPoints3d","SetObjectPoints3d","GetObjectColor3d","SetCurrentObject2d","GetCurrentObject2d","CreateSurface3d","FitToCamera3d","SetCameraPoint3d","PushCrdSystem3d","PopCrdSystem3d","SelectLocalCrd3d","SelectWorldCrd3d","SelectViewCrd3d","TransformCamera3d","SetColors3d","GetColors3d","GetMaterialByName3d","","","","","","","","","","","","","","","","","","","","","new","delete","vClearAll","vInsert","vDelete","vGetCount","vGetType","vGetF","vGetS","vGetH","vSet","vSet","vSet","GetControlText2ds","SetControlText2ds","","","","","","LoadProject","UnloadProject","SetActiveProject","IsProjectExist","","SetProjectProp","GetProjectProp","SetProjectProp","ApplyTexture3d","RemoveTexture3d","CreateDir","DeleteDir","FileRename","FileCopy","FileExist","FileDelete","GetFileList","GetActualSize2d","SetBkBrush2d","GetBkBrush2d","diff1","equation","diff2","dequation","GetDibObject2d","SetDibObject2d","GetDDibObject2d","SetDDibObject2d","GetDate","GetVideoMarker","GetVarInfo","GetVarCount","vSave","vLoad","GetBitmapSrcRect2d","SetHyperJump2d","SetRDib2d","SetRDoubleDib2d","GetRDib2d","GetRDoubleDib2d","MSort","DuplicateObject3d","CheckMenuItem","EnableMenuItem","","","","","","","+","+","GetScreenWidth","GetScreenHeight","GetWorkAreaX","GetWorkAreaY","GetWorkAreaWidth","GetWorkAreaHeight","GetKeyboardLayout","Substr","","","SetWindowTransparent","SetWindowTransparentColor","SetWindowRegion","GetTitleHeight","GetSmallTitleHeight","GetFixedFrameWidth","GetFixedFrameHeight","GetSizeFrameWidth","GetSizeFrameHeight","WindowInTaskBar","","SetWindowTransparent","SetWindowTransparentColor","SetWindowRegion","ShowCursor","ScreenShot","LockObject2d","GetVarInfo","++","","AudioOpenSound","AudioPlay","AudioStop","AudioIsPlaying","AudioReset","AudioSetRepeat","AudioGetRepeat","AudioSetVolume","AudioGetVolume","AudioSetBalance","AudioGetBalance","AudioSetTone","AudioGetTone","AudioIsSeekable","AudioSetPosition","AudioGetPosition","AudioGetLength","","","","","","","","","","","","","GetWordInfo","GetAnswer","GetSentanceTree","GetWordProperty","GetWordPropertyInSent","GetWordInSentByRole","GetWordFormCount","GetWordForm","SearchWords","GetWordInfo","SendSMS","ScreenShot","SendMail","ScreenShot","ScreenShot","GetFontName2d","GetFontSize2d","GetTextCount2d","GetFontStyle2d","SetFontSize2d","SetFontStyle2d","SetFontName2d","GetTextString2d","GetTextFont2d","GetTextFgColor2d","GetTextBkColor2d","SetTextString2d","SetTextFont2d","SetTextFgColor2d","SetTextBkColor2d","SetText2d","CreateFont2dpt","SetStandartCursor","SetStandartCursor","LoadCursor","LoadCursor","inc","inc","dec","dec","limit","GetFontList","vSort","vSort","vSort","GetUserKeyValue","GetUserKeyFullValue","GetTempDirectory","SendUserResult","CopyUserResult","GetROMDriveNames","ShellWait","ReadUserKey","GetUserKeyValue","GetUserKeyFullValue","SendUserResult","CopyUserResult","ReadProjectKey","UserKeyIsAutorized","UserKeyIsAutorized","SearchWords","SearchWords","FindNextWord","FindPrevWord","AnalyseWord","InitAnalyzer","MorphDivide","SetMorphDivide","WordDivide","AnimationState_GetTimePosition","AnimationState_SetTimePosition","AnimationState_GetLength","AnimationState_SetLength","AnimationState_GetWeight","AnimationState_SetWeight","AnimationState_AddTime","AnimationState_GetEnabled","AnimationState_SetEnabled","AnimationState_SetLoop","AnimationState_GetLoop","Bone_SetManuallyControlled","Bone_GetManuallyControlled","Bone_Reset","Camera_Create","Camera_Destroy","Camera_SetFOV","Camera_GetFOV","Camera_SetAspectRatio","Camera_GetAspectRatio","Camera_SetNearClipDistance","Camera_GetNearClipDistance","Camera_SetFarClipDistance","Camera_GetFarClipDistance","Camera_SetProjectionType","Camera_GetProjectionType","Camera_SetPolygonMode","Camera_GetPolygonMode","Camera_SetFrustumOffset","Camera_SetFocalLength","Collision_RayCast","Collision_Sort","Collision_GetResultCount","Collision_GetDistance","Collision_GetObject","Entity_Create","Entity_Destroy","Entity_SetMaterial","Entity_GetAnimationState","Entity_GetBone","Light_Create","Light_Destroy","Light_SetAttenuation","Light_SetSpotlightRange","Light_SetDiffuseColour","Light_SetSpecularColour","Light_SetType","Light_SetPowerScale","Light_GetPowerScale","ManualObject_Create","ManualObject_Destroy","ManualObject_Clear","ManualObject_EstimateVertexCount","ManualObject_EstimateIndexCount","ManualObject_SetDynamic","ManualObject_GetDynamic","ManualObject_Begin","ManualObject_End","ManualObject_Position","ManualObject_Normal","ManualObject_Colour","ManualObject_TextureCoord","ManualObject_Index","ManualObject_ConvertToMesh","Material_Create","Material_Get","Material_GetBestTechnique","Material_GetTechniqueByName","Material_GetTechniqueByIndex","Movable_SetParent","Movable_GetParent","Movable_SetCastShadows","Movable_GetCastShadows","Movable_SetVisible","Movable_GetVisible","Node_SetPosition","Node_SetRotationEulerXYZ","Node_SetRotationEulerXZY","Node_SetRotationEulerYXZ","Node_SetRotationEulerYZX","Node_SetRotationEulerZXY","Node_SetRotationEulerZYX","Node_SetRotationAxis","Node_SetRotationQuaternion","Node_SetScale","Node_SetParent","Node_GetParent","Node_AddChild","Node_RemoveChild","Overlay_Get","Overlay_SetVisible","Overlay_GetVisible","OverlayElement_Get","OverlayElement_SetVisible","OverlayElement_GetVisible","OverlayElement_SetPosition","OverlayElement_SetSize","OverlayElement_SetColour","OverlayElement_SetCaption","OverlayElement_SetMaterialName","ParticleSystem_Create","ParticleSystem_Destroy","Pass_Create","Pass_SetAmbient","Pass_SetDiffuse","Pass_SetSpecular","Pass_SetShininess","Pass_SetSelfIllumination","Pass_SetSceneBlending","Pass_SetDepthCheckEnabled","Pass_SetDepthWriteEnabled","Pass_SetDepthFunction","Pass_SetColourWriteEnabled","Pass_SetCullingMode","Pass_SetLightingEnabled","Pass_SetShadingMode","Pass_SetPolygonMode","Pass_SetAlphaRejectSettings","Pass_GetTextureUnitStateByName","Pass_GetTextureUnitStateByIndex","RenderTexture_Create","RenderTexture_Destroy","RenderWindow_Create","RenderWindow_GetPrimary","RenderWindow_Destroy","RenderWindow_SetPosition","RenderWindow_SetSize","Root_Create","Root_Destroy","Root_Initialise","Root_IsInitialised","Root_RestoreConfig","Root_SaveConfig","Root_ShowConfigDialog","Root_RenderOneFrame","Root_AddResourceLocationFromConfigFile","Root_AddResourceLocation","Root_InitialiseAllResourceGroups","Root_GetTime","Scene_Create","Scene_Destroy","Scene_SetWorldGeometry","Scene_GetRootSceneNode","Scene_SetShadowTechnique","Scene_GetShadowTechnique","Scene_SetFog","Scene_SetAmbientLight","Scene_SetSkyBox","Scene_GetCamera","Scene_GetEntity","Scene_GetLight","Scene_GetParticleSystem","Scene_GetSceneNode","Scene_Clear","Scene_Load","SceneNode_Create","SceneNode_Destroy","SceneNode_SetAutoTracking","SceneNode_AttachObject","SceneNode_DetachObject","Technique_Create","Technique_GetPassByName","Technique_GetPassByIndex","TextureUnitState_Create","TextureUnitState_SetTexture","TextureUnitState_GetTexture","Viewport_Create","Viewport_Destroy","Viewport_SetCamera","Viewport_GetCamera","Viewport_SetBackgroundColour","Viewport_SetDimensions","Viewport_SetOverlaysEnabled","Viewport_GetOverlaysEnabled","Viewport_GetRay","RenderWindow_CreateEx","RenderWindow_ToggleFullscreen","BillboardSet_Create","BillboardSet_Destroy","BillboardSet_CreateBillboard","BillboardSet_GetNumBillboards","BillboardSet_GetBillboard","BillboardSet_RemoveBillboard","BillboardSet_SetBillboardType","BillboardSet_GetBillboardType","BillboardSet_SetCommonDirection","BillboardSet_GetCommonDirection","BillboardSet_SetCommonUpVector","BillboardSet_GetCommonUpVector","BillboardSet_SetDefaultDimensions","BillboardSet_GetDefaultDimensions","BillboardSet_SetMaterialName","BillboardSet_GetMaterialName","Billboard_SetRotation","Billboard_GetRotation","Billboard_SetPosition","Billboard_GetPosition","Billboard_SetColour","Billboard_GetColour","","","SetControlFont2d","SetControlTextColor2d","GetControlTextLength2d","GetControlText2d","AddControlText2d","AddControlText2d","SetWindowOwner","SetWindowParent","GetProjectClasses","GetClassFile","AddText2d","RemoveText2d","AddText2d","LBGetSelIndexs","SetStringBufferMode","SetModelText","SendSMS","SendMail","SetControlFocus2d","DbSQL","SetObjectAlpha2d","GetObjectAlpha2d","SetBrushPoints2d","SetBrushColors2d","SetDibPixel2d","EncryptStream","SendData","DecryptStream","roundt","SetSpaceRenderEngine2d","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","Viewport_AddCompositor","Viewport_RemoveCompositor","Viewport_GetNumCompositors","Viewport_GetCompositor","Compositor_SetEnabled","Compositor_GetEnabled","Node_GetName","Node_GetPosition","Node_GetScale","Node_GetRotationQuaternion","Node_GetNumChildren","Node_GetChild","Movable_GetName","Movable_GetBoundingBox","SceneNode_GetNumObjects","SceneNode_GetObject","SceneNode_SetVisible","SceneNode_GetScene","ParticleSystem_CreateEx","Material_GetName","MovableText_Create","MovableText_Destroy","MovableText_SetFontName","MovableText_GetFontName","MovableText_SetCaption","MovableText_GetCaption","MovableText_SetColor","MovableText_GetColor","MovableText_SetCharacterHeight","MovableText_GetCharacterHeight","MovableText_SetSpaceWidth","MovableText_GetSpaceWidth","MovableText_SetTextAlignment","MovableText_GetTextAlignment","MovableText_SetGlobalTranslation","MovableText_GetGlobalTranslation","MovableText_SetLocalTranslation","MovableText_GetLocalTranslation","Overlay_Create","Overlay_GetName","Overlay_FindElementAt","Overlay_SetZOrder","Overlay_GetZOrder","Overlay_SetScale","Overlay_GetScale","Overlay_SetScroll","Overlay_GetScroll","Overlay_SetRotate","Overlay_GetRotate","Overlay_AddChild","Overlay_RemoveChild","OverlayContainer_AddChild","OverlayContainer_RemoveChild","OverlayContainer_GetChild","OverlayContainer_GetChildCount","OverlayElement_Create","OverlayElement_GetPosition","OverlayElement_GetSize","OverlayElement_GetColour","OverlayElement_GetCaption","OverlayElement_GetMaterialName","OverlayElement_SetMetricsMode","OverlayElement_GetMetricsMode","OverlayElement_SetAlignment","OverlayElement_GetAlignment","OverlayElement_IsContainer","OverlayElement_GetParent","Entity_GetMaterial","Entity_GetSubEntityCount","Pass_GetAmbient","Pass_GetDiffuse","Pass_GetSpecular","Pass_GetShininess","Pass_GetSelfIllumination","Pass_GetSceneBlending","Pass_GetDepthCheckEnabled","Pass_GetDepthWriteEnabled","Pass_GetDepthFunction","Pass_GetColourWriteEnabled","Pass_GetCullingMode","Pass_GetLightingEnabled","Pass_GetShadingMode","Pass_GetPolygonMode","Pass_GetAlphaRejectSettings","Node_GetDerivedPosition","Node_GetDerivedScale","Node_GetDerivedRotationQuaternion","StringInterface_SetParameter","StringInterface_GetParameter","StringInterface_GetParameterCount","StringInterface_GetParameterType","StringInterface_GetParameterName","StringInterface_GetParameterDescription","Entity_GetVertexCount","Entity_GetIndexCount","RenderWindow_GetCursorPosition","RenderWindow_GetCursorHovered","RenderWindow_GetMouseButtonPressed","RenderWindow_GetKeyboardButtonPressed","RenderWindow_GetViewportCount","RenderWindow_GetViewport","RenderWindow_GetCount","RenderWindow_Get","RenderWindow_GetWheelPosition","RenderWindow_Create2","ParticleSystem_SetVisible","ParticleSystem_GetVisible","ParticleSystem_SetParent","ParticleSystem_GetParent","ParticleSystem_GetName","Viewport_GetBackgroundColour","Viewport_GetDimensions","RenderWindow_GetPosition","RenderWindow_GetSize","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","NUI_Init","NUI_GetDeviceCount","NUI_CreateInstance","NUI_DestroyInstance","NUI_GetDeviceName","NUI_InitInstance","NUI_GetSkeletonPositions"];function hh(e,{code:t,numberOperands:r,stringOperands:i,otherOperands:n}){let a,s,o=0;e.nextOpPointer=0,e.lastOpPointer=t.length-1;try{for(;((a=t[s=e.nextOpPointer++])&rt)!==0;){if(++o>1e4)throw Error("\u0421\u0440\u0430\u0431\u043E\u0442\u0430\u043B\u0430 \u0437\u0430\u0449\u0438\u0442\u0430 \u043E\u0442 \u0431\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u043E\u0433\u043E \u0446\u0438\u043A\u043B\u0430.");const c=qt[a&rt];a<Yt?c(e):a<rn?c(e,r[s]):a<nn?c(e,i[s]):c(e,n[s])}}catch(c){const l=oi[a&rt],h=qt[a&rt]?c.message:"\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430.",u=y[a&rt],f=e.currentClass.protoName,d=e.nextOpPointer-1;console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u0437\u043E\u0432\u0430 ${l} (${u}).
\u0418\u043C\u0438\u0434\u0436: ${f}. \u0418\u043D\u0434\u0435\u043A\u0441 \u043E\u043F\u043A\u043E\u0434\u0430: ${d}.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${h}`),ch(e.currentClass.proto.code,e.currentClass.proto.vars.names),e.setError("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0438\u0440\u0442\u0443\u0430\u043B\u044C\u043D\u043E\u0439 \u043C\u0430\u0448\u0438\u043D\u044B")}}class uh{constructor(e){this.defaultDoubleValues=new Float64Array(0);this.oldDoubleValues=new Float64Array(0);this.newDoubleValues=new Float64Array(0);this.defaultLongValues=new Int32Array(0);this.oldLongValues=new Int32Array(0);this.newLongValues=new Int32Array(0);this.defaultStringValues=new Array;this.oldStringValues=new Array;this.newStringValues=new Array;e&&this.createBuffers(e)}createBuffers({floatsCount:e,longsCount:t,stringsCount:r}){return this.defaultDoubleValues=new Float64Array(e),this.oldDoubleValues=new Float64Array(e),this.newDoubleValues=new Float64Array(e),this.defaultLongValues=new Int32Array(t),this.oldLongValues=new Int32Array(t),this.newLongValues=new Int32Array(t),this.defaultStringValues=new Array(r).fill(""),this.oldStringValues=new Array(r).fill(""),this.newStringValues=new Array(r).fill(""),this}init(){this.newDoubleValues.set(this.defaultDoubleValues),this.newLongValues.set(this.defaultLongValues);for(let e=0;e<this.defaultStringValues.length;e++)this.newStringValues[e]=this.defaultStringValues[e];return this.sync()}sync(){this.oldDoubleValues.set(this.newDoubleValues),this.oldLongValues.set(this.newLongValues);for(let e=0;e<this.newStringValues.length;e++)this.oldStringValues[e]=this.newStringValues[e];return this}assertZeroIndexEmpty(){if(this.oldDoubleValues[0]!==0||this.newDoubleValues[0]!==0||this.oldLongValues[0]!==0||this.newLongValues[0]!==0||this.oldStringValues[0]!==""||this.newStringValues[0]!=="")throw new Ht("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}getOldValues(e){switch(e){case oe.Float:return this.oldDoubleValues;case oe.Handle:case oe.ColorRef:return this.oldLongValues;case oe.String:return this.oldStringValues}}getNewValues(e){switch(e){case oe.Float:return this.newDoubleValues;case oe.Handle:case oe.ColorRef:return this.newLongValues;case oe.String:return this.newStringValues}}getDefaultValues(e){switch(e){case oe.Float:return this.defaultDoubleValues;case oe.Handle:case oe.ColorRef:return this.defaultLongValues;case oe.String:return this.defaultStringValues}}}class Ua{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,t){if(e.type!==t.type)return!1;if(e.indexWasSet||t.indexWasSet)throw new Ht("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(t),t.connectedNodes.add(e),!0}shareIndex(e){if(this.indexWasSet)return;this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(t=>t.shareIndex(e))}getIndex(e){if(!this.indexWasSet)switch(this.type){case oe.Float:this.shareIndex(e.floatsCount++);break;case oe.Handle:case oe.ColorRef:this.shareIndex(e.longsCount++);break;case oe.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}}const tv=()=>!1;class Ha{constructor({proto:e,placement:t}){this.captureEventsFromSpace=0;this.isDisabled=tv;this._canReceiveEvents=!1;this.variablesCreated=!1;this.proto=e,this.protoName=e.name,this.protoNameLowCase=e.name.toLowerCase(),this.placement=t,this.varGraphNodes=e.vars?e.vars.typeCodes.map(n=>new Ua(n)):[];let r=this;for(;r.placement&&r.placement.parent!==r;)r=r.placement.parent;this.root=r,this.neighbourMap=new Map([["",this],["\\",this.root]]);const i=t&&t.parent;i&&this.neighbourMap.set("..",i)}setChildren(e){if(this.children)throw new Ht("\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");this.children=e,e.forEach(t=>{const r=t.placement&&t.placement.name;r&&this.neighbourMap.set(r.toLowerCase(),t)})}getChild(e){return this.children&&this.children.find(t=>t.placement.handle===e)}static connectVar(e,t,r,i){return Ua.connect(e.varGraphNodes[t],r.varGraphNodes[i])}createVarsRecursive(e,t){if(this.variablesCreated=!0,this.children&&this.children.forEach(s=>s.createVarsRecursive(e,t)),!this.proto.vars)return;const r={nameToIdMap:this.proto.vars.varNameToId,typeCodes:this.proto.vars.typeCodes,names:this.proto.vars.names,globalIds:new Uint16Array(this.varGraphNodes.map(s=>s.getIndex(e))),mmanager:t},i=r.nameToIdMap.get("_enable"),n=r.nameToIdMap.get("_disable"),a=r.nameToIdMap.get("msg");if(i!==void 0&&r.typeCodes[i]===oe.Float&&(n===void 0||r.typeCodes[n]!==oe.Float||i<n)){const s=r.globalIds[i];this.isDisabled=()=>t.newDoubleValues[s]<1}if(n!==void 0&&r.typeCodes[n]===oe.Float&&(i===void 0||r.typeCodes[i]!==oe.Float||n<i)){const s=r.globalIds[n];this.isDisabled=()=>t.newDoubleValues[s]>0}this._canReceiveEvents=a!==void 0&&r.typeCodes[a]===oe.Float,this.vars=r}applyDefaultValuesRecursive(){if(this.children&&this.children.forEach(t=>t.applyDefaultValuesRecursive()),!this.proto.vars||!this.vars)return;const e=this.vars.globalIds.length;for(let t=0;t<e;t++){const r=this.proto.vars.defaultValues[t],i=this.vars.typeCodes[t],n=this.vars.names[t].toLowerCase();let a;r!==void 0?a=r:i===oe.Float?n==="orgx"?a=this.placement&&this.placement.position.x:n==="orgy"&&(a=this.placement&&this.placement.position.y):i===oe.String?n==="_objname"?a=this.placement&&this.placement.name:n==="_classname"&&(a=this.proto.name):i===oe.Handle&&n==="_hobject"&&(a=this.placement&&this.placement.handle),a!==void 0&&(this.vars.mmanager.getDefaultValues(this.vars.typeCodes[t])[this.vars.globalIds[t]]=a)}}createMemoryManager(){if(this.vars&&this.vars.mmanager)return this.vars.mmanager;const e={floatsCount:1,longsCount:1,stringsCount:1},t=new uh;return this.createVarsRecursive(e,t),t.createBuffers(e),this.applyDefaultValuesRecursive(),t}applyVarSet(e){if(!this.variablesCreated)throw new Ht("\u041F\u0430\u043C\u044F\u0442\u044C \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043D\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u0430 (\u0441\u043F\u0435\u0440\u0432\u0430 \u0432\u044B\u0437\u043E\u0432\u0438 createMemoryManager)");if(this.vars&&this.protoNameLowCase===e.classname.toLowerCase())for(const{name:t,value:r}of e.values){const i=this.vars.nameToIdMap.get(t.toLowerCase());if(i===void 0)continue;const n=this.vars.typeCodes[i],a=this.vars.globalIds[i];this.vars.mmanager.getDefaultValues(n)[a]=tn(n,r)}if(this.children)for(const t of e.childSets){const r=this.children.find(i=>i.placement&&i.placement.handle===t.handle);r&&r.applyVarSet(t)}}getClassByPath(e){if(e==="")return this;const t=e.split("\\");let r=e[0]==="\\"?this.root:this;for(let i=0;i<t.length;i++){const n=r.neighbourMap.get(t[i]);if(n===void 0)return;r=n}return r}getAllChildren(){const e=(r,i)=>{r.children&&r.children.forEach(n=>e(n,i)),i.push(r)},t=new Array;return e(this,t),t}startCaptureEvents(e){this.captureEventsFromSpace=e}get canReceiveEvents(){return this._canReceiveEvents}stopCaptureEvents(){this.captureEventsFromSpace=0}isCapturingEvents(e){return this.captureEventsFromSpace===e}toCompactString(){return`${this.placement?"#"+this.placement.handle+" ":""}${this.proto.name}`}compute(e,t=!1){if(e.hasError===!0||t===!1&&this.isDisabled()===!0)return;const r=this.children;if(r!==void 0)for(let s=0;s<r.length;s++)r[s].compute(e);const i=this.proto.code;if(i===void 0)return;const n=e.nextOpPointer,a=e.currentClass;e.pushClass(this),hh(e,i),e.popClass(a),e.nextOpPointer=n}}function rv(e,t){const r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${e.protoName}: ${i}`);for(const{handle1:i,handle2:n,connectedVars:a}of t){const s=i===0?e:e.getChild(i),o=n===0?e:e.getChild(n);if(s?s.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),o?o.proto.vars||r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`):r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`),!s||!s.proto.vars||!o||!o.proto.vars)continue;const c=s.proto.vars,l=o.proto.vars,h=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${s.protoName} #${i}`,u=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${o.protoName} #${n}`;for(const{name1:f,name2:d}of a){const m=c.varNameToId.get(f.toLowerCase()),g=l.varNameToId.get(d.toLowerCase());if(m===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${f} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${h}`),g===void 0&&r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${d} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${u}`),m===void 0||g===void 0)continue;if(!Ha.connectVar(s,m,o,g)){const b=oe[s.proto.vars.typeCodes[m]],_=oe[o.proto.vars.typeCodes[g]];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${f} (${b}) \u0432 ${h} \u0438 ${d} (${_}) \u0432 ${u}`)}}}}function fh(e,t,r){const i=t.get(e.toUpperCase());if(!i)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${e}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);const n=new Ha({proto:i,placement:r});if(i.children){const a=i.children.map(s=>fh(s.classname,t,Q({parent:n},s.schemeInfo)));n.setChildren(a)}return i.links&&rv(n,i.links),n}function dh(e,t){return fh(e,t)}class ph{constructor({tree:e}){this.classNodeCache=new Map;this.tree=e,this.classNodes=this.tree.getAllChildren()}getClassesByProtoName(e){const t=e.toLowerCase(),r=this.classNodeCache.get(t);if(r!==void 0)return r;const i=this.classNodes.filter(n=>n.protoNameLowCase===t);return this.classNodeCache.set(e,i),i}}class mh{constructor({windows:e,projectManager:t,classManager:r,memoryManager:i}){this.floatStack=new Float64Array(2e3);this.floatStackPointer=-1;this.intStack=new Int32Array(2e3);this.intStackPointer=-1;this.stringStack=new Array(2e3);this.stringStackPointer=-1;this.ctxDepth=0;this._error="";this.nextOpPointer=0;this.lastOpPointer=0;this.hasError=!1;this.executionStopped=!1;this.windows=e,this.project=t,this.classManager=r,this.memoryManager=i}get canExecuteClass(){return this.ctxDepth<60}pushClass(e){this.currentClass=e,this.classVars=e.vars,++this.ctxDepth}popClass(e){--this.ctxDepth===0?(this.floatStackPointer=-1,this.intStackPointer=-1,this.stringStackPointer=-1):(this.currentClass=e,this.classVars=e.vars)}get error(){return this._error}setError(e){this._error=e,this.hasError=!0,this.executionStopped=!0,this.pausedOpPointer=this.nextOpPointer,this.pausedClass=this.currentClass,this.nextOpPointer=this.lastOpPointer}addErrorInfo(e){this._error+=e}pushDouble(e){this.floatStack[++this.floatStackPointer]=e}popDouble(){if(this.floatStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.floatStack[this.floatStackPointer--]}pushLong(e){this.intStack[++this.intStackPointer]=e}popLong(){if(this.intStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.intStack[this.intStackPointer--]}pushString(e){this.stringStack[++this.stringStackPointer]=e}popString(){if(this.stringStackPointer<0)throw new Error("\u0412 \u0441\u0442\u0435\u043A\u0435 \u043D\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439");return this.stringStack[this.stringStackPointer--]}}function iv({code:e},t){const r=new Set;for(let i=0;i<e.length;i++){const n=e[i]&rt;if(n===0)continue;if(!y[n]&&(n>=900&&n<=1100||n>=1200&&n<=1500))return{error:!0,message:"\u0444\u0443\u043D\u043A\u0446\u0438\u0438 3D \u0434\u0432\u0438\u0436\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B"};if(!y[n])return{error:!0,message:`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u043A\u043E\u0434: ${n}`};t[n]||r.add(n)}return r.size>0?{error:!0,ops:r}:{error:!1}}function gh(e){return`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 (\u0432\u0441\u0435\u0433\u043E ${e.length})
`+e.map(({name:t,classNames:r})=>`${t} \u0432 ${r}`).join(`;
`)}function nv(e){const t=new Map,r=[];for(const n of e.values()){if(!n.code)continue;const a=iv(n.code,qt);if(!a.error)continue;if(!a.ops)r.push(`${n.name} : ${a.message}`);else for(const s of a.ops){const o=t.get(s);o?o.add(n.name):t.set(s,new Set([n.name]))}}const i=[];for(const[n,a]of t)i.push({name:(oi[n]?oi[n]:n)+` (${y[n]})`,classNames:[...a.values()]});return{missingOperations:i,errors:r}}function bh(e,t){const r=new Map;return function i(n){const a=n.toUpperCase(),s=t.get(a);if(!s)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${n}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);r.set(a,s),s.children&&s.children.forEach(o=>i(o.classname))}(e),nv(r)}class Wa{constructor(e){this._computer=new Yi;this._state="closed";this.handlers={closed:new Set,error:new Set};this._fileWarnShowed=!1;this._vdrWarnShowed=!1;this.dir=e.dir,this.prjInfo=e.prjInfo,this.classes=e.classes,this.stt=e.stt;const t=bh(e.prjInfo.rootClassName,e.classes);t.errors.length>0&&console.warn("\u041E\u0448\u0438\u0431\u043A\u0438:",t.errors),t.missingOperations.length>0&&console.warn(gh(t.missingOperations)),this._diag={iterations:0,missingCommands:t.missingOperations}}get state(){return this._state}get computer(){return this._computer}get diag(){return this._diag}set computer(e){if(e==this._computer)return;this._computer.running&&(this._computer.stop(),this.loop&&e.run(this.loop)),this._computer=e}play(e){if(this.loop)return this;e instanceof HTMLElement?this.wnd=new ja(e):e&&e.mainWindowContainer&&(this.wnd=new ja(e.mainWindowContainer,e));const{classes:t,prjInfo:r,stt:i}=this,n=dh(r.rootClassName,t),a=n.createMemoryManager();i&&n.applyVarSet(i);const s=new mh({classManager:new ph({tree:n}),memoryManager:a,projectManager:this,windows:new $c(this.wnd)});return this._diag.iterations=0,this.loop=()=>(++this._diag.iterations,n.compute(s),s.executionStopped?(s.hasError?(this._state="error",this.handlers.error.forEach(o=>o(s.error))):(this._state="closed",this.loop=void 0,this.wnd&&this.wnd.destroy(),this.handlers.closed.forEach(o=>o())),!1):(a.sync().assertZeroIndexEmpty(),!0)),a.init(),this.computer.run(this.loop),this._state="playing",this}close(){return this.computer.stop(),this.loop=void 0,this.wnd&&this.wnd.destroy(),this._state="closed",this}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,t){return this.handlers[e].add(t),this}off(e,t){return t?this.handlers[e].delete(t):this.handlers[e].clear(),this}get rootClassName(){return this.prjInfo.rootClassName}getClassScheme(e){const t=this.classes.get(e.toUpperCase());if(!t||!t.scheme)return;const{children:r,scheme:i}=t;return r?kc(i,r,this.classes):i}hasClass(e){return this.classes.has(e.toUpperCase())?1:0}getClassDirectory(e){const t=this.classes.get(e.toUpperCase());return t&&t.directoryDos||""}openFileStream(e){const t=this.dir.get(e);if(!t||t.dir)return;const r=t.arraybufferSync();if(!r){if(!this._fileWarnShowed)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u0440\u043E\u0447\u0435\u0441\u0442\u044C \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435 ${t.pathDos}. \u0412\u043E\u0437\u043C\u043E\u0436\u043D\u043E, \u0444\u0430\u0439\u043B \u043D\u0435 \u0431\u044B\u043B \u043F\u0440\u0435\u0434\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D.`);this._vdrWarnShowed=!0;return}return new Me(r,{filepathDos:t.pathDos})}openVdrFile(e){const t=this.dir.get(e);if(!t||t.dir)return;const r=t.readSyncAs("vdr");if(!r){if(!this._vdrWarnShowed)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u0440\u043E\u0447\u0435\u0441\u0442\u044C ${t.pathDos}. \u0412\u043E\u0437\u043C\u043E\u0436\u043D\u043E, \u0444\u0430\u0439\u043B \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F VDR-\u0444\u0430\u0439\u043B\u043E\u043C \u0438\u043B\u0438 \u043D\u0435 \u0431\u044B\u043B \u043F\u0440\u0435\u0434\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D.`);this._vdrWarnShowed=!0}return r}isFileExist(e){return this.dir.get(e)?1:0}}function av(e){const t=e.uint16()*2,r=e.position,i=e.nulltString(t);e.seek(r+t);const n=e.uint16(),a=new Array(n);for(let o=n-1;o>=0;o--){const c=e.int16();if(c>0)throw new Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${i}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u0430 ${o}.`);a[o]=c}const s=e.int16();if(s>0)throw new Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${i}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043C\u044B\u0439 \u0442\u0438\u043F.`);return{funcName:i,argCount:n,argTypes:a,returnType:s}}function ov(e){const t=e.uint16()*2,r=e.position,i=e.nulltString(t);return e.seek(r+t),i}function sv(e,t){switch(t){case"double":return{type:t,value:e.float64()};case"varId":case"codepoint":case"argCount":return{type:t,value:e.uint16()};case"long":return{type:t,value:e.int32()};case"string":return{type:t,value:e.vmString()};case"funcSignature":return{type:t,value:av(e)};case"dllFuncSignature":return{type:t,value:ov(e)};default:throw new Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043E\u043F\u0435\u0440\u0430\u043D\u0434\u0430: ${t}`)}}function lv(e,t){const r=new Array,i=new Array,n=new Array,a=e.position,s=a+t;for(;e.position<s;){const o=e.position-a,c=e.uint16(),l=Jr[c],h=l&&sv(e,l);r.push(o),i.push(c),n.push(h)}return{codepoints:r,opcodes:i,operands:n}}function cv(e,t){for(let r=0;r<e.length;r++){const i=t[r];if(i===void 0||i.type!=="codepoint")continue;const n=i.value*2,a=e.indexOf(n);if(a===-1)return!1;i.value=a}return!0}function hv(e,t){const r=new Uint16Array(e),i=new Float64Array(r.length),n=new Array(r.length),a=new Array(r.length);for(let s=0;s<r.length;s++){const o=t[s];if(o===void 0)continue;switch(o.type){case"varId":r[s]|=4096,i[s]=o.value,r[s]|=Yt;break;case"argCount":case"codepoint":case"long":case"double":i[s]=o.value,r[s]|=Yt;break;case"string":n[s]=o.value,r[s]|=rn;break;case"funcSignature":a[s]=o.value,r[s]|=nn;break}}return{code:r,numberOperands:i,stringOperands:n,otherOperands:a}}function vh(e){const t=new Me(e),{codepoints:r,opcodes:i,operands:n}=lv(t,e.byteLength);if(!cv(r,n))throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u0438\u0438 \u0442\u043E\u0447\u0435\u043A \u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430.");const{code:a,numberOperands:s,stringOperands:o,otherOperands:c}=hv(i,n);if(a.length===0)throw new Error("\u041D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043E\u043F\u043A\u043E\u0434\u0430.");if(a[a.length-1]!==0)throw new Error("\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u043E\u043F\u043A\u043E\u0434 - \u043D\u0435 0.");return{code:a,numberOperands:s,stringOperands:o,otherOperands:c}}class si{constructor(){this.disks=new Map}static fromZip(r){return it(this,arguments,function*(e,t={}){const i=new TextDecoder(t.encoding||"cp866");let n;try{n=yield yh.loadAsync(e,{decodeFileName:l=>i.decode(l),createFolders:!1})}catch(l){const h=e instanceof File?`\u0424\u0430\u0439\u043B ${e.name}`:e instanceof Blob?`Blob { size: ${e.size}, type: ${e.type} }`:`ArrayBuffer(${e.byteLength})`;throw Error(`${h} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F ZIP-\u0430\u0440\u0445\u0438\u0432\u043E\u043C`)}const[a,s]=Ec(t.directory||"","Z"),o=new si;let c=new Tr(a+":",o);o.diskNew(a,c);for(const l of s)c=c.folderLocal(l);return n.forEach((l,h)=>{const u=l.split(Ea);let f=c;for(let d=0;d<u.length-1;d++)f=f.folderLocal(u[d]);h.dir||f.fileNewLocal(u[u.length-1],h)}),o})}disk(e){return this.disks.get(e.toUpperCase())}diskNew(e,t){const{disks:r}=this,i=r.size;if(this.disks.set(e,t),r.size===i)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0434\u0438\u0441\u043A\u043E\u0432: ${e}`)}merge(e){if(!(e instanceof si))throw Error("fs is not instanceof VirtualFileSystem");const{disks:t}=e,{disks:r}=this;for(const[i,n]of t){const a=r.get(i);a?a.merge(n):r.set(i,n)}return this}*search(e){for(const t of this.disks.values())for(const r of t.files(e))yield r}project(){return it(this,arguments,function*(e={}){let t,r;{let s;const o=new Array,c=e.tailPath&&Ut(e.tailPath).join("\\").toUpperCase();for(const l of this.search(/.+\.(prj)|(spj)$/i)){if(c&&!l.pathDos.toUpperCase().includes(c))continue;if(s=l,o.push(l.pathDos),e.firstMatch)break}if(!s)throw Error("\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432");if(o.length>1)throw Error(`\u041D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432:
${o.join(`
`)}`);t=s.parent,r=yield s.readAs("prj")}const i=new Set([t]);{const s=r.settings&&r.settings.classSearchPaths;if(s){const o=s.split(",").map(c=>c.trim()).filter(c=>c);for(const c of o){const l=t.get(c);l&&l.dir&&i.add(l)}}if(e.additionalClassPaths)for(const o of e.additionalClassPaths){const c=(this.disks.get("Z")||t).get(o);c&&c.dir&&i.add(c)}}for(let s of i)for(;s!==s.parent;s=s.parent)i.has(s.parent)&&i.delete(s);const n=new Map;{const s=[...i].map(l=>[...l.files(/.+\.cls$/i)]),o=new Array().concat(...s),c=yield Promise.all(o.map(l=>l.readAs("cls",vh)));for(const l of c){const h=l.name.toUpperCase(),u=n.size;if(n.set(h,l),n.size===u){const f=c.filter(d=>d.name.toUpperCase()===h).map(d=>d.filepathDos);throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: "${l.name}" \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445:
${f.join(`;
`)}.`)}}}let a;{const s=t.get("_preload.stt");if(s&&!s.dir)try{a=yield s.readAs("stt")}catch(o){console.warn(o.message)}}return new Wa({dir:t,prjInfo:r,classes:n,stt:a})})}}const za=e=>Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u0430\u0442\u0430\u043B\u043E\u0433 ${e} - \u043F\u043E \u044D\u0442\u043E\u043C\u0443 \u043F\u0443\u0442\u0438 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0444\u0430\u0439\u043B.`);class Tr{constructor(e,t,r){this.localName=e;this.fs=t;this.nodes=new Map;this.dir=!0;this.pathDos=r?r.pathDos+"\\"+e:e,this.parent=r||this}getFast(e){const t=e[0].length===2&&e[0][1]===":";let r=this;if(t){const n=this.fs.disk(e[0][0]);if(!n)return;if(e.length===1)return n;r=n}for(let n=t?1:0;n<e.length-1;n++)if(e[n]==="..")r=r.parent;else{const a=r.nodes.get(e[n].toUpperCase());if(!a||!a.dir)return;r=a}const i=e[e.length-1];return i===".."?r.parent:r.nodes.get(i.toUpperCase())}get(e){const t=Ut(e);return this.getFast(t)}fileNew(e,t){const r=Ut(e),i=this.getFast(r.slice(0,r.length-1));if(!i)return;const n=r[r.length-1],a=n.toUpperCase(),{nodes:s}=this;if(s.get(a))return;const o=new li(n,t,this);return s.set(a,o),o}folderNew(e){const t=Ut(e),r=this.getFast(t.slice(0,t.length-1));if(!r)return;const i=t[t.length-1],n=i.toUpperCase(),{nodes:a}=this;if(a.get(n))return;const s=new Tr(i,this.fs,this);return a.set(n,s),s}setLocal(e,t){const{nodes:r}=this,i=r.size;if(r.set(e.toUpperCase(),t),r.size===i)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D: ${t.pathDos}`)}fileNewLocal(e,t){const r=new li(e,t,this);return this.setLocal(e,r),r}folderLocalGet(e){const t=this.get(e);return t&&t.dir?t:void 0}folderLocal(e){const{nodes:t}=this,r=e.toUpperCase(),i=t.get(r);if(i){if(!i.dir)throw za(i.pathDos);return i}const n=new Tr(e,this.fs,this);return t.set(r,n),n}merge({nodes:e}){const{nodes:t}=this;for(const[r,i]of e){let n=t.get(r);if(n&&!n.dir)throw za(n.pathDos);if(i.dir){n||(n=new Tr(i.localName,this.fs,this),t.set(r,n)),n.merge(i);continue}if(n)throw za(n.pathDos);t.set(r,i.asSymlinkAt(this))}}*_files(){for(const e of this.nodes.values()){if(!e.dir){yield e;continue}for(const t of e._files())yield t}}*files(e){if(e)for(const t of this._files())e.test(t.pathDos)&&(yield t);else for(const t of this._files())yield t}}function _h(e){e.bytes(1)}function uv(e){_h(e),e.uint16()}function fv(e){return e.uint16()}function dv(e){const t=e.uint16(),r=e.uint16(),i=e.bytes(r);return{id:t,size:r,data:i}}function pv(e){return{foregroundColor:e.int32(),backgroundColor:e.int32(),fontHandle:e.uint16(),stringHandle:e.uint16()}}function Ct(e){uv(e)}function mv(){return fv}function gv(e){return _h(e),dv}function bv(){return pv}function wh(e){e.otPRIMARYCOLLECTION=mv,e.otDATAITEMS=gv,e.otOBJECTCOLLECTION=Ct,e.otPENCOLLECTION=Ct,e.otBRUSHCOLLECTION=Ct,e.otDOUBLEDIBCOLLECTION=Ct,e.otFONTCOLLECTION=Ct,e.otSTRINGCOLLECTION=Ct,e.otTEXTCOLLECTION=Ct,e.otDIBCOLLECTION=Ct,e.otLOGTEXTCOLLECTION=bv}var Ae;(function(e){e[e.otGROUP=1]="otGROUP",e[e.otCOLLECTION=1e3]="otCOLLECTION",e[e.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",e[e.otPENCOLLECTION=1004]="otPENCOLLECTION",e[e.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",e[e.otDIBCOLLECTION=1006]="otDIBCOLLECTION",e[e.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",e[e.otFONTCOLLECTION=1008]="otFONTCOLLECTION",e[e.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",e[e.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",e[e.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",e[e.ot3DCOLLECTION=1012]="ot3DCOLLECTION",e[e.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",e[e.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",e[e.otDATAITEMS=1022]="otDATAITEMS",e[e.otMATERIALS3D=1024]="otMATERIALS3D",e[e.otSPACE2D=17458]="otSPACE2D",e[e.otSPACE3D=17459]="otSPACE3D",e[e.otSPACE3Df=25668]="otSPACE3Df",e[e.otGROUP2D=3]="otGROUP2D",e[e.otRGROUP2D=4]="otRGROUP2D",e[e.otGROUP3D=5]="otGROUP3D",e[e.otOBJECT3D=10]="otOBJECT3D",e[e.otCAMERA3D=11]="otCAMERA3D",e[e.otLIGHT3D=12]="otLIGHT3D",e[e.otLINE2D=20]="otLINE2D",e[e.otBITMAP2D=21]="otBITMAP2D",e[e.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",e[e.otTEXT2D=23]="otTEXT2D",e[e.otVIEW3D2D=24]="otVIEW3D2D",e[e.otUSEROBJECT2D=25]="otUSEROBJECT2D",e[e.otCONTROL2D=26]="otCONTROL2D",e[e.otEDITFRAME2D=50]="otEDITFRAME2D",e[e.otROTATECENTER2D=51]="otROTATECENTER2D",e[e.otFRAME3D=52]="otFRAME3D",e[e.otAXIS3D=53]="otAXIS3D",e[e.ttPEN2D=101]="ttPEN2D",e[e.ttBRUSH2D=102]="ttBRUSH2D",e[e.ttDIB2D=103]="ttDIB2D",e[e.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",e[e.ttFONT2D=105]="ttFONT2D",e[e.ttSTRING2D=106]="ttSTRING2D",e[e.ttTEXT2D=107]="ttTEXT2D",e[e.ttREFTODIB2D=110]="ttREFTODIB2D",e[e.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",e[e.ctINFONAME=200]="ctINFONAME",e[e.ctINFOAUTOR=201]="ctINFOAUTOR",e[e.ctINFOINFO=202]="ctINFOINFO",e[e.ctCRDSYSTEM=203]="ctCRDSYSTEM",e[e.stSPACEDATA=204]="stSPACEDATA",e[e.stOBJNAME=205]="stOBJNAME"})(Ae||(Ae={}));function Sh(e){return{handle:e.uint16(),options:e.uint16(),name:e.meta.fileversion>=258&&e.meta.fileversion<768?e.string():""}}function ci(e){return Q(Q({},Sh(e)),{position:e.meta.fileversion<512?e.point2dInt():e.point2d(),size:e.meta.fileversion<512?e.point2dInt():e.point2d()})}function Th(e){return Q(Q({},Sh(e)),{childHandles:Fe(e,!0,Ae.otPRIMARYCOLLECTION).data})}function vv(e){return Th(e)}function yv(e){let t=Q(Q({},ci(e)),{penHandle:e.uint16(),brushHandle:e.uint16()});const r=e.uint16();t.points=new Array(r);for(let n=0;n<r;n++)t.points[n]=e.meta.fileversion<512?e.point2dInt():e.point2d();if(e.meta.fileversion<=512)return t;const i=e.bytes(1)[0];return i&&(t.arrows=e.bytes(i)),t}function xh(e){return Q(Q({},ci(e)),{bmpOrigin:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpSize:e.meta.fileversion<512?e.point2dInt():e.point2d(),bmpAngle:e.int16(),bmpHandle:e.uint16()})}function _v(e){return Q(Q({},ci(e)),{textToolHandle:e.uint16(),delta:e.meta.fileversion<512?e.point2dInt():e.point2d(),angle:e.int16()})}function wv(e){const t=Q(Q({},ci(e)),{classname:e.string(),text:e.string(),dwStyle:e.int32(),exStyle:e.int32(),id:e.uint16(),controlSize:e.point2dInt()});if(!["Edit","Button","ComboBox"].includes(t.classname))throw new Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u0430: ${t.classname}`);return e.uint16(),t}function Sv(e){return ci(e)}function Eh(e){e.otGROUP=Th,e.otGROUP2D=vv,e.otLINE2D=yv,e.otBITMAP2D=xh,e.otDOUBLEBITMAP2D=xh,e.otTEXT2D=_v,e.otCONTROL2D=wv,e.otSPACE2D=Sv}function At(e){return{refCount:e.uint16(),handle:e.uint16()}}function Tv(e){return Q(Q({},At(e)),{color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()})}function xv(e){return Q(Q({},At(e)),{color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()})}function Ev(e){return Q(Q({},At(e)),Ki(e))}function Cv(e){return Q(Q({},At(e)),Qr(e))}function Av(e){const t=At(e),r=e.position,i=Q(Q({},t),{height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),fontName:e.nulltString(32)});return e.seek(r+50),e.meta.fileversion>=515?(i.size=e.int32(),i.style=e.int32()):(i.size=22,i.style=0),i}function Dv(e){return Q(Q({},At(e)),{text:e.string()})}function Ov(e){return Q(Q({},At(e)),{textCollection:Fe(e,!0,Ae.otLOGTEXTCOLLECTION).data})}function Ch(e){return Q(Q({},At(e)),{filename:e.string()})}function Iv(e){return Ch(e)}function Ah(e){e.ttPEN2D=Tv,e.ttBRUSH2D=xv,e.ttDIB2D=Ev,e.ttDOUBLEDIB2D=Cv,e.ttFONT2D=Av,e.ttSTRING2D=Dv,e.ttTEXT2D=Ov,e.ttREFTODIB2D=Ch,e.ttREFTODOUBLEDIB2D=Iv}const Xa={},an={};(function(){wh(Xa),Eh(an),Ah(an)})();class xr{constructor(e){if(this.stream=e,this.start=e.position,this.code=e.int16(),e.meta.fileversion>=768&&(this.size=e.int32()),this.size<0)throw Error("chunk size < 0")}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.stream.position-this.start}readNextSubChunk(){return this.start+this.size<=this.stream.position?0:new xr(this.stream)}goEnd(){this.stream.seek(this.start+this.size)}checkReaded(){const e=this.readedBytes();if(e>this.size)throw Error(`Chunk data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk not readed: ${e} instead of ${this.size}`)}}function Fe(e,t,r){const i=new xr(e);if(i.code===-1)return;if(i.code===0)throw Error("Chunk not an object or collection");if(r!==void 0&&r!==i.code)throw Error(`Chunk code is ${i.code} instead of ${r}`);const n=i.code>999&&i.code<1200;if(t&&!n)throw Error("not a collection: "+i.code);const a=Object.keys(Ae).find(o=>Ae[o]===i.code);if(a===void 0)throw Error(`Unknown ${n?"collection":"object"}: ${i.code}`);const s=(n?Dh:Rv)(e,a);if(e.meta.fileversion<768)return Array.isArray(s)?{type:a,data:s}:Q({type:a},s);for(;i.hasData();){const o=new xr(e);switch(o.code){case Ae.otDATAITEMS:Dh(e,"otDATAITEMS");break;case Ae.stOBJNAME:s.name=e.fixedString(o.size-o.readedBytes());break;default:throw Error("Unknown postchunk: "+o.code)}}return i.checkReaded(),Array.isArray(s)?{type:a,data:s}:Q({type:a},s)}function Dh(e,t){const r=e.uint16();e.uint16(),e.uint16();const i=Xa[t];if(!i)throw Error("No get item function for "+t);const n=i(e)||Fe,a=new Array(r);for(let s=0;s<r;s++)a[s]=n(e);return a}function Rv(e,t){const r=an[t];if(!r)throw Error("No item function for "+t);return r(e)}function jv(e,t){const r=new xr(e);if(r.code!==Ae.stSPACEDATA)throw"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x";for(t.origin=e.point2d(),t.scale_div=e.point2d(),t.scale_mul=e.point2d(),t.state=e.uint16(),t.brushHandle=e.uint16(),t.layers=e.uint32(),t.defaultFlags=e.uint16();r.hasData();){const{type:i,data:n}=Fe(e,!0);t[i]=n}r.checkReaded()}function kv(e,t,r){const i=e.int32()+r,n=e.int32()+r,a=()=>e.meta.fileversion<512?e.point2dInt():e.point2d();t.origin=a(),t.scale_div=a(),t.scale_mul=a(),e.string(),t.state=e.uint16(),e.string(),e.string(),e.string(),Fe(e,!1),Fe(e,!1),t.brushHandle=e.uint16(),e.seek(i),t.otPRIMARYCOLLECTION=Fe(e,!0,Ae.otPRIMARYCOLLECTION).data,t.otOBJECTCOLLECTION=Fe(e,!0,Ae.otOBJECTCOLLECTION).data,e.seek(n);const s=e.uint16();for(let o=0;o<s;o++){const{type:c,data:l}=Fe(e,!0);t[c]=l}if(e.meta.fileversion>258){t.layers=e.uint32(),t.defaultFlags=e.uint16();let o=e.uint16();for(;o;){switch(o){case 0:break;default:return}o=e.uint16()}}else t.layers=0,t.defaultFlags=0;e.string()}function Lv(e){const t=e.uint16();if(t!==17458)throw new tt(t,17458);const r=e.position,i={fileversion:e.uint16(),minVersion:e.uint16()};return e.meta.fileversion=i.fileversion,i.fileversion>=768?jv(e,i):kv(e,i,r),i}const Nv={otBRUSHCOLLECTION:"brushTools",otPENCOLLECTION:"penTools",otDIBCOLLECTION:"bitmapTools",otDOUBLEDIBCOLLECTION:"doubleBitmapTools",otSTRINGCOLLECTION:"stringTools",otFONTCOLLECTION:"fontTools",otTEXTCOLLECTION:"textTools",otOBJECTCOLLECTION:"elements",otPRIMARYCOLLECTION:"elementOrder"};function Pv(e){for(const t of Object.keys(e)){const r=Nv[t];if(!r)continue;const i=e[t];delete e[t],e[r]=i}return e}function on(e){return Pv(Lv(e))}var he;(function(e){e[e.CR_MATH=1]="CR_MATH",e[e.CR_MATHDATA=2]="CR_MATHDATA",e[e.CR_FLAGS=4]="CR_FLAGS",e[e.CR_VARS=5]="CR_VARS",e[e.CR_CHILDS=6]="CR_CHILDS",e[e.CR_LINKS=7]="CR_LINKS",e[e.CR_ICON=8]="CR_ICON",e[e.CR_SCHEME=9]="CR_SCHEME",e[e.CR_TEXT=10]="CR_TEXT",e[e.CR_VARSIZE=11]="CR_VARSIZE",e[e.CR_IMAGE=12]="CR_IMAGE",e[e.CR_CODE=13]="CR_CODE",e[e.CR_INFO=14]="CR_INFO",e[e.CR_VARS1=15]="CR_VARS1",e[e.CR_CHILDSname=16]="CR_CHILDSname",e[e.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",e[e.CR_DEFICON=20]="CR_DEFICON",e[e.CR_CLASSTIME=21]="CR_CLASSTIME",e[e.CR_ICONFILE=22]="CR_ICONFILE",e[e.CR_HELPFILE=25]="CR_HELPFILE",e[e.CR_EQU=30]="CR_EQU",e[e.CR_MOVEINFO=31]="CR_MOVEINFO",e[e.RR_VERSION=40]="RR_VERSION",e[e.PR_MAINCLASS=100]="PR_MAINCLASS",e[e.PR_PASSWORD=101]="PR_PASSWORD",e[e.PR_VARS=102]="PR_VARS",e[e.PR_WATCH=103]="PR_WATCH",e[e.VR_CLASSES=1e3]="VR_CLASSES",e[e.VR_VARS=1001]="VR_VARS",e[e.VR_SETVAR=1002]="VR_SETVAR",e[e.CR_CLASSINFO=8e3]="CR_CLASSINFO",e[e.PPR_FIELDS=2048]="PPR_FIELDS",e[e.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",e[e.PPR_SCALEMODE=2050]="PPR_SCALEMODE",e[e.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",e[e.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",e[e.PPR_USEADDF=2053]="PPR_USEADDF",e[e.PPR_SRCRECT=2054]="PPR_SRCRECT",e[e.PPR_USESRC=2055]="PPR_USESRC",e[e.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",e[e.CLF_LOADED=1]="CLF_LOADED",e[e.CLF_PROJECT=2]="CLF_PROJECT",e[e.CLF_MODIFY=4]="CLF_MODIFY",e[e.CLF_READONLY=8]="CLF_READONLY",e[e.CLF_NORECURSE=16]="CLF_NORECURSE",e[e.CLF_ADDLIB=32]="CLF_ADDLIB",e[e.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",e[e.CLF_LIBRARY=256]="CLF_LIBRARY",e[e.CLF_PACKFILE=512]="CLF_PACKFILE",e[e.CF_PROTECTED=1]="CF_PROTECTED",e[e.CF_ONEFASE=2]="CF_ONEFASE",e[e.CF_COMPILED=4]="CF_COMPILED",e[e.CF_VIRTUAL=8]="CF_VIRTUAL",e[e.CF_SCHEME=16]="CF_SCHEME",e[e.CF_MODIFY=32]="CF_MODIFY",e[e.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",e[e.CF_BUILDIN=256]="CF_BUILDIN",e[e.CF_ICON=512]="CF_ICON",e[e.CF_PROCEDURE=1024]="CF_PROCEDURE",e[e.CF_STRUCTURE=2048]="CF_STRUCTURE",e[e.CF_USEDEFICON=4096]="CF_USEDEFICON",e[e.CF_SIZEABLE=8192]="CF_SIZEABLE",e[e.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",e[e.TCF_WASSAVE=1]="TCF_WASSAVE",e[e.TCF_NEWCLASS=2]="TCF_NEWCLASS",e[e.OF_DISABLED=1]="OF_DISABLED",e[e.OF_ONEFASE=2]="OF_ONEFASE",e[e.OF_ERROR=4]="OF_ERROR",e[e.LF_DISABLED=1]="LF_DISABLED",e[e.LF_AUTOLINK=2]="LF_AUTOLINK",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_NOREAD=4]="VF_NOREAD",e[e.VF_NOWRITE=8]="VF_NOWRITE",e[e.VF_STATIC=16]="VF_STATIC",e[e.VF_ONSCHEME=32]="VF_ONSCHEME",e[e.VF_PARAMETER=64]="VF_PARAMETER",e[e.VF_LEFT=128]="VF_LEFT",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.VF_NOSAVE=2048]="VF_NOSAVE",e[e.VF_GLOBAL=4096]="VF_GLOBAL",e[e.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",e[e.SF_EXTERNAL=1]="SF_EXTERNAL",e[e.SF_EDITING=2]="SF_EDITING",e[e.STATE_FAST=0]="STATE_FAST",e[e.STATE_VARS=1]="STATE_VARS",e[e.STATE_DEBUG=2]="STATE_DEBUG",e[e.STATE_SET=3]="STATE_SET",e[e.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",e[e.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",e[e.CHF_WASSIZED=4]="CHF_WASSIZED",e[e.CHF_PREPROCESS=8]="CHF_PREPROCESS",e[e.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",e[e.IF_CORRECTED=1]="IF_CORRECTED",e[e.EF_RUNNING=1]="EF_RUNNING",e[e.EF_MUSTSTOP=2]="EF_MUSTSTOP",e[e.EF_STEPACTIVE=4]="EF_STEPACTIVE",e[e.EF_EQUACTIVE=8]="EF_EQUACTIVE",e[e.EF_MSGACTIVE=16]="EF_MSGACTIVE",e[e.EF_BYTIMER=32]="EF_BYTIMER"})(he||(he={}));function Mv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.string(),a=e.string(),s=e.string(),o=e.string();if(o!=="FLOAT"&&o!=="HANDLE"&&o!=="STRING"&&o!=="COLORREF")throw new et(e,`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${o}.`);const c=e.int32();r[i]={name:n,description:a,defaultValue:s,type:o,flags:c}}return r}function Bv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.uint16(),a=e.uint16(),s=e.uint16(),o=e.int32(),c=e.uint16(),l=e.uint16(),h=new Array(c);for(let u=0;u<c;u++){const f=e.string(),d=e.string();h[u]={name1:f,name2:d}}r[i]={handle1:n,handle2:a,linkHandle:s,flags:o,connectedVars:h,contactPadHandle:l}}return r}function Fv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=e.string(),a=e.uint16(),s=e.string();if(!e.meta.fileversion)throw Error("filversion?");const o=e.meta.fileversion<12290?e.point2dInt():e.point2d(),c=e.byte();r[i]={classname:n,schemeInfo:{handle:a,name:s,position:o},flags:c}}return r}function Oh(e,t,r){const i=e.int32();if(i&he.SF_EXTERNAL){const a=e.string();console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${r} ${t}: \u0427\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${a}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);return}const n=e.bytes(e.int32());try{const a=new Me(n),s=on(a);if(s.source={origin:"class",name:t},a.position!==a.size){const o=`${r} ${t}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${a.position} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${a.size-a.position}. v0x${a.meta.fileversion&&a.meta.fileversion.toString(16)}.`;console.warn(o)}return s}catch(a){console.warn(`${r} ${t}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${a.message}`);return}}function Ih(e){const t=e.uint16();if(t!==16979)throw new tt(e,t,16979);const r=e.int32();e.int32(),e.int32();const i=e.string();return{name:i,version:r}}function Rh(e,t,r){const i={};let n=e.uint16();if(n===he.CR_VARS1&&(i.vars=Mv(e),n=e.uint16()),n===he.CR_LINKS&&(i.links=Bv(e),n=e.uint16()),(n===he.CR_CHILDSnameXY||n===he.CR_CHILDSname||n===he.CR_CHILDS)&&(i.children=Fv(e),n=e.uint16()),n===he.CR_ICON){const a=e.int32();e.skip(a-4),n=e.uint16()}if(n===he.CR_SCHEME){const a=e.int32();r.readScheme?i.scheme=Oh(e,t,"\u0421\u0445\u0435\u043C\u0430"):e.skip(a-4),n=e.uint16()}if(n===he.CR_IMAGE){const a=e.int32();r.readImage?i.image=Oh(e,t,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"):e.skip(a-4),n=e.uint16()}if(n===he.CR_TEXT&&(i.sourceCode=e.string(),n=e.uint16()),n===he.CR_INFO&&(i.description=e.string(),n=e.uint16()),n===he.CR_VARSIZE&&(i.varsize=e.uint16(),n=e.uint16()),n===he.CR_FLAGS&&(i.flags=e.int32(),n=e.uint16()),n===he.CR_DEFICON&&(i.iconIndex=e.uint16(),n=e.uint16()),n===he.CR_ICONFILE&&(i.iconFile=e.string(),n=e.uint16()),n===he.CR_CODE){const a=e.int32()*2;if(r.parseBytecode!==void 0)try{i.code=r.parseBytecode(e.bytes(a))}catch(s){throw new et(e,s.message+" (\u0431\u0430\u0439\u0442\u043A\u043E\u0434)")}else e.skip(a);n=e.uint16()}if(n===he.CR_EQU)return console.warn(e.meta.filepathDos+`:
\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F.`),i;if(n!==he.CR_CLASSTIME&&e.meta.fileversion===12291)throw new et(e,"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0445\u043E\u0434\u0435 \u0447\u0442\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u043C\u0438\u0434\u0436\u0430.");return i}function Gv(e){const t=e.map(r=>Qc(r.type));return{varNameToId:new Map(e.map((r,i)=>[r.name.toLowerCase(),i])),names:e.map(r=>r.name),typeCodes:t,defaultValues:e.map((r,i)=>r.defaultValue===""?void 0:tn(t[i],r.defaultValue))}}class jh{get body(){const{__body:e}=this;if(e.loaded)return e.body;const t=Rh(e.stream,this.name,this._blocks);return this.__body={loaded:!0,body:t},t}constructor(e,t){this.filepathDos=e.meta.filepathDos,this.directoryDos=this.filepathDos&&Cc(this.filepathDos),this._blocks={readScheme:!0,readImage:!0,parseBytecode:t},this.header=Ih(e),e.meta.fileversion=this.header.version,this.__body={loaded:!1,stream:e}}get name(){return this.header.name}get children(){return this.body.children}get vars(){if(this._vars)return this._vars;const e=this.body.vars;if(!e)return;const t=Gv(e);return this._vars=t,t}get links(){return this.body.links}get image(){return this.body.image}get iconFile(){return this.body.iconFile}get scheme(){return this.body.scheme}get code(){return this.body.code}}const Vv={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone"};function Uv(e){const t={},r=e.uint16();for(let i=0;i<r;i++){const n=e.uint16(),a=e.byte(),s=e.byte(),o=e.fixedString(s-1);e.byte();let c;switch(a){case 0:c=e.int32();break;case 1:c=e.float64();break;case 2:c=e.fixedString(n-s-3),e.byte();break;default:throw new et(e,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${a}`)}const l=Vv[o];l?t[l]=c:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${o} (${c})`)}return t}function Hv(e){const t=e.uint16(),r=new Array(t);for(let i=0;i<t;i++){const n=Array.from({length:e.uint16()},()=>e.uint16()),a=e.string(),s=e.string();r[i]={path:n,name:a,info:s}}return r}function kh(e){const t=e.uint16();if(t!==26697)throw new tt(e,t,26697);const r={rootClassName:""};let i=0;for(;(i=e.uint16())!==0;)switch(i){case he.PR_PASSWORD:e.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case he.PR_MAINCLASS:r.rootClassName=e.string();break;case he.PR_VARS:r.settings=Uv(e);break;case he.PR_WATCH:r.watchedVariables=Hv(e);break}if(!r.rootClassName)throw new et(e,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}function Lh(e){const t=e.int32(),r=e.uint16(),i=e.string(),n=e.int32(),a=Array.from({length:e.uint16()},()=>({name:e.string(),value:e.string()})),s=[];for(;e.position<t;)s.push(Lh(e));return{handle:r,classname:i,classId:n,values:a,childSets:s}}function Nh(e){const t=e.uint16();if(t!==19)throw new tt(e,t,19);e.seek(21),e.string(),e.uint16(),e.uint16();switch(e.uint16()){case he.VR_CLASSES:throw new et(e,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case he.VR_SETVAR:return Lh(e)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}class li{constructor(e,t,r){this.localName=e;this.dir=!1;this.buf=t,this.parent=r,this.pathDos=r.pathDos+"\\"+e}asSymlinkAt(e,t){return new li(t||this.localName,this.buf,e)}arraybuffer(){return it(this,null,function*(){return this.buf instanceof ArrayBuffer||(this.buf=yield this.buf.async("arraybuffer")),this.buf})}arraybufferSync(){return this.buf instanceof ArrayBuffer?this.buf:void 0}makeSync(){return it(this,null,function*(){yield this.arraybuffer()})}read(e,t,r){const i=new Me(e,{filepathDos:this.pathDos});switch(t){case"prj":return kh(i);case"cls":return new jh(i,r);case"stt":return Nh(i);case"vdr":try{const n=on(i);if(n.source={origin:"file",name:this.pathDos},i.position!==i.size){const a=`${this.pathDos}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${i.position} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${i.size-i.position}. v0x${i.meta.fileversion&&i.meta.fileversion.toString(16)}.`;console.warn(a)}return n}catch(n){console.warn(`${this.pathDos}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: ${n.message}`);return}}}readAs(e,t){return it(this,null,function*(){const r=yield this.arraybuffer();return this.read(r,e,t)})}readSyncAs(e,t){const r=this.arraybufferSync();return r&&this.read(r,e,t)}}function Ph(e,t){return si.fromZip(e,t)}return Pa();})();
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
