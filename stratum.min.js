(()=>{var Go=Object.create,bt=Object.defineProperty,zo=Object.getPrototypeOf,Pr=Object.prototype.hasOwnProperty,Ko=Object.getOwnPropertyNames,Zo=Object.getOwnPropertyDescriptor,Ar=Object.getOwnPropertySymbols,Qo=Object.prototype.propertyIsEnumerable;var Mr=(t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$=(t,e)=>{for(var r in e||(e={}))Pr.call(e,r)&&Mr(t,r,e[r]);if(Ar)for(var r of Ar(e))Qo.call(e,r)&&Mr(t,r,e[r]);return t},Jo=t=>bt(t,"__esModule",{value:!0});var qo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ea=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ko(e))!Pr.call(t,i)&&i!=="default"&&bt(t,i,{get:()=>e[i],enumerable:!(r=Zo(e,i))||r.enumerable});return t},ta=t=>ea(Jo(bt(t!=null?Go(zo(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Y=(t,e,r)=>new Promise((i,n)=>{var s=c=>{try{u(r.next(c))}catch(m){n(m)}},a=c=>{try{u(r.throw(c))}catch(m){n(m)}},u=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);u((r=r.apply(t,e)).next())});var si=qo((lu,ii)=>{ii.exports=function(){"use strict";function t(i,n){function s(){this.constructor=i}s.prototype=n.prototype,i.prototype=new s}function e(i,n,s,a){this.message=i,this.expected=n,this.found=s,this.location=a,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}t(e,Error),e.buildMessage=function(i,n){var s={literal:function(f){return'"'+u(f.text)+'"'},class:function(f){var y="",g;for(g=0;g<f.parts.length;g++)y+=f.parts[g]instanceof Array?c(f.parts[g][0])+"-"+c(f.parts[g][1]):c(f.parts[g]);return"["+(f.inverted?"^":"")+y+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function u(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function m(f){return s[f.type](f)}function d(f){var y=new Array(f.length),g,R;for(g=0;g<f.length;g++)y[g]=m(f[g]);if(y.sort(),y.length>0){for(g=1,R=1;g<y.length;g++)y[g-1]!==y[g]&&(y[R]=y[g],R++);y.length=R}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function S(f){return f?'"'+u(f)+'"':"end of input"}return"Expected "+d(i)+" but "+S(n)+" found."};function r(i,n){n=n!==void 0?n:{};var s={},a={Code:Dr},u=Dr,c=function(o){return o},m=function(o){return o.filter(l=>l)},d=j("variable name"),S=function(o){return{type:"var",name:o}},f=",",y=A(",",!1),g=function(o){return o},R=j("function call"),O="(",M=A("(",!1),F=")",V=A(")",!1),x=function(o,l){return{type:"call",name:o,args:l}},q="-",Ye=A("-",!1),rt="!",it=A("!",!1),st=j("!<operand> or -<operand>"),D=function(o,l){return{type:o,op:l}},U=j("(<expression>)"),$i=function(o){return{type:"subexpr",expr:o}},ki=j("operand"),Ui="~",Vi=A("~",!1),Hi=function(o,l){return $($({},l),{isNew:!!o})},Ci="^",Wi=A("^",!1),ji=function(){return"**"},Xi="*",Yi=A("*",!1),Gi="/",zi=A("/",!1),Ki="%",Zi=A("%",!1),Qi="+",Ji=A("+",!1),qt=">=",qi=A(">=",!1),es=">",ts=A(">",!1),er="<=",rs=A("<=",!1),is="<",ss=A("<",!1),tr="==",ns=A("==",!1),rr="!=",os=A("!=",!1),ir="&&",as=A("&&",!1),us="&",ls=A("&",!1),sr="||",hs=A("||",!1),cs="|",ms=A("|",!1),bs=j("expression"),nr=function(o,l,p){return{action:l,operand:p}},ps=function(o,l){return{first:o,rest:l}},or=function(o,l){return l},ds=function(o,l){return[o].concat(l)},ar=function(o,l){return l},fs=function(o,l,p){return{type:"varsDec",datatype:o,modifiers:l,names:p}},gs=j("assigment operator"),ur=":=",_s=A(":=",!1),lr="::=",Ts=A("::=",!1),Ss=function(o,l,p){return{type:l,to:o,expr:p}},ws=j("equality operator"),ys="=",Es=A("=",!1),vs=function(o,l,p){return{type:l,first:o,second:p}},Is=j("function call chain"),hr=function(o,l){return l},Rs=function(o,l){return{type:"callChain",functions:[o].concat(l)}},cr=j("( <expression> )"),mr=function(o){return o},Ds=j("if(<condition>)"),Os="if",xs=A("if",!0),Bs=function(o){return{type:"if",expr:o}},Ns=j("while(<condition>)"),Ps="while",As=A("while",!0),Ms=function(o){return{type:"while",expr:o}},Fs=j("until(<condition>)"),Ls="until",$s=A("until",!0),ks=function(o){return{type:"until",expr:o}},Us=j("case(<condition>)"),Vs="case",Hs=A("case",!0),Cs=function(o,l){return{type:"case",expr:o,then:l}},Ws="else",js=A("else",!0),Xs=function(o){return{type:"else",then:o}},Ys="endif",Gs=A("endif",!0),zs=function(o){return{type:"endif",then:o}},Ks="break",Zs=A("break",!0),Qs=function(){return{type:"break"}},Js="endwhile",qs=A("endwhile",!0),en=function(){return{type:"endwhile"}},tn="do",rn=A("do",!0),sn=function(){return{type:"do"}},nn="endswitch",on=A("endswitch",!0),an=function(){return{type:"endswitch"}},un="switch",ln=A("switch",!0),hn=function(){return{type:"switch"}},cn="default",mn=A("default",!0),bn=function(o){return{type:"default",then:o}},pn="function",dn=A("function",!0),fn=function(){return{type:"function"}},gn=j("return <var name>"),_n="return",Tn=A("return",!0),Sn=function(o){return{type:"return",to:o}},wn="handle",yn=A("HANDLE",!0),En=function(){return"HANDLE"},vn="string",In=A("STRING",!0),Rn=function(){return"STRING"},Dn="float",On=A("FLOAT",!0),xn=function(){return"FLOAT"},Bn="colorref",Nn=A("COLORREF",!0),Pn=function(){return"COLORREF"},An="integer",Mn=A("INTEGER",!0),Fn=function(){return"INTEGER"},Ln="local",$n=A("LOCAL",!0),kn=function(){return"LOCAL"},Un="nosave",Vn=A("NOSAVE",!0),Hn=function(){return"NOSAVE"},Cn="parameter",Wn=A("PARAMETER",!0),jn=function(){return"PARAMETER"},br=/^[_a-z\u0430-\u044F0-9]/i,pr=me(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),Xn=j("function name"),nt=/^[0-9]/,ot=me([["0","9"]],!1,!1),Yn=".",Gn=A(".",!1),zn=/^[eE]/,Kn=me(["e","E"],!1,!1),Zn=/^[+\-]/,Qn=me(["+","-"],!1,!1),Jn=j("float"),qn=function(o){return{type:"float",value:parseFloat(o)}},eo=j("handle"),to="#",ro=A("#",!1),io=function(o){return{type:"handle",value:o.length>0?parseInt(o):0}},dr="'",fr=A("'",!1),gr=/^[^']/,_r=me(["'"],!0,!1),Tr='"',Sr=A('"',!1),wr=/^[^"]/,yr=me(['"'],!0,!1),so=function(o){return{type:"string",value:o[1]}},no=j("space or tab"),oo=/^[ \t]/,ao=me([" ","	"],!1,!1),uo=j("new line"),lo=`
`,ho=A(`
`,!1),co=j("whitespace"),Er=/^[ \t\n\r]/,vr=me([" ","	",`
`,"\r"],!1,!1),h=0,N=0,at=[{line:1,column:1}],re=0,At=[],_=0,ut;if("startRule"in n){if(!(n.startRule in a))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=a[n.startRule]}function La(){return i.substring(N,h)}function $a(){return Ge(N,h)}function ka(o,l){throw l=l!==void 0?l:Ge(N,h),Rr([j(o)],i.substring(N,h),l)}function Ua(o,l){throw l=l!==void 0?l:Ge(N,h),bo(o,l)}function A(o,l){return{type:"literal",text:o,ignoreCase:l}}function me(o,l,p){return{type:"class",parts:o,inverted:l,ignoreCase:p}}function Va(){return{type:"any"}}function mo(){return{type:"end"}}function j(o){return{type:"other",description:o}}function Ir(o){var l=at[o],p;if(l)return l;for(p=o-1;!at[p];)p--;for(l=at[p],l={line:l.line,column:l.column};p<o;)i.charCodeAt(p)===10?(l.line++,l.column=1):l.column++,p++;return at[o]=l,l}function Ge(o,l){var p=Ir(o),b=Ir(l);return{start:{offset:o,line:p.line,column:p.column},end:{offset:l,line:b.line,column:b.column}}}function E(o){h<re||(h>re&&(re=h,At=[]),At.push(o))}function bo(o,l){return new e(o,null,null,l)}function Rr(o,l,p){return new e(e.buildMessage(o,l),o,l,p)}function Dr(){var o,l,p,b,T,w,L;for(o=h,l=[],p=h,b=[],T=B();T!==s;)b.push(T),T=B();if(b!==s)if(T=Mt(),T===s&&(T=null),T!==s){for(w=[],L=B();L!==s;)w.push(L),L=B();w!==s?(L=Nr(),L!==s?(N=p,b=c(T),p=b):(h=p,p=s)):(h=p,p=s)}else h=p,p=s;else h=p,p=s;for(;p!==s;){for(l.push(p),p=h,b=[],T=B();T!==s;)b.push(T),T=B();if(b!==s)if(T=Mt(),T===s&&(T=null),T!==s){for(w=[],L=B();L!==s;)w.push(L),L=B();w!==s?(L=Nr(),L!==s?(N=p,b=c(T),p=b):(h=p,p=s)):(h=p,p=s)}else h=p,p=s;else h=p,p=s}return l!==s&&(N=o,l=m(l)),o=l,o}function po(){var o,l;return _++,o=h,l=Se(),l!==s&&(N=o,l=S(l)),o=l,_--,o===s&&(l=s,_===0&&E(d)),o}function Or(){var o,l,p,b,T;for(o=h,l=[],p=B();p!==s;)l.push(p),p=B();if(l!==s)if(p=Te(),p!==s){for(b=[],T=B();T!==s;)b.push(T),T=B();b!==s?(i.charCodeAt(h)===44?(T=f,h++):(T=s,_===0&&E(y)),T===s&&(T=null),T!==s?(N=o,l=g(p),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;return o}function lt(){var o,l,p,b,T,w,L,k;if(_++,o=h,l=Ho(),l!==s){for(p=[],b=B();b!==s;)p.push(b),b=B();if(p!==s)if(i.charCodeAt(h)===40?(b=O,h++):(b=s,_===0&&E(M)),b!==s){for(T=[],w=B();w!==s;)T.push(w),w=B();if(T!==s){for(w=[],L=Or();L!==s;)w.push(L),L=Or();if(w!==s){for(L=[],k=B();k!==s;)L.push(k),k=B();L!==s?(i.charCodeAt(h)===41?(k=F,h++):(k=s,_===0&&E(V)),k!==s?(N=o,l=x(l,w),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s}else h=o,o=s}else h=o,o=s;else h=o,o=s}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(R)),o}function fo(){var o;return i.charCodeAt(h)===45?(o=q,h++):(o=s,_===0&&E(Ye)),o===s&&(i.charCodeAt(h)===33?(o=rt,h++):(o=s,_===0&&E(it))),o}function go(){var o,l,p,b;if(_++,o=h,l=fo(),l!==s){for(p=[],b=B();b!==s;)p.push(b),b=B();p!==s?(b=ht(),b!==s?(N=o,l=D(l,b),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(st)),o}function _o(){var o,l,p,b,T,w;if(_++,o=h,i.charCodeAt(h)===40?(l=O,h++):(l=s,_===0&&E(M)),l!==s){for(p=[],b=B();b!==s;)p.push(b),b=B();if(p!==s)if(b=Te(),b!==s){for(T=[],w=B();w!==s;)T.push(w),w=B();T!==s?(i.charCodeAt(h)===41?(w=F,h++):(w=s,_===0&&E(V)),w!==s?(N=o,l=$i(b),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(U)),o}function ht(){var o,l,p,b;if(_++,o=h,i.charCodeAt(h)===126?(l=Ui,h++):(l=s,_===0&&E(Vi)),l===s&&(l=null),l!==s){for(p=[],b=B();b!==s;)p.push(b),b=B();p!==s?(b=go(),b===s&&(b=jo(),b===s&&(b=Xo(),b===s&&(b=Yo(),b===s&&(b=lt(),b===s&&(b=po(),b===s&&(b=_o())))))),b!==s?(N=o,l=Hi(l,b),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(ki)),o}function xr(){var o,l;return o=h,i.charCodeAt(h)===94?(l=Ci,h++):(l=s,_===0&&E(Wi)),l!==s&&(N=o,l=ji()),o=l,o===s&&(i.charCodeAt(h)===42?(o=Xi,h++):(o=s,_===0&&E(Yi)),o===s&&(i.charCodeAt(h)===47?(o=Gi,h++):(o=s,_===0&&E(zi)),o===s&&(i.charCodeAt(h)===37?(o=Ki,h++):(o=s,_===0&&E(Zi)),o===s&&(i.charCodeAt(h)===43?(o=Qi,h++):(o=s,_===0&&E(Ji)),o===s&&(i.charCodeAt(h)===45?(o=q,h++):(o=s,_===0&&E(Ye)),o===s&&(i.substr(h,2)===qt?(o=qt,h+=2):(o=s,_===0&&E(qi)),o===s&&(i.charCodeAt(h)===62?(o=es,h++):(o=s,_===0&&E(ts)),o===s&&(i.substr(h,2)===er?(o=er,h+=2):(o=s,_===0&&E(rs)),o===s&&(i.charCodeAt(h)===60?(o=is,h++):(o=s,_===0&&E(ss)),o===s&&(i.substr(h,2)===tr?(o=tr,h+=2):(o=s,_===0&&E(ns)),o===s&&(i.substr(h,2)===rr?(o=rr,h+=2):(o=s,_===0&&E(os)),o===s&&(i.substr(h,2)===ir?(o=ir,h+=2):(o=s,_===0&&E(as)),o===s&&(i.charCodeAt(h)===38?(o=us,h++):(o=s,_===0&&E(ls)),o===s&&(i.substr(h,2)===sr?(o=sr,h+=2):(o=s,_===0&&E(hs)),o===s&&(i.charCodeAt(h)===124?(o=cs,h++):(o=s,_===0&&E(ms))))))))))))))))),o}function Te(){var o,l,p,b,T,w,L,k;if(_++,o=h,l=ht(),l!==s){for(p=[],b=h,T=[],w=B();w!==s;)T.push(w),w=B();if(T!==s)if(w=xr(),w!==s){for(L=[],k=B();k!==s;)L.push(k),k=B();L!==s?(k=ht(),k!==s?(N=b,T=nr(l,w,k),b=T):(h=b,b=s)):(h=b,b=s)}else h=b,b=s;else h=b,b=s;for(;b!==s;){for(p.push(b),b=h,T=[],w=B();w!==s;)T.push(w),w=B();if(T!==s)if(w=xr(),w!==s){for(L=[],k=B();k!==s;)L.push(k),k=B();L!==s?(k=ht(),k!==s?(N=b,T=nr(l,w,k),b=T):(h=b,b=s)):(h=b,b=s)}else h=b,b=s;else h=b,b=s}p!==s?(N=o,l=ps(l,p),o=l):(h=o,o=s)}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(bs)),o}function To(){var o,l,p,b,T,w,L,k;if(o=h,l=Se(),l!==s){for(p=[],b=h,T=ee(),T!==s?(i.charCodeAt(h)===44?(w=f,h++):(w=s,_===0&&E(y)),w!==s?(L=ee(),L!==s?(k=Se(),k!==s?(N=b,T=or(l,k),b=T):(h=b,b=s)):(h=b,b=s)):(h=b,b=s)):(h=b,b=s);b!==s;)p.push(b),b=h,T=ee(),T!==s?(i.charCodeAt(h)===44?(w=f,h++):(w=s,_===0&&E(y)),w!==s?(L=ee(),L!==s?(k=Se(),k!==s?(N=b,T=or(l,k),b=T):(h=b,b=s)):(h=b,b=s)):(h=b,b=s)):(h=b,b=s);p!==s?(N=o,l=ds(l,p),o=l):(h=o,o=s)}else h=o,o=s;return o}function So(){var o,l,p,b,T,w,L,k,ie;if(o=h,l=Vo(),l!==s){if(p=[],b=B(),b!==s)for(;b!==s;)p.push(b),b=B();else p=s;if(p!==s)if(b=ee(),b!==s){if(T=[],w=h,L=Br(),L!==s){if(k=[],ie=B(),ie!==s)for(;ie!==s;)k.push(ie),ie=B();else k=s;k!==s?(N=w,L=ar(l,L),w=L):(h=w,w=s)}else h=w,w=s;for(;w!==s;)if(T.push(w),w=h,L=Br(),L!==s){if(k=[],ie=B(),ie!==s)for(;ie!==s;)k.push(ie),ie=B();else k=s;k!==s?(N=w,L=ar(l,L),w=L):(h=w,w=s)}else h=w,w=s;T!==s?(w=To(),w!==s?(N=o,l=fs(l,T,w),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return o}function wo(){var o,l,p,b,T,w;if(_++,o=h,l=Se(),l!==s)if(p=ee(),p!==s)if(i.substr(h,2)===ur?(b=ur,h+=2):(b=s,_===0&&E(_s)),b===s&&(i.substr(h,3)===lr?(b=lr,h+=3):(b=s,_===0&&E(Ts))),b!==s){for(T=[],w=B();w!==s;)T.push(w),w=B();T!==s?(w=Te(),w!==s?(N=o,l=Ss(l,b,w),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(gs)),o}function yo(){var o,l,p,b,T,w;if(_++,o=h,l=Te(),l!==s)if(p=ee(),p!==s)if(i.charCodeAt(h)===61?(b=ys,h++):(b=s,_===0&&E(Es)),b!==s){for(T=[],w=B();w!==s;)T.push(w),w=B();T!==s?(w=Te(),w!==s?(N=o,l=vs(l,b,w),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(ws)),o}function Eo(){var o,l,p,b,T,w;if(_++,o=h,l=lt(),l!==s){if(p=[],b=h,T=[],w=B(),w!==s)for(;w!==s;)T.push(w),w=B();else T=s;for(T!==s?(w=lt(),w!==s?(N=b,T=hr(l,w),b=T):(h=b,b=s)):(h=b,b=s);b!==s;){if(p.push(b),b=h,T=[],w=B(),w!==s)for(;w!==s;)T.push(w),w=B();else T=s;T!==s?(w=lt(),w!==s?(N=b,T=hr(l,w),b=T):(h=b,b=s)):(h=b,b=s)}p!==s?(N=o,l=Rs(l,p),o=l):(h=o,o=s)}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(Is)),o}function vo(){var o,l,p,b,T,w;if(_++,o=h,i.charCodeAt(h)===40?(l=O,h++):(l=s,_===0&&E(M)),l!==s){for(p=[],b=B();b!==s;)p.push(b),b=B();if(p!==s)if(b=Te(),b!==s){for(T=[],w=B();w!==s;)T.push(w),w=B();T!==s?(i.charCodeAt(h)===41?(w=F,h++):(w=s,_===0&&E(V)),w!==s?(N=o,l=mr(b),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(cr)),o}function Io(){var o,l,p,b,T;for(_++,o=h,l=[],p=B();p!==s;)l.push(p),p=B();if(l!==s)if(p=Te(),p!==s){for(b=[],T=B();T!==s;)b.push(T),T=B();b!==s?(i.charCodeAt(h)===41?(T=F,h++):(T=s,_===0&&E(V)),T!==s?(N=o,l=mr(p),o=l):(h=o,o=s)):(h=o,o=s)}else h=o,o=s;else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(cr)),o}function ct(){var o;return o=vo(),o===s&&(o=Io()),o}function mt(){var o,l,p;if(o=h,l=[],p=B(),p!==s)for(;p!==s;)l.push(p),p=B();else l=s;return l!==s?(p=Mt(),p!==s?(N=o,l=g(p),o=l):(h=o,o=s)):(h=o,o=s),o}function Ro(){var o,l,p,b;return _++,o=h,i.substr(h,2).toLowerCase()===Os?(l=i.substr(h,2),h+=2):(l=s,_===0&&E(xs)),l!==s?(p=ee(),p!==s?(b=ct(),b!==s?(N=o,l=Bs(b),o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),_--,o===s&&(l=s,_===0&&E(Ds)),o}function Do(){var o,l,p,b;return _++,o=h,i.substr(h,5).toLowerCase()===Ps?(l=i.substr(h,5),h+=5):(l=s,_===0&&E(As)),l!==s?(p=ee(),p!==s?(b=ct(),b!==s?(N=o,l=Ms(b),o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),_--,o===s&&(l=s,_===0&&E(Ns)),o}function Oo(){var o,l,p,b;return _++,o=h,i.substr(h,5).toLowerCase()===Ls?(l=i.substr(h,5),h+=5):(l=s,_===0&&E($s)),l!==s?(p=ee(),p!==s?(b=ct(),b!==s?(N=o,l=ks(b),o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),_--,o===s&&(l=s,_===0&&E(Fs)),o}function xo(){var o,l,p,b,T;return _++,o=h,i.substr(h,4).toLowerCase()===Vs?(l=i.substr(h,4),h+=4):(l=s,_===0&&E(Hs)),l!==s?(p=ee(),p!==s?(b=ct(),b!==s?(T=mt(),T===s&&(T=null),T!==s?(N=o,l=Cs(b,T),o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),_--,o===s&&(l=s,_===0&&E(Us)),o}function Bo(){var o,l,p;return o=h,i.substr(h,4).toLowerCase()===Ws?(l=i.substr(h,4),h+=4):(l=s,_===0&&E(js)),l!==s?(p=mt(),p===s&&(p=null),p!==s?(N=o,l=Xs(p),o=l):(h=o,o=s)):(h=o,o=s),o}function No(){var o,l,p;return o=h,i.substr(h,5).toLowerCase()===Ys?(l=i.substr(h,5),h+=5):(l=s,_===0&&E(Gs)),l!==s?(p=mt(),p===s&&(p=null),p!==s?(N=o,l=zs(p),o=l):(h=o,o=s)):(h=o,o=s),o}function Po(){var o,l;return o=h,i.substr(h,5).toLowerCase()===Ks?(l=i.substr(h,5),h+=5):(l=s,_===0&&E(Zs)),l!==s&&(N=o,l=Qs()),o=l,o}function Ao(){var o,l;return o=h,i.substr(h,8).toLowerCase()===Js?(l=i.substr(h,8),h+=8):(l=s,_===0&&E(qs)),l!==s&&(N=o,l=en()),o=l,o}function Mo(){var o,l;return o=h,i.substr(h,2).toLowerCase()===tn?(l=i.substr(h,2),h+=2):(l=s,_===0&&E(rn)),l!==s&&(N=o,l=sn()),o=l,o}function Fo(){var o,l;return o=h,i.substr(h,9).toLowerCase()===nn?(l=i.substr(h,9),h+=9):(l=s,_===0&&E(on)),l!==s&&(N=o,l=an()),o=l,o}function Lo(){var o,l;return o=h,i.substr(h,6).toLowerCase()===un?(l=i.substr(h,6),h+=6):(l=s,_===0&&E(ln)),l!==s&&(N=o,l=hn()),o=l,o}function $o(){var o,l,p;return o=h,i.substr(h,7).toLowerCase()===cn?(l=i.substr(h,7),h+=7):(l=s,_===0&&E(mn)),l!==s?(p=mt(),p===s&&(p=null),p!==s?(N=o,l=bn(p),o=l):(h=o,o=s)):(h=o,o=s),o}function ko(){var o,l;return o=h,i.substr(h,8).toLowerCase()===pn?(l=i.substr(h,8),h+=8):(l=s,_===0&&E(dn)),l!==s&&(N=o,l=fn()),o=l,o}function Uo(){var o,l,p,b;return _++,o=h,i.substr(h,6).toLowerCase()===_n?(l=i.substr(h,6),h+=6):(l=s,_===0&&E(Tn)),l!==s?(p=ee(),p!==s?(b=Se(),b!==s?(N=o,l=Sn(b),o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),_--,o===s&&(l=s,_===0&&E(gn)),o}function Mt(){var o;return o=So(),o===s&&(o=wo(),o===s&&(o=yo(),o===s&&(o=Ro(),o===s&&(o=Bo(),o===s&&(o=No(),o===s&&(o=Po(),o===s&&(o=Do(),o===s&&(o=Ao(),o===s&&(o=Mo(),o===s&&(o=Oo(),o===s&&(o=Fo(),o===s&&(o=Lo(),o===s&&(o=xo(),o===s&&(o=$o(),o===s&&(o=Eo(),o===s&&(o=ko(),o===s&&(o=Uo()))))))))))))))))),o}function Vo(){var o,l;return o=h,i.substr(h,6).toLowerCase()===wn?(l=i.substr(h,6),h+=6):(l=s,_===0&&E(yn)),l!==s&&(N=o,l=En()),o=l,o===s&&(o=h,i.substr(h,6).toLowerCase()===vn?(l=i.substr(h,6),h+=6):(l=s,_===0&&E(In)),l!==s&&(N=o,l=Rn()),o=l,o===s&&(o=h,i.substr(h,5).toLowerCase()===Dn?(l=i.substr(h,5),h+=5):(l=s,_===0&&E(On)),l!==s&&(N=o,l=xn()),o=l,o===s&&(o=h,i.substr(h,8).toLowerCase()===Bn?(l=i.substr(h,8),h+=8):(l=s,_===0&&E(Nn)),l!==s&&(N=o,l=Pn()),o=l,o===s&&(o=h,i.substr(h,7).toLowerCase()===An?(l=i.substr(h,7),h+=7):(l=s,_===0&&E(Mn)),l!==s&&(N=o,l=Fn()),o=l)))),o}function Br(){var o,l;return o=h,i.substr(h,5).toLowerCase()===Ln?(l=i.substr(h,5),h+=5):(l=s,_===0&&E($n)),l!==s&&(N=o,l=kn()),o=l,o===s&&(o=h,i.substr(h,6).toLowerCase()===Un?(l=i.substr(h,6),h+=6):(l=s,_===0&&E(Vn)),l!==s&&(N=o,l=Hn()),o=l,o===s&&(o=h,i.substr(h,9).toLowerCase()===Cn?(l=i.substr(h,9),h+=9):(l=s,_===0&&E(Wn)),l!==s&&(N=o,l=jn()),o=l)),o}function Se(){var o,l,p;if(_++,o=h,l=[],br.test(i.charAt(h))?(p=i.charAt(h),h++):(p=s,_===0&&E(pr)),p!==s)for(;p!==s;)l.push(p),br.test(i.charAt(h))?(p=i.charAt(h),h++):(p=s,_===0&&E(pr));else l=s;return l!==s?o=i.substring(o,h):o=l,_--,o===s&&(l=s,_===0&&E(d)),o}function Ho(){var o,l;return _++,o=Se(),_--,o===s&&(l=s,_===0&&E(Xn)),o}function Ft(){var o,l;if(o=[],nt.test(i.charAt(h))?(l=i.charAt(h),h++):(l=s,_===0&&E(ot)),l!==s)for(;l!==s;)o.push(l),nt.test(i.charAt(h))?(l=i.charAt(h),h++):(l=s,_===0&&E(ot));else o=s;return o}function Co(){var o,l,p;return o=h,i.charCodeAt(h)===46?(l=Yn,h++):(l=s,_===0&&E(Gn)),l!==s?(p=Ft(),p!==s?(l=[l,p],o=l):(h=o,o=s)):(h=o,o=s),o}function Wo(){var o,l,p,b;return o=h,zn.test(i.charAt(h))?(l=i.charAt(h),h++):(l=s,_===0&&E(Kn)),l!==s?(Zn.test(i.charAt(h))?(p=i.charAt(h),h++):(p=s,_===0&&E(Qn)),p===s&&(p=null),p!==s?(b=Ft(),b!==s?(l=[l,p,b],o=l):(h=o,o=s)):(h=o,o=s)):(h=o,o=s),o}function jo(){var o,l,p,b,T,w;return _++,o=h,l=h,p=h,b=Ft(),b!==s?(T=Co(),T===s&&(T=null),T!==s?(w=Wo(),w===s&&(w=null),w!==s?(b=[b,T,w],p=b):(h=p,p=s)):(h=p,p=s)):(h=p,p=s),p!==s?l=i.substring(l,h):l=p,l!==s&&(N=o,l=qn(l)),o=l,_--,o===s&&(l=s,_===0&&E(Jn)),o}function Xo(){var o,l,p,b,T;if(_++,o=h,i.charCodeAt(h)===35?(l=to,h++):(l=s,_===0&&E(ro)),l!==s){for(p=h,b=[],nt.test(i.charAt(h))?(T=i.charAt(h),h++):(T=s,_===0&&E(ot));T!==s;)b.push(T),nt.test(i.charAt(h))?(T=i.charAt(h),h++):(T=s,_===0&&E(ot));b!==s?p=i.substring(p,h):p=b,p!==s?(N=o,l=io(p),o=l):(h=o,o=s)}else h=o,o=s;return _--,o===s&&(l=s,_===0&&E(eo)),o}function Yo(){var o,l,p,b,T,w;if(o=h,l=h,i.charCodeAt(h)===39?(p=dr,h++):(p=s,_===0&&E(fr)),p!==s){for(b=h,T=[],gr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,_===0&&E(_r));w!==s;)T.push(w),gr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,_===0&&E(_r));T!==s?b=i.substring(b,h):b=T,b!==s?(i.charCodeAt(h)===39?(T=dr,h++):(T=s,_===0&&E(fr)),T!==s?(p=[p,b,T],l=p):(h=l,l=s)):(h=l,l=s)}else h=l,l=s;if(l===s)if(l=h,i.charCodeAt(h)===34?(p=Tr,h++):(p=s,_===0&&E(Sr)),p!==s){for(b=h,T=[],wr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,_===0&&E(yr));w!==s;)T.push(w),wr.test(i.charAt(h))?(w=i.charAt(h),h++):(w=s,_===0&&E(yr));T!==s?b=i.substring(b,h):b=T,b!==s?(i.charCodeAt(h)===34?(T=Tr,h++):(T=s,_===0&&E(Sr)),T!==s?(p=[p,b,T],l=p):(h=l,l=s)):(h=l,l=s)}else h=l,l=s;return l!==s&&(N=o,l=so(l)),o=l,o}function B(){var o,l;return _++,oo.test(i.charAt(h))?(o=i.charAt(h),h++):(o=s,_===0&&E(ao)),_--,o===s&&(l=s,_===0&&E(no)),o}function Nr(){var o,l;return _++,i.charCodeAt(h)===10?(o=lo,h++):(o=s,_===0&&E(ho)),_--,o===s&&(l=s,_===0&&E(uo)),o}function ee(){var o,l;for(_++,o=[],Er.test(i.charAt(h))?(l=i.charAt(h),h++):(l=s,_===0&&E(vr));l!==s;)o.push(l),Er.test(i.charAt(h))?(l=i.charAt(h),h++):(l=s,_===0&&E(vr));return _--,o===s&&(l=s,_===0&&E(co)),o}if(ut=u(),ut!==s&&h===i.length)return ut;throw ut!==s&&h<i.length&&E(mo()),Rr(At,re<i.length?i.charAt(re):null,re<i.length?Ge(re,re+1):Ge(re,re))}return{SyntaxError:e,parse:r}}()});var K={log:console.log};var $e=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let r=()=>{this.frameId=e()?requestAnimationFrame(r):0};this.frameId=requestAnimationFrame(r)}stop(){!this.running||(cancelAnimationFrame(this.frameId),this.frameId=0)}},Lt=class{constructor(e=1){this.cycles=e;this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let r=()=>{for(let i=0;i<this.cycles;++i)if(!e()){this.frameId=0;return}this.frameId=setTimeout(r,0)};this.frameId=setTimeout(r)}stop(){!this.running||(clearTimeout(this.frameId),this.frameId=0)}};var ra=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],$t=1<<24,kt=2<<24;function Fr(t){let e=t.toLowerCase().trim();if(e.startsWith("transparent"))return $t;if(e.startsWith("syscolor"))return kt|parseInt(e.split("(")[1].split(")")[0]);if(e.startsWith("rgb")){let r=e.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return r[0]|r[1]<<8|r[2]<<16}throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: ${t}`)}function oe(t){if(t&$t)return"transparent";let e=t&255;if(t&kt)return ra[e]||"black";let r=t>>8&255,i=t>>16&255;return`rgb(${e},${r},${i})`}function ze(t,e,r,i){let n=i===1?$t:i===2?kt:0;return t&255|(e&255)<<8|(r&255)<<16|n}function pt(t){return t&255}function dt(t){return t>>8&255}function ft(t){return t>>16&255}var v;(function(t){t[t.PI=Math.PI]="PI",t[t.WORD8=0]="WORD8",t[t.INT8=1]="INT8",t[t.WORD16=2]="WORD16",t[t.INT16=3]="INT16",t[t.WORD32=4]="WORD32",t[t.INT32=5]="INT32",t[t.FLOAT32=6]="FLOAT32",t[t.FLOAT40=7]="FLOAT40",t[t.FLOAT64=8]="FLOAT64",t[t.FLOAT80=9]="FLOAT80",t[t.PEN2D=1]="PEN2D",t[t.BRUSH2D=2]="BRUSH2D",t[t.DIB2D=3]="DIB2D",t[t.DOUBLEDIB2D=4]="DOUBLEDIB2D",t[t.FONT2D=5]="FONT2D",t[t.STRING2D=6]="STRING2D",t[t.TEXT2D=7]="TEXT2D",t[t.SPACE3D=8]="SPACE3D",t[t.TEXTURE3D=9]="TEXTURE3D",t[t.SIZE_RESTORED=0]="SIZE_RESTORED",t[t.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",t[t.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",t[t.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",t[t.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",t[t.OTGROUP2D=3]="OTGROUP2D",t[t.OTRGROUP2D=4]="OTRGROUP2D",t[t.OTGROUP3D=5]="OTGROUP3D",t[t.OTOBJECT3D=10]="OTOBJECT3D",t[t.OTLINE_2D=20]="OTLINE_2D",t[t.OTBITMAP_2D=21]="OTBITMAP_2D",t[t.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",t[t.OTTEXT_2D=23]="OTTEXT_2D",t[t.OTVIEW3D_2D=24]="OTVIEW3D_2D",t[t.OTEDITFRAME=50]="OTEDITFRAME",t[t.OTROTATECENTER=51]="OTROTATECENTER",t[t.OTFRAME3D=52]="OTFRAME3D",t[t.OTAXIS3D=53]="OTAXIS3D",t[t.OTPEN2D=101]="OTPEN2D",t[t.OTBRUSH2D=102]="OTBRUSH2D",t[t.OTDIB2D=103]="OTDIB2D",t[t.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",t[t.OTFONT2D=105]="OTFONT2D",t[t.OTSTRING2D=106]="OTSTRING2D",t[t.OTTEXT2D=107]="OTTEXT2D",t[t.OTREFTODIB2D=110]="OTREFTODIB2D",t[t.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",t[t.ATTRSET=1]="ATTRSET",t[t.ATTRRESET=2]="ATTRRESET",t[t.ATTRPUT=3]="ATTRPUT",t[t.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",t[t.PFC_SETCURRENT=16384]="PFC_SETCURRENT",t[t.PFC_SETFRAME=8192]="PFC_SETFRAME",t[t.PFC_PENS=1]="PFC_PENS",t[t.PFC_BRUHS=2]="PFC_BRUHS",t[t.PFC_DIBS=4]="PFC_DIBS",t[t.PFC_DDIBS=8]="PFC_DDIBS",t[t.PFC_STRINGS=16]="PFC_STRINGS",t[t.PFC_FONTS=32]="PFC_FONTS",t[t.PFC_TEXTS=64]="PFC_TEXTS",t[t.PFC_3D=128]="PFC_3D",t[t.PFC_ALL=255]="PFC_ALL",t[t.OID_RESERVED=32e3]="OID_RESERVED",t[t.OID_RCENTER=32001]="OID_RCENTER",t[t.OID_FRAME2D1=32002]="OID_FRAME2D1",t[t.OID_FRAME2D2=32003]="OID_FRAME2D2",t[t.OID_FRAME2D3=32004]="OID_FRAME2D3",t[t.OID_FRAME2D4=32005]="OID_FRAME2D4",t[t.OID_FRAME2D5=32006]="OID_FRAME2D5",t[t.OID_FRAME2D6=32007]="OID_FRAME2D6",t[t.OID_FRAME2D7=32008]="OID_FRAME2D7",t[t.OID_FRAME2D8=32009]="OID_FRAME2D8",t[t.OID_FRAME2D=32010]="OID_FRAME2D",t[t.OID_AXIS3D=32100]="OID_AXIS3D",t[t.OID_FRAME3D1=32102]="OID_FRAME3D1",t[t.OID_FRAME3D2=32103]="OID_FRAME3D2",t[t.OID_FRAME3D3=32104]="OID_FRAME3D3",t[t.OID_FRAME3D4=32105]="OID_FRAME3D4",t[t.OID_FRAME3D5=32106]="OID_FRAME3D5",t[t.OID_FRAME3D6=32107]="OID_FRAME3D6",t[t.OID_FRAME3D7=32108]="OID_FRAME3D7",t[t.OID_FRAME3D8=32109]="OID_FRAME3D8",t[t.OID_FRAME3D=32110]="OID_FRAME3D",t[t.MB_OK=0]="MB_OK",t[t.MB_OKCANCEL=1]="MB_OKCANCEL",t[t.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",t[t.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",t[t.MB_YESNO=4]="MB_YESNO",t[t.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",t[t.MB_TYPEMASK=15]="MB_TYPEMASK",t[t.MB_ICONHAND=16]="MB_ICONHAND",t[t.MB_ICONQUESTION=32]="MB_ICONQUESTION",t[t.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",t[t.MB_ICONASTERISK=64]="MB_ICONASTERISK",t[t.MB_ICONMASK=240]="MB_ICONMASK",t[t.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",t[t.MB_ICONSTOP=16]="MB_ICONSTOP",t[t.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",t[t.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",t[t.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",t[t.MB_DEFMASK=3840]="MB_DEFMASK",t[t.MB_APPLMODAL=0]="MB_APPLMODAL",t[t.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",t[t.MB_TASKMODAL=8192]="MB_TASKMODAL",t[t.MB_NOFOCUS=32768]="MB_NOFOCUS",t[t.SW_HIDE=0]="SW_HIDE",t[t.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",t[t.SW_NORMAL=1]="SW_NORMAL",t[t.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",t[t.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",t[t.SW_MAXIMIZE=3]="SW_MAXIMIZE",t[t.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",t[t.SW_SHOW=5]="SW_SHOW",t[t.SW_MINIMIZE=6]="SW_MINIMIZE",t[t.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",t[t.SW_SHOWNA=8]="SW_SHOWNA",t[t.SW_RESTORE=9]="SW_RESTORE",t[t.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",t[t.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",t[t.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",t[t.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",t[t.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",t[t.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",t[t.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",t[t.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",t[t.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",t[t.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",t[t.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",t[t.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",t[t.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",t[t.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",t[t.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",t[t.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",t[t.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",t[t.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",t[t.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",t[t.MCIERR_DRIVER=278]="MCIERR_DRIVER",t[t.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",t[t.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",t[t.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",t[t.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",t[t.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",t[t.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",t[t.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",t[t.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",t[t.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",t[t.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",t[t.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",t[t.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",t[t.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",t[t.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",t[t.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",t[t.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",t[t.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",t[t.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",t[t.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",t[t.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",t[t.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",t[t.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",t[t.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",t[t.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",t[t.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",t[t.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",t[t.MCIERR_GET_CD=307]="MCIERR_GET_CD",t[t.MCIERR_SET_CD=308]="MCIERR_SET_CD",t[t.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",t[t.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",t[t.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",t[t.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",t[t.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",t[t.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",t[t.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",t[t.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",t[t.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",t[t.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",t[t.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",t[t.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",t[t.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",t[t.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",t[t.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",t[t.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",t[t.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",t[t.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",t[t.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",t[t.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",t[t.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",t[t.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",t[t.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",t[t.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",t[t.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",t[t.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",t[t.WS_VISIBLE=268435456]="WS_VISIBLE",t[t.WS_DISABLED=134217728]="WS_DISABLED",t[t.WS_CAPTION=12582912]="WS_CAPTION",t[t.WS_BORDER=8388608]="WS_BORDER",t[t.WS_DLGFRAME=4194304]="WS_DLGFRAME",t[t.WS_VSCROLL=2097152]="WS_VSCROLL",t[t.WS_HSCROLL=1048576]="WS_HSCROLL",t[t.WS_SYSMENU=524288]="WS_SYSMENU",t[t.WS_THICKFRAME=262144]="WS_THICKFRAME",t[t.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",t[t.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",t[t.WS_GROUP=131072]="WS_GROUP",t[t.WS_TABSTOP=65536]="WS_TABSTOP",t[t.WS_OVERLAPPED=0]="WS_OVERLAPPED",t[t.WS_POPUP=2147483648]="WS_POPUP",t[t.WS_CHILD=1073741824]="WS_CHILD",t[t.IDX_PRIMARY=1]="IDX_PRIMARY",t[t.IDX_UNIQUE=2]="IDX_UNIQUE",t[t.IDX_DESCENDING=4]="IDX_DESCENDING",t[t.IDX_MAINTAINED=8]="IDX_MAINTAINED",t[t.IDX_SUBSET=16]="IDX_SUBSET",t[t.IDX_EXPR=32]="IDX_EXPR",t[t.IDX_IDXOOD=64]="IDX_IDXOOD",t[t.IDX_CASEINSENS=128]="IDX_CASEINSENS",t[t.FLDDBCHAR=513]="FLDDBCHAR",t[t.FLDDBNUM=514]="FLDDBNUM",t[t.FLDDBMEMO=515]="FLDDBMEMO",t[t.FLDDBBOOL=516]="FLDDBBOOL",t[t.FLDDBDATE=517]="FLDDBDATE",t[t.FLDDBFLOAT=518]="FLDDBFLOAT",t[t.FLDDBLOCK=519]="FLDDBLOCK",t[t.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",t[t.FLDDBBINARY=521]="FLDDBBINARY",t[t.FLDDBBYTES=522]="FLDDBBYTES",t[t.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",t[t.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",t[t.BS_CHECKBOX=2]="BS_CHECKBOX",t[t.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",t[t.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",t[t.BS_3STATE=5]="BS_3STATE",t[t.BS_AUTO3STATE=6]="BS_AUTO3STATE",t[t.BS_GROUPBOX=7]="BS_GROUPBOX",t[t.BS_USERBUTTON=8]="BS_USERBUTTON",t[t.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",t[t.BS_OWNERDRAW=11]="BS_OWNERDRAW",t[t.BS_LEFTTEXT=32]="BS_LEFTTEXT",t[t.ES_LEFT=0]="ES_LEFT",t[t.ES_CENTER=1]="ES_CENTER",t[t.ES_RIGHT=2]="ES_RIGHT",t[t.ES_MULTILINE=4]="ES_MULTILINE",t[t.ES_UPPERCASE=8]="ES_UPPERCASE",t[t.ES_LOWERCASE=16]="ES_LOWERCASE",t[t.ES_PASSWORD=32]="ES_PASSWORD",t[t.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",t[t.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",t[t.ES_NOHIDESEL=256]="ES_NOHIDESEL",t[t.SBS_HORZ=0]="SBS_HORZ",t[t.SBS_VERT=1]="SBS_VERT",t[t.SBS_TOPALIGN=2]="SBS_TOPALIGN",t[t.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",t[t.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",t[t.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",t[t.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",t[t.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",t[t.SBS_SIZEBOX=8]="SBS_SIZEBOX",t[t.LBS_NOTIFY=1]="LBS_NOTIFY",t[t.LBS_SORT=2]="LBS_SORT",t[t.LBS_NOREDRAW=4]="LBS_NOREDRAW",t[t.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",t[t.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",t[t.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",t[t.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",t[t.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",t[t.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",t[t.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",t[t.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",t[t.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",t[t.CBS_SIMPLE=1]="CBS_SIMPLE",t[t.CBS_DROPDOWN=2]="CBS_DROPDOWN",t[t.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",t[t.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",t[t.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",t[t.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",t[t.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",t[t.CBS_SORT=256]="CBS_SORT",t[t.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",t[t.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",t[t.BS_SOLID=0]="BS_SOLID",t[t.BS_NULL=1]="BS_NULL",t[t.BS_HATCHED=2]="BS_HATCHED",t[t.BS_PATTERN=3]="BS_PATTERN",t[t.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",t[t.HS_HORIZONTAL=0]="HS_HORIZONTAL",t[t.HS_VERTICAL=1]="HS_VERTICAL",t[t.HS_FDIAGONAL=2]="HS_FDIAGONAL",t[t.HS_BDIAGONAL=3]="HS_BDIAGONAL",t[t.HS_CROSS=4]="HS_CROSS",t[t.HS_DIAGCROSS=5]="HS_DIAGCROSS",t[t.PS_SOLID=0]="PS_SOLID",t[t.PS_DASH=1]="PS_DASH",t[t.PS_DOT=2]="PS_DOT",t[t.PS_DASHDOT=3]="PS_DASHDOT",t[t.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",t[t.PS_NULL=5]="PS_NULL",t[t.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",t[t.R2_BLACK=1]="R2_BLACK",t[t.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",t[t.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",t[t.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",t[t.R2_MASKPENNOT=5]="R2_MASKPENNOT",t[t.R2_NOT=6]="R2_NOT",t[t.R2_XORPEN=7]="R2_XORPEN",t[t.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",t[t.R2_MASKPEN=9]="R2_MASKPEN",t[t.R2_NOTXORPEN=10]="R2_NOTXORPEN",t[t.R2_NOP=11]="R2_NOP",t[t.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",t[t.R2_COPYPEN=13]="R2_COPYPEN",t[t.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",t[t.R2_MERGEPEN=15]="R2_MERGEPEN",t[t.R2_WHITE=16]="R2_WHITE",t[t.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",t[t.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",t[t.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",t[t.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",t[t.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",t[t.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",t[t.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",t[t.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",t[t.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",t[t.VF_LOCAL=2]="VF_LOCAL",t[t.VF_EQVAR=256]="VF_EQVAR",t[t.VF_ARGUMENT=512]="VF_ARGUMENT",t[t.VF_RETURN=1024]="VF_RETURN",t[t.CUR_ARROW=0]="CUR_ARROW",t[t.CUR_CROSS=1]="CUR_CROSS",t[t.CUR_TEXT=2]="CUR_TEXT",t[t.CUR_NO=3]="CUR_NO",t[t.CUR_SIZE=4]="CUR_SIZE",t[t.CUR_SIZENESW=5]="CUR_SIZENESW",t[t.CUR_SIZENS=6]="CUR_SIZENS",t[t.CUR_SIZENWSE=7]="CUR_SIZENWSE",t[t.CUR_SIZEWE=8]="CUR_SIZEWE",t[t.CUR_UPARROW=9]="CUR_UPARROW",t[t.CUR_WAIT=10]="CUR_WAIT",t[t.CUR_LINK=11]="CUR_LINK",t[t.CUR_HELP=12]="CUR_HELP",t[t.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",t[t.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",t[t.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",t[t.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",t[t.FOG_NONE=0]="FOG_NONE",t[t.FOG_EXP=1]="FOG_EXP",t[t.FOG_EXP2=2]="FOG_EXP2",t[t.FOG_LINEAR=3]="FOG_LINEAR",t[t.TEX_TYPE_1D=1]="TEX_TYPE_1D",t[t.TEX_TYPE_2D=2]="TEX_TYPE_2D",t[t.TEX_TYPE_3D=3]="TEX_TYPE_3D",t[t.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",t[t.SBF_ONE=0]="SBF_ONE",t[t.SBF_ZERO=1]="SBF_ZERO",t[t.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",t[t.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",t[t.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",t[t.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",t[t.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",t[t.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",t[t.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",t[t.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",t[t.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",t[t.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",t[t.CMPF_LESS=2]="CMPF_LESS",t[t.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",t[t.CMPF_EQUAL=4]="CMPF_EQUAL",t[t.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",t[t.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",t[t.CMPF_GREATER=7]="CMPF_GREATER",t[t.CULL_NONE=1]="CULL_NONE",t[t.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",t[t.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",t[t.SO_FLAT=0]="SO_FLAT",t[t.SO_GOURAUD=1]="SO_GOURAUD",t[t.SO_PHONG=2]="SO_PHONG",t[t.PM_POINTS=1]="PM_POINTS",t[t.PM_WIREFRAME=2]="PM_WIREFRAME",t[t.PM_SOLID=3]="PM_SOLID",t[t.LT_POINT=0]="LT_POINT",t[t.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",t[t.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",t[t.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",t[t.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",t[t.OT_POINT_LIST=1]="OT_POINT_LIST",t[t.OT_LINE_LIST=2]="OT_LINE_LIST",t[t.OT_LINE_STRIP=3]="OT_LINE_STRIP",t[t.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",t[t.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",t[t.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",t[t.BBT_POINT=0]="BBT_POINT",t[t.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",t[t.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",t[t.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",t[t.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",t[t.GMM_RELATIVE=0]="GMM_RELATIVE",t[t.GMM_PIXELS=1]="GMM_PIXELS",t[t.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",t[t.GHA_LEFT=0]="GHA_LEFT",t[t.GHA_CENTER=1]="GHA_CENTER",t[t.GHA_RIGHT=2]="GHA_RIGHT",t[t.GVA_TOP=0]="GVA_TOP",t[t.GVA_CENTER=1]="GVA_CENTER",t[t.GVA_BOTTOM=2]="GVA_BOTTOM",t[t.MTHA_LEFT=0]="MTHA_LEFT",t[t.MTHA_CENTER=1]="MTHA_CENTER",t[t.MTVA_BELOW=0]="MTVA_BELOW",t[t.MTVA_ABOVE=1]="MTVA_ABOVE",t[t.MTVA_CENTER=2]="MTVA_CENTER",t[t.PT_BOOL=0]="PT_BOOL",t[t.PT_REAL=1]="PT_REAL",t[t.PT_INT=2]="PT_INT",t[t.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",t[t.PT_SHORT=4]="PT_SHORT",t[t.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",t[t.PT_LONG=6]="PT_LONG",t[t.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",t[t.PT_STRING=8]="PT_STRING",t[t.PT_VECTOR3=9]="PT_VECTOR3",t[t.PT_MATRIX3=10]="PT_MATRIX3",t[t.PT_MATRIX4=11]="PT_MATRIX4",t[t.PT_QUATERNION=12]="PT_QUATERNION",t[t.PT_COLOURVALUE=13]="PT_COLOURVALUE",t[t.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",t[t.NUI_SP_SPINE=1]="NUI_SP_SPINE",t[t.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",t[t.NUI_SP_HEAD=3]="NUI_SP_HEAD",t[t.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",t[t.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",t[t.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",t[t.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",t[t.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",t[t.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",t[t.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",t[t.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",t[t.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",t[t.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",t[t.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",t[t.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",t[t.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",t[t.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",t[t.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",t[t.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",t[t.NUI_SP_COUNT=20]="NUI_SP_COUNT",t[t.WM_DESTROY=2]="WM_DESTROY",t[t.WM_MOVE=3]="WM_MOVE",t[t.WM_SIZE=5]="WM_SIZE",t[t.WM_CLOSE=16]="WM_CLOSE",t[t.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",t[t.WM_COMMAND=273]="WM_COMMAND",t[t.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",t[t.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",t[t.WM_LBUTTONUP=514]="WM_LBUTTONUP",t[t.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",t[t.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",t[t.WM_RBUTTONUP=517]="WM_RBUTTONUP",t[t.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",t[t.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",t[t.WM_MBUTTONUP=520]="WM_MBUTTONUP",t[t.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",t[t.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",t[t.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",t[t.WM_KEYDOWN=256]="WM_KEYDOWN",t[t.WM_KEYUP=257]="WM_KEYUP",t[t.WM_CANCLOSE=1538]="WM_CANCLOSE",t[t.WM_SPACEDONE=1539]="WM_SPACEDONE",t[t.WM_SPACEINIT=1540]="WM_SPACEINIT",t[t.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",t[t.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(v||(v={}));var gt="retCode",be="model",Ke="TLB",Z="mem",ke="schema",we=0,ye="prj",se="env",_t="oldFloats",Lr="newFloats",Tt="oldInts",$r="newInts",St="oldStrings",kr="newStrings",Ur="call",Vr="waitFor",Hr="getWaitResult",Cr="saveContext",Wr="loadContext",jr="getTime",Xr="getDate",Yr="getActualSize2d",Gr="getVarInfo",zr="getMousePos";var Ze=new Map([["EXIT",{f:`return ${we}`,inline:"template"}],["FLOAT",{f:"parseFloat(#0)||0",inline:"template"}],["HANDLE",{f:"parseInt(#0)||0",inline:"template"}],["STRING",{f:"(Math.round((#0)*100000)/100000).toString()",inline:"template"}],["ABS",{f:"Math.abs(#0)||0",inline:"template"}],["AVERAGE",{f:"(#0)/2+(#1)/2",inline:"template"}],["EXP",{f:"Math.exp(#0)||0",inline:"template"}],["LG",{f:"lg",inline:"inner"}],["LN",{f:"ln",inline:"inner"}],["LOG",{f:"log",inline:"inner"}],["MAX",{f:"Math.max(#0, #1)||0",inline:"template"}],["MIN",{f:"Math.min(#0, #1)||0",inline:"template"}],["LIMIT",{f:"Math.max(#1, Math.min(#2, #0))||0",inline:"template"}],["ROUND",{f:"round",inline:"inner"}],["SQR",{f:"(#0)**2",inline:"template"}],["SQRT",{f:"Math.sqrt(#0)||0",inline:"template"}],["TRUNC",{f:"Math.trunc(#0)||0",inline:"template"}],["RND",{f:"(#0)*Math.random()",inline:"template"}],["ARCCOS",{f:"arccos",inline:"inner"}],["ARCSIN",{f:"arcsin",inline:"inner"}],["ARCTAN",{f:"Math.atan(#0)||0",inline:"template"}],["COS",{f:"Math.cos(#0)||0",inline:"template"}],["SIN",{f:"Math.sin(#0)||0",inline:"template"}],["TAN",{f:"Math.tan(#0)||0",inline:"template"}],["DEG",{f:"180*(#0)/Math.PI||0",inline:"template"}],["RAD",{f:"Math.PI*(#0)/180||0",inline:"template"}],["GETANGLEBYXY",{f:"getAngleByXY",inline:"inner"}],["AND",{f:"(#0)&&(#1)",inline:"template"}],["DELTA",{f:"(#0)?0:1",inline:"template"}],["ED",{f:"(#0)>0?1:0",inline:"template"}],["NOT",{f:"!(#0)",inline:"template"}],["NOTBIN",{f:"#0",inline:"template"}],["OR",{f:"(#0)||(#1)",inline:"template"}],["SGN",{f:"Math.sign(#0)||0",inline:"template"}],["XOR",{f:"(#0)!==0^(#1)!==0",inline:"template"}],["XORBIN",{f:"(#0)^(#1)",inline:"template"}],["ALLTRIM",{f:"(#0).trim()",inline:"template"}],["CHANGE",{f:"change",inline:"inner"}],["COMPARE",{f:"(#0)===(#1)",inline:"template"}],["COMPAREI",{f:"compareI",inline:"inner"}],["LEFT",{f:"(#0).substring(0,#1)",inline:"template"}],["LENGTH",{f:"(#0).length",inline:"template"}],["LOWER",{f:"(#0).toLowerCase()",inline:"template"}],["LTRIM",{f:'(#0).replace(/^\\s+/,"")',inline:"template"}],["POS",{f:"pos",inline:"inner"}],["REPLICATE",{f:"(#0).repeat(#1)",inline:"template"}],["SUBSTR",{f:"(#0).substr(#1,#2)",inline:"template"}],["RIGHT",{f:"right",inline:"inner"}],["RTRIM",{f:'(#0).replace(/\\s+$/,"")',inline:"template"}],["UPPER",{f:"(#0).toUpperCase()",inline:"template"}]]);function Ee(t,e){let r="stratum_",i=r.length,n="async_",s=n.length;Object.getOwnPropertyNames(t.prototype).forEach(a=>{let u=t.prototype[a];if(typeof u!="function"||!u.name.startsWith(r))return;let c=a.toString().substring(i),m=c.startsWith(n);m&&(c=c.substring(s));let d=c.toUpperCase(),S={f:`${e}.${a}`,blocking:m},f=Ze.size;if(Ze.set(d,S),f===Ze.size)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0444\u0443\u043D\u043A\u0446\u0438\u0439: ${c}`)})}var I;(function(t){t[t.Float=1]="Float",t[t.Handle=2]="Handle",t[t.String=3]="String",t[t.ColorRef=4]="ColorRef"})(I||(I={}));var Ue=class{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,r){if(e.type!==r.type)return!1;if(e.indexWasSet||r.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(r),r.connectedNodes.add(e),!0}shareIndex(e){this.indexWasSet||(this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(r=>r.shareIndex(e)))}getIndex(e){if(!this.indexWasSet)switch(this.type){case I.Float:this.shareIndex(e.floatsCount++);break;case I.Handle:case I.ColorRef:this.shareIndex(e.intsCount++);break;case I.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}};var pe="n",de="o",G=[];G[I.Float]="F";G[I.Handle]="I";G[I.ColorRef]="I";G[I.String]="S";var Kr=`
var ${ye} = ${ke}.${ye};
var ${se} = ${ye}.${se};
var ${de}${G[I.Float]} = ${Z}.${_t};
var ${pe}${G[I.Float]} = ${Z}.${Lr};
var ${de}${G[I.Handle]} = ${Z}.${Tt};
var ${pe}${G[I.Handle]} = ${Z}.${$r};
var ${de}${G[I.String]} = ${Z}.${St};
var ${pe}${G[I.String]} = ${Z}.${kr};
`,Zr=`
var ${ye} = ${ke}.${ye};
var ${se} = ${ye}.${se};
var ${de}${G[I.Float]} = ${Z}.${_t};
var ${pe}${G[I.Float]} = ${Z}.${_t};
var ${de}${G[I.Handle]} = ${Z}.${Tt};
var ${pe}${G[I.Handle]} = ${Z}.${Tt};
var ${de}${G[I.String]} = ${Z}.${St};
var ${pe}${G[I.String]} = ${Z}.${St};
`;function Qr(t,e,r){let i=t.length,n=`${be}.${Hr}();`;t.push(`${be}.${Vr}(${e});`,`return -${i};`,`case -${i}:`,r?`var ${e} = ${n}`:n)}var Jr=class{get(e){return this.v.get(e.toUpperCase())}constructor(e){this.v=new Map(e==null?void 0:e.map((r,i)=>[r.name.toUpperCase(),[r,i]]))}result(){return[...this.v.values()].map(e=>e[0])}},qr=class{constructor(e,r,i,n,s){this.res=e;this.vars=r;this.lib=i;this.missingFuncs=n;this.innerFuncs=s;this.varCount=0;this._hasBug=!1}reset(){return this.varCount=0,this}hasBug(){return this._hasBug}arr(e,r){let i=this.vars.get(r);if(!i)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);let n=G[i[0].type];return`${e?pe:de}${n}[${Ke}[${i[1]}]]`}derefer(e){if(e.first.type!=="var"||e.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let r=e.first.name,i=this.vars.get(r);if(!i)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);return[`${e.first.isNew?pe:de}${G[i[0].type]}`,`${Ke}[${i[1]}]`]}parseOperand(e){var r,i;switch(e.isNew&&e.type!=="var"&&(this._hasBug=!0),e.type){case"float":case"handle":return e.value.toString();case"string":return"`"+e.value.split("\\").join("\\\\").split("`").join("\\`")+"`";case"var":{let n=e.name.toUpperCase();return(i=(r=v[n])==null?void 0:r.toString())!=null?i:this.arr(e.isNew,n)}case"call":{let n=this.parseCall(e),s=this.put(n.f);if(n.blocking){let a=Array.from({length:this.varCount-1},(u,c)=>`t${c}`);if(a.length>0&&this.res.push(`${be}.${Cr}([${a.join(",")}]);`),Qr(this.res,s,!0),a.length>0){let u=`var ctx = ${be}.${Wr}();`,c=a.map((m,d)=>`var ${m}=ctx[${d}];`).join("");this.res.push(u,c)}}return s}case"-":return`(-${this.parseOperand(e.op)})`;case"!":return`(!${this.parseOperand(e.op)})`;case"subexpr":return`(${this.parseExpr(e.expr)})`}}put(e){let r=`t${this.varCount++}`;return this.res.push(`var ${r}=${e};`),r}parseCall(e){let r=e.name.toUpperCase(),i=e.args.map(a=>this.parseExpr(a)),n=Ze.get(r);if(n){if(n.inline!=="template")return n.inline==="inner"&&this.innerFuncs.add(n.f),$($({},n),{f:`${n.f}(${i})`});let a=n.f,u=0;for(;u<i.length;){let m=a.replace(`#${u}`,i[u]);if(a===m)throw Error(`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e.name}: ${i.length}, \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C - ${u})`);a=m,++u}let c=a;for(;(c=a.replace(`#${u}`,"undefined"))!==a;)a=c,++u;return $($({},n),{f:a})}if(r==="INC"||r==="DEC"){let a=this.derefer(e.args[0]),u=e.args.length<2?1:this.parseExpr(e.args[1]);return{f:`${a[0]}[${a[1]}]${r==="INC"?"+":"-"}=${u}`}}if(r==="GETTIME"){let a=e.args.map(u=>this.derefer(u));return{f:`${se}.${jr}(${a})`}}if(r==="GETDATE"){let a=e.args.map(u=>this.derefer(u));return{f:`${se}.${Xr}(${a})`}}if(r==="GETACTUALSIZE2D"){let a=e.args.slice(0,2).map(c=>this.parseExpr(c)),u=e.args.slice(2).map(c=>this.derefer(c));return{f:`${se}.${Yr}(${a},${u})`}}if(r==="GETVARINFO"){let a=e.args.slice(0,2).map(c=>this.parseExpr(c)),u=e.args.slice(2).map(c=>this.derefer(c));return{f:`${se}.${Gr}(${a},${u})`}}if(r==="GETMOUSEPOS"){let a=this.parseExpr(e.args[0]),u=this.derefer(e.args[1]),c=this.derefer(e.args[2]);return{f:`${se}.${zr}(${a},${u},${c})`}}return r==="RANDOMIZE"?{f:""}:(this.lib.hasModel(e.name)||this.missingFuncs.set(r,e.name),{f:`${be}.${Ur}(${ke}, "${e.name}"${i.length>0?","+i:""})`,blocking:!0})}parseExpr(e){let r=this.parseOperand(e.first),i=e.rest.map(n=>n.action==="/"?`/(${this.parseOperand(n.operand)} || Infinity)`:n.action+this.parseOperand(n.operand));return r+i.join("")}},ei=class{constructor(){this.bblocks=[]}pushBlock(e){return this.bblocks.push(e),e}popBlock(e){let r=this.bblocks.pop();if(!r||r.expect!==e)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${e}`);return r}lastBlock(){return this.bblocks.length>0?this.bblocks[this.bblocks.length-1]:null}getBreakID(){for(let e=this.bblocks.length-1;e>=0;--e){let r=this.bblocks[e];if(r.canBreak)return r.end}return we}},Ut=class{constructor(e,r,i){this.lib=r;this._hasEquals=!1;this._hasBug=!1;this._hasFuncDecl=!1;this.labelCnt=0;this.missingFuncs=new Map;this.res=[];this.b=new ei;this.innerFuncs=new Set;this._vars=new Jr(i),this.res=[`var code = ${gt};`,"while(true) {","switch(code) {","case 0:"];let n=new qr(this.res,this._vars,this.lib,this.missingFuncs,this.innerFuncs);for(let a=0;a<e.length;++a)try{let u=e[a];this.parseCodeline(u,n.reset());let c=u.then;for(;c;)this.parseCodeline(c,n.reset()),c=c.then}catch(u){throw Error(u.message+" \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 "+(a+1))}this._hasBug=n.hasBug();let s=this.b.lastBlock();if(s)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${s.expect}`);this.res.push("}",`return ${we};`,"}")}comment(e){this.res.push("//"+e)}makeJump(e){return`{ code = ${e}; continue; }`}parseCodeline(e,r){switch(e.type){case":=":{this.res.push(`${r.arr(!0,e.to)} = ${r.parseExpr(e.expr)};`);break}case"callChain":{for(let n=0;n<e.functions.length;++n){let s=e.functions[n],a=r.reset().parseCall(s);a.blocking?Qr(this.res,a.f,!1):this.res.push(`${a.f};`)}break}case"if":{this.comment("if");let n=this.b.pushBlock({canBreak:!1,end:++this.labelCnt,expect:"endif",haveElse:!1});this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.end)}`);break}case"else":{let n=this.b.lastBlock();if(!n||n.expect!=="endif"||n.haveElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");n.haveElse=!0;let s=n.end;n.end=++this.labelCnt,this.res.push(this.makeJump(n.end)),this.comment("else"),this.res.push(`case ${s}:`);break}case"endif":{this.comment("endif"),this.res.push(`case ${this.b.popBlock("endif").end}:`);break}case"while":{this.comment("while");let n=this.b.pushBlock({expect:"endwhile",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${n.start}:`),this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.end)}`);break}case"endwhile":{let n=this.b.popBlock("endwhile");this.res.push(this.makeJump(n.start)),this.comment("endwhile"),this.res.push(`case ${n.end}:`);break}case"do":{this.comment("do");let n=this.b.pushBlock({expect:"until",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${n.start}:`);break}case"until":{let n=this.b.popBlock("until");this.res.push(`if(${r.parseExpr(e.expr)}) ${this.makeJump(n.start)}`),this.comment("until"),this.res.push(`case ${n.end}:`);break}case"switch":{this.comment("switch"),this.b.pushBlock({expect:"endswitch",end:++this.labelCnt,next:null,canBreak:!0,hasCase:!1});break}case"endswitch":{this.comment("endswitch");let n=this.b.popBlock("endswitch");n.next!==null&&this.res.push(`case ${n.next}:`),this.res.push(`case ${n.end}:`);break}case"case":{let n=this.b.lastBlock();if(!n||n.expect!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");n.hasCase=!0,n.next!==null?(this.res.push(this.makeJump(n.end)),this.comment("case"),this.res.push(`case ${n.next}:`)):this.comment("case"),n.next=++this.labelCnt,this.res.push(`if(!(${r.parseExpr(e.expr)})) ${this.makeJump(n.next)}`);break}case"default":{let n=this.b.lastBlock();if(!n||n.expect!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");if(!n.hasCase)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");n.next!==null?(this.res.push(this.makeJump(n.end)),this.comment("default"),this.res.push(`case ${n.next}:`)):this.comment("default"),n.next=null;break}case"break":this.comment("break");let i=this.b.getBreakID();this.res.push(i===we?`return ${we};`:this.makeJump(i));break;case"varsDec":break;case"function":this._hasFuncDecl=!0;break;case"return":break;case"=":this._hasEquals=!0;break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: ${e.type}`)}}result(){return this.res}vars(){return this._vars.result()}innerFunctions(){return[...this.innerFuncs]}hasEquations(){return this._hasEquals}hasFunctionDecl(){return this._hasFuncDecl}hasBug(){return this._hasBug}};var ia=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,sa=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,na=`function change(s1, s2, s3) {
    var res = s1;
    do {
        var prev = res;
        var res = res.replace(s2, s3);
    } while (res !== prev);
    return res;
}`,oa=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,aa=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,ua=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,la=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,ha=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,ca=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var srch = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, srch);
        if (idx < 0) return -1;
        srch = idx + s2.length;
    }
    return idx;
}`,ma=`function right(a, n) {
    return a.substring(a.length - n);
}`,ba=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,ti=new Map([["arccos",ia],["arcsin",sa],["change",na],["compareI",oa],["getAngleByXY",aa],["lg",ua],["ln",la],["log",ha],["pos",ca],["right",ma],["round",ba]]);var Vt="'",Ht='"';function ri(t){let e="",r=null;for(let i=0;i<t.length;++i){let n=t[i];if(n===Vt&&r!==Ht?r=r?null:Vt:n===Ht&&r!==Vt&&(r=r?null:Ht),r){e+=n;continue}if(n==="/"){let s=t[i+1];if(s==="*"){for(i+=2;i<t.length&&(t[i]!=="*"||t[i+1]!=="/");)++i;++i;continue}if(s==="/"){for(++i;i<t.length&&t[++i]!==`
`;);e[e.length-1]!==`
`&&(e+=`
`);continue}}if(n===";"||n===`
`){e[e.length-1]!==`
`&&(e+=`
`);continue}if(n==="\r"){t[i+1]===`
`&&++i,e[e.length-1]!==`
`&&(e+=`
`);continue}e+=n}return e[e.length-1]===`
`?e:e+`
`}var ni=ta(si());var ve=new Map;var pa=[gt,be,Ke,Z,ke],Qe=class{constructor(e,r,i,n){this.contextVars=null;this.target=null;this.lib=r;let s=ri(e),a;try{a=(0,ni.parse)(s)}catch(g){console.dir(g),console.log(s);let R=g.location.start;throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${i}, \u0441\u0442\u0440\u043E\u043A\u0430 ${R.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${R.column}: ${g.message}`)}if(a.length===0){this._func=Qe.noModel,this.isFunction=!1,this.vars=[];return}let u;try{u=new Ut(a,r,n)}catch(g){throw console.log(s.split(`
`).filter(R=>R.trim()).map((R,O)=>`${O+1}: ${R}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0442\u0440\u0430\u043D\u0441\u043B\u044F\u0446\u0438\u0438 ${i}: ${g.message}`)}u.hasEquations()&&console.warn(`\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u0432 ${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B`),u.hasBug()&&console.warn(`${i}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),this.isFunction=u.hasFunctionDecl(),this.vars=u.vars();let c=u.result();if(c.length===0){this._func=Qe.noModel;return}let d=u.innerFunctions().map(g=>ti.get(g)).join(`
`),S=u.missingFuncs;S.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...S.values()].join(", ")} \u0432 ${i} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),S.forEach((g,R)=>ve.set(R,g));let f=c.join(`
`),y=d+(this.isFunction?Zr:Kr)+f+`//# sourceURL=${i}`;K.log("\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0442\u043E\u0440:",`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${i}${this.isFunction?" \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u044E ":""}`);try{this._func=new Function(...pa,y)}catch(g){throw console.log(s.split(`
`).filter(R=>R.trim()).map((R,O)=>`${O+1}: ${R}`).join(`
`)),console.log(f),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${i}: ${g.message}`)}}static noModel(){return 0}*compute(e,r,i){let n=this._func,s=0;for(;;){if((s=n(s,this,e,r,i))===0)return;let a=this.getWaitResult();typeof a!="object"?this.setWaitResult(a):a instanceof Promise?yield a.then(u=>this.setWaitResult(u)):this.setWaitResult(yield*a)}}saveContext(e){if(this.contextVars!==null)throw Error("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u043F\u0435\u0440\u0435\u0437\u0430\u043F\u0438\u0441\u0438 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");this.contextVars=e}loadContext(){let e=this.contextVars;if(e===null)throw Error("\u041D\u0435\u0442 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");return this.contextVars=null,e}setWaitResult(e){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=e}waitFor(e){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=e}getWaitResult(){let e=this.target;if(e===null)throw Error("\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u0430 \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F");return this.target=null,e}*call(e,r,...i){let n=this.lib.getModel(r);if(n||e.stubCall(r,i),!n.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${r} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);let s={floatsCount:0,intsCount:0,stringsCount:0},a=n.vars,u=a.map(g=>new Ue(g.type).getIndex(s)),c=new Float64Array(s.floatsCount),m=new Int32Array(s.intsCount),d=new Array(s.stringsCount).fill("");if(i.length>a.length)throw Error("\u041A\u043E\u043B-\u0432\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0431\u043E\u043B\u044C\u0448\u0435 \u043A\u043E\u043B-\u0432\u0430 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");for(let g=0;g<i.length;++g){let R=i[g];switch(a[g].type){case I.Float:if(typeof R=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");c[u[g]]=R;break;case I.Handle:case I.ColorRef:if(typeof R=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");m[u[g]]=R;break;case I.String:if(typeof R=="number")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");d[u[g]]=R;break}}let S={oldFloats:c,oldInts:m,oldStrings:d};yield*n.compute(u,S,e);let f=a.findIndex(g=>g.isReturnValue);if(f<0)return;switch(a[f].type){case I.String:return d[u[f]];case I.Float:return c[u[f]];default:return m[u[f]]}}};function wt(t,e,r,i){return new Qe(t,e,r,i)}var Ie=[String.fromCharCode(0),String.fromCharCode(1),String.fromCharCode(2),String.fromCharCode(3),String.fromCharCode(4),String.fromCharCode(5),String.fromCharCode(6),String.fromCharCode(7),String.fromCharCode(8),String.fromCharCode(9),String.fromCharCode(10),String.fromCharCode(11),String.fromCharCode(12),String.fromCharCode(13),String.fromCharCode(14),String.fromCharCode(15),String.fromCharCode(16),String.fromCharCode(17),String.fromCharCode(18),String.fromCharCode(19),String.fromCharCode(20),String.fromCharCode(21),String.fromCharCode(22),String.fromCharCode(23),String.fromCharCode(24),String.fromCharCode(25),String.fromCharCode(26),String.fromCharCode(27),String.fromCharCode(28),String.fromCharCode(29),String.fromCharCode(30),String.fromCharCode(31),String.fromCharCode(32),String.fromCharCode(33),String.fromCharCode(34),String.fromCharCode(35),String.fromCharCode(36),String.fromCharCode(37),String.fromCharCode(38),String.fromCharCode(39),String.fromCharCode(40),String.fromCharCode(41),String.fromCharCode(42),String.fromCharCode(43),String.fromCharCode(44),String.fromCharCode(45),String.fromCharCode(46),String.fromCharCode(47),String.fromCharCode(48),String.fromCharCode(49),String.fromCharCode(50),String.fromCharCode(51),String.fromCharCode(52),String.fromCharCode(53),String.fromCharCode(54),String.fromCharCode(55),String.fromCharCode(56),String.fromCharCode(57),String.fromCharCode(58),String.fromCharCode(59),String.fromCharCode(60),String.fromCharCode(61),String.fromCharCode(62),String.fromCharCode(63),String.fromCharCode(64),String.fromCharCode(65),String.fromCharCode(66),String.fromCharCode(67),String.fromCharCode(68),String.fromCharCode(69),String.fromCharCode(70),String.fromCharCode(71),String.fromCharCode(72),String.fromCharCode(73),String.fromCharCode(74),String.fromCharCode(75),String.fromCharCode(76),String.fromCharCode(77),String.fromCharCode(78),String.fromCharCode(79),String.fromCharCode(80),String.fromCharCode(81),String.fromCharCode(82),String.fromCharCode(83),String.fromCharCode(84),String.fromCharCode(85),String.fromCharCode(86),String.fromCharCode(87),String.fromCharCode(88),String.fromCharCode(89),String.fromCharCode(90),String.fromCharCode(91),String.fromCharCode(92),String.fromCharCode(93),String.fromCharCode(94),String.fromCharCode(95),String.fromCharCode(96),String.fromCharCode(97),String.fromCharCode(98),String.fromCharCode(99),String.fromCharCode(100),String.fromCharCode(101),String.fromCharCode(102),String.fromCharCode(103),String.fromCharCode(104),String.fromCharCode(105),String.fromCharCode(106),String.fromCharCode(107),String.fromCharCode(108),String.fromCharCode(109),String.fromCharCode(110),String.fromCharCode(111),String.fromCharCode(112),String.fromCharCode(113),String.fromCharCode(114),String.fromCharCode(115),String.fromCharCode(116),String.fromCharCode(117),String.fromCharCode(118),String.fromCharCode(119),String.fromCharCode(120),String.fromCharCode(121),String.fromCharCode(122),String.fromCharCode(123),String.fromCharCode(124),String.fromCharCode(125),String.fromCharCode(126),String.fromCharCode(127),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function Je(t){return Array.from(t).map(e=>Ie[e]).join("")}var da=" ".charCodeAt(0);function oi(t){return new Uint8Array([...t].map(e=>{let r=Ie.indexOf(e);return r>-1?r:da}))}var Q=class{constructor(e,r){e instanceof ArrayBuffer?this.v=new DataView(e):this.v=new DataView(e.buffer,e.byteOffset,e.byteLength),this.p=0,this.name=r!=null?r:""}pos(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}size(){return this.v.byteLength}eof(){return this.p>=this.size()}bytes(e){let r=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,r}byte(){let e=this.v.getUint8(this.p);return this.p+=1,e}int16(){let e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){let e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){let e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){let e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){let e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?Je(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}nulltString(e){let r=this.p,i=0;for(;i<e-1&&this.v.getUint8(r+ ++i)!==0;);let n=this.fixedString(i);return this.p=r+e,n}vmString(){let e=this.uint16()*2,r=this.v.getUint8(this.p+e-2)===0?2:1,i=this.fixedString(e-r);return this.p+=r,i}point2d(e){return{x:e?this.int16():this.float64(),y:e?this.int16():this.float64()}}},ae=class extends Error{constructor(e,r){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.name||""}:
${r}`)}},J=class extends ae{constructor(e,r,i){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${r.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${i.toString(16)}.`)}};var C;(function(t){t[t.CR_MATH=1]="CR_MATH",t[t.CR_MATHDATA=2]="CR_MATHDATA",t[t.CR_FLAGS=4]="CR_FLAGS",t[t.CR_VARS=5]="CR_VARS",t[t.CR_CHILDS=6]="CR_CHILDS",t[t.CR_LINKS=7]="CR_LINKS",t[t.CR_ICON=8]="CR_ICON",t[t.CR_SCHEME=9]="CR_SCHEME",t[t.CR_TEXT=10]="CR_TEXT",t[t.CR_VARSIZE=11]="CR_VARSIZE",t[t.CR_IMAGE=12]="CR_IMAGE",t[t.CR_CODE=13]="CR_CODE",t[t.CR_INFO=14]="CR_INFO",t[t.CR_VARS1=15]="CR_VARS1",t[t.CR_CHILDSname=16]="CR_CHILDSname",t[t.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",t[t.CR_DEFICON=20]="CR_DEFICON",t[t.CR_CLASSTIME=21]="CR_CLASSTIME",t[t.CR_ICONFILE=22]="CR_ICONFILE",t[t.CR_HELPFILE=25]="CR_HELPFILE",t[t.CR_EQU=30]="CR_EQU",t[t.CR_MOVEINFO=31]="CR_MOVEINFO",t[t.RR_VERSION=40]="RR_VERSION",t[t.PR_MAINCLASS=100]="PR_MAINCLASS",t[t.PR_PASSWORD=101]="PR_PASSWORD",t[t.PR_VARS=102]="PR_VARS",t[t.PR_WATCH=103]="PR_WATCH",t[t.VR_CLASSES=1e3]="VR_CLASSES",t[t.VR_VARS=1001]="VR_VARS",t[t.VR_SETVAR=1002]="VR_SETVAR",t[t.CR_CLASSINFO=8e3]="CR_CLASSINFO",t[t.PPR_FIELDS=2048]="PPR_FIELDS",t[t.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",t[t.PPR_SCALEMODE=2050]="PPR_SCALEMODE",t[t.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",t[t.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",t[t.PPR_USEADDF=2053]="PPR_USEADDF",t[t.PPR_SRCRECT=2054]="PPR_SRCRECT",t[t.PPR_USESRC=2055]="PPR_USESRC",t[t.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",t[t.CLF_LOADED=1]="CLF_LOADED",t[t.CLF_PROJECT=2]="CLF_PROJECT",t[t.CLF_MODIFY=4]="CLF_MODIFY",t[t.CLF_READONLY=8]="CLF_READONLY",t[t.CLF_NORECURSE=16]="CLF_NORECURSE",t[t.CLF_ADDLIB=32]="CLF_ADDLIB",t[t.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",t[t.CLF_LIBRARY=256]="CLF_LIBRARY",t[t.CLF_PACKFILE=512]="CLF_PACKFILE",t[t.CF_PROTECTED=1]="CF_PROTECTED",t[t.CF_ONEFASE=2]="CF_ONEFASE",t[t.CF_COMPILED=4]="CF_COMPILED",t[t.CF_VIRTUAL=8]="CF_VIRTUAL",t[t.CF_SCHEME=16]="CF_SCHEME",t[t.CF_MODIFY=32]="CF_MODIFY",t[t.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",t[t.CF_BUILDIN=256]="CF_BUILDIN",t[t.CF_ICON=512]="CF_ICON",t[t.CF_PROCEDURE=1024]="CF_PROCEDURE",t[t.CF_STRUCTURE=2048]="CF_STRUCTURE",t[t.CF_USEDEFICON=4096]="CF_USEDEFICON",t[t.CF_SIZEABLE=8192]="CF_SIZEABLE",t[t.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",t[t.TCF_WASSAVE=1]="TCF_WASSAVE",t[t.TCF_NEWCLASS=2]="TCF_NEWCLASS",t[t.OF_DISABLED=1]="OF_DISABLED",t[t.OF_ONEFASE=2]="OF_ONEFASE",t[t.OF_ERROR=4]="OF_ERROR",t[t.LF_DISABLED=1]="LF_DISABLED",t[t.LF_AUTOLINK=2]="LF_AUTOLINK",t[t.VF_LOCAL=2]="VF_LOCAL",t[t.VF_NOREAD=4]="VF_NOREAD",t[t.VF_NOWRITE=8]="VF_NOWRITE",t[t.VF_STATIC=16]="VF_STATIC",t[t.VF_ONSCHEME=32]="VF_ONSCHEME",t[t.VF_PARAMETER=64]="VF_PARAMETER",t[t.VF_LEFT=128]="VF_LEFT",t[t.VF_EQVAR=256]="VF_EQVAR",t[t.VF_ARGUMENT=512]="VF_ARGUMENT",t[t.VF_RETURN=1024]="VF_RETURN",t[t.VF_NOSAVE=2048]="VF_NOSAVE",t[t.VF_GLOBAL=4096]="VF_GLOBAL",t[t.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",t[t.SF_EXTERNAL=1]="SF_EXTERNAL",t[t.SF_EDITING=2]="SF_EDITING",t[t.STATE_FAST=0]="STATE_FAST",t[t.STATE_VARS=1]="STATE_VARS",t[t.STATE_DEBUG=2]="STATE_DEBUG",t[t.STATE_SET=3]="STATE_SET",t[t.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",t[t.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",t[t.CHF_WASSIZED=4]="CHF_WASSIZED",t[t.CHF_PREPROCESS=8]="CHF_PREPROCESS",t[t.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",t[t.IF_CORRECTED=1]="IF_CORRECTED",t[t.EF_RUNNING=1]="EF_RUNNING",t[t.EF_MUSTSTOP=2]="EF_MUSTSTOP",t[t.EF_STEPACTIVE=4]="EF_STEPACTIVE",t[t.EF_EQUACTIVE=8]="EF_EQUACTIVE",t[t.EF_MSGACTIVE=16]="EF_MSGACTIVE",t[t.EF_BYTIMER=32]="EF_BYTIMER"})(C||(C={}));var fa={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone",lib_norecurse:"notRecursive",preload_file:"preloadFile"};function ga(t){let e={},r=t.uint16();for(let i=0;i<r;++i){let n=t.uint16(),s=t.byte(),a=t.byte(),u=t.fixedString(a-1);t.byte();let c;switch(s){case 0:c=t.int32();break;case 1:c=t.float64();break;case 2:c=t.fixedString(n-a-3),t.byte();break;default:throw new ae(t,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${s}`)}let m=fa[u];m?e[m]=c:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${u} (${c})`)}return e}function _a(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=Array.from({length:t.uint16()},()=>t.uint16()),s=t.string(),a=t.string();r[i]={path:n,name:s,info:a}}return r}function yt(t){let e=t.uint16();if(e!==26697)throw new J(t,e,26697);let r={rootClassName:""},i=0;for(;(i=t.uint16())!==0;)switch(i){case C.PR_PASSWORD:t.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case C.PR_MAINCLASS:r.rootClassName=t.string();break;case C.PR_VARS:r.settings=ga(t);break;case C.PR_WATCH:r.watchedVariables=_a(t);break}if(!r.rootClassName)throw new ae(t,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return r}function ai(t){let e=t.int32(),r=t.uint16(),i=t.string(),n=t.int32(),s=Array.from({length:t.uint16()},()=>({name:t.string(),value:t.string()})),a=[];for(;t.pos()<e;)a.push(ai(t));return{handle:r,classname:i,classId:n,values:s,childSets:a}}function Et(t){let e=t.uint16();if(e!==19)throw new J(t,e,19);switch(t.seek(21),t.string(),t.uint16(),t.uint16(),t.uint16()){case C.VR_CLASSES:throw new ae(t,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case C.VR_SETVAR:return ai(t)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}var te;(function(t){t[t.SWF_AUTOSCROLL=1]="SWF_AUTOSCROLL",t[t.SWF_HSCROLL=2]="SWF_HSCROLL",t[t.SWF_VSCROLL=4]="SWF_VSCROLL",t[t.SWF_SPACESIZE=8]="SWF_SPACESIZE",t[t.SWF_NORESIZE=16]="SWF_NORESIZE",t[t.SWF_DIALOG=32]="SWF_DIALOG",t[t.SWF_POPUP=64]="SWF_POPUP",t[t.SWF_MDI=128]="SWF_MDI",t[t.SWF_WINTYPE=224]="SWF_WINTYPE",t[t.SWF_MODAL=256]="SWF_MODAL",t[t.SWF_AUTOORG=512]="SWF_AUTOORG",t[t.SWF_MAXIMIZE=1024]="SWF_MAXIMIZE",t[t.SWF_MINIMIZE=2048]="SWF_MINIMIZE"})(te||(te={}));var ui;(function(t){t[t.DISABLE_SUBWINDOW=1]="DISABLE_SUBWINDOW",t[t.CAN_SELECT_UNSELECTABLE=8]="CAN_SELECT_UNSELECTABLE"})(ui||(ui={}));var li=class{constructor(e,r,i=!1,n=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.data=r,this.pos=n,this.view=e,this.is_with_alpha=!!i,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){let e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let r=0;r<e;r++){let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.palette[r]={red:s,green:n,blue:i,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){let e="bit"+this.bitPP,r=this.width*this.height*4;if(this.data.length!==r)throw Error("Error reading BMP file");if(e!=="bit1"&&e!=="bit4"&&e!=="bit8"&&e!=="bit15"&&e!=="bit16"&&e!=="bit24"&&e!=="bit32")throw new Error("Unknown bit: "+e);this[e]()}bit1(){let e=Math.ceil(this.width/8),r=e%4,i=this.height>=0?this.height-1:-this.height;for(i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<e;s++){let a=this.view.getUint8(this.pos++),u=n*this.width*4+s*8*4;for(let c=0;c<8&&s*8+c<this.width;c++){let m=this.palette[a>>7-c&1];this.data[u+c*4]=m.red,this.data[u+c*4+1]=m.green,this.data[u+c*4+2]=m.blue,this.data[u+c*4+3]=255}}r!==0&&(this.pos+=4-r)}}bit4(){if(this.compress===2){this.data.fill(255);let e=0,r=this.bottom_up?this.height-1:0,i=!1,n=s=>{let a=this.palette[s];this.data[e]=a.red,this.data[e+1]=a.green,this.data[e+2]=a.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){let s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);if(s===0)if(a===0){this.bottom_up?r--:r++,e=r*this.width*4,i=!1;continue}else{if(a===1)break;if(a===2){let u=this.view.getUint8(this.pos++),c=this.view.getUint8(this.pos++);this.bottom_up?r-=c:r+=c,e+=c*this.width*4+u*4}else{let u=this.view.getUint8(this.pos++);for(let c=0;c<a;c++)i?n.call(this,u&15):n.call(this,(u&240)>>4),c&1&&c+1<a&&(u=this.view.getUint8(this.pos++)),i=!i;(a+1>>1&1)==1&&this.pos++}}else for(let u=0;u<s;u++)i?n.call(this,a&15):n.call(this,(a&240)>>4),i=!i}}else{let e=Math.ceil(this.width/2),r=e%4;for(let i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<e;s++){let a=this.view.getUint8(this.pos++),u=n*this.width*4+s*2*4,c=a>>4,m=a&15,d=this.palette[c];if(this.data[u]=d.red,this.data[u+1]=d.green,this.data[u+2]=d.blue,this.data[u+3]=255,s*2+1>=this.width)break;d=this.palette[m],this.data[u+4]=d.red,this.data[u+4+1]=d.green,this.data[u+4+2]=d.blue,this.data[u+4+3]=255}r!==0&&(this.pos+=4-r)}}}bit8(){if(this.compress===1){this.data.fill(255);let e=0,r=this.bottom_up?this.height-1:0,i=n=>{let s=this.palette[n];this.data[e]=s.red,this.data[e+1]=s.green,this.data[e+2]=s.blue,this.data[e+3]=255,e+=4};for(;e<this.data.length;){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++);if(n===0)if(s===0){this.bottom_up?r--:r++,e=r*this.width*4;continue}else{if(s===1)break;if(s===2){let a=this.view.getUint8(this.pos++),u=this.view.getUint8(this.pos++);this.bottom_up?r-=u:r+=u,e+=u*this.width*4+a*4}else{for(let a=0;a<s;a++){let u=this.view.getUint8(this.pos++);i.call(this,u)}(s&1)==1&&this.pos++}}else for(let a=0;a<n;a++)i.call(this,s)}}else{let e=this.width%4;for(let r=this.height-1;r>=0;r--){let i=this.bottom_up?r:this.height-1-r;for(let n=0;n<this.width;n++){let s=this.view.getUint8(this.pos++),a=i*this.width*4+n*4;if(s<this.palette.length){let u=this.palette[s];this.data[a]=u.red,this.data[a+1]=u.green,this.data[a+2]=u.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}e!==0&&(this.pos+=4-e)}}}bit15(){let e=this.width%3,r=parseInt("11111",2),i=r;for(let n=this.height-1;n>=0;n--){let s=this.bottom_up?n:this.height-1-n;for(let a=0;a<this.width;a++){let u=this.view.getUint16(this.pos,!0);this.pos+=2;let c=(u&i)/i*255|0,m=(u>>5&i)/i*255|0,d=(u>>10&i)/i*255|0,S=s*this.width*4+a*4;this.data[S]=d,this.data[S+1]=m,this.data[S+2]=c,this.data[S+3]=255}this.pos+=e}}bit16(){let e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);let r=[0,0,0];for(let i=0;i<16;i++)this.maskRed>>i&1&&r[0]++,this.maskGreen>>i&1&&r[1]++,this.maskBlue>>i&1&&r[2]++;r[1]+=r[0],r[2]+=r[1],r[0]=8-r[0],r[1]-=8,r[2]-=8;for(let i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let s=0;s<this.width;s++){let a=this.view.getUint16(this.pos,!0);this.pos+=2;let u=(a&this.maskBlue)<<r[0],c=(a&this.maskGreen)>>r[1],m=(a&this.maskRed)>>r[2],d=n*this.width*4+s*4;this.data[d]=m,this.data[d+1]=c,this.data[d+2]=u,this.data[d+3]=255}this.pos+=e}}bit24(){for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),u=r*this.width*4+i*4;this.data[u]=a,this.data[u+1]=s,this.data[u+2]=n,this.data[u+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){this.view.getUint8(this.pos++);let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++),u=r*this.width*4+i*4;this.data[u]=a,this.data[u+1]=s,this.data[u+2]=n,this.data[u+3]=255}}}else for(let e=this.height-1;e>=0;e--){let r=this.bottom_up?e:this.height-1-e;for(let i=0;i<this.width;i++){let n=this.view.getUint8(this.pos++),s=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);let u=r*this.width*4+i*4;this.data[u]=a,this.data[u+1]=s,this.data[u+2]=n,this.data[u+3]=255}}}};function vt(t,e){new li(t,e)}function Ct(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}function Wt(t){let e=t.pos(),r=t.uint16();if(r!==19778)throw new J(t,r,19778);let i=t.int32();return t.seek(e),i}function jt(t){return new DataView(t.buffer,t.byteOffset)}function It(t){let e=t.bytes(Wt(t)),r=jt(e),{width:i,height:n}=Ct(r);if(i===0||n===0)return null;let s=document.createElement("canvas");s.width=i,s.height=n;let a=s.getContext("2d",{alpha:!1});if(!a)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${t.name}`);let u=a.createImageData(i,n);return vt(r,u.data),a.putImageData(u,0,0),a}function Ve(t){let e=t.bytes(Wt(t)),r=t.bytes(Wt(t)),i=jt(e),{width:n,height:s}=Ct(i);if(n===0||s===0)return null;let a=document.createElement("canvas");a.width=n,a.height=s;let u=a.getContext("2d",{alpha:!0});if(!u)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${t.name}`);let c=u.createImageData(n,s),m=c.data,d=new Uint8ClampedArray(n*s*4);vt(i,m),vt(jt(r),d);for(let S=3;S<m.length&&S<d.length;S+=4)m[S]=255^d[S-1];return u.putImageData(c,0,0),u}var H;(function(t){t[t.otGROUP=1]="otGROUP",t[t.otCOLLECTION=1e3]="otCOLLECTION",t[t.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",t[t.otPENCOLLECTION=1004]="otPENCOLLECTION",t[t.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",t[t.otDIBCOLLECTION=1006]="otDIBCOLLECTION",t[t.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",t[t.otFONTCOLLECTION=1008]="otFONTCOLLECTION",t[t.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",t[t.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",t[t.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",t[t.ot3DCOLLECTION=1012]="ot3DCOLLECTION",t[t.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",t[t.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",t[t.otDATAITEMS=1022]="otDATAITEMS",t[t.otMATERIALS3D=1024]="otMATERIALS3D",t[t.otSPACE2D=17458]="otSPACE2D",t[t.otSPACE3D=17459]="otSPACE3D",t[t.otSPACE3Df=25668]="otSPACE3Df",t[t.otGROUP2D=3]="otGROUP2D",t[t.otRGROUP2D=4]="otRGROUP2D",t[t.otGROUP3D=5]="otGROUP3D",t[t.otOBJECT3D=10]="otOBJECT3D",t[t.otCAMERA3D=11]="otCAMERA3D",t[t.otLIGHT3D=12]="otLIGHT3D",t[t.otLINE2D=20]="otLINE2D",t[t.otBITMAP2D=21]="otBITMAP2D",t[t.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",t[t.otTEXT2D=23]="otTEXT2D",t[t.otVIEW3D2D=24]="otVIEW3D2D",t[t.otUSEROBJECT2D=25]="otUSEROBJECT2D",t[t.otCONTROL2D=26]="otCONTROL2D",t[t.otEDITFRAME2D=50]="otEDITFRAME2D",t[t.otROTATECENTER2D=51]="otROTATECENTER2D",t[t.otFRAME3D=52]="otFRAME3D",t[t.otAXIS3D=53]="otAXIS3D",t[t.ttPEN2D=101]="ttPEN2D",t[t.ttBRUSH2D=102]="ttBRUSH2D",t[t.ttDIB2D=103]="ttDIB2D",t[t.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",t[t.ttFONT2D=105]="ttFONT2D",t[t.ttSTRING2D=106]="ttSTRING2D",t[t.ttTEXT2D=107]="ttTEXT2D",t[t.ttREFTODIB2D=110]="ttREFTODIB2D",t[t.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",t[t.ctINFONAME=200]="ctINFONAME",t[t.ctINFOAUTOR=201]="ctINFOAUTOR",t[t.ctINFOINFO=202]="ctINFOINFO",t[t.ctCRDSYSTEM=203]="ctCRDSYSTEM",t[t.stSPACEDATA=204]="stSPACEDATA",t[t.stOBJNAME=205]="stOBJNAME"})(H||(H={}));function hi(t,e){if(t!==H.ttPEN2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Pen");return{handle:e.uint16(),color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()}}function ci(t,e){if(t!==H.ttBRUSH2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Brush");return{handle:e.uint16(),color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()}}function mi(t,e){switch(t){case H.ttDIB2D:return{type:"image",handle:e.uint16(),img:It(e)};case H.ttREFTODIB2D:return{type:"BMPReference",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Dib")}}function bi(t,e){switch(t){case H.ttDOUBLEDIB2D:return{type:"image",handle:e.uint16(),img:Ve(e)};case H.ttREFTODOUBLEDIB2D:return{type:"DBMReference",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 DoubleDib")}}function pi(t,e,r){if(t!==H.ttFONT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Font");let i=e.pos(),n={handle:e.uint16(),height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),fontName:e.nulltString(32)};return r>=515&&(n.size=e.int32(),n.style=e.int32()),n}function di(t,e){if(t!==H.ttSTRING2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 String");return{handle:e.uint16(),text:e.string()}}function Ta(t){return{fgColor:t.int32(),bgColor:t.int32(),fontHandle:t.uint16(),stringHandle:t.uint16()}}function fi(t,e,r){if(t!==H.ttTEXT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Text");let i=e.uint16(),n=new z(e,r,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u044B\u0445 \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\u043E\u0432"),s=n.readCollection(Ta);return n.checkReaded(),{handle:i,textCollection:s}}function Xt(t){return t.uint16()}function Yt(t,e){let r={handle:t.uint16(),options:t.uint16()};return e>=258&&e<768&&(r.name=t.string()),r}function He(t,e){return e<512?$($({},Yt(t,e)),{originX:t.int16(),originY:t.int16(),width:t.int16(),height:t.int16()}):$($({},Yt(t,e)),{originX:t.float64(),originY:t.float64(),width:t.float64(),height:t.float64()})}function gi(t,e){let r=Yt(t,e),i=new z(t,e,"\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0433\u0440\u0443\u043F\u043F\u044B"),n=i.readCollection(Xt);return i.checkReaded(),$($({type:"group"},r),{childHandles:n})}function _i(t,e){let r=He(t,e),i=t.uint16(),n=t.uint16(),s=t.uint16()*2,a=new Array(s);for(let c=0;c<s;c+=2)e<512?(a[c+0]=t.int16(),a[c+1]=t.int16()):(a[c+0]=t.float64(),a[c+1]=t.float64());let u=$($({type:"line"},r),{penHandle:i,brushHandle:n,coords:a});if(e>512){let c=t.byte();c>0&&(u.arrows=t.bytes(c))}return u}function Gt(t,e,r){return $($({type:r},He(t,e)),{cropX:e<512?t.int16():t.float64(),cropY:e<512?t.int16():t.float64(),cropW:e<512?t.int16():t.float64(),cropH:e<512?t.int16():t.float64(),angle:t.int16(),dibHandle:t.uint16()})}function Ti(t,e){return $($({type:"text"},He(t,e)),{textToolHandle:t.uint16(),delta:t.point2d(e<512),angle:t.int16()})}function Si(t,e){let r=He(t,e),i=t.string(),n=i.toUpperCase();if(n!=="EDIT"&&n!=="BUTTON"&&n!=="COMBOBOX")throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430 Control #${r.handle}: ${i}`);let s=$($({type:"control"},r),{inputType:n,text:t.string(),dwStyle:t.int32(),exStyle:t.int32(),id:t.uint16(),controlSize:t.point2d(!0)});return t.uint16(),s}function wi(t,e){return $($({type:"view3D"},He(t,e)),{spaceHandle:t.uint16(),cameraHandle:t.uint16()})}function yi(t,e){return $($({type:"editFrame"},He(t,e)),{objectHandle:t.uint16(),size:t.point2d(e<512)})}function Ei(t,e){let r={},i=0,n=t.pos()+e;for(;t.pos()<n&&(i=t.uint16())!==0;)switch(i){case 1:r.target=t.string();break;case 2:r.windowName=t.string();break;case 3:r.objectName=t.string();break;case 4:r.openMode=t.uint16();break;case 5:r.effect=t.string();break;case 6:r.time=t.uint16();break;case 7:r.disabled=!0;break;case 8:r.params=t.string();break}return r}function zt(t,e){let r=t.uint16();return t.skip(5),Array.from({length:r},()=>{let i=t.uint16(),n=t.uint16();return e(i,n,t)})}function vi(t,e){return{type:t.uint16(),objectHandle:t.int16(),center:t.point2d(e<512),matrix:Array.from({length:9},()=>t.float64())}}var z=class{constructor(e,r,i){this.name=i;this.reader=e,this.version=r,this.start=e.pos(),this.code=e.int16(),this.size=r>=768?e.int32():0}goEnd(){this.reader.seek(this.start+this.size)}readToolCollection(e){let r=this.reader.uint16();return this.reader.skip(7),Array.from({length:r},()=>{let i=new z(this.reader,this.version,"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442");this.reader.skip(2);let n=e(i.code,this.reader,this.version);return i.checkReaded(),n})}readElementCollection(){let e=this.reader.uint16();return this.reader.skip(7),Array.from({length:e},()=>{let{reader:r,version:i}=this,n=new z(r,i,"\u0413\u0440\u0430\u0444. \u043E\u0431\u044A\u0435\u043A\u0442"),s;switch(n.code){case H.otGROUP2D:s=gi(r,i);break;case H.otLINE2D:s=_i(r,i);break;case H.otBITMAP2D:s=Gt(r,i,"bitmap");break;case H.otDOUBLEBITMAP2D:s=Gt(r,i,"doubleBitmap");break;case H.otTEXT2D:s=Ti(r,i);break;case H.otCONTROL2D:s=Si(r,i);break;case H.otVIEW3D2D:s=wi(r,this.version);break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442: ${H[n.code]}`)}if(i<768)return s;for(;n.hasData();){let a=new z(this.reader,this.version,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435");a.readElementData(s),a.checkReaded()}return n.checkReaded(),s})}readElementData(e){switch(this.code){case H.otDATAITEMS:zt(this.reader,function(r,i,n){switch(r){case 10:e.hyperbase=Ei(n,i);break;case 13:n.nulltString(i);break;case 14:n.nulltString(i);break;default:console.warn(`${n.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 ${e.type} #${e.handle}: id ${r}, ${i} \u0431\u0430\u0439\u0442\u043E\u0432`),n.skip(i)}});break;case H.stOBJNAME:e.name=this.reader.fixedString(this.size-6);break}}readCollection(e){let r=this.reader.uint16();return this.reader.skip(4),Array.from({length:r},()=>e(this.reader))}readObject(e){switch(this.code){case 1004:e.penTools=this.readToolCollection(hi);break;case 1005:e.brushTools=this.readToolCollection(ci);break;case 1006:e.dibTools=this.readToolCollection(mi);break;case 1007:e.doubleDibTools=this.readToolCollection(bi);break;case 1008:e.fontTools=this.readToolCollection(pi);break;case 1009:e.stringTools=this.readToolCollection(di);break;case 1010:e.textTools=this.readToolCollection(fi);break;case 1012:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 3D-\u0444\u0440\u0435\u0439\u043C\u043E\u0432 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");case H.otPRIMARYCOLLECTION:e.elementOrder=this.readCollection(Xt);break;case H.otOBJECTCOLLECTION:e.elements=this.readElementCollection();break;case H.otDATAITEMS:zt(this.reader,(i,n,s)=>{switch(i){case 1:e.grid={offsetX:s.float64(),offsetY:s.float64(),stepX:s.float64(),stepY:s.float64(),visible:!!s.byte(),use:!!s.byte()};break;case 11:e.settings={style:s.uint32(),x:s.uint16(),y:s.uint16()};break;case 13:s.skip(n);break;default:console.warn(`${s.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0441\u0442\u0440\u0430\u043D\u0441\u0442\u0432\u0430: id ${i}, ${n} \u0431\u0430\u0439\u0442\u043E\u0432`),s.skip(n);break}});break;case H.ctINFONAME:this.reader.skip(this.reader.uint16());break;case H.ctINFOAUTOR:this.reader.skip(this.reader.uint16());break;case H.ctINFOINFO:this.reader.skip(this.reader.uint16());break;case H.ctCRDSYSTEM:e.crdSystem=vi(this.reader,this.version);break;case H.otEDITFRAME2D:let r=yi(this.reader,this.version);console.warn(`${this.reader.name}: \u0444\u0440\u0435\u0439\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F #${r.objectHandle} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`);break;default:console.warn(`${this.reader.name}: ${H[this.code]} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.goEnd()}}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.reader.pos()-this.start}checkReaded(){if(this.version<768)return;let e=this.readedBytes();if(e>this.size)throw Error(`Chunk ${this.name} data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk ${this.name} not readed: ${e} instead of ${this.size}`)}};function Sa(t,e){let r=new z(t,e,"VDR");if(r.code!==H.stSPACEDATA)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x");let i={version:e,origin:t.point2d(),scaleDiv:t.point2d(),scaleMul:t.point2d(),state:t.uint16(),brushHandle:t.uint16(),layers:t.uint32(),flags:t.uint16()};for(;r.hasData();){let n=new z(t,e,"");n.readObject(i),n.checkReaded()}return r.checkReaded(),i}function wa(t,e,r){var f;let i=t.int32()+r,n=t.int32()+r,s=t.point2d(e<512),a=t.point2d(e<512),u=t.point2d(e<512);t.string();let c=t.uint16();t.string(),t.string(),t.string(),new z(t,e,"RCenter").goEnd(),new z(t,e,"Frame").goEnd();let m=t.uint16(),d={version:e,origin:s,scaleDiv:a,scaleMul:u,state:c,flags:0,brushHandle:m,layers:0};t.seek(i),new z(t,e,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(d),new z(t,e,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(d),t.seek(n);let S=t.uint16();for(let y=0;y<S;++y)new z(t,e,"").readObject(d);if(e>258){d.layers=t.uint32(),d.flags=t.uint16();let y;for(;(y=t.uint16())!==0;)switch(y){case 1:let g=t.uint16(),R=(f=d.elements)==null?void 0:f.find(O=>O.handle===g);if(!R)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435`);new z(t,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readElementData(R);break;case 2:new z(t,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readObject(d);break;default:return d}}return t.string(),d}function Ce(t,e,r=!0){let i=t.uint16();if(i!==17458)throw new J(t,i,17458);let n=t.pos(),s=t.uint16();t.skip(2);let a=s<768?wa(t,s,n):Sa(t,s);if(a.source=e,!r)return a;let u=t.size()-t.pos();if(u!==0){let c=`${t.name}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${t.pos()} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${u}. v0x${a.version.toString(16)}.`;console.warn(c)}return a}var P=class extends Map{static create(e){return new Map(e)}static getFreeHandle(e,r){let i=r||0;for(;e.has(++i););return i}static getFreeNegativeHandle(e){let r=0;for(;e.has(--r););return r}};var Ii=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]);var Re=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,originX:a,originY:u,type:c,dibHandle:m,width:d,height:S,cropX:f,cropY:y,cropW:g,cropH:R}){this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.markDeleted=!1,e.dirty=!0,this.isDouble=c==="doubleBitmap",this.type=this.isDouble?22:21;let O=(this.isDouble?e.doubleDibs:e.dibs).get(m);O==null||O.subscribe(this),this.dib=O||null,this._originX=a,this._originY=u;let M=(O==null?void 0:O.width())||0,F=(O==null?void 0:O.height())||0;this.hardHidden=s?!!(s&1):!1,this._width=this.hardHidden?1:d||M,this._height=this.hardHidden?1:S||F,this.cropX=f||0,this.cropY=y||0,this.cropW=g||M,this.cropH=R||F;let V=s||0;this._visible=!0,this._selectable=V&8?0:1;let x=V>>8&31;this._layer=1<<x,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var u;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(u=this._parent)==null||u.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){var e;return((e=this.dib)==null?void 0:e.width())||0}height(){return this._height}actualHeight(){var e;return((e=this.dib)==null?void 0:e.height())||0}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}copy(e,r){var a,u;let i=(u=(a=this.dib)==null?void 0:a.copy(e,this.isDouble).handle)!=null?u:0,n=P.getFreeHandle(e.objects),s=new Re(e,{handle:n,name:this.name,originX:this._originX,originY:this._originY,height:this._height,width:this._width,cropH:this.cropH,cropW:this.cropW,cropX:this.cropX,cropY:this.cropY,type:this.isDouble?"doubleBitmap":"bitmap",dibHandle:i});return s.hyperbase=this.hyperbase,s._selectable=this._selectable,s._layer=this._layer,s._visible=this._visible,e.objects.set(n,s),e.primaryObjects.push(s),s}setBitmapRect(e,r,i,n){return e<0||r<0||i<0||n<0?0:(this.cropX=e,this.cropY=r,this.cropW=i,this.cropH=n,this.scene.dirty=!0,1)}dibHandle(){return!this.isDouble&&this.dib?this.dib.handle:0}doubleDIBHandle(){return this.isDouble&&this.dib?this.dib.handle:0}delete(){var e,r;(e=this.dib)==null||e.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,u=this._originY-r,c=a*s-u*n,m=a*n+u*s;this._originX=c+e,this._originY=m+r,this.scene.dirty=!0}render(e,r,i,n){if(this.hardHidden||!this.dib||!this._visible||(this._layer&n)!=0)return;let s=this._originX-r,a=this._originY-i;this.dib.render(e,this.cropX,this.cropY,this.cropW,this.cropH,s,a,this._width,this._height)}tryClick(e,r,i){if(this.hardHidden||!this.dib||!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=e-this._originX,s=r-this._originY;if(n<0||s<0||n>this._width||s>this._height)return;let a=n*(this.cropW/this._width)+this.cropX,u=s*(this.cropH/this._height)+this.cropY;if(!!this.dib.tryClick(a,u))return this._parent?this._parent.root():this}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}itemCount(){return 0}setControlFont(){return 0}};var De=class{constructor(e,{hyperbase:r,handle:i,options:n,name:s,originX:a,originY:u,width:c,height:m,inputType:d,text:S}){this.type=26;this.fontTool=null;if(d!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${d} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);this.inputType=d,this.hyperbase=r!=null?r:null,this.handle=i,this.name=s||"",this.scene=e,this.markDeleted=!1,this._originX=a,this._originY=u,this._width=c,this._height=m;let f=n||0;this._visible=!0,this._selectable=f&8?0:1;let y=f>>8&31;this._layer=1<<y,this._parent=null,e.dirty=!0,this.lastX=a-e.originX(),this.lastY=u-e.originY(),this.lastWidth=c,this.lastHeight=m,this.lastHidden=!this._visible;let g=this.element=document.createElement("input");g.setAttribute("type","text"),g.setAttribute("class","stratum-textbox"),g.style.setProperty("position","absolute"),g.style.setProperty("left",this.lastX+"px"),g.style.setProperty("top",this.lastY+"px"),g.style.setProperty("width",c+"px"),g.style.setProperty("height",m+"px"),g.value=S,g.hidden=this.lastHidden,g.addEventListener("input",this),g.addEventListener("focus",this),e.view.appendChild(g)}toolChanged(e){this.element.style.setProperty("font",e.toCSSString())}handleEvent(e){this.scene.dispatchControlNotifyEvent(this.handle,e)}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var u;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(u=this._parent)==null||u.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}copy(e,r){let i=P.getFreeHandle(e.objects),n=new De(e,{handle:i,name:this.name,originX:this._originX,originY:this._originY,height:this._height,width:this._width,inputType:this.inputType,text:this.element.value});return n.hyperbase=this.hyperbase,n._selectable=this._selectable,n._layer=this._layer,n._visible=this._visible,e.objects.set(i,n),e.primaryObjects.push(n),n}setControlFont(e){var i;let r=this.scene.fonts.get(e);return r?((i=this.fontTool)==null||i.unsubscribe(this),this.fontTool=r,r.subscribe(this),this.element.style.setProperty("font",r.toCSSString()),1):0}controlText(){return this.element.value}setControlText(e){return this.element.value=e,1}delete(){var e,r;this.element.remove(),(e=this.fontTool)==null||e.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,u=this._originY-r,c=a*s-u*n,m=a*n+u*s;this._originX=c+e,this._originY=m+r,this.scene.dirty=!0}render(e,r,i,n){let s=!this._visible||(this._layer&n)!=0;s!==this.lastHidden&&(this.lastHidden=s,this.element.hidden=s);let a=this._originX-r,u=this._originY-i;(a!==this.lastX||u!==this.lastY)&&(this.lastX=a,this.lastY=u,this.element.style.setProperty("left",a+"px"),this.element.style.setProperty("top",u+"px"));let c=this._width,m=this._height;(c!==this.lastWidth||m!==this.lastHeight)&&(this.lastWidth=c,this.lastHeight=m,this.element.style.setProperty("width",c+"px"),this.element.style.setProperty("height",m+"px"))}tryClick(e,r,i){if(!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=e-this._originX,s=r-this._originY;if(!(n<0||s<0||n>this._width||s>this._height))return this._parent?this._parent.root():this}textToolHandle(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}pointOriginX(){return 0}pointOriginY(){return 0}setPointOrigin(){return 0}addPoint(){return 0}pointCount(){return 0}penHandle(){return 0}brushHandle(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}itemCount(){return 0}};var fe=class{constructor(e,{hyperbase:r,handle:i,name:n}){this.type=3;this._minX=0;this._maxX=0;this._minY=0;this._maxY=0;this._parent=null;this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.children=[],this.markDeleted=!1}addChildren(e){var r;return e.length===0?this:(this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity,e.forEach(i=>{let n=this.scene.objects.get(i);!n||(this._minX=Math.min(this._minX,n.minX()),this._minY=Math.min(this._minY,n.minY()),this._maxX=Math.max(this._maxX,n.maxX()),this._maxY=Math.max(this._maxY,n.maxY()),n.onParentChanged(this),this.children.push(n))}),(r=this._parent)==null||r.updateBorders(),this)}root(){let e=this;for(;e._parent;)e=e._parent;return e}ungroup(){this.markDeleted=!0;for(let e of this.children.values())e.onParentChanged(null);this.onParentChanged(null)}removeChild(e){this.markDeleted||(this.children=this.children.filter(r=>r.handle!==e.handle),this.children.length===0&&(this._minX=0,this._maxX=0,this._minY=0,this._maxY=0),this.updateBorders())}updateBorders(){var e;if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let r of this.children.values())this._minX=Math.min(this._minX,r.minX()),this._minY=Math.min(this._minY,r.minY()),this._maxX=Math.max(this._maxX,r.maxX()),this._maxY=Math.max(this._maxY,r.maxY());(e=this._parent)==null||e.updateBorders()}}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._minX,i=this._minY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._minX,i=this._minY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var u;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this.onParentMoved(s-this._minX,a-this._minY),(u=this._parent)==null||u.updateBorders(),1}width(){return this._maxX-this._minX}actualWidth(){return this._maxX-this._minX}height(){return this._maxY-this._minY}actualHeight(){return this._maxY-this._minY}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this.width(),n=this.height();return i===0||n===0||(this.onParentResized(this._minX,this._minY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){for(let r of this.children.values())r.setVisibility(e);return 1}copy(e,r){let i=this.children.map(a=>a.copy(e,r).handle),n=P.getFreeHandle(e.objects),s=new fe(e,{handle:n,name:this.name}).addChildren(i);return s.hyperbase=this.hyperbase,e.objects.set(n,s),s}itemCount(){return this.children.length}itemHandle(e){return e<0||e>=this.children.length?0:this.children[e].handle}addItem(e){let r=this.scene.objects.get(e);return!r||this.children.some(i=>i.handle===e)?0:(r.onParentChanged(this),this.children.push(r),this.updateBorders(),1)}deleteItem(e){let r=this.children.find(i=>i.handle===e);return r?(r.onParentChanged(null),1):0}delete(){this.markDeleted=!0;for(let e of this.children.values())e.delete();this.onParentChanged(null)}getChildByName(e){if(this.name===e)return this.handle;for(let r of this.children.values()){let i=r.getChildByName(e);if(i!==0)return i}return 0}minX(){return this._minX}minY(){return this._minY}maxX(){return this._maxX}maxY(){return this._maxY}onParentChanged(e){var r;if(e!==this._parent){{let i=e;for(;i;){if(i===this)return;i=i._parent}}(r=this._parent)==null||r.removeChild(this),this._parent=e}}onParentMoved(e,r){if(this.children.length!==0){for(let i of this.children.values())i.onParentMoved(e,r);this._minX+=e,this._minY+=r,this._maxX+=e,this._maxY+=r}}onParentResized(e,r,i,n){if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let s of this.children.values())s.onParentResized(e,r,i,n),this._minX=Math.min(this._minX,s.minX()),this._minY=Math.min(this._minY,s.minY()),this._maxX=Math.max(this._maxX,s.maxX()),this._maxY=Math.max(this._maxY,s.maxY())}}onParentRotated(e,r,i){if(this.children.length!==0){this._minX=Infinity,this._maxX=-Infinity,this._minY=Infinity,this._maxY=-Infinity;for(let n of this.children.values())n.onParentRotated(e,r,i),this._minX=Math.min(this._minX,n.minX()),this._minY=Math.min(this._minY,n.minY()),this._maxX=Math.max(this._maxX,n.maxX()),this._maxY=Math.max(this._maxY,n.maxY())}}addPoint(){return 0}deletePoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}setControlFont(){return 0}};var ue=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,coords:a,penHandle:u,brushHandle:c}){this.type=20;var O,M;if(a.length<2)throw Error("\u041B\u0438\u043D\u0438\u044F \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u043E\u0447\u0435\u043A");this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.cnv=document.createElement("canvas");let m=this.cnv.getContext("2d",{alpha:!0});if(!m)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=m,this.markDeleted=!1,this.needRedraw=!0,e.dirty=!0;let d=a[0],S=a[1],f=d,y=S;for(let F=2;F<a.length;F+=2){let V=a[F+0],x=a[F+1];V<d&&(d=V),V>f&&(f=V),x<S&&(S=x),x>y&&(y=x)}this.coords=a.slice();for(let F=0;F<a.length;F+=2)this.coords[F+0]-=d,this.coords[F+1]-=S;this._originX=d,this._originY=S,this._width=f-d,this._height=y-S;let g=s||0;this._visible=!0,this._selectable=g&8?0:1;let R=g>>8&31;this._layer=1<<R,this._parent=null,this.pen=e.pens.get(u)||null,this.brush=e.brushes.get(c)||null,(O=this.pen)==null||O.subscribe(this),(M=this.brush)==null||M.subscribe(this)}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var u;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(u=this._parent)==null||u.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}actualWidth(){return this._width}height(){return this._height}actualHeight(){return this._height}setSize(e,r){var s;if(e<0||r<0)return 0;let i=this._width,n=this._height;return i===0||n===0||(this.onParentResized(this._originX,this._originY,e/i,r/n),(s=this._parent)==null||s.updateBorders()),1}angle(){return 0}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}copy(e,r){var c,m,d,S;let i=(m=(c=this.brush)==null?void 0:c.copy(e).handle)!=null?m:0,n=(S=(d=this.pen)==null?void 0:d.copy(e).handle)!=null?S:0,s=this.coords.slice();for(let f=0;f<s.length;f+=2)s[f+0]+=this._originX,s[f+1]+=this._originY;let a=P.getFreeHandle(e.objects),u=new ue(e,{handle:a,name:this.name,coords:s,brushHandle:i,penHandle:n});return u.hyperbase=this.hyperbase,u._selectable=this._selectable,u._layer=this._layer,u._visible=this._visible,e.objects.set(a,u),e.primaryObjects.push(u),u}pointOriginX(e){let r=e*2;if(r<0||r>=this.coords.length)return 0;let i=this.scene.invMatrix,n=this.coords[r+0]+this._originX,s=this.coords[r+1]+this._originY,a=n*i[2]+s*i[5]+i[8];return(n*i[0]+s*i[3]+i[6])/a}pointOriginY(e){let r=e*2;if(r<0||r>=this.coords.length)return 0;let i=this.scene.invMatrix,n=this.coords[r+0]+this._originX,s=this.coords[r+1]+this._originY,a=n*i[2]+s*i[5]+i[8];return(n*i[1]+s*i[4]+i[7])/a}updateSize(){var s;let e=Infinity,r=-Infinity,i=Infinity,n=-Infinity;for(let a=0;a<this.coords.length;a+=2){let u=this.coords[a+0],c=this.coords[a+1];u<e&&(e=u),u>r&&(r=u),c<i&&(i=c),c>n&&(n=c)}if(e!==0||i!==0){for(let a=0;a<this.coords.length;a+=2)this.coords[a+0]-=e,this.coords[a+1]-=i;this._originX+=e,this._originY+=i}this._width=r-e,this._height=n-i,(s=this._parent)==null||s.updateBorders(),this.scene.dirty=!0,this.needRedraw=!0}setPointOrigin(e,r,i){let n=e*2;if(n<0||n>=this.coords.length)return 0;let s=this.scene.matrix,a=r*s[2]+i*s[5]+s[8],u=(r*s[0]+i*s[3]+s[6])/a,c=(r*s[1]+i*s[4]+s[7])/a,m=u-this._originX,d=c-this._originY;return this.coords[n+0]=m,this.coords[n+1]=d,this.updateSize(),1}addPoint(e,r,i){if(Math.floor(e)===0)return 0;let n=this.scene.matrix,s=r*n[2]+i*n[5]+n[8],a=(r*n[0]+i*n[3]+n[6])/s,u=(r*n[1]+i*n[4]+n[7])/s,c=a-this._originX,m=u-this._originY,d=e*2;return d<0||d>=this.coords.length?this.coords.push(c,m):this.coords.splice(d,0,c,m),this.updateSize(),1}deletePoint(e){let r=e*2;return e<0||r>this.coords.length?0:(this.coords.splice(r,2),this.updateSize(),1)}pointCount(){return this.coords.length/2}penHandle(){return this.pen?this.pen.handle:0}brushHandle(){return this.brush?this.brush.handle:0}delete(){var e,r,i;(e=this.pen)==null||e.unsubscribe(this),(r=this.brush)==null||r.unsubscribe(this),(i=this._parent)==null||i.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n;for(let s=0;s<this.coords.length;s+=2)this.coords[s+0]*=i,this.coords[s+1]*=n;this._width*=i,this._height*=n,this.needRedraw=!0,this.scene.dirty=!0}onParentRotated(e,r,i){let n=e-this._originX,s=r-this._originY,a=Infinity,u=-Infinity,c=Infinity,m=-Infinity,d=Math.sin(i),S=Math.cos(i);for(let f=0;f<this.coords.length;f+=2){let y=this.coords[f+0]-n,g=this.coords[f+1]-s,R=y*S-g*d+n,O=y*d+g*S+s;this.coords[f+0]=R,this.coords[f+1]=O,R<a&&(a=R),R>u&&(u=R),O<c&&(c=O),O>m&&(m=O)}for(let f=0;f<this.coords.length;f+=2)this.coords[f+0]-=a,this.coords[f+1]-=c;this._originX+=a,this._originY+=c,this._width=u-a,this._height=m-c,this.scene.dirty=!0,this.needRedraw=!0}static drawFigure(e,r,i,n,s,a,u){e.beginPath(),e.moveTo(n[0]+r+u,n[1]+i+u);for(let c=2;c<n.length;c+=2)e.lineTo(n[c]+r+u,n[c+1]+i+u);s&&(e.closePath(),e.fillStyle=s,e.fill("evenodd")),a&&(e.lineWidth=u,e.strokeStyle=a,e.stroke())}render(e,r,i,n){var S,f,y,g;if(!this._visible||(this._layer&n)!=0)return;let s=this.pen?this.pen.width()||1:0,a=this._originX-r-s,u=this._originY-i-s,c=this.coords.length>4&&((S=this.brush)==null?void 0:S.fillStyle(e))||null,m=((f=this.pen)==null?void 0:f.strokeStyle())||null;if(!c&&!m)return;if(this._width*this._height>4194304){this._selectable=0,ue.drawFigure(e,a,u,this.coords,c,m,s);return}this.needRedraw&&(this.cnv.width=Math.max(this._width+s*2,1),this.cnv.height=Math.max(this._height+s*2,1),ue.drawFigure(this.ctx2,0,0,this.coords,c,m,s),this.needRedraw=!1);let d=(g=(y=this.brush)==null?void 0:y.compositeOperation())!=null?g:"source-over";d==="source-over"?e.drawImage(this.cnv,a,u):(e.globalCompositeOperation=d,e.drawImage(this.cnv,a,u),e.globalCompositeOperation="source-over")}tryClick(e,r,i){if(!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=this.pen?this.pen.width()||1:0,s=e-this._originX,a=r-this._originY;if(!(s<-n||a<-n||s>this._width+n||a>this._height+n)&&this.ctx2.getImageData(s,a,1,1).data[3]!==0)return this._parent?this._parent.root():this}toolChanged(){this.needRedraw=!0,this.scene.dirty=!0}textToolHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}itemCount(){return 0}setControlFont(){return 0}};var Kt=class{constructor(e,r,i){this.view=e;this.scene=r;this.lastX=i.x-r.originX(),this.lastY=i.y-r.originY(),e.style.setProperty("position","absolute"),e.style.setProperty("left",this.lastX+"px"),e.style.setProperty("top",this.lastY+"px"),e.style.setProperty("width",i.w+"px"),e.style.setProperty("height",i.h+"px"),r.view.appendChild(e)}setVisibility(e){this.view.style.setProperty("display",e?"block":"none")}close(){this.view.remove()}moveTo(e,r){let i=e-this.scene.originX(),n=r-this.scene.originY();(i!==this.lastX||n!==this.lastY)&&(this.lastX=i,this.lastY=n,this.view.style.setProperty("left",i+"px"),this.view.style.setProperty("top",n+"px"))}};var Oe=class{constructor(e,{hyperbase:r,handle:i,name:n,options:s,originX:a,originY:u,width:c,height:m,angle:d,textToolHandle:S}){this.type=23;var g;this.hyperbase=r!=null?r:null,this.scene=e,this.handle=i,this.name=n||"",this.markDeleted=!1,e.dirty=!0,this.textTool=e.texts.get(S)||null,(g=this.textTool)==null||g.subscribe(this),this._originX=a,this._originY=u,this._angle=d/-10*Math.PI/180,this._width=c||this.actualWidth(),this._height=m||this.actualHeight();let f=s||0;this._visible=!0,this._selectable=f&8?0:1;let y=f>>8&31;this._layer=1<<y,this._parent=null}toolChanged(){this.scene.dirty=!0}parentHandle(){var e;return((e=this._parent)==null?void 0:e.handle)||0}originX(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[0]+i*e[3]+e[6])/n}originY(){let e=this.scene.invMatrix,r=this._originX,i=this._originY,n=r*e[2]+i*e[5]+e[8];return(r*e[1]+i*e[4]+e[7])/n}setOrigin(e,r){var u;let i=this.scene.matrix,n=e*i[2]+r*i[5]+i[8],s=(e*i[0]+r*i[3]+i[6])/n,a=(e*i[1]+r*i[4]+i[7])/n;return this._originX=s,this._originY=a,(u=this._parent)==null||u.updateBorders(),this.scene.dirty=!0,1}width(){return this._width}height(){return this._height}actualWidth(){var e;return((e=this.textTool)==null?void 0:e.width())||0}actualHeight(){var e;return((e=this.textTool)==null?void 0:e.height())||0}setSize(e,r){var i;return e<0||r<0?0:(this._width=e,this._height=r,(i=this._parent)==null||i.updateBorders(),this.scene.dirty=!0,1)}angle(){return this._angle}rotate(e,r,i){var n;return i===0||(this.onParentRotated(e,r,i),(n=this._parent)==null||n.updateBorders()),1}setVisibility(e){return this._visible=e,this.scene.dirty=!0,1}copy(e,r){var a,u;let i=(u=(a=this.textTool)==null?void 0:a.copy(e).handle)!=null?u:0,n=P.getFreeHandle(e.objects),s=new Oe(e,{handle:n,name:this.name,originX:this._originX,originY:this._originY,height:this._height,width:this._width,angle:this._angle,textToolHandle:i});return s.hyperbase=this.hyperbase,s._selectable=this._selectable,s._layer=this._layer,s._visible=this._visible,e.objects.set(n,s),e.primaryObjects.push(s),s}textToolHandle(){return this.textTool?this.textTool.handle:0}delete(){var e,r;(e=this.textTool)==null||e.unsubscribe(this),(r=this._parent)==null||r.removeChild(this),this.markDeleted=!0,this.scene.dirty=!0}getChildByName(e){return this.name===e?this.handle:0}minX(){return this._originX}minY(){return this._originY}maxX(){return this._originX+this._width}maxY(){return this._originY+this._height}onParentChanged(e){var r;e!==this._parent&&((r=this._parent)==null||r.removeChild(this),this._parent=e)}onParentMoved(e,r){this._originX+=e,this._originY+=r,this.scene.dirty=!0}onParentResized(e,r,i,n){this._originX=e+(this._originX-e)*i,this._originY=r+(this._originY-r)*n,this._width*=i,this._height*=n,this.scene.dirty=!0}onParentRotated(e,r,i){let n=Math.sin(i),s=Math.cos(i),a=this._originX-e,u=this._originY-r,c=a*s-u*n,m=a*n+u*s;this._originX=c+e,this._originY=m+r,this._angle+=i,this.scene.dirty=!0}render(e,r,i,n){if(!this.textTool||!this._visible||(this._layer&n)!=0)return;let s=this._originX-r,a=this._originY-i;this.textTool.render(e,s,a,this._width,this._height,this._angle)}tryClick(e,r,i){if(!this.textTool||!this._visible||(this._layer&i)!=0||this._selectable===0)return;let n=Math.sin(-this._angle),s=Math.cos(-this._angle),a=e-this._originX,u=r-this._originY,c=a*s-u*n,m=a*n+u*s;if(!(c<0||m<0||c>this._width||m>this._height))return this._parent?this._parent.root():this}addPoint(){return 0}pointOriginY(){return 0}pointOriginX(){return 0}setPointOrigin(){return 0}penHandle(){return 0}brushHandle(){return 0}controlText(){return""}setControlText(){return 0}setBitmapRect(){return 0}itemHandle(){return 0}deleteItem(){return 0}deletePoint(){return 0}addItem(){return 0}dibHandle(){return 0}doubleDIBHandle(){return 0}pointCount(){return 0}itemCount(){return 0}setControlFont(){return 0}};var xe=class{constructor(e,{handle:r,color:i,hatch:n,rop2:s,style:a,dibHandle:u}){var c;this.handle=r,this.subs=new Set,this._color=i,this._cssColor=oe(i),this._style=a,this._hatch=n,this._rop=s,this._dibTool=u&&e.dibs.get(u)||null,(c=this._dibTool)==null||c.subscribe(this),this.scene=e}toolChanged(){this.subs.forEach(e=>e.toolChanged(this))}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e){var s,a;let r=(a=(s=this._dibTool)==null?void 0:s.copy(e,!1).handle)!=null?a:0,i=P.getFreeHandle(e.brushes),n=new xe(e,{handle:i,color:this._color,dibHandle:r,hatch:this._hatch,rop2:this._rop,style:this._style});return e.brushes.set(i,n),n}dibTool(){return this._dibTool}setDIB(e){var r,i;return(r=this._dibTool)==null||r.unsubscribe(this),this._dibTool=this.scene.dibs.get(e)||null,(i=this._dibTool)==null||i.subscribe(this),this.subs.forEach(n=>n.toolChanged(this)),1}dibHandle(){var e;return((e=this._dibTool)==null?void 0:e.handle)||0}color(){return this._color}setColor(e){return this._color=e,this._cssColor=oe(e),this.subs.forEach(r=>r.toolChanged(this)),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged(this)),1}hatch(){return this._hatch}setHatch(e){return this._hatch=e,1}rop(){return this._rop}setRop(e){return this._rop=e,1}compositeOperation(){switch(this._rop){case v.R2_MASKPEN:return"multiply";case v.R2_NOTXORPEN:return"multiply";default:return"source-over"}}fillStyle(e){var r,i;switch(this._style){case v.BS_SOLID:return this._cssColor;case v.BS_NULL:return null;case v.BS_PATTERN:return(i=(r=this.dibTool())==null?void 0:r.pattern(e))!=null?i:"white";default:return"white"}}};var he=class{static loadBitmap(e){let r=he.promises.get(e);if(r)return r;let i=new Promise(n=>{let s=new Image;s.addEventListener("load",()=>{let a=document.createElement("canvas"),u=a.getContext("2d",{alpha:!1});if(!u||s.width===0||s.height===0){n(null);return}a.width=s.width,a.height=s.height,u.drawImage(s,0,0),n(u)}),s.addEventListener("error",()=>n(null)),s.src=e});return he.promises.set(e,i),i}static loadDBM(e){let r=he.promises.get(e);if(r)return r;let i=new Promise(n=>Y(this,null,function*(){let a=yield(yield fetch(e,{cache:"force-cache"})).arrayBuffer(),u=Ve(new Q(a,e));n(u)}));return he.promises.set(e,i),i}constructor(e){if(this.handle=e.handle,this._pattern=null,this.subs=new Set,e.type==="image")this.img=e.img;else{this.img=null;let r=K.iconsLocation;if(!r)return;let i=`${r.endsWith("/")?r:r+"/"}${e.filename.toUpperCase()}`;(e.type==="BMPReference"?he.loadBitmap:he.loadDBM)(i).then(s=>{this.img=s,this.subs.forEach(a=>a.toolChanged(this))})}}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e,r){let i=r?e.doubleDibs:e.dibs,n=P.getFreeHandle(i),s={type:"image",handle:n,img:this.img},a=new he(s);return i.set(n,a),a}getPixel(e,r){if(!this.img)return 0;let i=this.img.getImageData(e,r,1,1).data;return ze(i[0],i[1],i[2],0)}setPixel(e,r,i){if(!this.img)return 1;let n=this.img.createImageData(1,1),s=n.data;return s[0]=pt(i),s[1]=dt(i),s[2]=ft(i),s[3]=255,this.img.putImageData(n,e,r),this.subs.forEach(a=>a.toolChanged(this)),1}pattern(e){return this.img?this._pattern?this._pattern:this._pattern=e.createPattern(this.img.canvas,"repeat"):null}render(e,r,i,n,s,a,u,c,m){this.img&&e.drawImage(this.img.canvas,r,i,n,s,a,u,c,m)}tryClick(e,r){return this.img?this.img.getImageData(e,r,1,1).data[3]!==0:!1}width(){var e,r;return(r=(e=this.img)==null?void 0:e.canvas.width)!=null?r:0}height(){var e,r;return(r=(e=this.img)==null?void 0:e.canvas.height)!=null?r:0}},le=he;le.promises=new Map;var Be=class{constructor({handle:e,fontName:r,height:i,italic:n,underline:s,strikeOut:a,weight:u}){this.handle=e,this.subs=new Set,this._name=r,this._size=i||0,this._size*=this._size<0?-1:1,this._style=(n?1:0)|(s?2:0)|(a?4:0)|(u?8:0),this._cssName=r.toUpperCase().endsWith(" CYR")?r.slice(0,r.length-4):r}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e){let r=P.getFreeHandle(e.fonts),i=new Be({handle:r,fontName:this._name,height:this._size});return i._style=this._style,e.fonts.set(r,i),i}name(){return this._name}setName(e){return this._name=e,this._cssName=e.endsWith(" CYR")?e.slice(0,e.length-4):e,this.subs.forEach(r=>r.toolChanged(this)),1}size(){return this._size}setSize(e){return this._size=e,this.subs.forEach(r=>r.toolChanged(this)),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged(this)),1}underline(){return!!(this._style&2)}strikeOut(){return!!(this._style&4)}toCSSString(){return`${this._style&8?"bold":""} ${this._style&1?"italic":""} ${this._size}px ${this._cssName}`}};var Ne=class{constructor({handle:e,color:r,rop2:i,style:n,width:s}){this.handle=e,this.subs=new Set,this._color=r,this._cssColor=oe(r),this._width=s,this._style=n,this._rop=i}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e){let r=P.getFreeHandle(e.pens),i=new Ne({handle:r,color:this._color,rop2:this._rop,style:this._style,width:this._width});return e.pens.set(r,i),i}color(){return this._color}setColor(e){return this._color=e,this._cssColor=oe(e),this.subs.forEach(r=>r.toolChanged(this)),1}width(){return this._width}setWidth(e){return this._width=e,this.subs.forEach(r=>r.toolChanged(this)),1}style(){return this._style}setStyle(e){return this._style=e,this.subs.forEach(r=>r.toolChanged(this)),1}rop(){return this._rop}setRop(e){return this._rop=e,1}strokeStyle(){return this._style===v.PS_NULL?null:this._cssColor}};var Pe=class{constructor({handle:e,text:r}){this.handle=e,this.subs=new Set,this._text=r}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e){let r=P.getFreeHandle(e.strings),i=new Pe({handle:r,text:this._text});return e.strings.set(r,i),i}text(){return this._text}setText(e){return this._text=e,this.subs.forEach(r=>r.toolChanged(this)),1}};var Ae=class{constructor(e,{handle:r,textCollection:i}){this.handle=r,this.subs=new Set,this.scene=e,this.cnv=document.createElement("canvas");let n=this.cnv.getContext("2d",{alpha:!0});if(!n)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");this.ctx2=n,this.needUpdatePrepared=!0,this.needRedraw=!0,this.textCollection=i.map(s=>{let a=e.fonts.get(s.fontHandle)||null;a==null||a.subscribe(this);let u=e.strings.get(s.stringHandle)||null;return u==null||u.subscribe(this),{font:a,string:u,fgColor:s.fgColor,bgColor:s.bgColor}}),this.prepared=[],this._width=0,this._height=0}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}subCount(){return this.subs.size}copy(e){let r=P.getFreeHandle(e.texts),i=this.textCollection.map(s=>{var a,u,c,m;return{bgColor:s.bgColor,fgColor:s.fgColor,fontHandle:(u=(a=s.font)==null?void 0:a.copy(e).handle)!=null?u:0,stringHandle:(m=(c=s.string)==null?void 0:c.copy(e).handle)!=null?m:0}}),n=new Ae(e,{handle:r,textCollection:i});return e.texts.set(r,n),n}toolChanged(){this.needRedraw=!0,this.needUpdatePrepared=!0,this.subs.forEach(e=>e.toolChanged(this))}textCount(){return this.textCollection.length}fontHandle(e){if(e<0||e>=this.textCollection.length)return 0;let r=this.textCollection[e].font;return r?r.handle:0}stringHandle(e){if(e<0||e>=this.textCollection.length)return 0;let r=this.textCollection[e].string;return r?r.handle:0}fgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].fgColor}bgColor(e){return e<0||e>=this.textCollection.length?0:this.textCollection[e].bgColor}updatePrepared(){if(!this.needUpdatePrepared)return;let e=this.ctx2,r=[],i=0,n=0,s=0,a=0,u=[];for(let c of this.textCollection){let m=c.font,d=c.string;if(!m||!d)continue;let S=oe(c.fgColor),f=oe(c.bgColor),y=m.toCSSString(),g=m.size(),R=d.text().split(`
`);e.font=y;let O=!1;for(let M of R){O&&(r.push({row:u,height:a}),n=Math.max(n,s),i+=a,u=[],s=0,a=0);let F=e.measureText(M).width;u.push({elem:M,font:y,width:F,height:g,fgColor:S,bgColor:f,underline:m.underline(),strikeout:m.strikeOut()}),s+=F,O=!0,a=Math.max(a,g)}}r.push({row:u,height:a}),n=Math.max(n,s),i+=a,this._width=n*1.01,this._height=i*1.01,this.prepared=r,this.needUpdatePrepared=!1}redraw(){if(!this.needRedraw)return;this.updatePrepared(),this.cnv.width=Math.max(this._width,1),this.cnv.height=Math.max(this._height,1);let e=this.ctx2,r=0,i=0;for(let{row:n,height:s}of this.prepared){r=0,i+=s;for(let{elem:a,font:u,width:c,height:m,bgColor:d,fgColor:S,underline:f,strikeout:y}of n){e.font=u,e.textAlign="left",e.textBaseline="ideographic";let g=m,R=(s-g)/4;e.fillStyle=d,e.fillRect(r,i-g-R,c,g),e.fillStyle=S;let O=i-R+g/15;e.fillText(a,r,O);let M=g/20;y&&e.fillRect(r,i-g/2.5,c,M),f&&e.fillRect(r,i-M,c,M),r+=c}}this.needRedraw=!1}render(e,r,i,n,s,a){this.redraw(),!(this.cnv.width===0||this.cnv.height===0)&&(e.save(),e.translate(r,i),e.rotate(a),e.drawImage(this.cnv,0,0,n*1.02,s*1.02,0,0,n*1.02,s*1.02),e.restore())}width(){return this.updatePrepared(),this._width}height(){return this.updatePrepared(),this._height}replaceFont(e,r){var n,s;(n=e.font)==null||n.unsubscribe(this);let i=(s=this.scene.fonts.get(r))!=null?s:null;i==null||i.subscribe(this),e.font=i}replaceString(e,r){var n,s;(n=e.string)==null||n.unsubscribe(this);let i=(s=this.scene.strings.get(r))!=null?s:null;i==null||i.subscribe(this),e.string=i}setValues(e,r,i,n,s){var u,c;if(e<0||e>=this.textCollection.length)return 0;let a=this.textCollection[e];return r>0&&((u=a.font)==null?void 0:u.handle)!==r&&this.replaceFont(a,r),i>0&&((c=a.string)==null?void 0:c.handle)!==i&&this.replaceString(a,i),a.fgColor=n,a.bgColor=s,this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(m=>m.toolChanged(this)),1}setFgColor(e,r){if(e<0||e>=this.textCollection.length)return 0;let i=this.textCollection[e];return i.fgColor=r,this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(n=>n.toolChanged(this)),1}setBgColor(e,r){if(e<0||e>=this.textCollection.length)return 0;let i=this.textCollection[e];return i.bgColor=r,this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(n=>n.toolChanged(this)),1}setFont(e,r){var n;if(e<0||e>=this.textCollection.length)return 0;let i=this.textCollection[e];return r<1||((n=i.font)==null?void 0:n.handle)===r?0:(this.replaceFont(i,r),this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(s=>s.toolChanged(this)),1)}setString(e,r){var n;if(e<0||e>=this.textCollection.length)return 0;let i=this.textCollection[e];return r<1||((n=i.string)==null?void 0:n.handle)===r?0:(this.replaceString(i,r),this.needUpdatePrepared=!0,this.needRedraw=!0,this.subs.forEach(s=>s.toolChanged(this)),1)}};var W=class{constructor({wnd:e,vdr:r,sizeInfo:i}){this.lastViewW=0;this.lastViewH=0;this.capture=null;this.sizeSubs=new Set;this.controlNotifySubs=new Map;this.moveSubs=new Map;this.leftButtonUpSubs=new Map;this.leftButtonDownSubs=new Map;this.rightButtonUpSubs=new Map;this.rightButtonDownSubs=new Map;this.middleButtonUpSubs=new Map;this.middleButtonDownSubs=new Map;this.keyDownSubs=new Set;this.keyUpSubs=new Set;this.keyCharSubs=new Set;this.blocked=!1;var m,d,S,f,y,g,R,O,M,F,V;this.wnd=e,this.sizeInfo=i,this.dirty=!0,this.hyperHandler=null;let n=this.view=document.createElement("div");n.style.setProperty("overflow","hidden"),n.style.setProperty("position","relative"),i.resizable?(n.style.setProperty("width","100%"),n.style.setProperty("height","100%")):(n.style.setProperty("width",i.width+"px"),n.style.setProperty("height",i.height+"px"));let s=document.createElement("canvas");s.style.setProperty("touch-action","pinch-zoom"),s.addEventListener("pointerdown",this),s.addEventListener("pointerup",this),s.addEventListener("pointermove",this),s.addEventListener("selectstart",this),n.appendChild(s);let a=s.getContext("2d",{alpha:!1});if(!a)throw Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442 \u0440\u0435\u043D\u0434\u0435\u0440\u0438\u043D\u0433\u0430");if(this.ctx=a,!r){this._originX=0,this._originY=0,this._scale=1,this.layers=0,this.objects=new Map,this.primaryObjects=[],this.pens=new Map,this.brushes=new Map,this.dibs=new Map,this.doubleDibs=new Map,this.strings=new Map,this.fonts=new Map,this.texts=new Map,this.matrix=[1,0,0,0,1,0,0,0,1],this.invMatrix=[1,0,0,0,1,0,0,0,1],this.brush=null;return}this.pens=new Map((m=r.penTools)==null?void 0:m.map(x=>[x.handle,new Ne(x)])),this.dibs=new Map((d=r.dibTools)==null?void 0:d.map(x=>[x.handle,new le(x)])),this.brushes=new Map((S=r.brushTools)==null?void 0:S.map(x=>[x.handle,new xe(this,x)])),this.doubleDibs=new Map((f=r.doubleDibTools)==null?void 0:f.map(x=>[x.handle,new le(x)])),this.strings=new Map((y=r.stringTools)==null?void 0:y.map(x=>[x.handle,new Pe(x)])),this.fonts=new Map((g=r.fontTools)==null?void 0:g.map(x=>[x.handle,new Be(x)])),this.texts=new Map((R=r.textTools)==null?void 0:R.map(x=>[x.handle,new Ae(this,x)])),this.brush=r.brushHandle>0&&this.brushes.get(r.brushHandle)||null,(O=this.brush)==null||O.subscribe(this),this.matrix=((M=r.crdSystem)==null?void 0:M.matrix.slice())||[1,0,0,0,1,0,0,0,1],this.invMatrix=r.crdSystem?W.getInversedMatrix(this.matrix):[1,0,0,0,1,0,0,0,1],this._originX=r.origin.x,this._originY=r.origin.y,this.layers=r.layers,this._scale=1,this._scale!==1&&(n.style.setProperty("transform-origin","top left"),n.style.setProperty("transform",`scale(${this._scale})`));let u=new Set,c=x=>{switch(x.type){case"group":let q=new fe(this,x);return u.add({g:q,h:x.childHandles}),[x.handle,q];case"line":return[x.handle,new ue(this,x)];case"text":return[x.handle,new Oe(this,x)];case"control":return[x.handle,new De(this,x)];case"bitmap":case"doubleBitmap":return[x.handle,new Re(this,x)];case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}};this.objects=new Map((F=r.elements)==null?void 0:F.map(c)),u.forEach(x=>x.g.addChildren(x.h)),this.primaryObjects=[],(V=r.elementOrder)==null||V.forEach(x=>{let q=this.objects.get(x);!q||q.type===3||this.primaryObjects.push(q)})}static handleKeyboard(e){var i;let r=Ii.get(e.code);typeof r!="undefined"&&(W.keyState[r]=e.type==="keydown"?1:0),(i=W.kbdTarget)==null||i.dispatchKeyboardEvent(e,r!=null?r:0)}static handlePointer(e){var r;W.keyState[1]=e.buttons&1?1:0,W.keyState[2]=e.buttons&2?1:0,W.keyState[4]=e.buttons&4?1:0,W._mouseX=e.clientX,W._mouseY=e.clientY,(r=W.captureTarget)==null||r.handleEvent(e)}static mouseCoords(e){let r=e.ctx.canvas.getBoundingClientRect(),i=(W._mouseX-r.left)/e._scale,n=(W._mouseY-r.top)/e._scale;return[i,n]}static getInversedMatrix(e){let r=e[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]);return[(e[4]*e[8]-e[7]*e[5])/r,(e[2]*e[7]-e[1]*e[8])/r,(e[1]*e[5]-e[2]*e[4])/r,(e[5]*e[6]-e[3]*e[8])/r,(e[0]*e[8]-e[2]*e[6])/r,(e[3]*e[2]-e[0]*e[5])/r,(e[3]*e[7]-e[6]*e[4])/r,(e[6]*e[1]-e[0]*e[7])/r,(e[0]*e[4]-e[3]*e[1])/r]}toDataURL(e,r,i,n){let s=Math.max(e,0),a=Math.max(r,0),u=Math.min(i,this.ctx.canvas.width),c=Math.min(n,this.ctx.canvas.height),m=this.ctx.getImageData(s,a,u,c),d=document.createElement("canvas");d.width=u,d.height=c;let S=d.getContext("2d",{alpha:!1});return S?(S.putImageData(m,0,0),d.toDataURL()):null}next(e){let r=!1;for(let[i]of this.objects){if(r)return i;i===e&&(r=!0)}return 0}setHyper(e,r){let i=this.objects.get(e);return i?(i.hyperbase=r,1):0}tryHyper(e,r,i){var d;if(!this.hyperHandler)return;let n=i||this.getObjectFromPoint2d(e,r,!1),s=(d=this.objects.get(n))==null?void 0:d.hyperbase;if(!s)return;let a=this.matrix,u=e*a[2]+r*a[5]+a[8],c=(e*a[0]+r*a[3]+a[6])/u-this._originX,m=(e*a[1]+r*a[4]+a[7])/u-this._originY;this.hyperHandler.click(s,{x:c,y:m})}setBrush(e){var r,i;return(r=this.brush)==null||r.unsubscribe(this),this.brush=this.brushes.get(e)||null,(i=this.brush)==null||i.subscribe(this),this.dirty=!0,1}brushHandle(){var e;return((e=this.brush)==null?void 0:e.handle)||0}clear(){throw new Error("Method not implemented.")}toolChanged(){this.dirty=!0}render(){var n;let e=this.view.clientWidth,r=this.view.clientHeight,i=this.ctx;if(e!==this.lastViewW||r!==this.lastViewH){this.lastViewW=e,this.lastViewH=r;let s=i.canvas;s.style.setProperty("width",e+"px"),s.style.setProperty("height",r+"px"),s.width=e,s.height=r,this.dirty=!0,this.sizeInfo.resizable&&this.sizeSubs.forEach(a=>a.receive(v.WM_SIZE,e,r))}!this.dirty||e<1||r<1||(this.dirty=!1,i.fillStyle=((n=this.brush)==null?void 0:n.fillStyle(i))||"white",i.fillRect(0,0,e,r),this.primaryObjects.forEach(s=>s.render(i,this._originX,this._originY,this.layers)))}width(){let e=this.sizeInfo;return e.resizable?this.lastViewW:e.width}height(){let e=this.sizeInfo;return e.resizable?this.lastViewH:e.height}setSize(e,r){this.sizeInfo.resizable||(this.sizeInfo.width=e,this.sizeInfo.height=r,this.view.style.setProperty("width",e+"px"),this.view.style.setProperty("height",r+"px"),this.sizeSubs.forEach(i=>i.receive(v.WM_SIZE,e,r)))}originX(){return this._originX}originY(){return this._originY}setOrigin(e,r){return this._originX=e,this._originY=r,this.dirty=!0,1}scale(){return this._scale}setScale(e){return e===0?0:(this._scale=e,e!==1?(this.view.style.setProperty("transform-origin","top left"),this.view.style.setProperty("transform",`scale(${e})`)):(this.view.style.removeProperty("transform-origin"),this.view.style.removeProperty("transform")),1)}createLine(e,r,i){let n=P.getFreeHandle(this.objects),s=this.matrix,a=new Array(e.length);for(let c=0;c<e.length;c+=2){let m=e[c],d=e[c+1],S=m*s[2]+d*s[5]+s[8];a[c]=(m*s[0]+d*s[3]+s[6])/S,a[c+1]=(m*s[1]+d*s[4]+s[7])/S}let u=new ue(this,{handle:n,penHandle:r,brushHandle:i,coords:a});return this.objects.set(n,u),this.primaryObjects.push(u),n}createBitmap(e,r,i,n){let s=this.matrix,a=e*s[2]+r*s[5]+s[8],u=(e*s[0]+r*s[3]+s[6])/a,c=(e*s[1]+r*s[4]+s[7])/a,m=P.getFreeHandle(this.objects),d=new Re(this,{handle:m,originX:u,originY:c,type:n?"doubleBitmap":"bitmap",dibHandle:i});return this.objects.set(m,d),this.primaryObjects.push(d),m}createText(e,r,i,n){let s=this.matrix,a=e*s[2]+r*s[5]+s[8],u=(e*s[0]+r*s[3]+s[6])/a,c=(e*s[1]+r*s[4]+s[7])/a,m=P.getFreeHandle(this.objects),d=new Oe(this,{handle:m,originX:u,originY:c,angle:i,textToolHandle:n});return this.objects.set(m,d),this.primaryObjects.push(d),m}createControl(e,r,i,n,s,a,u){let c=s.toUpperCase();if(c!=="EDIT"&&c!=="BUTTON"&&c!=="COMBOBOX")return 0;let m=this.matrix,d=e*m[2]+r*m[5]+m[8],S=(e*m[0]+r*m[3]+m[6])/d,f=(e*m[1]+r*m[4]+m[7])/d,y=P.getFreeHandle(this.objects),g=new De(this,{handle:y,originX:S,originY:f,width:i,height:n,inputType:c,text:a});return this.objects.set(y,g),this.primaryObjects.push(g),y}createGroup(e){let r=P.getFreeHandle(this.objects),i=new fe(this,{handle:r}).addChildren(e);return this.objects.set(r,i),r}copy(e){let r=this.objects.get(e);return r?(W.copyed=r,1):0}paste(e,r,i){let n=W.copyed;if(!n)return 0;let s=n.copy(this,i);return s.setOrigin(e,r),this.dirty=!0,s.handle}insertVectorDrawing(e,r,i,n){var F,V,x,q,Ye,rt,it,st;if(!n.elements)return 0;let s=this.pens,a=this.dibs,u=this.brushes,c=this.doubleDibs,m=this.strings,d=this.fonts,S=this.texts,f=this.objects;this.pens=new Map((F=n.penTools)==null?void 0:F.map(D=>[D.handle,new Ne(D)])),this.dibs=new Map((V=n.dibTools)==null?void 0:V.map(D=>[D.handle,new le(D)])),this.brushes=new Map((x=n.brushTools)==null?void 0:x.map(D=>[D.handle,new xe(this,D)])),this.doubleDibs=new Map((q=n.doubleDibTools)==null?void 0:q.map(D=>[D.handle,new le(D)])),this.strings=new Map((Ye=n.stringTools)==null?void 0:Ye.map(D=>[D.handle,new Pe(D)])),this.fonts=new Map((rt=n.fontTools)==null?void 0:rt.map(D=>[D.handle,new Be(D)])),this.texts=new Map((it=n.textTools)==null?void 0:it.map(D=>[D.handle,new Ae(this,D)]));let y=new Set,g=D=>{switch(D.type){case"group":let U=new fe(this,D);return y.add({g:U,h:D.childHandles}),[D.handle,U];case"line":return[D.handle,new ue(this,D)];case"text":return[D.handle,new Oe(this,D)];case"control":return[D.handle,new De(this,D)];case"bitmap":case"doubleBitmap":return[D.handle,new Re(this,D)];case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}},R=n.elements.map(g);this.objects=new Map(R),y.forEach(D=>D.g.addChildren(D.h)),(st=n.elementOrder)==null||st.forEach(D=>{let U=this.objects.get(D);!U||U.type===3||this.primaryObjects.push(U)});let O=R.filter(D=>D[1].parentHandle()===0).map(D=>D[1].handle);if(O.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");let M;if(O.length>1){let D=P.getFreeHandle(this.objects),U=new fe(this,{handle:D}).addChildren(O);this.objects.set(D,U),M=U}else M=this.objects.values().next().value;return M.setOrigin(e,r),this.pens.forEach(D=>{let U=P.getFreeHandle(s);D.handle=U,s.set(U,D)}),this.dibs.forEach(D=>{let U=P.getFreeHandle(a);D.handle=U,a.set(U,D)}),this.brushes.forEach(D=>{let U=P.getFreeHandle(u);D.handle=U,u.set(U,D)}),this.doubleDibs.forEach(D=>{let U=P.getFreeHandle(c);D.handle=U,c.set(U,D)}),this.strings.forEach(D=>{let U=P.getFreeHandle(m);D.handle=U,m.set(U,D)}),this.fonts.forEach(D=>{let U=P.getFreeHandle(d);D.handle=U,d.set(U,D)}),this.texts.forEach(D=>{let U=P.getFreeHandle(S);D.handle=U,S.set(U,D)}),this.objects.forEach(D=>{let U=P.getFreeHandle(f);D.handle=U,f.set(U,D)}),this.pens=s,this.dibs=a,this.brushes=u,this.doubleDibs=c,this.strings=m,this.fonts=d,this.texts=S,this.objects=f,M.handle}frame(e,r){return new Kt(e,this,r)}deleteObject(e){let r=this.objects.get(e);return r?(r.delete(),this.objects=new Map([...this.objects].filter(i=>!i[1].markDeleted)),this.primaryObjects=this.primaryObjects.filter(i=>!i.markDeleted),1):0}deleteGroup2d(e){let r=this.objects.get(e);return!r||r.type!==3?0:(r.ungroup(),this.objects.delete(e),1)}topObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[0].handle:0}bottomObjectHandle(){return this.primaryObjects.length>0?this.primaryObjects[this.primaryObjects.length-1].handle:0}objectFromZOrder(e){let r=e-1;return r<0||r>=this.primaryObjects.length?0:this.primaryObjects[r].handle}objectZOrder(e){for(let r=0;r<this.primaryObjects.length;++r)if(this.primaryObjects[r].handle===e)return r+1;return 0}lowerObjectHandle(e){let r=this.primaryObjects.findIndex(i=>i.handle===e);return r<1?0:this.primaryObjects[r-1].handle}upperObjectHandle(e){let r=this.primaryObjects.findIndex(i=>i.handle===e);return r<0||r>=this.primaryObjects.length-1?0:this.primaryObjects[r+1].handle}objectToTop(e){let r=this.primaryObjects.find(i=>i.handle===e);return r?(this.primaryObjects=[...this.primaryObjects.filter(i=>i!==r),r],this.dirty=!0,1):0}objectToBottom(e){let r=this.primaryObjects.find(i=>i.handle===e);return r?(this.primaryObjects=[r,...this.primaryObjects.filter(i=>i!==r)],this.dirty=!0,1):0}swapObjects(e,r){let i=this.primaryObjects.findIndex(a=>a.handle===e);if(i<0)return 0;let n=this.primaryObjects.findIndex(a=>a.handle===r);if(n<0)return 0;let s=this.primaryObjects[i];return this.primaryObjects[i]=this.primaryObjects[n],this.primaryObjects[n]=s,this.dirty=!0,1}setObjectZOrder(e,r){let i=r-1;if(i<0)return 0;let n=this.primaryObjects.find(a=>a.handle===e);if(!n)return 0;let s=[];for(let a=0;a<this.primaryObjects.length;++a){a===i&&s.push(n);let u=this.primaryObjects[a];u!==n&&s.push(u)}return i>=this.primaryObjects.length&&s.push(n),this.primaryObjects=s,this.dirty=!0,1}objectName(e){var r;return((r=this.objects.get(e))==null?void 0:r.name)||""}setObjectName(e,r){let i=this.objects.get(e);return i?(i.name=r,1):0}getObject2dByName(e,r){if(r==="")return 0;if(e){let i=this.objects.get(e);return i?i.getChildByName(r):0}for(let i of this.objects.values())if(i.name===r)return i.handle;return 0}getObjectInRealCoords(e,r,i=!1){for(let n=this.primaryObjects.length-1;n>=0;--n){let s=this.primaryObjects[n],a=s.tryClick(e,r,this.layers);if(a)return i&&(W._lastPrimary=s.handle),a}return i&&(W._lastPrimary=0),null}getObjectFromPoint2d(e,r,i=!1){var c,m;let n=this.matrix,s=e*n[2]+r*n[5]+n[8],a=(e*n[0]+r*n[3]+n[6])/s,u=(e*n[1]+r*n[4]+n[7])/s;return(m=(c=this.getObjectInRealCoords(a,u,i))==null?void 0:c.handle)!=null?m:0}static lastPrimary(){return W._lastPrimary}isIntersect(e,r){let i=this.objects.get(e);if(!i)return 0;let n=this.objects.get(r);return n&&i.maxX()>=n.minX()&&n.maxX()>=i.minX()&&i.maxY()>=n.minY()&&n.maxY()>=i.minY()?1:0}createPenTool(e,r,i,n){let s=P.getFreeHandle(this.pens);return this.pens.set(s,new Ne({handle:s,color:i,width:r,rop2:n,style:e})),s}createBrushTool(e,r,i,n,s){let a=P.getFreeHandle(this.brushes);return this.brushes.set(a,new xe(this,{handle:a,color:i,hatch:r,dibHandle:n,style:e,rop2:s})),a}createDIBTool(e){let r=P.getFreeHandle(this.dibs);return this.dibs.set(r,new le({handle:r,type:"image",img:e})),r}createDoubleDIBTool(e){let r=P.getFreeHandle(this.doubleDibs);return this.doubleDibs.set(r,new le({handle:r,type:"image",img:e})),r}createStringTool(e){let r=P.getFreeHandle(this.strings);return this.strings.set(r,new Pe({handle:r,text:e})),r}createFontTool(e,r,i){let n=P.getFreeHandle(this.fonts),s=i&1,a=i&2,u=i&4,c=i&8;return this.fonts.set(n,new Be({handle:n,fontName:e,height:-r,italic:s,underline:a,strikeOut:u,weight:c})),n}createTextTool(e,r,i,n){let s=P.getFreeHandle(this.texts);return this.texts.set(s,new Ae(this,{handle:s,textCollection:[{fgColor:i,bgColor:n,fontHandle:e,stringHandle:r}]})),s}setCapture(e){this.capture=e,W.captureTarget=this}releaseCapture(){this.capture=null,W.captureTarget=null}on(e,r,i){switch(r){case v.WM_SIZE:this.sizeSubs.add(e);break;case v.WM_CONTROLNOTIFY:this.controlNotifySubs.set(e,i);break;case v.WM_MOUSEMOVE:this.moveSubs.set(e,i);break;case v.WM_LBUTTONDOWN:this.leftButtonDownSubs.set(e,i);break;case v.WM_LBUTTONUP:this.leftButtonUpSubs.set(e,i);break;case v.WM_RBUTTONDOWN:this.rightButtonDownSubs.set(e,i);break;case v.WM_RBUTTONUP:this.rightButtonUpSubs.set(e,i);break;case v.WM_MBUTTONDOWN:this.middleButtonDownSubs.set(e,i);break;case v.WM_MBUTTONUP:this.middleButtonUpSubs.set(e,i);break;case v.WM_ALLMOUSEMESSAGE:this.moveSubs.set(e,i),this.leftButtonDownSubs.set(e,i),this.leftButtonUpSubs.set(e,i),this.rightButtonDownSubs.set(e,i),this.rightButtonUpSubs.set(e,i),this.middleButtonDownSubs.set(e,i),this.middleButtonUpSubs.set(e,i);break;case v.WM_KEYDOWN:this.keyDownSubs.add(e);break;case v.WM_KEYUP:this.keyUpSubs.add(e);break;case 258:this.keyCharSubs.add(e);break;case v.WM_ALLKEYMESSAGE:this.keyDownSubs.add(e),this.keyUpSubs.add(e),this.keyCharSubs.add(e);break;default:console.warn(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${v[r]} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430 (\u0438\u043C\u0438\u0434\u0436: ${e.proto.name})`);break}}off(e,r){switch(r){case v.WM_SIZE:this.sizeSubs.delete(e);break;case v.WM_CONTROLNOTIFY:this.controlNotifySubs.delete(e);break;case v.WM_MOUSEMOVE:this.moveSubs.delete(e);break;case v.WM_LBUTTONDOWN:this.leftButtonDownSubs.delete(e);break;case v.WM_LBUTTONUP:this.leftButtonUpSubs.delete(e);break;case v.WM_RBUTTONDOWN:this.rightButtonDownSubs.delete(e);break;case v.WM_RBUTTONUP:this.rightButtonUpSubs.delete(e);break;case v.WM_MBUTTONDOWN:this.middleButtonDownSubs.delete(e);break;case v.WM_MBUTTONUP:this.middleButtonUpSubs.delete(e);break;case v.WM_ALLMOUSEMESSAGE:this.moveSubs.delete(e),this.leftButtonDownSubs.delete(e),this.leftButtonUpSubs.delete(e),this.rightButtonDownSubs.delete(e),this.rightButtonUpSubs.delete(e),this.middleButtonDownSubs.delete(e),this.middleButtonUpSubs.delete(e);break;case v.WM_KEYDOWN:this.keyDownSubs.delete(e);break;case v.WM_KEYUP:this.keyUpSubs.delete(e);break;case 258:this.keyCharSubs.delete(e);break;case v.WM_ALLKEYMESSAGE:this.keyDownSubs.delete(e),this.keyUpSubs.delete(e),this.keyCharSubs.delete(e);break}}handleEvent(e){var g,R;if(e.type==="selectstart"){e.preventDefault();return}if(W.captureTarget===this&&e.currentTarget!==window)return;let r=this.ctx.canvas.getBoundingClientRect(),i=(e.clientX-r.left)/this._scale,n=(e.clientY-r.top)/this._scale,s=i+this._originX,a=n+this._originY,u=e.buttons&1?1:0,c=e.buttons&2?2:0,m=e.buttons&4?16:0,d=u|c|m;W.keyState[1]=u,W.keyState[2]=c,W.keyState[4]=m;let S=this.getObjectInRealCoords(s,a),f=(g=S==null?void 0:S.handle)!=null?g:0,y=S==null?void 0:S.hyperbase;switch(this.ctx.canvas.style.cursor=y?"pointer":"default",e.type){case"pointerdown":{switch(W.kbdTarget=this,this.blocked=!0,e.button){case 0:(R=this.hyperHandler)==null||R.click(y!=null?y:null,{x:i,y:n}),this.dispatchMouseEvent(this.leftButtonDownSubs,f,v.WM_LBUTTONDOWN,s,a,d);return;case 1:this.dispatchMouseEvent(this.middleButtonDownSubs,f,v.WM_MBUTTONDOWN,s,a,d);return;case 2:this.dispatchMouseEvent(this.rightButtonDownSubs,f,v.WM_RBUTTONDOWN,s,a,d);return}return}case"pointerup":{switch(e.button){case 0:this.dispatchMouseEvent(this.leftButtonUpSubs,f,v.WM_LBUTTONUP,s,a,d);return;case 1:this.dispatchMouseEvent(this.middleButtonUpSubs,f,v.WM_MBUTTONUP,s,a,d);return;case 2:this.dispatchMouseEvent(this.rightButtonUpSubs,f,v.WM_RBUTTONUP,s,a,d);return}return}case"pointermove":if(this.blocked){this.blocked=!1;return}this.dispatchMouseEvent(this.moveSubs,f,v.WM_MOUSEMOVE,s,a,d);return}}dispatchMouseEvent(e,r,i,n,s,a){let u=this.invMatrix,c=n*u[2]+s*u[5]+u[8],m=(n*u[0]+s*u[3]+u[6])/c,d=(n*u[1]+s*u[4]+u[7])/c;for(let[S,f]of e)(f===0||f===r||S===this.capture)&&S.receive(i,m,d,a)}dispatchKeyboardEvent(e,r){let i=1,n=0;if(e.type==="keydown"){if(this.keyDownSubs.forEach(u=>u.receive(v.WM_KEYDOWN,r,i,n)),r>36&&r<41||r===46)return;let s=Ie.indexOf(e.key),a=s<0?r:s;this.keyCharSubs.forEach(u=>u.receive(258,a,i,n))}else this.keyUpSubs.forEach(s=>s.receive(v.WM_KEYUP,r,i,n))}dispatchControlNotifyEvent(e,r){let i=0;switch(r.type){case"input":i=768;break;case"focus":W.kbdTarget=null;return;default:return}for(let[n,s]of this.controlNotifySubs)(s===0||s===e)&&n.receive(v.WM_CONTROLNOTIFY,e,0,i)}beforeRemove(){W.kbdTarget===this&&(W.kbdTarget=null),W.captureTarget===this&&(W.captureTarget=null)}},X=W;X.kbdTarget=null,X.captureTarget=null,X._mouseX=0,X._mouseY=0,X.keyState=new Uint8Array(256),X.copyed=null,X._lastPrimary=0;window.addEventListener("pointerdown",X.handlePointer);window.addEventListener("pointermove",X.handlePointer);window.addEventListener("pointerup",X.handlePointer);window.addEventListener("keydown",X.handleKeyboard);window.addEventListener("keyup",X.handleKeyboard);var Ri=["brushTools","penTools","dibTools","doubleDibTools","fontTools","stringTools","textTools"];function We(t){if(!!t)return t.map(e=>$({},e))}function Di(t){var r,i;let e=$({},t);return e.brushTools=We(t.brushTools),e.penTools=We(t.penTools),e.dibTools=We(t.dibTools),e.doubleDibTools=We(t.doubleDibTools),e.fontTools=We(t.fontTools),e.stringTools=We(t.stringTools),e.textTools=(r=t.textTools)==null?void 0:r.map(n=>$($({},n),{textCollection:n.textCollection.map(s=>$({},s))})),e.elements=(i=t.elements)==null?void 0:i.map(n=>n.type==="group"?$($({},n),{childHandles:n.childHandles.slice()}):$({},n)),e.elementOrder=t.elementOrder&&t.elementOrder.slice(),e}function Oi(t,e){let r=t.find(i=>i.handle===e);if(!r||r.type!=="group")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${e}`);return r}function xi(t,e){let r=e.childHandles[0],i=t.find(n=>n.handle===r);if(!i||i.type!=="doubleBitmap")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0438\u043A\u043E\u043D\u043A\u0438 \u0438\u043C\u0438\u0434\u0436\u0430 #${e.handle}`);return i}function ya(t,e){let r=new Map,i=1;for(let n of e){for(;t.some(s=>s.handle===i);)++i;r.set(n.handle,i),n.handle=i,t.push(n)}return r}function Ea(t,e){let r={};for(let i of Ri){let n=e[i];if(!n)continue;let s=t[i];if(!s){t[i]=n;continue}r[i]=ya(s,n)}return r}function ge(t,e,r){if(!!t)for(let i of t){let n=i[e];i[e]=r.get(n)||n}}function va(t,e,r){switch(e){case"fontTools":{let{textTools:i}=t;i&&i.forEach(n=>ge(n.textCollection,"fontHandle",r));break}case"stringTools":{let{textTools:i}=t;i&&i.forEach(n=>ge(n.textCollection,"stringHandle",r));break}case"dibTools":{ge(t.brushTools,"dibHandle",r);break}}}function Ia(t,e,r){switch(e){case"brushTools":let i=t.filter(c=>c.type==="line");ge(i,"brushHandle",r);break;case"penTools":let n=t.filter(c=>c.type==="line");ge(n,"penHandle",r);break;case"dibTools":let s=t.filter(c=>c.type==="bitmap");ge(s,"dibHandle",r);break;case"doubleDibTools":let a=t.filter(c=>c.type==="doubleBitmap");ge(a,"dibHandle",r);break;case"textTools":let u=t.filter(c=>c.type==="text");ge(u,"textToolHandle",r);break}}function Ra(t,e){for(let r of Ri){let i=e[r];!i||(va(t,r,i),t.elements&&Ia(t.elements,r,i))}}function Da(t){let e,r;for(let i of t)i.type!=="group"&&((e===void 0||i.originX<e)&&(e=i.originX),(r===void 0||i.originY<r)&&(r=i.originY));return{x:e||0,y:r||0}}function Oa(t,e){return t.some(r=>r.type==="group"&&r.childHandles.includes(e.handle))}function xa(t,e,r){let i=new Map;if(e.length===0)return{map:i,rootHandle:0};let n=1,s=[];for(let u of e){for(;t.some(c=>c.handle===n);)++n;if(Oa(e,u)||s.push(n),i.set(u.handle,n),u.handle=n,t.push(u),u.type!=="group"&&(u.originX+=r.x,u.originY+=r.y,u.type==="line")){u.coords=u.coords.slice();for(let c=0;c<u.coords.length;c+=2)u.coords[c+0]+=r.x,u.coords[c+1]+=r.y}}if(s.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u044A\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F \u0438\u043C\u0438\u0434\u0436\u0435\u0439");if(s.length===1)return{map:i,rootHandle:s[0]};for(;t.some(u=>u.handle===n);)++n;let a={type:"group",handle:n,childHandles:s,options:0};return t.push(a),{map:i,rootHandle:a.handle}}function Ba(t,e){for(let r of t)r.type==="group"&&(r.childHandles=r.childHandles.map(i=>e.get(i)||i))}function Na(t,e){return t.map(r=>e.get(r)||r)}function Pa(t){return t.elements!==void 0&&t.elements.length>0}var qe=class{static calcRect(e){if(e.length===0)return{x:0,y:0,w:0,h:0};let r=Infinity,i=-Infinity,n=Infinity,s=-Infinity;return e.forEach(a=>{a.type!=="group"&&(a.originX<r&&(r=a.originX),a.originX+a.width>i&&(i=a.originX+a.width),a.originY<n&&(n=a.originY),a.originY+a.height>s&&(s=a.originY+a.height))}),{x:r,y:n,w:i-r,h:s-n}}constructor(e){let r=Di(e);if(!Pa(r))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=r}result(){return this.scheme}insertChildImage(e,r){let{scheme:i}=this,n=Di(r),s=Ea(i,n);if(Ra(n,s),!n.elements)return;let a=Oi(i.elements,e),u=xi(i.elements,a);u.options|=1;let c=Da(n.elements),m={x:u.originX-c.x,y:u.originY-c.y},{map:d,rootHandle:S}=xa(i.elements,n.elements,m);if(Ba(n.elements,d),a.childHandles.push(S),!n.elementOrder)return;let f=Na(n.elementOrder,d),y=i.elementOrder;i.elementOrder=y?y.concat(f):f}replaceIcon(e,r,i){let{scheme:n}=this,s=Oi(n.elements,e),a=xi(n.elements,s),u={type:"DBMReference",handle:0,filename:r},c=1;if(n.doubleDibTools){for(;n.doubleDibTools.some(d=>d.handle===c);)++c;n.doubleDibTools.push(u)}else n.doubleDibTools=[u];a.dibHandle=u.handle=c;let m=0;switch(r.toUpperCase()){case"SYSTEM.DBM":m=2;break;default:return}a.cropX=i%m*32,a.cropY=Math.floor(i/m)*32}};var ce=class{constructor(e,r){this.parent=null;this.childWindows=new Set;this._originX=0;this._originY=0;this.spaceDoneSubs=new Set;this.moveSubs=new Set;var y,g,R,O,M,F;this.sceneHandle=e.handle,this.name=this._title=e.wname,this.source=(g=(y=e.vdr)==null?void 0:y.source)!=null?g:null,this.projectID=null;let i=e.attribs,n=300,s=200,a=!1,u=!1,c=!1,m=!1,d=!1,S=!1;if(i.useVdrSettings&&((R=e.vdr)==null?void 0:R.settings)){let V=e.vdr.settings,x=V.style;V.x&&(n=V.x),V.y&&(s=V.y),x&te.SWF_POPUP&&(a=!0),x&te.SWF_AUTOORG&&(u=!0),x&te.SWF_SPACESIZE&&(c=!0),x&te.SWF_NORESIZE&&(m=!0),x&te.SWF_VSCROLL&&(d=!0),x&te.SWF_HSCROLL&&(S=!0)}if(i.popup&&(a=!0),i.autoOrg&&(u=!0),i.bySpaceSize&&(c=!0),(a||i.noResize)&&(m=!0),i.vscroll&&(d=!0),i.hscroll&&(S=!0),((O=e.vdr)==null?void 0:O.elements)&&(u||c)){let V=qe.calcRect(e.vdr.elements);u&&(e.vdr.origin.x=V.x,e.vdr.origin.y=V.y),c&&(n=V.w,s=V.h)}((M=e.rect)==null?void 0:M.w)&&(n=e.rect.w),((F=e.rect)==null?void 0:F.h)&&(s=e.rect.h);let f=m?{resizable:!1,width:n,height:s}:{resizable:!0};this.scene=new X({wnd:this,vdr:e.vdr,sizeInfo:f}),d&&this.scene.view.style.setProperty("overflow-y","scroll"),S&&this.scene.view.style.setProperty("overflow-x","scroll"),this.host=r(this.scene.view,{popup:a,title:e.wname,noCaption:i==null?void 0:i.noCaption,noShadow:i==null?void 0:i.noShadow,position:e.rect}),this.closeCallback=()=>{var V;(V=this.parent)==null||V.childWindows.delete(this),ce.wins.delete(this),this.childWindows.forEach(x=>x.close()),this.scene.beforeRemove(),e.onClosed&&e.onClosed(),this.spaceDoneSubs.forEach(x=>x.receive(v.WM_SPACEDONE))},this.host.on&&this.host.on("closed",this.closeCallback),ce.wins.add(this),ce.updater.run(ce.redrawAll),this.redraw()}static redrawAll(){return ce.wins.forEach(e=>e.redraw()),ce.wins.size>0}subwindow(e){let r=$($({},e.attribs),{noResize:!0}),i=$($({},e),{attribs:r}),n=new ce(i,s=>this.scene.frame(s,e.rect));return n.parent=this,this.childWindows.add(n),n}close(){return this.host.off&&this.host.off("closed",this.closeCallback),this.host.close&&this.host.close(),this.closeCallback(),1}redraw(){this.scene.render()}width(){return this.scene.width()}clientWidth(){return this.scene.width()}height(){return this.scene.height()}clientHeight(){return this.scene.height()}setClientSize(e,r){return this.scene.setSize(e,r),this.host.resizeTo&&this.host.resizeTo(e,r),1}setSize(e,r){return this.scene.setSize(e,r),this.host.resizeTo&&this.host.resizeTo(e,r),1}originX(){return this._originX}originY(){return this._originY}setOrigin(e,r){return this._originX=e,this._originY=r,this.host.moveTo&&this.host.moveTo(e,r),1}toTop(){return this.host.toTop&&this.host.toTop(),1}setAttrib(e){switch(e){case v.SW_HIDE:this.host.setVisibility&&this.host.setVisibility(!1);break;case v.SW_SHOW:case v.SW_NORMAL:this.host.setVisibility&&this.host.setVisibility(!0);break}return 1}title(){return this._title}setTitle(e){return this._title=e,this.host.setTitle&&this.host.setTitle(e),1}setTransparent(e){return 1}setTransparentColor(e){return 1}on(e,r,i){switch(r){case v.WM_MOVE:this.moveSubs.add(e);break;case v.WM_SPACEDONE:this.spaceDoneSubs.add(e);break;default:this.scene.on(e,r,i)}}off(e,r){switch(r){case v.WM_MOVE:this.moveSubs.delete(e);break;case v.WM_SPACEDONE:this.spaceDoneSubs.delete(e);break;default:this.scene.off(e,r);break}}},et=ce;et.updater=new $e,et.wins=new Set;function Rt(t){let e=t.toUpperCase();return{useVdrSettings:e.includes("WS_BYSPACE"),child:e.includes("WS_CHILD"),popup:e.includes("WS_POPUP"),noResize:e.includes("WS_NORESIZE"),autoOrg:e.includes("WS_AUTOORG"),bySpaceSize:e.includes("WS_SPACESIZE"),noCaption:e.includes("WS_NOCAPTION"),noShadow:e.includes("WS_NOSHADOW"),vscroll:e.includes("WS_VSCROLL"),hscroll:e.includes("WS_HSCROLL")}}function Bi(t){return t.substring(0,t.lastIndexOf("\\")+1)}function Dt(t,e){switch(t){case I.String:return e;case I.Float:return parseFloat(e)||0;case I.Handle:return(e.startsWith("#")?parseInt(e.substring(1,e.length)):parseInt(e))||0;case I.ColorRef:return Fr(e)}}function Ni(t,e){let r=i=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${t.proto.name}: ${i}`);for(let{handle1:i,handle2:n,flags:s,connectedVars:a}of e){let u=s&1,c=i===0?t:t.child(i);if(!c){r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let m=n===0?t:t.child(n);if(!m){r(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let d=c.proto.vars(),S=m.proto.vars(),f=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${c.proto.name} #${i}`,y=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${m.proto.name} #${n}`;for(let{name1:g,name2:R}of a){let O=d.id(g),M=S.id(R);if(typeof O!="number"){r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${f}`);continue}if(typeof M!="number"){r(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${R} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${y}`);continue}if(!c.connectVar(O,m,M,u)){let F=I[d.data(O).type],V=I[S.data(O).type];r(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${g} (${F}) \u0432 ${f} \u0438 ${R} (${V}) \u0432 ${y}`)}}}}var ne=class{constructor(e,r,i,n,s){this.children=[];this.isDisabled=ne.alwaysEnabled;this.disOrEnVarId=-1;this.varGraphNodes=[];this.classNodeCache=new Map;r.model(),this.proto=r,this.prj=e;{let a=r.vars();this.varGraphNodes=a.toArray().map(m=>new Ue(m.type)),this.TLB=new Uint16Array(a.count());let u=a._enableVarId,c=a._disableVarId;u>-1&&(c<0||u<c)&&(this.isDisabled=ne.disabledByEnable,this.disOrEnVarId=u),c>-1&&(u<0||c<u)&&(this.isDisabled=ne.disabledByDisable,this.disOrEnVarId=c)}this.children=i,Ni(this,n),this.resolveMap=new Map([["",this]]),i.forEach(a=>{this.resolveMap.set("#"+a.handle,a),a.schemeName&&this.resolveMap.set(a.schemeName.toUpperCase(),a)}),this.parent=null,i.forEach(a=>a.setParent(this)),s?(this.handle=s.handle,this.schemeName=s.schemeName,this.position=s.position):(this.handle=0,this.schemeName="",this.position={x:0,y:0})}static alwaysEnabled(){return!1}static disabledByEnable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]<=0}static disabledByDisable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]>0}setParent(e){if(e===this||this.parent!==null)throw Error("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0440\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0439 \u0438\u043C\u0438\u0434\u0436");this.parent=e,this.resolveMap.set("..",e)}resolve(e){if(e==="")return this;let r=e.toUpperCase().split("\\"),i=e[0]==="\\"?this.prj.root:this;for(let n=0;n<r.length;++n){let s=i.resolveMap.get(r[n]);if(typeof s=="undefined")return;i=s}return i}findClasses(e){let{root:r}=this.prj,i=r.classNodeCache.get(e);if(typeof i!="undefined")return i;let n=new Array;return function s(a){a.children.forEach(s),a.proto.name.toUpperCase()===e&&n.push(a)}(r),r.classNodeCache.set(e,n),n}setVarValue(e,r,i){if(e<0)return!1;let n=this.TLB[e];return this.prj.setOldValue(n,r,i),this.prj.setNewValue(n,r,i),!0}getVarValue(e,r){return this.prj.getNewValue(this.TLB[e],r)}*computeSchema(){for(let r=0;r<this.children.length;++r){let i=this.children[r];i.isDisabled(i)||(yield*i.computeSchema())}let e=this.proto.model();!e||(yield*e.compute(this.TLB,this.prj,this))}child(e){var r;return(r=this.children.find(i=>i.handle===e))!=null?r:null}connectVar(e,r,i,n){return n?!0:Ue.connect(this.varGraphNodes[e],r.varGraphNodes[i])}receive(e,...r){if(this.prj.env.isWaiting())return Promise.resolve();let n=this.proto.vars();if(this.setVarValue(n.msgVarId,I.Float,e)===!1)return Promise.resolve();switch(e){case v.WM_CONTROLNOTIFY:this.setVarValue(n._hobjectVarId,I.Handle,r[0]),this.setVarValue(n.iditemVarId,I.Float,r[1]),this.setVarValue(n.wnotifycodeVarId,I.Float,r[2]);break;case v.WM_SIZE:this.setVarValue(n.nwidthVarId,I.Float,r[0]),this.setVarValue(n.nheightVarId,I.Float,r[1]);break;case v.WM_MOUSEMOVE:case v.WM_LBUTTONDOWN:case v.WM_LBUTTONUP:case v.WM_LBUTTONDBLCLK:case v.WM_RBUTTONDOWN:case v.WM_RBUTTONUP:case v.WM_RBUTTONDBLCLK:case v.WM_MBUTTONDOWN:case v.WM_MBUTTONUP:case v.WM_MBUTTONDBLCLK:this.setVarValue(n.xposVarId,I.Float,r[0]),this.setVarValue(n.yposVarId,I.Float,r[1]),this.setVarValue(n.fwkeysVarId,I.Float,r[2]);break;case v.WM_KEYDOWN:case v.WM_KEYUP:case 258:this.setVarValue(n.wVkeyVarId,I.Float,r[0]),this.setVarValue(n.repeatVarId,I.Float,r[1]),this.setVarValue(n.scanCodeVarId,I.Float,r[2]);break}return this.compute(!0)}compute(e=!1){return Y(this,null,function*(){if(!e&&this.isDisabled(this))return;let r=this.computeSchema();for(;;){let s=r.next();if(s.done)break;this.prj.env.setWaiting(),yield s.value,this.prj.env.resetWaiting()}let i=this.prj;i.oldFloats.set(i.newFloats),i.oldInts.set(i.newInts);let n=i.newStrings;for(let s=0;s<n.length;++s)i.oldStrings[s]=n[s];ne.assertZeroIndexEmpty(i)})}createTLB(){let e={floatsCount:1,intsCount:1,stringsCount:1};return function r({children:i,TLB:n,varGraphNodes:s}){i.forEach(r),n.set(s.map(a=>a.getIndex(e)))}(this),e}applyDefaults(){this.children.forEach(i=>i.applyDefaults());let e=this.proto.vars(),r=e.count();for(let i=0;i<r;++i){let n=e.data(i),s=n.type,a=n.defaultValue;if(a!==null){this.setVarValue(i,s,a);continue}switch(i){case e.orgxVarId:this.setVarValue(i,s,this.position.x);break;case e.orgyVarId:this.setVarValue(i,s,this.position.y);break;case e._hobjectVarId:this.setVarValue(i,s,this.handle);break;case e._objnameVarId:this.setVarValue(i,s,this.schemeName);break;case e._classnameVarId:this.setVarValue(i,s,this.proto.name);break}}return this}applyVarSet(e){if(this.proto.name.toUpperCase()===e.classname.toUpperCase()){let r=this.proto.vars(),{values:i}=e;for(let n=0;n<i.length;++n){let s=i[n],a=r.id(s.name);if(a===null)continue;let u=r.data(a).type;this.setVarValue(a,u,Dt(u,s.value))}}return e.childSets.forEach(r=>{var i;return(i=this.child(r.handle))==null?void 0:i.applyVarSet(r)}),this}path(){let e=this,r="";for(;e.parent;)r=` -> ${e.proto.name} #${e.handle}${r}`,e=e.parent;return this.prj.root.proto.name+r}stubCall(e,r){throw Error(`\u0412\u044B\u0437\u043E\u0432 \u043D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e}(${r.map(i=>typeof i).join(",")})
\u0432 ${this.path()}`)}copyNewValuesToOld(){let e=this.TLB,{newFloats:r,oldFloats:i,newInts:n,oldInts:s,newStrings:a,oldStrings:u}=this.prj;for(let c of e)i[c]=r[c],s[c]=n[c],u[c]=a[c]}static assertZeroIndexEmpty(e){if(e.oldFloats[0]!==0||"undefined"in e.oldFloats||e.newFloats[0]!==0||"undefined"in e.newFloats||e.oldInts[0]!==0||"undefined"in e.oldInts||e.newInts[0]!==0||"undefined"in e.newInts||e.oldStrings[0]!==""||"undefined"in e.oldStrings||e.newStrings[0]!==""||"undefined"in e.newStrings)throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}stratum_async_test_sleep_8210460217466098(e){return e===0?"":new Promise(r=>setTimeout(r,e)).then(()=>"wait"+e)}stratum_getHObject(){return this.handle}stratum_getHObjectByName(e){var r,i;return(i=(r=this.resolve(e))==null?void 0:r.handle)!=null?i:0}stratum_getClassName(e){let r=this.resolve(e);return typeof r=="undefined"?"":r.proto.name}stratum_setVar(e,r,i){let n=this.resolve(e);if(!n)return;let s=n.proto.vars(),a=s.id(r);a!==null&&n.setVarValue(a,s.data(a).type,i)}stratum_getVarS(e,r){let i=this.resolve(e);if(!i)return"";let s=i.proto.vars().id(r);return s!==null?i.getVarValue(s,I.String):""}stratum_getVarF(e,r){let i=this.resolve(e);if(!i)return 0;let s=i.proto.vars().id(r);return s!==null?i.getVarValue(s,I.Float):0}stratum_getVarH(e,r){let i=this.resolve(e);if(!i)return 0;let s=i.proto.vars().id(r);return s!==null?i.getVarValue(s,I.Handle):0}stratum_getVarC(e,r){let i=this.resolve(e);if(!i)return 0;let s=i.proto.vars().id(r);return s!==null?i.getVarValue(s,I.ColorRef):0}*stratum_async_sendMessage(e,r,...i){var S;let{prj:n,TLB:s}=this;if(n.canExecute()===!1)return;let a=null;if(e!==""){let f=this.resolve(e);f&&(a=[f])}if(r!==""){let f=r.toUpperCase();a=(S=a==null?void 0:a.filter(y=>y.proto.name.toUpperCase()===f))!=null?S:this.findClasses(f)}if(!a||a.length===0)return;let u=this.proto.vars(),c=a[0].proto.vars(),m=new Array(i.length*1.5),d=0;for(let f=0;f<i.length;f+=2){let y=u.id(i[f]);if(y===null)continue;let g=c.id(i[f+1]);if(g===null)continue;let R=u.data(y).type,O=c.data(g).type;R===O&&(m[d+0]=R,m[d+1]=y,m[d+2]=g,d+=3)}for(let f=0;f<a.length;++f){let y=a[f];if(y!==this){for(let g=0;g<m.length;g+=3){let R=m[g+0];if(typeof R=="undefined")continue;let O=s[m[g+1]],M=y.TLB[m[g+2]],F=n.getNewValue(O,R);n.setNewValue(M,R,F),n.setOldValue(M,R,F)}n.inc(),yield*y.computeSchema(),y.copyNewValuesToOld(),n.dec();for(let g=0;g<m.length;g+=3){let R=m[g+0];if(typeof R=="undefined")continue;let O=s[m[g+1]],M=y.TLB[m[g+2]],F=n.getNewValue(M,R);n.setNewValue(O,R,F)}}}}stratum_setCapture(e,r,i){let n=this.resolve(r);!n||n.proto.vars().msgVarId<0||this.prj.env.setCapture(n,e,i)}stratum_registerObject(e,r,i,n,s){let a=this.resolve(i);!a||a.proto.vars().msgVarId<0||this.prj.env.subscribe(a,e,r,n,s)}stratum_unregisterObject(e,r,i){let n=this.resolve(r);!n||n.proto.vars().msgVarId<0||this.prj.env.unsubscribe(n,e,i)}};Ee(ne,"schema");var je=class{constructor(e,r){this.level=0,this._shouldClose=!1,this.env=e,this.dir=r.dir,this.filepath=r.filepath;let i=r.classes.get(r.prjInfo.rootClassName);if(!i)throw Error(`\u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${r.prjInfo.rootClassName} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);ve.clear();let n=i.schema((...a)=>new ne(this,...a));ve.size>0&&console.warn(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0438\u043B\u0438 \u043D\u0435\u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 (${ve.size}):
${[...ve.values()].join(`
`)}`);let s=n.createTLB();this.oldFloats=new Float64Array(s.floatsCount),this.newFloats=new Float64Array(s.floatsCount),this.oldInts=new Int32Array(s.intsCount),this.newInts=new Int32Array(s.intsCount),this.oldStrings=new Array(s.stringsCount).fill(""),this.newStrings=new Array(s.stringsCount).fill(""),this.olds=[],this.olds[I.Float]=this.oldFloats,this.olds[I.Handle]=this.oldInts,this.olds[I.ColorRef]=this.oldInts,this.olds[I.String]=this.oldStrings,this.news=[],this.news[I.Float]=this.newFloats,this.news[I.Handle]=this.newInts,this.news[I.ColorRef]=this.newInts,this.news[I.String]=this.newStrings,n.applyDefaults(),r.stt&&n.applyVarSet(r.stt),this.root=n}canExecute(){return this.level<59}inc(){++this.level}dec(){--this.level}setOldValue(e,r,i){this.olds[r][e]=i}setNewValue(e,r,i){this.news[r][e]=i}getNewValue(e,r){return this.news[r][e]}shouldClose(){return this._shouldClose}click(e,r){return this.env.hyperCall(this,e,r)}stratum_closeAll(){this._shouldClose=!0}stratum_openSchemeWindow(e,r,i){return this.env.openSchemeWindow(this,e,r,i)}stratum_async_loadSpaceWindow(e,r,i){return this.env.loadSpaceWindow(this,e,r,i)}stratum_async_createWindowEx(e,r,i,n,s,a,u,c){return this.env.createWindowEx(this,e,r,i,n,s,a,u,c)}stratum_async_createDIB2d(e,r){return this.env.createDIB2d(this.dir,e,r)}stratum_async_createDoubleDib2D(e,r){return this.env.createDoubleDib2D(this.dir,e,r)}stratum_async_createObjectFromFile2D(e,r,i,n,s){return this.env.createObjectFromFile2D(this.dir,e,r,i,n,s)}stratum_async_createStream(e,r,i){return this.env.createStream(this.dir,e,r,i)}stratum_async_mSaveAs(e,r,i){return this.env.mSaveAs(this.dir,e,r,i)}stratum_async_mLoad(e,r,i){return this.env.mLoad(this.dir,e,r,i)}stratum_async_createDir(e){return Y(this,null,function*(){let r=this.dir.resolve(e);return(yield r.fs.createDir(r))?1:0})}stratum_async_fileExist(e){return Y(this,null,function*(){let r=this.dir.resolve(e);return(yield r.fs.fileExist(r))?1:0})}stratum_getProjectDirectory(){return this.dir.toString()}};Ee(je,"prj");var Zt=class{constructor(){this.fields=[]}insert(e){if(e==="FLOAT")return this.fields.push({type:e,value:0}),1;if(e==="HANDLE")return this.fields.push({type:e,value:0}),1;if(e==="STRING")return this.fields.push({type:e,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${e}`)}insertClass(e){let r=e.map(i=>{let n=i[0].toUpperCase();switch(i[1]){case I.Float:return[n,{type:"FLOAT",value:0}];case I.String:return[n,{type:"STRING",value:""}];default:return[n,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",value:new Map(r)}),1}set(e,r,i){if(e<0||e>this.fields.length-1)return;let n=this.fields[e];if(n.type==="STRUCT"){let s=n.value.get(r.toUpperCase());if(!s)return;n=s}if(typeof i=="string"){if(n.type!=="STRING")return;n.value=i}else{if(n.type==="STRING")return;n.value=i}}remove(e){return this.fields.splice(e,1).length?1:0}count(){return this.fields.length}type(e){return e<0||e>this.fields.length-1?"":this.fields[e].type}getFloat(e,r){if(e<0||e>this.fields.length-1)return 0;let i=this.fields[e];if(i.type==="STRUCT"){let n=i.value.get(r.toUpperCase());if(!n)return 0;i=n}return i.type==="FLOAT"?i.value:0}getHandle(e,r){if(e<0||e>this.fields.length-1)return 0;let i=this.fields[e];if(i.type==="STRUCT"){let n=i.value.get(r.toUpperCase());if(!n)return 0;i=n}return i.type==="HANDLE"?i.value:0}getString(e,r){if(e<0||e>this.fields.length-1)return"";let i=this.fields[e];if(i.type==="STRUCT"){let n=i.value.get(r.toUpperCase());if(!n)return"";i=n}return i.type==="STRING"?i.value:""}sort(e){if(!e||e.length===0)return this.fields.sort((r,i)=>r.value-i.value),1;if(e.length===1)return e[0].desc?this.fields.sort((r,i)=>i.value-r.value):this.fields.sort((r,i)=>r.value-i.value),1;throw console.log(e),new Error("\u0421\u043E\u0440\u0442\u0438\u0432\u0440\u043E\u043A\u0430 \u043F\u043E \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};var Me=class{static widthToSize(e){return e<0||e>9?0:Me.widthTable[e]}constructor(e={}){var i;let r=e.data;r?r instanceof ArrayBuffer?this.v=new DataView(r.slice(0)):this.v=new DataView(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):this.v=new DataView(new ArrayBuffer(0)),this.p=0,this.width=8,this.onflush=(i=e.file)!=null?i:null}copyTo(e,r,i){return r<0||r+i>this.v.byteLength?0:(e.v.byteLength<i?e.v=new DataView(this.v.buffer.slice(r,i)):new Uint8Array(e.v.buffer).set(new Uint8Array(this.v.buffer,r,i)),1)}seek(e){return this.p=e}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(e){return this.width=e,1}widthNumber(){let e=Me.widthToSize(this.width);if(e===0)return 0;let r=this.p,i=r+e;if(i>this.size())return 0;switch(this.p=i,this.width){case 0:return this.v.getUint8(r);case 1:return this.v.getInt8(r);case 2:return this.v.getUint16(r,!0);case 3:return this.v.getInt16(r,!0);case 4:return this.v.getUint32(r,!0);case 5:return this.v.getInt32(r,!0);case 6:return this.v.getFloat32(r,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(r,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(e){let r=new Uint8Array(new ArrayBuffer(e));r.set(new Uint8Array(this.v.buffer)),this.v=new DataView(r.buffer)}writeWidthNumber(e){let r=Me.widthToSize(this.width);if(r===0)return 0;let i=this.p,n=i+r;switch(n>this.size()&&this.resize(n),this.p=n,this.width){case 0:return this.v.setUint8(i,e),1;case 1:return this.v.setInt8(i,e),1;case 2:return this.v.setUint16(i,e,!0),2;case 3:return this.v.setInt16(i,e,!0),2;case 4:return this.v.setUint32(i,e,!0),4;case 5:return this.v.setInt32(i,e,!0),4;case 6:return this.v.setFloat32(i,e,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(i,e,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}text(){return Je(new Uint8Array(this.v.buffer))}line(){let e=this.p,r=this.size()-e;if(r<=0)return"";let i=0,n=0;for(;i<r;){let a=this.v.getUint8(e+i);if(a===0){n=1;break}if(a===Me.slashR&&i+1<r&&this.v.getInt8(e+i+1)===Me.slashN){n=2;break}i+=1}let s=Je(new Uint8Array(this.v.buffer,e,i));return this.p=e+i+n,s}writeLine(e){let r=e+`\r
`,i=this.p,n=i+r.length;n>this.size()&&this.resize(n),this.p=n;let s=oi(r);for(let a=0;a<s.length;++a)this.v.setUint8(i,s[a]),i+=1;return r.length}close(){return this.onflush?this.onflush.write(this.v.buffer):!0}},_e=Me;_e.slashR="\r".charCodeAt(0),_e.slashN=`
`.charCodeAt(0),_e.widthTable=[1,1,2,2,4,4,4,5,8,10];var Ot=class{constructor(e){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;this.wVkeyVarId=-1;this.repeatVarId=-1;this.scanCodeVarId=-1;if(!e){this.nameUCToId=new Map,this.vdata=[];return}this.vdata=e.map(i=>{let n,s;switch(i.type){case"FLOAT":case"INTEGER":s="FLOAT",n=I.Float;break;case"HANDLE":s=i.type,n=I.Handle;break;case"STRING":s=i.type,n=I.String;break;case"COLORREF":s=i.type,n=I.ColorRef;break}let a=i.defaultValue.length>0?Dt(n,i.defaultValue):null;return{name:i.name,type:n,defaultValue:a,isReturnValue:!!(i.flags&v.VF_RETURN),typeString:s,description:i.description,rawFlags:i.flags,rawDefaultValue:i.defaultValue}});let r=e.map(i=>i.name.toUpperCase());this.nameUCToId=new Map(r.map((i,n)=>[i,n]));for(let i=0;i<e.length;++i){let n=r[i],s=this.vdata[i].type;n==="_ENABLE"&&s===I.Float?this._enableVarId=i:n==="_DISABLE"&&s===I.Float?this._disableVarId=i:n==="MSG"&&s===I.Float?this.msgVarId=i:n==="_HOBJECT"&&s===I.Handle?this._hobjectVarId=i:n==="IDITEM"&&s===I.Float?this.iditemVarId=i:n==="WNOTIFYCODE"&&s===I.Float?this.wnotifycodeVarId=i:n==="NWIDTH"&&s===I.Float?this.nwidthVarId=i:n==="NHEIGHT"&&s===I.Float?this.nheightVarId=i:n==="XPOS"&&s===I.Float?this.xposVarId=i:n==="YPOS"&&s===I.Float?this.yposVarId=i:n==="FWKEYS"&&s===I.Float?this.fwkeysVarId=i:n==="ORGX"&&s===I.Float?this.orgxVarId=i:n==="ORGY"&&s===I.Float?this.orgyVarId=i:n==="_OBJNAME"&&s===I.String?this._objnameVarId=i:n==="_CLASSNAME"&&s===I.String?this._classnameVarId=i:n==="WVKEY"&&s===I.Float?this.wVkeyVarId=i:n==="REPEAT"&&s===I.Float?this.repeatVarId=i:n==="SCANCODE"&&s===I.Float&&(this.scanCodeVarId=i)}}id(e){var r;return(r=this.nameUCToId.get(e.toUpperCase()))!=null?r:null}get(e){let r=this.nameUCToId.get(e.toUpperCase());return typeof r=="undefined"?null:this.vdata[r]}data(e){return this.vdata[e]}count(){return this.vdata.length}toArray(){return this.vdata}};var xt=class{constructor(e,r){this._model=null;this._compiled=!1;var n,s,a,u,c,m,d,S;this.name=e.name,this.children=(n=e.children)!=null?n:[],this.links=(s=e.links)!=null?s:[],this._schemeBytes=(a=e.scheme)!=null?a:null,this._scheme=null,this._imageBytes=(u=e.image)!=null?u:null,this._image=null,this.iconFile=(c=e.iconFile)!=null?c:null,this.iconIndex=(m=e.iconIndex)!=null?m:0,this.sourceCode=(d=e.sourceCode)!=null?d:null,this._vars=new Ot(e.vars);let i=(S=e.flags)!=null?S:0;this.alwaysUseIcon=!!(i&C.CF_USEDEFICON),this.isStruct=!!(i&C.CF_STRUCTURE),this.lib=r}vars(){return this._vars}scheme(){let e=this._scheme;if(e)return e;let r=this._schemeBytes;if(!r)return null;this._schemeBytes=null;let i=`\u0421\u0445\u0435\u043C\u0430 ${this.name}`;if(typeof r=="string")throw Error(`${i}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${r}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let n=new Q(r,i),s=Ce(n,{origin:"class",name:this.name}),a=this.children;if(!a)return this._scheme=s;let u=new qe(s);for(let c=0;c<a.length;++c){let m=a[c],d=this.lib.get(m.classname);if(!d){console.warn(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${m.classname} #${m.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435 ${this.name}`);continue}let S=d.iconFile;if(S&&u.replaceIcon(m.handle,S,d.iconIndex),!d.alwaysUseIcon){let f=d.image();f&&u.insertChildImage(m.handle,f)}}return this._scheme=u.result()}image(){let e=this._image;if(e)return e;let r=this._imageBytes;if(!r)return null;this._imageBytes=null;let i=`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${this.name}`;if(typeof r=="string")throw Error(`${i}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${r}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let n=new Q(r,i);return this._image=Ce(n,{origin:"class",name:this.name})}setCode(e){this.sourceCode!==e&&(this._model=wt(e,this.lib,this.name,this._vars.toArray()),this.sourceCode=e)}hasModel(){return!!this.sourceCode}model(){if(this._compiled)return this._model;this._compiled=!0;let e=this.sourceCode;return e?this._model=wt(e,this.lib,this.name,this._vars.toArray()):null}schema(e,r){let i=this.children.map(n=>{let s=this.lib.get(n.classname);if(!s)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${n.classname}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);return s.schema(e,n)});return e(this,i,this.links,r)}};function Aa(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=t.string(),s=t.string(),a=t.string(),u=t.string().toUpperCase();if(u!=="STRING"&&u!=="FLOAT"&&u!=="INTEGER"&&u!=="HANDLE"&&u!=="COLORREF")throw new ae(t,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${u}.`);let c=t.int32();r[i]={name:n,description:s,defaultValue:a,type:u,flags:c}}return r}function Ma(t){let e=t.uint16(),r=new Array(e);for(let i=0;i<e;++i){let n=t.uint16(),s=t.uint16(),a=t.uint16(),u=t.int32(),c=t.uint16(),m=t.uint16(),d=new Array(c);for(let S=0;S<c;S++){let f=t.string(),y=t.string();d[S]={name1:f,name2:y}}r[i]={handle1:n,handle2:s,handle:a,flags:u,connectedVars:d,contactPadHandle:m}}return r}function Fa(t,e){let r=t.uint16(),i=new Array(r);for(let n=0;n<r;++n){let s=t.string(),a=t.uint16(),u=t.string(),c=t.point2d(e<12290),m=t.byte();i[n]={classname:s,handle:a,schemeName:u,position:c,flags:m}}return i}function Pi(t){return t.int32()&C.SF_EXTERNAL?t.string():t.bytes(t.int32())}function Qt(t){let e=t.uint16();if(e!==16979)throw new J(t,e,16979);let r=t.int32();return t.skip(8),{name:t.string(),version:r}}function Ai(t){let e=Qt(t),r=t.uint16();if(r===C.CR_VARS1&&(e.vars=Aa(t),r=t.uint16()),r===C.CR_LINKS&&(e.links=Ma(t),r=t.uint16()),(r===C.CR_CHILDSnameXY||r===C.CR_CHILDSname||r===C.CR_CHILDS)&&(e.children=Fa(t,e.version),r=t.uint16()),r===C.CR_ICON){let i=t.int32();t.skip(i-4),r=t.uint16()}return r===C.CR_SCHEME&&(t.skip(4),e.scheme=Pi(t),r=t.uint16()),r===C.CR_IMAGE&&(t.skip(4),e.image=Pi(t),r=t.uint16()),r===C.CR_TEXT&&(e.sourceCode=t.string(),r=t.uint16()),r===C.CR_INFO&&(t.skip(t.uint16()),r=t.uint16()),r===C.CR_VARSIZE&&(t.skip(2),r=t.uint16()),r===C.CR_FLAGS&&(e.flags=t.int32(),r=t.uint16()),r===C.CR_DEFICON&&(e.iconIndex=t.uint16(),r=t.uint16()),r===C.CR_ICONFILE&&(e.iconFile=t.string(),r=t.uint16()),r===C.CR_CODE&&(t.skip(t.int32()*2),r=t.uint16()),r===C.CR_EQU||r!==C.CR_CLASSTIME&&e.version===12291&&console.warn(`${e.name} (${t.name||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),e}var Jt=class{constructor(){this.filenames=new Set;this.lib=new Map}add(e,r,i,n){return Y(this,null,function*(){let s=yield e.searchClsFiles(r,i),a=[],u=s.filter(S=>{let f=S.toString(),y=this.filenames.size;this.filenames.add(f);let g=this.filenames.size!==y;return g&&a.push(f),g});if(u.length===0)return;let c=yield e.arraybuffers(u),m=0,d=0;for(let S=0;S<c.length;++S){let f=c[S];if(!f)continue;let y=a[S],g=new Q(f,y),R;try{R=Qt(g).name}catch(F){console.warn(F.message);continue}g.seek(0),g.name=`${R} (${y})`;let O=R.toUpperCase(),M=this.lib.get(O);if(M)throw typeof n!="undefined"&&this.clear(n),Error(`\u0418\u043C\u0438\u0434\u0436 ${R} \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445: ${M.path}, ${y}`);this.lib.set(O,{type:"unloaded",id:n!=null?n:null,path:y,reader:g}),m+=f.byteLength,++d}d>0&&K.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E ${d} \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043E\u0431\u044A\u0435\u043C\u043E\u043C ${(m/1024).toFixed()} \u041A\u0411. \u0412\u0441\u0435\u0433\u043E: ${this.lib.size}.`)})}clear(e){let i=[...this.lib].filter(a=>a[1].id!==e),n=this.lib.size-i.length;n>0&&K.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${n} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(i);let s=i.map(a=>a[1].path);this.filenames=new Set(s)}clearAll(){let r=[...this.lib].filter(s=>s[1].id===null),i=this.lib.size-r.length;i>0&&K.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${i} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(r);let n=r.map(s=>s[1].path);this.filenames=new Set(n)}has(e){return this.lib.has(e.toUpperCase())}get(e){let r=e.toUpperCase(),i=this.lib.get(r);if(!i)return null;if(i.type==="loaded")return i.proto;let n=Ai(i.reader),s=new xt(n,this);return this.lib.set(r,{type:"loaded",id:i.id,path:i.path,proto:s}),s}hasModel(e){var r,i;return(i=(r=this.get(e))==null?void 0:r.hasModel())!=null?i:!1}getModel(e){var r,i;return(i=(r=this.get(e))==null?void 0:r.model())!=null?i:null}getPath(e){var r,i;return(i=(r=this.lib.get(e.toUpperCase()))==null?void 0:r.path)!=null?i:null}};var Bt=class{constructor(e){this.minX=e.minX,this.minY=e.minY,this.rows=e.rows,this.cols=e.cols,this.data=e.data?new Float64Array(e.data):new Float64Array(this.rows*this.cols)}get(e,r){let i=e-this.minX,n=r-this.minY;return i<0||n<0||i>=this.rows||n>=this.cols?0:this.data[i*this.cols+n]}set(e,r,i){let n=e-this.minX,s=r-this.minY;return n<0||s<0||n>=this.rows||s>=this.cols?0:(this.data[n*this.cols+s]=i,i)}fill(e){return this.data.fill(e),1}};function Mi(t){let e=t.uint16();if(e!==12)throw new J(t,e,12);t.seek(14);let r=t.int32(),i=t.int32(),n=t.int32(),s=t.int32();t.uint16(),t.uint16();let a=Array.from({length:r*i},()=>t.float64());return{minX:n,minY:s,rows:r,cols:i,data:a}}function Fe(t,e){return Y(this,null,function*(){let r=yield t.fs.arraybuffer(t);if(!r)throw Error(`\u0424\u0430\u0439\u043B ${t.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let i=new Q(r,t.toString());try{switch(e){case"prj":return yt(i);case"stt":return Et(i);case"vdr":return Ce(i,{origin:"file",name:t.toString()});case"mat":return Mi(i);case"bmp":return It(i);case"dbm":return Ve(i)}}catch(n){throw console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${t.toString()} \u043A\u0430\u043A .${e.toUpperCase()}`),console.error(n),n}})}var tt=class{constructor(e,r,i={}){this.handlers=i;this._shouldQuit=!1;this._isWaiting=!1;this.loading=null;this.windows=new Map;this.scenes=new Map;this.streams=new Map;this.matrices=new Map;this.arrays=new Map;this.targetScene=null;this.lastOpenPopup="";this.setObjectAttribute2dShowed=!1;this.systemShowed=!1;this.stratum_loadCursorShowed=!1;this.setWindowRegionShowed=!1;this.setWindowOwnerwarnShowed=!1;this.lockSpace2dWarnShowed=!1;this.projects=[new je(this,e)],this.classes=e.classes,this.host=r}static loadProject(e,r){return Y(this,null,function*(){let i=r==null?void 0:r.filter(s=>!s.type||s.type==="library").map(s=>s.dir),n=new Jt;return tt.loadProjectResources(e,{lib:n},i)})}static loadProjectResources(e,r,i){return Y(this,null,function*(){var R,O;let n=e.resolve(".."),s=n.resolve("_preload.stt"),[a,u]=yield n.fs.arraybuffers([e,s]);if(!a)throw Error(`\u0424\u0430\u0439\u043B \u043F\u0440\u043E\u0435\u043A\u0442\u0430 ${e} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);K.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${e.toString()}`);let c=yt(new Q(a,e.toString())),m=(R=c.settings)==null?void 0:R.preloadFile;m&&(u=yield n.fs.arraybuffer(n.resolve(m)));let d=null;if(u)try{d=Et(new Q(u,s.toString()))}catch(M){console.warn(M)}let S=[n],f=(O=c.settings)==null?void 0:O.classSearchPaths;if(f){let M=f.split(",").map(F=>F.trim()).filter(F=>F);for(let F of M)S.push(n.resolve(F))}let y=i?S.concat(i):S,g=r.lib;return yield g.add(n.fs,y,!0,r.id),{classes:g,dir:n,prjInfo:c,stt:d,filepath:e.toString()}})}sessionId(){return this.projects.length}nextSessionId(){return this.projects.length+1}compute(){if(this._shouldQuit)return this.closeAllRes();if(this.loading)return this.loading;let e=this.projects.length-1,r=this.projects[e];if(r.shouldClose()===!0){if(K.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${r.filepath}`),this.classes.clear(this.sessionId()),this.closeProjectWindows(r),this.projects.pop(),this.projects.length===0)return this.closeAllRes();r=this.projects[e-1]}return r.root.compute()}requestStop(){this._shouldQuit=!0}closeAllRes(){return Y(this,null,function*(){var i;this._shouldQuit=!0,this.windows.forEach(n=>n.close()),this.scenes.clear(),this.windows.clear(),(i=this.targetScene)==null||i.releaseCapture(),this.targetScene=null;let e=[];for(let n of this.streams.values()){let s=n.close();s instanceof Promise&&e.push(s)}yield Promise.all(e),this.streams.clear(),this.matrices.clear(),this.arrays.clear();let r;for(;r=this.projects.pop();)K.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${r.filepath}`);if(this.loading)try{yield this.loading}catch(n){}return this.classes.clearAll(),!0})}isWaiting(){return this._isWaiting}setWaiting(){this._isWaiting=!0}resetWaiting(){this._isWaiting=!1}getTime(e,r,i,n,s,a,u,c){let m=new Date;e[r]=m.getHours(),i[n]=m.getMinutes(),s[a]=m.getSeconds(),u[c]=m.getMilliseconds()*.1}getDate(e,r,i,n,s,a){let u=new Date;e[r]=u.getFullYear(),i[n]=u.getMonth(),s[a]=u.getDate()}getActualSize2d(e,r,i,n,s,a){let u=this.getObject(e,r);return typeof u=="undefined"?(i[n]=0,s[a]=0,0):(i[n]=u.actualWidth(),s[a]=u.actualHeight(),1)}getVarInfo(e,r,i,n,s,a,u,c,m,d,S,f){var R;if(r<0)return 0;let y=(R=this.classes.get(e))==null?void 0:R.vars();if(!y||r>y.count()-1)return 0;let g=y.data(r);return i[n]=g.name,s[a]=g.typeString,m[d]=g.description,u[c]=g.rawDefaultValue,typeof S!="undefined"&&typeof f!="undefined"&&(S[f]=g.rawFlags),1}getMousePos(e,r,i,n,s){let a=this.windows.get(e);if(!a)return r[i]=0,n[s]=0,0;let[u,c]=X.mouseCoords(a.scene);return r[i]=u+a.scene.originX(),n[s]=c+a.scene.originY(),1}openSchemeWindow(e,r,i,n){var u;let s=this.windows.get(r);if(typeof s!="undefined")return s.sceneHandle;let a=(u=this.classes.get(i))==null?void 0:u.scheme();return this.openWindow(e,r,Rt(n),a)}loadSpaceWindow(e,r,i,n){let s=this.windows.get(r);if(typeof s!="undefined")return s.sceneHandle;let a=Rt(n);return i===""?this.openWindow(e,r,a):Fe(e.dir.resolve(i),"vdr").then(u=>this.openWindow(e,r,a,u)).catch(()=>this.openWindow(e,r,a))}createWindowEx(e,r,i,n,s,a,u,c,m){var y;let d=this.windows.get(r);if(typeof d!="undefined")return d.sceneHandle;let S=g=>{let R=this.windows.get(i),O=Rt(m),M={x:s,y:a,w:u,h:c};return!R||!O.child?this.openWindow(e,r,O,g,M):this.openSubwindow(R,e,r,O,M,g)},f=(y=this.classes.get(n))==null?void 0:y.scheme();return f?S(f):Fe(e.dir.resolve(n),"vdr").then(g=>S(g)).catch(()=>S())}createDIB2d(e,r,i){let n=this.scenes.get(r);return typeof n=="undefined"?0:Fe(e.resolve(i),"bmp").then(s=>n.createDIBTool(s)).catch(()=>0)}createDoubleDib2D(e,r,i){let n=this.scenes.get(r);return typeof n=="undefined"?0:Fe(e.resolve(i),"dbm").then(s=>n.createDoubleDIBTool(s)).catch(()=>0)}createObjectFromFile2D(e,r,i,n,s,a){let u=this.scenes.get(r);return typeof u=="undefined"?0:Fe(e.resolve(i),"vdr").then(c=>u.insertVectorDrawing(n,s,a,c)).catch(()=>0)}createStream(e,r,i,n){let s=r.toUpperCase(),a=n.toUpperCase().includes("CREATE"),u=P.getFreeHandle(this.streams);if(s==="FILE"){let c=e.resolve(i);return(()=>Y(this,null,function*(){let m;if(a){let d=yield c.fs.createFile(c);if(!d)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0444\u0430\u0439\u043B ${c}.`);m=new _e({file:d})}else{let d=c.fs.file(c),S=yield d==null?void 0:d.read();if(!d||!S)throw Error(`\u0424\u0430\u0439\u043B ${c} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);m=new _e({data:S,file:d})}return this.streams.set(u,m),u}))()}if(s==="MEMORY")return this.streams.set(u,new _e),u;throw Error(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${s} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`)}mSaveAs(e,r,i,n){if(n<=0)return 0;throw Error("\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}mLoad(e,r,i,n){return n<=0?0:Fe(e.resolve(i),"mat").then(s=>{let a=r===0?P.getFreeNegativeHandle(this.matrices):r;return this.matrices.set(a,new Bt(s)),a}).catch(()=>0)}setCapture(e,r,i){let n=this.scenes.get(r);typeof n!="undefined"&&(this.targetScene=n).setCapture(e)}subscribe(e,r,i,n,s){var u;let a=typeof r=="number"?(u=this.scenes.get(r))==null?void 0:u.wnd:this.windows.get(r);a==null||a.on(e,n,s&1?i:0)}unsubscribe(e,r,i){var s;let n=typeof r=="number"?(s=this.scenes.get(r))==null?void 0:s.wnd:this.windows.get(r);n==null||n.off(e,i)}loadProject(e){return Y(this,null,function*(){if(this.loading)return;let r=document.body.style.cursor;document.body.style.cursor="wait";try{let i=yield tt.loadProjectResources(e,{id:this.nextSessionId(),lib:this.classes});if(this._shouldQuit)return;this.projects.push(new je(this,i))}catch(i){console.error(i)}finally{this.loading=null,document.body.style.cursor=r}})}hyperCall(e,r,i){var n,s,a,u,c;if(this.lastOpenPopup&&((n=this.windows.get(this.lastOpenPopup))==null||n.close(),this.lastOpenPopup=""),!(this.loading||!r))switch((s=r.openMode)!=null?s:0){case 0:{let f=r.target;if(!f)break;let y=(a=this.classes.get(f))==null?void 0:a.scheme();if(!y)break;let g=r.windowName||(((c=(u=y.settings)==null?void 0:u.style)!=null?c:0)&te.SWF_POPUP?"PopupWindow":"MainWindow");if(this.windows.has(g))return;this.openWindow(e,g,{useVdrSettings:!0},y,{x:i.x,y:i.y,w:0,h:0});break}case 1:let m=r.target;if(!m)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A Windows \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F ${e.dir.resolve(m)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;case 2:let d=r.target;if(!d)break;this.loading=this.loadProject(e.dir.resolve(d));break;case 3:break;case 4:let S=r.target;if(!S)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A \u043A\u043E\u043C\u0430\u043D\u0434\u044B ${e.dir.resolve(S)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(r)}}openWindow(e,r,i,n,s){let a=P.getFreeHandle(this.scenes),u={handle:a,wname:r,vdr:n,attribs:i,rect:s,onClosed:()=>this.removeWindow(r)},c=new et(u,(m,d)=>(d.popup&&(this.lastOpenPopup=r),this.host.window(m,d)));return this.windows.set(r,c),this.scenes.set(a,c.scene),c.projectID=e,c.scene.hyperHandler=e,a}openSubwindow(e,r,i,n,s,a){let u=P.getFreeHandle(this.scenes),c=e.subwindow({handle:u,wname:i,vdr:a,rect:s,attribs:n,onClosed:()=>this.removeWindow(i)});return this.windows.set(i,c),this.scenes.set(u,c.scene),c.projectID=r,c.scene.hyperHandler=r,u}closeProjectWindows(e){for(let r of this.windows.values())r.projectID===e&&r.close()}removeWindow(e){var i;let r=this.windows.get(e);!r||(this.windows.delete(e),this.scenes.delete(r.sceneHandle),r.scene===this.targetScene&&((i=this.targetScene)==null||i.releaseCapture(),this.targetScene=null))}getObject(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objects.get(r):void 0}getTPen(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.pens.get(r):void 0}getTBrush(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.brushes.get(r):void 0}getTDIB(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.dibs.get(r):void 0}getTDDoubleDIB(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.doubleDibs.get(r):void 0}getTText(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.texts.get(r):void 0}getTString(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.strings.get(r):void 0}getTFont(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.fonts.get(r):void 0}stratum_releaseCapture(){this.targetScene!==null&&(this.targetScene.releaseCapture(),this.targetScene=null)}stratum_isDlgButtonChecked2d(e,r){return 0}stratum_checkDlgButton2d(e,r,i){return 1}stratum_setObjectAttribute2d(e,r,i,n){return this.setObjectAttribute2dShowed||(console.warn("stratum_setObjectAttribute2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setObjectAttribute2dShowed=!0),1}stratum_setScrollRange(e,r,i,n){return 1}stratum_system(e,...r){return this.systemShowed||(console.warn(`\u0412\u044B\u0437\u043E\u0432 System(${e}, ${r}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.systemShowed=!0),0}stratum_shell(e,r,i,n){var s;return(s=this.handlers.shell)==null||s.forEach(a=>a(e,r,i,n)),1}stratum_getAsyncKeyState(e){return e<0||e>X.keyState.length-1?0:X.keyState[e]>0?1:0}stratum_loadCursor(e,r){this.stratum_loadCursorShowed||(console.warn("loadCursor \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.stratum_loadCursorShowed=!0)}stratum_getTickCount(){return new Date().getTime()-tt.startupTime}stratum_setHyperJump2d(e,r,i,...n){if(i<-1||i>4)return 0;let s=this.scenes.get(e);return typeof s=="undefined"?0:i===-1?s.setHyper(r,null):s.setHyper(r,{openMode:i,target:n[0],objectName:n[1],effect:n[2],windowName:n[3],params:n[4]})}stratum_stdHyperJump(e,r,i,n){var s;(s=this.scenes.get(e))==null||s.tryHyper(r,i,n)}stratum_getScreenWidth(){return screen.width}stratum_getScreenHeight(){return screen.height}stratum_getWorkAreaX(){return 0}stratum_getWorkAreaY(){return 0}stratum_getWorkAreaWidth(){return this.host.width||window.innerWidth}stratum_getWorkAreaHeight(){return this.host.height||window.innerHeight}stratum_getTitleHeight(){return 0}stratum_getSmallTitleHeight(){return 0}stratum_getFixedFrameWidth(){return 0}stratum_getFixedFrameHeight(){return 0}stratum_getSizeFrameWidth(){return 0}stratum_getSizeFrameHeight(){return 0}stratum_logMessage(e){K.log("\u0418\u043D\u0444\u043E: "+e)}stratum_setWindowRegion(e,r){return this.setWindowRegionShowed||(console.warn("SetWindowRegion \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setWindowRegionShowed=!0),1}stratum_getClientHeight(e){let r=this.windows.get(e);return typeof r!="undefined"?r.clientHeight():0}stratum_getClientWidth(e){let r=this.windows.get(e);return typeof r!="undefined"?r.clientWidth():0}stratum_getWindowName(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.wnd.name:""}stratum_getWindowOrgX(e){let r=this.windows.get(e);return typeof r!="undefined"?r.originX():0}stratum_getWindowOrgY(e){let r=this.windows.get(e);return typeof r!="undefined"?r.originY():0}stratum_getWindowSpace(e){let r=this.windows.get(e);return typeof r!="undefined"?r.sceneHandle:0}stratum_getWindowWidth(e){let r=this.windows.get(e);return typeof r!="undefined"?r.width():0}stratum_getWindowHeight(e){let r=this.windows.get(e);return typeof r!="undefined"?r.height():0}stratum_getWindowTitle(e){let r=this.windows.get(e);return typeof r!="undefined"?r.title():""}stratum_setClientSize(e,r,i){let n=this.windows.get(e);return typeof n!="undefined"?n.setClientSize(r,i):0}stratum_setWindowSize(e,r,i){let n=this.windows.get(e);return typeof n!="undefined"?n.setSize(r,i):0}stratum_setWindowOrg(e,r,i){let n=this.windows.get(e);return typeof n!="undefined"?n.setOrigin(r,i):0}stratum_setWindowPos(e,r,i,n,s){let a=this.windows.get(e);return typeof a=="undefined"?0:(a.setOrigin(r,i),a.setSize(n,s),1)}stratum_setWindowTitle(e,r){let i=this.windows.get(e);return typeof i!="undefined"?i.setTitle(r):0}stratum_getWindowProp(e,r){var a;let i=(a=this.windows.get(e))==null?void 0:a.source;if(!i)return"";let n=r.toUpperCase();return n==="CLASSNAME"&&i.origin==="class"||n==="FILENAME"&&i.origin==="file"?i.name:""}stratum_isWindowExist(e){return typeof this.windows.get(e)!="undefined"?1:0}stratum_bringWindowToTop(e){let r=this.windows.get(e);return typeof r!="undefined"?r.toTop():0}stratum_showWindow(e,r){let i=this.windows.get(e);return typeof i!="undefined"?i.setAttrib(r):0}stratum_closeWindow(e){let r=this.windows.get(e);return typeof r!="undefined"?r.close():0}stratum_setWindowTransparent(e,r){var n,s;let i=typeof e=="number"?(n=this.scenes.get(e))==null?void 0:n.wnd:this.windows.get(e);return(s=i==null?void 0:i.setTransparent(r))!=null?s:0}stratum_setWindowTransparentColor(e,r){var n,s;let i=typeof e=="number"?(n=this.scenes.get(e))==null?void 0:n.wnd:this.windows.get(e);return(s=i==null?void 0:i.setTransparentColor(r))!=null?s:0}stratum_setWindowOwner(e,r){return e===0||r===0||this.setWindowOwnerwarnShowed||(console.warn(`setWindowOwner(${e},${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430)`),this.setWindowOwnerwarnShowed=!0),1}stratum_saveRectArea2d(e,r,i,n,s,a,u){let c=this.scenes.get(e);if(!c)return 0;let m=c.toDataURL(n,s,a,u);if(!m)return 0;let d=document.createElement("a");return d.setAttribute("href",m),d.setAttribute("download",r),d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),1}stratum_getSpaceOrg2dx(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.originX():0}stratum_getSpaceOrg2dy(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.originY():0}stratum_setSpaceOrg2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setOrigin(r,i):0}stratum_getScaleSpace2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.scale():0}stratum_setScaleSpace2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.setScale(r):0}stratum_getBkBrush2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.brushHandle():0}stratum_setBkBrush2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.setBrush(r):0}stratum_lockSpace2d(e,r){return this.lockSpace2dWarnShowed||(console.warn(`LockSpace2d(${e}, ${r}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.lockSpace2dWarnShowed=!0),0}stratum_getToolRef2d(e,r,i){var s,a,u,c,m,d,S,f,y,g,R,O,M,F;if(!this.scenes.get(e))return 0;switch(r){case v.PEN2D:return(a=(s=this.getTPen(e,i))==null?void 0:s.subCount())!=null?a:0;case v.BRUSH2D:return(c=(u=this.getTBrush(e,i))==null?void 0:u.subCount())!=null?c:0;case v.DIB2D:return(d=(m=this.getTDIB(e,i))==null?void 0:m.subCount())!=null?d:0;case v.DOUBLEDIB2D:return(f=(S=this.getTDDoubleDIB(e,i))==null?void 0:S.subCount())!=null?f:0;case v.TEXT2D:return(g=(y=this.getTText(e,i))==null?void 0:y.subCount())!=null?g:0;case v.STRING2D:return(O=(R=this.getTString(e,i))==null?void 0:R.subCount())!=null?O:0;case v.FONT2D:return(F=(M=this.getTFont(e,i))==null?void 0:M.subCount())!=null?F:0;case v.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_deleteTool2d(e,r,i){let n=this.scenes.get(e);if(!n)return 0;switch(r){case v.PEN2D:return n.pens.delete(i)?1:0;case v.BRUSH2D:return n.brushes.delete(i)?1:0;case v.DIB2D:return n.dibs.delete(i)?1:0;case v.DOUBLEDIB2D:return n.doubleDibs.delete(i)?1:0;case v.TEXT2D:return n.texts.delete(i)?1:0;case v.STRING2D:return n.strings.delete(i)?1:0;case v.FONT2D:return n.fonts.delete(i)?1:0;case v.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_createPen2d(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createPenTool(r,i,n,s):0}stratum_getPenColor2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.color():0}stratum_getPenRop2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.rop():0}stratum_getPenStyle2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.style():0}stratum_getPenWidth2d(e,r){let i=this.getTPen(e,r);return typeof i!="undefined"?i.width():0}stratum_setPenColor2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setColor(i):0}stratum_setPenRop2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setRop(i):0}stratum_setPenStyle2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_setPenWidth2d(e,r,i){let n=this.getTPen(e,r);return typeof n!="undefined"?n.setWidth(i):0}stratum_createBrush2d(e,r,i,n,s,a){let u=this.scenes.get(e);return typeof u!="undefined"?u.createBrushTool(r,i,n,s,a):0}stratum_getBrushColor2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.color():0}stratum_getBrushRop2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.rop():0}stratum_getBrushStyle2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.style():0}stratum_getBrushHatch2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.hatch():0}stratum_getBrushDib2d(e,r){let i=this.getTBrush(e,r);return typeof i!="undefined"?i.dibHandle():0}stratum_setBrushColor2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setColor(i):0}stratum_setBrushRop2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setRop(i):0}stratum_setBrushStyle2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_setBrushHatch2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setHatch(i):0}stratum_setBrushDib2d(e,r,i){let n=this.getTBrush(e,r);return typeof n!="undefined"?n.setDIB(i):0}stratum_createFont2D(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createFontTool(r,i,n):0}stratum_createFont2Dpt(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createFontTool(r,i,n):0}stratum_getFontName2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.name():""}stratum_getFontSize2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.size():0}stratum_getFontStyle2d(e,r){let i=this.getTFont(e,r);return typeof i!="undefined"?i.style():0}stratum_setFontName2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setName(i):0}stratum_setFontSize2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setSize(i):0}stratum_setFontStyle2d(e,r,i){let n=this.getTFont(e,r);return typeof n!="undefined"?n.setStyle(i):0}stratum_createString2D(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.createStringTool(r):0}stratum_getstring2d(e,r){let i=this.getTString(e,r);return typeof i!="undefined"?i.text():""}stratum_setString2d(e,r,i){let n=this.getTString(e,r);return typeof n!="undefined"?n.setText(i):0}stratum_createText2D(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createTextTool(r,i,n,s):0}stratum_createRasterText2D(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createText(i,n,s,r):0}stratum_getTextObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.textToolHandle():0}stratum_getTextCount2d(e,r){let i=this.getTText(e,r);return typeof i!="undefined"?i.textCount():0}stratum_getTextFont2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.fontHandle(i):0}stratum_getTextString2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.stringHandle(i):0}stratum_getTextFgColor2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.fgColor(i):0}stratum_getTextBkColor2d(e,r,i=0){let n=this.getTText(e,r);return typeof n!="undefined"?n.bgColor(i):0}stratum_setText2D(e,r,i,n,s,a,u){let c=this.getTText(e,r);if(typeof c=="undefined")return 0;let m=typeof u!="undefined"?i:0,d=typeof u!="undefined"?n:i,S=typeof u!="undefined"?s:n,f=typeof u!="undefined"?a:s,y=typeof u!="undefined"?u:a;return c.setValues(m,d,S,f,y)}stratum_setTextFgColor2d(e,r,i,n){let s=this.getTText(e,r);return typeof s!="undefined"?s.setFgColor(i,n):0}stratum_setTextBkColor2d(e,r,i,n){let s=this.getTText(e,r);return typeof s!="undefined"?s.setBgColor(i,n):0}stratum_setTextFont2d(e,r,i,n){let s=this.getTText(e,r);return typeof s!="undefined"?s.setFont(i,n):0}stratum_setTextString2d(e,r,i,n){let s=this.getTText(e,r);return typeof s!="undefined"?s.setString(i,n):0}stratum_getDibPixel2D(e,r,i,n){let s=this.getTDIB(e,r);return typeof s!="undefined"?s.getPixel(i,n):0}stratum_setDibPixel2D(e,r,i,n,s){let a=this.getTDIB(e,r);return typeof a!="undefined"?a.setPixel(i,n,s):0}stratum_createBitmap2d(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(i,n,r,!1):0}stratum_createDoubleBitmap2D(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createBitmap(i,n,r,!0):0}stratum_setBitmapSrcRect2d(e,r,i,n,s,a){let u=this.getObject(e,r);return typeof u!="undefined"?u.setBitmapRect(i,n,s,a):0}stratum_getDibObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.dibHandle():0}stratum_getDDibObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.doubleDIBHandle():0}stratum_rgbEx(e,r,i,n){return ze(e,r,i,n)}stratum_rgb(e,r,i){return ze(e,r,i,0)}stratum_getRValue(e){return pt(e)}stratum_getGValue(e){return dt(e)}stratum_getBValue(e){return ft(e)}stratum_copyToClipboard2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.copy(r):0}stratum_pasteFromClipboard2d(e,r,i,n){let s=this.scenes.get(e);return typeof s!="undefined"?s.paste(r,i,n):0}stratum_getNextObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.next(r):0}stratum_deleteObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.deleteObject(r):0}stratum_getObjectName2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectName(r):""}stratum_setObjectName2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setObjectName(r,i):0}stratum_getObject2dByName(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.getObject2dByName(r,i):0}stratum_getObjectType2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.type:0}stratum_setObjectOrg2d(e,r,i,n){let s=this.getObject(e,r);return typeof s!="undefined"?s.setOrigin(i,n):0}stratum_getObjectOrg2dx(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.originX():0}stratum_getObjectOrg2dy(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.originY():0}stratum_setObjectSize2d(e,r,i,n){let s=this.getObject(e,r);return typeof s!="undefined"?s.setSize(i,n):0}stratum_getObjectWidth2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.width():0}stratum_getObjectHeight2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.height():0}stratum_getActualHeight2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.actualHeight():0}stratum_getActualWidth2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.actualWidth():0}stratum_getObjectAngle2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.angle():0}stratum_rotateObject2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.rotate(i,n,s):0}stratum_setShowObject2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.setVisibility(i!==0):0}stratum_showObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.setVisibility(!0):0}stratum_hideObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.setVisibility(!1):0}stratum_getObjectFromPoint2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.getObjectFromPoint2d(r,i,!0):0}stratum_getLastPrimary2d(){return X.lastPrimary()}stratum_getBottomObject2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.bottomObjectHandle():0}stratum_getUpperObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.upperObjectHandle(r):0}stratum_getObjectFromZOrder2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectFromZOrder(r):0}stratum_getLowerObject2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.lowerObjectHandle(r):0}stratum_getTopObject2d(e){let r=this.scenes.get(e);return typeof r!="undefined"?r.topObjectHandle():0}stratum_getZOrder2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectZOrder(r):0}stratum_objectToBottom2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectToBottom(r):0}stratum_objectToTop2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.objectToTop(r):0}stratum_setZOrder2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.setObjectZOrder(r,i):0}stratum_swapObject2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.swapObjects(r,i):0}stratum_createPolyLine2d(e,r,i,...n){let s=this.scenes.get(e);return typeof s!="undefined"?s.createLine(n,r,i):0}stratum_createLine2d(e,r,i,n,s){let a=this.scenes.get(e);return typeof a!="undefined"?a.createLine([n,s],r,i):0}stratum_addPoint2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.addPoint(i,n,s):0}stratum_delpoint2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.deletePoint(i):0}stratum_getPenObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.penHandle():0}stratum_getBrushObject2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.brushHandle():0}stratum_getVectorNumPoints2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.pointCount():0}stratum_getVectorPoint2dx(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.pointOriginX(i):0}stratum_getVectorPoint2dy(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.pointOriginY(i):0}stratum_setVectorPoint2d(e,r,i,n,s){let a=this.getObject(e,r);return typeof a!="undefined"?a.setPointOrigin(i,n,s):0}stratum_createGroup2d(e,...r){let i=this.scenes.get(e);return typeof i!="undefined"?i.createGroup(r):0}stratum_deleteGroup2d(e,r){let i=this.scenes.get(e);return typeof i!="undefined"?i.deleteGroup2d(r):0}stratum_addGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.addItem(i):0}stratum_delGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.deleteItem(i):0}stratum_getGroupItemsNum2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.itemCount():0}stratum_getGroupItem2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.itemHandle(i):0}stratum_getObjectParent2d(e,r){let i=this.getObject(e,r);return typeof i!="undefined"?i.parentHandle():0}stratum_isObjectsIntersect2d(e,r,i){let n=this.scenes.get(e);return typeof n!="undefined"?n.isIntersect(r,i):0}stratum_createControlObject2d(e,r,i,n,s,a,u,c){let m=this.scenes.get(e);return typeof m!="undefined"?m.createControl(s,a,u,c,r,i,n):0}stratum_setControlFont2d(e,r,i){var n,s;return(s=(n=this.getObject(e,r))==null?void 0:n.setControlFont(i))!=null?s:0}stratum_getControlText2d(e,r,i,n){let s=this.getObject(e,r);return typeof s=="undefined"?"":typeof i=="undefined"||typeof n=="undefined"?s.controlText():s.controlText().slice(i,i+n)}stratum_setControlText2d(e,r,i){let n=this.getObject(e,r);return typeof n!="undefined"?n.setControlText(i):0}stratum_getObjectClass(e,r){let i=this.classes.get(e);if(!i)return"";let n=i.children.find(s=>s.handle===r);return n?n.classname:""}stratum_getLink(e,r,i){var a;let n=this.classes.get(e);if(!n)return 0;let s=n.links.find(u=>u.handle1===r&&u.handle2===i||u.handle1===i&&u.handle2===r);return(a=s==null?void 0:s.handle)!=null?a:0}stratum_getObjectCount(e){var r,i;return(i=(r=this.classes.get(e))==null?void 0:r.children.length)!=null?i:0}stratum_setModelText(e,r,i){let n=this.streams.get(r);if(!n)return 0;let s=this.classes.get(e);return s?(s.setCode(n.text()),1):0}stratum_getVarCount(e){var r,i;return(i=(r=this.classes.get(e))==null?void 0:r.vars().count())!=null?i:0}stratum_getHObjectByNum(e,r){var n;if(r<0)return 0;let i=(n=this.classes.get(e))==null?void 0:n.children;return!i||r>i.length-1?0:i[r].handle}stratum_quit(e){e<=0||(this._shouldQuit=!0)}stratum_addSlash(e){return e.length===0||e[e.length-1]==="\\"?e:e+"\\"}stratum_getClassDirectory(e){let r=this.classes.getPath(e);return r?Bi(r):""}stratum_closeClassScheme(){return 1}stratum_getWindowsDirectory(){return"C:\\Windows"}stratum_MCISendString(){return v.MCIERR_INVALID_DEVICE_NAME}stratum_MCISendStringStr(){return""}stratum_ascii(e){if(e.length===0)return 0;let r=Ie.indexOf(e[0]);return r<0?0:r}stratum_chr(e){return e<0||e>255?"":Ie[e]}stratum_async_closeStream(e){let r=this.streams.get(e);if(!r)return 0;this.streams.delete(e);let i=r.close();return i instanceof Promise?i.then(n=>n?1:0):i?1:0}stratum_seek(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.seek(r))!=null?n:0}stratum_eof(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.eof())!=null?i:0}stratum_getPos(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.pos())!=null?i:0}stratum_getSize(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.size())!=null?i:0}stratum_setWidth(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.setWidth(r))!=null?n:0}stratum_read(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.widthNumber())!=null?i:0}stratum_readLn(e){var r,i;return(i=(r=this.streams.get(e))==null?void 0:r.line())!=null?i:""}stratum_write(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.writeWidthNumber(r))!=null?n:0}stratum_writeLn(e,r){var i,n;return(n=(i=this.streams.get(e))==null?void 0:i.writeLine(r))!=null?n:0}stratum_copyBlock(e,r,i,n){let s=this.streams.get(e);if(!s)return 0;let a=this.streams.get(r);return a?s.copyTo(a,i,n):0}stratum_mCreate(e,r,i,n,s,a){if(a<=0)return 0;let u=i-r+1,c=s-n+1;if(u<=0||c<=0)return 0;let m=e===0?P.getFreeNegativeHandle(this.matrices):e;return this.matrices.set(m,new Bt({rows:u,cols:c,minX:r,minY:n})),m}stratum_mDelete(e,r){return r<=0?0:this.matrices.delete(e)?1:0}stratum_mFill(e,r,i){var n,s;return i<=0?0:(s=(n=this.matrices.get(e))==null?void 0:n.fill(r))!=null?s:0}stratum_mGet(e,r,i,n){var s,a;return n<=0?0:(a=(s=this.matrices.get(e))==null?void 0:s.get(r,i))!=null?a:0}stratum_mPut(e,r,i,n,s){var a,u;return s<=0?0:(u=(a=this.matrices.get(e))==null?void 0:a.set(r,i,n))!=null?u:0}stratum_async_mEditor(e,r){if(r<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}stratum_new(){let e=P.getFreeHandle(this.arrays);return this.arrays.set(e,new Zt),e}stratum_delete(e){this.arrays.delete(e)}stratum_vGetCount(e){var r,i;return(i=(r=this.arrays.get(e))==null?void 0:r.count())!=null?i:0}stratum_vGetType(e,r){var i,n;return(n=(i=this.arrays.get(e))==null?void 0:i.type(r))!=null?n:""}stratum_vInsert(e,r){let i=this.arrays.get(e);if(!i)return 0;let n=r.toUpperCase();if(n==="STRING"||n==="FLOAT"||n==="HANDLE")return i.insert(n);let s=this.classes.get(r);if(!(s==null?void 0:s.isStruct))return 0;let a=s.vars().toArray().map(u=>[u.name,u.type]);return i.insertClass(a)}stratum_vDelete(e,r){var i,n;return(n=(i=this.arrays.get(e))==null?void 0:i.remove(r))!=null?n:0}stratum_vClearAll(){return this.arrays.clear(),1}stratum_vGetS(e,r,i){var n,s;return(s=(n=this.arrays.get(e))==null?void 0:n.getString(r,i))!=null?s:""}stratum_vGetH(e,r,i){var n,s;return(s=(n=this.arrays.get(e))==null?void 0:n.getHandle(r,i))!=null?s:0}stratum_vGetF(e,r,i){var n,s;return(s=(n=this.arrays.get(e))==null?void 0:n.getFloat(r,i))!=null?s:0}stratum_vSet(e,r,i,n){var s;(s=this.arrays.get(e))==null||s.set(r,i,n)}stratum_vSort(e,...r){let i=this.arrays.get(e);if(!i)return 0;if(r.length===0)return i.sort();if(typeof r[0]=="number"){let s=!!r[0],a=r.length>1?r[1]:"";return i.sort([{desc:s,field:a}])}let n=[];for(let s=0;s<r.length;s+=2){let a=r[s],u=!!r[s+1];n.push({desc:u,field:a})}return i.sort(n)}},Le=tt;Le.startupTime=new Date().getTime();Ee(Le,"env");var Fi=class{constructor(e,r,{title:i,popup:n}){this.root=e;this.view=r;this.origTitle=document.title,!n&&i&&(document.title=this.origTitle?`${this.origTitle} - ${i}`:i),this.popup=n,e.appendChild(r)}moveTo(e,r){!this.popup||(this.view.style.setProperty("left",e+"px"),this.view.style.setProperty("top",r+"px"))}setTitle(e){document.title=e}setVisibility(e){this.view.style.setProperty("display",e?"block":"none")}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},Nt=class{constructor(e,{title:r}){this.wnd=e;this.handlers=new Set;this.sizedOnce=!1;r&&(e.document.title=r)}subwindow(e,r){let i=window.open("about:blank",void 0,`width=${window.innerWidth/1.5},height=${window.innerHeight/1.5}`);if(!i)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${r.title}`);return i.document.body.appendChild(e),new Nt(i,r)}on(e,r){e==="closed"&&(this.wnd.addEventListener("beforeunload",r),this.handlers.add(r))}off(e,r){e==="closed"&&(r?(this.wnd.removeEventListener("beforeunload",r),this.handlers.delete(r)):(this.handlers.forEach(i=>this.wnd.removeEventListener("beforeunload",i)),this.handlers.clear()))}setTitle(e){this.wnd.document.title=e}resizeTo(e,r){if(this.sizedOnce===!0)return;let{wnd:i}=this;i.addEventListener("resize",()=>i.resizeTo(e+i.outerWidth-i.innerWidth,r+i.outerHeight-i.innerHeight),{once:!0}),this.sizedOnce=!0}close(){this.off("closed"),this.wnd.close()}},Pt=class{constructor(e){this.root=e;e==null||e.style.setProperty("position","relative")}get width(){return window.innerWidth}get height(){return window.innerHeight}window(e,r){var n,s,a,u;if(r.popup){let c=Math.max((s=(n=r.position)==null?void 0:n.x)!=null?s:0,0),m=Math.max((u=(a=r.position)==null?void 0:a.y)!=null?u:0,0);e.style.setProperty("position","absolute"),e.style.setProperty("left",c+"px"),e.style.setProperty("top",m+"px"),e.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)"),e.style.setProperty("opacity","0"),e.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>e.style.setProperty("opacity","1"))}else e.style.setProperty("opacity","0"),e.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>e.style.setProperty("opacity","1")),e.setAttribute("class","stratum-window");if(this.root)return new Fi(this.root,e,r);let i=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!i)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${r.title}`);return i.document.body.style.setProperty("margin","0px"),i.document.body.appendChild(e),new Nt(i,r)}};var Xe=class{constructor(e){this._state="closed";this._diag={iterations:0,missingCommands:[]};this.computer=new $e;this.handlers={closed:new Set,error:new Set,shell:new Set};this.envArgs=e,this.host=new Pt,this.env=null,this.options={},this.loop=null}static create(e,r){return Y(this,null,function*(){let i=yield Le.loadProject(e,r);return new Xe(i)})}speed(e,r){let i=e==="smooth"?new $e:new Lt(r),n=this.computer;return n.running&&(n.stop(),this.loop&&i.run(this.loop)),this.computer=i,this}get state(){return this._state}get diag(){return this._diag}play(e){if(this.loop)return this;e&&(this.host=e instanceof HTMLElement?new Pt(e):e);let r=this.env=new Le(this.envArgs,this.host,this.handlers);this._diag.iterations=0;let i=!0;return this.loop=()=>i?(r.isWaiting()||r.compute().then(n=>{++this._diag.iterations,n&&(this.loop=null,this.env=null,this._state="closed",this.handlers.closed.forEach(s=>s())),i=!n}).catch(n=>{i=!1,this._state="error",console.error(n),this.handlers.error.forEach(s=>s(n.message))}),!0):!1,this.computer.run(this.loop),this._state="playing",this}close(){var e,r;return this._state==="error"?((e=this.env)==null||e.closeAllRes().then(()=>{this.loop=null,this._state="closed"}),this.env=null,this):((r=this.env)==null||r.requestStop(),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,r){return this.handlers[e].add(r),this}off(e,r){return r?this.handlers[e].delete(r):this.handlers[e].clear(),this}};var Li;window.stratum=(Li=window.stratum)!=null?Li:{};window.stratum.player=Xe.create;window.stratum.options=K;window.stratum.version="0.10.6";})();
