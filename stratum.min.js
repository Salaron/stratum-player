(()=>{var Na=Object.create,ht=Object.defineProperty,Fa=Object.getPrototypeOf,as=Object.prototype.hasOwnProperty,La=Object.getOwnPropertyNames,Va=Object.getOwnPropertyDescriptor,ls=Object.getOwnPropertySymbols,ka=Object.prototype.propertyIsEnumerable,us=Math.pow,cs=(e,t,s)=>t in e?ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,F=(e,t)=>{for(var s in t||(t={}))as.call(t,s)&&cs(e,s,t[s]);if(ls)for(var s of ls(t))ka.call(t,s)&&cs(e,s,t[s]);return e},$a=e=>ht(e,"__esModule",{value:!0});var Ca=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ua=(e,t,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of La(t))!as.call(e,r)&&r!=="default"&&ht(e,r,{get:()=>t[r],enumerable:!(s=Va(t,r))||s.enumerable});return e},Wa=e=>Ua($a(ht(e!=null?Na(Fa(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var j=(e,t,s)=>new Promise((r,i)=>{var n=u=>{try{a(s.next(u))}catch(h){i(h)}},o=u=>{try{a(s.throw(u))}catch(h){i(h)}},a=u=>u.done?r(u.value):Promise.resolve(u.value).then(n,o);a((s=s.apply(e,t)).next())});var Fs=Ca((iu,Ns)=>{Ns.exports=function(){"use strict";function e(r,i){function n(){this.constructor=r}n.prototype=i.prototype,r.prototype=new n}function t(r,i,n,o){this.message=r,this.expected=i,this.found=n,this.location=o,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,t)}e(t,Error),t.buildMessage=function(r,i){var n={literal:function(_){return'"'+a(_.text)+'"'},class:function(_){var d="",g;for(g=0;g<_.parts.length;g++)d+=_.parts[g]instanceof Array?u(_.parts[g][0])+"-"+u(_.parts[g][1]):u(_.parts[g]);return"["+(_.inverted?"^":"")+d+"]"},any:function(_){return"any character"},end:function(_){return"end of input"},other:function(_){return _.description}};function o(_){return _.charCodeAt(0).toString(16).toUpperCase()}function a(_){return _.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d)})}function u(_){return _.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d)})}function h(_){return n[_.type](_)}function p(_){var d=new Array(_.length),g,v;for(g=0;g<_.length;g++)d[g]=h(_[g]);if(d.sort(),d.length>0){for(g=1,v=1;g<d.length;g++)d[g-1]!==d[g]&&(d[v]=d[g],v++);d.length=v}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function T(_){return _?'"'+a(_)+'"':"end of input"}return"Expected "+p(r)+" but "+T(i)+" found."};function s(r,i){i=i!==void 0?i:{};var n={},o={Code:rs},a=rs,u=function(l){return l},h=function(l){return l.filter(c=>c)},p=U("variable name"),T=function(l){return{type:"var",name:l}},_=",",d=P(",",!1),g=function(l){return l},v=U("function call"),D="(",M=P("(",!1),k=")",W=P(")",!1),Q=function(l,c){return{type:"call",name:l,args:c}},ye="-",fe=P("-",!1),Y="!",re=P("!",!1),st=U("!<operand> or -<operand>"),yn=function(l,c){return{type:l,op:c}},vn=U("(<expression>)"),In=function(l){return{type:"subexpr",expr:l}},xn=U("operand"),Dn="~",An=P("~",!1),Rn=function(l,c){return F(F({},c),{isNew:!!l})},Pn="^",On=P("^",!1),Mn=function(){return"**"},Bn="*",Nn=P("*",!1),Fn="/",Ln=P("/",!1),Vn="%",kn=P("%",!1),$n="+",Cn=P("+",!1),Ar=">=",Un=P(">=",!1),Wn=">",Hn=P(">",!1),Rr="<=",Gn=P("<=",!1),jn="<",Xn=P("<",!1),Pr="==",Yn=P("==",!1),Or="!=",Kn=P("!=",!1),Mr="&&",zn=P("&&",!1),Zn="&",qn=P("&",!1),Br="||",Qn=P("||",!1),Jn="|",ei=P("|",!1),ti=U("expression"),Nr=function(l,c,b){return{action:c,operand:b}},ri=function(l,c){return{first:l,rest:c}},Fr=function(l,c){return c},si=function(l,c){return[l].concat(c)},Lr=function(l,c){return c},ni=function(l,c,b){return{type:"varsDec",datatype:l,modifiers:c,names:b}},ii=U("assigment operator"),Vr=":=",oi=P(":=",!1),kr="::=",ai=P("::=",!1),li=function(l,c,b){return{type:c,to:l,expr:b}},ui=U("equality operator"),ci="=",mi=P("=",!1),hi=function(l,c,b){return{type:c,first:l,second:b}},pi=U("function call chain"),$r=function(l,c){return c},fi=function(l,c){return{type:"callChain",functions:[l].concat(c)}},Cr=U("( <expression> )"),Ur=function(l){return l},bi=U("if(<condition>)"),gi="if",di=P("if",!0),_i=function(l){return{type:"if",expr:l}},Ti=U("while(<condition>)"),Si="while",Ei=P("while",!0),wi=function(l){return{type:"while",expr:l}},yi=U("until(<condition>)"),vi="until",Ii=P("until",!0),xi=function(l){return{type:"until",expr:l}},Di=U("case(<condition>)"),Ai="case",Ri=P("case",!0),Pi=function(l,c){return{type:"case",expr:l,then:c}},Oi="else",Mi=P("else",!0),Bi=function(l){return{type:"else",then:l}},Ni="endif",Fi=P("endif",!0),Li=function(l){return{type:"endif",then:l}},Vi="break",ki=P("break",!0),$i=function(){return{type:"break"}},Ci="endwhile",Ui=P("endwhile",!0),Wi=function(){return{type:"endwhile"}},Hi="do",Gi=P("do",!0),ji=function(){return{type:"do"}},Xi="endswitch",Yi=P("endswitch",!0),Ki=function(){return{type:"endswitch"}},zi="switch",Zi=P("switch",!0),qi=function(){return{type:"switch"}},Qi="default",Ji=P("default",!0),eo=function(l){return{type:"default",then:l}},to="function",ro=P("function",!0),so=function(){return{type:"function"}},no=U("return <var name>"),io="return",oo=P("return",!0),ao=function(l){return{type:"return",to:l}},lo="handle",uo=P("HANDLE",!0),co=function(){return"HANDLE"},mo="string",ho=P("STRING",!0),po=function(){return"STRING"},fo="float",bo=P("FLOAT",!0),go=function(){return"FLOAT"},_o="colorref",To=P("COLORREF",!0),So=function(){return"COLORREF"},Eo="integer",wo=P("INTEGER",!0),yo=function(){return"INTEGER"},vo="local",Io=P("LOCAL",!0),xo=function(){return"LOCAL"},Do="nosave",Ao=P("NOSAVE",!0),Ro=function(){return"NOSAVE"},Po="parameter",Oo=P("PARAMETER",!0),Mo=function(){return"PARAMETER"},Wr=/^[_a-z\u0430-\u044F0-9]/i,Hr=be(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),Bo=U("function name"),nt=/^[0-9]/,it=be([["0","9"]],!1,!1),No=".",Fo=P(".",!1),Lo=/^[eE]/,Vo=be(["e","E"],!1,!1),ko=/^[+\-]/,$o=be(["+","-"],!1,!1),Co=U("float"),Uo=function(l){return{type:"float",value:parseFloat(l)}},Wo=U("handle"),Ho="#",Go=P("#",!1),jo=function(l){return{type:"handle",value:l.length>0?parseInt(l):0}},Gr="'",jr=P("'",!1),Xr=/^[^']/,Yr=be(["'"],!0,!1),Kr='"',zr=P('"',!1),Zr=/^[^"]/,qr=be(['"'],!0,!1),Xo=function(l){return{type:"string",value:l[1]}},Yo=U("space or tab"),Ko=/^[ \t]/,zo=be([" ","	"],!1,!1),Zo=U("new line"),qo=`
`,Qo=P(`
`,!1),Jo=U("whitespace"),Qr=/^[ \t\n\r]/,Jr=be([" ","	",`
`,"\r"],!1,!1),m=0,R=0,ot=[{line:1,column:1}],le=0,Lt=[],S=0,at;if("startRule"in i){if(!(i.startRule in o))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');a=o[i.startRule]}function Bl(){return r.substring(R,m)}function Nl(){return Xe(R,m)}function Fl(l,c){throw c=c!==void 0?c:Xe(R,m),ts([U(l)],r.substring(R,m),c)}function Ll(l,c){throw c=c!==void 0?c:Xe(R,m),ta(l,c)}function P(l,c){return{type:"literal",text:l,ignoreCase:c}}function be(l,c,b){return{type:"class",parts:l,inverted:c,ignoreCase:b}}function Vl(){return{type:"any"}}function ea(){return{type:"end"}}function U(l){return{type:"other",description:l}}function es(l){var c=ot[l],b;if(c)return c;for(b=l-1;!ot[b];)b--;for(c=ot[b],c={line:c.line,column:c.column};b<l;)r.charCodeAt(b)===10?(c.line++,c.column=1):c.column++,b++;return ot[l]=c,c}function Xe(l,c){var b=es(l),f=es(c);return{start:{offset:l,line:b.line,column:b.column},end:{offset:c,line:f.line,column:f.column}}}function y(l){m<le||(m>le&&(le=m,Lt=[]),Lt.push(l))}function ta(l,c){return new t(l,null,null,c)}function ts(l,c,b){return new t(t.buildMessage(l,c),l,c,b)}function rs(){var l,c,b,f,E,w,O;for(l=m,c=[],b=m,f=[],E=A();E!==n;)f.push(E),E=A();if(f!==n)if(E=Vt(),E===n&&(E=null),E!==n){for(w=[],O=A();O!==n;)w.push(O),O=A();w!==n?(O=os(),O!==n?(R=b,f=u(E),b=f):(m=b,b=n)):(m=b,b=n)}else m=b,b=n;else m=b,b=n;for(;b!==n;){for(c.push(b),b=m,f=[],E=A();E!==n;)f.push(E),E=A();if(f!==n)if(E=Vt(),E===n&&(E=null),E!==n){for(w=[],O=A();O!==n;)w.push(O),O=A();w!==n?(O=os(),O!==n?(R=b,f=u(E),b=f):(m=b,b=n)):(m=b,b=n)}else m=b,b=n;else m=b,b=n}return c!==n&&(R=l,c=h(c)),l=c,l}function ra(){var l,c;return S++,l=m,c=Ie(),c!==n&&(R=l,c=T(c)),l=c,S--,l===n&&(c=n,S===0&&y(p)),l}function ss(){var l,c,b,f,E;for(l=m,c=[],b=A();b!==n;)c.push(b),b=A();if(c!==n)if(b=ve(),b!==n){for(f=[],E=A();E!==n;)f.push(E),E=A();f!==n?(r.charCodeAt(m)===44?(E=_,m++):(E=n,S===0&&y(d)),E===n&&(E=null),E!==n?(R=l,c=g(b),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n;return l}function lt(){var l,c,b,f,E,w,O,N;if(S++,l=m,c=Aa(),c!==n){for(b=[],f=A();f!==n;)b.push(f),f=A();if(b!==n)if(r.charCodeAt(m)===40?(f=D,m++):(f=n,S===0&&y(M)),f!==n){for(E=[],w=A();w!==n;)E.push(w),w=A();if(E!==n){for(w=[],O=ss();O!==n;)w.push(O),O=ss();if(w!==n){for(O=[],N=A();N!==n;)O.push(N),N=A();O!==n?(r.charCodeAt(m)===41?(N=k,m++):(N=n,S===0&&y(W)),N!==n?(R=l,c=Q(c,w),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n}else m=l,l=n}else m=l,l=n;else m=l,l=n}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(v)),l}function sa(){var l;return r.charCodeAt(m)===45?(l=ye,m++):(l=n,S===0&&y(fe)),l===n&&(r.charCodeAt(m)===33?(l=Y,m++):(l=n,S===0&&y(re))),l}function na(){var l,c,b,f;if(S++,l=m,c=sa(),c!==n){for(b=[],f=A();f!==n;)b.push(f),f=A();b!==n?(f=ut(),f!==n?(R=l,c=yn(c,f),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(st)),l}function ia(){var l,c,b,f,E,w;if(S++,l=m,r.charCodeAt(m)===40?(c=D,m++):(c=n,S===0&&y(M)),c!==n){for(b=[],f=A();f!==n;)b.push(f),f=A();if(b!==n)if(f=ve(),f!==n){for(E=[],w=A();w!==n;)E.push(w),w=A();E!==n?(r.charCodeAt(m)===41?(w=k,m++):(w=n,S===0&&y(W)),w!==n?(R=l,c=In(f),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(vn)),l}function ut(){var l,c,b,f;if(S++,l=m,r.charCodeAt(m)===126?(c=Dn,m++):(c=n,S===0&&y(An)),c===n&&(c=null),c!==n){for(b=[],f=A();f!==n;)b.push(f),f=A();b!==n?(f=na(),f===n&&(f=Oa(),f===n&&(f=Ma(),f===n&&(f=Ba(),f===n&&(f=lt(),f===n&&(f=ra(),f===n&&(f=ia())))))),f!==n?(R=l,c=Rn(c,f),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(xn)),l}function ns(){var l,c;return l=m,r.charCodeAt(m)===94?(c=Pn,m++):(c=n,S===0&&y(On)),c!==n&&(R=l,c=Mn()),l=c,l===n&&(r.charCodeAt(m)===42?(l=Bn,m++):(l=n,S===0&&y(Nn)),l===n&&(r.charCodeAt(m)===47?(l=Fn,m++):(l=n,S===0&&y(Ln)),l===n&&(r.charCodeAt(m)===37?(l=Vn,m++):(l=n,S===0&&y(kn)),l===n&&(r.charCodeAt(m)===43?(l=$n,m++):(l=n,S===0&&y(Cn)),l===n&&(r.charCodeAt(m)===45?(l=ye,m++):(l=n,S===0&&y(fe)),l===n&&(r.substr(m,2)===Ar?(l=Ar,m+=2):(l=n,S===0&&y(Un)),l===n&&(r.charCodeAt(m)===62?(l=Wn,m++):(l=n,S===0&&y(Hn)),l===n&&(r.substr(m,2)===Rr?(l=Rr,m+=2):(l=n,S===0&&y(Gn)),l===n&&(r.charCodeAt(m)===60?(l=jn,m++):(l=n,S===0&&y(Xn)),l===n&&(r.substr(m,2)===Pr?(l=Pr,m+=2):(l=n,S===0&&y(Yn)),l===n&&(r.substr(m,2)===Or?(l=Or,m+=2):(l=n,S===0&&y(Kn)),l===n&&(r.substr(m,2)===Mr?(l=Mr,m+=2):(l=n,S===0&&y(zn)),l===n&&(r.charCodeAt(m)===38?(l=Zn,m++):(l=n,S===0&&y(qn)),l===n&&(r.substr(m,2)===Br?(l=Br,m+=2):(l=n,S===0&&y(Qn)),l===n&&(r.charCodeAt(m)===124?(l=Jn,m++):(l=n,S===0&&y(ei))))))))))))))))),l}function ve(){var l,c,b,f,E,w,O,N;if(S++,l=m,c=ut(),c!==n){for(b=[],f=m,E=[],w=A();w!==n;)E.push(w),w=A();if(E!==n)if(w=ns(),w!==n){for(O=[],N=A();N!==n;)O.push(N),N=A();O!==n?(N=ut(),N!==n?(R=f,E=Nr(c,w,N),f=E):(m=f,f=n)):(m=f,f=n)}else m=f,f=n;else m=f,f=n;for(;f!==n;){for(b.push(f),f=m,E=[],w=A();w!==n;)E.push(w),w=A();if(E!==n)if(w=ns(),w!==n){for(O=[],N=A();N!==n;)O.push(N),N=A();O!==n?(N=ut(),N!==n?(R=f,E=Nr(c,w,N),f=E):(m=f,f=n)):(m=f,f=n)}else m=f,f=n;else m=f,f=n}b!==n?(R=l,c=ri(c,b),l=c):(m=l,l=n)}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(ti)),l}function oa(){var l,c,b,f,E,w,O,N;if(l=m,c=Ie(),c!==n){for(b=[],f=m,E=te(),E!==n?(r.charCodeAt(m)===44?(w=_,m++):(w=n,S===0&&y(d)),w!==n?(O=te(),O!==n?(N=Ie(),N!==n?(R=f,E=Fr(c,N),f=E):(m=f,f=n)):(m=f,f=n)):(m=f,f=n)):(m=f,f=n);f!==n;)b.push(f),f=m,E=te(),E!==n?(r.charCodeAt(m)===44?(w=_,m++):(w=n,S===0&&y(d)),w!==n?(O=te(),O!==n?(N=Ie(),N!==n?(R=f,E=Fr(c,N),f=E):(m=f,f=n)):(m=f,f=n)):(m=f,f=n)):(m=f,f=n);b!==n?(R=l,c=si(c,b),l=c):(m=l,l=n)}else m=l,l=n;return l}function aa(){var l,c,b,f,E,w,O,N,ue;if(l=m,c=Da(),c!==n){if(b=[],f=A(),f!==n)for(;f!==n;)b.push(f),f=A();else b=n;if(b!==n)if(f=te(),f!==n){if(E=[],w=m,O=is(),O!==n){if(N=[],ue=A(),ue!==n)for(;ue!==n;)N.push(ue),ue=A();else N=n;N!==n?(R=w,O=Lr(c,O),w=O):(m=w,w=n)}else m=w,w=n;for(;w!==n;)if(E.push(w),w=m,O=is(),O!==n){if(N=[],ue=A(),ue!==n)for(;ue!==n;)N.push(ue),ue=A();else N=n;N!==n?(R=w,O=Lr(c,O),w=O):(m=w,w=n)}else m=w,w=n;E!==n?(w=oa(),w!==n?(R=l,c=ni(c,E,w),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n}else m=l,l=n;return l}function la(){var l,c,b,f,E,w;if(S++,l=m,c=Ie(),c!==n)if(b=te(),b!==n)if(r.substr(m,2)===Vr?(f=Vr,m+=2):(f=n,S===0&&y(oi)),f===n&&(r.substr(m,3)===kr?(f=kr,m+=3):(f=n,S===0&&y(ai))),f!==n){for(E=[],w=A();w!==n;)E.push(w),w=A();E!==n?(w=ve(),w!==n?(R=l,c=li(c,f,w),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n;else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(ii)),l}function ua(){var l,c,b,f,E,w;if(S++,l=m,c=ve(),c!==n)if(b=te(),b!==n)if(r.charCodeAt(m)===61?(f=ci,m++):(f=n,S===0&&y(mi)),f!==n){for(E=[],w=A();w!==n;)E.push(w),w=A();E!==n?(w=ve(),w!==n?(R=l,c=hi(c,f,w),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n;else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(ui)),l}function ca(){var l,c,b,f,E,w;if(S++,l=m,c=lt(),c!==n){if(b=[],f=m,E=[],w=A(),w!==n)for(;w!==n;)E.push(w),w=A();else E=n;for(E!==n?(w=lt(),w!==n?(R=f,E=$r(c,w),f=E):(m=f,f=n)):(m=f,f=n);f!==n;){if(b.push(f),f=m,E=[],w=A(),w!==n)for(;w!==n;)E.push(w),w=A();else E=n;E!==n?(w=lt(),w!==n?(R=f,E=$r(c,w),f=E):(m=f,f=n)):(m=f,f=n)}b!==n?(R=l,c=fi(c,b),l=c):(m=l,l=n)}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(pi)),l}function ma(){var l,c,b,f,E,w;if(S++,l=m,r.charCodeAt(m)===40?(c=D,m++):(c=n,S===0&&y(M)),c!==n){for(b=[],f=A();f!==n;)b.push(f),f=A();if(b!==n)if(f=ve(),f!==n){for(E=[],w=A();w!==n;)E.push(w),w=A();E!==n?(r.charCodeAt(m)===41?(w=k,m++):(w=n,S===0&&y(W)),w!==n?(R=l,c=Ur(f),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(Cr)),l}function ha(){var l,c,b,f,E;for(S++,l=m,c=[],b=A();b!==n;)c.push(b),b=A();if(c!==n)if(b=ve(),b!==n){for(f=[],E=A();E!==n;)f.push(E),E=A();f!==n?(r.charCodeAt(m)===41?(E=k,m++):(E=n,S===0&&y(W)),E!==n?(R=l,c=Ur(b),l=c):(m=l,l=n)):(m=l,l=n)}else m=l,l=n;else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(Cr)),l}function ct(){var l;return l=ma(),l===n&&(l=ha()),l}function mt(){var l,c,b;if(l=m,c=[],b=A(),b!==n)for(;b!==n;)c.push(b),b=A();else c=n;return c!==n?(b=Vt(),b!==n?(R=l,c=g(b),l=c):(m=l,l=n)):(m=l,l=n),l}function pa(){var l,c,b,f;return S++,l=m,r.substr(m,2).toLowerCase()===gi?(c=r.substr(m,2),m+=2):(c=n,S===0&&y(di)),c!==n?(b=te(),b!==n?(f=ct(),f!==n?(R=l,c=_i(f),l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),S--,l===n&&(c=n,S===0&&y(bi)),l}function fa(){var l,c,b,f;return S++,l=m,r.substr(m,5).toLowerCase()===Si?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(Ei)),c!==n?(b=te(),b!==n?(f=ct(),f!==n?(R=l,c=wi(f),l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),S--,l===n&&(c=n,S===0&&y(Ti)),l}function ba(){var l,c,b,f;return S++,l=m,r.substr(m,5).toLowerCase()===vi?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(Ii)),c!==n?(b=te(),b!==n?(f=ct(),f!==n?(R=l,c=xi(f),l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),S--,l===n&&(c=n,S===0&&y(yi)),l}function ga(){var l,c,b,f,E;return S++,l=m,r.substr(m,4).toLowerCase()===Ai?(c=r.substr(m,4),m+=4):(c=n,S===0&&y(Ri)),c!==n?(b=te(),b!==n?(f=ct(),f!==n?(E=mt(),E===n&&(E=null),E!==n?(R=l,c=Pi(f,E),l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),S--,l===n&&(c=n,S===0&&y(Di)),l}function da(){var l,c,b;return l=m,r.substr(m,4).toLowerCase()===Oi?(c=r.substr(m,4),m+=4):(c=n,S===0&&y(Mi)),c!==n?(b=mt(),b===n&&(b=null),b!==n?(R=l,c=Bi(b),l=c):(m=l,l=n)):(m=l,l=n),l}function _a(){var l,c,b;return l=m,r.substr(m,5).toLowerCase()===Ni?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(Fi)),c!==n?(b=mt(),b===n&&(b=null),b!==n?(R=l,c=Li(b),l=c):(m=l,l=n)):(m=l,l=n),l}function Ta(){var l,c;return l=m,r.substr(m,5).toLowerCase()===Vi?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(ki)),c!==n&&(R=l,c=$i()),l=c,l}function Sa(){var l,c;return l=m,r.substr(m,8).toLowerCase()===Ci?(c=r.substr(m,8),m+=8):(c=n,S===0&&y(Ui)),c!==n&&(R=l,c=Wi()),l=c,l}function Ea(){var l,c;return l=m,r.substr(m,2).toLowerCase()===Hi?(c=r.substr(m,2),m+=2):(c=n,S===0&&y(Gi)),c!==n&&(R=l,c=ji()),l=c,l}function wa(){var l,c;return l=m,r.substr(m,9).toLowerCase()===Xi?(c=r.substr(m,9),m+=9):(c=n,S===0&&y(Yi)),c!==n&&(R=l,c=Ki()),l=c,l}function ya(){var l,c;return l=m,r.substr(m,6).toLowerCase()===zi?(c=r.substr(m,6),m+=6):(c=n,S===0&&y(Zi)),c!==n&&(R=l,c=qi()),l=c,l}function va(){var l,c,b;return l=m,r.substr(m,7).toLowerCase()===Qi?(c=r.substr(m,7),m+=7):(c=n,S===0&&y(Ji)),c!==n?(b=mt(),b===n&&(b=null),b!==n?(R=l,c=eo(b),l=c):(m=l,l=n)):(m=l,l=n),l}function Ia(){var l,c;return l=m,r.substr(m,8).toLowerCase()===to?(c=r.substr(m,8),m+=8):(c=n,S===0&&y(ro)),c!==n&&(R=l,c=so()),l=c,l}function xa(){var l,c,b,f;return S++,l=m,r.substr(m,6).toLowerCase()===io?(c=r.substr(m,6),m+=6):(c=n,S===0&&y(oo)),c!==n?(b=te(),b!==n?(f=Ie(),f!==n?(R=l,c=ao(f),l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),S--,l===n&&(c=n,S===0&&y(no)),l}function Vt(){var l;return l=aa(),l===n&&(l=la(),l===n&&(l=ua(),l===n&&(l=pa(),l===n&&(l=da(),l===n&&(l=_a(),l===n&&(l=Ta(),l===n&&(l=fa(),l===n&&(l=Sa(),l===n&&(l=Ea(),l===n&&(l=ba(),l===n&&(l=wa(),l===n&&(l=ya(),l===n&&(l=ga(),l===n&&(l=va(),l===n&&(l=ca(),l===n&&(l=Ia(),l===n&&(l=xa()))))))))))))))))),l}function Da(){var l,c;return l=m,r.substr(m,6).toLowerCase()===lo?(c=r.substr(m,6),m+=6):(c=n,S===0&&y(uo)),c!==n&&(R=l,c=co()),l=c,l===n&&(l=m,r.substr(m,6).toLowerCase()===mo?(c=r.substr(m,6),m+=6):(c=n,S===0&&y(ho)),c!==n&&(R=l,c=po()),l=c,l===n&&(l=m,r.substr(m,5).toLowerCase()===fo?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(bo)),c!==n&&(R=l,c=go()),l=c,l===n&&(l=m,r.substr(m,8).toLowerCase()===_o?(c=r.substr(m,8),m+=8):(c=n,S===0&&y(To)),c!==n&&(R=l,c=So()),l=c,l===n&&(l=m,r.substr(m,7).toLowerCase()===Eo?(c=r.substr(m,7),m+=7):(c=n,S===0&&y(wo)),c!==n&&(R=l,c=yo()),l=c)))),l}function is(){var l,c;return l=m,r.substr(m,5).toLowerCase()===vo?(c=r.substr(m,5),m+=5):(c=n,S===0&&y(Io)),c!==n&&(R=l,c=xo()),l=c,l===n&&(l=m,r.substr(m,6).toLowerCase()===Do?(c=r.substr(m,6),m+=6):(c=n,S===0&&y(Ao)),c!==n&&(R=l,c=Ro()),l=c,l===n&&(l=m,r.substr(m,9).toLowerCase()===Po?(c=r.substr(m,9),m+=9):(c=n,S===0&&y(Oo)),c!==n&&(R=l,c=Mo()),l=c)),l}function Ie(){var l,c,b;if(S++,l=m,c=[],Wr.test(r.charAt(m))?(b=r.charAt(m),m++):(b=n,S===0&&y(Hr)),b!==n)for(;b!==n;)c.push(b),Wr.test(r.charAt(m))?(b=r.charAt(m),m++):(b=n,S===0&&y(Hr));else c=n;return c!==n?l=r.substring(l,m):l=c,S--,l===n&&(c=n,S===0&&y(p)),l}function Aa(){var l,c;return S++,l=Ie(),S--,l===n&&(c=n,S===0&&y(Bo)),l}function kt(){var l,c;if(l=[],nt.test(r.charAt(m))?(c=r.charAt(m),m++):(c=n,S===0&&y(it)),c!==n)for(;c!==n;)l.push(c),nt.test(r.charAt(m))?(c=r.charAt(m),m++):(c=n,S===0&&y(it));else l=n;return l}function Ra(){var l,c,b;return l=m,r.charCodeAt(m)===46?(c=No,m++):(c=n,S===0&&y(Fo)),c!==n?(b=kt(),b!==n?(c=[c,b],l=c):(m=l,l=n)):(m=l,l=n),l}function Pa(){var l,c,b,f;return l=m,Lo.test(r.charAt(m))?(c=r.charAt(m),m++):(c=n,S===0&&y(Vo)),c!==n?(ko.test(r.charAt(m))?(b=r.charAt(m),m++):(b=n,S===0&&y($o)),b===n&&(b=null),b!==n?(f=kt(),f!==n?(c=[c,b,f],l=c):(m=l,l=n)):(m=l,l=n)):(m=l,l=n),l}function Oa(){var l,c,b,f,E,w;return S++,l=m,c=m,b=m,f=kt(),f!==n?(E=Ra(),E===n&&(E=null),E!==n?(w=Pa(),w===n&&(w=null),w!==n?(f=[f,E,w],b=f):(m=b,b=n)):(m=b,b=n)):(m=b,b=n),b!==n?c=r.substring(c,m):c=b,c!==n&&(R=l,c=Uo(c)),l=c,S--,l===n&&(c=n,S===0&&y(Co)),l}function Ma(){var l,c,b,f,E;if(S++,l=m,r.charCodeAt(m)===35?(c=Ho,m++):(c=n,S===0&&y(Go)),c!==n){for(b=m,f=[],nt.test(r.charAt(m))?(E=r.charAt(m),m++):(E=n,S===0&&y(it));E!==n;)f.push(E),nt.test(r.charAt(m))?(E=r.charAt(m),m++):(E=n,S===0&&y(it));f!==n?b=r.substring(b,m):b=f,b!==n?(R=l,c=jo(b),l=c):(m=l,l=n)}else m=l,l=n;return S--,l===n&&(c=n,S===0&&y(Wo)),l}function Ba(){var l,c,b,f,E,w;if(l=m,c=m,r.charCodeAt(m)===39?(b=Gr,m++):(b=n,S===0&&y(jr)),b!==n){for(f=m,E=[],Xr.test(r.charAt(m))?(w=r.charAt(m),m++):(w=n,S===0&&y(Yr));w!==n;)E.push(w),Xr.test(r.charAt(m))?(w=r.charAt(m),m++):(w=n,S===0&&y(Yr));E!==n?f=r.substring(f,m):f=E,f!==n?(r.charCodeAt(m)===39?(E=Gr,m++):(E=n,S===0&&y(jr)),E!==n?(b=[b,f,E],c=b):(m=c,c=n)):(m=c,c=n)}else m=c,c=n;if(c===n)if(c=m,r.charCodeAt(m)===34?(b=Kr,m++):(b=n,S===0&&y(zr)),b!==n){for(f=m,E=[],Zr.test(r.charAt(m))?(w=r.charAt(m),m++):(w=n,S===0&&y(qr));w!==n;)E.push(w),Zr.test(r.charAt(m))?(w=r.charAt(m),m++):(w=n,S===0&&y(qr));E!==n?f=r.substring(f,m):f=E,f!==n?(r.charCodeAt(m)===34?(E=Kr,m++):(E=n,S===0&&y(zr)),E!==n?(b=[b,f,E],c=b):(m=c,c=n)):(m=c,c=n)}else m=c,c=n;return c!==n&&(R=l,c=Xo(c)),l=c,l}function A(){var l,c;return S++,Ko.test(r.charAt(m))?(l=r.charAt(m),m++):(l=n,S===0&&y(zo)),S--,l===n&&(c=n,S===0&&y(Yo)),l}function os(){var l,c;return S++,r.charCodeAt(m)===10?(l=qo,m++):(l=n,S===0&&y(Qo)),S--,l===n&&(c=n,S===0&&y(Zo)),l}function te(){var l,c;for(S++,l=[],Qr.test(r.charAt(m))?(c=r.charAt(m),m++):(c=n,S===0&&y(Jr));c!==n;)l.push(c),Qr.test(r.charAt(m))?(c=r.charAt(m),m++):(c=n,S===0&&y(Jr));return S--,l===n&&(c=n,S===0&&y(Jo)),l}if(at=a(),at!==n&&m===r.length)return at;throw at!==n&&m<r.length&&y(ea()),ts(Lt,le<r.length?r.charAt(le):null,le<r.length?Xe(le,le+1):Xe(le,le))}return{SyntaxError:t,parse:s}}()});var J={log:console.log};var Ha=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],$t=1<<24,Ct=2<<24;function ms(e){let t=e.toLowerCase().trim();if(t.startsWith("transparent"))return $t;if(t.startsWith("syscolor"))return Ct|parseInt(t.split("(")[1].split(")")[0]);if(t.startsWith("rgb")){let s=t.split("(")[1].split(")")[0].split(",").map(r=>parseInt(r));return s[0]|s[1]<<8|s[2]<<16}throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: ${e}`)}function he(e){if(e&$t)return"transparent";let t=e&255;if(e&Ct)return Ha[t]||"black";let s=e>>8&255,r=e>>16&255;return`rgb(${t},${s},${r})`}function xe(e,t,s,r){let i=r===1?$t:r===2?Ct:0;return e&255|(t&255)<<8|(s&255)<<16|i}function Ye(e){return e&255}function Ke(e){return e>>8&255}function ze(e){return e>>16&255}var x;(function(e){e[e.PI=Math.PI]="PI",e[e.WORD8=0]="WORD8",e[e.INT8=1]="INT8",e[e.WORD16=2]="WORD16",e[e.INT16=3]="INT16",e[e.WORD32=4]="WORD32",e[e.INT32=5]="INT32",e[e.FLOAT32=6]="FLOAT32",e[e.FLOAT40=7]="FLOAT40",e[e.FLOAT64=8]="FLOAT64",e[e.FLOAT80=9]="FLOAT80",e[e.PEN2D=1]="PEN2D",e[e.BRUSH2D=2]="BRUSH2D",e[e.DIB2D=3]="DIB2D",e[e.DOUBLEDIB2D=4]="DOUBLEDIB2D",e[e.FONT2D=5]="FONT2D",e[e.STRING2D=6]="STRING2D",e[e.TEXT2D=7]="TEXT2D",e[e.SPACE3D=8]="SPACE3D",e[e.TEXTURE3D=9]="TEXTURE3D",e[e.SIZE_RESTORED=0]="SIZE_RESTORED",e[e.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",e[e.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",e[e.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",e[e.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",e[e.OTGROUP2D=3]="OTGROUP2D",e[e.OTRGROUP2D=4]="OTRGROUP2D",e[e.OTGROUP3D=5]="OTGROUP3D",e[e.OTOBJECT3D=10]="OTOBJECT3D",e[e.OTLINE_2D=20]="OTLINE_2D",e[e.OTBITMAP_2D=21]="OTBITMAP_2D",e[e.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",e[e.OTTEXT_2D=23]="OTTEXT_2D",e[e.OTVIEW3D_2D=24]="OTVIEW3D_2D",e[e.OTEDITFRAME=50]="OTEDITFRAME",e[e.OTROTATECENTER=51]="OTROTATECENTER",e[e.OTFRAME3D=52]="OTFRAME3D",e[e.OTAXIS3D=53]="OTAXIS3D",e[e.OTPEN2D=101]="OTPEN2D",e[e.OTBRUSH2D=102]="OTBRUSH2D",e[e.OTDIB2D=103]="OTDIB2D",e[e.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",e[e.OTFONT2D=105]="OTFONT2D",e[e.OTSTRING2D=106]="OTSTRING2D",e[e.OTTEXT2D=107]="OTTEXT2D",e[e.OTREFTODIB2D=110]="OTREFTODIB2D",e[e.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",e[e.ATTRSET=1]="ATTRSET",e[e.ATTRRESET=2]="ATTRRESET",e[e.ATTRPUT=3]="ATTRPUT",e[e.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",e[e.PFC_SETCURRENT=16384]="PFC_SETCURRENT",e[e.PFC_SETFRAME=8192]="PFC_SETFRAME",e[e.PFC_PENS=1]="PFC_PENS",e[e.PFC_BRUHS=2]="PFC_BRUHS",e[e.PFC_DIBS=4]="PFC_DIBS",e[e.PFC_DDIBS=8]="PFC_DDIBS",e[e.PFC_STRINGS=16]="PFC_STRINGS",e[e.PFC_FONTS=32]="PFC_FONTS",e[e.PFC_TEXTS=64]="PFC_TEXTS",e[e.PFC_3D=128]="PFC_3D",e[e.PFC_ALL=255]="PFC_ALL",e[e.OID_RESERVED=32e3]="OID_RESERVED",e[e.OID_RCENTER=32001]="OID_RCENTER",e[e.OID_FRAME2D1=32002]="OID_FRAME2D1",e[e.OID_FRAME2D2=32003]="OID_FRAME2D2",e[e.OID_FRAME2D3=32004]="OID_FRAME2D3",e[e.OID_FRAME2D4=32005]="OID_FRAME2D4",e[e.OID_FRAME2D5=32006]="OID_FRAME2D5",e[e.OID_FRAME2D6=32007]="OID_FRAME2D6",e[e.OID_FRAME2D7=32008]="OID_FRAME2D7",e[e.OID_FRAME2D8=32009]="OID_FRAME2D8",e[e.OID_FRAME2D=32010]="OID_FRAME2D",e[e.OID_AXIS3D=32100]="OID_AXIS3D",e[e.OID_FRAME3D1=32102]="OID_FRAME3D1",e[e.OID_FRAME3D2=32103]="OID_FRAME3D2",e[e.OID_FRAME3D3=32104]="OID_FRAME3D3",e[e.OID_FRAME3D4=32105]="OID_FRAME3D4",e[e.OID_FRAME3D5=32106]="OID_FRAME3D5",e[e.OID_FRAME3D6=32107]="OID_FRAME3D6",e[e.OID_FRAME3D7=32108]="OID_FRAME3D7",e[e.OID_FRAME3D8=32109]="OID_FRAME3D8",e[e.OID_FRAME3D=32110]="OID_FRAME3D",e[e.MB_OK=0]="MB_OK",e[e.MB_OKCANCEL=1]="MB_OKCANCEL",e[e.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",e[e.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",e[e.MB_YESNO=4]="MB_YESNO",e[e.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",e[e.MB_TYPEMASK=15]="MB_TYPEMASK",e[e.MB_ICONHAND=16]="MB_ICONHAND",e[e.MB_ICONQUESTION=32]="MB_ICONQUESTION",e[e.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",e[e.MB_ICONASTERISK=64]="MB_ICONASTERISK",e[e.MB_ICONMASK=240]="MB_ICONMASK",e[e.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",e[e.MB_ICONSTOP=16]="MB_ICONSTOP",e[e.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",e[e.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",e[e.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",e[e.MB_DEFMASK=3840]="MB_DEFMASK",e[e.MB_APPLMODAL=0]="MB_APPLMODAL",e[e.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",e[e.MB_TASKMODAL=8192]="MB_TASKMODAL",e[e.MB_NOFOCUS=32768]="MB_NOFOCUS",e[e.SW_HIDE=0]="SW_HIDE",e[e.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",e[e.SW_NORMAL=1]="SW_NORMAL",e[e.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",e[e.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",e[e.SW_MAXIMIZE=3]="SW_MAXIMIZE",e[e.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",e[e.SW_SHOW=5]="SW_SHOW",e[e.SW_MINIMIZE=6]="SW_MINIMIZE",e[e.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",e[e.SW_SHOWNA=8]="SW_SHOWNA",e[e.SW_RESTORE=9]="SW_RESTORE",e[e.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",e[e.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",e[e.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",e[e.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",e[e.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",e[e.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",e[e.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",e[e.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",e[e.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",e[e.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",e[e.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",e[e.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",e[e.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",e[e.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",e[e.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",e[e.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",e[e.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",e[e.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",e[e.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",e[e.MCIERR_DRIVER=278]="MCIERR_DRIVER",e[e.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",e[e.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",e[e.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",e[e.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",e[e.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",e[e.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",e[e.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",e[e.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",e[e.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",e[e.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",e[e.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",e[e.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",e[e.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",e[e.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",e[e.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",e[e.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",e[e.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",e[e.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",e[e.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",e[e.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",e[e.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",e[e.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",e[e.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",e[e.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",e[e.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",e[e.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",e[e.MCIERR_GET_CD=307]="MCIERR_GET_CD",e[e.MCIERR_SET_CD=308]="MCIERR_SET_CD",e[e.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",e[e.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",e[e.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",e[e.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",e[e.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",e[e.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",e[e.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",e[e.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",e[e.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",e[e.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",e[e.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",e[e.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",e[e.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",e[e.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",e[e.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",e[e.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",e[e.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",e[e.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",e[e.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",e[e.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",e[e.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",e[e.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",e[e.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",e[e.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",e[e.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",e[e.WS_VISIBLE=268435456]="WS_VISIBLE",e[e.WS_DISABLED=134217728]="WS_DISABLED",e[e.WS_CAPTION=12582912]="WS_CAPTION",e[e.WS_BORDER=8388608]="WS_BORDER",e[e.WS_DLGFRAME=4194304]="WS_DLGFRAME",e[e.WS_VSCROLL=2097152]="WS_VSCROLL",e[e.WS_HSCROLL=1048576]="WS_HSCROLL",e[e.WS_SYSMENU=524288]="WS_SYSMENU",e[e.WS_THICKFRAME=262144]="WS_THICKFRAME",e[e.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",e[e.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",e[e.WS_GROUP=131072]="WS_GROUP",e[e.WS_TABSTOP=65536]="WS_TABSTOP",e[e.WS_OVERLAPPED=0]="WS_OVERLAPPED",e[e.WS_POPUP=2147483648]="WS_POPUP",e[e.WS_CHILD=1073741824]="WS_CHILD",e[e.IDX_PRIMARY=1]="IDX_PRIMARY",e[e.IDX_UNIQUE=2]="IDX_UNIQUE",e[e.IDX_DESCENDING=4]="IDX_DESCENDING",e[e.IDX_MAINTAINED=8]="IDX_MAINTAINED",e[e.IDX_SUBSET=16]="IDX_SUBSET",e[e.IDX_EXPR=32]="IDX_EXPR",e[e.IDX_IDXOOD=64]="IDX_IDXOOD",e[e.IDX_CASEINSENS=128]="IDX_CASEINSENS",e[e.FLDDBCHAR=513]="FLDDBCHAR",e[e.FLDDBNUM=514]="FLDDBNUM",e[e.FLDDBMEMO=515]="FLDDBMEMO",e[e.FLDDBBOOL=516]="FLDDBBOOL",e[e.FLDDBDATE=517]="FLDDBDATE",e[e.FLDDBFLOAT=518]="FLDDBFLOAT",e[e.FLDDBLOCK=519]="FLDDBLOCK",e[e.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",e[e.FLDDBBINARY=521]="FLDDBBINARY",e[e.FLDDBBYTES=522]="FLDDBBYTES",e[e.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",e[e.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",e[e.BS_CHECKBOX=2]="BS_CHECKBOX",e[e.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",e[e.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",e[e.BS_3STATE=5]="BS_3STATE",e[e.BS_AUTO3STATE=6]="BS_AUTO3STATE",e[e.BS_GROUPBOX=7]="BS_GROUPBOX",e[e.BS_USERBUTTON=8]="BS_USERBUTTON",e[e.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",e[e.BS_OWNERDRAW=11]="BS_OWNERDRAW",e[e.BS_LEFTTEXT=32]="BS_LEFTTEXT",e[e.ES_LEFT=0]="ES_LEFT",e[e.ES_CENTER=1]="ES_CENTER",e[e.ES_RIGHT=2]="ES_RIGHT",e[e.ES_MULTILINE=4]="ES_MULTILINE",e[e.ES_UPPERCASE=8]="ES_UPPERCASE",e[e.ES_LOWERCASE=16]="ES_LOWERCASE",e[e.ES_PASSWORD=32]="ES_PASSWORD",e[e.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",e[e.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",e[e.ES_NOHIDESEL=256]="ES_NOHIDESEL",e[e.SBS_HORZ=0]="SBS_HORZ",e[e.SBS_VERT=1]="SBS_VERT",e[e.SBS_TOPALIGN=2]="SBS_TOPALIGN",e[e.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",e[e.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",e[e.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",e[e.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",e[e.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",e[e.SBS_SIZEBOX=8]="SBS_SIZEBOX",e[e.LBS_NOTIFY=1]="LBS_NOTIFY",e[e.LBS_SORT=2]="LBS_SORT",e[e.LBS_NOREDRAW=4]="LBS_NOREDRAW",e[e.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",e[e.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",e[e.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",e[e.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",e[e.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",e[e.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",e[e.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",e[e.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",e[e.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",e[e.CBS_SIMPLE=1]="CBS_SIMPLE",e[e.CBS_DROPDOWN=2]="CBS_DROPDOWN",e[e.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",e[e.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",e[e.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",e[e.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",e[e.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",e[e.CBS_SORT=256]="CBS_SORT",e[e.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",e[e.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",e[e.BS_SOLID=0]="BS_SOLID",e[e.BS_NULL=1]="BS_NULL",e[e.BS_HATCHED=2]="BS_HATCHED",e[e.BS_PATTERN=3]="BS_PATTERN",e[e.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",e[e.HS_HORIZONTAL=0]="HS_HORIZONTAL",e[e.HS_VERTICAL=1]="HS_VERTICAL",e[e.HS_FDIAGONAL=2]="HS_FDIAGONAL",e[e.HS_BDIAGONAL=3]="HS_BDIAGONAL",e[e.HS_CROSS=4]="HS_CROSS",e[e.HS_DIAGCROSS=5]="HS_DIAGCROSS",e[e.PS_SOLID=0]="PS_SOLID",e[e.PS_DASH=1]="PS_DASH",e[e.PS_DOT=2]="PS_DOT",e[e.PS_DASHDOT=3]="PS_DASHDOT",e[e.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",e[e.PS_NULL=5]="PS_NULL",e[e.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",e[e.R2_BLACK=1]="R2_BLACK",e[e.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",e[e.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",e[e.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",e[e.R2_MASKPENNOT=5]="R2_MASKPENNOT",e[e.R2_NOT=6]="R2_NOT",e[e.R2_XORPEN=7]="R2_XORPEN",e[e.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",e[e.R2_MASKPEN=9]="R2_MASKPEN",e[e.R2_NOTXORPEN=10]="R2_NOTXORPEN",e[e.R2_NOP=11]="R2_NOP",e[e.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",e[e.R2_COPYPEN=13]="R2_COPYPEN",e[e.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",e[e.R2_MERGEPEN=15]="R2_MERGEPEN",e[e.R2_WHITE=16]="R2_WHITE",e[e.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",e[e.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",e[e.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",e[e.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",e[e.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",e[e.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",e[e.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",e[e.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",e[e.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.CUR_ARROW=0]="CUR_ARROW",e[e.CUR_CROSS=1]="CUR_CROSS",e[e.CUR_TEXT=2]="CUR_TEXT",e[e.CUR_NO=3]="CUR_NO",e[e.CUR_SIZE=4]="CUR_SIZE",e[e.CUR_SIZENESW=5]="CUR_SIZENESW",e[e.CUR_SIZENS=6]="CUR_SIZENS",e[e.CUR_SIZENWSE=7]="CUR_SIZENWSE",e[e.CUR_SIZEWE=8]="CUR_SIZEWE",e[e.CUR_UPARROW=9]="CUR_UPARROW",e[e.CUR_WAIT=10]="CUR_WAIT",e[e.CUR_LINK=11]="CUR_LINK",e[e.CUR_HELP=12]="CUR_HELP",e[e.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",e[e.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",e[e.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",e[e.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",e[e.FOG_NONE=0]="FOG_NONE",e[e.FOG_EXP=1]="FOG_EXP",e[e.FOG_EXP2=2]="FOG_EXP2",e[e.FOG_LINEAR=3]="FOG_LINEAR",e[e.TEX_TYPE_1D=1]="TEX_TYPE_1D",e[e.TEX_TYPE_2D=2]="TEX_TYPE_2D",e[e.TEX_TYPE_3D=3]="TEX_TYPE_3D",e[e.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",e[e.SBF_ONE=0]="SBF_ONE",e[e.SBF_ZERO=1]="SBF_ZERO",e[e.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",e[e.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",e[e.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",e[e.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",e[e.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",e[e.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",e[e.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",e[e.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",e[e.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",e[e.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",e[e.CMPF_LESS=2]="CMPF_LESS",e[e.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",e[e.CMPF_EQUAL=4]="CMPF_EQUAL",e[e.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",e[e.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",e[e.CMPF_GREATER=7]="CMPF_GREATER",e[e.CULL_NONE=1]="CULL_NONE",e[e.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",e[e.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",e[e.SO_FLAT=0]="SO_FLAT",e[e.SO_GOURAUD=1]="SO_GOURAUD",e[e.SO_PHONG=2]="SO_PHONG",e[e.PM_POINTS=1]="PM_POINTS",e[e.PM_WIREFRAME=2]="PM_WIREFRAME",e[e.PM_SOLID=3]="PM_SOLID",e[e.LT_POINT=0]="LT_POINT",e[e.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",e[e.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",e[e.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",e[e.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",e[e.OT_POINT_LIST=1]="OT_POINT_LIST",e[e.OT_LINE_LIST=2]="OT_LINE_LIST",e[e.OT_LINE_STRIP=3]="OT_LINE_STRIP",e[e.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",e[e.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",e[e.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",e[e.BBT_POINT=0]="BBT_POINT",e[e.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",e[e.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",e[e.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",e[e.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",e[e.GMM_RELATIVE=0]="GMM_RELATIVE",e[e.GMM_PIXELS=1]="GMM_PIXELS",e[e.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",e[e.GHA_LEFT=0]="GHA_LEFT",e[e.GHA_CENTER=1]="GHA_CENTER",e[e.GHA_RIGHT=2]="GHA_RIGHT",e[e.GVA_TOP=0]="GVA_TOP",e[e.GVA_CENTER=1]="GVA_CENTER",e[e.GVA_BOTTOM=2]="GVA_BOTTOM",e[e.MTHA_LEFT=0]="MTHA_LEFT",e[e.MTHA_CENTER=1]="MTHA_CENTER",e[e.MTVA_BELOW=0]="MTVA_BELOW",e[e.MTVA_ABOVE=1]="MTVA_ABOVE",e[e.MTVA_CENTER=2]="MTVA_CENTER",e[e.PT_BOOL=0]="PT_BOOL",e[e.PT_REAL=1]="PT_REAL",e[e.PT_INT=2]="PT_INT",e[e.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",e[e.PT_SHORT=4]="PT_SHORT",e[e.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",e[e.PT_LONG=6]="PT_LONG",e[e.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",e[e.PT_STRING=8]="PT_STRING",e[e.PT_VECTOR3=9]="PT_VECTOR3",e[e.PT_MATRIX3=10]="PT_MATRIX3",e[e.PT_MATRIX4=11]="PT_MATRIX4",e[e.PT_QUATERNION=12]="PT_QUATERNION",e[e.PT_COLOURVALUE=13]="PT_COLOURVALUE",e[e.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",e[e.NUI_SP_SPINE=1]="NUI_SP_SPINE",e[e.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",e[e.NUI_SP_HEAD=3]="NUI_SP_HEAD",e[e.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",e[e.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",e[e.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",e[e.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",e[e.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",e[e.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",e[e.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",e[e.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",e[e.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",e[e.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",e[e.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",e[e.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",e[e.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",e[e.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",e[e.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",e[e.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",e[e.NUI_SP_COUNT=20]="NUI_SP_COUNT",e[e.WM_DESTROY=2]="WM_DESTROY",e[e.WM_MOVE=3]="WM_MOVE",e[e.WM_SIZE=5]="WM_SIZE",e[e.WM_CLOSE=16]="WM_CLOSE",e[e.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",e[e.WM_COMMAND=273]="WM_COMMAND",e[e.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",e[e.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",e[e.WM_LBUTTONUP=514]="WM_LBUTTONUP",e[e.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",e[e.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",e[e.WM_RBUTTONUP=517]="WM_RBUTTONUP",e[e.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",e[e.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",e[e.WM_MBUTTONUP=520]="WM_MBUTTONUP",e[e.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",e[e.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",e[e.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",e[e.WM_KEYDOWN=256]="WM_KEYDOWN",e[e.WM_KEYUP=257]="WM_KEYUP",e[e.WM_CANCLOSE=1538]="WM_CANCLOSE",e[e.WM_SPACEDONE=1539]="WM_SPACEDONE",e[e.WM_SPACEINIT=1540]="WM_SPACEINIT",e[e.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",e[e.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(x||(x={}));var Fe=258;var pt="retCode",ge="model",Ze="TLB",K="mem",Le="schema",De=0,Ae="prj",se="env",ft="oldFloats",hs="newFloats",bt="oldInts",ps="newInts",gt="oldStrings",fs="newStrings",bs="call",gs="waitFor",ds="getWaitResult",_s="saveContext",Ts="loadContext",Ss="getTime",Es="getDate",ws="getActualSize2d",ys="getBitmapSrcRect2d",vs="getVarInfo",Is="getMousePos";var qe=new Map([["EXIT",{f:`return ${De}`,inline:"template"}],["FLOAT",{f:"parseFloat(#0)||0",inline:"template"}],["HANDLE",{f:"parseInt(#0)||0",inline:"template"}],["STRING",{f:"(Math.round((#0)*100000)/100000).toString()",inline:"template"}],["ABS",{f:"Math.abs(#0)||0",inline:"template"}],["AVERAGE",{f:"(#0)/2+(#1)/2",inline:"template"}],["EXP",{f:"Math.exp(#0)||0",inline:"template"}],["LG",{f:"lg",inline:"inner"}],["LN",{f:"ln",inline:"inner"}],["LOG",{f:"log",inline:"inner"}],["MAX",{f:"Math.max(#0, #1)||0",inline:"template"}],["MIN",{f:"Math.min(#0, #1)||0",inline:"template"}],["LIMIT",{f:"Math.max(#1, Math.min(#2, #0))||0",inline:"template"}],["ROUND",{f:"round",inline:"inner"}],["SQR",{f:"(#0)**2",inline:"template"}],["SQRT",{f:"Math.sqrt(#0)||0",inline:"template"}],["TRUNC",{f:"Math.trunc(#0)||0",inline:"template"}],["RND",{f:"(#0)*Math.random()",inline:"template"}],["ARCCOS",{f:"arccos",inline:"inner"}],["ARCSIN",{f:"arcsin",inline:"inner"}],["ARCTAN",{f:"Math.atan(#0)||0",inline:"template"}],["COS",{f:"Math.cos(#0)||0",inline:"template"}],["SIN",{f:"Math.sin(#0)||0",inline:"template"}],["TAN",{f:"Math.tan(#0)||0",inline:"template"}],["DEG",{f:"180*(#0)/Math.PI||0",inline:"template"}],["RAD",{f:"Math.PI*(#0)/180||0",inline:"template"}],["GETANGLEBYXY",{f:"getAngleByXY",inline:"inner"}],["AND",{f:"(#0)&&(#1)",inline:"template"}],["DELTA",{f:"(#0)?0:1",inline:"template"}],["ED",{f:"(#0)>0?1:0",inline:"template"}],["NOT",{f:"!(#0)",inline:"template"}],["NOTBIN",{f:"#0",inline:"template"}],["OR",{f:"(#0)||(#1)",inline:"template"}],["SGN",{f:"Math.sign(#0)||0",inline:"template"}],["XOR",{f:"(#0)!==0^(#1)!==0",inline:"template"}],["XORBIN",{f:"(#0)^(#1)",inline:"template"}],["ALLTRIM",{f:"(#0).trim()",inline:"template"}],["CHANGE",{f:"change",inline:"inner"}],["COMPARE",{f:"(#0)===(#1)",inline:"template"}],["COMPAREI",{f:"compareI",inline:"inner"}],["LEFT",{f:"(#0).substring(0,#1)",inline:"template"}],["LENGTH",{f:"(#0).length",inline:"template"}],["LOWER",{f:"(#0).toLowerCase()",inline:"template"}],["LTRIM",{f:'(#0).replace(/^\\s+/,"")',inline:"template"}],["POS",{f:"pos",inline:"inner"}],["REPLICATE",{f:"(#0).repeat(#1)",inline:"template"}],["SUBSTR",{f:"(#0).substr(#1,#2)",inline:"template"}],["RIGHT",{f:"right",inline:"inner"}],["RTRIM",{f:'(#0).replace(/\\s+$/,"")',inline:"template"}],["UPPER",{f:"(#0).toUpperCase()",inline:"template"}]]);function Re(e,t){let s="stratum_",r=s.length,i="async_",n=i.length;Object.getOwnPropertyNames(e.prototype).forEach(o=>{let a=e.prototype[o];if(typeof a!="function"||!a.name.startsWith(s))return;let u=o.toString().substring(r),h=u.startsWith(i);h&&(u=u.substring(n));let p=u.toUpperCase(),T={f:`${t}.${o}`,blocking:h},_=qe.size;if(qe.set(p,T),_===qe.size)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0444\u0443\u043D\u043A\u0446\u0438\u0439: ${u}`)})}var I;(function(e){e[e.Float=1]="Float",e[e.Handle=2]="Handle",e[e.String=3]="String",e[e.ColorRef=4]="ColorRef"})(I||(I={}));var Ve=class{constructor(t){this.type=t;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(t,s){if(t.type!==s.type)return!1;if(t.indexWasSet||s.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return t.connectedNodes.add(s),s.connectedNodes.add(t),!0}shareIndex(t){this.indexWasSet||(this.indexWasSet=!0,this.globalVarIdx=t,this.connectedNodes.forEach(s=>s.shareIndex(t)))}getIndex(t){if(!this.indexWasSet)switch(this.type){case I.Float:this.shareIndex(t.floatsCount++);break;case I.Handle:case I.ColorRef:this.shareIndex(t.intsCount++);break;case I.String:this.shareIndex(t.stringsCount++);break}return this.globalVarIdx}};var de="n",_e="o",H=[];H[I.Float]="F";H[I.Handle]="I";H[I.ColorRef]="I";H[I.String]="S";var xs=`
var ${Ae} = ${Le}.${Ae};
var ${se} = ${Ae}.${se};
var ${_e}${H[I.Float]} = ${K}.${ft};
var ${de}${H[I.Float]} = ${K}.${hs};
var ${_e}${H[I.Handle]} = ${K}.${bt};
var ${de}${H[I.Handle]} = ${K}.${ps};
var ${_e}${H[I.String]} = ${K}.${gt};
var ${de}${H[I.String]} = ${K}.${fs};
`,Ds=`
var ${Ae} = ${Le}.${Ae};
var ${se} = ${Ae}.${se};
var ${_e}${H[I.Float]} = ${K}.${ft};
var ${de}${H[I.Float]} = ${K}.${ft};
var ${_e}${H[I.Handle]} = ${K}.${bt};
var ${de}${H[I.Handle]} = ${K}.${bt};
var ${_e}${H[I.String]} = ${K}.${gt};
var ${de}${H[I.String]} = ${K}.${gt};
`;function As(e,t,s){let r=e.length,i=`${ge}.${ds}();`;e.push(`${ge}.${gs}(${t});`,`return -${r};`,`case -${r}:`,s?`var ${t} = ${i}`:i)}var Rs=class{get(t){return this.v.get(t.toUpperCase())}constructor(t){this.v=new Map(t==null?void 0:t.map((s,r)=>[s.name.toUpperCase(),[s,r]]))}result(){return[...this.v.values()].map(t=>t[0])}},Ps=class{constructor(t,s,r,i,n){this.res=t;this.vars=s;this.lib=r;this.missingFuncs=i;this.innerFuncs=n;this.varCount=0;this._hasBug=!1}reset(){return this.varCount=0,this}hasBug(){return this._hasBug}arr(t,s){let r=this.vars.get(s);if(!r)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${s}`);let i=H[r[0].type];return`${t?de:_e}${i}[${Ze}[${r[1]}]]`}derefer(t){if(t.first.type!=="var"||t.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let s=t.first.name,r=this.vars.get(s);if(!r)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${s}`);return[`${t.first.isNew?de:_e}${H[r[0].type]}`,`${Ze}[${r[1]}]`]}parseOperand(t){var s,r;switch(t.isNew&&t.type!=="var"&&(this._hasBug=!0),t.type){case"float":case"handle":return t.value.toString();case"string":return"`"+t.value.split("\\").join("\\\\").split("`").join("\\`")+"`";case"var":{let i=t.name.toUpperCase();return(r=(s=x[i])==null?void 0:s.toString())!=null?r:this.arr(t.isNew,i)}case"call":{let i=this.parseCall(t),n=this.put(i.f);if(i.blocking){let o=Array.from({length:this.varCount-1},(a,u)=>`t${u}`);if(o.length>0&&this.res.push(`${ge}.${_s}([${o.join(",")}]);`),As(this.res,n,!0),o.length>0){let a=`var ctx = ${ge}.${Ts}();`,u=o.map((h,p)=>`var ${h}=ctx[${p}];`).join("");this.res.push(a,u)}}return n}case"-":return`(-${this.parseOperand(t.op)})`;case"!":return`(!${this.parseOperand(t.op)})`;case"subexpr":return`(${this.parseExpr(t.expr)})`}}put(t){let s=`t${this.varCount++}`;return this.res.push(`var ${s}=${t};`),s}parseCall(t){let s=t.name.toUpperCase(),r=t.args.map(o=>this.parseExpr(o)),i=qe.get(s);if(i){if(i.inline!=="template")return i.inline==="inner"&&this.innerFuncs.add(i.f),F(F({},i),{f:`${i.f}(${r})`});let o=i.f,a=0;for(;a<r.length;){let h=o.replace(`#${a}`,r[a]);if(o===h)throw Error(`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${t.name}: ${r.length}, \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C - ${a})`);o=h,++a}let u=o;for(;(u=o.replace(`#${a}`,"undefined"))!==o;)o=u,++a;return F(F({},i),{f:o})}if(s==="INC"||s==="DEC"){let o=this.derefer(t.args[0]),a=t.args.length<2?1:this.parseExpr(t.args[1]);return{f:`${o[0]}[${o[1]}]${s==="INC"?"+":"-"}=${a}`}}if(s==="GETTIME"){let o=t.args.map(a=>this.derefer(a));return{f:`${se}.${Ss}(${o})`}}if(s==="GETDATE"){let o=t.args.map(a=>this.derefer(a));return{f:`${se}.${Es}(${o})`}}if(s==="GETACTUALSIZE2D"){let o=t.args.slice(0,2).map(u=>this.parseExpr(u)),a=t.args.slice(2).map(u=>this.derefer(u));return{f:`${se}.${ws}(${o},${a})`}}if(s==="GETVARINFO"){let o=t.args.slice(0,2).map(u=>this.parseExpr(u)),a=t.args.slice(2).map(u=>this.derefer(u));return{f:`${se}.${vs}(${o},${a})`}}if(s==="GETMOUSEPOS"){let o=this.parseExpr(t.args[0]),a=this.derefer(t.args[1]),u=this.derefer(t.args[2]);return{f:`${se}.${Is}(${o},${a},${u})`}}if(s==="GETBITMAPSRCRECT2D"){let o=t.args.slice(0,2).map(u=>this.parseExpr(u)),a=t.args.slice(2).map(u=>this.derefer(u));return{f:`${se}.${ys}(${o},${a})`}}return s==="RANDOMIZE"?{f:""}:(this.lib.hasModel(t.name)||this.missingFuncs.set(s,t.name),{f:`${ge}.${bs}(${Le}, "${t.name}"${r.length>0?","+r:""})`,blocking:!0})}parseExpr(t){let s=this.parseOperand(t.first),r=t.rest.map(i=>i.action==="/"?`/(${this.parseOperand(i.operand)} || Infinity)`:i.action+this.parseOperand(i.operand));return s+r.join("")}},Os=class{constructor(){this.bblocks=[]}pushBlock(t){return this.bblocks.push(t),t}popBlock(t){let s=this.bblocks.pop();if(!s||s.expect!==t)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${t}`);return s}lastBlock(){return this.bblocks.length>0?this.bblocks[this.bblocks.length-1]:null}getBreakID(){for(let t=this.bblocks.length-1;t>=0;--t){let s=this.bblocks[t];if(s.canBreak)return s.end}return De}},Ut=class{constructor(t,s,r){this.lib=s;this._hasEquals=!1;this._hasBug=!1;this._hasFuncDecl=!1;this.labelCnt=0;this.missingFuncs=new Map;this.res=[];this.b=new Os;this.innerFuncs=new Set;this._vars=new Rs(r),this.res=[`var code = ${pt};`,"while(true) {","switch(code) {","case 0:"];let i=new Ps(this.res,this._vars,this.lib,this.missingFuncs,this.innerFuncs);for(let o=0;o<t.length;++o)try{let a=t[o];this.parseCodeline(a,i.reset());let u=a.then;for(;u;)this.parseCodeline(u,i.reset()),u=u.then}catch(a){throw Error(a.message+" \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 "+(o+1))}this._hasBug=i.hasBug();let n=this.b.lastBlock();if(n)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${n.expect}`);this.res.push("}",`return ${De};`,"}")}comment(t){this.res.push("//"+t)}makeJump(t){return`{ code = ${t}; continue; }`}parseCodeline(t,s){switch(t.type){case":=":{this.res.push(`${s.arr(!0,t.to)} = ${s.parseExpr(t.expr)};`);break}case"callChain":{for(let i=0;i<t.functions.length;++i){let n=t.functions[i],o=s.reset().parseCall(n);o.blocking?As(this.res,o.f,!1):this.res.push(`${o.f};`)}break}case"if":{this.comment("if");let i=this.b.pushBlock({canBreak:!1,end:++this.labelCnt,expect:"endif",haveElse:!1});this.res.push(`if(!(${s.parseExpr(t.expr)})) ${this.makeJump(i.end)}`);break}case"else":{let i=this.b.lastBlock();if(!i||i.expect!=="endif"||i.haveElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");i.haveElse=!0;let n=i.end;i.end=++this.labelCnt,this.res.push(this.makeJump(i.end)),this.comment("else"),this.res.push(`case ${n}:`);break}case"endif":{this.comment("endif"),this.res.push(`case ${this.b.popBlock("endif").end}:`);break}case"while":{this.comment("while");let i=this.b.pushBlock({expect:"endwhile",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${i.start}:`),this.res.push(`if(!(${s.parseExpr(t.expr)})) ${this.makeJump(i.end)}`);break}case"endwhile":{let i=this.b.popBlock("endwhile");this.res.push(this.makeJump(i.start)),this.comment("endwhile"),this.res.push(`case ${i.end}:`);break}case"do":{this.comment("do");let i=this.b.pushBlock({expect:"until",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0});this.res.push(`case ${i.start}:`);break}case"until":{let i=this.b.popBlock("until");this.res.push(`if(${s.parseExpr(t.expr)}) ${this.makeJump(i.start)}`),this.comment("until"),this.res.push(`case ${i.end}:`);break}case"switch":{this.comment("switch"),this.b.pushBlock({expect:"endswitch",end:++this.labelCnt,next:null,canBreak:!0,hasCase:!1});break}case"endswitch":{this.comment("endswitch");let i=this.b.popBlock("endswitch");i.next!==null&&this.res.push(`case ${i.next}:`),this.res.push(`case ${i.end}:`);break}case"case":{let i=this.b.lastBlock();if(!i||i.expect!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");i.hasCase=!0,i.next!==null?(this.res.push(this.makeJump(i.end)),this.comment("case"),this.res.push(`case ${i.next}:`)):this.comment("case"),i.next=++this.labelCnt,this.res.push(`if(!(${s.parseExpr(t.expr)})) ${this.makeJump(i.next)}`);break}case"default":{let i=this.b.lastBlock();if(!i||i.expect!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");if(!i.hasCase)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");i.next!==null?(this.res.push(this.makeJump(i.end)),this.comment("default"),this.res.push(`case ${i.next}:`)):this.comment("default"),i.next=null;break}case"break":this.comment("break");let r=this.b.getBreakID();this.res.push(r===De?`return ${De};`:this.makeJump(r));break;case"varsDec":break;case"function":this._hasFuncDecl=!0;break;case"return":break;case"=":this._hasEquals=!0;break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: ${t.type}`)}}result(){return this.res}vars(){return this._vars.result()}innerFunctions(){return[...this.innerFuncs]}hasEquations(){return this._hasEquals}hasFunctionDecl(){return this._hasFuncDecl}hasBug(){return this._hasBug}};var Ga=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,ja=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,Xa=`function change(s1, s2, s3) {
    var res = s1;
    do {
        var prev = res;
        var res = res.replace(s2, s3);
    } while (res !== prev);
    return res;
}`,Ya=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,Ka=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,za=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,Za=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,qa=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,Qa=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var srch = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, srch);
        if (idx < 0) return -1;
        srch = idx + s2.length;
    }
    return idx;
}`,Ja=`function right(a, n) {
    return a.substring(a.length - n);
}`,el=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,Ms=new Map([["arccos",Ga],["arcsin",ja],["change",Xa],["compareI",Ya],["getAngleByXY",Ka],["lg",za],["ln",Za],["log",qa],["pos",Qa],["right",Ja],["round",el]]);var Wt="'",Ht='"';function Bs(e){let t="",s=null;for(let r=0;r<e.length;++r){let i=e[r];if(i===Wt&&s!==Ht?s=s?null:Wt:i===Ht&&s!==Wt&&(s=s?null:Ht),s){t+=i;continue}if(i==="/"){let n=e[r+1];if(n==="*"){for(r+=2;r<e.length&&(e[r]!=="*"||e[r+1]!=="/");)++r;++r;continue}if(n==="/"){for(++r;r<e.length&&e[++r]!==`
`;);t[t.length-1]!==`
`&&(t+=`
`);continue}}if(i===";"||i===`
`){t[t.length-1]!==`
`&&(t+=`
`);continue}if(i==="\r"){e[r+1]===`
`&&++r,t[t.length-1]!==`
`&&(t+=`
`);continue}t+=i}return t[t.length-1]===`
`?t:t+`
`}var Ls=Wa(Fs());var Pe=new Map;var tl=[pt,ge,Ze,K,Le],Qe=class{constructor(t,s,r,i){this.contextVars=null;this.target=null;this.lib=s;let n=Bs(t),o;try{o=(0,Ls.parse)(n)}catch(g){console.dir(g),console.log(n);let v=g.location.start;throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${r}, \u0441\u0442\u0440\u043E\u043A\u0430 ${v.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${v.column}: ${g.message}`)}if(o.length===0){this._func=Qe.noModel,this.isFunction=!1,this.vars=[];return}let a;try{a=new Ut(o,s,i)}catch(g){throw console.log(n.split(`
`).filter(v=>v.trim()).map((v,D)=>`${D+1}: ${v}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0442\u0440\u0430\u043D\u0441\u043B\u044F\u0446\u0438\u0438 ${r}: ${g.message}`)}a.hasEquations()&&console.warn(`\u0423\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B`),a.hasBug()&&console.warn(`${r}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),this.isFunction=a.hasFunctionDecl(),this.vars=a.vars();let u=a.result();if(u.length===0){this._func=Qe.noModel;return}let p=a.innerFunctions().map(g=>Ms.get(g)).join(`
`),T=a.missingFuncs;T.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...T.values()].join(", ")} \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),T.forEach((g,v)=>Pe.set(v,g));let _=u.join(`
`),d=p+(this.isFunction?Ds:xs)+_+`//# sourceURL=${r}`;J.log("\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0442\u043E\u0440:",`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${r}${this.isFunction?" \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u044E ":""}`);try{this._func=new Function(...tl,d)}catch(g){throw console.log(n.split(`
`).filter(v=>v.trim()).map((v,D)=>`${D+1}: ${v}`).join(`
`)),console.log(_),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r}: ${g.message}`)}}static noModel(){return 0}*compute(t,s,r){let i=this._func,n=0;for(;;){if((n=i(n,this,t,s,r))===0)return;let o=this.getWaitResult();typeof o!="object"?this.setWaitResult(o):o instanceof Promise?yield o.then(a=>this.setWaitResult(a)):this.setWaitResult(yield*o)}}saveContext(t){if(this.contextVars!==null)throw Error("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u043F\u0435\u0440\u0435\u0437\u0430\u043F\u0438\u0441\u0438 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");this.contextVars=t}loadContext(){let t=this.contextVars;if(t===null)throw Error("\u041D\u0435\u0442 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");return this.contextVars=null,t}setWaitResult(t){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=t}waitFor(t){if(this.target!==null)throw Error("\u0426\u0435\u043B\u044C \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0430");this.target=t}getWaitResult(){let t=this.target;if(t===null)throw Error("\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u0430 \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u044F");return this.target=null,t}*call(t,s,...r){let i=this.lib.getModel(s);if(i||t.stubCall(s,r),!i.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${s} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);let n={floatsCount:0,intsCount:0,stringsCount:0},o=i.vars,a=o.map(g=>new Ve(g.type).getIndex(n)),u=new Float64Array(n.floatsCount),h=new Int32Array(n.intsCount),p=new Array(n.stringsCount).fill("");if(r.length>o.length)throw Error("\u041A\u043E\u043B-\u0432\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0431\u043E\u043B\u044C\u0448\u0435 \u043A\u043E\u043B-\u0432\u0430 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");for(let g=0;g<r.length;++g){let v=r[g];switch(o[g].type){case I.Float:if(typeof v=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");u[a[g]]=v;break;case I.Handle:case I.ColorRef:if(typeof v=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");h[a[g]]=v;break;case I.String:if(typeof v=="number")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");p[a[g]]=v;break}}let T={oldFloats:u,oldInts:h,oldStrings:p};yield*i.compute(a,T,t);let _=o.findIndex(g=>g.isReturnValue);if(_<0)return;switch(o[_].type){case I.String:return p[a[_]];case I.Float:return u[a[_]];default:return h[a[_]]}}};function dt(e,t,s,r){return new Qe(e,t,s,r)}var ne;(function(e){e[e.SWF_AUTOSCROLL=1]="SWF_AUTOSCROLL",e[e.SWF_HSCROLL=2]="SWF_HSCROLL",e[e.SWF_VSCROLL=4]="SWF_VSCROLL",e[e.SWF_SPACESIZE=8]="SWF_SPACESIZE",e[e.SWF_NORESIZE=16]="SWF_NORESIZE",e[e.SWF_DIALOG=32]="SWF_DIALOG",e[e.SWF_POPUP=64]="SWF_POPUP",e[e.SWF_MDI=128]="SWF_MDI",e[e.SWF_WINTYPE=224]="SWF_WINTYPE",e[e.SWF_MODAL=256]="SWF_MODAL",e[e.SWF_AUTOORG=512]="SWF_AUTOORG",e[e.SWF_MAXIMIZE=1024]="SWF_MAXIMIZE",e[e.SWF_MINIMIZE=2048]="SWF_MINIMIZE"})(ne||(ne={}));var Vs;(function(e){e[e.DISABLE_SUBWINDOW=1]="DISABLE_SUBWINDOW",e[e.CAN_SELECT_UNSELECTABLE=8]="CAN_SELECT_UNSELECTABLE"})(Vs||(Vs={}));var Oe=[String.fromCharCode(0),String.fromCharCode(1),String.fromCharCode(2),String.fromCharCode(3),String.fromCharCode(4),String.fromCharCode(5),String.fromCharCode(6),String.fromCharCode(7),String.fromCharCode(8),String.fromCharCode(9),String.fromCharCode(10),String.fromCharCode(11),String.fromCharCode(12),String.fromCharCode(13),String.fromCharCode(14),String.fromCharCode(15),String.fromCharCode(16),String.fromCharCode(17),String.fromCharCode(18),String.fromCharCode(19),String.fromCharCode(20),String.fromCharCode(21),String.fromCharCode(22),String.fromCharCode(23),String.fromCharCode(24),String.fromCharCode(25),String.fromCharCode(26),String.fromCharCode(27),String.fromCharCode(28),String.fromCharCode(29),String.fromCharCode(30),String.fromCharCode(31),String.fromCharCode(32),String.fromCharCode(33),String.fromCharCode(34),String.fromCharCode(35),String.fromCharCode(36),String.fromCharCode(37),String.fromCharCode(38),String.fromCharCode(39),String.fromCharCode(40),String.fromCharCode(41),String.fromCharCode(42),String.fromCharCode(43),String.fromCharCode(44),String.fromCharCode(45),String.fromCharCode(46),String.fromCharCode(47),String.fromCharCode(48),String.fromCharCode(49),String.fromCharCode(50),String.fromCharCode(51),String.fromCharCode(52),String.fromCharCode(53),String.fromCharCode(54),String.fromCharCode(55),String.fromCharCode(56),String.fromCharCode(57),String.fromCharCode(58),String.fromCharCode(59),String.fromCharCode(60),String.fromCharCode(61),String.fromCharCode(62),String.fromCharCode(63),String.fromCharCode(64),String.fromCharCode(65),String.fromCharCode(66),String.fromCharCode(67),String.fromCharCode(68),String.fromCharCode(69),String.fromCharCode(70),String.fromCharCode(71),String.fromCharCode(72),String.fromCharCode(73),String.fromCharCode(74),String.fromCharCode(75),String.fromCharCode(76),String.fromCharCode(77),String.fromCharCode(78),String.fromCharCode(79),String.fromCharCode(80),String.fromCharCode(81),String.fromCharCode(82),String.fromCharCode(83),String.fromCharCode(84),String.fromCharCode(85),String.fromCharCode(86),String.fromCharCode(87),String.fromCharCode(88),String.fromCharCode(89),String.fromCharCode(90),String.fromCharCode(91),String.fromCharCode(92),String.fromCharCode(93),String.fromCharCode(94),String.fromCharCode(95),String.fromCharCode(96),String.fromCharCode(97),String.fromCharCode(98),String.fromCharCode(99),String.fromCharCode(100),String.fromCharCode(101),String.fromCharCode(102),String.fromCharCode(103),String.fromCharCode(104),String.fromCharCode(105),String.fromCharCode(106),String.fromCharCode(107),String.fromCharCode(108),String.fromCharCode(109),String.fromCharCode(110),String.fromCharCode(111),String.fromCharCode(112),String.fromCharCode(113),String.fromCharCode(114),String.fromCharCode(115),String.fromCharCode(116),String.fromCharCode(117),String.fromCharCode(118),String.fromCharCode(119),String.fromCharCode(120),String.fromCharCode(121),String.fromCharCode(122),String.fromCharCode(123),String.fromCharCode(124),String.fromCharCode(125),String.fromCharCode(126),String.fromCharCode(127),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function Je(e){return Array.from(e).map(t=>Oe[t]).join("")}var rl=" ".charCodeAt(0);function ks(e){return new Uint8Array([...e].map(t=>{let s=Oe.indexOf(t);return s>-1?s:rl}))}var ie=class{constructor(t,s){t instanceof ArrayBuffer?this.v=new DataView(t):this.v=new DataView(t.buffer,t.byteOffset,t.byteLength),this.p=0,this.name=s!=null?s:""}pos(){return this.p}seek(t){return this.p=t,this}skip(t){return this.p+=t,this}size(){return this.v.byteLength}eof(){return this.p>=this.size()}bytes(t){let s=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,t);return this.p+=t,s}byte(){let t=this.v.getUint8(this.p);return this.p+=1,t}int16(){let t=this.v.getInt16(this.p,!0);return this.p+=2,t}uint16(){let t=this.v.getUint16(this.p,!0);return this.p+=2,t}int32(){let t=this.v.getInt32(this.p,!0);return this.p+=4,t}uint32(){let t=this.v.getUint32(this.p,!0);return this.p+=4,t}float64(){let t=this.v.getFloat64(this.p,!0);return this.p+=8,t}fixedString(t){return t>0?Je(this.bytes(t)):""}string(){return this.fixedString(this.uint16())}nulltString(t){let s=this.p,r=0;for(;r<t-1&&this.v.getUint8(s+ ++r)!==0;);let i=this.fixedString(r);return this.p=s+t,i}vmString(){let t=this.uint16()*2,s=this.v.getUint8(this.p+t-2)===0?2:1,r=this.fixedString(t-s);return this.p+=s,r}point2d(t){return{x:t?this.int16():this.float64(),y:t?this.int16():this.float64()}}},pe=class extends Error{constructor(t,s){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${t.name||""}:
${s}`)}},ee=class extends pe{constructor(t,s,r){super(t,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${s.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}};var $s=class{constructor(t,s,r=!1,i=0){this.width=0;this.height=0;this.bitPP=0;this.maskRed=0;this.maskGreen=0;this.maskBlue=0;this.mask0=0;this.fileSize=0;this.reserved=0;this.offset=0;this.headerSize=0;this.planes=0;this.compress=0;this.rawSize=0;this.hr=0;this.vr=0;this.colors=0;this.importantColors=0;this.data=s,this.pos=i,this.view=t,this.is_with_alpha=!!r,this.bottom_up=!0,this.flag="BM",this.pos+=2,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.view.getUint32(this.pos,!0),this.pos+=4,this.offset=this.view.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.width=this.view.getUint32(this.pos,!0),this.pos+=4,this.height=this.view.getInt32(this.pos,!0),this.pos+=4,this.planes=this.view.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.view.getUint16(this.pos,!0),this.pos+=2,this.compress=this.view.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.view.getUint32(this.pos,!0),this.pos+=4,this.hr=this.view.getUint32(this.pos,!0),this.pos+=4,this.vr=this.view.getUint32(this.pos,!0),this.pos+=4,this.colors=this.view.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.view.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){let t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(let s=0;s<t;s++){let r=this.view.getUint8(this.pos++),i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.palette[s]={red:n,green:i,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)}parseRGBA(){let t="bit"+this.bitPP,s=this.width*this.height*4;if(this.data.length!==s)throw Error("Error reading BMP file");if(t!=="bit1"&&t!=="bit4"&&t!=="bit8"&&t!=="bit15"&&t!=="bit16"&&t!=="bit24"&&t!=="bit32")throw new Error("Unknown bit: "+t);this[t]()}bit1(){let t=Math.ceil(this.width/8),s=t%4,r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){let i=this.bottom_up?r:this.height-1-r;for(let n=0;n<t;n++){let o=this.view.getUint8(this.pos++),a=i*this.width*4+n*8*4;for(let u=0;u<8&&n*8+u<this.width;u++){let h=this.palette[o>>7-u&1];this.data[a+u*4]=h.red,this.data[a+u*4+1]=h.green,this.data[a+u*4+2]=h.blue,this.data[a+u*4+3]=255}}s!==0&&(this.pos+=4-s)}}bit4(){if(this.compress===2){this.data.fill(255);let t=0,s=this.bottom_up?this.height-1:0,r=!1,i=n=>{let o=this.palette[n];this.data[t]=o.red,this.data[t+1]=o.green,this.data[t+2]=o.blue,this.data[t+3]=255,t+=4};for(;t<this.data.length;){let n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);if(n===0)if(o===0){this.bottom_up?s--:s++,t=s*this.width*4,r=!1;continue}else{if(o===1)break;if(o===2){let a=this.view.getUint8(this.pos++),u=this.view.getUint8(this.pos++);this.bottom_up?s-=u:s+=u,t+=u*this.width*4+a*4}else{let a=this.view.getUint8(this.pos++);for(let u=0;u<o;u++)r?i.call(this,a&15):i.call(this,(a&240)>>4),u&1&&u+1<o&&(a=this.view.getUint8(this.pos++)),r=!r;(o+1>>1&1)==1&&this.pos++}}else for(let a=0;a<n;a++)r?i.call(this,o&15):i.call(this,(o&240)>>4),r=!r}}else{let t=Math.ceil(this.width/2),s=t%4;for(let r=this.height-1;r>=0;r--){let i=this.bottom_up?r:this.height-1-r;for(let n=0;n<t;n++){let o=this.view.getUint8(this.pos++),a=i*this.width*4+n*2*4,u=o>>4,h=o&15,p=this.palette[u];if(this.data[a]=p.red,this.data[a+1]=p.green,this.data[a+2]=p.blue,this.data[a+3]=255,n*2+1>=this.width)break;p=this.palette[h],this.data[a+4]=p.red,this.data[a+4+1]=p.green,this.data[a+4+2]=p.blue,this.data[a+4+3]=255}s!==0&&(this.pos+=4-s)}}}bit8(){if(this.compress===1){this.data.fill(255);let t=0,s=this.bottom_up?this.height-1:0,r=i=>{let n=this.palette[i];this.data[t]=n.red,this.data[t+1]=n.green,this.data[t+2]=n.blue,this.data[t+3]=255,t+=4};for(;t<this.data.length;){let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++);if(i===0)if(n===0){this.bottom_up?s--:s++,t=s*this.width*4;continue}else{if(n===1)break;if(n===2){let o=this.view.getUint8(this.pos++),a=this.view.getUint8(this.pos++);this.bottom_up?s-=a:s+=a,t+=a*this.width*4+o*4}else{for(let o=0;o<n;o++){let a=this.view.getUint8(this.pos++);r.call(this,a)}(n&1)==1&&this.pos++}}else for(let o=0;o<i;o++)r.call(this,n)}}else{let t=this.width%4;for(let s=this.height-1;s>=0;s--){let r=this.bottom_up?s:this.height-1-s;for(let i=0;i<this.width;i++){let n=this.view.getUint8(this.pos++),o=r*this.width*4+i*4;if(n<this.palette.length){let a=this.palette[n];this.data[o]=a.red,this.data[o+1]=a.green,this.data[o+2]=a.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}t!==0&&(this.pos+=4-t)}}}bit15(){let t=this.width%3,s=parseInt("11111",2),r=s;for(let i=this.height-1;i>=0;i--){let n=this.bottom_up?i:this.height-1-i;for(let o=0;o<this.width;o++){let a=this.view.getUint16(this.pos,!0);this.pos+=2;let u=(a&r)/r*255|0,h=(a>>5&r)/r*255|0,p=(a>>10&r)/r*255|0,T=n*this.width*4+o*4;this.data[T]=p,this.data[T+1]=h,this.data[T+2]=u,this.data[T+3]=255}this.pos+=t}}bit16(){let t=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress===3&&(this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4);let s=[0,0,0];for(let r=0;r<16;r++)this.maskRed>>r&1&&s[0]++,this.maskGreen>>r&1&&s[1]++,this.maskBlue>>r&1&&s[2]++;s[1]+=s[0],s[2]+=s[1],s[0]=8-s[0],s[1]-=8,s[2]-=8;for(let r=this.height-1;r>=0;r--){let i=this.bottom_up?r:this.height-1-r;for(let n=0;n<this.width;n++){let o=this.view.getUint16(this.pos,!0);this.pos+=2;let a=(o&this.maskBlue)<<s[0],u=(o&this.maskGreen)>>s[1],h=(o&this.maskRed)>>s[2],p=i*this.width*4+n*4;this.data[p]=h,this.data[p+1]=u,this.data[p+2]=a,this.data[p+3]=255}this.pos+=t}}bit24(){for(let t=this.height-1;t>=0;t--){let s=this.bottom_up?t:this.height-1-t;for(let r=0;r<this.width;r++){let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++),a=s*this.width*4+r*4;this.data[a]=o,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=255}this.pos+=this.width%4}}bit32(){if(this.compress===3){this.maskRed=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskGreen=this.view.getUint32(this.pos,!0),this.pos+=4,this.maskBlue=this.view.getUint32(this.pos,!0),this.pos+=4,this.mask0=this.view.getUint32(this.pos,!0),this.pos+=4;for(let t=this.height-1;t>=0;t--){let s=this.bottom_up?t:this.height-1-t;for(let r=0;r<this.width;r++){this.view.getUint8(this.pos++);let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++),a=s*this.width*4+r*4;this.data[a]=o,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=255}}}else for(let t=this.height-1;t>=0;t--){let s=this.bottom_up?t:this.height-1-t;for(let r=0;r<this.width;r++){let i=this.view.getUint8(this.pos++),n=this.view.getUint8(this.pos++),o=this.view.getUint8(this.pos++);this.view.getUint8(this.pos++);let a=s*this.width*4+r*4;this.data[a]=o,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=255}}}};function _t(e,t){new $s(e,t)}function Gt(e){return{width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}function jt(e){let t=e.pos(),s=e.uint16();if(s!==19778)throw new ee(e,s,19778);let r=e.int32();return e.seek(t),r}function Xt(e){return new DataView(e.buffer,e.byteOffset)}function Tt(e){let t=e.bytes(jt(e)),s=Xt(t),{width:r,height:i}=Gt(s);if(r===0||i===0)return null;let n=document.createElement("canvas");n.width=r,n.height=i;let o=n.getContext("2d",{alpha:!1});if(!o)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${e.name}`);let a=o.createImageData(r,i);return _t(s,a.data),o.putImageData(a,0,0),o}function St(e){let t=e.bytes(jt(e)),s=e.bytes(jt(e)),r=Xt(t),{width:i,height:n}=Gt(r);if(i===0||n===0)return null;let o=document.createElement("canvas");o.width=i,o.height=n;let a=o.getContext("2d",{alpha:!0});if(!a)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${e.name}`);let u=a.createImageData(i,n),h=u.data,p=new Uint8ClampedArray(i*n*4);_t(r,h),_t(Xt(s),p);for(let T=3;T<h.length&&T<p.length;T+=4)h[T]=255^p[T-1];return a.putImageData(u,0,0),a}var $;(function(e){e[e.otGROUP=1]="otGROUP",e[e.otCOLLECTION=1e3]="otCOLLECTION",e[e.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",e[e.otPENCOLLECTION=1004]="otPENCOLLECTION",e[e.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",e[e.otDIBCOLLECTION=1006]="otDIBCOLLECTION",e[e.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",e[e.otFONTCOLLECTION=1008]="otFONTCOLLECTION",e[e.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",e[e.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",e[e.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",e[e.ot3DCOLLECTION=1012]="ot3DCOLLECTION",e[e.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",e[e.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",e[e.otDATAITEMS=1022]="otDATAITEMS",e[e.otMATERIALS3D=1024]="otMATERIALS3D",e[e.otSPACE2D=17458]="otSPACE2D",e[e.otSPACE3D=17459]="otSPACE3D",e[e.otSPACE3Df=25668]="otSPACE3Df",e[e.otGROUP2D=3]="otGROUP2D",e[e.otRGROUP2D=4]="otRGROUP2D",e[e.otGROUP3D=5]="otGROUP3D",e[e.otOBJECT3D=10]="otOBJECT3D",e[e.otCAMERA3D=11]="otCAMERA3D",e[e.otLIGHT3D=12]="otLIGHT3D",e[e.otLINE2D=20]="otLINE2D",e[e.otBITMAP2D=21]="otBITMAP2D",e[e.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",e[e.otTEXT2D=23]="otTEXT2D",e[e.otVIEW3D2D=24]="otVIEW3D2D",e[e.otUSEROBJECT2D=25]="otUSEROBJECT2D",e[e.otCONTROL2D=26]="otCONTROL2D",e[e.otEDITFRAME2D=50]="otEDITFRAME2D",e[e.otROTATECENTER2D=51]="otROTATECENTER2D",e[e.otFRAME3D=52]="otFRAME3D",e[e.otAXIS3D=53]="otAXIS3D",e[e.ttPEN2D=101]="ttPEN2D",e[e.ttBRUSH2D=102]="ttBRUSH2D",e[e.ttDIB2D=103]="ttDIB2D",e[e.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",e[e.ttFONT2D=105]="ttFONT2D",e[e.ttSTRING2D=106]="ttSTRING2D",e[e.ttTEXT2D=107]="ttTEXT2D",e[e.ttREFTODIB2D=110]="ttREFTODIB2D",e[e.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",e[e.ctINFONAME=200]="ctINFONAME",e[e.ctINFOAUTOR=201]="ctINFOAUTOR",e[e.ctINFOINFO=202]="ctINFOINFO",e[e.ctCRDSYSTEM=203]="ctCRDSYSTEM",e[e.stSPACEDATA=204]="stSPACEDATA",e[e.stOBJNAME=205]="stOBJNAME"})($||($={}));function Cs(e,t){if(e!==$.ttPEN2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Pen");return{handle:t.uint16(),color:t.int32(),style:t.int16(),width:t.int16(),rop2:t.int16()}}function Us(e,t){if(e!==$.ttBRUSH2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Brush");return{handle:t.uint16(),color:t.int32(),style:t.int16(),hatch:t.int16(),rop2:t.int16(),dibHandle:t.uint16()}}function Ws(e,t){switch(e){case $.ttDIB2D:return{type:"image",handle:t.uint16(),img:Tt(t)};case $.ttREFTODIB2D:return{type:"BMPReference",handle:t.uint16(),filename:t.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Dib")}}function Hs(e,t){switch(e){case $.ttDOUBLEDIB2D:return{type:"image",handle:t.uint16(),img:St(t)};case $.ttREFTODOUBLEDIB2D:return{type:"DBMReference",handle:t.uint16(),filename:t.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 DoubleDib")}}function Gs(e,t,s){if(e!==$.ttFONT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Font");let r=t.pos(),i={handle:t.uint16(),height:t.int16(),width:t.int16(),escapement:t.int16(),orientation:t.int16(),weight:t.int16(),italic:t.byte(),underline:t.byte(),strikeOut:t.byte(),charSet:t.byte(),outPrecision:t.byte(),clipPrecision:t.byte(),quality:t.byte(),pitchAndFamily:t.byte(),fontName:t.nulltString(32)};return s>=515&&(i.size=t.int32(),i.style=t.int32()),i}function js(e,t){if(e!==$.ttSTRING2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 String");return{handle:t.uint16(),text:t.string()}}function sl(e){return{fgColor:e.int32(),bgColor:e.int32(),fontHandle:e.uint16(),stringHandle:e.uint16()}}function Xs(e,t,s){if(e!==$.ttTEXT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Text");let r=t.uint16(),i=new G(t,s,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u044B\u0445 \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\u043E\u0432"),n=i.readCollection(sl);return i.checkReaded(),{handle:r,textCollection:n}}function Yt(e){return e.uint16()}function Kt(e,t){let s={handle:e.uint16(),options:e.uint16()};return t>=258&&t<768&&(s.name=e.string()),s}function ke(e,t){return t<512?F(F({},Kt(e,t)),{originX:e.int16(),originY:e.int16(),width:e.int16(),height:e.int16()}):F(F({},Kt(e,t)),{originX:e.float64(),originY:e.float64(),width:e.float64(),height:e.float64()})}function Ys(e,t){let s=Kt(e,t),r=new G(e,t,"\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0433\u0440\u0443\u043F\u043F\u044B"),i=r.readCollection(Yt);return r.checkReaded(),F(F({type:"group"},s),{childHandles:i})}function Ks(e,t){let s=ke(e,t),r=e.uint16(),i=e.uint16(),n=e.uint16()*2,o=new Array(n);for(let u=0;u<n;u+=2)t<512?(o[u+0]=e.int16(),o[u+1]=e.int16()):(o[u+0]=e.float64(),o[u+1]=e.float64());let a=F(F({type:"line"},s),{penHandle:r,brushHandle:i,coords:o});if(t>512){let u=e.byte();u>0&&(a.arrows=e.bytes(u))}return a}function zt(e,t,s){return F(F({type:s},ke(e,t)),{cropX:t<512?e.int16():e.float64(),cropY:t<512?e.int16():e.float64(),cropW:t<512?e.int16():e.float64(),cropH:t<512?e.int16():e.float64(),angle:e.int16(),dibHandle:e.uint16()})}function zs(e,t){return F(F({type:"text"},ke(e,t)),{textToolHandle:e.uint16(),delta:e.point2d(t<512),angle:e.int16()})}function Zs(e,t){let s=ke(e,t),r=e.string(),i=r.toUpperCase();if(i!=="EDIT"&&i!=="BUTTON"&&i!=="COMBOBOX")throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430 Control #${s.handle}: ${r}`);let n=F(F({type:"control"},s),{inputType:i,text:e.string(),dwStyle:e.int32(),exStyle:e.int32(),id:e.uint16(),controlSize:e.point2d(!0)});return e.uint16(),n}function qs(e,t){return F(F({type:"view3D"},ke(e,t)),{spaceHandle:e.uint16(),cameraHandle:e.uint16()})}function Qs(e,t){return F(F({type:"editFrame"},ke(e,t)),{objectHandle:e.uint16(),size:e.point2d(t<512)})}function Js(e,t){let s={},r=0,i=e.pos()+t;for(;e.pos()<i&&(r=e.uint16())!==0;)switch(r){case 1:s.target=e.string();break;case 2:s.windowName=e.string();break;case 3:s.objectName=e.string();break;case 4:s.openMode=e.uint16();break;case 5:s.effect=e.string();break;case 6:s.time=e.uint16();break;case 7:s.disabled=!0;break;case 8:s.params=e.string();break}return s}function Zt(e,t){let s=e.uint16();return e.skip(5),Array.from({length:s},()=>{let r=e.uint16(),i=e.uint16();return t(r,i,e)})}function en(e,t){return{type:e.uint16(),objectHandle:e.int16(),center:e.point2d(t<512),matrix:Array.from({length:9},()=>e.float64())}}var G=class{constructor(t,s,r){this.name=r;this.reader=t,this.version=s,this.start=t.pos(),this.code=t.int16(),this.size=s>=768?t.int32():0}goEnd(){this.reader.seek(this.start+this.size)}readToolCollection(t){let s=this.reader.uint16();return this.reader.skip(7),Array.from({length:s},()=>{let r=new G(this.reader,this.version,"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442");this.reader.skip(2);let i=t(r.code,this.reader,this.version);return r.checkReaded(),i})}readElementCollection(){let t=this.reader.uint16();return this.reader.skip(7),Array.from({length:t},()=>{let{reader:s,version:r}=this,i=new G(s,r,"\u0413\u0440\u0430\u0444. \u043E\u0431\u044A\u0435\u043A\u0442"),n;switch(i.code){case $.otGROUP2D:n=Ys(s,r);break;case $.otLINE2D:n=Ks(s,r);break;case $.otBITMAP2D:n=zt(s,r,"bitmap");break;case $.otDOUBLEBITMAP2D:n=zt(s,r,"doubleBitmap");break;case $.otTEXT2D:n=zs(s,r);break;case $.otCONTROL2D:n=Zs(s,r);break;case $.otVIEW3D2D:n=qs(s,this.version);break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442: ${$[i.code]}`)}if(r<768)return n;for(;i.hasData();){let o=new G(this.reader,this.version,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435");o.readElementData(n),o.checkReaded()}return i.checkReaded(),n})}readElementData(t){switch(this.code){case $.otDATAITEMS:Zt(this.reader,function(s,r,i){switch(s){case 10:t.hyperbase=Js(i,r);break;case 13:i.nulltString(r);break;case 14:i.nulltString(r);break;default:console.warn(`${i.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 ${t.type} #${t.handle}: id ${s}, ${r} \u0431\u0430\u0439\u0442\u043E\u0432`),i.skip(r)}});break;case $.stOBJNAME:t.name=this.reader.fixedString(this.size-6);break}}readCollection(t){let s=this.reader.uint16();return this.reader.skip(4),Array.from({length:s},()=>t(this.reader))}readObject(t){switch(this.code){case 1004:t.penTools=this.readToolCollection(Cs);break;case 1005:t.brushTools=this.readToolCollection(Us);break;case 1006:t.dibTools=this.readToolCollection(Ws);break;case 1007:t.doubleDibTools=this.readToolCollection(Hs);break;case 1008:t.fontTools=this.readToolCollection(Gs);break;case 1009:t.stringTools=this.readToolCollection(js);break;case 1010:t.textTools=this.readToolCollection(Xs);break;case 1012:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 3D-\u0444\u0440\u0435\u0439\u043C\u043E\u0432 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");case $.otPRIMARYCOLLECTION:t.elementOrder=this.readCollection(Yt);break;case $.otOBJECTCOLLECTION:t.elements=this.readElementCollection();break;case $.otDATAITEMS:Zt(this.reader,(r,i,n)=>{switch(r){case 1:t.grid={offsetX:n.float64(),offsetY:n.float64(),stepX:n.float64(),stepY:n.float64(),visible:!!n.byte(),use:!!n.byte()};break;case 11:t.settings={style:n.uint32(),x:n.uint16(),y:n.uint16()};break;case 13:n.skip(i);break;default:console.warn(`${n.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0441\u0442\u0440\u0430\u043D\u0441\u0442\u0432\u0430: id ${r}, ${i} \u0431\u0430\u0439\u0442\u043E\u0432`),n.skip(i);break}});break;case $.ctINFONAME:this.reader.skip(this.reader.uint16());break;case $.ctINFOAUTOR:this.reader.skip(this.reader.uint16());break;case $.ctINFOINFO:this.reader.skip(this.reader.uint16());break;case $.ctCRDSYSTEM:t.crdSystem=en(this.reader,this.version);break;case $.otEDITFRAME2D:let s=Qs(this.reader,this.version);console.warn(`${this.reader.name}: \u0444\u0440\u0435\u0439\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F #${s.objectHandle} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`);break;default:console.warn(`${this.reader.name}: ${$[this.code]} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.goEnd()}}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.reader.pos()-this.start}checkReaded(){if(this.version<768)return;let t=this.readedBytes();if(t>this.size)throw Error(`Chunk ${this.name} data out of range: ${t} instead of ${this.size}`);if(t<this.size)throw Error(`Chunk ${this.name} not readed: ${t} instead of ${this.size}`)}};function nl(e,t){let s=new G(e,t,"VDR");if(s.code!==$.stSPACEDATA)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x");let r={version:t,origin:e.point2d(),scaleDiv:e.point2d(),scaleMul:e.point2d(),state:e.uint16(),brushHandle:e.uint16(),layers:e.uint32(),flags:e.uint16()};for(;s.hasData();){let i=new G(e,t,"");i.readObject(r),i.checkReaded()}return s.checkReaded(),r}function il(e,t,s){var _;let r=e.int32()+s,i=e.int32()+s,n=e.point2d(t<512),o=e.point2d(t<512),a=e.point2d(t<512);e.string();let u=e.uint16();e.string(),e.string(),e.string(),new G(e,t,"RCenter").goEnd(),new G(e,t,"Frame").goEnd();let h=e.uint16(),p={version:t,origin:n,scaleDiv:o,scaleMul:a,state:u,flags:0,brushHandle:h,layers:0};e.seek(r),new G(e,t,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(p),new G(e,t,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(p),e.seek(i);let T=e.uint16();for(let d=0;d<T;++d)new G(e,t,"").readObject(p);if(t>258){p.layers=e.uint32(),p.flags=e.uint16();let d;for(;(d=e.uint16())!==0;)switch(d){case 1:let g=e.uint16(),v=(_=p.elements)==null?void 0:_.find(D=>D.handle===g);if(!v)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435`);new G(e,t,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readElementData(v);break;case 2:new G(e,t,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readObject(p);break;default:return p}}return e.string(),p}function $e(e,t,s=!0){let r=e.uint16();if(r!==17458)throw new ee(e,r,17458);let i=e.pos(),n=e.uint16();e.skip(2);let o=n<768?il(e,n,i):nl(e,n);if(o.source=t,!s)return o;let a=e.size()-e.pos();if(a!==0){let u=`${e.name}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${e.pos()} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${a}. v0x${o.version.toString(16)}.`;console.warn(u)}return o}var oe=class{constructor(t,s){this.scene=t;this._parent=null;var r,i,n,o,a,u,h,p;this.handle=(r=s.handle)!=null?r:0,this.name=(i=s.name)!=null?i:"",this.meta=(n=s.meta)!=null?n:null,this._x=(o=s.x)!=null?o:0,this._y=(a=s.y)!=null?a:0,this._width=(u=s.width)!=null?u:0,this._height=(h=s.height)!=null?h:0,this.unselectable=(p=s.unselectable)!=null?p:null}_moved(t,s){this._updateBBox(this._x+t,this._y+s,this._width,this._height)}_rotated(t,s,r){let i=Math.sin(r),n=Math.cos(r),o=this._x-t,a=this._y-s,u=o*n-a*i,h=o*i+a*n,p=u+t,T=h+s;this._updateBBox(p,T,this._width,this._height)}_resized(t,s,r,i){let n=t+(this._x-t)*r,o=s+(this._y-s)*i,a=this._width*r,u=this._height*i;this._updateBBox(n,o,a,u)}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}move(t,s){var r;return this._moved(t-this._x,s-this._y),(r=this._parent)==null||r._recalcBorders(),this.scene._dirty=!0,this}rotate(t,s,r){var i;return r===0?this:(this._rotated(t,s,r),(i=this._parent)==null||i._recalcBorders(),this.scene._dirty=!0,this)}size(t,s){var a;if(t<0||s<0)return this;let r=this._width,i=this._height;if(r===0||i===0)return this;let n=t/r,o=s/i;return n===1&&o===1?this:(this._resized(this._x,this._y,n,o),(a=this._parent)==null||a._recalcBorders(),this.scene._dirty=!0,this)}_updateBBox(t,s,r,i){this._x=t,this._y=s,this._width=r,this._height=i,this.scene._dirty=!0}parent(){return this._parent}};var Te=class extends oe{constructor(t,s={}){super(t,s);this.type="group";this._children=[];s.children&&this.setChildren(s.children)}children(){return this._children}_moved(t,s){this._children.length!==0&&(this._children.forEach(r=>r._moved(t,s)),this._updateBBox(this._x+t,this._y+s,this._width,this._height))}_resized(t,s,r,i){if(this._children.length===0)return;let n=Infinity,o=-Infinity,a=Infinity,u=-Infinity;this._children.forEach(h=>{h._resized(t,s,r,i),n=Math.min(n,h._x),a=Math.min(a,h._y),o=Math.max(o,h._x+h._width),u=Math.max(u,h._y+h._height)}),this._updateBBox(n,a,o-n,u-a)}_rotated(t,s,r){if(this._children.length===0)return;let i=Infinity,n=-Infinity,o=Infinity,a=-Infinity;this._children.forEach(u=>{u._rotated(t,s,r),i=Math.min(i,u._x),o=Math.min(o,u._y),n=Math.max(n,u._x+u._width),a=Math.max(a,u._y+u._height)}),this._updateBBox(i,o,n-i,a-o)}setChildren(t){var o;if(this._children.forEach(a=>a._parent=null),this._children=t,t.length===0)return this;let s=Infinity,r=-Infinity,i=Infinity,n=-Infinity;return t.forEach(a=>{a._parent=this,s=Math.min(s,a._x),i=Math.min(i,a._y),r=Math.max(r,a._x+a._width),n=Math.max(n,a._y+a._height)}),this._updateBBox(s,i,r-s,n-i),(o=this._parent)==null||o._recalcBorders(),this}_recalcBorders(){var n;let t=Infinity,s=-Infinity,r=Infinity,i=-Infinity;this._children.forEach(o=>{t=Math.min(t,o._x),r=Math.min(r,o._y),s=Math.max(s,o._x+o._width),i=Math.max(i,o._y+o._height)}),this._updateBBox(t,r,s-t,i-r),(n=this._parent)==null||n._recalcBorders()}};var X=class{constructor(t,s){this.scene=t;this._ver=0;this._tool=s,s==null||s._subscribe(this)}tool(){return this._tool}setTool(t){var s;return t===this._tool?this:((s=this._tool)==null||s._unsubscribe(this),this._tool=t,t==null||t._subscribe(this),++this._ver,this.scene._dirty=!0,this)}forceUnsub(){var t;(t=this._tool)==null||t._unsubscribe(this)}};var ae=class{constructor(t={}){this._elements=[];this._scale=1;this._offsetVer=0;this._dirty=!0;this.brush=new X(this,null);var s,r,i;this._offsetX=(s=t.offsetX)!=null?s:0,this._offsetY=(r=t.offsetY)!=null?r:0,this._layers=(i=t.layers)!=null?i:0}scale(t){return this._scale=t,this}layers(){return this._layers}setLayers(t){return t===this._layers?this:(this._layers=t,this._dirty=!0,this)}elements(){return this._elements}setElements(t){return this._elements=t,this._dirty=!0,this}offsetX(){return this._offsetX}offsetY(){return this._offsetY}setOffset(t,s){return this._offsetX=t,this._offsetY=s,++this._offsetVer,this._dirty=!0,this}};ae.keyState=new Uint8Array(256);var B=class extends Map{static create(t){return new Map(t)}static getFreeHandle(t,s){let r=s||0;for(;t.has(++r););return r}static getFreeNegativeHandle(t){let s=0;for(;t.has(--s););return s}};function tn(e){let t=e[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]);return[(e[4]*e[8]-e[7]*e[5])/t,(e[2]*e[7]-e[1]*e[8])/t,(e[1]*e[5]-e[2]*e[4])/t,(e[5]*e[6]-e[3]*e[8])/t,(e[0]*e[8]-e[2]*e[6])/t,(e[3]*e[2]-e[0]*e[5])/t,(e[3]*e[7]-e[6]*e[4])/t,(e[6]*e[1]-e[0]*e[7])/t,(e[0]*e[4]-e[3]*e[1])/t]}function rn(e){return e.substring(0,e.lastIndexOf("\\")+1)}var ce=class{constructor(){this.m=new Map}set(t,s){let r=this.m.get(t);return r?(r.add(s),this):(this.m.set(t,new Set([s])),this)}get(t){var s;return(s=this.m.get(t))!=null?s:null}delete(t){return this.m.delete(t)}[Symbol.iterator](){return this.m[Symbol.iterator]()}};function Et(e,t){switch(e){case I.String:return t;case I.Float:return parseFloat(t)||0;case I.Handle:return(t.startsWith("#")?parseInt(t.substring(1,t.length)):parseInt(t))||0;case I.ColorRef:return ms(t)}}function sn(e,t){let s=r=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${e.proto.name}: ${r}`);for(let{handle1:r,handle2:i,flags:n,connectedVars:o}of t){let a=n&1,u=r===0?e:e.child(r);if(!u){s(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${r} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let h=i===0?e:e.child(i);if(!h){s(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let p=u.proto.vars(),T=h.proto.vars(),_=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${u.proto.name} #${r}`,d=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${h.proto.name} #${i}`;for(let{name1:g,name2:v}of o){let D=p.id(g),M=T.id(v);if(typeof D!="number"){s(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${_}`);continue}if(typeof M!="number"){s(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${v} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${d}`);continue}if(!u.connectVar(D,h,M,a)){let k=I[p.data(D).type],W=I[T.data(D).type];s(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${g} (${k}) \u0432 ${_} \u0438 ${v} (${W}) \u0432 ${d}`)}}}}var me=class{constructor(t,s,r,i,n){this.children=[];this.isDisabled=me.alwaysEnabled;this.disOrEnVarId=-1;this.varGraphNodes=[];this.classNodeCache=new Map;s.model(),this.proto=s,this.prj=t;{let o=s.vars();this.varGraphNodes=o.toArray().map(h=>new Ve(h.type)),this.TLB=new Uint16Array(o.count());let a=o._enableVarId,u=o._disableVarId;a>-1&&(u<0||a<u)&&(this.isDisabled=me.disabledByEnable,this.disOrEnVarId=a),u>-1&&(a<0||u<a)&&(this.isDisabled=me.disabledByDisable,this.disOrEnVarId=u)}this.children=r,sn(this,i),this.resolveMap=new Map([["",this]]),r.forEach(o=>{this.resolveMap.set("#"+o.handle,o),o.schemeName&&this.resolveMap.set(o.schemeName.toUpperCase(),o)}),this.parent=null,r.forEach(o=>o.setParent(this)),n?(this.handle=n.handle,this.schemeName=n.schemeName,this.position=n.position):(this.handle=0,this.schemeName="",this.position={x:0,y:0})}static alwaysEnabled(){return!1}static disabledByEnable(t){return t.prj.newFloats[t.TLB[t.disOrEnVarId]]<=0}static disabledByDisable(t){return t.prj.newFloats[t.TLB[t.disOrEnVarId]]>0}setParent(t){if(t===this||this.parent!==null)throw Error("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0440\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0439 \u0438\u043C\u0438\u0434\u0436");this.parent=t,this.resolveMap.set("..",t)}resolve(t){if(t==="")return this;let s=t.toUpperCase().split("\\"),r=t[0]==="\\"?this.prj.root:this;for(let i=0;i<s.length;++i){let n=r.resolveMap.get(s[i]);if(typeof n=="undefined")return;r=n}return r}findClasses(t){let{root:s}=this.prj,r=s.classNodeCache.get(t);if(typeof r!="undefined")return r;let i=new Array;return function n(o){o.children.forEach(n),o.proto.name.toUpperCase()===t&&i.push(o)}(s),s.classNodeCache.set(t,i),i}setVarValue(t,s,r){if(t<0)return!1;let i=this.TLB[t];return this.prj.setOldValue(i,s,r),this.prj.setNewValue(i,s,r),!0}getVarValue(t,s){return this.prj.getNewValue(this.TLB[t],s)}*computeSchema(){for(let s=0;s<this.children.length;++s){let r=this.children[s];r.isDisabled(r)||(yield*r.computeSchema())}let t=this.proto.model();!t||(yield*t.compute(this.TLB,this.prj,this))}child(t){var s;return(s=this.children.find(r=>r.handle===t))!=null?s:null}connectVar(t,s,r,i){return i?!0:Ve.connect(this.varGraphNodes[t],s.varGraphNodes[r])}receive(t,...s){if(this.prj.env.isWaiting())return Promise.resolve();let i=this.proto.vars();if(this.setVarValue(i.msgVarId,I.Float,t)===!1)return Promise.resolve();switch(t){case x.WM_CONTROLNOTIFY:this.setVarValue(i._hobjectVarId,I.Handle,s[0]),this.setVarValue(i.iditemVarId,I.Float,s[1]),this.setVarValue(i.wnotifycodeVarId,I.Float,s[2]);break;case x.WM_SIZE:this.setVarValue(i.nwidthVarId,I.Float,s[0]),this.setVarValue(i.nheightVarId,I.Float,s[1]);break;case x.WM_MOUSEMOVE:case x.WM_LBUTTONDOWN:case x.WM_LBUTTONUP:case x.WM_LBUTTONDBLCLK:case x.WM_RBUTTONDOWN:case x.WM_RBUTTONUP:case x.WM_RBUTTONDBLCLK:case x.WM_MBUTTONDOWN:case x.WM_MBUTTONUP:case x.WM_MBUTTONDBLCLK:this.setVarValue(i.xposVarId,I.Float,s[0]),this.setVarValue(i.yposVarId,I.Float,s[1]),this.setVarValue(i.fwkeysVarId,I.Float,s[2]);break;case x.WM_KEYDOWN:case x.WM_KEYUP:case Fe:this.setVarValue(i.wVkeyVarId,I.Float,s[0]),this.setVarValue(i.repeatVarId,I.Float,s[1]),this.setVarValue(i.scanCodeVarId,I.Float,s[2]);break}return this.compute(!0)}compute(t=!1){return j(this,null,function*(){if(!t&&this.isDisabled(this))return;let s=this.computeSchema();for(;;){let n=s.next();if(n.done)break;this.prj.env.setWaiting(),yield n.value,this.prj.env.resetWaiting()}let r=this.prj;r.oldFloats.set(r.newFloats),r.oldInts.set(r.newInts);let i=r.newStrings;for(let n=0;n<i.length;++n)r.oldStrings[n]=i[n];me.assertZeroIndexEmpty(r)})}createTLB(){let t={floatsCount:1,intsCount:1,stringsCount:1};return function s({children:r,TLB:i,varGraphNodes:n}){r.forEach(s),i.set(n.map(o=>o.getIndex(t)))}(this),t}applyDefaults(){this.children.forEach(r=>r.applyDefaults());let t=this.proto.vars(),s=t.count();for(let r=0;r<s;++r){let i=t.data(r),n=i.type,o=i.defaultValue;if(o!==null){this.setVarValue(r,n,o);continue}switch(r){case t.orgxVarId:this.setVarValue(r,n,this.position.x);break;case t.orgyVarId:this.setVarValue(r,n,this.position.y);break;case t._hobjectVarId:this.setVarValue(r,n,this.handle);break;case t._objnameVarId:this.setVarValue(r,n,this.schemeName);break;case t._classnameVarId:this.setVarValue(r,n,this.proto.name);break}}return this}applyVarSet(t){if(this.proto.name.toUpperCase()===t.classname.toUpperCase()){let s=this.proto.vars(),{values:r}=t;for(let i=0;i<r.length;++i){let n=r[i],o=s.id(n.name);if(o===null)continue;let a=s.data(o).type;this.setVarValue(o,a,Et(a,n.value))}}return t.childSets.forEach(s=>{var r;return(r=this.child(s.handle))==null?void 0:r.applyVarSet(s)}),this}path(){let t=this,s="";for(;t.parent;)s=` -> ${t.proto.name} #${t.handle}${s}`,t=t.parent;return this.prj.root.proto.name+s}stubCall(t,s){throw Error(`\u0412\u044B\u0437\u043E\u0432 \u043D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${t}(${s.map(r=>typeof r).join(",")})
\u0432 ${this.path()}`)}copyNewValuesToOld(){let t=this.TLB,{newFloats:s,oldFloats:r,newInts:i,oldInts:n,newStrings:o,oldStrings:a}=this.prj;for(let u of t)r[u]=s[u],n[u]=i[u],a[u]=o[u]}static assertZeroIndexEmpty(t){if(t.oldFloats[0]!==0||"undefined"in t.oldFloats||t.newFloats[0]!==0||"undefined"in t.newFloats||t.oldInts[0]!==0||"undefined"in t.oldInts||t.newInts[0]!==0||"undefined"in t.newInts||t.oldStrings[0]!==""||"undefined"in t.oldStrings||t.newStrings[0]!==""||"undefined"in t.newStrings)throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}stratum_async_test_sleep_8210460217466098(t){return t===0?"":new Promise(s=>setTimeout(s,t)).then(()=>"wait"+t)}stratum_getHObject(){return this.handle}stratum_getHObjectByName(t){var s,r;return(r=(s=this.resolve(t))==null?void 0:s.handle)!=null?r:0}stratum_getClassName(t){let s=this.resolve(t);return typeof s=="undefined"?"":s.proto.name}stratum_setVar(t,s,r){let i=this.resolve(t);if(!i)return;let n=i.proto.vars(),o=n.id(s);o!==null&&i.setVarValue(o,n.data(o).type,r)}stratum_getVarS(t,s){let r=this.resolve(t);if(!r)return"";let n=r.proto.vars().id(s);return n!==null?r.getVarValue(n,I.String):""}stratum_getVarF(t,s){let r=this.resolve(t);if(!r)return 0;let n=r.proto.vars().id(s);return n!==null?r.getVarValue(n,I.Float):0}stratum_getVarH(t,s){let r=this.resolve(t);if(!r)return 0;let n=r.proto.vars().id(s);return n!==null?r.getVarValue(n,I.Handle):0}stratum_getVarC(t,s){let r=this.resolve(t);if(!r)return 0;let n=r.proto.vars().id(s);return n!==null?r.getVarValue(n,I.ColorRef):0}*stratum_async_sendMessage(t,s,...r){var T;let{prj:i,TLB:n}=this;if(i.canExecute()===!1)return;let o=null;if(t!==""){let _=this.resolve(t);_&&(o=[_])}if(s!==""){let _=s.toUpperCase();o=(T=o==null?void 0:o.filter(d=>d.proto.name.toUpperCase()===_))!=null?T:this.findClasses(_)}if(!o||o.length===0)return;let a=this.proto.vars(),u=o[0].proto.vars(),h=new Array(r.length*1.5),p=0;for(let _=0;_<r.length;_+=2){let d=a.id(r[_]);if(d===null)continue;let g=u.id(r[_+1]);if(g===null)continue;let v=a.data(d).type,D=u.data(g).type;v===D&&(h[p+0]=v,h[p+1]=d,h[p+2]=g,p+=3)}for(let _=0;_<o.length;++_){let d=o[_];if(d!==this){for(let g=0;g<h.length;g+=3){let v=h[g+0],D=n[h[g+1]],M=d.TLB[h[g+2]],k=i.getNewValue(D,v);i.setNewValue(M,v,k),i.setOldValue(M,v,k)}i.inc(),yield*d.computeSchema(),d.copyNewValuesToOld(),i.dec();for(let g=0;g<h.length;g+=3){let v=h[g+0],D=n[h[g+1]],M=d.TLB[h[g+2]],k=i.getNewValue(M,v);i.setNewValue(D,v,k)}}}}stratum_setCapture(t,s,r){let i=this.resolve(s);!i||i.proto.vars().msgVarId<0||this.prj.env.setCapture(i,t,r)}stratum_registerObject(t,s,r,i,n){let o=this.resolve(r);!o||o.proto.vars().msgVarId<0||this.prj.env.subscribe(o,t,s,i,n)}stratum_unregisterObject(t,s,r){let i=this.resolve(s);!i||i.proto.vars().msgVarId<0||this.prj.env.unsubscribe(i,t,r)}};Re(me,"schema");var Ce=class{constructor(t,s){this.level=0,this._shouldClose=!1,this.env=t,this.dir=s.dir,this.filepath=s.filepath;let r=s.classes.get(s.prjInfo.rootClassName);if(!r)throw Error(`\u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${s.prjInfo.rootClassName} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);Pe.clear();let i=r.schema((...o)=>new me(this,...o));Pe.size>0&&console.warn(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0438\u043B\u0438 \u043D\u0435\u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 (${Pe.size}):
${[...Pe.values()].join(`
`)}`);let n=i.createTLB();this.oldFloats=new Float64Array(n.floatsCount),this.newFloats=new Float64Array(n.floatsCount),this.oldInts=new Int32Array(n.intsCount),this.newInts=new Int32Array(n.intsCount),this.oldStrings=new Array(n.stringsCount).fill(""),this.newStrings=new Array(n.stringsCount).fill(""),this.olds=[],this.olds[I.Float]=this.oldFloats,this.olds[I.Handle]=this.oldInts,this.olds[I.ColorRef]=this.oldInts,this.olds[I.String]=this.oldStrings,this.news=[],this.news[I.Float]=this.newFloats,this.news[I.Handle]=this.newInts,this.news[I.ColorRef]=this.newInts,this.news[I.String]=this.newStrings,i.applyDefaults(),s.stt&&i.applyVarSet(s.stt),this.root=i}canExecute(){return this.level<59}inc(){++this.level}dec(){--this.level}setOldValue(t,s,r){this.olds[s][t]=r}setNewValue(t,s,r){this.news[s][t]=r}getNewValue(t,s){return this.news[s][t]}shouldClose(){return this._shouldClose}stratum_closeAll(){this._shouldClose=!0}stratum_openSchemeWindow(t,s,r){return this.env.openSchemeWindow(this,t,s,r)}stratum_async_loadSpaceWindow(t,s,r){return this.env.loadSpaceWindow(this,t,s,r)}stratum_async_createWindowEx(t,s,r,i,n,o,a,u){return this.env.createWindowEx(this,t,s,r,i,n,o,a,u)}stratum_async_createDIB2d(t,s){return this.env.createDIB2d(this.dir,t,s)}stratum_async_createDoubleDib2D(t,s){return this.env.createDoubleDib2D(this.dir,t,s)}stratum_loadCursor(t,s){this.env.loadCursor(this.dir,t,s)}stratum_async_createObjectFromFile2D(t,s,r,i,n){return this.env.createObjectFromFile2D(this.dir,t,s,r,i,n)}stratum_async_createStream(t,s,r){return this.env.createStream(this.dir,t,s,r)}stratum_async_mSaveAs(t,s,r){return this.env.mSaveAs(this.dir,t,s,r)}stratum_async_mLoad(t,s,r){return this.env.mLoad(this.dir,t,s,r)}stratum_async_createDir(t){return j(this,null,function*(){let s=this.dir.resolve(t);return(yield s.fs.createDir(s))?1:0})}stratum_async_fileExist(t){return j(this,null,function*(){let s=this.dir.resolve(t);return(yield s.fs.fileExist(s))?1:0})}stratum_getProjectDirectory(){return this.dir.toString()}};Re(Ce,"prj");var qt=class{constructor(){this.fields=[]}insert(t){if(t==="FLOAT")return this.fields.push({type:t,value:0}),1;if(t==="HANDLE")return this.fields.push({type:t,value:0}),1;if(t==="STRING")return this.fields.push({type:t,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${t}`)}insertClass(t){let s=t.map(r=>{let i=r[0].toUpperCase();switch(r[1]){case I.Float:return[i,{type:"FLOAT",value:0}];case I.String:return[i,{type:"STRING",value:""}];default:return[i,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",value:new Map(s)}),1}set(t,s,r){if(t<0||t>this.fields.length-1)return;let i=this.fields[t];if(i.type==="STRUCT"){let n=i.value.get(s.toUpperCase());if(!n)return;i=n}if(typeof r=="string"){if(i.type!=="STRING")return;i.value=r}else{if(i.type==="STRING")return;i.value=r}}remove(t){return this.fields.splice(t,1).length?1:0}count(){return this.fields.length}type(t){return t<0||t>this.fields.length-1?"":this.fields[t].type}getFloat(t,s){if(t<0||t>this.fields.length-1)return 0;let r=this.fields[t];if(r.type==="STRUCT"){let i=r.value.get(s.toUpperCase());if(!i)return 0;r=i}return r.type==="FLOAT"?r.value:0}getHandle(t,s){if(t<0||t>this.fields.length-1)return 0;let r=this.fields[t];if(r.type==="STRUCT"){let i=r.value.get(s.toUpperCase());if(!i)return 0;r=i}return r.type==="HANDLE"?r.value:0}getString(t,s){if(t<0||t>this.fields.length-1)return"";let r=this.fields[t];if(r.type==="STRUCT"){let i=r.value.get(s.toUpperCase());if(!i)return"";r=i}return r.type==="STRING"?r.value:""}sort(t){if(!t||t.length===0)return this.fields.sort((s,r)=>s.value-r.value),1;if(t.length===1)return t[0].desc?this.fields.sort((s,r)=>r.value-s.value):this.fields.sort((s,r)=>s.value-r.value),1;throw console.log(t),new Error("\u0421\u043E\u0440\u0442\u0438\u0432\u0440\u043E\u043A\u0430 \u043F\u043E \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};var wt=class{constructor(t){this.minX=t.minX,this.minY=t.minY,this.rows=t.rows,this.cols=t.cols,this.data=t.data?new Float64Array(t.data):new Float64Array(this.rows*this.cols)}get(t,s){let r=t-this.minX,i=s-this.minY;return r<0||i<0||r>=this.rows||i>=this.cols?0:this.data[r*this.cols+i]}set(t,s,r){let i=t-this.minX,n=s-this.minY;return i<0||n<0||i>=this.rows||n>=this.cols?0:(this.data[i*this.cols+n]=r,r)}fill(t){return this.data.fill(t),1}};var Me=class{static widthToSize(t){return t<0||t>9?0:Me.widthTable[t]}constructor(t={}){var r;let s=t.data;s?s instanceof ArrayBuffer?this.v=new DataView(s.slice(0)):this.v=new DataView(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)):this.v=new DataView(new ArrayBuffer(0)),this.p=0,this.width=8,this.onflush=(r=t.file)!=null?r:null}copyTo(t,s,r){return s<0||s+r>this.v.byteLength?0:(t.v.byteLength<r?t.v=new DataView(this.v.buffer.slice(s,r)):new Uint8Array(t.v.buffer).set(new Uint8Array(this.v.buffer,s,r)),1)}seek(t){return this.p=t}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(t){return this.width=t,1}widthNumber(){let t=Me.widthToSize(this.width);if(t===0)return 0;let s=this.p,r=s+t;if(r>this.size())return 0;switch(this.p=r,this.width){case 0:return this.v.getUint8(s);case 1:return this.v.getInt8(s);case 2:return this.v.getUint16(s,!0);case 3:return this.v.getInt16(s,!0);case 4:return this.v.getUint32(s,!0);case 5:return this.v.getInt32(s,!0);case 6:return this.v.getFloat32(s,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(s,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(t){let s=new Uint8Array(new ArrayBuffer(t));s.set(new Uint8Array(this.v.buffer)),this.v=new DataView(s.buffer)}writeWidthNumber(t){let s=Me.widthToSize(this.width);if(s===0)return 0;let r=this.p,i=r+s;switch(i>this.size()&&this.resize(i),this.p=i,this.width){case 0:return this.v.setUint8(r,t),1;case 1:return this.v.setInt8(r,t),1;case 2:return this.v.setUint16(r,t,!0),2;case 3:return this.v.setInt16(r,t,!0),2;case 4:return this.v.setUint32(r,t,!0),4;case 5:return this.v.setInt32(r,t,!0),4;case 6:return this.v.setFloat32(r,t,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(r,t,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}text(){return Je(new Uint8Array(this.v.buffer))}line(){let t=this.p,s=this.size()-t;if(s<=0)return"";let r=0,i=0;for(;r<s;){let o=this.v.getUint8(t+r);if(o===0){i=1;break}if(o===Me.slashR&&r+1<s&&this.v.getInt8(t+r+1)===Me.slashN){i=2;break}r+=1}let n=Je(new Uint8Array(this.v.buffer,t,r));return this.p=t+r+i,n}writeLine(t){let s=t+`\r
`,r=this.p,i=r+s.length;i>this.size()&&this.resize(i),this.p=i;let n=ks(s);for(let o=0;o<n.length;++o)this.v.setUint8(r,n[o]),r+=1;return s.length}close(){return this.onflush?this.onflush.write(this.v.buffer):!0}},Se=Me;Se.slashR="\r".charCodeAt(0),Se.slashN=`
`.charCodeAt(0),Se.widthTable=[1,1,2,2,4,4,4,5,8,10];var Qt=class{constructor(t,s,r){this.view=t;this.parent=s;this.lastVisible=!0;var n,o,a,u,h;let i=(n=r.position)!=null?n:{x:0,y:0};this.pos=i,this.lastX=(i.x-s.scene.offsetX())*s.scale,this.lastY=(i.y-s.scene.offsetY())*s.scale,this.lastW=(a=(o=r.size)==null?void 0:o.width)!=null?a:0,this.lastH=(h=(u=r.size)==null?void 0:u.height)!=null?h:0,t.style.setProperty("position","absolute"),t.style.setProperty("left",this.lastX+"px"),t.style.setProperty("top",this.lastY+"px"),t.style.setProperty("width",this.lastW+"px"),t.style.setProperty("height",this.lastH+"px"),s.scene.view.appendChild(t)}close(){this.view.remove()}originX(){return this.pos.x}originY(){return this.pos.y}setOrigin(t,s){this.pos={x:t,y:s};let r=(t-this.parent.scene.offsetX())*this.parent.scale;r!==this.lastX&&(this.lastX=r,this.view.style.setProperty("left",r+"px"));let i=(s-this.parent.scene.offsetY())*this.parent.scale;i!==this.lastY&&(this.lastY=i,this.view.style.setProperty("top",i+"px"))}setVisibility(t){t!==this.lastVisible&&(this.lastVisible=t,this.view.style.setProperty("display",t?"block":"none"))}width(){return this.lastW}clientWidth(){return this.lastW}height(){return this.lastH}clientHeight(){return this.lastH}setSize(t,s){this.setClientSize(t,s)}setClientSize(t,s){this.lastW!==t&&(this.lastW=t,this.view.style.setProperty("width",t+"px")),this.lastH!==s&&(this.lastH=s,this.view.style.setProperty("height",s+"px"))}};var z=class{constructor(t,s,r){this.scene=t;this._visible=s;this._layer=r}visible(){return this._visible&&(this._layer&this.scene._layers)==0}setVisible(t){return this._visible===t?this:(this._visible=t,this.scene._dirty=!0,this)}clone(){return new z(this.scene,this._visible,this._layer)}};var et=class extends z{visible(){return!1}clone(){return new et(this.scene,this._visible,this._layer)}};var tt=class{clone(){return new tt}};var Z=class{constructor(t,s=0){this.scene=t;this.handle=s;this.subs=new Set}_subscribe(t){this.subs.add(t)}_unsubscribe(t){this.subs.delete(t)}subCount(){return this.subs.size}dispatchChanges(){this.subs.size!==0&&(this.subs.forEach(t=>++t._ver),this.scene._dirty=!0)}};var Jt=class extends Z{constructor(t,{handle:s,color:r,style:i,hatch:n,rop:o,image:a}={}){super(t,s);this._color=r!=null?r:0,this._style=i!=null?i:0,this._hatch=n!=null?n:0,this._rop=o!=null?o:0,this.image=new X(t,a!=null?a:null)}color(){return this._color}setColor(t){this._color=t,this.dispatchChanges()}style(){return this._style}setStyle(t){this._style=t,this.dispatchChanges()}hatch(){return this._hatch}setHatch(t){this._hatch=t,this.dispatchChanges()}rop(){return this._rop}setRop(t){this._rop=t,this.dispatchChanges()}};var ol=9,al=10,ll=0,ul=1,cl=3,er=class extends Jt{constructor(){super(...arguments);this._prevColor=0;this._cssColor=he(this._prevColor)}cssColor(){return this._prevColor!==this._color&&(this._prevColor=this._color,this._cssColor=he(this._color)),this._cssColor}blendMode(){switch(this._rop){case ol:return"multiply";case al:return"multiply";default:return null}}fillStyle(){switch(this._style){case ll:return this.cssColor();case ul:return"transparent";case cl:return"black";default:return"white"}}};var tr=class extends Z{constructor(t,s,{handle:r,name:i,style:n}={}){super(t,r);this._size=s,this._name=i!=null?i:"Arial",this._style=n!=null?n:0}name(){return this._name}setName(t){return this._name=t,this.dispatchChanges(),this}size(){return this._size}setSize(t){return this._size=t,this.dispatchChanges(),this}style(){return this._style}setStyle(t){return this._style=t,this.dispatchChanges(),this}};var rr=class extends tr{constructor(){super(...arguments);this._prevName="";this._realName="";this._scaleThis=!1}fstyle(){return this._style&1?"italic":"normal"}tdecoration(){let t=this._style&2?"underline":"",s=this._style&4?"line-through":"";return t+" "+s}fweight(){return this._style&8?"bold":"normal"}scaleThis(){let t=this._name;if(this._prevName!==t){this._prevName=t;let s=t.toUpperCase().endsWith(" CYR");this._realName=s?t.slice(0,t.length-4):t,this._scaleThis=s}return this._scaleThis}fname(){return this.scaleThis(),this._realName}toCSSString(){return`${this._style&8?"bold":""} ${this._style&1?"italic":""} ${this._size*rr.fuckthisshit}px ${this.fname()}`}},yt=rr;yt.fuckthisshit=us(.752812499999996,2);var sr=class extends oe{constructor(t,s,r,i={}){super(t,i);this.isTransparent=s;this.type="image";this._cropVer=0;var n,o,a,u,h,p,T;this._crop=(n=i.crop)!=null?n:null,this._updateBBox((o=i.x)!=null?o:0,(a=i.y)!=null?a:0,(u=i.width)!=null?u:r.width(),(h=i.height)!=null?h:r.height()),(p=this._parent)==null||p._recalcBorders(),this.visib=(T=i.visib)!=null?T:new z(t,!0,0),this.image=new X(t,r)}cropArea(){return this._crop}setCropArea(t){return this._crop=t,++this._cropVer,this}};var nr=class extends sr{constructor(t,s,r,i={}){super(t,s,r,i);this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;this.prevImageVer=-1;this.prevCropVer=-1;this._svg.setAttribute("preserveAspectRatio","none"),this._svg.appendChild(this.img=document.createElementNS("http://www.w3.org/2000/svg","image"))}render(){let t=this.visib.visible();if(this.prevVisible!==t&&(this.prevVisible=t,t?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!t)return;let s=this.image._tool;if(this.image._ver!==this.prevImageVer){this.prevImageVer=this.image._ver;let a=s.img();a&&this.img.setAttribute("href",a.canvas.toDataURL())}if(this._cropVer!==this.prevCropVer){this.prevCropVer=this._cropVer;let a=this._crop;a?this._svg.setAttribute("viewBox",`${a.x} ${a.y} ${a.w} ${a.h}`):this._svg.setAttribute("viewBox",`0 0 ${s.width()} ${s.height()}`)}let r=this._x-this.scene._offsetX;r!==this.prevOx&&(this.prevOx=r,this._svg.setAttribute("x",r.toString()));let i=this._y-this.scene._offsetY;i!==this.prevOy&&(this.prevOy=i,this._svg.setAttribute("y",i.toString()));let n=this._width;this.prevWidth!==n&&(this.prevWidth=n,this._svg.setAttribute("width",n.toString()));let o=this._height;this.prevHeight!==o&&(this.prevHeight=o,this._svg.setAttribute("height",o.toString()))}};var ir=class extends oe{constructor(t,s={}){super(t,s);this.type="input";var r,i;this.visib=(r=s.visib)!=null?r:new z(t,!0,0),this.font=new X(t,(i=s.font)!=null?i:null)}};var or=class extends ir{constructor(t,s={}){super(t,s);this._svg=!1;this._html=document.createElement("input");this.st=this._html.style;this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;this._prevFontVer=-1;var i;let r=this._html;r.setAttribute("type","text"),r.setAttribute("class","stratum-textbox"),this.st.setProperty("position","absolute"),r.value=(i=s.text)!=null?i:"",r.addEventListener("input",this),r.addEventListener("focus",this),r.addEventListener("blur",this)}handleEvent(t){this.scene._dispatchInputEvent(this,t)}text(){return this._html.value}setText(t){return this._html.value=t,this}render(){let t=this.visib.visible();if(this.prevVisible!==t&&(this.prevVisible=t,t?this.st.removeProperty("display"):this.st.setProperty("display","none")),!t)return;if(this._prevFontVer!==this.font._ver){this._prevFontVer=this.font._ver;let o=this.font._tool;o?this.st.setProperty("font",o.toCSSString()):this.st.removeProperty("font")}let s=this._x-this.scene._offsetX;s!==this.prevOx&&(this.prevOx=s,this.st.setProperty("left",s.toString()+"px"));let r=this._y-this.scene._offsetY;r!==this.prevOy&&(this.prevOy=r,this.st.setProperty("top",r.toString()+"px"));let i=this._width;this.prevWidth!==i&&(this.prevWidth=i,this.st.setProperty("width",i.toString()+"px"));let n=this._height;this.prevHeight!==n&&(this.prevHeight=n,this.st.setProperty("height",n.toString()+"px"))}};var ar=class extends oe{constructor(t,s,r={}){super(t,r);this.type="line";this._shapeVer=0;var p,T,_,d;if(s.length<2)throw Error("\u041B\u0438\u043D\u0438\u044F \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u043E\u0447\u0435\u043A");let i=s[0],n=s[1],o=i,a=n;for(let g=2;g<s.length;g+=2){let v=s[g+0],D=s[g+1];v<i&&(i=v),v>o&&(o=v),D<n&&(n=D),D>a&&(a=D)}this._coords=s.slice();for(let g=0;g<s.length;g+=2)this._coords[g+0]-=i,this._coords[g+1]-=n;let u=o-i,h=a-n;this._updateBBox(i,n,u,h),(p=this._parent)==null||p._recalcBorders(),this.visib=(T=r.visib)!=null?T:new z(t,!0,0),this.pen=new X(t,(_=r.pen)!=null?_:null),this.brush=new X(t,(d=r.brush)!=null?d:null)}px(t){let s=t*2;return s<0||s>=this._coords.length?0:this._coords[s+0]+this._x}py(t){let s=t*2;return s<0||s>=this._coords.length?0:this._coords[s+1]+this._y}pointsChanged(){var h;let t=Infinity,s=-Infinity,r=Infinity,i=-Infinity;for(let p=0;p<this._coords.length;p+=2){let T=this._coords[p+0],_=this._coords[p+1];T<t&&(t=T),T>s&&(s=T),_<r&&(r=_),_>i&&(i=_)}let n=this._x,o=this._y;if(t!==0||r!==0){for(let p=0;p<this._coords.length;p+=2)this._coords[p+0]-=t,this._coords[p+1]-=r;n+=t,o+=r}let a=s-t,u=i-r;++this._shapeVer,this._updateBBox(n,o,a,u),(h=this._parent)==null||h._recalcBorders()}add(t,s,r){if(t===0)return!1;let i=s-this._x,n=r-this._y,o=t*2;return o<0||o>=this._coords.length?this._coords.push(i,n):this._coords.splice(o,0,i,n),this.pointsChanged(),!0}update(t,s,r){let i=t*2;if(i<0||i>=this._coords.length)return!1;let n=s-this._x,o=r-this._y;return this._coords[i+0]=n,this._coords[i+1]=o,this.pointsChanged(),!0}delete(t){let s=t*2;return s<0||s>=this._coords.length?!1:(this._coords.splice(s,2),this.pointsChanged(),!0)}pointCount(){return this._coords.length/2}_resized(t,s,r,i){for(let n=0;n<this._coords.length;n+=2)this._coords[n+0]*=r,this._coords[n+1]*=i;++this._shapeVer,super._resized(t,s,r,i)}_rotated(t,s,r){let i=Math.sin(r),n=Math.cos(r),o=t-this._x,a=s-this._y,u=Infinity,h=-Infinity,p=Infinity,T=-Infinity;for(let D=0;D<this._coords.length;D+=2){let M=this._coords[D+0]-o,k=this._coords[D+1]-a,W=M*n-k*i+o,Q=M*i+k*n+a;this._coords[D+0]=W,this._coords[D+1]=Q,W<u&&(u=W),W>h&&(h=W),Q<p&&(p=Q),Q>T&&(T=Q)}for(let D=0;D<this._coords.length;D+=2)this._coords[D+0]-=u,this._coords[D+1]-=p;let _=this._x+u,d=this._y+p,g=h-u,v=T-p;++this._shapeVer,this._updateBBox(_,d,g,v)}};var lr=class extends ar{constructor(t,s,r={}){super(t,s,r);this._svg=document.createElementNS("http://www.w3.org/2000/svg","polyline");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevPenVer=-1;this.prevBrushVer=-1;this.prevShapeVer=-1;this._svg.setAttribute("fill-rule","evenodd"),this._svg.setAttribute("stroke-linecap","round")}render(){let t=this.visib.visible();if(this.prevVisible!==t&&(this.prevVisible=t,t?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!t)return;let s=!1,r=this.brush._tool,i=this.pen._tool;if(this.pen._ver!==this.prevPenVer)if(this.prevPenVer=this.pen._ver,s=!0,i){let a=i.width()||1;this._svg.setAttribute("stroke-width",a.toString());let u=i.strokeStyle();this._svg.setAttribute("stroke",u)}else this._svg.removeAttribute("stroke");if(this.brush._ver!==this.prevBrushVer)if(this.prevBrushVer=this.brush._ver,s=!0,r)if(this._coords.length>4){let a=r.fillStyle();this._svg.setAttribute("fill",a);let u=r.blendMode();u?this._svg.style.setProperty("mix-blend-mode",u):this._svg.style.removeProperty("mix-blend-mode")}else this._svg.removeAttribute("fill");else this._svg.setAttribute("fill","none");if(s)if(!r&&!i){this._svg.setAttribute("display","none");return}else this._svg.removeAttribute("display");if(this._shapeVer!==this.prevShapeVer){this.prevShapeVer=this._shapeVer;let a="";for(let u=0;u<this._coords.length;u+=2)a+=this._coords[u]+","+this._coords[u+1]+" ";this._svg.setAttribute("points",a)}let n=this._x-this.scene._offsetX,o=this._y-this.scene._offsetY;(n!==this.prevOx||o!==this.prevOy)&&(this.prevOx=n,this.prevOy=o,this._svg.setAttribute("transform",`translate(${n}, ${o})`))}};var ur=class extends Z{constructor(t,{handle:s,color:r,width:i,style:n,rop:o}={}){super(t,s);this._color=r!=null?r:0,this._width=i!=null?i:1,this._style=n!=null?n:0,this._rop=o!=null?o:0}color(){return this._color}setColor(t){return this._color=t,this.dispatchChanges(),this}width(){return this._width}setWidth(t){return this._width=t,this.dispatchChanges(),this}style(){return this._style}setStyle(t){return this._style=t,this.dispatchChanges(),this}rop(){return this._rop}setRop(t){return this._rop=t,this.dispatchChanges(),this}};var ml=5,cr=class extends ur{constructor(){super(...arguments);this._prevColor=0;this._cssColor=he(this._prevColor)}cssColor(){return this._prevColor!==this._color&&(this._prevColor=this._color,this._cssColor=he(this._color)),this._cssColor}strokeStyle(){return this._style===ml?"transparent":this.cssColor()}};var Ue=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(t){if(this.running)return;let s=()=>{this.frameId=t()?requestAnimationFrame(s):0};this.frameId=requestAnimationFrame(s)}stop(){!this.running||(cancelAnimationFrame(this.frameId),this.frameId=0)}},mr=class{constructor(t=1){this.cycles=t;this.frameId=0}get running(){return this.frameId!==0}run(t){if(this.running)return;let s=()=>{for(let r=0;r<this.cycles;++r)if(!t()){this.frameId=0;return}this.frameId=setTimeout(s,0)};this.frameId=setTimeout(s)}stop(){!this.running||(clearTimeout(this.frameId),this.frameId=0)}};var nn=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]);var L=class extends ae{constructor(t){super(t);this.prevElements=this._elements;this.svgOrder=[];this.htmlOrder=[];this._rect=null;this.prevScale=1;this.handlers={pointerdown:new Set,pointermove:new Set,pointerup:new Set,keydown:new Set,keyup:new Set,keychar:new Set,inputState:new Set};let s=this.view=document.createElement("div");s.style.setProperty("overflow","hidden"),s.style.setProperty("position","relative"),s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),s.style.setProperty("background-color","white"),this.rootSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.rootSVG.addEventListener("selectstart",this),this.rootSVG.style.setProperty("width","100%"),this.rootSVG.style.setProperty("height","100%"),this.rootSVG.style.setProperty("transform-origin","top left"),this.rootSVG.style.setProperty("touch-action","pinch-zoom"),this.rootHTML=document.createElement("div"),this.rootHTML.style.setProperty("width","100%"),this.rootHTML.style.setProperty("height","100%"),this.rootHTML.style.setProperty("transform-origin","top left"),s.appendChild(this.rootSVG),s.appendChild(this.rootHTML),L.scenes.add(this),L.updater.run(L.redrawAll)}static redrawAll(){return L.scenes.forEach(t=>t.render()),L.scenes.size>0}static handleKeyboard(t){var i,n;let s=nn.get(t.code);typeof s!="undefined"&&(ae.keyState[s]=t.type==="keydown"?1:0);let r=s!=null?s:0;L.captureTarget!==L.focusedScene&&((i=L.captureTarget)==null||i.handleKeyboard(t,r)),(n=L.focusedScene)==null||n.handleKeyboard(t,r)}static handlePointer(t){var r,i,n;ae.keyState[1]=t.buttons&1,ae.keyState[2]=t.buttons&2,ae.keyState[4]=t.buttons&4,L._mouseX=t.clientX,L._mouseY=t.clientY;let s=t.target;if(((r=L.currentScene)==null?void 0:r.rootSVG)!==s){L.currentScene=null;for(let o of L.scenes)if(o.rootSVG.contains(s)){L.currentScene=o;break}}t.type==="pointerdown"&&(L.focusedScene=L.currentScene),L.captureTarget!==L.currentScene&&((i=L.captureTarget)==null||i.handlePointer(t)),(n=L.currentScene)==null||n.handlePointer(t)}rect(){return this._rect||(this._rect=this.view.getBoundingClientRect()),this._rect}render(){let t=this._elements,s=this._scale;if(this.prevScale!==s&&(this.prevScale=s,this.rootSVG.style.setProperty("transform",`scale(${s})`),this.rootSVG.style.setProperty("width",`${100/s}%`),this.rootSVG.style.setProperty("height",`${100/s}%`),this.rootHTML.style.setProperty("transform",`scale(${s})`),this.rootHTML.style.setProperty("width",`${100/s}%`),this.rootHTML.style.setProperty("height",`${100/s}%`)),this.prevElements!==t){let i=[],n=[];t.forEach(o=>{o._svg?i.push(o):n.push(o)}),this.svgOrder.length>0?L.reoderNRender(this.rootSVG,i,this.svgOrder):this.rootSVG.append(...i.map(o=>o._svg)),this.svgOrder=i,this.htmlOrder.length>0?L.reoderNRender(this.rootHTML,n,this.htmlOrder):this.rootHTML.append(...n.map(o=>o._html)),this.htmlOrder=n,this.prevElements=t}else t.forEach(i=>i.render());return this._rect=null,this}static reoderNRender(t,s,r){let i=0,n=null,o=new Set(r);s.forEach(a=>{if(o.delete(a),i<r.length&&a===r[i])++i;else{let u=n?n.nextElementSibling:t.firstElementChild;t.insertBefore(a._svg||a._html,u)}n=a._svg||a._html,a.render()}),o.forEach(a=>(a._svg||a._html).remove())}elementAtPoint(t,s){let r=this.rect(),i=r.left+(t-this._offsetX)*this.prevScale,n=r.top+(s-this._offsetY)*this.prevScale,o=document.elementsFromPoint(i,n);if(o.length===0)return null;for(let a of o){let u=this.svgOrder.find(h=>h._svg.contains(a));if(u)return u}return null}setCapture(){return L.captureTarget=this,this}releaseCapture(){return L.captureTarget=null,this}on(t,s){return this.handlers[t].add(s),this}off(t,s){return s?this.handlers[t].delete(s):this.handlers[t].clear(),this}mouseCoords(){let t=this.rect(),s=(L._mouseX-t.left)/this.prevScale+this._offsetX,r=(L._mouseY-t.top)/this.prevScale+this._offsetY;return[s,r]}handlePointer(t){let s=t.type,r=this.rect(),i=(t.clientX-r.left)/this.prevScale,n=(t.clientY-r.top)/this.prevScale,o=i+this._offsetX,a=n+this._offsetY,{button:u,buttons:h}=t,p=t.target!==t.currentTarget&&this.svgOrder.find(_=>_._svg.contains(t.target))||null,T={target:this,type:s,clickX:i,clickY:n,x:o,y:a,buttons:h,button:u,element:p};this.handlers[s].forEach(_=>_(T))}handleKeyboard(t,s){let r=1,i=0,n=t.type,o={type:n,target:this,repeat:r,scan:i,key:s};if(this.handlers[n].forEach(a=>a(o)),n==="keydown"){if(s>36&&s<41||s===46||s===45)return;let a=Oe.indexOf(t.key),u=a<0?s:a,h={type:"keychar",target:this,repeat:r,scan:i,key:u};this.handlers[n].forEach(p=>p(h))}}beforeRemove(){L.currentScene===this&&(L.currentScene=null),L.focusedScene===this&&(L.focusedScene=null),L.captureTarget===this&&(L.captureTarget=null)}handleEvent(t){t.preventDefault()}_dispatchInputEvent(t,s){switch(s.type){case"input":case"blur":break;case"focus":L.focusedScene=null;break;default:return}let i={type:s.type,target:this,element:t};this.handlers.inputState.forEach(n=>n(i))}toDataURL(t,s,r,i){let n=new XMLSerializer().serializeToString(this.rootSVG);n.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(n=n.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),n.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(n=n.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),n=`<?xml version="1.0" standalone="no"?>\r
`+n;let o="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n);return["svg",o]}},q=L;q.scenes=new Set,q.updater=new Ue,q.focusedScene=null,q.captureTarget=null,q.currentScene=null,q._mouseX=0,q._mouseY=0;window.addEventListener("pointerdown",q.handlePointer);window.addEventListener("pointermove",q.handlePointer);window.addEventListener("pointerup",q.handlePointer);window.addEventListener("keydown",q.handleKeyboard);window.addEventListener("keyup",q.handleKeyboard);var hr=class extends oe{constructor(t,s,r={}){super(t,r);this.type="text";var i,n;this._angle=(i=r.angle)!=null?i:0,this.visib=(n=r.visib)!=null?n:new z(t,!0,0),this.tool=new X(t,s)}angle(){return this._angle}_rotated(t,s,r){super._rotated(t,s,r),this._angle+=r}};function on(){return document.createElementNS("http://www.w3.org/2000/svg","tspan")}var pr=class{constructor(t,s){this.owner=t;this.part=s;this._prevFontVer=-1;this._prevText="";this._prevFg=-1;this._prevBg=-1;let r=s.str._tool.textParts();this._spans=r.map(()=>on())}render(){var o;let t=!1,s=this.part,r=s.str._tool.text();if(this._prevText!==r){this._prevText=r;let a=s.str._tool.textParts(),u=a.length-this._spans.length;if(u!==0)if(this._spans.forEach(h=>{h.removeAttribute("x"),h.removeAttribute("dy")}),this._prevFontVer=-1,this._prevFg=-1,this._prevBg=-1,u>0)for(;u!==0;){let h=on();this._spans.push(h),this.owner._svg.append(h),--u}else for(;u!==0;)(o=this._spans.pop())==null||o.remove(),++u;this._spans.forEach((h,p)=>{p>0&&(h.setAttribute("x","0px"),h.setAttribute("dy","1.15em")),h.innerHTML=a[p]||"&#8203;"}),t=!0}if(this._prevFontVer!==s.font._ver){this._prevFontVer=s.font._ver;let a=s.font._tool;this._spans.forEach(u=>{u.setAttribute("font-family",a.fname()),u.setAttribute("font-size",a.size().toString()),u.setAttribute("font-style",a.fstyle()),u.setAttribute("text-decoration",a.tdecoration()),u.setAttribute("font-weight",a.fweight())}),t=!0}let i=this.part.fgColor();if(this._prevFg!==i){this._prevFg=i;let a=he(i);this._spans.forEach(u=>u.setAttribute("fill",a))}let n=this.part.bgColor();if(this._prevBg!==n){this._prevBg=n;let a=he(n);a==="transparent"?this._spans.forEach(u=>u.removeAttribute("filter")):this._spans.forEach(u=>u.setAttribute("filter",`drop-shadow(0px 0px 6px ${a})`))}return t}};var fr=class extends hr{constructor(t,s,r={}){super(t,s,r);this._svg=document.createElementNS("http://www.w3.org/2000/svg","text");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;this.prevAngle=0;this.bbox=null;var n,o,a,u,h;let i=document.createDocumentFragment();this.spans=s.parts.map(p=>{let T=new pr(this,p);return T._spans.forEach(_=>i.append(_)),T}),this._svg.setAttribute("dominant-baseline","text-before-edge"),this._svg.setAttribute("alignment-baseline","text-before-edge"),this._svg.setAttribute("letter-spacing","-0.07"),this._svg.style.setProperty("white-space","pre"),this._svg.style.setProperty("user-select","none"),this._svg.appendChild(i),this._updateBBox((n=r.x)!=null?n:0,(o=r.y)!=null?o:0,(a=r.width)!=null?a:this.actualWidth(),(u=r.height)!=null?u:this.actualHeight()),(h=this._parent)==null||h._recalcBorders()}getBbox(){if(this.render(),!this.bbox){let t=this._svg.parentElement;t||this.scene.rootSVG.appendChild(this._svg),this.bbox=this._svg.getBBox(),t||this._svg.remove()}return this.bbox}actualWidth(){return this.getBbox().width}actualHeight(){let t=0;return this.tool._tool.parts.forEach(s=>{let r=s.font._tool.size();r>t&&(t=r)}),t*1.15}render(){let t=this.visib.visible();if(this.prevVisible!==t&&(this.prevVisible=t,t?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!t)return;let s=!1;this.spans.forEach(o=>{let a=o.render();s=s||a}),s&&(this.bbox=null);let r=this._x-this.scene._offsetX,i=this._y-this.scene._offsetY,n=this._angle;(r!==this.prevOx||i!==this.prevOy||this.prevAngle!==n)&&(this.prevOx=r,this.prevOy=i,this.prevAngle=n,this._svg.setAttribute("transform",`translate(${r}, ${i}), rotate(${n*180/Math.PI})`))}};var br=class extends Z{constructor(t,s,{handle:r}={}){super(t,r);this._imgVer=0;this._img=s}img(){return this._img}width(){var t,s;return(s=(t=this._img)==null?void 0:t.canvas.width)!=null?s:0}height(){var t,s;return(s=(t=this._img)==null?void 0:t.canvas.height)!=null?s:0}setPixel(t,s,r){if(!this._img)return this;let i=this._img.createImageData(1,1),n=i.data;return n[0]=Ye(r),n[1]=Ke(r),n[2]=ze(r),n[3]=255,this._img.putImageData(i,t,s),++this._imgVer,this.dispatchChanges(),this}pixel(t,s){if(!this._img)return 0;let r=this._img.getImageData(t,s,1,1).data;return xe(r[0],r[1],r[2],0)}};var gr=class extends Z{constructor(t,s,{handle:r}={}){super(t,r);this._textVer=0;this.prevTextVer=-1;this._textParts=[];this._text=s}text(){return this._text}setText(t){return this._text=t,++this._textVer,this.dispatchChanges(),this}textParts(){return this.prevTextVer!==this._textVer&&(this.prevTextVer=this._textVer,this._textParts=this._text.split(`\r
`).join(`
`).split(`
`)),this._textParts}};var dr=class extends Z{constructor(t,s,r,{handle:i,bgColor:n,fgColor:o}={}){super(t,i);this._fgColorVer=0;this._bgColorVer=0;this._fgColor=o!=null?o:0,this._bgColor=n!=null?n:xe(0,0,0,1),this.font=new X(t,s),this.str=new X(t,r)}fgColor(){return this._fgColor}setFgColor(t){return this._fgColor=t,++this._fgColorVer,this.dispatchChanges(),this}bgColor(){return this._bgColor}setBgColor(t){return this._bgColor=t,++this._bgColorVer,this.dispatchChanges(),this}};var _r=class extends Z{constructor(t,s,{handle:r}={}){super(t,r);this.parts=s==null?void 0:s.map(({bgColor:i,fgColor:n,font:o,str:a})=>new dr(t,o,a,{bgColor:i,fgColor:n}))}};var V={pen:cr,brush:er,dib:br,font:yt,str:gr,ttool:_r,line:lr,bitmap:nr,text:fr,input:or,scene:q};function vt(e,t){let s=t==null?void 0:t.map(r=>{let i={handle:r.handle,color:r.color,rop:r.rop2,style:r.style,width:r.width};return[r.handle,new V.pen(e,i)]});return new Map(s)}function an(e,t){let s=B.getFreeHandle(e.pens),r=new V.pen(e.scene,{handle:s,color:t.color(),rop:t.rop(),style:t.style(),width:t.width()});return e.pens.set(s,r),r}function It(e,t,s){let r=s==null?void 0:s.map(i=>{let n={handle:i.handle,color:i.color,rop:i.rop2,style:i.style,hatch:i.handle,image:t.get(i.dibHandle)};return[i.handle,new V.brush(e,n)]});return new Map(r)}function ln(e,t){let s=t.image.tool(),r=B.getFreeHandle(e.brushes),i=new V.brush(e.scene,{handle:r,color:t.color(),hatch:t.hatch(),rop:t.rop(),style:t.style(),image:s?Tr(e,e.dibs,s):null});return e.brushes.set(r,i),i}function We(e,t){let s=t==null?void 0:t.map(r=>{let i=r.type==="image"?r.img:null,n={handle:r.handle};return[r.handle,new V.dib(e,i,n)]});return new Map(s)}function Tr(e,t,s){let r=B.getFreeHandle(t),i=new V.dib(e.scene,s.img(),{handle:r});return t.set(r,i),i}function xt(e,t){let s=t==null?void 0:t.map(r=>{let i={handle:r.handle,name:r.fontName,style:(r.italic?1:0)|(r.underline?2:0)|(r.strikeOut?4:0)|(r.weight?8:0)};return[r.handle,new V.font(e,r.height<0?r.height*-1:r.height,i)]});return new Map(s)}function Sr(e,t){let s=B.getFreeHandle(e.fonts),r=new V.font(e.scene,t.size(),{handle:s,name:t.name(),style:t.style()});return e.fonts.set(s,r),r}function Dt(e,t){let s=t==null?void 0:t.map(r=>{let i={handle:r.handle};return[r.handle,new V.str(e,r.text,i)]});return new Map(s)}function hl(e,t){let s=B.getFreeHandle(e.strings),r=new V.str(e.scene,t.text(),{handle:s});return e.strings.set(s,r),r}function At(e,t,s,r){let i=r==null?void 0:r.map(n=>{let o=n.textCollection.map(u=>{let h=t.get(u.fontHandle);if(!h)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0428\u0440\u0438\u0444\u0442 #${u.fontHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let p=s.get(u.stringHandle);if(!p)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0421\u0442\u0440\u043E\u043A\u0430 #${u.stringHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);return{fgColor:u.fgColor,bgColor:u.bgColor,font:h,str:p}}),a={handle:n.handle};return[n.handle,new V.ttool(e,o,a)]});return new Map(i)}function un(e,t){let s=B.getFreeHandle(e.texts),r=t.parts.map(n=>({font:Sr(e,n.font.tool()),str:hl(e,n.str.tool()),fgColor:n.fgColor(),bgColor:n.bgColor()})),i=new V.ttool(e.scene,r,{handle:s});return e.texts.set(s,i),i}function pl(e){return!!(e&1)}function fl(e){return!(e&8)}function bl(e){let t=e>>8&31;return 1<<t}function Rt(e,t,s){let r=new Set,i=o=>{let a=pl(o.options),u=bl(o.options),h=fl(o.options),p=new(a?et:z)(e,!0,u),T=h?null:new tt;switch(o.type){case"group":{let _={handle:o.handle,name:o.name,meta:o.hyperbase},d=new Te(e,_);return r.add({g:d,h:o.childHandles}),[o.handle,d]}case"line":{let _={handle:o.handle,name:o.name,meta:o.hyperbase,visib:p,unselectable:T,pen:t.pens.get(o.penHandle),brush:t.brushes.get(o.brushHandle)};return[o.handle,new V.line(e,o.coords,_)]}case"text":{let _=t.texts.get(o.textToolHandle);if(!_)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0422\u0435\u043A\u0441\u0442 #${o.textToolHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let d={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:o.width,height:o.height,angle:-o.angle/10*Math.PI/180,visib:p,unselectable:T};return[o.handle,new V.text(e,_,d)]}case"control":{if(o.inputType!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${o.inputType} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);let _={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:o.width,height:o.height,text:o.text,visib:p,unselectable:T};return[o.handle,new V.input(e,_)]}case"bitmap":case"doubleBitmap":{let _=o.type==="doubleBitmap",d=(_?t.doubleDibs:t.dibs).get(o.dibHandle);if(!d)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0431\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430 #${o.dibHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let g={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:a?1:o.width,height:a?1:o.height,visib:p,unselectable:T,crop:{x:o.cropX,y:o.cropY,w:o.cropW,h:o.cropH}};return[o.handle,new V.bitmap(e,_,d,g)]}case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}},n=new Map(s==null?void 0:s.map(i));return r.forEach(({g:o,h:a})=>{let u=a.map(h=>{let p=n.get(h);if(!p)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${h} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);return p});o.setChildren(u)}),n}function Er(e,t){var i,n,o,a;if(t.type==="group"){let u=t.children().map(T=>Er(e,T)),h=B.getFreeHandle(e.objects),p=new Te(e.scene,{handle:h,meta:t.meta,name:t.name,children:u});return e.objects.set(h,p),p}let s,r=B.getFreeHandle(e.objects);switch(t.type){case"line":{let u=t.pointCount(),h=new Array(u*2);for(let _=0;_<u;++_)h[_*2]=t.px(_),h[_*2+1]=t.py(_);let p=t.pen.tool(),T=t.brush.tool();s=new V.line(e.scene,h,{handle:r,meta:t.meta,name:t.name,unselectable:(i=t.unselectable)==null?void 0:i.clone(),visib:t.visib.clone(),brush:T?ln(e,T):null,pen:p?an(e,p):null});break}case"image":{let u=Tr(e,t.isTransparent?e.doubleDibs:e.dibs,t.image.tool());s=new V.bitmap(e.scene,t.isTransparent,u,{handle:r,meta:t.meta,name:t.name,unselectable:(n=t.unselectable)==null?void 0:n.clone(),visib:t.visib.clone(),x:t.x(),y:t.y(),width:t.width(),height:t.height(),crop:t.cropArea()});break}case"text":{let u=un(e,t.tool.tool());s=new V.text(e.scene,u,{handle:r,meta:t.meta,name:t.name,unselectable:(o=t.unselectable)==null?void 0:o.clone(),visib:t.visib.clone(),x:t.x(),y:t.y(),width:t.width(),height:t.height(),angle:t.angle()});break}case"input":{let u=t.font.tool();s=new V.input(e.scene,{handle:r,meta:t.meta,name:t.name,unselectable:(a=t.unselectable)==null?void 0:a.clone(),visib:t.visib.clone(),x:t.x(),y:t.y(),width:t.width(),height:t.height(),text:t.text(),font:u?Sr(e,u):null});break}}return e.objects.set(r,s),e.scene.setElements(e.scene.elements().concat(s)),s}function Pt(e,t){return e.map(s=>{let r=t.get(s);if(!r||r.type==="group")throw Error("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442 \u043D\u0435\u043F\u043E\u0434\u0445\u043E\u0434\u044F\u0449\u0435\u0433\u043E \u0442\u0438\u043F\u0430");return r})}var cn=["brushTools","penTools","dibTools","doubleDibTools","fontTools","stringTools","textTools"];function He(e){if(!!e)return e.map(t=>F({},t))}function mn(e){var s,r;let t=F({},e);return t.brushTools=He(e.brushTools),t.penTools=He(e.penTools),t.dibTools=He(e.dibTools),t.doubleDibTools=He(e.doubleDibTools),t.fontTools=He(e.fontTools),t.stringTools=He(e.stringTools),t.textTools=(s=e.textTools)==null?void 0:s.map(i=>F(F({},i),{textCollection:i.textCollection.map(n=>F({},n))})),t.elements=(r=e.elements)==null?void 0:r.map(i=>i.type==="group"?F(F({},i),{childHandles:i.childHandles.slice()}):F({},i)),t.elementOrder=e.elementOrder&&e.elementOrder.slice(),t}function hn(e,t){let s=e.find(r=>r.handle===t);if(!s||s.type!=="group")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${t}`);return s}function pn(e,t){let s=t.childHandles[0],r=e.find(i=>i.handle===s);if(!r||r.type!=="doubleBitmap")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0438\u043A\u043E\u043D\u043A\u0438 \u0438\u043C\u0438\u0434\u0436\u0430 #${t.handle}`);return r}function gl(e,t){let s=new Map,r=1;for(let i of t){for(;e.some(n=>n.handle===r);)++r;s.set(i.handle,r),i.handle=r,e.push(i)}return s}function dl(e,t){let s={};for(let r of cn){let i=t[r];if(!i)continue;let n=e[r];if(!n){e[r]=i;continue}s[r]=gl(n,i)}return s}function Ee(e,t,s){if(!!e)for(let r of e){let i=r[t];r[t]=s.get(i)||i}}function _l(e,t,s){switch(t){case"fontTools":{let{textTools:r}=e;r&&r.forEach(i=>Ee(i.textCollection,"fontHandle",s));break}case"stringTools":{let{textTools:r}=e;r&&r.forEach(i=>Ee(i.textCollection,"stringHandle",s));break}case"dibTools":{Ee(e.brushTools,"dibHandle",s);break}}}function Tl(e,t,s){switch(t){case"brushTools":let r=e.filter(u=>u.type==="line");Ee(r,"brushHandle",s);break;case"penTools":let i=e.filter(u=>u.type==="line");Ee(i,"penHandle",s);break;case"dibTools":let n=e.filter(u=>u.type==="bitmap");Ee(n,"dibHandle",s);break;case"doubleDibTools":let o=e.filter(u=>u.type==="doubleBitmap");Ee(o,"dibHandle",s);break;case"textTools":let a=e.filter(u=>u.type==="text");Ee(a,"textToolHandle",s);break}}function Sl(e,t){for(let s of cn){let r=t[s];!r||(_l(e,s,r),e.elements&&Tl(e.elements,s,r))}}function El(e){let t,s;for(let r of e)r.type!=="group"&&((t===void 0||r.originX<t)&&(t=r.originX),(s===void 0||r.originY<s)&&(s=r.originY));return{x:t||0,y:s||0}}function wl(e,t){return e.some(s=>s.type==="group"&&s.childHandles.includes(t.handle))}function yl(e,t,s){let r=new Map;if(t.length===0)return{map:r,rootHandle:0};let i=1,n=[];for(let a of t){for(;e.some(u=>u.handle===i);)++i;if(wl(t,a)||n.push(i),r.set(a.handle,i),a.handle=i,e.push(a),a.type!=="group"&&(a.originX+=s.x,a.originY+=s.y,a.type==="line")){a.coords=a.coords.slice();for(let u=0;u<a.coords.length;u+=2)a.coords[u+0]+=s.x,a.coords[u+1]+=s.y}}if(n.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u044A\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F \u0438\u043C\u0438\u0434\u0436\u0435\u0439");if(n.length===1)return{map:r,rootHandle:n[0]};for(;e.some(a=>a.handle===i);)++i;let o={type:"group",handle:i,childHandles:n,options:0};return e.push(o),{map:r,rootHandle:o.handle}}function vl(e,t){for(let s of e)s.type==="group"&&(s.childHandles=s.childHandles.map(r=>t.get(r)||r))}function Il(e,t){return e.map(s=>t.get(s)||s)}function xl(e){return e.elements!==void 0&&e.elements.length>0}var rt=class{static calcRect(t){if(t.length===0)return{x:0,y:0,w:0,h:0};let s=Infinity,r=-Infinity,i=Infinity,n=-Infinity;return t.forEach(o=>{o.type!=="group"&&(o.originX<s&&(s=o.originX),o.originX+o.width>r&&(r=o.originX+o.width),o.originY<i&&(i=o.originY),o.originY+o.height>n&&(n=o.originY+o.height))}),{x:s,y:i,w:r-s,h:n-i}}constructor(t){let s=mn(t);if(!xl(s))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=s}result(){return this.scheme}insertChildImage(t,s){let{scheme:r}=this,i=mn(s),n=dl(r,i);if(Sl(i,n),!i.elements)return;let o=hn(r.elements,t),a=pn(r.elements,o);a.options|=1;let u=El(i.elements),h={x:a.originX-u.x,y:a.originY-u.y},{map:p,rootHandle:T}=yl(r.elements,i.elements,h);if(vl(i.elements,p),o.childHandles.push(T),!i.elementOrder)return;let _=Il(i.elementOrder,p),d=r.elementOrder;r.elementOrder=d?d.concat(_):_}replaceIcon(t,s,r){let{scheme:i}=this,n=hn(i.elements,t),o=pn(i.elements,n),a={type:"DBMReference",handle:0,filename:s},u=1;if(i.doubleDibTools){for(;i.doubleDibTools.some(p=>p.handle===u);)++u;i.doubleDibTools.push(a)}else i.doubleDibTools=[a];o.dibHandle=a.handle=u;let h=0;switch(s.toUpperCase()){case"SYSTEM.DBM":h=2;break;default:return}o.cropX=r%h*32,o.cropY=Math.floor(r/h)*32}};function Be(e,t){let s=e.toUpperCase(),r=s.includes("WS_CHILD"),i=s.includes("WS_BYSPACE"),n=s.includes("WS_POPUP"),o=s.includes("WS_NORESIZE"),a=s.includes("WS_AUTOORG"),u=s.includes("WS_SPACESIZE"),h=s.includes("WS_NOCAPTION"),p=s.includes("WS_NOSHADOW"),T=s.includes("WS_VSCROLL"),_=s.includes("WS_HSCROLL"),d=null,g=!1,v=!1,D=!1,M=!1,k=!1,W=!1,Q=!1,ye=!1;if(i&&(t==null?void 0:t.settings)){let Y=t.settings;Y.x&&Y.y&&(d={width:Y.x,height:Y.y});let re=Y.style;re&ne.SWF_HSCROLL&&(g=!0),re&ne.SWF_VSCROLL&&(v=!0),re&ne.SWF_SPACESIZE&&(D=!0),re&ne.SWF_NORESIZE&&(M=!0),re&ne.SWF_POPUP&&(k=!0),re&ne.SWF_AUTOORG&&(W=!0)}_&&(g=!0),T&&(v=!0),u&&(D=!0),o&&(M=!0),n&&(k=!0),a&&(W=!0),h&&(Q=!0),p&&(ye=!0);let fe=null;if((t==null?void 0:t.elements)&&(W||D)){let Y=rt.calcRect(t.elements);W&&(fe={x:Y.x,y:Y.y}),D&&(d={width:Y.w,height:Y.h})}return{sceneOrg:fe,isChild:r,vdr:t,isPopup:k,hScroll:g,noCaption:Q,noResize:M,position:null,size:d,vScroll:v,title:null,noShadow:ye}}function wr(e,t){e.forEach(s=>{s.type==="group"?wr(s.children(),t):s.visib.setVisible(t)})}function yr(e,t){e.forEach(s=>{t.add(s),s.type==="group"&&yr(s.children(),t)})}function vr(e,t){for(let s of t){if(s.name===e)return s;if(s.type==="group"){let r=vr(e,s.children());if(r)return r}}return null}function fn(e,t){if(!t.elements)return null;let s=vt(e.scene,t.penTools),r=We(e.scene,t.dibTools),i=It(e.scene,r,t.brushTools),n=We(e.scene,t.doubleDibTools),o=xt(e.scene,t.fontTools),a=Dt(e.scene,t.stringTools),u=At(e.scene,o,a,t.textTools),h=Rt(e.scene,{pens:s,brushes:i,dibs:r,doubleDibs:n,texts:u},t.elements);t.elementOrder&&e.scene.setElements(e.scene.elements().concat(Pt(t.elementOrder,h))),s.forEach(d=>{let g=B.getFreeHandle(e.pens);d.handle=g,e.pens.set(g,d)}),r.forEach(d=>{let g=B.getFreeHandle(e.dibs);d.handle=g,e.dibs.set(g,d)}),i.forEach(d=>{let g=B.getFreeHandle(e.brushes);d.handle=g,e.brushes.set(g,d)}),n.forEach(d=>{let g=B.getFreeHandle(e.doubleDibs);d.handle=g,e.doubleDibs.set(g,d)}),a.forEach(d=>{let g=B.getFreeHandle(e.strings);d.handle=g,e.strings.set(g,d)}),o.forEach(d=>{let g=B.getFreeHandle(e.fonts);d.handle=g,e.fonts.set(g,d)}),u.forEach(d=>{let g=B.getFreeHandle(e.texts);d.handle=g,e.texts.set(g,d)}),h.forEach(d=>{let g=B.getFreeHandle(e.objects);d.handle=g,e.objects.set(g,d)});let p=[...h.values()].filter(d=>!d.parent());if(p.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");if(p.length===1)return p[0];let T=B.getFreeHandle(e.objects),_=new Te(e.scene,{handle:T,children:p});return e.objects.set(T,_),_}function bn(e){let t=e.uint16();if(t!==12)throw new ee(e,t,12);e.seek(14);let s=e.int32(),r=e.int32(),i=e.int32(),n=e.int32();e.uint16(),e.uint16();let o=Array.from({length:s*r},()=>e.float64());return{minX:i,minY:n,rows:s,cols:r,data:o}}var C;(function(e){e[e.CR_MATH=1]="CR_MATH",e[e.CR_MATHDATA=2]="CR_MATHDATA",e[e.CR_FLAGS=4]="CR_FLAGS",e[e.CR_VARS=5]="CR_VARS",e[e.CR_CHILDS=6]="CR_CHILDS",e[e.CR_LINKS=7]="CR_LINKS",e[e.CR_ICON=8]="CR_ICON",e[e.CR_SCHEME=9]="CR_SCHEME",e[e.CR_TEXT=10]="CR_TEXT",e[e.CR_VARSIZE=11]="CR_VARSIZE",e[e.CR_IMAGE=12]="CR_IMAGE",e[e.CR_CODE=13]="CR_CODE",e[e.CR_INFO=14]="CR_INFO",e[e.CR_VARS1=15]="CR_VARS1",e[e.CR_CHILDSname=16]="CR_CHILDSname",e[e.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",e[e.CR_DEFICON=20]="CR_DEFICON",e[e.CR_CLASSTIME=21]="CR_CLASSTIME",e[e.CR_ICONFILE=22]="CR_ICONFILE",e[e.CR_HELPFILE=25]="CR_HELPFILE",e[e.CR_EQU=30]="CR_EQU",e[e.CR_MOVEINFO=31]="CR_MOVEINFO",e[e.RR_VERSION=40]="RR_VERSION",e[e.PR_MAINCLASS=100]="PR_MAINCLASS",e[e.PR_PASSWORD=101]="PR_PASSWORD",e[e.PR_VARS=102]="PR_VARS",e[e.PR_WATCH=103]="PR_WATCH",e[e.VR_CLASSES=1e3]="VR_CLASSES",e[e.VR_VARS=1001]="VR_VARS",e[e.VR_SETVAR=1002]="VR_SETVAR",e[e.CR_CLASSINFO=8e3]="CR_CLASSINFO",e[e.PPR_FIELDS=2048]="PPR_FIELDS",e[e.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",e[e.PPR_SCALEMODE=2050]="PPR_SCALEMODE",e[e.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",e[e.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",e[e.PPR_USEADDF=2053]="PPR_USEADDF",e[e.PPR_SRCRECT=2054]="PPR_SRCRECT",e[e.PPR_USESRC=2055]="PPR_USESRC",e[e.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",e[e.CLF_LOADED=1]="CLF_LOADED",e[e.CLF_PROJECT=2]="CLF_PROJECT",e[e.CLF_MODIFY=4]="CLF_MODIFY",e[e.CLF_READONLY=8]="CLF_READONLY",e[e.CLF_NORECURSE=16]="CLF_NORECURSE",e[e.CLF_ADDLIB=32]="CLF_ADDLIB",e[e.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",e[e.CLF_LIBRARY=256]="CLF_LIBRARY",e[e.CLF_PACKFILE=512]="CLF_PACKFILE",e[e.CF_PROTECTED=1]="CF_PROTECTED",e[e.CF_ONEFASE=2]="CF_ONEFASE",e[e.CF_COMPILED=4]="CF_COMPILED",e[e.CF_VIRTUAL=8]="CF_VIRTUAL",e[e.CF_SCHEME=16]="CF_SCHEME",e[e.CF_MODIFY=32]="CF_MODIFY",e[e.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",e[e.CF_BUILDIN=256]="CF_BUILDIN",e[e.CF_ICON=512]="CF_ICON",e[e.CF_PROCEDURE=1024]="CF_PROCEDURE",e[e.CF_STRUCTURE=2048]="CF_STRUCTURE",e[e.CF_USEDEFICON=4096]="CF_USEDEFICON",e[e.CF_SIZEABLE=8192]="CF_SIZEABLE",e[e.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",e[e.TCF_WASSAVE=1]="TCF_WASSAVE",e[e.TCF_NEWCLASS=2]="TCF_NEWCLASS",e[e.OF_DISABLED=1]="OF_DISABLED",e[e.OF_ONEFASE=2]="OF_ONEFASE",e[e.OF_ERROR=4]="OF_ERROR",e[e.LF_DISABLED=1]="LF_DISABLED",e[e.LF_AUTOLINK=2]="LF_AUTOLINK",e[e.VF_LOCAL=2]="VF_LOCAL",e[e.VF_NOREAD=4]="VF_NOREAD",e[e.VF_NOWRITE=8]="VF_NOWRITE",e[e.VF_STATIC=16]="VF_STATIC",e[e.VF_ONSCHEME=32]="VF_ONSCHEME",e[e.VF_PARAMETER=64]="VF_PARAMETER",e[e.VF_LEFT=128]="VF_LEFT",e[e.VF_EQVAR=256]="VF_EQVAR",e[e.VF_ARGUMENT=512]="VF_ARGUMENT",e[e.VF_RETURN=1024]="VF_RETURN",e[e.VF_NOSAVE=2048]="VF_NOSAVE",e[e.VF_GLOBAL=4096]="VF_GLOBAL",e[e.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",e[e.SF_EXTERNAL=1]="SF_EXTERNAL",e[e.SF_EDITING=2]="SF_EDITING",e[e.STATE_FAST=0]="STATE_FAST",e[e.STATE_VARS=1]="STATE_VARS",e[e.STATE_DEBUG=2]="STATE_DEBUG",e[e.STATE_SET=3]="STATE_SET",e[e.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",e[e.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",e[e.CHF_WASSIZED=4]="CHF_WASSIZED",e[e.CHF_PREPROCESS=8]="CHF_PREPROCESS",e[e.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",e[e.IF_CORRECTED=1]="IF_CORRECTED",e[e.EF_RUNNING=1]="EF_RUNNING",e[e.EF_MUSTSTOP=2]="EF_MUSTSTOP",e[e.EF_STEPACTIVE=4]="EF_STEPACTIVE",e[e.EF_EQUACTIVE=8]="EF_EQUACTIVE",e[e.EF_MSGACTIVE=16]="EF_MSGACTIVE",e[e.EF_BYTIMER=32]="EF_BYTIMER"})(C||(C={}));var Dl={addlib:"classSearchPaths",MathMode:"mathmode",PerIdle:"perIdle",run_mode:"runMode",runtimer:"runTimer",user_email:"userEmail",user_name:"userName",user_addr:"userAddress",user_org:"userOrganization",user_phone:"userPhone",lib_norecurse:"notRecursive",preload_file:"preloadFile"};function Al(e){let t={},s=e.uint16();for(let r=0;r<s;++r){let i=e.uint16(),n=e.byte(),o=e.byte(),a=e.fixedString(o-1);e.byte();let u;switch(n){case 0:u=e.int32();break;case 1:u=e.float64();break;case 2:u=e.fixedString(i-o-3),e.byte();break;default:throw new pe(e,`\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F ${n}`)}let h=Dl[a];h?t[h]=u:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0435\u043A\u0442\u0430: ${a} (${u})`)}return t}function Rl(e){let t=e.uint16(),s=new Array(t);for(let r=0;r<t;++r){let i=Array.from({length:e.uint16()},()=>e.uint16()),n=e.string(),o=e.string();s[r]={path:i,name:n,info:o}}return s}function Ot(e){let t=e.uint16();if(t!==26697)throw new ee(e,t,26697);let s={rootClassName:""},r=0;for(;(r=e.uint16())!==0;)switch(r){case C.PR_PASSWORD:e.string(),console.warn("\u041F\u0440\u043E\u0435\u043A\u0442 \u0438\u043C\u0435\u0435\u0442 \u043F\u0430\u0440\u043E\u043B\u044C");break;case C.PR_MAINCLASS:s.rootClassName=e.string();break;case C.PR_VARS:s.settings=Al(e);break;case C.PR_WATCH:s.watchedVariables=Rl(e);break}if(!s.rootClassName)throw new pe(e,"\u0418\u043C\u044F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0438\u043C\u0438\u0434\u0436\u0430 \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E.");return s}function gn(e){let t=e.int32(),s=e.uint16(),r=e.string(),i=e.int32(),n=Array.from({length:e.uint16()},()=>({name:e.string(),value:e.string()})),o=[];for(;e.pos()<t;)o.push(gn(e));return{handle:s,classname:r,classId:i,values:n,childSets:o}}function Mt(e){let t=e.uint16();if(t!==19)throw new ee(e,t,19);switch(e.seek(21),e.string(),e.uint16(),e.uint16(),e.uint16()){case C.VR_CLASSES:throw new pe(e,"\u0411\u043B\u043E\u043A VR_CLASSES \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.");case C.VR_SETVAR:return gn(e)}return{values:[],childSets:[],handle:0,classname:"",classId:0}}function Ne(e,t){return j(this,null,function*(){let s=yield e.fs.arraybuffer(e);if(!s)throw Error(`\u0424\u0430\u0439\u043B ${e.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let r=new ie(s,e.toString());try{switch(t){case"prj":return Ot(r);case"stt":return Mt(r);case"vdr":return $e(r,{origin:"file",name:e.toString()});case"mat":return bn(r);case"bmp":return Tt(r);case"dbm":return St(r)}}catch(i){throw console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.toString()} \u043A\u0430\u043A .${t.toUpperCase()}`),console.error(i),i}})}var Bt=class{constructor(t){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;this.wVkeyVarId=-1;this.repeatVarId=-1;this.scanCodeVarId=-1;if(!t){this.nameUCToId=new Map,this.vdata=[];return}this.vdata=t.map(r=>{let i,n;switch(r.type){case"FLOAT":case"INTEGER":n="FLOAT",i=I.Float;break;case"HANDLE":n=r.type,i=I.Handle;break;case"STRING":n=r.type,i=I.String;break;case"COLORREF":n=r.type,i=I.ColorRef;break}let o=r.defaultValue.length>0?Et(i,r.defaultValue):null;return{name:r.name,type:i,defaultValue:o,isReturnValue:!!(r.flags&x.VF_RETURN),typeString:n,description:r.description,rawFlags:r.flags,rawDefaultValue:r.defaultValue}});let s=t.map(r=>r.name.toUpperCase());this.nameUCToId=new Map(s.map((r,i)=>[r,i]));for(let r=0;r<t.length;++r){let i=s[r],n=this.vdata[r].type;i==="_ENABLE"&&n===I.Float?this._enableVarId=r:i==="_DISABLE"&&n===I.Float?this._disableVarId=r:i==="MSG"&&n===I.Float?this.msgVarId=r:i==="_HOBJECT"&&n===I.Handle?this._hobjectVarId=r:i==="IDITEM"&&n===I.Float?this.iditemVarId=r:i==="WNOTIFYCODE"&&n===I.Float?this.wnotifycodeVarId=r:i==="NWIDTH"&&n===I.Float?this.nwidthVarId=r:i==="NHEIGHT"&&n===I.Float?this.nheightVarId=r:i==="XPOS"&&n===I.Float?this.xposVarId=r:i==="YPOS"&&n===I.Float?this.yposVarId=r:i==="FWKEYS"&&n===I.Float?this.fwkeysVarId=r:i==="ORGX"&&n===I.Float?this.orgxVarId=r:i==="ORGY"&&n===I.Float?this.orgyVarId=r:i==="_OBJNAME"&&n===I.String?this._objnameVarId=r:i==="_CLASSNAME"&&n===I.String?this._classnameVarId=r:i==="WVKEY"&&n===I.Float?this.wVkeyVarId=r:i==="REPEAT"&&n===I.Float?this.repeatVarId=r:i==="SCANCODE"&&n===I.Float&&(this.scanCodeVarId=r)}}id(t){var s;return(s=this.nameUCToId.get(t.toUpperCase()))!=null?s:null}get(t){let s=this.nameUCToId.get(t.toUpperCase());return typeof s=="undefined"?null:this.vdata[s]}data(t){return this.vdata[t]}count(){return this.vdata.length}toArray(){return this.vdata}};var Nt=class{constructor(t,s){this._model=null;this._compiled=!1;var i,n,o,a,u,h,p,T;this.name=t.name,this.children=(i=t.children)!=null?i:[],this.links=(n=t.links)!=null?n:[],this._schemeBytes=(o=t.scheme)!=null?o:null,this._scheme=null,this._imageBytes=(a=t.image)!=null?a:null,this._image=null,this.iconFile=(u=t.iconFile)!=null?u:null,this.iconIndex=(h=t.iconIndex)!=null?h:0,this.sourceCode=(p=t.sourceCode)!=null?p:null,this._vars=new Bt(t.vars);let r=(T=t.flags)!=null?T:0;this.alwaysUseIcon=!!(r&C.CF_USEDEFICON),this.isStruct=!!(r&C.CF_STRUCTURE),this.lib=s}vars(){return this._vars}scheme(){let t=this._scheme;if(t)return t;let s=this._schemeBytes;if(!s)return null;this._schemeBytes=null;let r=`\u0421\u0445\u0435\u043C\u0430 ${this.name}`;if(typeof s=="string")throw Error(`${r}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${s}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let i=new ie(s,r),n=$e(i,{origin:"class",name:this.name}),o=this.children;if(!o)return this._scheme=n;let a=new rt(n);return o.forEach(u=>{let h=this.lib.get(u.classname);if(!h){console.warn(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${u.classname} #${u.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435 ${this.name}`);return}let p=h.iconFile;if(p&&a.replaceIcon(u.handle,p,h.iconIndex),!h.alwaysUseIcon){let T=h.image();T&&a.insertChildImage(u.handle,T)}}),this._scheme=a.result()}image(){let t=this._image;if(t)return t;let s=this._imageBytes;if(!s)return null;this._imageBytes=null;let r=`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${this.name}`;if(typeof s=="string")throw Error(`${r}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${s}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let i=new ie(s,r);return this._image=$e(i,{origin:"class",name:this.name})}setCode(t){this.sourceCode!==t&&(this._model=dt(t,this.lib,this.name,this._vars.toArray()),this.sourceCode=t)}hasModel(){return!!this.sourceCode}model(){if(this._compiled)return this._model;this._compiled=!0;let t=this.sourceCode;return t?this._model=dt(t,this.lib,this.name,this._vars.toArray()):null}schema(t,s){let r=this.children.map(i=>{let n=this.lib.get(i.classname);if(!n)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${i.classname}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);return n.schema(t,i)});return t(this,r,this.links,s)}};function Pl(e){let t=e.uint16(),s=new Array(t);for(let r=0;r<t;++r){let i=e.string(),n=e.string(),o=e.string(),a=e.string().toUpperCase();if(a!=="STRING"&&a!=="FLOAT"&&a!=="INTEGER"&&a!=="HANDLE"&&a!=="COLORREF")throw new pe(e,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${a}.`);let u=e.int32();s[r]={name:i,description:n,defaultValue:o,type:a,flags:u}}return s}function Ol(e){let t=e.uint16(),s=new Array(t);for(let r=0;r<t;++r){let i=e.uint16(),n=e.uint16(),o=e.uint16(),a=e.int32(),u=e.uint16(),h=e.uint16(),p=new Array(u);for(let T=0;T<u;T++){let _=e.string(),d=e.string();p[T]={name1:_,name2:d}}s[r]={handle1:i,handle2:n,handle:o,flags:a,connectedVars:p,contactPadHandle:h}}return s}function Ml(e,t){let s=e.uint16(),r=new Array(s);for(let i=0;i<s;++i){let n=e.string(),o=e.uint16(),a=e.string(),u=e.point2d(t<12290),h=e.byte();r[i]={classname:n,handle:o,schemeName:a,position:u,flags:h}}return r}function dn(e){return e.int32()&C.SF_EXTERNAL?e.string():e.bytes(e.int32())}function Ir(e){let t=e.uint16();if(t!==16979)throw new ee(e,t,16979);let s=e.int32();return e.skip(8),{name:e.string(),version:s}}function _n(e){let t=Ir(e),s=e.uint16();if(s===C.CR_VARS1&&(t.vars=Pl(e),s=e.uint16()),s===C.CR_LINKS&&(t.links=Ol(e),s=e.uint16()),(s===C.CR_CHILDSnameXY||s===C.CR_CHILDSname||s===C.CR_CHILDS)&&(t.children=Ml(e,t.version),s=e.uint16()),s===C.CR_ICON){let r=e.int32();e.skip(r-4),s=e.uint16()}return s===C.CR_SCHEME&&(e.skip(4),t.scheme=dn(e),s=e.uint16()),s===C.CR_IMAGE&&(e.skip(4),t.image=dn(e),s=e.uint16()),s===C.CR_TEXT&&(t.sourceCode=e.string(),s=e.uint16()),s===C.CR_INFO&&(e.skip(e.uint16()),s=e.uint16()),s===C.CR_VARSIZE&&(e.skip(2),s=e.uint16()),s===C.CR_FLAGS&&(t.flags=e.int32(),s=e.uint16()),s===C.CR_DEFICON&&(t.iconIndex=e.uint16(),s=e.uint16()),s===C.CR_ICONFILE&&(t.iconFile=e.string(),s=e.uint16()),s===C.CR_CODE&&(e.skip(e.int32()*2),s=e.uint16()),s===C.CR_EQU||s!==C.CR_CLASSTIME&&t.version===12291&&console.warn(`${t.name} (${e.name||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),t}var xr=class{constructor(){this.filenames=new Set;this.lib=new Map}add(t,s,r,i){return j(this,null,function*(){let n=yield t.searchClsFiles(s,r),o=[],a=n.filter(T=>{let _=T.toString(),d=this.filenames.size;this.filenames.add(_);let g=this.filenames.size!==d;return g&&o.push(_),g});if(a.length===0)return;let u=yield t.arraybuffers(a),h=0,p=0;for(let T=0;T<u.length;++T){let _=u[T];if(!_)continue;let d=o[T],g=new ie(_,d),v;try{v=Ir(g).name}catch(k){console.warn(k.message);continue}g.seek(0),g.name=`${v} (${d})`;let D=v.toUpperCase(),M=this.lib.get(D);if(M)throw typeof i!="undefined"&&this.clear(i),Error(`\u0418\u043C\u0438\u0434\u0436 ${v} \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445: ${M.path}, ${d}`);this.lib.set(D,{type:"unloaded",id:i!=null?i:null,path:d,reader:g}),h+=_.byteLength,++p}p>0&&J.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E ${p} \u0438\u043C\u0438\u0434\u0436\u0435\u0439 \u043E\u0431\u044A\u0435\u043C\u043E\u043C ${(h/1024).toFixed()} \u041A\u0411. \u0412\u0441\u0435\u0433\u043E: ${this.lib.size}.`)})}clear(t){let r=[...this.lib].filter(o=>o[1].id!==t),i=this.lib.size-r.length;i>0&&J.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${i} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(r);let n=r.map(o=>o[1].path);this.filenames=new Set(n)}clearAll(){let s=[...this.lib].filter(n=>n[1].id===null),r=this.lib.size-s.length;r>0&&J.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${r} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(s);let i=s.map(n=>n[1].path);this.filenames=new Set(i)}has(t){return this.lib.has(t.toUpperCase())}get(t){let s=t.toUpperCase(),r=this.lib.get(s);if(!r)return null;if(r.type==="loaded")return r.proto;let i=_n(r.reader),n=new Nt(i,this);return this.lib.set(s,{type:"loaded",id:r.id,path:r.path,proto:n}),n}hasModel(t){var s,r;return(r=(s=this.get(t))==null?void 0:s.hasModel())!=null?r:!1}getModel(t){var s,r;return(r=(s=this.get(t))==null?void 0:s.model())!=null?r:null}getPath(t){var s,r;return(r=(s=this.lib.get(t.toUpperCase()))==null?void 0:s.path)!=null?r:null}};function Tn(e,t){let s=t==null?void 0:t.filter(i=>!i.type||i.type==="library").map(i=>i.dir),r=new xr;return Dr(e,r,{addDirs:s})}function Dr(e,t,s){return j(this,null,function*(){var d,g;let r=e.resolve(".."),i=r.resolve("_preload.stt"),[n,o]=yield r.fs.arraybuffers([e,i]);if(!n)throw Error(`\u0424\u0430\u0439\u043B \u043F\u0440\u043E\u0435\u043A\u0442\u0430 ${e} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);J.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${e.toString()}`);let a=Ot(new ie(n,e.toString())),u=(d=a.settings)==null?void 0:d.preloadFile;u&&(o=yield r.fs.arraybuffer(r.resolve(u)));let h=null;if(o)try{h=Mt(new ie(o,i.toString()))}catch(v){console.warn(v)}let p=[r],T=(g=a.settings)==null?void 0:g.classSearchPaths;if(T){let v=T.split(";").map(D=>D.trim()).filter(D=>D);for(let D of v)p.push(r.resolve(D))}let _=s.addDirs?p.concat(s.addDirs):p;return yield t.add(r.fs,_,!0,s.id),{classes:t,dir:r,prjInfo:a,stt:h,filepath:e.toString()}})}var Ge=class{constructor(t,s,r){this.host=s;this.handlers=r;this.windows=new Map;this.scenes=new Map;this.openedPopups=new Set;this.arrays=new Map;this.matrices=new Map;this.streams=new Map;this.captureTarget=null;this._shouldQuit=!1;this._isWaiting=!1;this.loading=null;this.lastPrimary=0;this.copied=null;this.cursorOverHyp=!1;this.currentCursor="default";this.setObjectAttribute2dShowed=!1;this.systemShowed=!1;this.setWindowRegionShowed=!1;this.setWindowOwnerwarnShowed=!1;this.lockSpace2dWarnShowed=!1;this.setObjectNameShowed=!1;this.projects=[new Ce(this,t)],this.classes=t.classes}curProjectID(){return this.projects.length}nextProjectID(){return this.projects.length+1}compute(){if(this._shouldQuit)return this.closeAllRes();if(this.loading)return this.loading;let t=this.projects.length-1,s=this.projects[t];if(s.shouldClose()===!0){if(J.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${s.filepath}`),this.classes.clear(this.curProjectID()),this.closeProjectWindows(s),this.projects.pop(),this.projects.length===0)return this.closeAllRes();s=this.projects[t-1]}return s.root.compute()}requestStop(){this._shouldQuit=!0}closeAllRes(){return j(this,null,function*(){this.copied=null,this._shouldQuit=!0,this.closeAllWindows();let t=[];for(let r of this.streams.values()){let i=r.close();i instanceof Promise&&t.push(i)}yield Promise.all(t),this.streams.clear(),this.matrices.clear(),this.arrays.clear();let s;for(;s=this.projects.pop();)J.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${s.filepath}`);if(this.loading)try{yield this.loading}catch(r){}return this.classes.clearAll(),this.currentCursor="default",this.updateCursor(),!0})}isWaiting(){return this._isWaiting}setWaiting(){this._isWaiting=!0}resetWaiting(){this._isWaiting=!1}getTime(t,s,r,i,n,o,a,u){let h=new Date;t[s]=h.getHours(),r[i]=h.getMinutes(),n[o]=h.getSeconds(),a[u]=h.getMilliseconds()*.1}getDate(t,s,r,i,n,o){let a=new Date;t[s]=a.getFullYear(),r[i]=a.getMonth(),n[o]=a.getDate()}getActualSize2d(t,s,r,i,n,o){var u;let a=(u=this.scenes.get(t))==null?void 0:u.objects.get(s);if(!a)return r[i]=0,n[o]=0,0;switch(a.type){case"group":case"line":case"input":return r[i]=a.width(),n[o]=a.height(),1;case"image":return r[i]=a.image.tool().width(),n[o]=a.image.tool().height(),1;case"text":return r[i]=a.actualWidth(),n[o]=a.actualHeight(),1}}getBitmapSrcRect2d(t,s,r,i,n,o,a,u,h,p){var d,g,v,D,M;let T=(d=this.scenes.get(t))==null?void 0:d.objects.get(s);if((T==null?void 0:T.type)!=="image")return r[i]=0,n[o]=0,a[u]=0,h[p]=0,0;let _=T.cropArea();return r[i]=(g=_==null?void 0:_.x)!=null?g:0,n[o]=(v=_==null?void 0:_.y)!=null?v:0,a[u]=(D=_==null?void 0:_.w)!=null?D:T.image._tool.width(),h[p]=(M=_==null?void 0:_.h)!=null?M:T.image._tool.height(),1}getVarInfo(t,s,r,i,n,o,a,u,h,p,T,_){var v;let d=(v=this.classes.get(t))==null?void 0:v.vars();if(!d||s<0||s>d.count()-1)return r[i]="",n[o]="",h[p]="",a[u]="",T&&typeof _!="undefined"&&(T[_]=0),0;let g=d.data(s);return r[i]=g.name,n[o]=g.typeString,h[p]=g.description,a[u]=g.rawDefaultValue,T&&typeof _!="undefined"&&(T[_]=g.rawFlags),1}getMousePos(t,s,r,i,n){let o=this.windows.get(t);if(!o)return s[r]=0,i[n]=0,0;let[a,u]=o.scene.mouseCoords(),h=o.invMatrix;if(!h)return s[r]=a,i[n]=u,1;let p=a*h[2]+u*h[5]+h[8],T=(a*h[0]+u*h[3]+h[6])/p,_=(a*h[1]+u*h[4]+h[7])/p;return s[r]=T,i[n]=_,1}openSchemeWindow(t,s,r,i){var a;let n=this.windows.get(s);if(n)return n.handle;let o=(a=this.classes.get(r))==null?void 0:a.scheme();return this.createWindow(t,s,Be(i,o))}loadSpaceWindow(t,s,r,i){let n=this.windows.get(s);return n?n.handle:r===""?this.createWindow(t,s,Be(i)):Ne(t.dir.resolve(r),"vdr").then(o=>this.createWindow(t,s,Be(i,o))).catch(()=>this.createWindow(t,s,Be(i)))}createWindowEx(t,s,r,i,n,o,a,u,h){var d;let p=this.windows.get(s);if(p)return p.handle;let T=g=>{let v=Be(h,g);if(v.position={x:n,y:o},v.size={width:a,height:u},v.isChild){let D=this.windows.get(r);if(D)return this.createWindowFrame(D,t,s,v)}return this.createWindow(t,s,v)},_=(d=this.classes.get(i))==null?void 0:d.scheme();return _?T(_):Ne(t.dir.resolve(i),"vdr").then(g=>T(g)).catch(()=>T())}createDIB2d(t,s,r){let i=this.scenes.get(s);return i?Ne(t.resolve(r),"bmp").then(n=>{let o=B.getFreeHandle(i.dibs);return i.dibs.set(o,new V.dib(i.scene,n,{handle:o})),o}).catch(()=>0):0}createDoubleDib2D(t,s,r){let i=this.scenes.get(s);return i?Ne(t.resolve(r),"dbm").then(n=>{let o=B.getFreeHandle(i.doubleDibs);return i.doubleDibs.set(o,new V.dib(i.scene,n,{handle:o})),o}).catch(()=>0):0}updateCursor(){this.loading||(document.body.style.cursor=this.cursorOverHyp?"pointer":this.currentCursor)}loadCursor(t,s,r){var a;let i=this.handlers.cursorRequest;if(!i||!(typeof s=="number"?this.scenes.get(s):(a=this.windows.get(s))==null?void 0:a.scene))return;let o=i(t.resolve(r));this.currentCursor=o||"default",this.updateCursor()}createObjectFromFile2D(t,s,r,i,n,o){let a=this.scenes.get(s);return a?Ne(t.resolve(r),"vdr").then(u=>{let h=fn(a,u);if(!h)return 0;let p=a.matrix;if(!p)return h.move(i,n).handle;let T=i*p[2]+n*p[5]+p[8],_=(i*p[0]+n*p[3]+p[6])/T,d=(i*p[1]+n*p[4]+p[7])/T;return h.move(_,d).handle}).catch(()=>0):0}createStream(t,s,r,i){let n=s.toUpperCase(),o=i.toUpperCase().includes("CREATE"),a=B.getFreeHandle(this.streams);if(n==="FILE"){let u=t.resolve(r);return(()=>j(this,null,function*(){let h;if(o){let p=yield u.fs.createFile(u);if(!p)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0444\u0430\u0439\u043B ${u}.`);h=new Se({file:p})}else{let p=u.fs.file(u),T=yield p==null?void 0:p.read();if(!p||!T)throw Error(`\u0424\u0430\u0439\u043B ${u} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);h=new Se({data:T,file:p})}return this.streams.set(a,h),a}))()}if(n==="MEMORY")return this.streams.set(a,new Se),a;throw Error(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${n} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`)}mSaveAs(t,s,r,i){if(i<=0)return 0;throw Error("\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}mLoad(t,s,r,i){return i<=0?0:Ne(t.resolve(r),"mat").then(n=>{let o=s===0?B.getFreeNegativeHandle(this.matrices):s;return this.matrices.set(o,new wt(n)),o}).catch(()=>0)}handlePointer(t,s){let r=s.buttons&1?1:0,i=s.buttons&2?2:0,n=s.buttons&4?16:0,o=r|i|n,{x:a,y:u}=s,h=s.element;for(;h;){let D=h.parent();if(!D)break;h=D}let p,T;switch(s.type){case"pointerdown":{switch(this.closePopups(t),s.button){case 0:this.handleClick(t.prj,h==null?void 0:h.meta,{x:s.clickX,y:s.clickY}),p=t.leftButtonDownSubs,T=x.WM_LBUTTONDOWN;break;case 1:p=t.middleButtonDownSubs,T=x.WM_MBUTTONDOWN;break;case 2:p=t.rightButtonDownSubs,T=x.WM_RBUTTONDOWN;break;default:return}break}case"pointerup":{switch(s.button){case 0:p=t.leftButtonUpSubs,T=x.WM_LBUTTONUP;break;case 1:p=t.middleButtonUpSubs,T=x.WM_MBUTTONUP;break;case 2:p=t.rightButtonUpSubs,T=x.WM_RBUTTONUP;break;default:return}break}case"pointermove":let D=!!(h==null?void 0:h.meta);this.cursorOverHyp!==D&&(this.cursorOverHyp=D,this.updateCursor()),p=t.mouseMoveSubs,T=x.WM_MOUSEMOVE;break}let _=a,d=u,g=t.invMatrix;if(g){let D=a*g[2]+u*g[5]+g[8];_=(a*g[0]+u*g[3]+g[6])/D,d=(a*g[1]+u*g[4]+g[7])/D}let v=this.captureTarget;for(let[D,M]of p)(s.target===(v==null?void 0:v.scene)&&D===v.receiver||M.has(h)||M.has(null))&&D.receive(T,_,d,o)}handleKeyboard(t,s){let r,i;switch(s.type){case"keydown":r=t.keyDownSubs,i=x.WM_KEYDOWN;break;case"keyup":r=t.keyUpSubs,i=x.WM_KEYUP;break;case"keychar":r=t.keyCharSubs,i=Fe;break}r.forEach(n=>n.receive(i,s.key,s.repeat,s.scan))}handleInput(t,s){let r=t.controlNotifySubs,i=x.WM_CONTROLNOTIFY,n,o=s.element;switch(s.type){case"input":n=768;break;case"focus":n=256;break;case"blur":n=512;break}for(let[a,u]of r)(u.has(o)||u.has(null))&&a.receive(i,o.handle,0,n)}setCapture(t,s,r){var n;let i=(n=this.scenes.get(s))==null?void 0:n.scene;!i||(this.captureTarget={scene:i,receiver:t},i.setCapture())}subscribe(t,s,r,i,n){var h;let o=typeof s=="number"?this.scenes.get(s):this.windows.get(s);if(!o)return;let a=n&1,u=(h=o.objects.get(r))!=null?h:null;switch(i){case x.WM_MOVE:o.windowMoveSubs.add(t);break;case x.WM_SPACEDONE:o.spaceDoneSubs.add(t);break;case x.WM_SIZE:o.sizeSubs.add(t);break;case x.WM_CONTROLNOTIFY:(u||r===0)&&o.controlNotifySubs.set(t,u);break;case x.WM_MOUSEMOVE:(u||!a)&&o.mouseMoveSubs.set(t,a?u:null);break;case x.WM_LBUTTONDOWN:(u||!a)&&o.leftButtonDownSubs.set(t,a?u:null);break;case x.WM_LBUTTONUP:(u||!a)&&o.leftButtonUpSubs.set(t,a?u:null);break;case x.WM_RBUTTONDOWN:(u||!a)&&o.rightButtonDownSubs.set(t,a?u:null);break;case x.WM_RBUTTONUP:(u||!a)&&o.rightButtonUpSubs.set(t,a?u:null);break;case x.WM_MBUTTONDOWN:(u||!a)&&o.middleButtonDownSubs.set(t,a?u:null);break;case x.WM_MBUTTONUP:(u||!a)&&o.middleButtonUpSubs.set(t,a?u:null);break;case x.WM_ALLMOUSEMESSAGE:if(!u&&a)break;let p=a?u:null;o.mouseMoveSubs.set(t,p),o.leftButtonDownSubs.set(t,p),o.leftButtonUpSubs.set(t,p),o.rightButtonDownSubs.set(t,p),o.rightButtonUpSubs.set(t,p),o.middleButtonDownSubs.set(t,p),o.middleButtonUpSubs.set(t,p);break;case x.WM_KEYDOWN:o.keyDownSubs.add(t);break;case x.WM_KEYUP:o.keyUpSubs.add(t);break;case Fe:o.keyCharSubs.add(t);break;case x.WM_ALLKEYMESSAGE:o.keyDownSubs.add(t),o.keyUpSubs.add(t),o.keyCharSubs.add(t);break;default:console.warn(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${x[i]} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430 (\u0438\u043C\u0438\u0434\u0436: ${t.proto.name})`);break}}unsubscribe(t,s,r){let i=typeof s=="number"?this.scenes.get(s):this.windows.get(s);if(!!i)switch(r){case x.WM_MOVE:i.windowMoveSubs.delete(t);break;case x.WM_SPACEDONE:i.spaceDoneSubs.delete(t);break;case x.WM_SIZE:i.sizeSubs.delete(t);break;case x.WM_CONTROLNOTIFY:i.controlNotifySubs.delete(t);break;case x.WM_MOUSEMOVE:i.mouseMoveSubs.delete(t);break;case x.WM_LBUTTONDOWN:i.leftButtonDownSubs.delete(t);break;case x.WM_LBUTTONUP:i.leftButtonUpSubs.delete(t);break;case x.WM_RBUTTONDOWN:i.rightButtonDownSubs.delete(t);break;case x.WM_RBUTTONUP:i.rightButtonUpSubs.delete(t);break;case x.WM_MBUTTONDOWN:i.middleButtonDownSubs.delete(t);break;case x.WM_MBUTTONUP:i.middleButtonUpSubs.delete(t);break;case x.WM_ALLMOUSEMESSAGE:i.mouseMoveSubs.delete(t),i.leftButtonDownSubs.delete(t),i.leftButtonUpSubs.delete(t),i.rightButtonDownSubs.delete(t),i.rightButtonUpSubs.delete(t),i.middleButtonDownSubs.delete(t),i.middleButtonUpSubs.delete(t);break;case x.WM_KEYDOWN:i.keyDownSubs.delete(t);break;case x.WM_KEYUP:i.keyUpSubs.delete(t);break;case Fe:i.keyCharSubs.delete(t);break;case x.WM_ALLKEYMESSAGE:i.keyDownSubs.delete(t),i.keyUpSubs.delete(t),i.keyCharSubs.delete(t);break}}loadProject(t){return j(this,null,function*(){if(!this.loading){document.body.style.cursor="wait";try{let s=yield Dr(t,this.classes,{id:this.nextProjectID()});if(this._shouldQuit)return;this.projects.push(new Ce(this,s))}catch(s){console.error(s)}finally{this.loading=null,this.updateCursor()}}})}handleClick(t,s,r){var i,n,o,a;if(!(this.loading||!s))switch((i=s.openMode)!=null?i:0){case 0:{let T=s.target;if(!T)break;let _=(n=this.classes.get(T))==null?void 0:n.scheme();if(!_)break;let d=s.windowName||(((a=(o=_.settings)==null?void 0:o.style)!=null?a:0)&ne.SWF_POPUP?"PopupWindow":"MainWindow");if(this.windows.has(d))return;let g=Be("WS_BYSPACE",_);g.position=r,this.createWindow(t,d,g);break}case 1:let u=s.target;if(!u)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A Windows \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F ${t.dir.resolve(u)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;case 2:let h=s.target;if(!h)break;this.loading=this.loadProject(t.dir.resolve(h));break;case 3:break;case 4:let p=s.target;if(!p)break;console.warn(`\u0417\u0430\u043F\u0443\u0441\u043A \u043A\u043E\u043C\u0430\u043D\u0434\u044B ${t.dir.resolve(p)} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);break;default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(s)}}createWindow(t,s,r){r.title=s;let i=this.createScene(t,s,r,(n,o)=>this.host.append(n,o));return r.isPopup&&this.openedPopups.add(i),i.handle}createWindowFrame(t,s,r,i){let n=this.createScene(s,r,i,(o,a)=>new Qt(o,t,a));return n.parent=t,t.children.add(n),n.handle}createScene(t,s,r,i){var fe,Y,re;let n,o,a,u,h,p,T,_,d,{vdr:g}=r;if(g){let st=(fe=r.sceneOrg)!=null?fe:g.origin;n=new V.scene({layers:g.layers,offsetX:st.x,offsetY:st.y}),o=vt(n,g.penTools),u=We(n,g.dibTools),a=It(n,u,g.brushTools),h=We(n,g.doubleDibTools),p=xt(n,g.fontTools),T=Dt(n,g.stringTools),_=At(n,p,T,g.textTools),d=Rt(n,{pens:o,brushes:a,dibs:u,doubleDibs:h,texts:_},g.elements),g.elementOrder&&n.setElements(Pt(g.elementOrder,d))}else n=new V.scene,o=new Map,a=new Map,u=new Map,h=new Map,p=new Map,T=new Map,_=new Map,d=new Map;let v=i(n.view,r),D=B.getFreeHandle(this.scenes),M=(Y=g==null?void 0:g.crdSystem)==null?void 0:Y.matrix,k={pens:o,brushes:a,objects:d,dibs:u,doubleDibs:h,fonts:p,strings:T,texts:_,scene:n,wnd:v,handle:D,wname:s,prj:t,title:s,scale:1,source:(re=g==null?void 0:g.source)!=null?re:null,matrix:M!=null?M:null,invMatrix:M?tn(M):null,sizeSubs:new Set,controlNotifySubs:new ce,mouseMoveSubs:new ce,leftButtonUpSubs:new ce,leftButtonDownSubs:new ce,rightButtonUpSubs:new ce,rightButtonDownSubs:new ce,middleButtonUpSubs:new ce,middleButtonDownSubs:new ce,keyDownSubs:new Set,keyUpSubs:new Set,keyCharSubs:new Set,spaceDoneSubs:new Set,windowMoveSubs:new Set,children:new Set,parent:null,closed:!1};v.on&&v.on("closed",()=>{this.markClosed(k),this.removeClosed(!1)});let W=this.handlePointer.bind(this,k),Q=this.handleKeyboard.bind(this,k),ye=this.handleInput.bind(this,k);return n.on("pointerdown",W).on("pointerup",W).on("pointermove",W).on("keydown",Q).on("keyup",Q).on("keychar",Q).on("inputState",ye),this.windows.set(s,k),this.scenes.set(D,k),k}markClosed(t){var s;(s=t.parent)==null||s.children.delete(t),t.children.forEach(r=>{r.parent=null,this.markClosed(r)}),t.children.clear(),t.closed=!0}removeClosed(t){this.windows.forEach(s=>{var r;!s.closed||(s.scene===((r=this.captureTarget)==null?void 0:r.scene)&&(this.captureTarget.scene.releaseCapture(),this.captureTarget=null),s.wnd.off&&s.wnd.off("closed"),t&&s.wnd.close&&s.wnd.close(),s.spaceDoneSubs.forEach(i=>i.receive(x.WM_SPACEDONE)))}),this.windows=new Map([...this.windows].filter(s=>!s[1].closed)),this.scenes=new Map([...this.scenes].filter(s=>!s[1].closed)),this.openedPopups=new Set([...this.openedPopups].filter(s=>!s.closed))}closeAllWindows(){this.windows.forEach(t=>this.markClosed(t)),this.removeClosed(!0)}closeProjectWindows(t){this.windows.forEach(s=>{s.prj===t&&this.markClosed(s)}),this.removeClosed(!0)}closePopups(t){this.openedPopups.forEach(s=>{s!==t&&this.markClosed(s)}),this.removeClosed(!0)}stratum_releaseCapture(){var t;(t=this.captureTarget)==null||t.scene.releaseCapture(),this.captureTarget=null}stratum_isDlgButtonChecked2d(t,s){return 0}stratum_checkDlgButton2d(t,s,r){return 1}stratum_setObjectAttribute2d(t,s,r,i){return this.setObjectAttribute2dShowed||(console.warn("stratum_setObjectAttribute2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setObjectAttribute2dShowed=!0),1}stratum_setScrollRange(t,s,r,i){return 1}stratum_system(t,...s){return this.systemShowed||(console.warn(`\u0412\u044B\u0437\u043E\u0432 System(${t}, ${s}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.systemShowed=!0),0}stratum_shell(t,s,r,i){return this.handlers.shell.forEach(n=>n(t,s,r,i)),1}stratum_getAsyncKeyState(t){return t<0||t>ae.keyState.length-1?0:ae.keyState[t]>0?1:0}stratum_getTickCount(){return new Date().getTime()-Ge.startupTime}stratum_setHyperJump2d(t,s,r,...i){var a;if(r<-1||r>4)return 0;let n=(a=this.scenes.get(t))==null?void 0:a.objects.get(s);if(!n)return 0;if(r===-1)return n.meta=null,1;let o={openMode:r,target:i[0],objectName:i[1],effect:i[2],windowName:i[3],params:i[4]};return n.meta=o,1}stratum_stdHyperJump(t,s,r,i){var p;let n=this.scenes.get(t);if(!n)return;let o=(p=n.objects.get(i))!=null?p:this.getObjAtPoint(n,s,r,!1),a=s,u=r,h=n.matrix;if(h){let T=s*h[2]+r*h[5]+h[8];a=(s*h[0]+r*h[3]+h[6])/T,u=(s*h[1]+r*h[4]+h[7])/T}a-=n.scene.offsetX(),u-=n.scene.offsetY(),this.handleClick(n.prj,o==null?void 0:o.meta,{x:a,y:u})}stratum_getScreenWidth(){return this.host.width||window.innerWidth}stratum_getScreenHeight(){return this.host.height||window.innerHeight}stratum_getWorkAreaX(){return 0}stratum_getWorkAreaY(){return 0}stratum_getWorkAreaWidth(){return this.host.width||window.innerWidth}stratum_getWorkAreaHeight(){return this.host.height||window.innerHeight}stratum_getTitleHeight(){return 0}stratum_getSmallTitleHeight(){return 0}stratum_getFixedFrameWidth(){return 0}stratum_getFixedFrameHeight(){return 0}stratum_getSizeFrameWidth(){return 0}stratum_getSizeFrameHeight(){return 0}stratum_logMessage(t){J.log("\u0418\u043D\u0444\u043E: "+t)}stratum_setWindowRegion(t,s){return this.setWindowRegionShowed||(console.warn("SetWindowRegion \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setWindowRegionShowed=!0),1}stratum_getClientHeight(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.clientHeight)?s.clientHeight():0}stratum_getClientWidth(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.clientWidth)?s.clientWidth():0}stratum_getWindowName(t){var s,r;return(r=(s=this.scenes.get(t))==null?void 0:s.wname)!=null?r:""}stratum_getWindowOrgX(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.originX)?s.originX():0}stratum_getWindowOrgY(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.originY)?s.originY():0}stratum_getWindowSpace(t){var s,r;return(r=(s=this.windows.get(t))==null?void 0:s.handle)!=null?r:0}stratum_getWindowWidth(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.width)?s.width():0}stratum_getWindowHeight(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return(s==null?void 0:s.height)?s.height():0}stratum_getWindowTitle(t){var s,r;return(r=(s=this.windows.get(t))==null?void 0:s.title)!=null?r:""}stratum_setClientSize(t,s,r){var n;let i=(n=this.windows.get(t))==null?void 0:n.wnd;return i?(i.setClientSize&&i.setClientSize(s,r),1):0}stratum_setWindowSize(t,s,r){var n;let i=(n=this.windows.get(t))==null?void 0:n.wnd;return i?(i.setSize&&i.setSize(s,r),1):0}stratum_setWindowOrg(t,s,r){var n;let i=(n=this.windows.get(t))==null?void 0:n.wnd;return i?(i.setOrigin&&i.setOrigin(s,r),1):0}stratum_setWindowPos(t,s,r,i,n){var a;let o=(a=this.windows.get(t))==null?void 0:a.wnd;return o?(o.setOrigin&&o.setOrigin(s,r),o.setSize&&o.setSize(i,n),1):0}stratum_setWindowTitle(t,s){let r=this.windows.get(t);return r?(r.title=s,r.wnd.setTitle&&r.wnd.setTitle(s),1):0}stratum_getWindowProp(t,s){var o;let r=(o=this.windows.get(t))==null?void 0:o.source;if(!r)return"";let i=s.toUpperCase();return i==="CLASSNAME"&&r.origin==="class"||i==="FILENAME"&&r.origin==="file"?r.name:""}stratum_isWindowExist(t){return this.windows.has(t)?1:0}stratum_bringWindowToTop(t){var r;let s=(r=this.windows.get(t))==null?void 0:r.wnd;return s?(s.toTop&&s.toTop(),1):0}stratum_showWindow(t,s){var i;let r=(i=this.windows.get(t))==null?void 0:i.wnd;if(!r)return 0;switch(s){case x.SW_HIDE:r.setVisibility&&r.setVisibility(!1);break;case x.SW_SHOW:case x.SW_NORMAL:r.setVisibility&&r.setVisibility(!0);break}return 1}stratum_closeWindow(t){let s=this.windows.get(t);return s?(this.markClosed(s),this.removeClosed(!0),1):0}stratum_setWindowTransparent(t,s){var i;let r=(i=typeof t=="number"?this.scenes.get(t):this.windows.get(t))==null?void 0:i.wnd;return r?(r.setTransparent&&r.setTransparent(s),1):0}stratum_setWindowTransparentColor(t,s){var a;let r=(a=typeof t=="number"?this.scenes.get(t):this.windows.get(t))==null?void 0:a.wnd;if(!r)return 0;let i=Ye(s),n=Ke(s),o=ze(s);return r.setBackground&&r.setBackground(i,n,o),1}stratum_setWindowOwner(t,s){return t===0||s===0||this.setWindowOwnerwarnShowed||(console.warn(`setWindowOwner(${t},${s} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430)`),this.setWindowOwnerwarnShowed=!0),1}stratum_saveRectArea2d(t,s,r,i,n,o,a){var g;let u=(g=this.scenes.get(t))==null?void 0:g.scene.toDataURL(i,n,o,a);if(!u)return 0;let[h,p]=u,T=s.replace("\\","/"),_=T.substring(T.lastIndexOf("/")+1,T.lastIndexOf(".")),d=document.createElement("a");return d.setAttribute("href",p),d.setAttribute("download",`${_||"Screenshot"}.${h}`),d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),1}stratum_getSpaceOrg2dx(t){var s,r;return(r=(s=this.scenes.get(t))==null?void 0:s.scene.offsetX())!=null?r:0}stratum_getSpaceOrg2dy(t){var s,r;return(r=(s=this.scenes.get(t))==null?void 0:s.scene.offsetY())!=null?r:0}stratum_setSpaceOrg2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.scene;return i?(i.setOffset(s,r),1):0}stratum_getScaleSpace2d(t){var s,r;return(r=(s=this.scenes.get(t))==null?void 0:s.scale)!=null?r:0}stratum_setScaleSpace2d(t,s){let r=this.scenes.get(t);return r?(r.scale=s,r.scene.scale(s),1):0}stratum_getBkBrush2d(t){var s,r,i;return(i=(r=(s=this.scenes.get(t))==null?void 0:s.scene.brush.tool())==null?void 0:r.handle)!=null?i:0}stratum_setBkBrush2d(t,s){var i;let r=this.scenes.get(t);return r?(r.scene.brush.setTool((i=r.brushes.get(s))!=null?i:null),1):0}stratum_lockSpace2d(t,s){return this.lockSpace2dWarnShowed||(console.warn(`LockSpace2d(${t}, ${s}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.lockSpace2dWarnShowed=!0),0}stratum_getToolRef2d(t,s,r){var n,o,a,u,h,p,T,_,d,g,v,D,M,k;let i=this.scenes.get(t);if(!i)return 0;switch(s){case x.PEN2D:return(o=(n=i.pens.get(r))==null?void 0:n.subCount())!=null?o:0;case x.BRUSH2D:return(u=(a=i.brushes.get(r))==null?void 0:a.subCount())!=null?u:0;case x.DIB2D:return(p=(h=i.dibs.get(r))==null?void 0:h.subCount())!=null?p:0;case x.DOUBLEDIB2D:return(_=(T=i.doubleDibs.get(r))==null?void 0:T.subCount())!=null?_:0;case x.TEXT2D:return(g=(d=i.texts.get(r))==null?void 0:d.subCount())!=null?g:0;case x.STRING2D:return(D=(v=i.strings.get(r))==null?void 0:v.subCount())!=null?D:0;case x.FONT2D:return(k=(M=i.fonts.get(r))==null?void 0:M.subCount())!=null?k:0;case x.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_deleteTool2d(t,s,r){let i=this.scenes.get(t);if(!i)return 0;switch(s){case x.PEN2D:return i.pens.delete(r)?1:0;case x.BRUSH2D:{let o=i.brushes.get(r);return o?(o.image.forceUnsub(),i.brushes.delete(r),1):0}case x.DIB2D:return i.dibs.delete(r)?1:0;case x.DOUBLEDIB2D:return i.doubleDibs.delete(r)?1:0;case x.TEXT2D:let n=i.texts.get(r);return n?(n.parts.forEach(o=>{o.font.forceUnsub(),o.str.forceUnsub()}),i.texts.delete(r),1):0;case x.STRING2D:return i.strings.delete(r)?1:0;case x.FONT2D:return i.fonts.delete(r)?1:0;case x.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_createPen2d(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=B.getFreeHandle(o.pens);return o.pens.set(a,new V.pen(o.scene,{handle:a,color:i,rop:n,style:s,width:r})),a}stratum_getPenColor2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.pens.get(s))==null?void 0:i.color())!=null?n:0}stratum_getPenRop2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.pens.get(s))==null?void 0:i.rop())!=null?n:0}stratum_getPenStyle2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.pens.get(s))==null?void 0:i.style())!=null?n:0}stratum_getPenWidth2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.pens.get(s))==null?void 0:i.width())!=null?n:0}stratum_setPenColor2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.pens.get(s);return i?(i.setColor(r),1):0}stratum_setPenRop2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.pens.get(s);return i?(i.setRop(r),1):0}stratum_setPenStyle2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.pens.get(s);return i?(i.setStyle(r),1):0}stratum_setPenWidth2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.pens.get(s);return i?(i.setWidth(r),1):0}stratum_createBrush2d(t,s,r,i,n,o){let a=this.scenes.get(t);if(!a)return 0;let u=B.getFreeHandle(a.brushes),h={handle:u,color:i,hatch:r,style:s,rop:o,image:a.dibs.get(n)};return a.brushes.set(u,new V.brush(a.scene,h)),u}stratum_getBrushColor2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.brushes.get(s))==null?void 0:i.color())!=null?n:0}stratum_getBrushRop2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.brushes.get(s))==null?void 0:i.rop())!=null?n:0}stratum_getBrushStyle2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.brushes.get(s))==null?void 0:i.style())!=null?n:0}stratum_getBrushHatch2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.brushes.get(s))==null?void 0:i.hatch())!=null?n:0}stratum_getBrushDib2d(t,s){var r,i,n,o;return(o=(n=(i=(r=this.scenes.get(t))==null?void 0:r.brushes.get(s))==null?void 0:i.image.tool())==null?void 0:n.handle)!=null?o:0}stratum_setBrushColor2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.brushes.get(s);return i?(i.setColor(r),1):0}stratum_setBrushRop2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.brushes.get(s);return i?(i.setRop(r),1):0}stratum_setBrushStyle2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.brushes.get(s);return i?(i.setStyle(r),1):0}stratum_setBrushHatch2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.brushes.get(s);return i?(i.setHatch(r),1):0}stratum_setBrushDib2d(t,s,r){var o;let i=this.scenes.get(t);if(!i)return 0;let n=i.brushes.get(s);return n?(n.image.setTool((o=i.dibs.get(r))!=null?o:null),1):0}createFont(t,s,r,i){let n=this.scenes.get(t);if(!n)return 0;let o=B.getFreeHandle(n.fonts),a={handle:o,name:s,style:i};return n.fonts.set(o,new V.font(n.scene,r,a)),o}stratum_createFont2D(t,s,r,i){return this.createFont(t,s,r,i)}stratum_createFont2Dpt(t,s,r,i){return this.createFont(t,s,r*Ge.ptToPx,i)}stratum_getFontName2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.fonts.get(s))==null?void 0:i.name())!=null?n:""}stratum_getFontSize2d(t,s){var r,i,n;return((n=(i=(r=this.scenes.get(t))==null?void 0:r.fonts.get(s))==null?void 0:i.size())!=null?n:0)*Ge.pxToPt}stratum_getFontStyle2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.fonts.get(s))==null?void 0:i.style())!=null?n:0}stratum_setFontName2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.fonts.get(s);return i?(i.setName(r),1):0}stratum_setFontSize2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.fonts.get(s);return i?(i.setSize(r*Ge.ptToPx),1):0}stratum_setFontStyle2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.fonts.get(s);return i?(i.setStyle(r),1):0}stratum_createString2D(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=B.getFreeHandle(r.strings),n={handle:i};return r.strings.set(i,new V.str(r.scene,s,n)),i}stratum_getstring2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.strings.get(s))==null?void 0:i.text())!=null?n:""}stratum_setString2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.strings.get(s);return i?(i.setText(r),1):0}stratum_createText2D(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=o.fonts.get(s);if(!a)return 0;let u=o.strings.get(r);if(!u)return 0;let h={fgColor:i,bgColor:n,font:a,str:u},p=B.getFreeHandle(o.texts),T={handle:p};return o.texts.set(p,new V.ttool(o.scene,[h],T)),p}stratum_createRasterText2D(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=o.texts.get(s);if(!a)return 0;let u=r,h=i,p=o.matrix;if(p){let d=r*p[2]+i*p[5]+p[8];u=(r*p[0]+i*p[3]+p[6])/d,h=(r*p[1]+i*p[4]+p[7])/d}let T=B.getFreeHandle(o.objects),_=new V.text(o.scene,a,{handle:T,x:u,y:h,angle:n});return o.objects.set(T,_),o.scene.setElements([...o.scene.elements(),_]),T}stratum_getTextObject2d(t,s){var i,n,o;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="text"&&(o=(n=r.tool.tool())==null?void 0:n.handle)!=null?o:0}stratum_getTextCount2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.texts.get(s))==null?void 0:i.parts.length)!=null?n:0}stratum_getTextFont2d(t,s,r=0){var n,o;if(r<0)return 0;let i=(o=(n=this.scenes.get(t))==null?void 0:n.texts.get(s))==null?void 0:o.parts;return!i||r>i.length-1?0:i[r].font.tool().handle}stratum_getTextString2d(t,s,r=0){var n,o;if(r<0)return 0;let i=(o=(n=this.scenes.get(t))==null?void 0:n.texts.get(s))==null?void 0:o.parts;return!i||r>i.length-1?0:i[r].str.tool().handle}stratum_getTextFgColor2d(t,s,r=0){var n,o;if(r<0)return 0;let i=(o=(n=this.scenes.get(t))==null?void 0:n.texts.get(s))==null?void 0:o.parts;return!i||r>i.length-1?0:i[r].fgColor()}stratum_getTextBkColor2d(t,s,r=0){var n,o;if(r<0)return 0;let i=(o=(n=this.scenes.get(t))==null?void 0:n.texts.get(s))==null?void 0:o.parts;return!i||r>i.length-1?0:i[r].bgColor()}stratum_setText2D(t,s,r,i,n,o,a){var k;let u=typeof a!="undefined"?r:0,h=typeof a!="undefined"?i:r,p=typeof a!="undefined"?n:i,T=typeof a!="undefined"?o:n,_=typeof a!="undefined"?a:o;if(u<0)return 0;let d=this.scenes.get(t);if(!d)return 0;let g=(k=d.texts.get(s))==null?void 0:k.parts;if(!g||u>g.length-1)return 0;let v=g[u].setFgColor(T).setBgColor(_),D=d.fonts.get(h);D&&v.font.setTool(D);let M=d.strings.get(p);return M&&v.str.setTool(M),1}stratum_setTextFgColor2d(t,s,r,i){var o,a;if(r<0)return 0;let n=(a=(o=this.scenes.get(t))==null?void 0:o.texts.get(s))==null?void 0:a.parts;return!n||r>n.length-1?0:(n[r].setFgColor(i),1)}stratum_setTextBkColor2d(t,s,r,i){var o,a;if(r<0)return 0;let n=(a=(o=this.scenes.get(t))==null?void 0:o.texts.get(s))==null?void 0:a.parts;return!n||r>n.length-1?0:(n[r].setBgColor(i),1)}stratum_setTextFont2d(t,s,r,i){var u;if(r<0)return 0;let n=this.scenes.get(t);if(!n)return 0;let o=n.fonts.get(i);if(!o)return 0;let a=(u=n.texts.get(s))==null?void 0:u.parts;return!a||r>a.length-1?0:(a[r].font.setTool(o),1)}stratum_setTextString2d(t,s,r,i){var u;if(r<0)return 0;let n=this.scenes.get(t);if(!n)return 0;let o=n.strings.get(i);if(!o)return 0;let a=(u=n.texts.get(s))==null?void 0:u.parts;return!a||r>a.length-1?0:(a[r].str.setTool(o),1)}stratum_getDibPixel2D(t,s,r,i){var n,o,a;return(a=(o=(n=this.scenes.get(t))==null?void 0:n.dibs.get(s))==null?void 0:o.pixel(r,i))!=null?a:0}stratum_setDibPixel2D(t,s,r,i,n){var a;let o=(a=this.scenes.get(t))==null?void 0:a.dibs.get(s);return o?(o.setPixel(r,i,n),1):0}createBitmap(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=(n?o.doubleDibs:o.dibs).get(s);if(!a)return 0;let u=r,h=i,p=o.matrix;if(p){let d=r*p[2]+i*p[5]+p[8];u=(r*p[0]+i*p[3]+p[6])/d,h=(r*p[1]+i*p[4]+p[7])/d}let T=B.getFreeHandle(o.objects),_=new V.bitmap(o.scene,n,a,{handle:T,x:u,y:h});return o.objects.set(T,_),o.scene.setElements([...o.scene.elements(),_]),T}stratum_createBitmap2d(t,s,r,i){return this.createBitmap(t,s,r,i,!1)}stratum_createDoubleBitmap2D(t,s,r,i){return this.createBitmap(t,s,r,i,!0)}stratum_setBitmapSrcRect2d(t,s,r,i,n,o){var u;let a=(u=this.scenes.get(t))==null?void 0:u.objects.get(s);return(a==null?void 0:a.type)!=="image"?0:(a.setCropArea({x:r,y:i,w:n,h:o}),1)}stratum_getDibObject2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="image"&&!r.isTransparent?r.image.tool().handle:0}stratum_getDDibObject2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="image"&&r.isTransparent?r.image.tool().handle:0}stratum_rgbEx(t,s,r,i){return xe(t,s,r,i)}stratum_rgb(t,s,r){return xe(t,s,r,0)}stratum_getRValue(t){return Ye(t)}stratum_getGValue(t){return Ke(t)}stratum_getBValue(t){return ze(t)}stratum_copyToClipboard2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return r?(this.copied=r,1):0}stratum_pasteFromClipboard2d(t,s,r,i){if(!this.copied)return 0;let n=this.scenes.get(t);if(!n)return 0;let o=Er(n,this.copied),a=n.matrix;if(!a)return o.move(s,r).handle;let u=s*a[2]+r*a[5]+a[8],h=(s*a[0]+r*a[3]+a[6])/u,p=(s*a[1]+r*a[4]+a[7])/u;return o.move(h,p).handle}stratum_getNextObject2d(t,s){let r=this.scenes.get(t);if(!r)return 0;if(s===0){let n=r.objects.values().next();return n.done?0:n.value.handle}let i=!1;for(let[n]of r.objects){if(i)return n;n===s&&(i=!0)}return 0}stratum_deleteObject2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i)return 0;let n=i.parent();n&&n.setChildren(n.children().filter(a=>a!==i));let o=new WeakSet([i]);switch(i.type){case"group":yr(i.children(),o);break;case"line":i.pen.forceUnsub(),i.brush.forceUnsub();break;case"image":i.image.forceUnsub();break;case"text":i.tool.forceUnsub();break;case"input":i.font.forceUnsub();break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F ${i.type}`)}return r.objects=new Map([...r.objects].filter(a=>!o.has(a[1]))),r.scene.setElements(r.scene.elements().filter(a=>!o.has(a))),1}stratum_getObjectName2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.objects.get(s))==null?void 0:i.name)!=null?n:""}stratum_setObjectName2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.objects.get(s);return i?(i.name=r,1):0}stratum_getObject2dByName(t,s,r){var o,a;if(r.length===0)return 0;let i=this.scenes.get(t);if(!i)return 0;if(!s){for(let[u,h]of i.objects)if(h.name===r)return u;return 0}let n=i.objects.get(s);return(n==null?void 0:n.type)!=="group"?0:(a=(o=vr(r,n.children()))==null?void 0:o.handle)!=null?a:0}stratum_getObjectType2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);if(!r)return 0;switch(r.type){case"group":return x.OTGROUP2D;case"line":return x.OTLINE_2D;case"image":return r.isTransparent?x.OTDOUBLEBITMAP_2D:x.OTBITMAP_2D;case"text":return x.OTTEXT_2D;case"input":return 26}}stratum_setObjectOrg2d(t,s,r,i){let n=this.scenes.get(t);if(!n)return 0;let o=n.objects.get(s);if(!o)return 0;let a=n.matrix;if(!a)return o.move(r,i),1;let u=r*a[2]+i*a[5]+a[8],h=(r*a[0]+i*a[3]+a[6])/u,p=(r*a[1]+i*a[4]+a[7])/u;return o.move(h,p),1}stratum_getObjectOrg2dx(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i)return 0;let n=r.invMatrix;if(!n)return i.x();let o=i.x(),a=i.y(),u=o*n[2]+a*n[5]+n[8];return(o*n[0]+a*n[3]+n[6])/u}stratum_getObjectOrg2dy(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i)return 0;let n=r.invMatrix;if(!n)return i.y();let o=i.x(),a=i.y(),u=o*n[2]+a*n[5]+n[8];return(o*n[1]+a*n[4]+n[7])/u}stratum_setObjectSize2d(t,s,r,i){var o;let n=(o=this.scenes.get(t))==null?void 0:o.objects.get(s);return n?(n.size(r,i),1):0}stratum_getObjectWidth2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.objects.get(s))==null?void 0:i.width())!=null?n:0}stratum_getObjectHeight2d(t,s){var r,i,n;return(n=(i=(r=this.scenes.get(t))==null?void 0:r.objects.get(s))==null?void 0:i.height())!=null?n:0}stratum_getActualWidth2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);if(!r)return 0;switch(r.type){case"group":case"line":case"input":return r.width();case"image":return r.image.tool().width();case"text":return r.actualWidth()}}stratum_getActualHeight2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);if(!r)return 0;switch(r.type){case"group":case"line":case"input":return r.height();case"image":return r.image.tool().height();case"text":return r.actualHeight()}}stratum_getObjectAngle2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);if(!r)return 0;switch(r.type){case"group":case"line":case"input":case"image":return 0;case"text":return r.angle()}}stratum_rotateObject2d(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=o.objects.get(s);if(!a)return 0;let u=o.matrix;if(!u)return a.rotate(r,i,n),1;let h=r*u[2]+i*u[5]+u[8],p=(r*u[0]+i*u[3]+u[6])/h,T=(r*u[1]+i*u[4]+u[7])/h;return a.rotate(p,T,n),1}setShow(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.objects.get(s);if(!i)return 0;switch(i.type){case"group":wr(i.children(),r);break;default:i.visib.setVisible(r)}return 1}stratum_setShowObject2d(t,s,r){return this.setShow(t,s,r!==0)}stratum_showObject2d(t,s){return this.setShow(t,s,!0)}stratum_hideObject2d(t,s){return this.setShow(t,s,!1)}getObjAtPoint(t,s,r,i){let n=s,o=r,a=t.matrix;if(a){let p=s*a[2]+r*a[5]+a[8];n=(s*a[0]+r*a[3]+a[6])/p,o=(s*a[1]+r*a[4]+a[7])/p}let u=t.scene.elementAtPoint(n,o);if(i){if(!u||u.unselectable)return this.lastPrimary=0,null;this.lastPrimary=u.handle}if(!u)return null;let h=u;for(;h;){let p=h.parent();if(!p)break;h=p}return h}stratum_getObjectFromPoint2d(t,s,r){var n,o;let i=this.scenes.get(t);return i&&(o=(n=this.getObjAtPoint(i,s,r,!0))==null?void 0:n.handle)!=null?o:0}stratum_getLastPrimary2d(){return this.lastPrimary}stratum_getBottomObject2d(t){var i;let s=(i=this.scenes.get(t))==null?void 0:i.scene;if(!s)return 0;let r=s.elements();return r.length>0?r[0].handle:0}stratum_getTopObject2d(t){var i;let s=(i=this.scenes.get(t))==null?void 0:i.scene;if(!s)return 0;let r=s.elements();return r.length>0?r[r.length-1].handle:0}stratum_getLowerObject2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i||i.type==="group")return 0;let n=r.scene.elements(),o=n.indexOf(i);return o<1?0:n[o-1].handle}stratum_getUpperObject2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i||i.type==="group")return 0;let n=r.scene.elements(),o=n.indexOf(i);return o>-1&&o<n.length-1?n[o+1].handle:0}stratum_getObjectFromZOrder2d(t,s){var o;let r=s-1;if(r<0)return 0;let i=(o=this.scenes.get(t))==null?void 0:o.scene;if(!i)return 0;let n=i.elements();return r<n.length?n[r].handle:0}stratum_getZOrder2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if(!i||i.type==="group")return 0;let o=r.scene.elements().indexOf(i);return o<0?0:o+1}stratum_setZOrder2d(t,s,r){let i=r-1;if(i<0)return 0;let n=this.scenes.get(t);if(!n)return 0;let o=n.objects.get(s);if(!o||o.type==="group")return 0;let a=n.scene.elements(),u=[];for(let h=0;h<a.length;++h){h===i&&u.push(o);let p=a[h];p!==o&&u.push(p)}return i>=a.length&&u.push(o),n.scene.setElements(u),1}stratum_objectToBottom2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);return!i||i.type==="group"?0:(r.scene.setElements([i,...r.scene.elements().filter(n=>n!==i)]),1)}stratum_objectToTop2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);return!i||i.type==="group"?0:(r.scene.setElements([...r.scene.elements().filter(n=>n!==i),i]),1)}stratum_swapObject2d(t,s,r){let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(s);if(!n||n.type==="group")return 0;let o=i.objects.get(r);if(!o||o.type==="group")return 0;let a=i.scene.elements().slice(),u=a.indexOf(n);if(u<0)return 0;let h=a.indexOf(o);if(h<0)return 0;let p=a[u];return a[u]=a[h],a[h]=p,i.scene.setElements(a),1}createLine(t,s,r,i){let n=this.scenes.get(t);if(!n)return 0;let o=i,a=n.matrix;if(a){let _=i.slice();for(let d=0;d<o.length;d+=2){let g=o[d],v=o[d+1],D=g*a[2]+v*a[5]+a[8];_[d]=(g*a[0]+v*a[3]+a[6])/D,_[d+1]=(g*a[1]+v*a[4]+a[7])/D}o=_}let u=n.pens.get(s),h=n.brushes.get(r),p=B.getFreeHandle(n.objects),T=new V.line(n.scene,o,{handle:p,pen:u,brush:h});return n.objects.set(p,T),n.scene.setElements([...n.scene.elements(),T]),p}stratum_createPolyLine2d(t,s,r,...i){return this.createLine(t,s,r,i)}stratum_createLine2d(t,s,r,i,n){return this.createLine(t,s,r,[i,n])}stratum_addPoint2d(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=o.objects.get(s);if((a==null?void 0:a.type)!=="line")return 0;let u=o.matrix;if(!u)return a.add(r,i,n)?1:0;let h=i*u[2]+n*u[5]+u[8],p=(i*u[0]+n*u[3]+u[6])/h,T=(i*u[1]+n*u[4]+u[7])/h;return a.add(r,p,T)?1:0}stratum_delpoint2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.objects.get(s);return(i==null?void 0:i.type)==="line"&&i.delete(r)?1:0}stratum_getPenObject2d(t,s){var i,n,o;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="line"&&(o=(n=r.pen.tool())==null?void 0:n.handle)!=null?o:0}stratum_getBrushObject2d(t,s){var i,n,o;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="line"&&(o=(n=r.brush.tool())==null?void 0:n.handle)!=null?o:0}stratum_getVectorNumPoints2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="line"?r.pointCount():0}stratum_getVectorPoint2dx(t,s,r){let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(s);if((n==null?void 0:n.type)!=="line")return 0;let o=i.invMatrix;if(!o)return n.px(r);let a=n.px(r),u=n.py(r),h=a*o[2]+u*o[5]+o[8];return(a*o[0]+u*o[3]+o[6])/h}stratum_getVectorPoint2dy(t,s,r){let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(s);if((n==null?void 0:n.type)!=="line")return 0;let o=i.invMatrix;if(!o)return n.py(r);let a=n.px(r),u=n.py(r),h=a*o[2]+u*o[5]+o[8];return(a*o[1]+u*o[4]+o[7])/h}stratum_setVectorPoint2d(t,s,r,i,n){let o=this.scenes.get(t);if(!o)return 0;let a=o.objects.get(s);if((a==null?void 0:a.type)!=="line")return 0;let u=o.matrix;if(!u)return a.update(r,i,n)?1:0;let h=i*u[2]+n*u[5]+u[8],p=(i*u[0]+n*u[3]+u[6])/h,T=(i*u[1]+n*u[4]+u[7])/h;return a.update(r,p,T)?1:0}stratum_createGroup2d(t,...s){let r=this.scenes.get(t);if(!r)return 0;let i=new Set;for(let o of s){let a=r.objects.get(o);if(!a)return 0;i.add(a)}let n=B.getFreeHandle(r.objects);return r.objects.set(n,new Te(r.scene,{handle:n,children:[...i]})),n}stratum_deleteGroup2d(t,s){let r=this.scenes.get(t);if(!r)return 0;let i=r.objects.get(s);if((i==null?void 0:i.type)!=="group")return 0;let n=i.parent();return n&&n.setChildren(n.children().filter(o=>o!==i)),i.setChildren([]),r.objects.delete(s),1}stratum_addGroupItem2d(t,s,r){if(s===r)return 0;let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(r);if(!n||n.parent())return 0;let o=i.objects.get(s);if((o==null?void 0:o.type)!=="group")return 0;if(n.type==="group"){let a=o;for(;a=a.parent();)if(a===n)return 0}return o.setChildren([...o.children(),n]),1}stratum_delGroupItem2d(t,s,r){if(s===r)return 0;let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(s);if((n==null?void 0:n.type)!=="group")return 0;let o=i.objects.get(r);return(o==null?void 0:o.parent())!==n?0:(n.setChildren(n.children().filter(a=>a!==o)),1)}stratum_getGroupItemsNum2d(t,s){var i;let r=(i=this.scenes.get(t))==null?void 0:i.objects.get(s);return(r==null?void 0:r.type)==="group"?r.children().length:0}stratum_getGroupItem2d(t,s,r){var o;if(r<0)return 0;let i=(o=this.scenes.get(t))==null?void 0:o.objects.get(s);if((i==null?void 0:i.type)!=="group")return 0;let n=i.children();return r<n.length?n[r].handle:0}stratum_getObjectParent2d(t,s){var r,i,n,o;return(o=(n=(i=(r=this.scenes.get(t))==null?void 0:r.objects.get(s))==null?void 0:i.parent())==null?void 0:n.handle)!=null?o:0}stratum_isObjectsIntersect2d(t,s,r){let i=this.scenes.get(t);if(!i)return 0;let n=i.objects.get(s);if(!n)return 0;let o=i.objects.get(r);if(!o)return 0;let a=n.x(),u=a+n.width(),h=n.y(),p=h+n.height(),T=o.x(),_=T+o.width(),d=o.y(),g=d+o.height();return u>=T&&_>=a&&p>=d&&g>=h?1:0}stratum_createControlObject2d(t,s,r,i,n,o,a,u){let h=s.toUpperCase();if(h!=="EDIT"&&h!=="BUTTON"&&h!=="COMBOBOX")return 0;let p=this.scenes.get(t);if(!p)return 0;let T=n,_=o,d=p.matrix;if(d){let D=n*d[2]+o*d[5]+d[8];T=(n*d[0]+o*d[3]+d[6])/D,_=(n*d[1]+o*d[4]+d[7])/D}if(h!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${h} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);let g=B.getFreeHandle(p.objects),v=new V.input(p.scene,{handle:g,x:T,y:_,text:r,width:a,height:u});return p.objects.set(g,v),p.scene.setElements([...p.scene.elements(),v]),g}stratum_setControlFont2d(t,s,r){let i=this.scenes.get(t);if(!i)return 0;let n=i.fonts.get(r);if(!n)return 0;let o=i.objects.get(s);return(o==null?void 0:o.type)!=="input"?0:(o.font.setTool(n),1)}stratum_getControlText2d(t,s,r,i){var o;let n=(o=this.scenes.get(t))==null?void 0:o.objects.get(s);return(n==null?void 0:n.type)!=="input"?"":typeof r=="undefined"||typeof i=="undefined"?n.text():n.text().slice(r,r+i)}stratum_setControlText2d(t,s,r){var n;let i=(n=this.scenes.get(t))==null?void 0:n.objects.get(s);return(i==null?void 0:i.type)!=="input"?0:(i.setText(r),1)}stratum_getObjectClass(t,s){let r=this.classes.get(t);if(!r)return"";let i=r.children.find(n=>n.handle===s);return i?i.classname:""}stratum_setObjectName(t,s,r){return this.setObjectNameShowed||(this.setObjectNameShowed=!0,console.warn("setObjectName \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")),1}stratum_getLink(t,s,r){var o;let i=this.classes.get(t);if(!i)return 0;let n=i.links.find(a=>a.handle1===s&&a.handle2===r||a.handle1===r&&a.handle2===s);return(o=n==null?void 0:n.handle)!=null?o:0}stratum_getObjectCount(t){var s,r;return(r=(s=this.classes.get(t))==null?void 0:s.children.length)!=null?r:0}stratum_setModelText(t,s,r){let i=this.streams.get(s);if(!i)return 0;let n=this.classes.get(t);return n?(n.setCode(i.text()),1):0}stratum_getVarCount(t){var s,r;return(r=(s=this.classes.get(t))==null?void 0:s.vars().count())!=null?r:0}stratum_getHObjectByNum(t,s){var i;if(s<0)return 0;let r=(i=this.classes.get(t))==null?void 0:i.children;return!r||s>r.length-1?0:r[s].handle}stratum_quit(t){t<=0||(this._shouldQuit=!0)}stratum_addSlash(t){return t.length===0||t[t.length-1]==="\\"?t:t+"\\"}stratum_getClassDirectory(t){let s=this.classes.getPath(t);return s?rn(s):""}stratum_closeClassScheme(){return 1}stratum_getWindowsDirectory(){return"C:\\Windows"}stratum_MCISendString(){return x.MCIERR_INVALID_DEVICE_NAME}stratum_MCISendStringStr(){return""}stratum_ascii(t){if(t.length===0)return 0;let s=Oe.indexOf(t[0]);return s<0?0:s}stratum_chr(t){return t<0||t>255?"":Oe[t]}stratum_async_closeStream(t){let s=this.streams.get(t);if(!s)return 0;this.streams.delete(t);let r=s.close();return r instanceof Promise?r.then(i=>i?1:0):r?1:0}stratum_seek(t,s){var r,i;return(i=(r=this.streams.get(t))==null?void 0:r.seek(s))!=null?i:0}stratum_eof(t){var s,r;return(r=(s=this.streams.get(t))==null?void 0:s.eof())!=null?r:0}stratum_getPos(t){var s,r;return(r=(s=this.streams.get(t))==null?void 0:s.pos())!=null?r:0}stratum_getSize(t){var s,r;return(r=(s=this.streams.get(t))==null?void 0:s.size())!=null?r:0}stratum_setWidth(t,s){var r,i;return(i=(r=this.streams.get(t))==null?void 0:r.setWidth(s))!=null?i:0}stratum_read(t){var s,r;return(r=(s=this.streams.get(t))==null?void 0:s.widthNumber())!=null?r:0}stratum_readLn(t){var s,r;return(r=(s=this.streams.get(t))==null?void 0:s.line())!=null?r:""}stratum_write(t,s){var r,i;return(i=(r=this.streams.get(t))==null?void 0:r.writeWidthNumber(s))!=null?i:0}stratum_writeLn(t,s){var r,i;return(i=(r=this.streams.get(t))==null?void 0:r.writeLine(s))!=null?i:0}stratum_copyBlock(t,s,r,i){let n=this.streams.get(t);if(!n)return 0;let o=this.streams.get(s);return o?n.copyTo(o,r,i):0}stratum_mCreate(t,s,r,i,n,o){if(o<=0)return 0;let a=r-s+1,u=n-i+1;if(a<=0||u<=0)return 0;let h=t===0?B.getFreeNegativeHandle(this.matrices):t;return this.matrices.set(h,new wt({rows:a,cols:u,minX:s,minY:i})),h}stratum_mDelete(t,s){return s<=0?0:this.matrices.delete(t)?1:0}stratum_mFill(t,s,r){var i,n;return r<=0?0:(n=(i=this.matrices.get(t))==null?void 0:i.fill(s))!=null?n:0}stratum_mGet(t,s,r,i){var n,o;return i<=0?0:(o=(n=this.matrices.get(t))==null?void 0:n.get(s,r))!=null?o:0}stratum_mPut(t,s,r,i,n){var o,a;return n<=0?0:(a=(o=this.matrices.get(t))==null?void 0:o.set(s,r,i))!=null?a:0}stratum_async_mEditor(t,s){if(s<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}stratum_new(){let t=B.getFreeHandle(this.arrays);return this.arrays.set(t,new qt),t}stratum_delete(t){this.arrays.delete(t)}stratum_vGetCount(t){var s,r;return(r=(s=this.arrays.get(t))==null?void 0:s.count())!=null?r:0}stratum_vGetType(t,s){var r,i;return(i=(r=this.arrays.get(t))==null?void 0:r.type(s))!=null?i:""}stratum_vInsert(t,s){let r=this.arrays.get(t);if(!r)return 0;let i=s.toUpperCase();if(i==="STRING"||i==="FLOAT"||i==="HANDLE")return r.insert(i);let n=this.classes.get(s);if(!(n==null?void 0:n.isStruct))return 0;let o=n.vars().toArray().map(a=>[a.name,a.type]);return r.insertClass(o)}stratum_vDelete(t,s){var r,i;return(i=(r=this.arrays.get(t))==null?void 0:r.remove(s))!=null?i:0}stratum_vClearAll(){return this.arrays.clear(),1}stratum_vGetS(t,s,r){var i,n;return(n=(i=this.arrays.get(t))==null?void 0:i.getString(s,r))!=null?n:""}stratum_vGetH(t,s,r){var i,n;return(n=(i=this.arrays.get(t))==null?void 0:i.getHandle(s,r))!=null?n:0}stratum_vGetF(t,s,r){var i,n;return(n=(i=this.arrays.get(t))==null?void 0:i.getFloat(s,r))!=null?n:0}stratum_vSet(t,s,r,i){var n;(n=this.arrays.get(t))==null||n.set(s,r,i)}stratum_vSort(t,...s){let r=this.arrays.get(t);if(!r)return 0;if(s.length===0)return r.sort();if(typeof s[0]=="number"){let n=!!s[0],o=s.length>1?s[1]:"";return r.sort([{desc:n,field:o}])}let i=[];for(let n=0;n<s.length;n+=2){let o=s[n],a=!!s[n+1];i.push({desc:a,field:o})}return r.sort(i)}},we=Ge;we.startupTime=new Date().getTime(),we.pxToPt=.752812499999996,we.ptToPx=1.3283520132835271;Re(we,"env");var Sn=class{constructor(t,s,{title:r,isPopup:i,size:n}){this.root=t;this.view=s;this.ox=0;this.oy=0;var o,a;this.origTitle=document.title,!i&&r&&(document.title=this.origTitle?`${this.origTitle} - ${r}`:r),this.popup=i,t.appendChild(s),this.lastW=(o=n==null?void 0:n.width)!=null?o:s.clientWidth,this.lastH=(a=n==null?void 0:n.height)!=null?a:s.clientHeight}width(){return this.view.clientWidth}clientWidth(){return this.view.clientWidth}height(){return this.view.clientHeight}clientHeight(){return this.view.clientHeight}originX(){return this.ox}originY(){return this.oy}setOrigin(t,s){this.ox=t,this.oy=s,!!this.popup&&(this.view.style.setProperty("left",t+"px"),this.view.style.setProperty("top",s+"px"))}setSize(t,s){console.log("size",t,s)}setClientSize(t,s){this.view.style.setProperty("width",t.toString()),this.view.style.setProperty("height",s.toString())}setTitle(t){document.title=t}setVisibility(t){this.view.style.setProperty("display",t?"block":"none")}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},En=class{constructor(t,{title:s}){this.wnd=t;this.handlers=new Set;this.sizedOnce=!1;s&&(t.document.title=s)}on(t,s){t==="closed"&&(this.wnd.addEventListener("beforeunload",s),this.handlers.add(s))}off(t,s){t==="closed"&&(s?(this.wnd.removeEventListener("beforeunload",s),this.handlers.delete(s)):(this.handlers.forEach(r=>this.wnd.removeEventListener("beforeunload",r)),this.handlers.clear()))}setTitle(t){this.wnd.document.title=t}resizeTo(t,s){if(this.sizedOnce===!0)return;let{wnd:r}=this;r.addEventListener("resize",()=>r.resizeTo(t+r.outerWidth-r.innerWidth,s+r.outerHeight-r.innerHeight),{once:!0}),this.sizedOnce=!0}close(){this.off("closed"),this.wnd.close()}},Ft=class{constructor(t){this.root=t;t==null||t.style.setProperty("position","relative")}get width(){var t;return((t=this.root)==null?void 0:t.clientWidth)||window.innerWidth}get height(){var t;return((t=this.root)==null?void 0:t.clientHeight)||window.innerHeight}append(t,s){var n,o,a,u;let r=document.createElement("div");if(s.isPopup){let h=Math.max((o=(n=s.position)==null?void 0:n.x)!=null?o:0,0),p=Math.max((u=(a=s.position)==null?void 0:a.y)!=null?u:0,0);r.style.setProperty("position","absolute"),r.style.setProperty("left",h+"px"),r.style.setProperty("top",p+"px"),r.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)")}else r.setAttribute("class","stratum-window");if(r.style.setProperty("opacity","0"),r.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>r.style.setProperty("opacity","1")),r.style.setProperty("width",s.size?s.size.width+"px":"100%"),r.style.setProperty("height",s.size?s.size.height+"px":"100%"),r.appendChild(t),this.root)return new Sn(this.root,r,s);let i=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!i)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${s.title}`);return i.document.body.style.setProperty("margin","0px"),i.document.body.appendChild(r),new En(i,s)}};var je=class{constructor(t){this._state="closed";this._diag={iterations:0,missingCommands:[]};this.computer=new Ue;this.handlers={closed:new Set,error:new Set,shell:new Set,cursorRequest:null};this.envArgs=t,this.host=new Ft,this.env=null,this.options={},this.loop=null}static create(t,s){return j(this,null,function*(){let r=yield Tn(t,s);return new je(r)})}speed(t,s){let r=t==="smooth"?new Ue:new mr(s),i=this.computer;return i.running&&(i.stop(),this.loop&&r.run(this.loop)),this.computer=r,this}get state(){return this._state}get diag(){return this._diag}play(t){if(this.loop)return this;t&&(this.host=t instanceof HTMLElement?new Ft(t):t);let s=this.env=new we(this.envArgs,this.host,this.handlers);this._diag.iterations=0;let r=!0;return this.loop=()=>r?(s.isWaiting()||s.compute().then(i=>{++this._diag.iterations,i&&(this.loop=null,this.env=null,this._state="closed",this.handlers.closed.forEach(n=>n())),r=!i}).catch(i=>{r=!1,this._state="error",console.error(i),this.handlers.error.forEach(n=>n(i.message))}),!0):!1,this.computer.run(this.loop),this._state="playing",this}close(){var t,s;return this._state==="error"?((t=this.env)==null||t.closeAllRes().then(()=>{this.loop=null,this._state="closed"}),this.env=null,this):((s=this.env)==null||s.requestStop(),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(t,s){return t==="cursorRequest"?(this.handlers.cursorRequest=s,this):(this.handlers[t].add(s),this)}off(t,s){return t==="cursorRequest"?(this.handlers.cursorRequest=null,this):(s?this.handlers[t].delete(s):this.handlers[t].clear(),this)}};var wn;window.stratum=(wn=window.stratum)!=null?wn:{};window.stratum.player=je.create;window.stratum.options=J;window.stratum.version="0.11.0";})();
