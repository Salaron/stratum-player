# stratum-player

Библиотека для исполнения проектов Stratum 2000 в браузере.

## Как запустить?

Запустить демонстрационный плеер можно следующим образом: 
cкопируйте скрипты библиотеки (_dist/stratum.min.js_ и _dist/zipfs.min.js_) 
и каталог _static/data_ в каталог _player_.

Выполните команду:

```
npm run player
```

Или можете попробовать его [онлайн-версию](https://khokm.github.io/stratum-player/).

## Пример использования библиотеки для запуска своих проектов.

Создайте каталог _example_, в нем файл _index.html_ со следующим содержимым:

```html
<script src="stratum.min.js"></script>
<script src="zipfs.min.js"></script>
<script>
    fetch("balls.zip") // Запрашиваем ZIP-архив с интернет-ресурса,
        .then(r => r.blob()) // загружаем его,
        .then(stratum.unzip) //затем распаковываем,
        .then(fs => stratum.player(fs.prj())) //создаем экземпляр плеера, используя первый попавшийся файл проекта,
        .then(p => p.play(document.body)); // и запускаем на выполнение, используя body как корень открываемого окна.
</script>
```

Cкопируйте в тот же каталог скрипты библиотеки из _dist_ и проект _static/projects/balls.zip_
Установите какой-нибудь простой файловый сервер, например [serve](https://www.npmjs.com/package/serve),
и запустите хостинг каталога:

```
serve example
```

Проект будет доступен тут - http://localhost:5000

**Примечание**: ваш проект Stratum с большой вероятностью использует имиджи из стандартной
библиотеки. Поэтому, чтобы запустить его способом, описанным выше, нужно также упаковать их в архив.
Для этого скопируйте папку _C:\Program Files\Stratum 2000\library_ в папку с
вашим проектом, перед тем, как запаковать его.

Этот способ, однако, не рекомендован к использованию: оптимальнее будет подгружать библиотеку отдельным архивом
и объединять ее с архивом файлов проекта перед запуском (см. API библиотеки).

## API

API библиотеки описано в `src/stratum/stratum.d.ts`.

## Сборка библиотеки, запуск тестов.

Необходим установленный [Node.js](https://nodejs.org/en/)

### Установка зависимостей

```
npm -g install esbuild typescript
npm install
```

### Запуск демо

```
npm run live
```

### Юнит-тесты

```
npm run test
```

### Сборка

```
npm run build-stratum
npm run build-zipfs
```

Бандлы будет сохранены в _dist_
